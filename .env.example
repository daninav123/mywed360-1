# Backend Express
VITE_APP_NAME=Planivia
PORT=4004
# Ruta base que usa el frontend para llamar al backend
# Local recomendado: http://localhost:4004 (usa Vite proxy para /api)
VITE_BACKEND_BASE_URL=http://localhost:4004
# Habilitar llamadas directas a OpenAI desde el frontend (solo local)
VITE_ENABLE_DIRECT_OPENAI=false
# CORS: lista de orígenes permitidos (separados por coma)
# En producción define tu dominio exacto (ej: https://app.tu-dominio.com)
ALLOWED_ORIGIN=http://localhost:5173
# Rate limits (0 = desactivado)
# Global desactivado (no usado). IA por usuario: si no defines, usa 60/min en NODE_ENV=production, 0 en otros.
RATE_LIMIT_MAX=0
RATE_LIMIT_AI_MAX=0
# Límite global de peticiones por minuto (0 = desactivado)
RATE_LIMIT_GLOBAL_MAX=0
# Firebase (elige UNA de estas dos opciones)
# 1. Usar cuenta de servicio de GCP
GOOGLE_APPLICATION_CREDENTIALS=C:\cred\planivia-service.json
# 2. Usar el emulador local de Firestore
# FIRESTORE_EMULATOR_HOST=localhost:8080

# Planivia Email Service
# Configuración de Mailgun para el servicio de correo
# Nota: Define ambas variables (con y sin VITE_) para compatibilidad frontend/backend
MAILGUN_API_KEY=tu_mailgun_api_key
VITE_MAILGUN_API_KEY=tu_mailgun_api_key
MAILGUN_DOMAIN=planivia.net
VITE_MAILGUN_DOMAIN=planivia.net
MAILGUN_SENDING_DOMAIN=mg.planivia.net
VITE_MAILGUN_SENDING_DOMAIN=mg.planivia.net
MAILGUN_EU_REGION=false
VITE_MAILGUN_EU_REGION=false
# true para región EU, false para US

# Modo test de Mailgun (para tests E2E)
# En modo test, los emails no se envían realmente, se mockean las respuestas
MAILGUN_TEST_MODE=false

# Límites del servicio de correo
VITE_EMAIL_MAX_ATTACHMENTS=5
VITE_EMAIL_MAX_ATTACHMENT_SIZE_MB=10

# Banco Agregador (Nordigen)
NORDIGEN_SECRET_ID=tu_secret_id
NORDIGEN_SECRET_KEY=tu_secret_key
NORDIGEN_BASE_URL=https://ob.nordigen.com/api/v2

# Frontend Vite (puerto fijo)
FRONTEND_PORT=5173
VITE_BANK_API_BASE_URL=http://localhost:4004/api
VITE_BANK_API_KEY=

# Netlify Deployment
VITE_NETLIFY_TOKEN=tu_netlify_token
VITE_NETLIFY_SITE_ID=tu_netlify_site_id

# Inspiración (conectores Pinterest / Instagram)
PINTEREST_ACCESS_TOKEN=
PINTEREST_BOARD_IDS=
INSTAGRAM_ACCESS_TOKEN=
INSTAGRAM_BUSINESS_ID=
INSTAGRAM_HASHTAGS=wedding,boda,ceremonia
# Formato opcional: hashtag:id, separadas por coma (ej: wedding:17841405309211844)
INSTAGRAM_HASHTAG_IDS=

# Fallbacks legacy (migraciones/consultas antiguas). false por defecto; pon true SOLO durante migraciones puntuales
VITE_ENABLE_LEGACY_FALLBACKS=false

# Firebase
VITE_FIREBASE_API_KEY=tu_firebase_api_key
VITE_FIREBASE_AUTH_DOMAIN=tu_proyecto.firebaseapp.com
VITE_FIREBASE_PROJECT_ID=tu_proyecto
VITE_FIREBASE_STORAGE_BUCKET=tu_proyecto.firebasestorage.app
VITE_FIREBASE_MESSAGING_SENDER_ID=tu_messaging_id
VITE_FIREBASE_APP_ID=tu_app_id

# Backend base para scripts (scheduler / runTask)
BACKEND_BASE_URL=http://localhost:4004
# Tamaños y límites de parser
BODY_PARAMETER_LIMIT=1000
BODY_JSON_LIMIT=1mb
BODY_URLENCODED_LIMIT=2mb

# Timeout para llamadas HTTP salientes (ms)
AXIOS_TIMEOUT_MS=10000

# Allowlist de IPs (CSV) para endpoints admin (ej: /api/admin/metrics)
# Acepta IPv4 exactas o CIDR, ej: 127.0.0.1,192.168.0.0/16
ADMIN_IP_ALLOWLIST=

# Configuración acceso Administración Global
ADMIN_EMAIL=admin@planivia.net
# Usa bcrypt para la contraseña (recomendado). Ejemplo: ADMIN_PASSWORD_HASH=$2a$12$...
ADMIN_PASSWORD_HASH=
# Solo para desarrollo local si no usas hash
ADMIN_PASSWORD=
ADMIN_NAME=Administrador Planivia
ADMIN_REQUIRE_MFA=true
ADMIN_MFA_SECRET=
ADMIN_MFA_WINDOW_SECONDS=90
ADMIN_LOGIN_MAX_ATTEMPTS=5
ADMIN_LOGIN_WINDOW_MINUTES=60
ADMIN_LOGIN_LOCK_MINUTES=15
ADMIN_SESSION_TTL_MINUTES=720
# Dominios permitidos para login admin (CSV). El backend también acepta VITE_ADMIN_ALLOWED_DOMAINS.
ADMIN_ALLOWED_DOMAINS=planivia.net
VITE_ADMIN_ALLOWED_DOMAINS=planivia.net
# Soporte visible en pantalla de login admin
VITE_ADMIN_SUPPORT_EMAIL=soporte@planivia.net
VITE_ADMIN_SUPPORT_PHONE=+34 900 000 000
# Código MFA de prueba para E2E (opcional). Si se define, /api/admin/login generará este OTP.
ADMIN_MFA_TEST_CODE=123456


# Redacta PII en logs (emails, teléfonos, tokens): true/false/1/0
LOG_REDACT=false

# Retries y backoff para HTTP saliente
AXIOS_RETRY_COUNT=2
AXIOS_RETRY_BACKOFF_MS=250
AXIOS_RETRY_FACTOR=2
AXIOS_RETRY_BACKOFF_MAX_MS=5000

# Límite de tamaño específico para webhooks (bytes)
WEBHOOK_MAX_BYTES=262144

# WhatsApp Business (API – Twilio por defecto)
# Proveedor
WHATSAPP_PROVIDER=twilio
# Verificar firma de Twilio en webhook (recomendado true en prod)
TWILIO_SIGNATURE_CHECK=false
# Credenciales Twilio (no incluir el prefijo whatsapp: en FROM)
TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_WHATSAPP_FROM=+14155238886
# URL pública del webhook de estados (si no se define, usa BACKEND_BASE_URL)
# WHATSAPP_STATUS_CALLBACK_URL=https://mi-backend-publico.com/api/whatsapp/webhook/twilio
# Código de país por defecto para normalizar teléfonos a E.164 (+34 España)
DEFAULT_COUNTRY_CODE=+34
# Equivalente en frontend para generar deeplinks
VITE_DEFAULT_COUNTRY_CODE=+34

# Límite específico para webhook de WhatsApp (bytes). Si no se define, usa WEBHOOK_MAX_BYTES.
WHATSAPP_WEBHOOK_MAX_BYTES=
WEBHOOK_RATE_LIMIT_MAX=120
WHATSAPP_WEBHOOK_RATE_LIMIT_MAX=
MAILGUN_WEBHOOK_RATE_LIMIT_MAX=
WHATSAPP_WEBHOOK_IP_ALLOWLIST=
MAILGUN_WEBHOOK_IP_ALLOWLIST=

# Public wedding sites (subdomain hosting)
# If set, backend will serve wedding sites at https://<slug>.<PUBLIC_SITES_BASE_DOMAIN>
# Example: PUBLIC_SITES_BASE_DOMAIN=sites.planivia.net (requires wildcard DNS -> backend)
PUBLIC_SITES_BASE_DOMAIN=
PUBLIC_SITES_EXCLUDED_SUBDOMAINS=www,api,mg,mail,cdn,static,assets,admin

# Notificaciones (Automatización 1.2)
# Slack Incoming Webhook
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/xxx/yyy/zzz

# Tareas / Gantt
# Fecha de boda por defecto (fallback si no hay weddingInfo)
# Formato recomendado ISO (YYYY-MM-DD). También se acepta DD/MM/YYYY.
VITE_DEFAULT_WEDDING_DATE=2026-02-24

# SMTP para alertas por correo
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USER=user@example.com
SMTP_PASS=supersecreto
ALERT_EMAIL_TO=alerts@planivia.net
ALERT_EMAIL_FROM=alerts@planivia.net

# Métricas y observabilidad
# /metrics está protegido: requiere usuario admin autenticado (no token)
# Endpoint base para el dashboard de métricas en el frontend
VITE_METRICS_ENDPOINT=http://localhost:4004/api/admin/metrics
# Endpoint de ingesta de métricas para cliente (PerformanceMonitor)
VITE_METRICS_POST_ENDPOINT=http://localhost:4004/api/web-vitals
# Habilita envío de Web Vitals desde el frontend al backend
VITE_ENABLE_WEB_VITALS=true
VITE_ALLOW_SAMPLE_GUESTS=false

# Project Metrics Aggregator
# Intervalo del worker de agregado (ms). Prod recomendado: 900000 (15 min)
METRICS_AGGREGATOR_INTERVAL_MS=60000
# Credenciales BigQuery opcionales para export (JSON o Base64)
METRICS_BIGQUERY_SA=
METRICS_BIGQUERY_DATASET=project_metrics
METRICS_BIGQUERY_TABLE=daily

# Image Proxy
# Lista de hosts permitidos (CSV). Soporta comodines con prefijo '*.' o dominios con punto inicial
# Ejemplos: *.unsplash.com,images.example.com,.cdn.planivia.net
IMAGE_PROXY_ALLOWLIST=
IMAGE_PROXY_DENYLIST=
IMAGE_PROXY_MAX_BYTES=2097152
IMAGE_PROXY_ENFORCE_IMAGE_CT=true

# ================================
# BÚSQUEDA IA DE PROVEEDORES
# ================================

# OpenAI API (REQUERIDO para estructurar resultados)
OPENAI_API_KEY=sk-proj-...
OPENAI_PROJECT_ID=
# Modelo a usar (gpt-4o-mini es más económico, gpt-4-turbo más preciso)
OPENAI_MODEL=gpt-4o-mini

# Tavily Search API (RECOMENDADO - optimizada para IA)
# Obtén tu key gratis en: https://tavily.com/
# Incluye 1,000 búsquedas/mes gratis
TAVILY_API_KEY=tvly-...

# Google Custom Search API (Alternativa a Tavily)
# Solo necesario si usas VITE_SEARCH_PROVIDER=google
GOOGLE_SEARCH_API_KEY=
GOOGLE_SEARCH_CX=

# Frontend: Proveedor de búsqueda
# Opciones: 'tavily' (recomendado), 'google', o 'false' (solo GPT, datos ficticios)
VITE_SEARCH_PROVIDER=tavily
