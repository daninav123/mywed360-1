[{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\App.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\__tests__\\GuestItem.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\__tests__\\ProveedorBudgets.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\__tests__\\SeatingPlanRefactored.test.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'activeTab' is defined but never used. Allowed unused args must match /^_/u.","line":49,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":49,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Tests para el componente SeatingPlanRefactored\r\n * Valida la integraci√≥n y funcionalidad de los componentes modulares\r\n */\r\n\r\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\r\nimport { render, screen, fireEvent } from '@testing-library/react';\r\nimport SeatingPlanRefactored from '../components/seating/SeatingPlanRefactored';\r\n\r\n// Mock de dependencias\r\nvi.mock('../hooks/useSeatingPlan', () => ({\r\n  useSeatingPlan: () => ({\r\n    tab: 'ceremony',\r\n    setTab: vi.fn(),\r\n    syncStatus: { status: 'synced' },\r\n    hallSize: { width: 1800, height: 1200 },\r\n    areas: [],\r\n    tables: [],\r\n    seats: [],\r\n    selectedTable: null,\r\n    guests: [],\r\n    ceremonyConfigOpen: false,\r\n    setCeremonyConfigOpen: vi.fn(),\r\n    banquetConfigOpen: false,\r\n    setBanquetConfigOpen: vi.fn(),\r\n    spaceConfigOpen: false,\r\n    setSpaceConfigOpen: vi.fn(),\r\n    templateOpen: false,\r\n    setTemplateOpen: vi.fn(),\r\n    canvasRef: { current: null },\r\n    handleSelectTable: vi.fn(),\r\n    handleTableDimensionChange: vi.fn(),\r\n    toggleSelectedTableShape: vi.fn(),\r\n    setConfigTable: vi.fn(),\r\n    undo: vi.fn(),\r\n    redo: vi.fn(),\r\n    canUndo: false,\r\n    canRedo: false,\r\n    pushHistory: vi.fn(),\r\n    generateSeatGrid: vi.fn(),\r\n    generateBanquetLayout: vi.fn(),\r\n    exportPNG: vi.fn(),\r\n    exportPDF: vi.fn(),\r\n    saveHallDimensions: vi.fn()\r\n  })\r\n}));\r\n\r\nvi.mock('../components/seating/SeatingPlanTabs', () => ({\r\n  default: ({ activeTab, onTabChange }) => (\r\n    <div data-testid=\"seating-plan-tabs\">\r\n      <button onClick={() => onTabChange('ceremony')}>Ceremonia</button>\r\n      <button onClick={() => onTabChange('banquet')}>Banquete</button>\r\n    </div>\r\n  )\r\n}));\r\n\r\nvi.mock('../components/seating/SeatingPlanToolbar', () => ({\r\n  default: ({ onUndo, onRedo, onExportPNG }) => (\r\n    <div data-testid=\"seating-plan-toolbar\">\r\n      <button onClick={onUndo}>Deshacer</button>\r\n      <button onClick={onRedo}>Rehacer</button>\r\n      <button onClick={onExportPNG}>Exportar PNG</button>\r\n    </div>\r\n  )\r\n}));\r\n\r\nvi.mock('../components/seating/SeatingPlanCanvas', () => ({\r\n  default: ({ onSelectTable }) => (\r\n    <div data-testid=\"seating-plan-canvas\">\r\n      <button onClick={() => onSelectTable(1)}>Seleccionar Mesa 1</button>\r\n    </div>\r\n  )\r\n}));\r\n\r\nvi.mock('../components/seating/SeatingPlanSidebar', () => ({\r\n  default: ({ selectedTable }) => (\r\n    <div data-testid=\"seating-plan-sidebar\">\r\n      {selectedTable ? `Mesa ${selectedTable.id}` : 'Sin selecci√≥n'}\r\n    </div>\r\n  )\r\n}));\r\n\r\nvi.mock('../components/seating/SeatingPlanModals', () => ({\r\n  default: () => <div data-testid=\"seating-plan-modals\" />\r\n}));\r\n\r\ndescribe('SeatingPlanRefactored Component', () => {\r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n  });\r\n\r\n  it('should render all main components', () => {\r\n    render(<SeatingPlanRefactored />);\r\n\r\n    expect(screen.getByTestId('seating-plan-tabs')).toBeInTheDocument();\r\n    expect(screen.getByTestId('seating-plan-toolbar')).toBeInTheDocument();\r\n    expect(screen.getByTestId('seating-plan-canvas')).toBeInTheDocument();\r\n    expect(screen.getByTestId('seating-plan-sidebar')).toBeInTheDocument();\r\n    expect(screen.getByTestId('seating-plan-modals')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should have proper layout structure', () => {\r\n    render(<SeatingPlanRefactored />);\r\n\r\n    const container = screen.getByTestId('seating-plan-tabs').closest('.h-full');\r\n    expect(container).toHaveClass('flex', 'flex-col', 'bg-gray-50');\r\n  });\r\n\r\n  it('should render tabs and toolbar in header area', () => {\r\n    render(<SeatingPlanRefactored />);\r\n\r\n    const tabs = screen.getByTestId('seating-plan-tabs');\r\n    const toolbar = screen.getByTestId('seating-plan-toolbar');\r\n    \r\n    expect(tabs).toBeInTheDocument();\r\n    expect(toolbar).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render canvas and sidebar in main content area', () => {\r\n    render(<SeatingPlanRefactored />);\r\n\r\n    const canvas = screen.getByTestId('seating-plan-canvas');\r\n    const sidebar = screen.getByTestId('seating-plan-sidebar');\r\n    \r\n    expect(canvas).toBeInTheDocument();\r\n    expect(sidebar).toBeInTheDocument();\r\n  });\r\n\r\n  it('should handle tab changes', () => {\r\n    const mockSetTab = vi.fn();\r\n    \r\n    vi.mocked(require('../hooks/useSeatingPlan').useSeatingPlan).mockReturnValue({\r\n      ...require('../hooks/useSeatingPlan').useSeatingPlan(),\r\n      setTab: mockSetTab\r\n    });\r\n\r\n    render(<SeatingPlanRefactored />);\r\n\r\n    fireEvent.click(screen.getByText('Banquete'));\r\n    expect(mockSetTab).toHaveBeenCalledWith('banquet');\r\n  });\r\n\r\n  it('should integrate with all subcomponents correctly', () => {\r\n    render(<SeatingPlanRefactored />);\r\n\r\n    // Verificar que todos los componentes est√°n presentes\r\n    expect(screen.getByTestId('seating-plan-tabs')).toBeInTheDocument();\r\n    expect(screen.getByTestId('seating-plan-toolbar')).toBeInTheDocument();\r\n    expect(screen.getByTestId('seating-plan-canvas')).toBeInTheDocument();\r\n    expect(screen.getByTestId('seating-plan-sidebar')).toBeInTheDocument();\r\n    expect(screen.getByTestId('seating-plan-modals')).toBeInTheDocument();\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\__tests__\\accessibility.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\__tests__\\budgetEmailService.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\__tests__\\firestore.rules.collections.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\__tests__\\firestore.rules.exhaustive.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\__tests__\\firestore.rules.extended.test.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'collection' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":56,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":66}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { assertFails, assertSucceeds, initializeTestEnvironment } from '@firebase/rules-unit-testing';\r\nimport { readFileSync } from 'fs';\r\nimport { getFirestore, doc, setDoc, getDoc, deleteDoc, collection } from 'firebase/firestore';\r\nimport { beforeAll, afterAll, describe, test } from 'vitest';\r\n\r\nlet testEnv;\r\nconst PROJECT_ID = 'mywed360-test-extended';\r\n\r\nbeforeAll(async () => {\r\n  const rules = readFileSync(new URL('../../firestore.rules', import.meta.url), 'utf8');\r\n  testEnv = await initializeTestEnvironment({ projectId: PROJECT_ID, firestore: { rules } });\r\n\r\n  // Seed base data\r\n  await testEnv.withSecurityRulesDisabled(async (ctx) => {\r\n    const db = getFirestore(ctx.app);\r\n\r\n    // Wedding with single owner only (no plannerIds/assistantIds yet)\r\n    await setDoc(doc(db, 'weddings', 'w2'), {\r\n      ownerIds: ['owner2'],\r\n      name: 'Wedding 2'\r\n    });\r\n\r\n    // Wedding with all roles\r\n    await setDoc(doc(db, 'weddings', 'w3'), {\r\n      ownerIds: ['owner3'],\r\n      plannerIds: ['planner3'],\r\n      assistantIds: ['assistant3'],\r\n      name: 'Wedding 3'\r\n    });\r\n\r\n    // Invitation doc\r\n    await setDoc(doc(db, 'weddingInvitations', 'inv123'), {\r\n      weddingId: 'w3',\r\n      email: 'planner@example.com',\r\n      createdBy: 'owner3'\r\n    });\r\n\r\n\r\n  });\r\n});\r\n\r\nafterAll(async () => {\r\n  await testEnv.cleanup();\r\n});\r\n\r\nconst ctx = (uid) => uid ? testEnv.authenticatedContext(uid) : testEnv.unauthenticatedContext();\r\n\r\n// Helper\r\nconst weddingDoc = (db, id) => doc(db, 'weddings', id);\r\n\r\n// --- WEDDING CORE ---\r\n\r\ndescribe('Wedding document permissions', () => {\r\n  test('Owner can CREATE new wedding', async () => {\r\n    const db = getFirestore(ctx('newOwner').app);\r\n    await assertSucceeds(setDoc(weddingDoc(db, 'wNew'), { ownerIds: ['newOwner'], name: 'New W' }));\r\n  });\r\n\r\n  test('Planner cannot CREATE new top-level wedding', async () => {\r\n    const db = getFirestore(ctx('somePlanner').app);\r\n    await assertFails(setDoc(weddingDoc(db, 'plannerCreate'), { ownerIds: ['somePlanner'] }));\r\n  });\r\n\r\n  test('Owner can ADD planner to plannerIds', async () => {\r\n    const db = getFirestore(ctx('owner2').app);\r\n    await assertSucceeds(setDoc(weddingDoc(db, 'w2'), { plannerIds: ['planner2'] }, { merge: true }));\r\n  });\r\n\r\n  test('Planner can add THEMSELVES to plannerIds (invitation accepted)', async () => {\r\n    const db = getFirestore(ctx('plannerSelf').app);\r\n    // First seed doc without their uid\r\n    await testEnv.withSecurityRulesDisabled(async (admin) => {\r\n      await setDoc(weddingDoc(getFirestore(admin.app), 'selfAdd'), { ownerIds: ['ownerX'], plannerIds: [] });\r\n    });\r\n    await assertSucceeds(setDoc(weddingDoc(db, 'selfAdd'), { plannerIds: ['plannerSelf'] }, { merge: true }));\r\n  });\r\n\r\n  test('Planner cannot modify other fields while adding themselves', async () => {\r\n    const db = getFirestore(ctx('plannerBad').app);\r\n    await testEnv.withSecurityRulesDisabled(async (admin) => {\r\n      await setDoc(weddingDoc(getFirestore(admin.app), 'selfAddBad'), { ownerIds: ['ownerY'], plannerIds: [] });\r\n    });\r\n    await assertFails(setDoc(weddingDoc(db, 'selfAddBad'), { plannerIds: ['plannerBad'], name: 'Hack' }, { merge: true }));\r\n  });\r\n\r\n  test('Assistant cannot WRITE wedding doc', async () => {\r\n    const db = getFirestore(ctx('assistant3').app);\r\n    await assertFails(setDoc(weddingDoc(db, 'w3'), { title: 'try' }, { merge: true }));\r\n  });\r\n\r\n  test('Owner can DELETE wedding', async () => {\r\n    const db = getFirestore(ctx('owner3').app);\r\n    await assertSucceeds(deleteDoc(weddingDoc(db, 'w3')));\r\n  });\r\n\r\n  test('External user cannot READ wedding with missing plannerIds array', async () => {\r\n    const db = getFirestore(ctx('rand').app);\r\n    await assertFails(getDoc(weddingDoc(db, 'w2')));\r\n  });\r\n});\r\n\r\n// --- SUBCOLLECTIONS ---\r\n\r\ndescribe('Wedding subcollection permissions', () => {\r\n  test('Owner can CREATE task', async () => {\r\n    const db = getFirestore(ctx('owner2').app);\r\n    const taskRef = doc(db, 'weddings', 'w2', 'tasks', 'task1');\r\n    await assertSucceeds(setDoc(taskRef, { name: 't' }));\r\n  });\r\n\r\n  test('Planner added later can WRITE tasks', async () => {\r\n    const db = getFirestore(ctx('planner2').app);\r\n    const taskRef = doc(db, 'weddings', 'w2', 'tasks', 'task2');\r\n    await assertSucceeds(setDoc(taskRef, { name: 'plan' }));\r\n  });\r\n\r\n  test('Assistant cannot WRITE tasks', async () => {\r\n    const db = getFirestore(ctx('assistant3').app);\r\n    const taskRef = doc(db, 'weddings', 'w3', 'tasks', 'tBad');\r\n    await assertFails(setDoc(taskRef, { name: 'bad' }));\r\n  });\r\n});\r\n\r\n// --- INVITATIONS ---\r\n\r\ndescribe('weddingInvitations rules', () => {\r\n  test('Any auth user can CREATE invitation', async () => {\r\n    const db = getFirestore(ctx('ownerZ').app);\r\n    await assertSucceeds(setDoc(doc(db, 'weddingInvitations', 'invZ'), { weddingId: 'w2', email: 'p@example.com' }));\r\n  });\r\n\r\n  test('Unauthenticated cannot CREATE invitation', async () => {\r\n    const db = getFirestore(ctx(null).app);\r\n    await assertFails(setDoc(doc(db, 'weddingInvitations', 'invNo'), { weddingId: 'w2' }));\r\n  });\r\n});\r\n\r\n\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\__tests__\\firestore.rules.test.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'RulesTestEnvironment' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":66,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":86},{"ruleId":"no-unused-vars","severity":1,"message":"'collection' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":55},{"ruleId":"no-unused-vars","severity":1,"message":"'expect' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":47,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":53}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { assertFails, assertSucceeds, initializeTestEnvironment, RulesTestEnvironment } from '@firebase/rules-unit-testing';\r\nimport { readFileSync } from 'fs';\r\nimport { getFirestore, doc, setDoc, getDoc, collection } from 'firebase/firestore';\r\nimport { beforeAll, afterAll, describe, test, expect } from 'vitest';\r\n\r\nlet testEnv; /** @type {RulesTestEnvironment} */\r\n\r\nconst PROJECT_ID = 'mywed360-test';\r\n\r\nbeforeAll(async () => {\r\n  // Carga las reglas del archivo real del proyecto\r\n  const rules = readFileSync(new URL('../../firestore.rules', import.meta.url), 'utf8');\r\n\r\n  testEnv = await initializeTestEnvironment({\r\n    projectId: PROJECT_ID,\r\n    firestore: { rules }\r\n  });\r\n\r\n  // Semilla de datos: crear una boda con distintos roles\r\n  await testEnv.withSecurityRulesDisabled(async (ctx) => {\r\n    const db = getFirestore(ctx.app);\r\n\r\n    const weddingDoc = doc(db, 'weddings', 'w1');\r\n    await setDoc(weddingDoc, {\r\n      ownerIds: ['owner1'],\r\n      plannerIds: ['planner1'],\r\n      assistantIds: ['assistant1'],\r\n      name: 'Test Wedding'\r\n    });\r\n\r\n    // Subcolecci√≥n de tareas\r\n    await setDoc(doc(db, 'weddings', 'w1', 'tasks', 't1'), {\r\n      name: 'Reservar catering',\r\n      completed: false\r\n    });\r\n  });\r\n});\r\n\r\nafterAll(async () => {\r\n  await testEnv.cleanup();\r\n});\r\n\r\nconst getContext = (uid) => {\r\n  if (!uid) return testEnv.unauthenticatedContext();\r\n  return testEnv.authenticatedContext(uid);\r\n};\r\n\r\ndescribe('Reglas de Firestore - bodas', () => {\r\n  test('Owner puede leer y escribir su boda', async () => {\r\n    const ctx = getContext('owner1');\r\n    const db = getFirestore(ctx.app);\r\n\r\n    // Read\r\n    await assertSucceeds(getDoc(doc(db, 'weddings', 'w1')));\r\n    // Write (update un campo)\r\n    await assertSucceeds(setDoc(doc(db, 'weddings', 'w1'), { updatedBy: 'owner1' }, { merge: true }));\r\n  });\r\n\r\n  test('Planner puede leer y escribir su boda', async () => {\r\n    const ctx = getContext('planner1');\r\n    const db = getFirestore(ctx.app);\r\n    await assertSucceeds(getDoc(doc(db, 'weddings', 'w1')));\r\n    await assertSucceeds(setDoc(doc(db, 'weddings', 'w1'), { title: 'Planner edit' }, { merge: true }));\r\n  });\r\n\r\n  test('Assistant puede leer pero no escribir', async () => {\r\n    const ctx = getContext('assistant1');\r\n    const db = getFirestore(ctx.app);\r\n    await assertSucceeds(getDoc(doc(db, 'weddings', 'w1')));\r\n    await assertFails(setDoc(doc(db, 'weddings', 'w1'), { title: 'No allowed' }, { merge: true }));\r\n  });\r\n\r\n  test('Usuario externo no puede leer', async () => {\r\n    const ctx = getContext('randomUser');\r\n    const db = getFirestore(ctx.app);\r\n    await assertFails(getDoc(doc(db, 'weddings', 'w1')));\r\n  });\r\n\r\n  test('Planner puede leer y escribir subcolecci√≥n tasks', async () => {\r\n    const ctx = getContext('planner1');\r\n    const db = getFirestore(ctx.app);\r\n    await assertSucceeds(getDoc(doc(db, 'weddings', 'w1', 'tasks', 't1')));\r\n    await assertSucceeds(setDoc(doc(db, 'weddings', 'w1', 'tasks', 't1'), { completed: true }, { merge: true }));\r\n  });\r\n\r\n  test('Assistant puede leer pero no escribir subcolecci√≥n', async () => {\r\n    const ctx = getContext('assistant1');\r\n    const db = getFirestore(ctx.app);\r\n    await assertSucceeds(getDoc(doc(db, 'weddings', 'w1', 'tasks', 't1')));\r\n    await assertFails(setDoc(doc(db, 'weddings', 'w1', 'tasks', 't1'), { completed: true }, { merge: true }));\r\n  });\r\n});\r\n\r\ndescribe('Colecciones de diagn√≥stico', () => {\r\n  test('_conexion_prueba lectura/escritura sin auth', async () => {\r\n    const ctx = getContext(null); // no autenticado\r\n    const db = getFirestore(ctx.app);\r\n    await assertSucceeds(setDoc(doc(db, '_conexion_prueba', 'test'), { ok: true }));\r\n    await assertSucceeds(getDoc(doc(db, '_conexion_prueba', 'test')));\r\n  });\r\n\r\n  test('_test_connection lectura/escritura sin auth', async () => {\r\n    const ctx = getContext(null);\r\n    const db = getFirestore(ctx.app);\r\n    await assertSucceeds(setDoc(doc(db, '_test_connection', 'test'), { ok: true }));\r\n    await assertSucceeds(getDoc(doc(db, '_test_connection', 'test')));\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\__tests__\\useSeatingPlan.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\__tests__\\useSeatingPlan.undoRedo.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\__tests__\\useSupplierBudgets.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\Alert.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\AsyncWrapper.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\BanquetConfigModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\Button.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\Card.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\CeremonyConfigModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\ChairItem.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\ChatWidget.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":37,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":37,"endColumn":15},{"ruleId":"no-dupe-else-if","severity":2,"message":"This branch can never execute. Its condition is a duplicate or covered by previous conditions in the if-else-if chain.","line":497,"column":18,"nodeType":"LogicalExpression","messageId":"unexpected","endLine":497,"endColumn":42}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Star } from 'lucide-react';\r\nimport { motion } from 'framer-motion';\r\nimport { MessageSquare } from 'lucide-react';\r\nimport Spinner from './Spinner';\r\nimport { getBackendBase } from '../utils/backendBase';\r\nimport { toast } from 'react-toastify';\r\nimport { useAuth } from '../hooks/useAuthUnified';\r\n\r\n// --- Modo debug opcional ---\r\n// Act√≠valo desde la consola con: window.lovendaDebug = true\r\nconst chatDebug = (...args) => {\r\n  if (typeof window !== 'undefined' && window.lovendaDebug) {\r\n    // eslint-disable-next-line no-console\r\n    console.debug('[ChatWidget]', ...args);\r\n  }\r\n};\r\n\r\n// --- Configuraci√≥n de memoria conversacional ---\r\nconst MAX_MESSAGES = 50;        // Cu√°ntos mensajes ‚Äúfrescos‚Äù mantener en memoria corta\r\nconst SHORT_HISTORY = 6;        // Cu√°ntos mensajes recientes se env√≠an a la IA\r\n\r\n// Funci√≥n para normalizar texto de categor√≠a: elimina acentos y convierte a may√∫sculas\r\nconst normalizeCategory = (cat = 'OTROS') => cat.normalize('NFD').replace(/[^\\w\\s]|_/g, '').replace(/\\s+/g, '').toUpperCase();\r\n// Intenta adivinar la categor√≠a en base al t√≠tulo/descripcion de la tarea\r\nconst guessCategory = (title = '') => {\r\n  const t = title.toLowerCase();\r\n  if (/lugar|finca|sal[o√≥]n/.test(t)) return 'LUGAR';\r\n  if (/foto|fot[o√≥]graf/.test(t)) return 'FOTOGRAFO';\r\n  if (/m[u√∫]sica|dj|banda/.test(t)) return 'MUSICA';\r\n  if (/vestido|traje|vestuari|zapato/.test(t)) return 'VESTUARIO';\r\n  if (/catering|banquete|men[u√∫]/.test(t)) return 'CATERING';\r\n  return 'OTROS';\r\n};\r\n\r\nexport default function ChatWidget() {\r\n  const { user, getIdToken } = useAuth();\r\n  const [open, setOpen] = useState(() => { const saved = localStorage.getItem('chatOpen'); return saved ? JSON.parse(saved) : false; });\r\n  const [messages, setMessages] = useState(() => {\r\n    try {\r\n      return JSON.parse(localStorage.getItem('chatMessages') || '[]');\r\n    } catch {\r\n      return [];\r\n    }\r\n  });\r\n  const [summary, setSummary] = useState(() => {\r\n    try {\r\n      return localStorage.getItem('chatSummary') || '';\r\n    } catch {\r\n      return '';\r\n    }\r\n  });\r\n  const [input, setInput] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const toggleImportant = (idx) => {\r\n    setMessages(prev => {\r\n      const copy = [...prev];\r\n      copy[idx] = { ...copy[idx], important: !copy[idx].important };\r\n      if (copy[idx].important) {\r\n        try {\r\n          const notes = JSON.parse(localStorage.getItem('importantNotes') || '[]');\r\n          notes.push({ text: copy[idx].text, date: Date.now() });\r\n          localStorage.setItem('importantNotes', JSON.stringify(notes));\r\n          window.dispatchEvent(new Event('lovenda-important-note'));\r\n          toast.success('Nota marcada como importante');\r\n        } catch { /* ignore */ }\r\n      }\r\n      return copy;\r\n    });\r\n  };\r\n\r\n  useEffect(() => {\r\n    localStorage.setItem('chatOpen', JSON.stringify(open));\r\n  }, [open]);\r\n\r\n  // Persistir resumen entre sesiones\r\n  useEffect(() => {\r\n    localStorage.setItem('chatSummary', summary);\r\n  }, [summary]);\r\n\r\n  useEffect(() => {\r\n    try {\r\n      localStorage.setItem('chatMessages', JSON.stringify(messages));\r\n    } catch {/* ignore */}\r\n  }, [messages]);\r\n\r\n  // --- Utilidad para compactar mensajes y moverlos al resumen ---\r\n  const compactMessages = (arr) => {\r\n    if (arr.length <= MAX_MESSAGES) return arr;\r\n    const excess = arr.length - MAX_MESSAGES;\r\n    const toSummarize = arr.slice(0, excess);\r\n    const rest = arr.slice(excess);\r\n    const summaryPart = toSummarize.map(m => `${m.from === 'user' ? 'Usuario' : 'IA'}: ${m.text}`).join('\\n');\r\n    setSummary(prev => prev ? `${prev}\\n${summaryPart}` : summaryPart);\r\n    return rest;\r\n  };\r\n\r\n// Utilidad para aplicar comandos de la IA\r\nconst applyCommands = async (commands = []) => {\r\n  if (!commands.length) return;\r\n  let meetings = JSON.parse(localStorage.getItem('lovendaMeetings') || '[]');\r\n  let completed = JSON.parse(localStorage.getItem('tasksCompleted') || '{}');\r\n  let changed = false;\r\n\r\n  const findTaskIndex = (identifier) => {\r\n    const idxById = meetings.findIndex(m => m.id === identifier);\r\n    if (idxById !== -1) return idxById;\r\n    return meetings.findIndex(m => m.title?.toLowerCase() === identifier?.toLowerCase());\r\n  };\r\n\r\n  commands.forEach(async (cmd) => {\r\n    const { entity, action, payload = {} } = cmd;\r\n    if (entity === 'task' || entity === 'meeting') {\r\n      switch(action){\r\n      case 'add': {\r\n        // asegurar id √∫nico\r\n        const newId = payload.id || `ai-${Date.now()}`;\r\n        const startDate = payload.start ? new Date(payload.start) : new Date();\r\n        const endDate = payload.end ? new Date(payload.end) : startDate;\r\n        meetings.push({\r\n          id: newId,\r\n          title: payload.title || payload.name || (entity === 'task' ? 'Tarea' : 'Reuni√≥n'),\r\n          name: payload.title || payload.name || (entity === 'task' ? 'Tarea' : 'Reuni√≥n'),\r\n          desc: payload.desc || '',\r\n          start: startDate.toISOString(),\r\n          end: endDate.toISOString(),\r\n          type: entity,\r\n          category: normalizeCategory(payload.category || guessCategory(payload.title || payload.name || '')),\r\n        });\r\n        toast.success(entity === 'task' ? 'Tarea a√±adida' : 'Reuni√≥n a√±adida');\r\n        changed = true;\r\n        break;\r\n      }\r\n      case 'update':\r\n      case 'edit':\r\n      case 'editar':\r\n      case 'modificar': {\r\n        const idx = findTaskIndex(payload.id || payload.title);\r\n        if (idx !== -1){\r\n          meetings[idx] = { ...meetings[idx], ...payload };\r\n          // normalizar fechas si vienen en Date\r\n          if (meetings[idx].start instanceof Date) meetings[idx].start = meetings[idx].start.toISOString();\r\n          if (meetings[idx].end instanceof Date) meetings[idx].end = meetings[idx].end.toISOString();\r\n          toast.success('Tarea actualizada');\r\n          changed = true;\r\n        }\r\n        break;\r\n      }\r\n      case 'delete':\r\n        case 'remove': {\r\n        const before = meetings.length;\r\n        meetings = meetings.filter(m => !(m.id === payload.id || m.title?.toLowerCase() === payload.title?.toLowerCase()));\r\n        if (meetings.length < before){\r\n          toast.success('Tarea eliminada');\r\n          changed = true;\r\n        }\r\n        break;\r\n      }\r\n      case 'complete':\r\n      case 'done': {\r\n        if (payload.done === false) break;\r\n        const idx = findTaskIndex(payload.id || payload.title);\r\n        if (idx !== -1){\r\n          completed[meetings[idx].id] = true;\r\n          toast.success('Tarea marcada como completada');\r\n          changed = true;\r\n        }\r\n        break;\r\n      }\r\n      default:\r\n        break;\r\n      }\r\n    } else if (entity === 'guest') {\r\n      // ----- GUESTS LOGIC -----\r\n      let guests = JSON.parse(localStorage.getItem('lovendaGuests') || '[]');\r\n      let changedG = false;\r\n      const findGuestIdx = (identifier) => {\r\n        const idxById = guests.findIndex(g => g.id === identifier);\r\n        if (idxById !== -1) return idxById;\r\n        return guests.findIndex(g => g.name?.toLowerCase() === identifier?.toLowerCase());\r\n      };\r\n      switch(action){\r\n        case 'add': {\r\n          const newId = payload.id || `guest-${Date.now()}`;\r\n          guests.push({\r\n            id: newId,\r\n            name: payload.name || 'Invitado',\r\n            phone: payload.phone || '',\r\n            address: payload.address || '',\r\n            companion: payload.companion ?? payload.companions ?? 0,\r\n            table: payload.table || '',\r\n            response: payload.response || 'Pendiente'\r\n          });\r\n          toast.success('Invitado a√±adido');\r\n          changedG = true;\r\n          break;\r\n        }\r\n        case 'update':\r\n        case 'edit':\r\n        case 'editar':\r\n        case 'modificar': {\r\n          const idx = findGuestIdx(payload.id || payload.name);\r\n          if (idx !== -1) {\r\n            guests[idx] = { ...guests[idx], ...payload };\r\n            toast.success('Invitado actualizado');\r\n            changedG = true;\r\n          }\r\n          break;\r\n        }\r\n        case 'delete':\r\n        case 'remove': {\r\n          const before = guests.length;\r\n          guests = guests.filter(g => !(g.id === payload.id || g.name?.toLowerCase() === payload.name?.toLowerCase()));\r\n          if (guests.length < before) {\r\n            toast.success('Invitado eliminado');\r\n            changedG = true;\r\n          }\r\n          break;\r\n        }\r\n        default:\r\n          break;\r\n      }\r\n      if (changedG){\r\n        localStorage.setItem('lovendaGuests', JSON.stringify(guests));\r\n        window.dispatchEvent(new Event('lovenda-guests'));\r\n      }\r\n    } else if (entity === 'movement' || entity === 'movimiento' || entity === 'gasto' || entity === 'ingreso') {\r\n      // ----- MOVEMENTS LOGIC -----\r\n      let movements = JSON.parse(localStorage.getItem('lovendaMovements') || '[]');\r\n      let changedM = false;\r\n      const findMovIdx = (identifier) => {\r\n        const idxById = movements.findIndex(m => m.id === identifier);\r\n        if (idxById !== -1) return idxById;\r\n        return movements.findIndex(m => m.name?.toLowerCase() === identifier?.toLowerCase());\r\n      };\r\n      switch(action){\r\n        case 'add': {\r\n          const newId = payload.id || `mov-${Date.now()}`;\r\n          movements.push({\r\n            id: newId,\r\n            name: payload.concept || payload.name || 'Movimiento',\r\n            amount: Number(payload.amount) || 0,\r\n            date: payload.date || new Date().toISOString().slice(0,10),\r\n            type: payload.type === 'income' ? 'income' : 'expense'\r\n          });\r\n          toast.success('Movimiento a√±adido');\r\n          changedM = true;\r\n          break;\r\n        }\r\n        case 'update':\r\n        case 'edit':\r\n        case 'editar':\r\n        case 'modificar': {\r\n          const idx = findMovIdx(payload.id || payload.concept || payload.name);\r\n          if (idx !== -1) {\r\n            movements[idx] = { ...movements[idx], ...payload };\r\n            toast.success('Movimiento actualizado');\r\n            changedM = true;\r\n          }\r\n          break;\r\n        }\r\n        case 'delete':\r\n        case 'remove': {\r\n          const before = movements.length;\r\n          movements = movements.filter(m => !(m.id === payload.id || m.name?.toLowerCase() === (payload.concept||payload.name)?.toLowerCase()));\r\n          if (movements.length < before) {\r\n            toast.success('Movimiento eliminado');\r\n            changedM = true;\r\n          }\r\n          break;\r\n        }\r\n        default:\r\n          break;\r\n      }\r\n      if (changedM){\r\n        localStorage.setItem('lovendaMovements', JSON.stringify(movements));\r\n        window.dispatchEvent(new Event('lovenda-movements'));\r\n      }\r\n    } else if (entity === 'supplier') {\r\n      // ----- SUPPLIER SEARCH LOGIC -----\r\n      if (action === 'search') {\r\n        const query = payload.query || payload.q || payload.keyword || payload.term || '';\r\n        if (query) {\r\n          try {\r\n            const apiBase = import.meta.env.VITE_BACKEND_URL || (window.location.hostname === 'localhost' ? 'http://localhost:3001' : 'https://api.lovenda.app');\r\n            const resp = await fetch(`${apiBase}/api/ai/search-suppliers?q=${encodeURIComponent(query)}`);\r\n            const dataS = await resp.json();\r\n            if (dataS.results) {\r\n              localStorage.setItem('lovendaSuppliers', JSON.stringify(dataS.results));\r\n              window.dispatchEvent(new Event('lovenda-suppliers'));\r\n              toast.success(`Encontrados ${dataS.results.length} proveedores`);\r\n            } else {\r\n              toast.info('No se encontraron proveedores');\r\n            }\r\n          } catch (err) {\r\n            toast.error('Error buscando proveedores');\r\n          }\r\n        }\r\n      }\r\n    } else if (entity === 'table') {\r\n      // ----- TABLE MOVE LOGIC -----\r\n      let guests = JSON.parse(localStorage.getItem('lovendaGuests') || '[]');\r\n      let changedT = false;\r\n      const idx = guests.findIndex(g => g.id === payload.guestId || g.id === payload.guest || g.name?.toLowerCase() === (payload.guestName||payload.name||payload.guest)?.toLowerCase());\r\n      if (idx !== -1 && payload.table) {\r\n        guests[idx].table = payload.table;\r\n        toast.success(`Invitado movido a mesa ${payload.table}`);\r\n        changedT = true;\r\n      }\r\n      if (changedT){\r\n        localStorage.setItem('lovendaGuests', JSON.stringify(guests));\r\n        window.dispatchEvent(new Event('lovenda-guests'));\r\n      }\r\n    } else if (entity === 'config') {\r\n      // ----- CONFIG LOGIC -----\r\n      let profile = {};\r\n      try { profile = JSON.parse(localStorage.getItem('lovendaProfile') || '{}'); } catch { profile = {}; }\r\n      profile = { ...profile };\r\n      if (!profile.weddingInfo) profile.weddingInfo = {};\r\n      // merge payload into weddingInfo at top level too (for generic)\r\n      profile.weddingInfo = { ...profile.weddingInfo, ...payload };\r\n      Object.assign(profile, payload.root || {});\r\n      localStorage.setItem('lovendaProfile', JSON.stringify(profile));\r\n      window.dispatchEvent(new Event('lovenda-profile'));\r\n      toast.success('Configuraci√≥n actualizada');\r\n    }\r\n  });\r\n\r\n  if (changed){\r\n    localStorage.setItem('lovendaMeetings', JSON.stringify(meetings));\r\n    localStorage.setItem('tasksCompleted', JSON.stringify(completed));\r\n    window.dispatchEvent(new Event('lovenda-tasks'));\r\n  }\r\n};\r\n\r\nconst sendMessage = async () => {\r\n    if (!input) return;\r\n    const userMsg = { from: 'user', text: input };\r\n    const currentMsgs = compactMessages([...messages, userMsg]);\r\n    setMessages(currentMsgs);\r\n    setInput('');\r\n    setLoading(true);\r\n    let timeoutId;\r\n    try {\r\n      // Obtener URL base del backend (centralizado en utils)\r\n      const apiBase = getBackendBase();\r\n      chatDebug('Usando backend en:', apiBase);\r\n      \r\n      \r\n      const endpoint = `${apiBase.replace(/\\/$/, '')}/api/ai/parse-dialog`;\r\n      chatDebug('Llamando a la API IA en:', endpoint);\r\n      toast.info('Conectando con IA...', { autoClose: 2000 });\r\n      const fetchStart = performance.now();\r\n      \r\n      const recent = currentMsgs.slice(-SHORT_HISTORY).map(m => ({ role: m.from === 'user' ? 'user' : 'assistant', content: m.text }));\r\n      const history = summary ? [{ role: 'system', content: summary }, ...recent] : recent;\r\n      \r\n      // Implementar timeout para evitar esperas indefinidas\r\n      const controller = new AbortController();\r\n      timeoutId = setTimeout(() => {\r\n        controller.abort();\r\n        console.error('Timeout en la llamada a la API de IA');\r\n        toast.error('La IA est√° tardando demasiado. Reintentando con respuesta local...');\r\n      }, 30000); // 30 segundos m√°ximo para mejor UX\r\n      \r\n      // Obtener token de autenticaci√≥n usando el sistema unificado\r\n      const token = getIdToken ? await getIdToken() : null;\r\n      if (!token) {\r\n        throw new Error('No se pudo generar el token de autenticaci√≥n');\r\n      }\r\n      \r\n      const response = await fetch(endpoint, {\r\n        method: 'POST',\r\n        headers: { \r\n          'Content-Type': 'application/json',\r\n          'Accept': 'application/json',\r\n          'Authorization': `Bearer ${token}`\r\n        },\r\n        body: JSON.stringify({ text: input, history }),\r\n        signal: controller.signal\r\n      });\r\n      \r\n      clearTimeout(timeoutId);\r\n      chatDebug('Duraci√≥n petici√≥n IA:', (performance.now() - fetchStart).toFixed(0), 'ms');\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(`Error de API: ${response.status} ${response.statusText}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      \r\n      // Debug: Log completo de la respuesta del backend\r\n      console.log('ü§ñ Respuesta completa del backend IA:', data);\r\n      chatDebug('Respuesta del backend:', JSON.stringify(data, null, 2));\r\n\r\n      // --- Procesar comandos si existen ---\r\n      if (data.extracted?.commands?.length) {\r\n        await applyCommands(data.extracted.commands);\r\n      }\r\n\r\n\r\n      // --- Persistir invitados extra√≠dos ---\r\n      if (data.extracted?.guests?.length) {\r\n        const stored = JSON.parse(localStorage.getItem('lovendaGuests') || '[]');\r\n        let nextId = stored.length ? Math.max(...stored.map(g => g.id)) + 1 : 1;\r\n        const mapped = data.extracted.guests.map(g => ({\r\n          id: nextId++,\r\n          name: g.name || 'Invitado',\r\n          phone: g.phone || '',\r\n          address: g.address || '',\r\n          companion: g.companions || 0,\r\n          table: g.table || '',\r\n          response: 'Pendiente'\r\n        }));\r\n        const updated = [...stored, ...mapped];\r\n        localStorage.setItem('lovendaGuests', JSON.stringify(updated));\r\n        window.dispatchEvent(new Event('lovenda-guests'));\r\n        toast.success(`${mapped.length} invitado${mapped.length>1?'s':''} a√±adido${mapped.length>1?'s':''}`);\r\n      }\r\n\r\n      // --- Persistir tareas extra√≠das ---\r\n      if (data.extracted?.tasks?.length) {\r\n        const storedMeetings = JSON.parse(localStorage.getItem('lovendaMeetings') || '[]');\r\n        let nextId = storedMeetings.length ? Date.now() : Date.now();\r\n        const mappedT = data.extracted.tasks.map(t => {\r\n          // Priorizar campo \"due\" (ISO), luego date/start/end si vienen de la IA\r\n          const dueIso = t.due || t.date || t.start || t.end;\r\n          const startDate = dueIso ? new Date(dueIso) : new Date();\r\n          const endDate = t.end ? new Date(t.end) : startDate;\r\n          return {\r\n            id: `ai-${nextId++}`,\r\n            title: t.title || t.name || 'Tarea',\r\n            name: t.title || t.name || 'Tarea',\r\n            desc: t.desc || '',\r\n            start: startDate,\r\n            end: endDate,\r\n            type: 'meeting',\r\n            category: normalizeCategory(t.category || 'OTROS'),\r\n          };\r\n        });\r\n        const updatedM = [...storedMeetings, ...mappedT];\r\n        localStorage.setItem('lovendaMeetings', JSON.stringify(updatedM));\r\n        window.dispatchEvent(new Event('lovenda-tasks'));\r\n        window.dispatchEvent(new Event('lovenda-meetings'));\r\n        toast.success(`${mappedT.length} tarea${mappedT.length>1?'s':''} a√±adida${mappedT.length>1?'s':''}`);\r\n      }\r\n\r\n      // --- Persistir reuniones extra√≠das ---\r\n      if (data.extracted?.meetings?.length) {\r\n        const storedMeetings = JSON.parse(localStorage.getItem('lovendaMeetings') || '[]');\r\n        let nextId = Date.now();\r\n        const mappedR = data.extracted.meetings.map(r => {\r\n          const startIso = r.start || r.date || r.when || r.begin;\r\n          const endIso = r.end || r.until || startIso;\r\n          const startDate = startIso ? new Date(startIso) : new Date();\r\n          const endDate = endIso ? new Date(endIso) : startDate;\r\n          return {\r\n            id: `ai-${nextId++}`,\r\n            title: r.title || r.name || 'Reuni√≥n',\r\n            name: r.title || r.name || 'Reuni√≥n',\r\n            desc: r.desc || r.description || '',\r\n            start: startDate,\r\n            end: endDate,\r\n            type: 'meeting',\r\n            category: normalizeCategory(r.category || 'OTROS'),\r\n          };\r\n        });\r\n        const updatedR = [...storedMeetings, ...mappedR];\r\n        localStorage.setItem('lovendaMeetings', JSON.stringify(updatedR));\r\n        window.dispatchEvent(new Event('lovenda-tasks'));\r\n        window.dispatchEvent(new Event('lovenda-meetings'));\r\n        toast.success(`${mappedR.length} reuni√≥n${mappedR.length>1?'es':''} a√±adida${mappedR.length>1?'s':''}`);\r\n      }\r\n\r\n      // --- Persistir movimientos extra√≠dos ---\r\n      const extMovs = data.extracted?.movements || data.extracted?.budgetMovements;\r\n      if (extMovs?.length) {\r\n        const storedMov = JSON.parse(localStorage.getItem('lovendaMovements') || '[]');\r\n        let nextId = storedMov.length ? Date.now() : Date.now();\r\n        const mappedMov = extMovs.map(m => ({\r\n          id: `mov-${nextId++}`,\r\n          name: m.concept || m.name || 'Movimiento',\r\n          amount: Number(m.amount) || 0,\r\n          date: m.date || new Date().toISOString().slice(0,10),\r\n          type: m.type === 'income' ? 'income' : 'expense'\r\n        }));\r\n        const updatedMov = [...storedMov, ...mappedMov];\r\n        localStorage.setItem('lovendaMovements', JSON.stringify(updatedMov));\r\n        window.dispatchEvent(new Event('lovenda-movements'));\r\n        toast.success(`${mappedMov.length} movimiento${mappedMov.length>1?'s':''} a√±adido${mappedMov.length>1?'s':''}`);\r\n      }\r\n      let text;\r\n      // Manejar respuesta del backend (exitosa o con error)\r\n      if (data.reply) {\r\n        text = data.reply;\r\n      } else if (data.error && data.reply) {\r\n        // Backend devolvi√≥ error pero con mensaje de respuesta\r\n        text = data.reply;\r\n        console.warn('Backend AI error:', data.error, data.details);\r\n      } else if (data.extracted && Object.keys(data.extracted).length) {\r\n        text = 'Datos extra√≠dos:\\n' + JSON.stringify(data.extracted, null, 2);\r\n      } else if (data.error) {\r\n        text = 'Error: ' + data.error;\r\n        console.error('Backend AI error:', data.error, data.details);\r\n      } else {\r\n        text = 'No se detectaron datos para extraer. ¬øPuedes darme m√°s detalles?';\r\n      }\r\n      const botMsg = { from: 'bot', text };\r\n      setMessages(prev => compactMessages([...prev, botMsg]));\r\n    } catch (error) {\r\n      console.error('Error en chat de IA:', error);\r\n      // Respuesta de emergencia local cuando falla la conexi√≥n con el backend\r\n      let errMsg;\r\n      if (error.name === 'AbortError' || error.message.includes('Timeout') || error.message.includes('abort')) {\r\n        console.error('Timeout en la llamada a la API de IA:', error.message);\r\n        errMsg = { \r\n          from: 'assistant', \r\n          text: 'Parece que hay problemas de conexi√≥n con el servidor. Puedo ayudarte con consultas b√°sicas sobre tu boda mientras se restablece la conexi√≥n. ¬øQu√© deseas saber?' \r\n        };\r\n        toast.error('Tiempo de espera agotado', { autoClose: 3000 });\r\n      } else if (error.message.includes('fetch') || error.message.includes('network')) {\r\n        console.error('Error de red en la llamada a la API de IA:', error.message);\r\n        errMsg = { \r\n          from: 'system', \r\n          text: `No se pudo conectar con el servidor de IA. Por favor, verifica tu conexi√≥n y vuelve a intentarlo.` \r\n        };\r\n        toast.error('Error de conexi√≥n', { autoClose: 3000 });\r\n      } else {\r\n        console.error('Error gen√©rico en la API de IA:', error.message);\r\n        errMsg = { from: 'system', text: `Ha ocurrido un error: ${error.message}` };\r\n        toast.error('Error en la comunicaci√≥n', { autoClose: 3000 });\r\n      }\r\n      \r\n      setMessages(prev => [...prev, errMsg]);\r\n    } finally {\r\n      clearTimeout(timeoutId);\r\n      setLoading(false);\r\n    }\r\n    \r\n  };\r\n\r\n  return (\r\n    <>\r\n      {open && (\r\n        <div className=\"fixed bottom-20 right-6 w-80 h-96 bg-white shadow-lg rounded-lg flex flex-col overflow-hidden z-50\">\r\n          <div className=\"bg-blue-600 text-white p-2 flex items-center\">\r\n            <MessageSquare className=\"mr-2\" /> Chat IA\r\n          </div>\r\n          <div className=\"flex-1 p-2 overflow-y-auto relative\">\r\n                          {loading && (\r\n              <div className=\"absolute inset-0 flex items-center justify-center bg-white bg-opacity-75\">\r\n                <Spinner />\r\n              </div>\r\n            )}\r\n            {messages.map((m, i) => (\r\n              <div\r\n                key={i}\r\n                className={`mb-2 ${m.from === 'user' ? 'text-right' : 'text-left'}`}\r\n              >\r\n                <span className=\"inline-block p-2 rounded bg-gray-200 mr-1\">{m.text}</span>\r\n                <button onClick={() => toggleImportant(i)} className=\"align-middle\" title={m.important ? 'Marcado como importante' : 'Marcar como importante'}>\r\n                  <Star size={16} className={m.important ? 'text-yellow-400 fill-yellow-400' : 'text-gray-400'} />\r\n                </button>\r\n              </div>\r\n            ))}\r\n          </div>\r\n          <div className=\"p-2 flex\">\r\n            <input aria-label=\"Mensaje de chat\"\r\n              type=\"text\"\r\n              value={input}\r\n              onChange={e => setInput(e.target.value)}\r\n              onKeyDown={e => { if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); sendMessage(); } }}\r\n              className=\"flex-1 border rounded px-2 py-1\"\r\n              placeholder=\"Escribe...\"\r\n            />\r\n            <motion.button onClick={sendMessage} aria-label=\"Enviar mensaje\" className=\"ml-2 bg-blue-600 text-white px-3 rounded\" disabled={loading}>\r\n              Enviar\r\n            </motion.button>\r\n          </div>\r\n        </div>\r\n      )}\r\n      <motion.button\r\n        onClick={() => setOpen(!open)} aria-label={open ? \"Cerrar chat\" : \"Abrir chat\"} whileHover={{ scale: 1.1 }} whileTap={{ scale: 0.9 }}\r\n        className=\"fixed bottom-6 right-6 bg-blue-600 text-white p-4 rounded-full shadow-lg z-50\"\r\n      >\r\n        <MessageSquare />\r\n      </motion.button>\r\n    </>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\DarkModeToggle.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\DefaultAvatar.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\DiagnosticPanel.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\EmailInsights.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\EmailNotification.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'navigate' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":14,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":17},{"ruleId":"react/no-unknown-property","severity":2,"message":"Unknown property 'jsx' found","line":108,"column":14,"nodeType":"JSXAttribute","messageId":"unknownProp","endLine":108,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { getMails, initEmailService } from '../services/EmailService';\r\nimport { loadData } from '../services/SyncService';\r\n\r\n/**\r\n * Componente que muestra una notificaci√≥n de nuevos correos recibidos\r\n * y permite navegar directamente al buz√≥n\r\n */\r\nexport default function EmailNotification() {\r\n  const [unreadCount, setUnreadCount] = useState(0);\r\n  const [showNotification, setShowNotification] = useState(false);\r\n  const [serviceInitialized, setServiceInitialized] = useState(false);\r\n  const navigate = useNavigate();\r\n  \r\n  // Comprobar correos no le√≠dos\r\n  useEffect(() => {\r\n    async function checkUnreadMails() {\r\n      try {\r\n        // Inicializar servicio de email una sola vez cuando tengamos perfil\r\n        if (!serviceInitialized) {\r\n          const profile = await loadData('lovendaProfile', {});\r\n          if (profile && Object.keys(profile).length) {\r\n            initEmailService(profile);\r\n            setServiceInitialized(true);\r\n          } else {\r\n            // Si no hay perfil a√∫n, salir y reintentar en el pr√≥ximo ciclo\r\n            return;\r\n          }\r\n        }\r\n\r\n        // Una vez inicializado, obtener correos de la bandeja de entrada\r\n        const inboxMails = await getMails('inbox');\r\n\r\n        // Contar los no le√≠dos\r\n        const unread = inboxMails.filter(mail => !mail.read).length;\r\n\r\n        // Actualizar estado\r\n        setUnreadCount(unread);\r\n        setShowNotification(unread > 0);\r\n      } catch (error) {\r\n        console.error('Error al comprobar correos nuevos:', error);\r\n      }\r\n    }\r\n\r\n    // Comprobar al inicio\r\n    checkUnreadMails();\r\n\r\n    // Comprobar cada minuto\r\n    const intervalId = setInterval(checkUnreadMails, 60000);\r\n\r\n    return () => clearInterval(intervalId);\r\n  }, [serviceInitialized]);\r\n  \r\n  // Ocultar la notificaci√≥n despu√©s de un tiempo\r\n  useEffect(() => {\r\n    if (showNotification) {\r\n      const timeoutId = setTimeout(() => {\r\n        setShowNotification(false);\r\n      }, 10000); // 10 segundos\r\n      \r\n      return () => clearTimeout(timeoutId);\r\n    }\r\n  }, [showNotification]);\r\n  \r\n  // Si no hay correos no le√≠dos, no mostrar nada\r\n  if (unreadCount === 0 || !showNotification) {\r\n    return null;\r\n  }\r\n  \r\n  return (\r\n    <div className=\"fixed bottom-4 right-4 bg-white rounded-lg shadow-lg p-4 max-w-xs z-50 border-l-4 border-blue-500 animate-bounce-once\">\r\n      <div className=\"flex items-center\">\r\n        <div className=\"mr-2\">\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6 text-blue-500\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\" />\r\n          </svg>\r\n        </div>\r\n        <div className=\"flex-1\">\r\n          <h4 className=\"font-bold text-gray-800\">\r\n            {unreadCount === 1 \r\n              ? 'Tienes un nuevo mensaje' \r\n              : `Tienes ${unreadCount} mensajes nuevos`}\r\n          </h4>\r\n          <p className=\"text-sm text-gray-600\">\r\n            Pulsa aqu√≠ para ver tu bandeja de entrada\r\n          </p>\r\n        </div>\r\n        <button \r\n          onClick={(e) => {\r\n            e.stopPropagation();\r\n            setShowNotification(false);\r\n          }} \r\n          className=\"text-gray-400 hover:text-gray-600\"\r\n        >\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n          </svg>\r\n        </button>\r\n      </div>\r\n      <div \r\n        onClick={() => alert('Funcionalidad de buz√≥n temporalmente no disponible')} \r\n        className=\"absolute inset-0 cursor-pointer\"\r\n        aria-hidden=\"true\"\r\n      />\r\n      \r\n      {/* Estilos para la animaci√≥n de rebote */}\r\n      <style jsx=\"true\">{`\r\n        @keyframes bounce-once {\r\n          0%, 100% { transform: translateY(0); }\r\n          50% { transform: translateY(-10px); }\r\n        }\r\n        .animate-bounce-once {\r\n          animation: bounce-once 1s ease-in-out;\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\FreeDrawCanvas.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'pt' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":122,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":122,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useRef, useState, useEffect } from 'react';\r\n\r\n/**\r\n * FreeDrawCanvas\r\n * Simple freehand drawing canvas that captures pointer strokes, smooths them with Chaikin algorithm,\r\n * and renders the smoothed path as SVG.\r\n * Props:\r\n *   onFinalize(points) => called when user double-clicks / presses Finish to commit current stroke\r\n */\r\nexport default function FreeDrawCanvas({ className = '', style = {}, strokeColor = '#3b82f6', scale = 1, offset = { x: 0, y: 0 }, areas = [], drawMode = 'free', onFinalize, onDeleteArea = () => {}, onUpdateArea = () => {} }) {\r\n  const svgRef = useRef(null);\r\n  const [points, setPoints] = useState([]);\r\n  const [drawing, setDrawing] = useState(false);\r\n  // Estado para mostrar la regla mientras se dibuja\r\n  const [cursorPos, setCursorPos] = useState(null); // posici√≥n del cursor dentro del SVG\r\n  const [segLength, setSegLength] = useState(null); // longitud del segmento actual en cm\r\n  const startRef = useRef(null);\r\n\r\n  // Detectar cambio de herramienta para guardar per√≠metro autom√°ticamente\r\n  const prevDrawModeRef = useRef(drawMode);\r\n  useEffect(() => {\r\n    const prev = prevDrawModeRef.current;\r\n    // Si salimos del modo 'boundary', guardar el per√≠metro en curso\r\n    if (prev === 'boundary' && drawMode !== 'boundary') {\r\n      if (points.length >= 3) {\r\n        const closed = [...points, points[0]]; // cerrar pol√≠gono\r\n        onFinalize && onFinalize(closed);\r\n      }\r\n      // Limpiar estado temporal\r\n      setPoints([]);\r\n      setDrawing(false);\r\n    }\r\n    prevDrawModeRef.current = drawMode;\r\n  }, [drawMode]);\r\n\r\n  const toSvgPoint = (e) => {\r\n    const svg = svgRef.current;\r\n    const rect = svg.getBoundingClientRect();\r\n    // adjust for current transform\r\n    return {\r\n      x: (e.clientX - rect.left - offset.x) / scale,\r\n      y: (e.clientY - rect.top - offset.y) / scale,\r\n    };\r\n  };\r\n\r\n  // Chaikin smoothing ‚Äì one iteration\r\n  const smooth = (pts) => {\r\n    if (pts.length < 2) return pts;\r\n    const out = [];\r\n    for (let i = 0; i < pts.length - 1; i++) {\r\n      const p0 = pts[i];\r\n      const p1 = pts[i + 1];\r\n      out.push({ x: 0.75 * p0.x + 0.25 * p1.x, y: 0.75 * p0.y + 0.25 * p1.y });\r\n      out.push({ x: 0.25 * p0.x + 0.75 * p1.x, y: 0.25 * p0.y + 0.75 * p1.y });\r\n    }\r\n    return out;\r\n  };\r\n\r\n  const getPathD = (pts) => {\r\n    if (!pts.length) return '';\r\n    const d = [`M ${pts[0].x} ${pts[0].y}`];\r\n    for (let i = 1; i < pts.length; i++) d.push(`L ${pts[i].x} ${pts[i].y}`);\r\n    return d.join(' ');\r\n  };\r\n\r\n  const handlePointerDown = (e) => {\r\n    e.preventDefault();\r\n    const pt = toSvgPoint(e);\r\n    \r\n    if (drawMode === 'line') {\r\n      setDrawing(true);\r\n      setPoints([pt]);\r\n      return;\r\n    }\r\n    if (drawMode === 'boundary') {\r\n      // Modo per√≠metro: siempre agregar punto, mantener drawing activo\r\n      if (points.length === 0) {\r\n        setDrawing(true);\r\n        setPoints([pt]);\r\n      } else {\r\n        // Agregar punto al per√≠metro existente\r\n        setPoints(prev => [...prev, pt]);\r\n      }\r\n      return;\r\n    }\r\n    if (drawMode === 'rect') {\r\n      setDrawing(true);\r\n      startRef.current = pt;\r\n      setPoints([pt]);\r\n      return;\r\n    }\r\n    if (drawMode === 'free' || drawMode === 'curve') {\r\n      setDrawing(true);\r\n      setPoints([pt]);\r\n    }\r\n  };\r\n\r\n  const handlePointerMove = (e) => {\r\n    // Actualizar posici√≥n del cursor relativa al SVG\r\n    const svg = svgRef.current;\r\n    const rect = svg.getBoundingClientRect();\r\n    setCursorPos({ x: e.clientX - rect.left, y: e.clientY - rect.top });\r\n\r\n    // Punto actual en coordenadas de dibujo (cm)\r\n    const curPt = toSvgPoint(e);\r\n    // Punto previo para calcular distancia\r\n    const prevPt = points.length ? points[points.length - 1] : curPt;\r\n    const dx = curPt.x - prevPt.x;\r\n    const dy = curPt.y - prevPt.y;\r\n    setSegLength(Math.sqrt(dx * dx + dy * dy));\r\n\r\n    if (!drawing) return;\r\n    \r\n    if (drawMode === 'line') {\r\n      const pt = toSvgPoint(e);\r\n      setPoints(prev => (prev.length === 1 ? [prev[0], pt] : [prev[0], pt]));\r\n      return;\r\n    }\r\n    if (drawMode === 'boundary') {\r\n      // En modo per√≠metro, mostrar l√≠nea de preview al cursor\r\n      if (points.length > 0) {\r\n        const pt = toSvgPoint(e);\r\n        // No modificar los puntos existentes, solo mostrar preview\r\n        // El preview se maneja en el render\r\n      }\r\n      return;\r\n    }\r\n    if (drawMode === 'rect') {\r\n      const cur = toSvgPoint(e);\r\n      const start = startRef.current;\r\n      if (!start) return;\r\n      const rectPts = [\r\n        start,\r\n        { x: cur.x, y: start.y },\r\n        cur,\r\n        { x: start.x, y: cur.y },\r\n        start,\r\n      ];\r\n      setPoints(rectPts);\r\n      return;\r\n    }\r\n    if (drawMode === 'free' || drawMode === 'curve') {\r\n      const pt = toSvgPoint(e);\r\n      setPoints(prev => [...prev, pt]);\r\n    }\r\n  };\r\n\r\n  const handlePointerUp = (e) => {\r\n    if (!drawing) return;\r\n    if (drawMode === 'line') {\r\n      const pt = toSvgPoint(e);\r\n      const line = points.length === 2 ? points : [points[0], pt];\r\n      onFinalize && onFinalize(line);\r\n      setPoints([]);\r\n      setDrawing(false);\r\n      // Reiniciar regla\r\n      setCursorPos(null);\r\n      setSegLength(null);\r\n      return;\r\n    }\r\n    if (drawMode === 'rect') {\r\n      if (points.length >= 4) {\r\n        onFinalize && onFinalize(points);\r\n      }\r\n      setPoints([]);\r\n      startRef.current = null;\r\n      setDrawing(false);\r\n    // Reiniciar regla\r\n    setCursorPos(null);\r\n    setSegLength(null);\r\n      return;\r\n    }\r\n    // Para freehand / curva simplemente detenemos la captura; la finalizaci√≥n ser√° mediante doble clic\r\n    setDrawing(false);\r\n    // Reiniciar regla\r\n    setCursorPos(null);\r\n    setSegLength(null);\r\n  };\r\n\r\n  const handleDoubleClick = () => {\r\n    console.log('FreeDrawCanvas - handleDoubleClick:', { drawMode, pointsLength: points.length });\r\n    if (drawMode === 'boundary') {\r\n      // Cerrar visualmente el pol√≠gono pero NO guardar; se guardar√° al cambiar de herramienta\r\n      if (points.length >= 3) {\r\n        const closedPolygon = [...points, points[0]];\r\n        setPoints(closedPolygon);\r\n        setDrawing(false);\r\n      }\r\n      return;\r\n    }\r\n    if (drawMode === 'free' || drawMode === 'curve') {\r\n      if (points.length > 2) {\r\n        const smoothed = smooth(points);\r\n        onFinalize && onFinalize(smoothed);\r\n        setPoints([]);\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={`relative w-full h-full ${className}`} style={style}>\r\n      <svg\r\n      ref={svgRef}\r\n      className={`w-full h-full ${className}`}\r\n      style={style}\r\n      onPointerDown={handlePointerDown}\r\n      onPointerMove={handlePointerMove}\r\n      onPointerUp={handlePointerUp}\r\n      onDoubleClick={handleDoubleClick}\r\n      onContextMenu={(e) => e.preventDefault()}\r\n    >\r\n      {/* √Åreas existentes */}\r\n      <g transform={`translate(${offset.x} ${offset.y}) scale(${scale})`}>\r\n        {areas.map((poly, idx) => {\r\n          console.log('FreeDrawCanvas - renderizando √°rea:', idx, poly);\r\n          return (\r\n            <path\r\n              key={idx}\r\n              d={getPathD(poly)}\r\n              stroke=\"#10b981\"\r\n              strokeWidth={2}\r\n              fill=\"none\"\r\n              onPointerDown={drawMode === 'erase' ? (e) => { e.stopPropagation(); onDeleteArea(idx); } : undefined}\r\n              style={{ cursor: drawMode === 'erase' ? 'pointer' : 'default' }}\r\n            />\r\n          );\r\n        })}\r\n        {/* Trazo actual */}\r\n        {points.length > 0 && (\r\n          <path d={getPathD(points)} stroke={strokeColor} strokeWidth={2} fill=\"none\" />\r\n        )}\r\n        \r\n        {/* Puntos del per√≠metro */}\r\n        {drawMode === 'boundary' && points.map((point, idx) => (\r\n          <circle\r\n            key={idx}\r\n            cx={point.x}\r\n            cy={point.y}\r\n            r={3}\r\n            fill={strokeColor}\r\n            opacity={0.8}\r\n          />\r\n        ))}\r\n        \r\n        {/* L√≠nea de preview para per√≠metro */}\r\n        {drawMode === 'boundary' && points.length > 0 && cursorPos && (\r\n          <line\r\n            x1={points[points.length - 1].x}\r\n            y1={points[points.length - 1].y}\r\n            x2={(cursorPos.x - offset.x) / scale}\r\n            y2={(cursorPos.y - offset.y) / scale}\r\n            stroke={strokeColor}\r\n            strokeWidth={1}\r\n            strokeDasharray=\"5,5\"\r\n            opacity={0.7}\r\n          />\r\n        )}\r\n      </g>\r\n    </svg>\r\n\r\n      {/* Etiquetas persistentes de √°reas existentes */}\r\n      {areas.map((poly, aIdx) => {\r\n        const segs = [];\r\n        for (let i = 0; i < poly.length - 1; i++) {\r\n          const p1 = poly[i];\r\n          const p2 = poly[i + 1];\r\n          const length = Math.hypot(p2.x - p1.x, p2.y - p1.y);\r\n          const midX = (p1.x + p2.x) / 2 * scale + offset.x;\r\n          const midY = (p1.y + p2.y) / 2 * scale + offset.y;\r\n          segs.push({ p1, p2, length, midX, midY, idx: i });\r\n        }\r\n        return segs.map((seg) => (\r\n          <div\r\n            key={`s-${aIdx}-${seg.idx}`}\r\n            className=\"absolute pointer-events-auto text-[10px] bg-white bg-opacity-90 rounded px-1 cursor-pointer select-none\"\r\n            style={{ left: seg.midX, top: seg.midY, transform: 'translate(-50%, -50%)' }}\r\n            title=\"Doble clic para ajustar longitud\"\r\n            onDoubleClick={() => {\r\n              const currentM = (seg.length / 100).toFixed(2);\r\n              const val = window.prompt('Nueva longitud (m):', currentM);\r\n              if (!val) return;\r\n              const newLenCm = parseFloat(val) * 100;\r\n              if (!newLenCm || newLenCm <= 0) return;\r\n              const factor = newLenCm / seg.length;\r\n              const dx = seg.p2.x - seg.p1.x;\r\n              const dy = seg.p2.y - seg.p1.y;\r\n              const newP2 = { x: seg.p1.x + dx * factor, y: seg.p1.y + dy * factor };\r\n              const updated = [...poly];\r\n              updated[seg.idx + 1] = newP2;\r\n              onUpdateArea(aIdx, updated);\r\n            }}\r\n          >\r\n            {(seg.length / 100).toFixed(2)} m\r\n          </div>\r\n        ));\r\n      })}\r\n\r\n      {/* Etiqueta temporal de distancia (m) */}\r\n      {drawing && cursorPos && segLength != null && (\r\n        <div\r\n          className=\"absolute pointer-events-none text-[10px] bg-white bg-opacity-80 rounded px-1\"\r\n          style={{ left: cursorPos.x + 10, top: cursorPos.y + 10 }}\r\n        >\r\n          {(segLength / 100).toFixed(2)} m\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\GlobalSearch.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'ChevronRight' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":55},{"ruleId":"no-unused-vars","severity":1,"message":"'Link' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":14},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":66,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":66,"endColumn":48},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":319,"column":53,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[11075,11130],"text":"\r\n                  No se encontraron resultados para &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[11075,11130],"text":"\r\n                  No se encontraron resultados para &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[11075,11130],"text":"\r\n                  No se encontraron resultados para &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[11075,11130],"text":"\r\n                  No se encontraron resultados para &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":319,"column":66,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[11142,11161],"text":"&quot;\r\n                "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[11142,11161],"text":"&ldquo;\r\n                "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[11142,11161],"text":"&#34;\r\n                "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[11142,11161],"text":"&rdquo;\r\n                "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { Search, Mail, Calendar, User, X, ChevronRight, Clock } from 'lucide-react';\r\nimport { Link, useNavigate } from 'react-router-dom';\r\nimport debounce from 'lodash/debounce';\r\nimport * as EmailService from '../services/EmailService';\r\nimport * as ProveedorService from '../services/ProveedorService';\r\n\r\n/**\r\n * Componente de b√∫squeda global que permite buscar en emails, eventos y proveedores\r\n * desde un √∫nico punto de acceso en la aplicaci√≥n\r\n * \r\n * @returns {React.ReactElement} Componente de b√∫squeda global\r\n */\r\nconst GlobalSearch = () => {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [results, setResults] = useState({\r\n    emails: [],\r\n    events: [],\r\n    providers: []\r\n  });\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [selectedSection, setSelectedSection] = useState('all');\r\n  const [activeIndex, setActiveIndex] = useState(-1);\r\n  \r\n  const searchRef = useRef(null);\r\n  const inputRef = useRef(null);\r\n  const resultsRef = useRef(null);\r\n  const navigate = useNavigate();\r\n  \r\n  // Cerrar al hacer clic fuera del componente\r\n  useEffect(() => {\r\n    const handleClickOutside = (event) => {\r\n      if (searchRef.current && !searchRef.current.contains(event.target)) {\r\n        setIsOpen(false);\r\n      }\r\n    };\r\n    \r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleClickOutside);\r\n    };\r\n  }, []);\r\n  \r\n  // Manejar teclas de navegaci√≥n\r\n  useEffect(() => {\r\n    const handleKeyDown = (e) => {\r\n      if (!isOpen) return;\r\n      \r\n      switch (e.key) {\r\n        case 'ArrowDown':\r\n          e.preventDefault();\r\n          setActiveIndex(prev => {\r\n            const flatResults = getFlatResults();\r\n            return Math.min(prev + 1, flatResults.length - 1);\r\n          });\r\n          break;\r\n          \r\n        case 'ArrowUp':\r\n          e.preventDefault();\r\n          setActiveIndex(prev => Math.max(prev - 1, -1));\r\n          break;\r\n          \r\n        case 'Enter':\r\n          e.preventDefault();\r\n          const flatResults = getFlatResults();\r\n          if (activeIndex >= 0 && activeIndex < flatResults.length) {\r\n            handleSelectResult(flatResults[activeIndex]);\r\n          }\r\n          break;\r\n          \r\n        case 'Escape':\r\n          e.preventDefault();\r\n          setIsOpen(false);\r\n          break;\r\n          \r\n        default:\r\n          break;\r\n      }\r\n    };\r\n    \r\n    document.addEventListener('keydown', handleKeyDown);\r\n    return () => {\r\n      document.removeEventListener('keydown', handleKeyDown);\r\n    };\r\n  }, [isOpen, activeIndex]);\r\n  \r\n  // Desplazar al elemento seleccionado\r\n  useEffect(() => {\r\n    if (activeIndex >= 0 && resultsRef.current) {\r\n      const activeElement = resultsRef.current.querySelector(`[data-index=\"${activeIndex}\"]`);\r\n      if (activeElement) {\r\n        activeElement.scrollIntoView({ block: 'nearest' });\r\n      }\r\n    }\r\n  }, [activeIndex]);\r\n  \r\n  // Aplanar resultados para navegaci√≥n por teclado\r\n  const getFlatResults = () => {\r\n    const flat = [];\r\n    \r\n    if (selectedSection === 'all' || selectedSection === 'emails') {\r\n      results.emails.forEach(item => flat.push({ ...item, type: 'email' }));\r\n    }\r\n    \r\n    if (selectedSection === 'all' || selectedSection === 'events') {\r\n      results.events.forEach(item => flat.push({ ...item, type: 'event' }));\r\n    }\r\n    \r\n    if (selectedSection === 'all' || selectedSection === 'providers') {\r\n      results.providers.forEach(item => flat.push({ ...item, type: 'provider' }));\r\n    }\r\n    \r\n    return flat;\r\n  };\r\n  \r\n  // Funci√≥n de b√∫squeda con debounce para mejorar rendimiento\r\n  const performSearch = useCallback(\r\n    debounce(async (term) => {\r\n      if (!term || term.trim().length < 2) {\r\n        setResults({ emails: [], events: [], providers: [] });\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n      \r\n      setIsLoading(true);\r\n      \r\n      try {\r\n        // B√∫squeda en paralelo en diferentes servicios\r\n        const [emailResults, eventResults, providerResults] = await Promise.all([\r\n          EmailService.searchEmails(term),\r\n          EmailService.searchEvents(term),\r\n          ProveedorService.searchProviders(term)\r\n        ]);\r\n        \r\n        setResults({\r\n          emails: emailResults.slice(0, 5),\r\n          events: eventResults.slice(0, 5),\r\n          providers: providerResults.slice(0, 5)\r\n        });\r\n        \r\n      } catch (error) {\r\n        console.error('Error en b√∫squeda global:', error);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    }, 300),\r\n    []\r\n  );\r\n  \r\n  // Actualizar resultados al cambiar el t√©rmino de b√∫squeda\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setIsLoading(true);\r\n      performSearch(searchTerm);\r\n    }\r\n  }, [searchTerm, isOpen, performSearch]);\r\n  \r\n  // Abrir el buscador\r\n  const handleOpen = () => {\r\n    setIsOpen(true);\r\n    setTimeout(() => {\r\n      if (inputRef.current) {\r\n        inputRef.current.focus();\r\n      }\r\n    }, 100);\r\n  };\r\n  \r\n  // Manejar cambios en el campo de b√∫squeda\r\n  const handleSearchChange = (e) => {\r\n    setSearchTerm(e.target.value);\r\n    setActiveIndex(-1);\r\n  };\r\n  \r\n  // Seleccionar un resultado\r\n  const handleSelectResult = (item) => {\r\n    switch (item.type) {\r\n      case 'email':\r\n        navigate(`/buzon/${item.id}`);\r\n        break;\r\n      case 'event':\r\n        navigate(`/calendario/evento/${item.id}`);\r\n        break;\r\n      case 'provider':\r\n        navigate(`/proveedores/${item.id}`);\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    \r\n    setIsOpen(false);\r\n    setSearchTerm('');\r\n  };\r\n  \r\n  // Formatear fecha para mostrar\r\n  const formatDate = (dateStr) => {\r\n    const date = new Date(dateStr);\r\n    return date.toLocaleDateString('es-ES', {\r\n      day: '2-digit',\r\n      month: '2-digit',\r\n      year: 'numeric'\r\n    });\r\n  };\r\n  \r\n  // Resaltar coincidencias en el texto\r\n  const highlightMatch = (text, term) => {\r\n    if (!text || !term) return text;\r\n    \r\n    const regex = new RegExp(`(${term})`, 'gi');\r\n    const parts = text.split(regex);\r\n    \r\n    return parts.map((part, index) => \r\n      regex.test(part) ? <mark key={index} className=\"bg-yellow-200 rounded-sm\">{part}</mark> : part\r\n    );\r\n  };\r\n  \r\n  // Total de resultados\r\n  const totalResults = results.emails.length + results.events.length + results.providers.length;\r\n  \r\n  return (\r\n    <div className=\"relative z-50\" ref={searchRef}>\r\n      {/* Bot√≥n de b√∫squeda */}\r\n      <button\r\n        onClick={handleOpen}\r\n        className=\"flex items-center text-gray-600 hover:text-gray-900 focus:outline-none\"\r\n        aria-label=\"Buscar en Lovenda\"\r\n      >\r\n        <Search size={20} />\r\n        <span className=\"ml-2 hidden md:inline\">Buscar</span>\r\n      </button>\r\n      \r\n      {/* Modal de b√∫squeda */}\r\n      {isOpen && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-20 flex items-start justify-center pt-16 px-4\">\r\n          <div className=\"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] overflow-hidden flex flex-col\">\r\n            {/* Cabecera y campo de b√∫squeda */}\r\n            <div className=\"p-4 border-b border-gray-200\">\r\n              <div className=\"relative\">\r\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" size={18} />\r\n                <input\r\n                  ref={inputRef}\r\n                  type=\"text\"\r\n                  value={searchTerm}\r\n                  onChange={handleSearchChange}\r\n                  placeholder=\"Buscar emails, eventos, proveedores...\"\r\n                  className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition\"\r\n                  autoFocus\r\n                />\r\n                {searchTerm && (\r\n                  <button\r\n                    className=\"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600\"\r\n                    onClick={() => setSearchTerm('')}\r\n                  >\r\n                    <X size={16} />\r\n                  </button>\r\n                )}\r\n              </div>\r\n              \r\n              {/* Pesta√±as de filtrado */}\r\n              <div className=\"flex mt-3 border-b border-gray-200\">\r\n                <button\r\n                  onClick={() => setSelectedSection('all')}\r\n                  className={`px-3 py-2 text-sm font-medium ${\r\n                    selectedSection === 'all' \r\n                      ? 'text-blue-600 border-b-2 border-blue-600' \r\n                      : 'text-gray-600 hover:text-gray-900'\r\n                  }`}\r\n                >\r\n                  Todo\r\n                </button>\r\n                <button\r\n                  onClick={() => setSelectedSection('emails')}\r\n                  className={`px-3 py-2 text-sm font-medium flex items-center ${\r\n                    selectedSection === 'emails' \r\n                      ? 'text-blue-600 border-b-2 border-blue-600' \r\n                      : 'text-gray-600 hover:text-gray-900'\r\n                  }`}\r\n                >\r\n                  <Mail size={16} className=\"mr-1\" />\r\n                  Emails\r\n                </button>\r\n                <button\r\n                  onClick={() => setSelectedSection('events')}\r\n                  className={`px-3 py-2 text-sm font-medium flex items-center ${\r\n                    selectedSection === 'events' \r\n                      ? 'text-blue-600 border-b-2 border-blue-600' \r\n                      : 'text-gray-600 hover:text-gray-900'\r\n                  }`}\r\n                >\r\n                  <Calendar size={16} className=\"mr-1\" />\r\n                  Eventos\r\n                </button>\r\n                <button\r\n                  onClick={() => setSelectedSection('providers')}\r\n                  className={`px-3 py-2 text-sm font-medium flex items-center ${\r\n                    selectedSection === 'providers' \r\n                      ? 'text-blue-600 border-b-2 border-blue-600' \r\n                      : 'text-gray-600 hover:text-gray-900'\r\n                  }`}\r\n                >\r\n                  <User size={16} className=\"mr-1\" />\r\n                  Proveedores\r\n                </button>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Contenido de resultados */}\r\n            <div className=\"overflow-y-auto flex-grow\" ref={resultsRef}>\r\n              {isLoading ? (\r\n                <div className=\"flex items-center justify-center p-8\">\r\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500\"></div>\r\n                </div>\r\n              ) : searchTerm.length < 2 ? (\r\n                <div className=\"text-center p-8 text-gray-500\">\r\n                  Escribe al menos 2 caracteres para buscar\r\n                </div>\r\n              ) : totalResults === 0 ? (\r\n                <div className=\"text-center p-8 text-gray-500\">\r\n                  No se encontraron resultados para \"{searchTerm}\"\r\n                </div>\r\n              ) : (\r\n                <>\r\n                  {/* Resultados de Emails */}\r\n                  {(selectedSection === 'all' || selectedSection === 'emails') && results.emails.length > 0 && (\r\n                    <div className=\"px-4 py-3\">\r\n                      <h3 className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 flex items-center\">\r\n                        <Mail size={14} className=\"mr-1\" />\r\n                        Emails ({results.emails.length})\r\n                      </h3>\r\n                      <ul className=\"space-y-1\">\r\n                        {results.emails.map((email, index) => {\r\n                          // Calcular √≠ndice global\r\n                          const globalIndex = selectedSection === 'all' ? index : index;\r\n                          \r\n                          return (\r\n                            <li \r\n                              key={email.id}\r\n                              onClick={() => handleSelectResult({ ...email, type: 'email' })}\r\n                              className={`p-2 rounded-md cursor-pointer transition ${\r\n                                activeIndex === globalIndex ? 'bg-blue-50' : 'hover:bg-gray-50'\r\n                              }`}\r\n                              data-index={globalIndex}\r\n                            >\r\n                              <div className=\"flex justify-between\">\r\n                                <div className=\"font-medium\">\r\n                                  {highlightMatch(email.subject || '(Sin asunto)', searchTerm)}\r\n                                </div>\r\n                                <div className=\"text-xs text-gray-500 flex items-center\">\r\n                                  <Clock size={12} className=\"mr-1\" />\r\n                                  {formatDate(email.date)}\r\n                                </div>\r\n                              </div>\r\n                              <div className=\"text-sm text-gray-600 truncate\">\r\n                                {email.from && (\r\n                                  <span className=\"mr-1\">\r\n                                    De: {highlightMatch(email.from, searchTerm)}\r\n                                  </span>\r\n                                )}\r\n                              </div>\r\n                            </li>\r\n                          );\r\n                        })}\r\n                      </ul>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {/* Resultados de Eventos */}\r\n                  {(selectedSection === 'all' || selectedSection === 'events') && results.events.length > 0 && (\r\n                    <div className=\"px-4 py-3 border-t border-gray-100\">\r\n                      <h3 className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 flex items-center\">\r\n                        <Calendar size={14} className=\"mr-1\" />\r\n                        Eventos ({results.events.length})\r\n                      </h3>\r\n                      <ul className=\"space-y-1\">\r\n                        {results.events.map((event, index) => {\r\n                          // Calcular √≠ndice global\r\n                          const globalIndex = selectedSection === 'all' \r\n                            ? results.emails.length + index\r\n                            : index;\r\n                            \r\n                          return (\r\n                            <li \r\n                              key={event.id}\r\n                              onClick={() => handleSelectResult({ ...event, type: 'event' })}\r\n                              className={`p-2 rounded-md cursor-pointer transition ${\r\n                                activeIndex === globalIndex ? 'bg-blue-50' : 'hover:bg-gray-50'\r\n                              }`}\r\n                              data-index={globalIndex}\r\n                            >\r\n                              <div className=\"font-medium\">\r\n                                {highlightMatch(event.title, searchTerm)}\r\n                              </div>\r\n                              <div className=\"text-sm text-gray-600 flex items-center\">\r\n                                <Calendar size={14} className=\"mr-1 text-blue-500\" />\r\n                                <span>\r\n                                  {new Date(event.dateTime).toLocaleDateString('es-ES')} - {new Date(event.dateTime).toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' })}\r\n                                </span>\r\n                              </div>\r\n                              {event.location && (\r\n                                <div className=\"text-sm text-gray-600 truncate\">\r\n                                  {highlightMatch(event.location, searchTerm)}\r\n                                </div>\r\n                              )}\r\n                            </li>\r\n                          );\r\n                        })}\r\n                      </ul>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {/* Resultados de Proveedores */}\r\n                  {(selectedSection === 'all' || selectedSection === 'providers') && results.providers.length > 0 && (\r\n                    <div className=\"px-4 py-3 border-t border-gray-100\">\r\n                      <h3 className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 flex items-center\">\r\n                        <User size={14} className=\"mr-1\" />\r\n                        Proveedores ({results.providers.length})\r\n                      </h3>\r\n                      <ul className=\"space-y-1\">\r\n                        {results.providers.map((provider, index) => {\r\n                          // Calcular √≠ndice global\r\n                          const globalIndex = selectedSection === 'all' \r\n                            ? results.emails.length + results.events.length + index\r\n                            : index;\r\n                            \r\n                          return (\r\n                            <li \r\n                              key={provider.id}\r\n                              onClick={() => handleSelectResult({ ...provider, type: 'provider' })}\r\n                              className={`p-2 rounded-md cursor-pointer transition ${\r\n                                activeIndex === globalIndex ? 'bg-blue-50' : 'hover:bg-gray-50'\r\n                              }`}\r\n                              data-index={globalIndex}\r\n                            >\r\n                              <div className=\"font-medium\">\r\n                                {highlightMatch(provider.name, searchTerm)}\r\n                              </div>\r\n                              {provider.type && (\r\n                                <div className=\"text-sm text-gray-600\">\r\n                                  {highlightMatch(provider.type, searchTerm)}\r\n                                </div>\r\n                              )}\r\n                              {provider.contact && (\r\n                                <div className=\"text-sm text-gray-600 truncate\">\r\n                                  {highlightMatch(provider.contact, searchTerm)}\r\n                                </div>\r\n                              )}\r\n                            </li>\r\n                          );\r\n                        })}\r\n                      </ul>\r\n                    </div>\r\n                  )}\r\n                </>\r\n              )}\r\n            </div>\r\n            \r\n            {/* Pie de resultados */}\r\n            {!isLoading && searchTerm.length >= 2 && totalResults > 0 && (\r\n              <div className=\"px-4 py-2 text-xs text-gray-500 border-t border-gray-200\">\r\n                Usa ‚Üë‚Üì para navegar, Enter para seleccionar\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default GlobalSearch;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\GuestItem.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\HomePage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Phone' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":78,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":83},{"ruleId":"no-unused-vars","severity":1,"message":"'hasRole' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":26,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":18},{"ruleId":"no-unused-vars","severity":1,"message":"'displayName' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":30,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'logoUrl' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":33,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'email' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":36,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":36,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'userName' is not defined.","line":217,"column":82,"nodeType":"Identifier","messageId":"undef","endLine":217,"endColumn":90},{"ruleId":"no-undef","severity":2,"message":"'userName' is not defined.","line":217,"column":105,"nodeType":"Identifier","messageId":"undef","endLine":217,"endColumn":113}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useRef, useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { toast } from 'react-toastify';\r\n// import eliminado: useUserContext legacy\r\nimport { useAuth } from '../hooks/useAuth'; // Nuevo sistema\r\nimport { Card } from './ui/Card';\r\nimport { Progress } from './ui/Progress';\r\nimport Nav from './Nav';\r\nimport { Link } from 'react-router-dom';\r\n\r\nimport { User, DollarSign, Calendar, Users, ChevronLeft, ChevronRight, Plus, Phone } from 'lucide-react';\r\nimport Input from './Input';\r\nimport ProviderSearchModal from './ProviderSearchModal';\r\n\r\nimport { fetchWall } from '../services/wallService';\r\nimport { fetchWeddingNews } from '../services/blogService';\r\n\r\nimport PlannerDashboard from './PlannerDashboard';\r\n\r\nexport default function HomePage() {\r\n  // Todo se maneja con modales locales\r\n  const [noteText, setNoteText] = useState('');\r\n  const [guest, setGuest] = useState({name: '', side: 'novia', contact: ''});\r\n  const [newMovement, setNewMovement] = useState({concept: '', amount: 0, date: '', type: 'expense'});\r\n  const [activeModal, setActiveModal] = useState(null);\r\n  // Hook de autenticaci√≥n unificado\r\n  const { hasRole, userProfile, currentUser } = useAuth();\r\n  \r\n  // Derivados equivalentes al UserContext legacy\r\n  const role = userProfile?.role || 'particular';\r\n  const displayName = userProfile?.name || userProfile?.displayName || currentUser?.displayName || currentUser?.email?.split('@')[0] || '';\r\n  const weddingName = localStorage.getItem('lovenda_active_wedding_name') || '';\r\n  const progress = Number(localStorage.getItem('lovenda_progress') || 0);\r\n  const logoUrl = userProfile?.logoUrl || '';\r\n  \r\n  // Datos derivados ya calculados m√°s arriba\r\n  const email = currentUser?.email || '';\r\n\r\n  // Si el usuario es Wedding Planner mostramos dashboard espec√≠fico\r\n  if (role === 'planner') {\r\n    return <PlannerDashboard />;\r\n  }\r\n  const galleryRef = useRef(null);\r\n  const [newsPosts, setNewsPosts] = useState([]);\r\n  const [categoryImages, setCategoryImages] = useState([]);\r\n\r\n  // Cargar primera imagen de cada categor√≠a\r\n  useEffect(() => {\r\n    const categories = ['decoraci√≥n','c√≥ctel','banquete','ceremonia'];\r\n    Promise.all(categories.map(cat=>fetchWall(1, cat))).then(results=>{\r\n      const imgs = results.map((arr,i)=>{\r\n        const first = arr[0];\r\n        if(first) return { src: first.url, alt: categories[i] };\r\n        return null;\r\n      }).filter(Boolean);\r\n      setCategoryImages(imgs);\r\n    }).catch(console.error);\r\n  }, []);\r\n\r\n  // Cargar √∫ltimas noticias (m√°x 3 por dominio y 4 con imagen)\r\n  useEffect(() => {\r\n    const loadNews = async () => {\r\n      try {\r\n        const desired = 4;\r\n        let page = 1;\r\n        const results = [];\r\n        const domainCounts = {};\r\n        while (results.length < desired && page <= 20) {\r\n          const batch = await fetchWeddingNews(page, 50, 'es');\r\n          for (const post of batch) {\r\n            if (!post.image) continue;\r\n            const domain = (() => {\r\n              try {\r\n                return new URL(post.url).hostname.replace(/^www\\./, '');\r\n              } catch {\r\n                return 'unknown';\r\n              }\r\n            })();\r\n            if ((domainCounts[domain] || 0) >= 3) continue;\r\n            domainCounts[domain] = (domainCounts[domain] || 0) + 1;\r\n            results.push(post);\r\n            if (results.length >= desired) break;\r\n          }\r\n          page++;\r\n        }\r\n\r\n        // fallback: si a√∫n faltan, relajamos l√≠mite de dominio\r\n        if (results.length < desired) {\r\n          page = 1;\r\n          while (results.length < desired && page <= 20) {\r\n            const batch = await fetchWeddingNews(page, 50, 'es');\r\n            for (const post of batch) {\r\n              if (!post.image) continue;\r\n              if (results.some(x => x.url === post.url)) continue;\r\n              results.push(post);\r\n              if (results.length >= desired) break;\r\n            }\r\n            page++;\r\n          }\r\n        }\r\n\r\n        setNewsPosts(results.slice(0, desired));\r\n      } catch (err) {\r\n        console.error(err);\r\n      }\r\n    };\r\n    loadNews();\r\n  }, []);\r\n\r\n  const handleRedoTutorial = useCallback(async () => {\r\n    if (!confirm('Esto eliminar√° datos locales y crear√° una nueva boda de prueba. ¬øContinuar?')) return;\r\n    try {\r\n      // 1. Limpiar almacenamiento y marcar flag para mostrar tutorial\r\n      localStorage.clear();\r\n      localStorage.setItem('forceOnboarding', '1');\r\n\r\n      toast.success('Tutorial reiniciado: recargando...');\r\n      setTimeout(() => window.location.reload(), 800);\r\n    } catch (err) {\r\n      console.error(err);\r\n      toast.error('No se pudo reiniciar el tutorial');\r\n    }\r\n  }, []);\r\n  const scrollAmount = 300;\r\n\r\n  const scrollPrev = useCallback(() => {\r\n    galleryRef.current?.scrollBy({ left: -scrollAmount, behavior: 'smooth' });\r\n  }, []);\r\n\r\n  const scrollNext = useCallback(() => {\r\n    galleryRef.current?.scrollBy({ left: scrollAmount, behavior: 'smooth' });\r\n  }, []);\r\n\r\n  // --- M√©tricas din√°micas (memoizadas para performance) ---\r\n  const guestsMetrics = useMemo(() => {\r\n    try {\r\n      const guestsArr = JSON.parse(localStorage.getItem('lovendaGuests') || '[]');\r\n      const confirmedCount = guestsArr.filter(g => ((g.response || g.status || '').toLowerCase() === 'confirmado')).length;\r\n      return { guestsArr, confirmedCount, totalGuests: guestsArr.length };\r\n    } catch {\r\n      return { guestsArr: [], confirmedCount: 0, totalGuests: 0 };\r\n    }\r\n  }, []);\r\n\r\n  const tasksMetrics = useMemo(() => {\r\n    try {\r\n      const tasksCompletedMap = JSON.parse(localStorage.getItem('tasksCompleted') || '{}');\r\n      const meetingsArr = JSON.parse(localStorage.getItem('lovendaMeetings') || '[]');\r\n      const longTasksArr = JSON.parse(localStorage.getItem('lovendaLongTasks') || '[]');\r\n      const allTasks = [...meetingsArr, ...longTasksArr];\r\n      const tasksTotal = allTasks.length;\r\n      const tasksCompleted = allTasks.filter(t => tasksCompletedMap[t.id]).length;\r\n      return { tasksTotal, tasksCompleted };\r\n    } catch {\r\n      return { tasksTotal: 0, tasksCompleted: 0 };\r\n    }\r\n  }, []);\r\n\r\n  const providersMetrics = useMemo(() => {\r\n    try {\r\n      const providersArr = JSON.parse(localStorage.getItem('lovendaProviders') || '[]');\r\n      const providersTotalNeeded = 8; // puede venir de ajustes\r\n      const providersAssigned = providersArr.length;\r\n      return { providersAssigned, providersTotalNeeded };\r\n    } catch {\r\n      return { providersAssigned: 0, providersTotalNeeded: 8 };\r\n    }\r\n  }, []);\r\n\r\n  const financeMetrics = useMemo(() => {\r\n    try {\r\n      const movements = JSON.parse(localStorage.getItem('quickMovements') || '[]');\r\n      const spent = movements.filter(m => m.type !== 'income').reduce((sum, m) => sum + (m.amount || 0), 0);\r\n      return { movements, spent };\r\n    } catch {\r\n      return { movements: [], spent: 0 };\r\n    }\r\n  }, []);\r\n  const budgetTotal = 15000; // placeholder\r\n\r\n  const statsNovios = useMemo(() => [\r\n    { label: 'Invitados confirmados', value: guestsMetrics.confirmedCount, icon: Users },\r\n    { label: 'Presupuesto gastado', value: `‚Ç¨${financeMetrics.spent.toLocaleString()}` + (budgetTotal ? ` / ‚Ç¨${budgetTotal.toLocaleString()}` : ''), icon: DollarSign },\r\n    { label: 'Proveedores contratados', value: `${providersMetrics.providersAssigned} / ${providersMetrics.providersTotalNeeded}`, icon: User },\r\n    { label: 'Tareas completadas', value: `${tasksMetrics.tasksCompleted} / ${tasksMetrics.tasksTotal}`, icon: Calendar },\r\n  ], [guestsMetrics, financeMetrics, providersMetrics, tasksMetrics, budgetTotal]);\r\n\r\n  const statsPlanner = useMemo(() => [\r\n    { label: 'Tareas asignadas', value: `${tasksMetrics.tasksTotal}`, icon: Calendar },\r\n    { label: 'Proveedores asignados', value: providersMetrics.providersAssigned, icon: User },\r\n    { label: 'Invitados confirmados', value: guestsMetrics.confirmedCount, icon: Users },\r\n    { label: 'Presupuesto gastado', value: `‚Ç¨${financeMetrics.spent.toLocaleString()}` + (budgetTotal ? ` / ‚Ç¨${budgetTotal.toLocaleString()}` : ''), icon: DollarSign },\r\n  ], [guestsMetrics, financeMetrics, providersMetrics, tasksMetrics, budgetTotal]);\r\n\r\n  const statsCommon = useMemo(() => \r\n    role === 'particular' ? statsNovios : statsPlanner,\r\n    [role, statsNovios, statsPlanner]\r\n  );\r\n\r\n  return (\r\n    <React.Fragment>\r\n      {/* Bot√≥n solo visible en desarrollo */}\r\n      {true && (\r\n        <button\r\n          onClick={handleRedoTutorial}\r\n          className=\"fixed top-4 right-4 bg-red-600 text-white px-4 py-2 rounded-full shadow-lg z-[100]\"\r\n        >\r\n          Rehacer tutorial\r\n        </button>\r\n      )}\r\n      <div className=\"relative flex flex-col h-full bg-[var(--color-bg)] pb-16\">\r\n        {/* Decorative background circle */}\r\n        <div className=\"absolute top-0 right-0 w-64 h-64 bg-[var(--color-accent)] rounded-full opacity-20 transform translate-x-1/2 -translate-y-1/2\" />\r\n\r\n        {/* Header */}\r\n        <header className=\"relative z-10 p-6 flex justify-between items-center\">\r\n          <div className=\"space-y-1\">\r\n            <h1 className=\"page-title\">Bienvenidos, {weddingName}{weddingName && userName ? ' y ' : ''}{userName}</h1>\r\n            <p className=\"text-4xl font-bold text-[color:var(--color-text)]\">Cada detalle hace tu boda inolvidable</p>\r\n          </div>\r\n          <img\r\n            src={`${import.meta.env.BASE_URL}logo-app.png`}\r\n            alt=\"Logo de la boda\"\r\n            className=\"w-32 h-32 object-contain\"\r\n          />\r\n        </header>\r\n\r\n        {/* Progress Section */}\r\n        <section className=\"z-10 w-full p-6\">\r\n          <Card className=\"bg-[var(--color-surface)]/70 backdrop-blur-md p-4 w-full\">\r\n            <p className=\"text-sm text-[color:var(--color-text)]/70 mb-2\">Progreso de tareas</p>\r\n            <Progress\r\n              className=\"h-4 rounded-full w-full\"\r\n              value={progress}\r\n              max={100}\r\n              variant={\r\n                progress >= 100\r\n                  ? 'success'\r\n                  : progress >= 80\r\n                  ? 'primary'\r\n                  : 'destructive'\r\n              }\r\n            />\r\n            <p className=\"mt-2 text-sm font-medium text-[color:var(--color-text)]\">\r\n              {progress}% completado\r\n            </p>\r\n          </Card>\r\n        </section>\r\n\r\n        {/* Quick Actions */}\r\n        <section className=\"z-10 p-6 grid grid-cols-2 md:grid-cols-4 gap-4 w-full\">\r\n          {[\r\n            { key: 'proveedor', label: 'Buscar proveedor', icon: User },\r\n            { key: 'invitado', label: 'A√±adir invitado', icon: Users },\r\n            { key: 'movimiento', label: 'A√±adir movimiento', icon: DollarSign },\r\n            { key: 'nota', label: 'Nueva nota', icon: Plus },\r\n          ].map((action, idx) => {\r\n            const Icon = action.icon;\r\n            return (\r\n              <Card\r\n                key={idx}\r\n                role=\"button\"\r\n                onClick={() => setActiveModal(action.key)}\r\n                className=\"flex items-center justify-between p-4 bg-[var(--color-surface)]/80 backdrop-blur-md hover:shadow-lg transition transform hover:scale-105 cursor-pointer\"\r\n              >\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <Icon className=\"text-[var(--color-primary)]\" />\r\n                  <span className=\"text-[color:var(--color-text)] font-medium\">{action.label}</span>\r\n                </div>\r\n                <ChevronRight className=\"text-[color:var(--color-text)]/50\" />\r\n              </Card>\r\n            );\r\n          })}\r\n        </section>\r\n\r\n        {/* Stats Cards */}\r\n        <section className=\"z-10 grid grid-cols-1 sm:grid-cols-2 gap-6 p-6 flex-grow\">\r\n          {statsCommon.map((stat, idx) => {\r\n            const Icon = stat.icon;\r\n            return (\r\n              <Card key={idx} className=\"p-4 bg-[var(--color-surface)]/80 backdrop-blur-md hover:shadow-lg transition transform hover:scale-105\">\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <Icon className=\"text-[var(--color-primary)]\" />\r\n                  <p className=\"text-sm text-[color:var(--color-text)]\">{stat.label}</p>\r\n                </div>\r\n                <p className=\"text-2xl font-extrabold text-[var(--color-primary)] mt-2\">\r\n                  {stat.value}\r\n                </p>\r\n              </Card>\r\n            );\r\n          })}\r\n        </section>\r\n\r\n        {/* Inspiration Gallery */}\r\n        <section className=\"z-10 p-6 pb-12 relative\">\r\n          <div className=\"flex justify-between items-center mb-4\">\r\n            <Link to=\"/inspiracion\">\r\n              <button className=\"text-xl font-bold text-[var(--color-text)] hover:text-[var(--color-primary)]\">\r\n                Inspiraci√≥n para tu boda\r\n              </button>\r\n            </Link>\r\n            <div className=\"flex space-x-2\">\r\n              <button onClick={scrollPrev} className=\"p-2 rounded-full bg-[var(--color-surface)]/80 backdrop-blur-md\">\r\n                <ChevronLeft className=\"text-[var(--color-primary)]\" />\r\n              </button>\r\n              <button onClick={scrollNext} className=\"p-2 rounded-full bg-[var(--color-surface)]/80 backdrop-blur-md\">\r\n                <ChevronRight className=\"text-[var(--color-primary)]\" />\r\n              </button>\r\n            </div>\r\n          </div>\r\n          <div \r\n            ref={galleryRef} \r\n            className=\"flex space-x-4 overflow-x-auto pb-4 snap-x scrollbar-hide\"\r\n          >\r\n            {categoryImages.map((img, idx) => (\r\n              <div key={idx} className=\"snap-start flex-shrink-0 w-64 h-64 relative rounded-lg overflow-hidden\">\r\n                <img \r\n                  src={img.src} \r\n                  alt={img.alt}\r\n                  className=\"w-full h-full object-cover transition transform hover:scale-110\"\r\n                />\r\n                <div className=\"absolute inset-0 bg-gradient-to-t from-black/70 to-transparent flex items-end p-4\">\r\n                  <p className=\"text-white font-medium\">{img.alt}</p>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </section>\r\n\r\n        {/* Blog Section */}\r\n        <section className=\"z-10 p-6 pb-2\">\r\n          <div className=\"flex justify-between items-center mb-4\">\r\n            <Link to=\"/blog\">\r\n              <button className=\"text-xl font-bold text-[var(--color-text)] hover:text-[var(--color-primary)]\">\r\n                Blog\r\n              </button>\r\n            </Link>\r\n          </div>\r\n        {newsPosts.length > 0 && (\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-6\">\r\n              {newsPosts.map((post) => (\r\n                <Card key={post.id} onClick={() => window.open(post.url, '_blank')} className=\"cursor-pointer p-0 overflow-hidden bg-[var(--color-surface)]/80 backdrop-blur-md hover:shadow-lg transition\">\r\n                  {post.image && (\r\n                    <img src={post.image} alt={post.title} className=\"w-full h-40 object-cover\" />\r\n                  )}\r\n                  <div className=\"p-4 space-y-1\">\r\n                    <h3 className=\"font-semibold text-[color:var(--color-text)] line-clamp-2\">{post.title}</h3>\r\n                    <p className=\"text-sm text-[var(--color-text)]/70 line-clamp-2\">{post.description}</p>\r\n                  </div>\r\n                </Card>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </section>\r\n\r\n        <Nav active=\"home\" />\r\n      </div>\r\n      \r\n      {/* Modales */}\r\n      {activeModal === 'proveedor' && <ProviderSearchModal onClose={() => setActiveModal(null)} />}\r\n\r\n      {activeModal === 'invitado' && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-[var(--color-surface)] p-6 rounded-lg w-96 max-w-full\">\r\n            <h2 className=\"text-xl font-bold mb-4\">A√±adir Invitado</h2>\r\n            <div className=\"space-y-4\">\r\n              <Input \r\n                label=\"Nombre\" \r\n                value={guest.name} \r\n                onChange={e => setGuest({...guest, name: e.target.value})} \r\n              />\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label className=\"block text-sm font-medium mb-1\">Parte de</label>\r\n                  <select \r\n                    className=\"w-full p-2 border border-gray-300 rounded\"\r\n                    value={guest.side}\r\n                    onChange={e => setGuest({...guest, side: e.target.value})}\r\n                  >\r\n                    <option value=\"novia\">Novia</option>\r\n                    <option value=\"novio\">Novio</option>\r\n                    <option value=\"ambos\">Ambos</option>\r\n                  </select>\r\n                </div>\r\n                <Input \r\n                  label=\"Contacto\" \r\n                  value={guest.contact} \r\n                  onChange={e => setGuest({...guest, contact: e.target.value})} \r\n                />\r\n              </div>\r\n            </div>\r\n            <div className=\"flex justify-end space-x-2 mt-6\">\r\n              <button \r\n                onClick={() => setActiveModal(null)}\r\n                className=\"px-4 py-2 text-[var(--color-text)] border border-[var(--color-text)]/20 rounded\"\r\n              >\r\n                Cancelar\r\n              </button>\r\n              <button \r\n                onClick={() => {\r\n                  const guests = JSON.parse(localStorage.getItem('lovendaGuests') || '[]');\r\n                  guests.push({...guest, id: Date.now()});\r\n                  localStorage.setItem('lovendaGuests', JSON.stringify(guests));\r\n                  setGuest({name:'',side:'novia',contact:''});\r\n                  setActiveModal(null);\r\n                }}\r\n                className=\"px-4 py-2 bg-[var(--color-primary)] text-white rounded\"\r\n              >\r\n                Guardar\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {activeModal === 'movimiento' && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-[var(--color-surface)] p-6 rounded-lg w-96 max-w-full\">\r\n            <h2 className=\"text-xl font-bold mb-4\">Nuevo Movimiento</h2>\r\n            <div className=\"space-y-4\">\r\n              <Input \r\n                label=\"Concepto\" \r\n                value={newMovement.concept} \r\n                onChange={e => setNewMovement({...newMovement, concept: e.target.value})} \r\n              />\r\n              <Input \r\n                label=\"Cantidad (‚Ç¨)\" \r\n                type=\"number\"\r\n                value={newMovement.amount} \r\n                onChange={e => setNewMovement({...newMovement, amount: parseFloat(e.target.value) || 0})} \r\n              />\r\n              <Input \r\n                label=\"Fecha\" \r\n                type=\"date\"\r\n                value={newMovement.date} \r\n                onChange={e => setNewMovement({...newMovement, date: e.target.value})} \r\n              />\r\n              <div>\r\n                <label className=\"block text-sm font-medium mb-1\">Tipo</label>\r\n                <select \r\n                  className=\"w-full p-2 border border-gray-300 rounded\"\r\n                  value={newMovement.type}\r\n                  onChange={e => setNewMovement({...newMovement, type: e.target.value})}\r\n                >\r\n                  <option value=\"expense\">Gasto</option>\r\n                  <option value=\"income\">Ingreso</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex justify-end space-x-2 mt-6\">\r\n              <button \r\n                onClick={() => setActiveModal(null)}\r\n                className=\"px-4 py-2 text-[var(--color-text)] border border-[var(--color-text)]/20 rounded\"\r\n              >\r\n                Cancelar\r\n              </button>\r\n              <button \r\n                onClick={() => {\r\n                  const movs = JSON.parse(localStorage.getItem('quickMovements') || '[]');\r\n                  movs.push({...newMovement, id: Date.now()});\r\n                  localStorage.setItem('quickMovements', JSON.stringify(movs));\r\n                  setNewMovement({concept:'',amount:0,date:'',type:'expense'});\r\n                  setActiveModal(null);\r\n                }}\r\n                className=\"px-4 py-2 bg-[var(--color-primary)] text-white rounded\"\r\n              >\r\n                Guardar\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {activeModal === 'nota' && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-[var(--color-surface)] p-6 rounded-lg w-96 max-w-full\">\r\n            <h2 className=\"text-xl font-bold mb-4\">Nueva Nota</h2>\r\n            <div className=\"space-y-4\">\r\n              <textarea\r\n                className=\"w-full p-3 border border-gray-300 rounded h-32\"\r\n                placeholder=\"Escribe tu nota aqu√≠...\"\r\n                value={noteText}\r\n                onChange={e => setNoteText(e.target.value)}\r\n              ></textarea>\r\n            </div>\r\n            <div className=\"flex justify-end space-x-2 mt-6\">\r\n              <button \r\n                onClick={() => setActiveModal(null)}\r\n                className=\"px-4 py-2 text-[var(--color-text)] border border-[var(--color-text)]/20 rounded\"\r\n              >\r\n                Cancelar\r\n              </button>\r\n              <button \r\n                onClick={() => {\r\n                  const notes = JSON.parse(localStorage.getItem('lovendaNotes') || '[]');\r\n                  notes.push({text: noteText, id: Date.now()});\r\n                  localStorage.setItem('lovendaNotes', JSON.stringify(notes));\r\n                  setNoteText('');\r\n                  setActiveModal(null);\r\n                }}\r\n                className=\"px-4 py-2 bg-[var(--color-primary)] text-white rounded\"\r\n              >\r\n                Guardar\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </React.Fragment>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\ImageGeneratorAI.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Spinner' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":20,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'downloadAsPdf' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":221,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":221,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { saveData, loadData } from '../services/SyncService';\r\nimport Spinner from './Spinner';\r\nimport { jsPDF } from 'jspdf';\r\nimport { saveAs } from 'file-saver';\r\nimport { Wand2, RefreshCcw, Download, FileDown } from 'lucide-react';\r\n\r\n/**\r\n * Componente para generar im√°genes con IA\r\n * @param {Object} props - Propiedades del componente\r\n * @param {string} props.category - Categor√≠a de la imagen (invitaciones, logo, menu, etc.)\r\n * @param {Array} props.templates - Array de plantillas predefinidas\r\n * @param {Function} props.onImageGenerated - Callback cuando se genera una imagen\r\n */\r\nconst ImageGeneratorAI = ({ category = 'general', templates = [], onImageGenerated = () => {} }) => {\r\n  const [prompt, setPrompt] = useState('');\r\n  const [selectedTemplate, setSelectedTemplate] = useState(null);\r\n  const [generatedImages, setGeneratedImages] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [toast, setToast] = useState(null);\r\n  \r\n  // Cargar im√°genes guardadas al iniciar\r\n  useEffect(() => {\r\n    const savedImages = loadData(`lovenda_ai_images_${category}`, { \r\n      defaultValue: [], \r\n      collection: 'userDesigns' \r\n    });\r\n    \r\n    if (savedImages && savedImages.length > 0) {\r\n      setGeneratedImages(savedImages);\r\n    }\r\n  }, [category]);\r\n\r\n  // Mostrar toast temporal\r\n  useEffect(() => {\r\n    if (toast) {\r\n      const timer = setTimeout(() => {\r\n        setToast(null);\r\n      }, 3000);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [toast]);\r\n\r\n  // Seleccionar una plantilla y aplicarla al prompt\r\n  const handleSelectTemplate = (template) => {\r\n    setSelectedTemplate(template);\r\n    setPrompt(template.prompt);\r\n  };\r\n\r\n  // Generar imagen usando OpenAI DALL-E\r\n  const generateImage = async () => {\r\n    if (!prompt.trim()) {\r\n      setToast({\r\n        type: 'error',\r\n        message: 'Por favor, escribe un prompt o selecciona una plantilla'\r\n      });\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      // Si tenemos un proxy API, lo usamos\r\n      try {\r\n        const res = await fetch('/api/ai-image', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ prompt })\r\n        });\r\n\r\n        if (res.ok) {\r\n          const data = await res.json();\r\n          if (data && data.url) {\r\n            handleImageGenerated(data.url);\r\n            return;\r\n          }\r\n        }\r\n      } catch (err) {\r\n        console.warn('Error con el proxy de API, intentando directo con OpenAI:', err);\r\n      }\r\n\r\n      // Si no hay proxy o fall√≥, usamos OpenAI directamente\r\n      const response = await fetch('https://api.openai.com/v1/images/generations', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${import.meta.env.VITE_OPENAI_API_KEY}`\r\n        },\r\n        body: JSON.stringify({\r\n          model: \"dall-e-3\",\r\n          prompt: prompt,\r\n          n: 1,\r\n          size: \"1024x1024\",\r\n          quality: \"hd\"\r\n        })\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.error?.message || 'Error al generar la imagen');\r\n      }\r\n\r\n      const data = await response.json();\r\n      \r\n      if (data && data.data && data.data[0] && data.data[0].url) {\r\n        handleImageGenerated(data.data[0].url);\r\n      } else {\r\n        throw new Error('No se recibi√≥ URL de imagen en la respuesta');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error al generar imagen:', err);\r\n      setError(err.message || 'Error al generar la imagen');\r\n      setToast({\r\n        type: 'error',\r\n        message: 'Error al generar la imagen. Intenta con otro prompt.'\r\n      });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Manejar la imagen generada\r\n  const handleImageGenerated = (imageUrl) => {\r\n    const newImage = {\r\n      id: Date.now(),\r\n      url: imageUrl,\r\n      prompt,\r\n      timestamp: new Date().toISOString(),\r\n      category\r\n    };\r\n\r\n    const updatedImages = [newImage, ...generatedImages];\r\n    setGeneratedImages(updatedImages);\r\n    \r\n    // Guardar en almacenamiento local\r\n    saveData(`lovenda_ai_images_${category}`, updatedImages, {\r\n      collection: 'userDesigns',\r\n      showNotification: false\r\n    });\r\n\r\n    // Llamar al callback\r\n    onImageGenerated(newImage);\r\n    \r\n    setToast({\r\n      type: 'success',\r\n      message: '¬°Imagen generada con √©xito!'\r\n    });\r\n  };\r\n\r\n  // Descargar la imagen\r\n  const downloadImage = async (imageUrl, imageName) => {\r\n    const urlObj = new URL(imageUrl);\r\n    const sameOrigin = urlObj.origin === window.location.origin;\r\n\r\n    // Si es otro dominio (Azure/OpenAI), usamos fallback directo sin fetch para evitar CORS error\r\n    if (!sameOrigin) {\r\n      const a = document.createElement('a');\r\n      a.href = imageUrl;\r\n      a.target = '_blank';\r\n      a.rel = 'noopener noreferrer';\r\n      a.download = imageName || `lovenda-${category}-${Date.now()}.png`;\r\n      document.body.appendChild(a);\r\n      a.click();\r\n      document.body.removeChild(a);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(imageUrl);\r\n      const blob = await response.blob();\r\n      const url = window.URL.createObjectURL(blob);\r\n      const a = document.createElement('a');\r\n      a.style.display = 'none';\r\n      a.href = url;\r\n      a.download = imageName || `lovenda-${category}-${Date.now()}.png`;\r\n      document.body.appendChild(a);\r\n      a.click();\r\n      window.URL.revokeObjectURL(url);\r\n      document.body.removeChild(a);\r\n    } catch (err) {\r\n      console.error('Error al descargar la imagen:', err);\r\n      // Fallback: abrir la URL directamente en nueva pesta√±a\r\n      const aFallback = document.createElement('a');\r\n      aFallback.href = imageUrl;\r\n      aFallback.target = '_blank';\r\n      aFallback.rel = 'noopener noreferrer';\r\n      document.body.appendChild(aFallback);\r\n      aFallback.click();\r\n      document.body.removeChild(aFallback);\r\n      setToast({\r\n        type: 'error',\r\n        message: 'Error al descargar la imagen'\r\n      });\r\n    }\r\n  };\r\n\r\n  // Descargar como PDF vectorial listo para impresi√≥n\r\n  const downloadVectorPdf = async (imageUrl, fileName) => {\r\n    try {\r\n      const res = await fetch('/api/ai-image/vector-pdf', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ url: imageUrl })\r\n      });\r\n      if (!res.ok) throw new Error('Error generando PDF');\r\n\r\n      const blob = await res.blob();\r\n      if (!blob || blob.size === 0) throw new Error('PDF vac√≠o');\r\n\r\n      // Descargar usando FileSaver (cross-browser)\r\n      saveAs(blob, fileName || `lovenda-${category}-${Date.now()}.pdf`);\r\n    } catch (err) {\r\n      console.error('Error al descargar PDF:', err);\r\n      setToast({ type: 'error', message: 'No se pudo generar el PDF' });\r\n    }\r\n  };\r\n\r\n  // Descargar como PDF sin m√°rgenes\r\n  const downloadAsPdf = async (imageUrl, fileName) => {\r\n    try {\r\n      const response = await fetch(imageUrl);\r\n      const blob = await response.blob();\r\n      const url = window.URL.createObjectURL(blob);\r\n      const img = new Image();\r\n      img.src = url;\r\n      img.onload = () => {\r\n        const pdf = new jsPDF({\r\n          unit: 'pt',\r\n          orientation: img.width >= img.height ? 'l' : 'p',\r\n          format: [img.width, img.height]\r\n        });\r\n        pdf.addImage(img, 'PNG', 0, 0, img.width, img.height);\r\n        pdf.save(fileName || `lovenda-${category}-${Date.now()}.pdf`);\r\n        window.URL.revokeObjectURL(url);\r\n      };\r\n    } catch (err) {\r\n      console.error('Error al descargar PDF:', err);\r\n      setToast({\r\n        type: 'error',\r\n        message: 'Error al generar el PDF'\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col space-y-6\">\r\n      {/* Panel de plantillas */}\r\n      {templates.length > 0 && (\r\n        <div className=\"bg-gray-50 p-4 rounded-lg\">\r\n          <h3 className=\"font-semibold mb-3\">Plantillas disponibles</h3>\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3\">\r\n            {templates.map((template, index) => (\r\n              <div \r\n                key={index} \r\n                className={`p-3 border rounded-lg cursor-pointer transition-all ${\r\n                  selectedTemplate === template \r\n                    ? 'border-blue-500 bg-blue-50' \r\n                    : 'border-gray-200 hover:border-blue-300'\r\n                }`}\r\n                onClick={() => handleSelectTemplate(template)}\r\n              >\r\n                <div className=\"flex items-center justify-between mb-2\">\r\n                  <h4 className=\"font-medium\">{template.name}</h4>\r\n                  {selectedTemplate === template && (\r\n                    <span className=\"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded\">Seleccionada</span>\r\n                  )}\r\n                </div>\r\n                <p className=\"text-xs text-gray-600 line-clamp-2\">{template.description}</p>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Editor de prompt */}\r\n      <div className=\"bg-white p-4 border rounded-lg\">\r\n        <label htmlFor=\"prompt\" className=\"block font-medium mb-2\">Prompt para la generaci√≥n</label>\r\n        <div className=\"flex space-x-2\">\r\n          <textarea\r\n            id=\"prompt\"\r\n            value={prompt}\r\n            onChange={(e) => setPrompt(e.target.value)}\r\n            placeholder=\"Describe la imagen que quieres generar...\"\r\n            className=\"flex-1 border rounded-lg p-3 min-h-[100px]\"\r\n          />\r\n        </div>\r\n        <div className=\"mt-4 flex justify-end\">\r\n          <button\r\n            onClick={generateImage}\r\n            disabled={loading || !prompt.trim()}\r\n            className={`flex items-center space-x-2 px-4 py-2 rounded-lg ${\r\n              loading || !prompt.trim() \r\n                ? 'bg-gray-300 cursor-not-allowed' \r\n                : 'bg-blue-600 hover:bg-blue-700 text-white'\r\n            }`}\r\n          >\r\n            {loading ? (\r\n              <><RefreshCcw className=\"animate-spin h-4 w-4\" /><span>Generando...</span></>\r\n            ) : (\r\n              <><Wand2 className=\"h-4 w-4\" /><span>Generar imagen</span></>\r\n            )}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Galer√≠a de im√°genes generadas */}\r\n      {generatedImages.length > 0 && (\r\n        <div className=\"mt-8\">\r\n          <h3 className=\"font-semibold mb-4\">Im√°genes generadas</h3>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n            {generatedImages.map((image) => (\r\n              <div key={image.id} className=\"border rounded-lg overflow-hidden\">\r\n                <div className=\"relative\">\r\n                  <img \r\n                    src={image.url} \r\n                    alt={image.prompt} \r\n                    className=\"w-full h-auto object-contain\"\r\n                    loading=\"lazy\"\r\n                  />\r\n                  <div className=\"absolute top-2 right-2 flex space-x-2\">\r\n                    <button\r\n                      onClick={() => downloadImage(image.url)}\r\n                      className=\"bg-white/80 p-2 rounded-full hover:bg-white\"\r\n                      title=\"Descargar PNG\"\r\n                    >\r\n                      <Download className=\"h-4 w-4\" />\r\n                    </button>\r\n                    <button\r\n                      onClick={() => downloadVectorPdf(image.url)}\r\n                      className=\"bg-white/80 p-2 rounded-full hover:bg-white\"\r\n                      title=\"Descargar PDF\"\r\n                    >\r\n                      <FileDown className=\"h-4 w-4\" />\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n                <div className=\"p-3\">\r\n                  <p className=\"text-sm text-gray-700 line-clamp-2\">{image.prompt}</p>\r\n                  <p className=\"text-xs text-gray-500 mt-1\">\r\n                    {new Date(image.timestamp).toLocaleDateString()} {new Date(image.timestamp).toLocaleTimeString()}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Toast de notificaci√≥n */}\r\n      {toast && (\r\n        <div \r\n          className={`fixed bottom-4 right-4 px-4 py-2 rounded shadow-lg ${\r\n            toast.type === 'error' \r\n              ? 'bg-red-600 text-white' \r\n              : toast.type === 'success' \r\n                ? 'bg-green-600 text-white' \r\n                : 'bg-blue-600 text-white'\r\n          }`}\r\n        >\r\n          {toast.message}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ImageGeneratorAI;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\Input.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\MainLayout.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'role' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":21,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Outlet, Link } from 'react-router-dom';\r\nimport { useAuth } from '../hooks/useAuth';\r\nimport Nav from './Nav';\r\nimport ChatWidget from './ChatWidget';\r\nimport DefaultAvatar from './DefaultAvatar';\r\nimport GlobalSearch from './GlobalSearch';\r\nimport DarkModeToggle from './DarkModeToggle';\r\nimport OnboardingTutorial from './Onboarding/OnboardingTutorial';\r\nimport { useOnboarding } from '../hooks/useOnboarding';\r\nimport RoleBadge from './RoleBadge';\r\nimport WeddingSelector from './WeddingSelector';\r\nimport { useLocation } from 'react-router-dom';\r\n\r\n\r\nexport default function MainLayout() {\r\n  // Nuevo sistema unificado\r\n  const { hasRole, userProfile, isLoading, logout: logoutUnified } = useAuth();\r\n  \r\n  // Usar el nuevo sistema para verificaciones de rol\r\n  const role = userProfile?.role || 'particular';\r\n  const [openMenu, setOpenMenu] = useState(false);\r\n  const location = useLocation();\r\n  const hideSelectorRoutes = ['/home', '/tasks'];\r\n  const hideSelector = hideSelectorRoutes.some(r => location.pathname.startsWith(r)) || location.pathname === '/bodas';\r\n  const isPlanner = userProfile && hasRole ? hasRole('planner') : false;\r\n  const showWeddingSelector = isPlanner && !hideSelector;\r\n  const { showOnboarding, completeOnboarding } = useOnboarding();\r\n\r\n  // Cerrar men√∫ al hacer click fuera\r\n  useEffect(() => {\r\n    const handleClickOutside = (event) => {\r\n      if (openMenu && !event.target.closest('[data-user-menu]')) {\r\n        setOpenMenu(false);\r\n      }\r\n    };\r\n\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => document.removeEventListener('mousedown', handleClickOutside);\r\n  }, [openMenu]);\r\n\r\n  // Mostrar loading mientras se inicializa la autenticaci√≥n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-[var(--color-bg)]\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-600\">Cargando...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (showOnboarding) {\r\n    return (\r\n        <div className=\"min-h-screen flex flex-col bg-[var(--color-bg)]\">\r\n          <OnboardingTutorial onComplete={completeOnboarding} />\r\n        </div>\r\n    );\r\n  }\r\n  return (\r\n      <div className=\"relative min-h-screen flex flex-col bg-[var(--color-bg)] text-[color:var(--color-text)] font-sans\">\r\n        <div className=\"absolute top-4 right-4 z-50 flex items-center space-x-4\">\r\n          {(import.meta.env.PROD || import.meta.env.VITE_SHOW_ROLE_BADGE === 'true') && <RoleBadge /> }\r\n          <div className=\"hidden md:block\">\r\n            <GlobalSearch />\r\n          </div>\r\n          {/* Avatar y men√∫ de usuario */}\r\n          <div className=\"relative\" data-user-menu>\r\n            <div \r\n              onClick={() => setOpenMenu(!openMenu)} \r\n              className={`w-10 h-10 rounded-full cursor-pointer transition-all duration-200 hover:ring-2 hover:ring-blue-300 ${\r\n                openMenu ? 'ring-2 ring-blue-500 bg-blue-50' : 'bg-gray-100 hover:bg-gray-200'\r\n              } flex items-center justify-center`}\r\n              title=\"Men√∫ de usuario\"\r\n            >\r\n              <DefaultAvatar className=\"w-6 h-6 text-gray-600\" />\r\n            </div>\r\n            {openMenu && (\r\n              <div className=\"absolute right-0 mt-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-1 space-y-1 min-w-[200px] z-50\">\r\n                <Link \r\n                  to=\"/perfil\" \r\n                  onClick={() => setOpenMenu(false)} \r\n                  className=\"flex items-center px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors\"\r\n                >\r\n                  üë§ Perfil\r\n                </Link>\r\n                <Link \r\n                  to=\"/notificaciones\" \r\n                  onClick={() => setOpenMenu(false)} \r\n                  className=\"flex items-center px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors\"\r\n                >\r\n                  üîî Notificaciones\r\n                </Link>\r\n                <Link \r\n                  to=\"/email\" \r\n                  onClick={() => setOpenMenu(false)} \r\n                  className=\"flex items-center px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors\"\r\n                >\r\n                  üìß Buz√≥n de Emails\r\n                </Link>\r\n                <div className=\"px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <span className=\"text-sm\">üåô Modo oscuro</span>\r\n                    <DarkModeToggle className=\"ml-2\" />\r\n                  </div>\r\n                </div>\r\n                <div className=\"border-t border-gray-200 dark:border-gray-600 my-1\"></div>\r\n                <button \r\n                  onClick={() => { logoutUnified(); setOpenMenu(false); }} \r\n                  className=\"w-full text-left px-3 py-2 text-sm hover:bg-red-50 dark:hover:bg-red-900/20 text-red-600 dark:text-red-400 rounded-md transition-colors flex items-center\"\r\n                >\r\n                  üö™ Cerrar sesi√≥n\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      \r\n      <main className=\"container flex-grow mx-auto px-4 pt-8 pb-36\">\r\n        {showWeddingSelector && <WeddingSelector />}\r\n        <Outlet />\r\n      </main>\r\n      <Nav />\r\n        <ChatWidget />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\Modal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\Nav.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'hasRole' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":140,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":140,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\n\r\nimport { motion } from 'framer-motion';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\n\r\nimport { useAuth } from '../hooks/useAuth';\r\nimport LanguageSelector from './ui/LanguageSelector';\r\nimport useTranslations from '../hooks/useTranslations';\r\n\r\n// Devuelve los √≠tems de navegaci√≥n seg√∫n rol\r\nfunction getNavItems(role, t) {\r\n  const roleMap = {\r\n    'pareja': 'owner',\r\n    'wedding-planner': 'planner',\r\n    'planner': 'planner',\r\n    'ayudante': 'assistant'\r\n  };\r\n  const rawRole = (role || '').toString().trim().toLowerCase();\r\n  const normalizedRole = roleMap[rawRole] || 'owner';\r\n\r\n  switch (normalizedRole) {\r\n    case 'owner':\r\n      return [\r\n        { path: '/home', label: t('navigation.home') },\r\n        { path: '/tasks', label: t('navigation.tasks') },\r\n        { path: '/finance', label: t('navigation.finance') },\r\n        { path: '/more', label: 'M√°s' },\r\n      ];\r\n    case 'planner':\r\n      return [\r\n        { path: '/home', label: t('navigation.home') },\r\n        { path: '/tasks', label: t('navigation.tasks') },\r\n        { path: '/bodas', label: 'Bodas' },\r\n        { path: '/more', label: 'M√°s' },\r\n      ];\r\n    case 'assistant':\r\n      return [\r\n        { path: '/tasks', label: t('navigation.tasks') },\r\n        { path: '/protocolo', label: 'Protocolo' },\r\n        { path: '/more', label: 'M√°s' },\r\n      ];\r\n    default:\r\n      return [\r\n        { path: '/home', label: t('navigation.home') },\r\n        { path: '/tasks', label: t('navigation.tasks') },\r\n        { path: '/more', label: 'M√°s' },\r\n      ];\r\n  }\r\n}\r\n/*\r\n  // Normalizar nombres de roles provenientes de Firestore\r\n  const roleMap = {\r\n    'pareja': 'owner',\r\n    'wedding-planner': 'planner',\r\n    'planner': 'planner',\r\n    'ayudante': 'assistant'\r\n  };\r\n  const normalizedRole = roleMap[role] || role;\r\n\r\n  if (normalizedRole === 'owner') {\r\n    return [\r\n      { path: '/home', label: 'Inicio' },\r\n      { path: '/tasks', label: 'Tareas' },\r\n      { path: '/finance', label: 'Finanzas' },\r\n      { path: '/more', label: 'M√°s' },\r\n    ];\r\n  }\r\n\r\n  if (normalizedRole === 'planner') {\r\n    return [\r\n      { path: '/home', label: 'Inicio' },\r\n      { path: '/tasks', label: 'Tareas' },\r\n      { path: '/protocolo', label: 'Protocolo' },\r\n      { path: '/more', label: 'M√°s' },\r\n    ];\r\n  }\r\n\r\n  if (normalizedRole === 'assistant') {\r\n    return [\r\n      { path: '/tasks', label: 'Tareas' },\r\n      { path: '/protocolo', label: 'Protocolo' },\r\n      { path: '/more', label: 'M√°s' },\r\n    ];\r\n  }\r\n\r\n  // Fallback (rol no reconocido)\r\n  return [\r\n    { path: '/home', label: 'Inicio' },\r\n    { path: '/tasks', label: 'Tareas' },\r\n    { path: '/more', label: 'M√°s' },\r\n  ];\r\n  // Normalizar nombres de roles provenientes de Firestore\r\n  const roleMap = {\r\n    'pareja': 'owner',\r\n    'wedding-planner': 'planner',\r\n    'planner': 'planner',\r\n    'ayudante': 'assistant'\r\n  };\r\n  const normalizedRole = roleMap[role] || role;\r\n  const common = [\r\n    { path: '/home', label: 'Inicio' },\r\n    { path: '/tasks', label: 'Tareas' },\r\n    { path: '/protocolo', label: 'Protocolo' },\r\n    { path: '/more', label: 'M√°s' },\r\n  ];\r\n\r\n  if (normalizedRole === 'owner') {\r\n    return [\r\n      { path: '/home', label: 'Inicio' },\r\n      { path: '/tasks', label: 'Tareas' },\r\n      { path: '/finance', label: 'Finanzas' },\r\n      { path: '/more', label: 'M√°s' },\r\n    ];\r\n  }\r\n  if (normalizedRole === 'planner') {\r\n    // Planner no ve finanzas, pero puede tener otras secciones espec√≠ficas\r\n    return [\r\n      { path: '/home', label: 'Inicio' },\r\n      { path: '/tasks', label: 'Tareas' },\r\n      { path: '/protocolo', label: 'Protocolo' },\r\n      { path: '/more', label: 'M√°s' },\r\n    ];\r\n  }\r\n  if (normalizedRole === 'assistant') {\r\n    // Asistente: solo tareas y protocolo (m√°s se mantiene)\r\n    return [\r\n      { path: '/tasks', label: 'Tareas' },\r\n      { path: '/protocolo', label: 'Protocolo' },\r\n      { path: '/more', label: 'M√°s' },\r\n    ];\r\n\r\n  }\r\n  // Fallback\r\n  return common;\r\n}\r\n\r\n*/\r\nfunction Nav() {\r\n  // Nuevo sistema unificado\r\n  const { userProfile, hasRole } = useAuth();\r\n  \r\n  // Hook de traducciones\r\n  const { t } = useTranslations();\r\n  \r\n  // Usar el nuevo sistema para el rol, con fallback al legacy\r\n  const role = userProfile?.role || 'owner';\r\n  const navItems = React.useMemo(() => getNavItems(role, t), [role, t]);\r\n  \r\n\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n\r\n  return (\r\n    <nav className='fixed bottom-0 w-full bg-[var(--color-primary)] text-[color:var(--color-text)] shadow-md flex justify-between items-center p-3 z-50'>\r\n      {/* Navegaci√≥n principal */}\r\n      <div className='flex justify-around flex-1'>\r\n        {navItems.map(({ path, label }, idx) => {\r\n          const isActive = location.pathname.startsWith(path);\r\n          return (\r\n            <button\r\n              key={idx}\r\n              onClick={() => navigate(path)}\r\n              className='relative'\r\n            >\r\n              <motion.span\r\n                animate={{ scale: isActive ? 1.1 : 1 }}\r\n                transition={{ type: 'spring', stiffness: 300 }}\r\n                className={isActive ? 'text-[var(--color-accent)] font-semibold' : 'text-[color:var(--color-text)]'}\r\n              >\r\n                {label}\r\n              </motion.span>\r\n              {isActive && (\r\n                <motion.span\r\n                  className='absolute -bottom-1 left-1/2 transform -translate-x-1/2 w-6 h-1 bg-[var(--color-accent)] rounded'\r\n                  layoutId='activeUnderline'\r\n                />\r\n              )}\r\n            </button>\r\n          );\r\n        })}\r\n      </div>\r\n      \r\n      {/* Selector de idioma */}\r\n      <div className='ml-2'>\r\n        <LanguageSelector \r\n          variant=\"minimal\" \r\n          className=\"text-[color:var(--color-text)]\" \r\n        />\r\n      </div>\r\n    </nav>\r\n  );\r\n}\r\n\r\nexport default Nav;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\NotificationCenter.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'X' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from 'react';\r\nimport { Bell, X, Mail, Calendar, User, Trash, Check, AlertTriangle, Info } from 'lucide-react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Button } from './ui';\r\nimport * as NotificationService from '../services/NotificationService';\r\n\r\n/**\r\n * Centro de notificaciones unificado para toda la aplicaci√≥n\r\n * Muestra notificaciones de emails, eventos, proveedores y sistema\r\n * Permite marcar como le√≠do, eliminar y navegar directamente a la fuente de la notificaci√≥n\r\n * \r\n * @returns {React.ReactElement} Componente del centro de notificaciones\r\n */\r\nconst NotificationCenter = () => {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [notifications, setNotifications] = useState([]);\r\n  const [unreadCount, setUnreadCount] = useState(0);\r\n  const [activeTab, setActiveTab] = useState('all');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  \r\n  const notificationRef = useRef(null);\r\n  const navigate = useNavigate();\r\n  \r\n  // Cargar notificaciones al abrir el centro\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      loadNotifications();\r\n    }\r\n  }, [isOpen, activeTab]);\r\n  \r\n  // Cerrar al hacer clic fuera del componente\r\n  useEffect(() => {\r\n    const handleClickOutside = (event) => {\r\n      if (notificationRef.current && !notificationRef.current.contains(event.target)) {\r\n        setIsOpen(false);\r\n      }\r\n    };\r\n    \r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener('mousedown', handleClickOutside);\r\n    };\r\n  }, []);\r\n  \r\n  // Escuchar eventos de notificaci√≥n toast\r\n  useEffect(() => {\r\n    const handleToastEvent = (event) => {\r\n      if (event.detail) {\r\n        showToast(event.detail);\r\n      }\r\n    };\r\n    \r\n    window.addEventListener('lovenda-toast', handleToastEvent);\r\n    \r\n    return () => {\r\n      window.removeEventListener('lovenda-toast', handleToastEvent);\r\n    };\r\n  }, []);\r\n  \r\n  // Cargar notificaciones\r\n  const loadNotifications = async () => {\r\n    setIsLoading(true);\r\n    \r\n    try {\r\n      const filter = activeTab !== 'all' ? activeTab : undefined;\r\n      const notificationData = await NotificationService.getNotifications(filter);\r\n      \r\n      setNotifications(notificationData.notifications || []);\r\n      setUnreadCount(notificationData.unreadCount || 0);\r\n    } catch (error) {\r\n      console.error('Error al cargar notificaciones:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n  \r\n  // Mostrar toast de notificaci√≥n\r\n  const showToast = ({ title, message, type = 'info', duration = 3000 }) => {\r\n    // Crear elemento toast\r\n    const toastElement = document.createElement('div');\r\n    toastElement.className = `fixed bottom-4 right-4 bg-white rounded-md shadow-lg p-4 flex items-start max-w-sm transform transition-all duration-300 z-50 border-l-4 ${getToastBorderColor(type)}`;\r\n    \r\n    // Contenido del toast\r\n    toastElement.innerHTML = `\r\n      <div class=\"flex-shrink-0 mr-3 mt-0.5\">\r\n        ${getToastIcon(type)}\r\n      </div>\r\n      <div class=\"flex-grow\">\r\n        <h3 class=\"font-medium text-gray-900\">${title}</h3>\r\n        <p class=\"text-sm text-gray-600\">${message}</p>\r\n      </div>\r\n      <button class=\"ml-4 text-gray-400 hover:text-gray-600\">\r\n        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n          <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\r\n          <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\r\n        </svg>\r\n      </button>\r\n    `;\r\n    \r\n    // A√±adir al DOM\r\n    document.body.appendChild(toastElement);\r\n    \r\n    // Animaci√≥n de entrada\r\n    setTimeout(() => {\r\n      toastElement.classList.add('translate-y-0', 'opacity-100');\r\n    }, 10);\r\n    \r\n    // Manejar cierre\r\n    const closeButton = toastElement.querySelector('button');\r\n    if (closeButton) {\r\n      closeButton.addEventListener('click', () => {\r\n        removeToast(toastElement);\r\n      });\r\n    }\r\n    \r\n    // Auto-cierre despu√©s de duration\r\n    setTimeout(() => {\r\n      removeToast(toastElement);\r\n    }, duration);\r\n  };\r\n  \r\n  // Eliminar toast del DOM\r\n  const removeToast = (element) => {\r\n    element.classList.add('opacity-0', '-translate-y-2');\r\n    \r\n    setTimeout(() => {\r\n      if (element.parentNode) {\r\n        element.parentNode.removeChild(element);\r\n      }\r\n    }, 300);\r\n  };\r\n  \r\n  // Obtener color de borde para el toast\r\n  const getToastBorderColor = (type) => {\r\n    switch (type) {\r\n      case 'success':\r\n        return 'border-green-500';\r\n      case 'error':\r\n        return 'border-red-500';\r\n      case 'warning':\r\n        return 'border-yellow-500';\r\n      default:\r\n        return 'border-blue-500';\r\n    }\r\n  };\r\n  \r\n  // Obtener icono para el toast\r\n  const getToastIcon = (type) => {\r\n    switch (type) {\r\n      case 'success':\r\n        return `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"text-green-500\">\r\n          <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"></path>\r\n          <polyline points=\"22 4 12 14.01 9 11.01\"></polyline>\r\n        </svg>`;\r\n      case 'error':\r\n        return `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"text-red-500\">\r\n          <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\r\n          <line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"12\"></line>\r\n          <line x1=\"12\" y1=\"16\" x2=\"12.01\" y2=\"16\"></line>\r\n        </svg>`;\r\n      case 'warning':\r\n        return `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"text-yellow-500\">\r\n          <path d=\"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z\"></path>\r\n          <line x1=\"12\" y1=\"9\" x2=\"12\" y2=\"13\"></line>\r\n          <line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\"></line>\r\n        </svg>`;\r\n      default:\r\n        return `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"text-blue-500\">\r\n          <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\r\n          <line x1=\"12\" y1=\"16\" x2=\"12\" y2=\"12\"></line>\r\n          <line x1=\"12\" y1=\"8\" x2=\"12.01\" y2=\"8\"></line>\r\n        </svg>`;\r\n    }\r\n  };\r\n  \r\n  // Manejar clic en notificaci√≥n\r\n  const handleNotificationClick = async (notification) => {\r\n    // Marcar como le√≠da\r\n    if (!notification.read) {\r\n      await NotificationService.markAsRead(notification.id);\r\n      \r\n      // Actualizar estado local\r\n      setNotifications(prevNotifications => \r\n        prevNotifications.map(n => \r\n          n.id === notification.id ? { ...n, read: true } : n\r\n        )\r\n      );\r\n      \r\n      // Actualizar contador\r\n      setUnreadCount(prev => Math.max(0, prev - 1));\r\n    }\r\n    \r\n    // Navegar seg√∫n el tipo de acci√≥n\r\n    if (notification.action) {\r\n      setIsOpen(false);\r\n      \r\n      switch (notification.action) {\r\n        case 'viewEmail':\r\n          navigate(`/buzon/${notification.emailId}`);\r\n          break;\r\n        case 'viewEvent':\r\n          navigate(`/calendario/evento/${notification.eventId}`);\r\n          break;\r\n        case 'viewProvider':\r\n          navigate(`/proveedores/${notification.providerId}`);\r\n          break;\r\n        default:\r\n          // Acci√≥n personalizada o ninguna\r\n          break;\r\n      }\r\n    }\r\n  };\r\n  \r\n  // Eliminar notificaci√≥n\r\n  const handleDeleteNotification = async (event, notificationId) => {\r\n    event.stopPropagation(); // Evitar que se active el clic en la notificaci√≥n\r\n    \r\n    try {\r\n      await NotificationService.deleteNotification(notificationId);\r\n      \r\n      // Actualizar estado local\r\n      const notificationToDelete = notifications.find(n => n.id === notificationId);\r\n      setNotifications(prev => prev.filter(n => n.id !== notificationId));\r\n      \r\n      // Actualizar contador si era no le√≠da\r\n      if (notificationToDelete && !notificationToDelete.read) {\r\n        setUnreadCount(prev => Math.max(0, prev - 1));\r\n      }\r\n      \r\n    } catch (error) {\r\n      console.error('Error al eliminar notificaci√≥n:', error);\r\n    }\r\n  };\r\n  \r\n  // Marcar todas como le√≠das\r\n  const handleMarkAllAsRead = async () => {\r\n    try {\r\n      await NotificationService.markAllAsRead();\r\n      \r\n      // Actualizar estado local\r\n      setNotifications(prev => \r\n        prev.map(n => ({ ...n, read: true }))\r\n      );\r\n      \r\n      setUnreadCount(0);\r\n      \r\n    } catch (error) {\r\n      console.error('Error al marcar todas como le√≠das:', error);\r\n    }\r\n  };\r\n  \r\n  // Renderizar icono seg√∫n el tipo de notificaci√≥n\r\n  const renderNotificationIcon = (notification) => {\r\n    switch (notification.type) {\r\n      case 'email':\r\n        return <Mail size={18} className=\"text-blue-500\" />;\r\n      case 'event':\r\n        return <Calendar size={18} className=\"text-purple-500\" />;\r\n      case 'provider':\r\n        return <User size={18} className=\"text-green-500\" />;\r\n      case 'warning':\r\n        return <AlertTriangle size={18} className=\"text-yellow-500\" />;\r\n      case 'error':\r\n        return <AlertTriangle size={18} className=\"text-red-500\" />;\r\n      default:\r\n        return <Info size={18} className=\"text-gray-500\" />;\r\n    }\r\n  };\r\n  \r\n  // Filtrar notificaciones seg√∫n la pesta√±a activa\r\n  const filteredNotifications = notifications;\r\n  \r\n  return (\r\n    <div className=\"relative\" ref={notificationRef}>\r\n      {/* Bot√≥n de notificaciones */}\r\n      <button\r\n        onClick={() => setIsOpen(prev => !prev)}\r\n        className=\"relative p-2 rounded-full hover:bg-gray-100 focus:outline-none\"\r\n        aria-label=\"Notificaciones\"\r\n      >\r\n        <Bell size={20} />\r\n        {unreadCount > 0 && (\r\n          <span className=\"absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white transform translate-x-1/2 -translate-y-1/2 bg-red-500 rounded-full\">\r\n            {unreadCount > 99 ? '99+' : unreadCount}\r\n          </span>\r\n        )}\r\n      </button>\r\n      \r\n      {/* Panel de notificaciones */}\r\n      {isOpen && (\r\n        <div className=\"absolute right-0 mt-2 w-80 sm:w-96 bg-white rounded-md shadow-lg overflow-hidden z-50\">\r\n          <div className=\"border-b border-gray-200 p-3 flex justify-between items-center\">\r\n            <h3 className=\"font-medium\">Notificaciones</h3>\r\n            <div className=\"flex space-x-2\">\r\n              {unreadCount > 0 && (\r\n                <button\r\n                  onClick={handleMarkAllAsRead}\r\n                  className=\"text-xs text-blue-600 hover:text-blue-800 flex items-center\"\r\n                >\r\n                  <Check size={14} className=\"mr-1\" />\r\n                  Marcar todas como le√≠das\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Pesta√±as de filtro */}\r\n          <div className=\"flex border-b border-gray-200\">\r\n            <button\r\n              onClick={() => setActiveTab('all')}\r\n              className={`flex-grow py-2 text-sm font-medium ${\r\n                activeTab === 'all' \r\n                  ? 'text-blue-600 border-b-2 border-blue-600' \r\n                  : 'text-gray-500 hover:text-gray-700'\r\n              }`}\r\n            >\r\n              Todas\r\n            </button>\r\n            <button\r\n              onClick={() => setActiveTab('email')}\r\n              className={`flex-grow py-2 text-sm font-medium ${\r\n                activeTab === 'email' \r\n                  ? 'text-blue-600 border-b-2 border-blue-600' \r\n                  : 'text-gray-500 hover:text-gray-700'\r\n              }`}\r\n            >\r\n              Emails\r\n            </button>\r\n            <button\r\n              onClick={() => setActiveTab('event')}\r\n              className={`flex-grow py-2 text-sm font-medium ${\r\n                activeTab === 'event' \r\n                  ? 'text-blue-600 border-b-2 border-blue-600' \r\n                  : 'text-gray-500 hover:text-gray-700'\r\n              }`}\r\n            >\r\n              Eventos\r\n            </button>\r\n          </div>\r\n          \r\n          {/* Lista de notificaciones */}\r\n          <div className=\"max-h-80 overflow-y-auto\">\r\n            {isLoading ? (\r\n              <div className=\"flex items-center justify-center p-4\">\r\n                <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500\"></div>\r\n              </div>\r\n            ) : filteredNotifications.length === 0 ? (\r\n              <div className=\"p-4 text-center text-gray-500\">\r\n                No hay notificaciones\r\n              </div>\r\n            ) : (\r\n              <ul>\r\n                {filteredNotifications.map(notification => (\r\n                  <li \r\n                    key={notification.id}\r\n                    onClick={() => handleNotificationClick(notification)}\r\n                    className={`px-4 py-3 border-b border-gray-100 flex items-start hover:bg-gray-50 cursor-pointer transition ${\r\n                      !notification.read ? 'bg-blue-50' : ''\r\n                    }`}\r\n                  >\r\n                    <div className=\"flex-shrink-0 mt-0.5 mr-3\">\r\n                      {renderNotificationIcon(notification)}\r\n                    </div>\r\n                    \r\n                    <div className=\"flex-grow min-w-0\">\r\n                      <p className={`text-sm ${!notification.read ? 'font-medium' : 'text-gray-800'}`}>\r\n                        {notification.message}\r\n                      </p>\r\n                      <p className=\"text-xs text-gray-500 mt-1\">\r\n                        {new Date(notification.timestamp).toLocaleDateString('es-ES', { \r\n                          day: '2-digit',\r\n                          month: '2-digit',\r\n                          hour: '2-digit',\r\n                          minute: '2-digit'\r\n                        })}\r\n                      </p>\r\n                    </div>\r\n                    \r\n                    <button\r\n                      onClick={(e) => handleDeleteNotification(e, notification.id)}\r\n                      className=\"ml-2 text-gray-400 hover:text-gray-600\"\r\n                    >\r\n                      <Trash size={16} />\r\n                    </button>\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n            )}\r\n          </div>\r\n          \r\n          {/* Pie del panel */}\r\n          <div className=\"p-3 border-t border-gray-200 bg-gray-50 text-center\">\r\n            <Button \r\n              variant=\"link\" \r\n              size=\"sm\"\r\n              onClick={() => {\r\n                navigate('/notificaciones');\r\n                setIsOpen(false);\r\n              }}\r\n            >\r\n              Ver todas las notificaciones\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NotificationCenter;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\Onboarding\\OnboardingTutorial.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'updateDoc' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":32},{"ruleId":"no-unused-vars","severity":1,"message":"'Settings' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":74,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":82}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useAuth } from '../../hooks/useAuthUnified';\r\nimport { doc, getDoc, updateDoc, setDoc } from 'firebase/firestore';\r\nimport { createWedding, getWeddingIdForOwner } from '../../services/WeddingService';\r\nimport { googleCalendarService } from '../../services/GoogleCalendarService';\r\nimport { db } from '../../firebaseConfig';\r\nimport { ChevronRight, ChevronLeft, Check, Calendar, Users, ShoppingBag, Settings, Image } from 'lucide-react';\r\n\r\n/**\r\n * Tutorial de onboarding para nuevos usuarios\r\n */\r\nconst OnboardingTutorial = ({ onComplete }) => {\r\n  const { currentUser } = useAuth();\r\n  const [currentStep, setCurrentStep] = useState(0);\r\n  const [profileData, setProfileData] = useState({\r\n    nombres: '',\r\n    apellidos: '',\r\n    fecha: '',\r\n    lugar: '',\r\n    presupuesto: '',\r\n    imagen: ''\r\n  });\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  // Carga datos del perfil si existen\r\n  useEffect(() => {\r\n    const fetchProfileData = async () => {\r\n      if (!currentUser?.uid) return;\r\n      \r\n      try {\r\n        const profileDoc = await getDoc(doc(db, 'users', currentUser.uid));\r\n        if (profileDoc.exists()) {\r\n          const data = profileDoc.data();\r\n          if (data.weddingInfo) {\r\n            setProfileData({\r\n              nombres: data.weddingInfo.brideAndGroom || '',\r\n              apellidos: data.weddingInfo.surnames || '',\r\n              fecha: data.weddingInfo.weddingDate || '',\r\n              lugar: data.weddingInfo.celebrationPlace || '',\r\n              presupuesto: data.weddingInfo.budget || '',\r\n              imagen: data.weddingInfo.profileImage || ''\r\n            });\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('Error al cargar datos del perfil:', error);\r\n      }\r\n    };\r\n\r\n    fetchProfileData();\r\n  }, [currentUser]);\r\n\r\n  const steps = [\r\n    {\r\n      title: \"¬°Bienvenido a Lovenda!\",\r\n      content: (\r\n        <div className=\"text-center\">\r\n          <div className=\"mx-auto w-32 h-32 bg-blue-100 rounded-full flex items-center justify-center mb-6\">\r\n            <img src=\"/logo.png\" alt=\"Lovenda\" className=\"w-20 h-20\" />\r\n          </div>\r\n          <h2 className=\"text-2xl font-bold mb-4\">¬°Comienza a planificar tu boda!</h2>\r\n          <p className=\"mb-6 text-gray-600\">\r\n            Te guiaremos a trav√©s de los primeros pasos para configurar tu boda en Lovenda.\r\n            Este tutorial te ayudar√° a personalizar la app y conocer sus funcionalidades principales.\r\n          </p>\r\n        </div>\r\n      )\r\n    },\r\n    {\r\n      title: \"Datos b√°sicos\",\r\n      content: (\r\n        <div>\r\n          <h2 className=\"text-xl font-semibold mb-4\">Completa los datos b√°sicos de tu boda</h2>\r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700\">Nombres de la pareja</label>\r\n              <input\r\n                type=\"text\"\r\n                value={profileData.nombres}\r\n                onChange={(e) => setProfileData({...profileData, nombres: e.target.value})}\r\n                placeholder=\"Ej: Mar√≠a y Juan\"\r\n                className=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700\">Apellidos</label>\r\n              <input\r\n                type=\"text\"\r\n                value={profileData.apellidos}\r\n                onChange={(e) => setProfileData({...profileData, apellidos: e.target.value})}\r\n                placeholder=\"Ej: Garc√≠a y P√©rez\"\r\n                className=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700\">Fecha de la boda</label>\r\n              <input\r\n                type=\"date\"\r\n                value={profileData.fecha}\r\n                onChange={(e) => setProfileData({...profileData, fecha: e.target.value})}\r\n                className=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700\">Lugar de celebraci√≥n</label>\r\n              <input\r\n                type=\"text\"\r\n                value={profileData.lugar}\r\n                onChange={(e) => setProfileData({...profileData, lugar: e.target.value})}\r\n                placeholder=\"Ej: Madrid\"\r\n                className=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700\">Presupuesto estimado</label>\r\n              <input\r\n                type=\"number\"\r\n                value={profileData.presupuesto}\r\n                onChange={(e) => setProfileData({...profileData, presupuesto: e.target.value})}\r\n                placeholder=\"Ej: 15000\"\r\n                className=\"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )\r\n    },\r\n    {\r\n      title: \"Gesti√≥n de invitados\",\r\n      content: (\r\n        <div>\r\n          <div className=\"mb-6 flex items-center justify-center\">\r\n            <div className=\"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center\">\r\n              <Users className=\"w-8 h-8 text-blue-600\" />\r\n            </div>\r\n          </div>\r\n          <h2 className=\"text-xl font-semibold mb-2 text-center\">Gesti√≥n de Invitados</h2>\r\n          <p className=\"mb-4 text-gray-600 text-center\">\r\n            Organiza tu lista de invitados, confirma asistencia y asigna mesas para la ceremonia.\r\n          </p>\r\n          <ul className=\"space-y-3\">\r\n            <li className=\"flex items-center\">\r\n              <Check className=\"w-5 h-5 text-green-500 mr-2\" />\r\n              <span>A√±ade invitados y sus acompa√±antes</span>\r\n            </li>\r\n            <li className=\"flex items-center\">\r\n              <Check className=\"w-5 h-5 text-green-500 mr-2\" />\r\n              <span>Organiza por grupos (familia, amigos...)</span>\r\n            </li>\r\n            <li className=\"flex items-center\">\r\n              <Check className=\"w-5 h-5 text-green-500 mr-2\" />\r\n              <span>Confirma asistencias y al√©rgenos</span>\r\n            </li>\r\n            <li className=\"flex items-center\">\r\n              <Check className=\"w-5 h-5 text-green-500 mr-2\" />\r\n              <span>Dise√±a el plano de mesas con arrastrar y soltar</span>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      )\r\n    },\r\n    {\r\n      title: \"Proveedores y Presupuesto\",\r\n      content: (\r\n        <div>\r\n          <div className=\"mb-6 flex items-center justify-center\">\r\n            <div className=\"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center\">\r\n              <ShoppingBag className=\"w-8 h-8 text-blue-600\" />\r\n            </div>\r\n          </div>\r\n          <h2 className=\"text-xl font-semibold mb-2 text-center\">Proveedores</h2>\r\n          <p className=\"mb-4 text-gray-600 text-center\">\r\n            Gestiona tus proveedores, consulta con IA y lleva el seguimiento de todos los servicios contratados.\r\n          </p>\r\n          <ul className=\"space-y-3\">\r\n            <li className=\"flex items-center\">\r\n              <Check className=\"w-5 h-5 text-green-500 mr-2\" />\r\n              <span>Busca proveedores recomendados con IA</span>\r\n            </li>\r\n            <li className=\"flex items-center\">\r\n              <Check className=\"w-5 h-5 text-green-500 mr-2\" />\r\n              <span>A√±ade detalles, presupuestos y contratos</span>\r\n            </li>\r\n            <li className=\"flex items-center\">\r\n              <Check className=\"w-5 h-5 text-green-500 mr-2\" />\r\n              <span>Marca favoritos para comparar opciones</span>\r\n            </li>\r\n            <li className=\"flex items-center\">\r\n              <Check className=\"w-5 h-5 text-green-500 mr-2\" />\r\n              <span>Registra pagos y se√±ales para control financiero</span>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      )\r\n    },\r\n    {\r\n      title: \"Calendario y Tareas\",\r\n      content: (\r\n        <div>\r\n          <div className=\"mb-6 flex items-center justify-center\">\r\n            <div className=\"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center\">\r\n              <Calendar className=\"w-8 h-8 text-blue-600\" />\r\n            </div>\r\n          </div>\r\n          <h2 className=\"text-xl font-semibold mb-2 text-center\">Planificaci√≥n</h2>\r\n          <p className=\"mb-4 text-gray-600 text-center\">\r\n            Organiza todo tu calendario y listas de tareas para llevar un control perfecto.\r\n          </p>\r\n          <ul className=\"space-y-3\">\r\n            <li className=\"flex items-center\">\r\n              <Check className=\"w-5 h-5 text-green-500 mr-2\" />\r\n              <span>Sincroniza con Google Calendar y otros</span>\r\n            </li>\r\n            <li className=\"flex items-center\">\r\n              <Check className=\"w-5 h-5 text-green-500 mr-2\" />\r\n              <span>Organiza tareas por prioridad y fecha</span>\r\n            </li>\r\n            <li className=\"flex items-center\">\r\n              <Check className=\"w-5 h-5 text-green-500 mr-2\" />\r\n              <span>Checklists para antes y durante la boda</span>\r\n            </li>\r\n            <li className=\"flex items-center\">\r\n              <Check className=\"w-5 h-5 text-green-500 mr-2\" />\r\n              <span>Recibe recordatorios importantes</span>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      )\r\n    },\r\n    {\r\n      title: \"Dise√±os e Invitaciones\",\r\n      content: (\r\n        <div>\r\n          <div className=\"mb-6 flex items-center justify-center\">\r\n            <div className=\"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center\">\r\n              <Image className=\"w-8 h-8 text-blue-600\" />\r\n            </div>\r\n          </div>\r\n          <h2 className=\"text-xl font-semibold mb-2 text-center\">Dise√±os con IA</h2>\r\n          <p className=\"mb-4 text-gray-600 text-center\">\r\n            Crea invitaciones, men√∫s y otros elementos visuales para tu boda con ayuda de IA.\r\n          </p>\r\n          <ul className=\"space-y-3\">\r\n            <li className=\"flex items-center\">\r\n              <Check className=\"w-5 h-5 text-green-500 mr-2\" />\r\n              <span>Genera dise√±os personalizados con IA</span>\r\n            </li>\r\n            <li className=\"flex items-center\">\r\n              <Check className=\"w-5 h-5 text-green-500 mr-2\" />\r\n              <span>Crea invitaciones, men√∫s y se√±alizaci√≥n</span>\r\n            </li>\r\n            <li className=\"flex items-center\">\r\n              <Check className=\"w-5 h-5 text-green-500 mr-2\" />\r\n              <span>Dise√±a tu logo de boda personalizado</span>\r\n            </li>\r\n            <li className=\"flex items-center\">\r\n              <Check className=\"w-5 h-5 text-green-500 mr-2\" />\r\n              <span>Exporta en alta resoluci√≥n para imprimir</span>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      )\r\n    },\r\n    {\r\n      title: \"¬°Listo para empezar!\",\r\n      content: (\r\n        <div className=\"text-center\">\r\n          <div className=\"mb-6 flex items-center justify-center\">\r\n            <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center\">\r\n              <Check className=\"w-8 h-8 text-green-600\" />\r\n            </div>\r\n          </div>\r\n          <h2 className=\"text-2xl font-bold mb-4\">¬°Todo listo!</h2>\r\n          <p className=\"mb-6 text-gray-600\">\r\n            Has completado el tutorial inicial. Ya puedes comenzar a utilizar todas las funciones de Lovenda para \r\n            planificar la boda de tus sue√±os.\r\n          </p>\r\n          <p className=\"text-sm text-gray-500\">\r\n            Recuerda que puedes acceder a la configuraci√≥n en cualquier momento para modificar tus datos o \r\n            consultar esta gu√≠a nuevamente.\r\n          </p>\r\n        </div>\r\n      )\r\n    }\r\n  ];\r\n\r\n  const handleNext = () => {\r\n    if (currentStep < steps.length - 1) {\r\n      setCurrentStep(currentStep + 1);\r\n    }\r\n  };\r\n\r\n  const handlePrevious = () => {\r\n    if (currentStep > 0) {\r\n      setCurrentStep(currentStep - 1);\r\n    }\r\n  };\r\n\r\n  const handleComplete = async () => {\r\n    if (!currentUser?.uid) {\r\n      onComplete && onComplete();\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      // Guardar datos en weddingInfo\r\n      let wid = await getWeddingIdForOwner(currentUser.uid);\r\n      if (!wid) {\r\n        wid = await createWedding(currentUser.uid, {\r\n          name: profileData.nombres || 'Mi Boda',\r\n          weddingDate: profileData.fecha || undefined,\r\n        });\r\n      }\r\n\r\n      const weddingInfoPayload = {\r\n        brideAndGroom: profileData.nombres,\r\n        surnames: profileData.apellidos,\r\n        weddingDate: profileData.fecha,\r\n        celebrationPlace: profileData.lugar,\r\n        budget: profileData.presupuesto,\r\n        profileImage: profileData.imagen,\r\n      };\r\n\r\n      await setDoc(doc(db, 'weddings', wid, 'weddingInfo'), weddingInfoPayload, { merge: true });\r\n\r\n      // Marcar onboarding completado en users/{uid}\r\n      const profileRef = doc(db, 'users', currentUser.uid);\r\n      await setDoc(profileRef, { onboardingCompleted: true, lastUpdated: new Date().toISOString() }, { merge: true });\r\n      \r\n\r\n\r\n      // Crear evento en calendario si hay fecha de boda\r\n      if (profileData.fecha) {\r\n        try {\r\n          // Asegurar autenticaci√≥n con Google; si el usuario no concede, se ignora\r\n          await googleCalendarService.loadClient().catch(() => {});\r\n          if (!googleCalendarService.isAuthenticated()) {\r\n            await googleCalendarService.signIn().catch(() => {});\r\n          }\r\n          if (googleCalendarService.isAuthenticated()) {\r\n            const startDate = new Date(profileData.fecha + 'T12:00:00');\r\n            const endDate = new Date(startDate.getTime() + 2 * 60 * 60 * 1000);\r\n            await googleCalendarService.createEvent({\r\n              title: 'Boda',\r\n              desc: 'Fecha de la boda planificada en Lovenda',\r\n              start: startDate,\r\n              end: endDate,\r\n              location: profileData.lugar || undefined,\r\n              category: 'LUGAR'\r\n            });\r\n          }\r\n        } catch (calErr) {\r\n          console.error('No se pudo crear evento en el calendario:', calErr);\r\n        }\r\n      }\r\n\r\n      // Llamar al callback cuando se completa\r\n      onComplete && onComplete();\r\n    } catch (error) {\r\n      console.error('Error al guardar datos de onboarding:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n      <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto\">\r\n        {/* Encabezado */}\r\n        <div className=\"bg-gradient-to-r from-pink-500 to-rose-500 text-white px-6 py-4 rounded-t-lg flex justify-between items-start\">\r\n          <div>\r\n            <h3 className=\"font-semibold text-lg\">{steps[currentStep].title}</h3>\r\n            <div className=\"flex mt-2\">\r\n              {steps.map((_, index) => (\r\n                <div\r\n                key={index}\r\n                className={`h-1 rounded-full mr-1 flex-1 ${\r\n                  index <= currentStep ? 'bg-white' : 'bg-white bg-opacity-30'\r\n                }`}\r\n              />\r\n            ))}\r\n            </div>\r\n          </div>\r\n          {/* Bot√≥n saltar */}\r\n          <button\r\n            onClick={handleComplete}\r\n            className=\"text-xs underline hover:text-gray-200\"\r\n          >\r\n            Saltar\r\n          </button>\r\n        </div>\r\n        \r\n        {/* Contenido */}\r\n        <div className=\"px-6 py-6\">\r\n          {steps[currentStep].content}\r\n        </div>\r\n        \r\n        {/* Botones */}\r\n        <div className=\"px-6 py-4 bg-gray-50 rounded-b-lg flex justify-between\">\r\n          <button\r\n            onClick={handlePrevious}\r\n            disabled={currentStep === 0}\r\n            className={`px-4 py-2 rounded flex items-center ${\r\n              currentStep === 0 ? 'text-gray-400 cursor-not-allowed' : 'text-gray-700 hover:bg-gray-200'\r\n            }`}\r\n          >\r\n            <ChevronLeft className=\"w-5 h-5 mr-1\" /> Anterior\r\n          </button>\r\n          \r\n          {currentStep < steps.length - 1 ? (\r\n            <button\r\n              onClick={handleNext}\r\n              className=\"px-4 py-2 bg-rose-500 text-white rounded flex items-center hover:bg-rose-600\"\r\n            >\r\n              Siguiente <ChevronRight className=\"w-5 h-5 ml-1\" />\r\n            </button>\r\n          ) : (\r\n            <button\r\n              onClick={handleComplete}\r\n              disabled={loading}\r\n              className={`px-4 py-2 bg-green-500 text-white rounded flex items-center hover:bg-green-600 ${\r\n                loading ? 'opacity-70 cursor-wait' : ''\r\n              }`}\r\n            >\r\n              {loading ? 'Guardando...' : 'Finalizar'} <Check className=\"w-5 h-5 ml-1\" />\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default OnboardingTutorial;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\PageWrapper.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Button' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport Button from './Button';\r\n\r\n/**\r\n * PageWrapper encapsula la estructura com√∫n de p√°gina: t√≠tulo fuera de los cards\r\n * y contenedor principal con paddings y espacio vertical.\r\n * Props:\r\n *  - title: string (t√≠tulo principal)\r\n *  - actions: ReactNode (botones u otros elementos a la derecha del t√≠tulo)\r\n *  - className: clases tailwind opcionales para el contenedor principal\r\n *  - children: contenido de la p√°gina (Cards y secciones)\r\n */\r\nexport default function PageWrapper({ title, actions = null, className = '', children }) {\r\n  return (\r\n    <div className={`p-4 md:p-6 space-y-8 ${className}`}>\r\n      {(title || actions) && (\r\n        <div className=\"flex items-center justify-between flex-wrap gap-2\">\r\n          {title && <h1 className=\"text-2xl font-bold text-gray-800 mr-auto\">{title}</h1>}\r\n          {actions && <div className=\"flex gap-2\">{actions}</div>}\r\n        </div>\r\n      )}\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\Pagination.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\PlannerDashboard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\ProviderConfigModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\ProviderSearchModal.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Star' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef, useCallback, useMemo } from 'react';\r\nimport { Search, RefreshCcw, Star, MapPin } from 'lucide-react';\r\nimport { saveData } from '../services/SyncService';\r\nimport { doc, getDoc } from 'firebase/firestore';\r\nimport { db } from '../firebaseConfig';\r\nimport { useWedding } from '../context/WeddingContext';\r\nimport Spinner from './Spinner';\r\n\r\nexport default function ProviderSearchModal({ onClose, onSelectProvider }) {\r\n  const { activeWedding } = useWedding();\r\n  const [aiQuery, setAiQuery] = useState('');\r\n  const [serviceFilter, setServiceFilter] = useState('');\r\n  const [budgetRange, setBudgetRange] = useState('');\r\n  const [aiLoading, setAiLoading] = useState(false);\r\n  const [aiResults, setAiResults] = useState([]);\r\n  const [showResults, setShowResults] = useState(false);\r\n  const [toast, setToast] = useState(null);\r\n\r\n  const modalRef = useRef(null);\r\n\r\n  // Cerrar al hacer clic fuera usando referencia (por si overlay pierde eventos)\r\n  useEffect(() => {\r\n    const handleOutside = (e) => {\r\n      if (modalRef.current && !modalRef.current.contains(e.target)) {\r\n        onClose();\r\n      }\r\n    };\r\n    document.addEventListener('mousedown', handleOutside);\r\n    return () => document.removeEventListener('mousedown', handleOutside);\r\n  }, [onClose]);\r\n\r\n  // Cerrar con tecla ESC\r\n  useEffect(() => {\r\n    const handleEsc = (e) => {\r\n      if (e.key === 'Escape') onClose();\r\n    };\r\n    document.addEventListener('keydown', handleEsc);\r\n    return () => document.removeEventListener('keydown', handleEsc);\r\n  }, [onClose]);\r\n\r\n  // Servicios comunes para bodas (memoizado para performance)\r\n  const commonServices = useMemo(() => [\r\n    'Catering', 'Fot√≥grafo', 'M√∫sica', 'Flores',\r\n    'Vestidos', 'Decoraci√≥n', 'Lugar', 'Transporte',\r\n    'Invitaciones', 'Pasteles', 'Joyer√≠a', 'Detalles'\r\n  ], []);\r\n\r\n  // Verificar la operatividad de enlaces de proveedores (memoizada)\r\n  const verifyProviderLinks = useCallback(async (providers) => {\r\n    console.log('Verificando validez de enlaces de proveedores...');\r\n    \r\n    // Crear un array de proveedores normalizados (asegurar que todos tienen campos consistentes)\r\n    const normalizedProviders = providers.map(provider => ({\r\n      title: provider.title || provider.name || 'Proveedor sin nombre',\r\n      link: provider.link || provider.url || '',\r\n      snippet: provider.snippet || provider.description || '',\r\n      service: provider.service || serviceFilter || 'Proveedor',\r\n      location: provider.location || 'No especificada',\r\n      priceRange: provider.priceRange || provider.price || 'Consultar',\r\n      image: provider.image || '',\r\n      // Por defecto consideramos v√°lido hasta que se demuestre lo contrario\r\n      verified: true\r\n    }));\r\n    \r\n    // Filtrar proveedores con enlaces vac√≠os o mal formados\r\n    const validProviders = normalizedProviders.filter(provider => {\r\n      const link = provider.link || '';\r\n      // Verificaci√≥n b√°sica del formato del enlace\r\n      return link && \r\n        (link.startsWith('http://') || link.startsWith('https://')) &&\r\n        link.includes('.');\r\n    });\r\n    \r\n    console.log(`${validProviders.length} de ${normalizedProviders.length} tienen enlaces potencialmente v√°lidos`);\r\n    \r\n    // Si no hay proveedores v√°lidos despu√©s del filtro, devolver al menos uno como respaldo\r\n    if (validProviders.length === 0 && normalizedProviders.length > 0) {\r\n      // Crear un resultado de respaldo para el directorio de bodas.net\r\n      return [{\r\n        title: 'Directorio de proveedores para bodas',\r\n        link: `https://www.bodas.net/busqueda/${(serviceFilter || 'proveedores').toLowerCase().replace(/\\s+/g, '-')}-espana`,\r\n        snippet: `Encuentra proveedores de ${serviceFilter || 'boda'} en toda Espa√±a`,\r\n        service: serviceFilter || 'Proveedor',\r\n        location: 'Espa√±a',\r\n        priceRange: 'Varios precios disponibles',\r\n        verified: true\r\n      }];\r\n    }\r\n    \r\n    return validProviders;\r\n  }, [serviceFilter]);\r\n\r\n  // Manejar b√∫squeda con IA (memoizada)\r\n  const handleAiSearch = useCallback(async (e) => {\r\n    e.preventDefault();\r\n    if (!aiQuery.trim()) return;\r\n    setAiLoading(true);\r\n    \r\n    try {\r\n      let profile = {};\r\n        if (activeWedding) {\r\n          const infoSnap = await getDoc(doc(db, 'weddings', activeWedding, 'weddingInfo'));\r\n          if (infoSnap.exists()) profile = infoSnap.data();\r\n        }\r\n      \r\n      // Extraer informaci√≥n de ubicaci√≥n del perfil\r\n      let locationInfo = '';\r\n      \r\n      if (profile.celebrationPlace) {\r\n        locationInfo = profile.celebrationPlace;\r\n      }\r\n      \r\n      const formattedLocation = locationInfo || 'Valencia';\r\n      \r\n      // Intentar realizar la b√∫squeda a trav√©s del API proxy\r\n      try {\r\n        const res = await fetch('/api/ai-suppliers', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ \r\n            query: aiQuery, \r\n            service: serviceFilter, \r\n            budget: budgetRange, \r\n            profile: profile,\r\n            location: formattedLocation\r\n          })\r\n        });\r\n        \r\n        let data = [];\r\n        if (res.ok) {\r\n          try {\r\n            data = await res.json();\r\n          } catch (_) { /* cuerpo vac√≠o */ }\r\n        }\r\n        \r\n        if (Array.isArray(data) && data.length) {\r\n          // Verificar operatividad de los enlaces antes de mostrarlos\r\n          const verifiedResults = await verifyProviderLinks(data);\r\n          setAiResults(verifiedResults);\r\n          setShowResults(true);\r\n          saveData('lovendaSuppliers', verifiedResults, { firestore: false, showNotification: false });\r\n          window.dispatchEvent(new Event('lovenda-suppliers'));\r\n          return;\r\n        }\r\n      } catch (err) {\r\n        console.error(\"Error en solicitud API:\", err);\r\n      }\r\n      \r\n      // Si la solicitud API fall√≥ o no devolvi√≥ resultados, usar OpenAI directamente\r\n      await fetchOpenAi();\r\n    } catch (err) {\r\n      console.error(\"Error general:\", err);\r\n      setToast({ \r\n        message: 'Error al buscar proveedores. Int√©ntalo de nuevo m√°s tarde.', \r\n        type: 'error' \r\n      });\r\n    } finally {\r\n      setAiLoading(false);\r\n    }\r\n  }, [aiQuery, activeWedding, serviceFilter, budgetRange, verifyProviderLinks]);\r\n\r\n  // Funci√≥n para buscar proveedores usando OpenAI directamente\r\n  const fetchOpenAi = async () => {\r\n    try {\r\n      let profile = {};\r\n        if (activeWedding) {\r\n          const infoSnap = await getDoc(doc(db, 'weddings', activeWedding, 'weddingInfo'));\r\n          if (infoSnap.exists()) profile = infoSnap.data();\r\n        }\r\n      \r\n      // Extraer datos relevantes del perfil\r\n      const servicioSeleccionado = serviceFilter || '';\r\n      let locationInfo = '';\r\n      \r\n      if (profile.celebrationPlace) {\r\n        locationInfo = profile.celebrationPlace;\r\n      }\r\n      \r\n      const formattedLocation = locationInfo || 'Valencia';\r\n      \r\n      // Crear el prompt para OpenAI\r\n      const locationPrompt = formattedLocation ? \r\n        `La boda es en ${formattedLocation}.` : \r\n        'La ubicaci√≥n de la boda no est√° especificada.';\r\n      \r\n      const budgetPrompt = budgetRange ? \r\n        `El presupuesto es ${budgetRange}.` : \r\n        'No hay un presupuesto especificado.';\r\n      \r\n      const prompt = `Act√∫a como un asistente de bodas que busca proveedores.\r\n        Necesito encontrar proveedores de \"${servicioSeleccionado || 'servicios para bodas'}\" \r\n        que ofrezcan: \"${aiQuery}\".\r\n        ${locationPrompt}\r\n        ${budgetPrompt}\r\n        \r\n        Devuelve √öNICAMENTE un array JSON con 5 opciones de proveedores reales, \r\n        con este formato exacto por cada proveedor:\r\n        {\r\n          \"title\": \"Nombre del proveedor\",\r\n          \"link\": \"URL de su web oficial o perfil en plataforma de bodas\",\r\n          \"snippet\": \"Breve descripci√≥n del servicio que ofrecen\",\r\n          \"service\": \"${servicioSeleccionado || 'Servicios para bodas'}\",\r\n          \"location\": \"Ubicaci√≥n del proveedor (ciudad o provincia)\",\r\n          \"priceRange\": \"Rango de precios aproximado\"\r\n        }\r\n        \r\n        Aseg√∫rate de:\r\n        1. Incluir enlaces reales y operativos, preferiblemente web oficial o perfil en bodas.net\r\n        2. Priorizar proveedores en ${formattedLocation || 'la ubicaci√≥n de la boda'}\r\n        3. Que los proveedores sean relevantes para la b√∫squeda \"${aiQuery}\"\r\n        4. SOLO devolver el array JSON, sin texto adicional ni explicaciones`;\r\n      \r\n      const response = await fetch('https://api.openai.com/v1/chat/completions', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${import.meta.env.VITE_OPENAI_API_KEY}`,\r\n        'OpenAI-Project': import.meta.env.VITE_OPENAI_PROJECT_ID\r\n        },\r\n        body: JSON.stringify({\r\n          model: \"gpt-3.5-turbo\",\r\n          messages: [{ role: \"user\", content: prompt }],\r\n          temperature: 0.7\r\n        })\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        const error = await response.json();\r\n        throw new Error(`Error en la API de OpenAI: ${error.error?.message || 'Error desconocido'}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      \r\n      if (!data.choices || !data.choices.length) {\r\n        throw new Error('Respuesta vac√≠a de OpenAI');\r\n      }\r\n      \r\n      if (!data.choices[0].message || !data.choices[0].message.content) {\r\n        throw new Error('Formato de respuesta inv√°lido');\r\n      }\r\n      \r\n      // Intentar extraer los resultados del texto de respuesta\r\n      const content = data.choices[0].message.content;\r\n      \r\n      // Detectar si la respuesta contiene un mensaje de error expl√≠cito\r\n      if (content.toLowerCase().includes('error') && content.length < 150) {\r\n        throw new Error(`Error reportado por OpenAI: ${content}`);\r\n      }\r\n      \r\n      // Intentar extraer JSON de la respuesta con estrategias m√∫ltiples\r\n      let jsonMatches = content.match(/```json\\s*([\\s\\S]+?)\\s*```/) || \r\n                        content.match(/```\\s*([\\s\\S]+?)\\s*```/) ||\r\n                        content.match(/\\[\\s*\\{[\\s\\S]*\\}\\s*\\]/);\r\n      \r\n      // Si encontramos array directo\r\n      if (jsonMatches && jsonMatches[0].startsWith('[')) {\r\n        jsonMatches = [null, jsonMatches[0]];\r\n      }\r\n      \r\n      // Si todo falla, usar texto completo\r\n      if (!jsonMatches) {\r\n        jsonMatches = [null, content.trim()];\r\n      }\r\n      \r\n      if (!jsonMatches || !jsonMatches[1]) {\r\n        console.error('No se pudo extraer JSON de la respuesta');\r\n        throw new Error('No se pudo extraer JSON de la respuesta');\r\n      }\r\n      \r\n      // Intentar analizar el JSON\r\n      let results = [];\r\n      try {\r\n        const jsonText = jsonMatches[1].trim();\r\n        results = JSON.parse(jsonText);\r\n      } catch (jsonError) {\r\n        console.error('Error al parsear JSON:', jsonError);\r\n        \r\n        try {\r\n          // Intento alternativo: buscar corchetes de array\r\n          const startIdx = jsonMatches[1].indexOf('[');\r\n          const endIdx = jsonMatches[1].lastIndexOf(']');\r\n          \r\n          if (startIdx !== -1 && endIdx !== -1 && startIdx < endIdx) {\r\n            const arrayText = jsonMatches[1].substring(startIdx, endIdx + 1);\r\n            results = JSON.parse(arrayText);\r\n          } else {\r\n            throw new Error('No se encontr√≥ estructura de array en la respuesta');\r\n          }\r\n        } catch (subError) {\r\n          // Crear resultado manual si todo falla\r\n          const lines = content.split('\\n');\r\n          const providerCandidates = lines.filter(line => \r\n            line.trim().length > 10 && \r\n            /^[A-Z]/.test(line.trim()) && \r\n            !line.trim().startsWith('```')\r\n          );\r\n          \r\n          if (providerCandidates.length > 0) {\r\n            results = providerCandidates.map((line, index) => ({\r\n              title: line.trim().split(':')[0] || `Proveedor ${index + 1}`,\r\n              name: line.trim().split(':')[0] || `Proveedor ${index + 1}`,\r\n              link: `https://www.bodas.net/busqueda/${servicioSeleccionado.toLowerCase().replace(/\\s+/g, '-')}-${formattedLocation ? formattedLocation.split(',')[0].toLowerCase() : 'espana'}`,\r\n              snippet: line,\r\n              service: servicioSeleccionado,\r\n              location: formattedLocation || 'Espa√±a',\r\n              priceRange: 'Consultar'\r\n            }));\r\n          }\r\n        }\r\n      }\r\n      \r\n      // Verificar que results es un array\r\n      if (!Array.isArray(results)) {\r\n        console.error('El resultado no es un array:', results);\r\n        results = [];\r\n      }\r\n      \r\n      // Verificar y normalizar los resultados\r\n      const validResults = await verifyProviderLinks(results);\r\n      \r\n      if (validResults.length === 0 && results.length > 0) {\r\n        // Crear un resultado de respaldo para evitar que no haya resultados\r\n        validResults.push({\r\n          title: 'Directorio de proveedores para bodas',\r\n          link: `https://www.bodas.net/busqueda/${servicioSeleccionado.toLowerCase().replace(/\\s+/g, '-')}-${formattedLocation ? formattedLocation.split(',')[0].toLowerCase() : 'espana'}`,\r\n          snippet: `Encuentra proveedores de ${servicioSeleccionado} en ${formattedLocation || 'toda Espa√±a'}`,\r\n          service: servicioSeleccionado,\r\n          location: formattedLocation || 'Espa√±a',\r\n          priceRange: 'Varios precios disponibles',\r\n          verified: true\r\n        });\r\n      }\r\n      \r\n      // Mostrar los resultados\r\n      if (validResults.length > 0) {\r\n        setAiResults(validResults);\r\n        setShowResults(true);\r\n        saveData('lovendaSuppliers', validResults, { firestore: false, showNotification: false });\r\n        window.dispatchEvent(new Event('lovenda-suppliers'));\r\n      } else {\r\n        setToast({ \r\n          message: 'No se encontraron proveedores que coincidan con tu b√∫squeda. Intenta con otros t√©rminos.', \r\n          type: 'info' \r\n        });\r\n      }\r\n    } catch (err) {\r\n      console.error('Error en la b√∫squeda de proveedores:', err);\r\n      setToast({ \r\n        message: 'Error al buscar proveedores. Int√©ntalo de nuevo m√°s tarde.', \r\n        type: 'error' \r\n      });\r\n    }\r\n  };\r\n\r\n  const selectProvider = useCallback((item) => {\r\n    if (onSelectProvider) {\r\n      onSelectProvider(item);\r\n    }\r\n    onClose();\r\n  }, [onSelectProvider, onClose]);\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-[999]\" onMouseDownCapture={(e)=>{if(e.target===e.currentTarget) onClose();}}>\r\n      <div ref={modalRef} role=\"dialog\" aria-modal=\"true\"\r\n        className=\"bg-white rounded shadow-lg w-full max-w-lg max-h-[90vh] flex flex-col p-4 m-4 overflow-y-auto\"\r\n        onClick={(e) => e.stopPropagation()}\r\n      >\r\n        <h3 className=\"text-xl font-semibold mb-4\">Buscar proveedor</h3>\r\n        \r\n        {/* Formulario de b√∫squeda */}\r\n        <form onSubmit={handleAiSearch} className=\"space-y-4 mb-6\">\r\n          <div className=\"flex flex-col md:flex-row gap-4\">\r\n            <div className=\"flex-1\">\r\n              <input \r\n                value={aiQuery} \r\n                onChange={e => setAiQuery(e.target.value)} \r\n                className=\"w-full border rounded p-3\" \r\n                placeholder=\"¬øQu√© buscas? Ej: Fot√≥grafo con experiencia en bodas al aire libre\" \r\n              />\r\n            </div>\r\n            <button \r\n              type=\"submit\" \r\n              className=\"bg-blue-600 text-white rounded-full p-3 flex items-center justify-center\" \r\n              disabled={aiLoading}\r\n            >\r\n              {aiLoading ? <RefreshCcw className=\"animate-spin\" /> : <Search />}\r\n            </button>\r\n          </div>\r\n          \r\n          <div className=\"flex flex-col md:flex-row gap-4\">\r\n            <div className=\"flex-1\">\r\n              <select \r\n                value={serviceFilter} \r\n                onChange={e => setServiceFilter(e.target.value)} \r\n                className=\"w-full border rounded p-3\"\r\n              >\r\n                <option value=\"\">Todos los servicios</option>\r\n                {commonServices.map((service, idx) => (\r\n                  <option key={idx} value={service}>{service}</option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n            <div className=\"flex-1\">\r\n              <select \r\n                value={budgetRange} \r\n                onChange={e => setBudgetRange(e.target.value)} \r\n                className=\"w-full border rounded p-3\"\r\n              >\r\n                <option value=\"\">Cualquier presupuesto</option>\r\n                <option value=\"econ√≥mico\">Econ√≥mico</option>\r\n                <option value=\"medio\">Precio medio</option>\r\n                <option value=\"premium\">Premium</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n        </form>\r\n        \r\n        {/* Indicador de carga */}\r\n        {aiLoading && (\r\n          <div className=\"flex-1 flex items-center justify-center\">\r\n            <Spinner text=\"Buscando proveedores...\" />\r\n          </div>\r\n        )}\r\n        \r\n        {/* Resultados de b√∫squeda */}\r\n        {!aiLoading && showResults && (\r\n          <div className=\"flex-1 overflow-y-auto\">\r\n            <h4 className=\"font-medium mb-2\">Resultados ({aiResults.length})</h4>\r\n            {aiResults.length === 0 ? (\r\n              <p className=\"text-gray-500\">No se encontraron proveedores que coincidan con tu b√∫squeda.</p>\r\n            ) : (\r\n              <div className=\"space-y-4\">\r\n                {aiResults.map((item, idx) => (\r\n                  <div key={idx} className=\"border rounded p-3 hover:bg-gray-50 cursor-pointer\" onClick={() => selectProvider(item)}>\r\n                    <div className=\"flex justify-between items-start\">\r\n                      <div>\r\n                        <p className=\"font-semibold text-blue-600\">{item.title || item.name}</p>\r\n                        <div className=\"flex items-center text-xs text-gray-600 mt-1 space-x-2\">\r\n                          <span className=\"flex items-center\">\r\n                            <MapPin size={12} className=\"mr-1\" />\r\n                            {item.location || 'No especificada'}\r\n                          </span>\r\n                          {item.priceRange && (\r\n                            <span className=\"flex items-center\">\r\n                              <span className=\"mr-1\">üí∞</span>\r\n                              {item.priceRange}\r\n                            </span>\r\n                          )}\r\n                          {item.service && (\r\n                            <span className=\"bg-gray-100 px-2 py-0.5 rounded\">\r\n                              {item.service}\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    <p className=\"text-sm mt-2 text-gray-700 line-clamp-2\">\r\n                      {item.snippet || 'Sin descripci√≥n disponible'}\r\n                    </p>\r\n                    {item.link && (\r\n                      <a \r\n                        href={item.link} \r\n                        target=\"_blank\" \r\n                        rel=\"noopener noreferrer\" \r\n                        className=\"text-xs text-blue-600 hover:underline mt-1 inline-block\"\r\n                        onClick={(e) => e.stopPropagation()}\r\n                      >\r\n                        {new URL(item.link).hostname.replace('www.', '')}\r\n                      </a>\r\n                    )}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n        \r\n        {/* Toast para mensajes */}\r\n        {toast && (\r\n          <div className={`fixed bottom-4 right-4 px-4 py-2 rounded shadow-lg ${toast.type === 'error' ? 'bg-red-600 text-white' : toast.type === 'success' ? 'bg-green-600 text-white' : 'bg-blue-600 text-white'}`}>\r\n            {toast.message}\r\n          </div>\r\n        )}\r\n        \r\n        {/* Botones de acci√≥n */}\r\n        <div className=\"mt-4 pt-4 border-t flex justify-end space-x-2\">\r\n          <button onClick={onClose} className=\"px-4 py-2 bg-gray-200 rounded\">\r\n            Cerrar\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\RoleBadge.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'hasRole' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":6,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { useAuth } from '../hooks/useAuth';\r\n\r\nexport default function RoleBadge() {\r\n  // Nuevo sistema unificado\r\n  const { hasRole, userProfile } = useAuth();\r\n  \r\n  // Usar el nuevo sistema para verificaciones de rol\r\n  const role = userProfile?.role;\r\n  const [visible, setVisible] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => setVisible(false), 5000); // Ocultar tras 5 s\r\n    return () => clearTimeout(timer);\r\n  }, []);\r\n\r\n  if (!role || !visible) return null;\r\n\r\n  const roleLabelMap = {\r\n    owner: 'Pareja',\r\n    planner: 'Wedding Planner',\r\n    assistant: 'Ayudante',\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed bottom-24 right-4 z-60\">\r\n      <div className=\"bg-rose-600 text-white px-4 py-2 rounded-full shadow-lg animate-bounce\">\r\n        Rol actual: {roleLabelMap[role] || role}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\SafeRenderer.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\n\r\n/**\r\n * Componente SafeRenderer para manejar funciones que pueden retornar Promesas\r\n * y prevenir el error \"Objects are not valid as a React child (found: [object Promise])\"\r\n * \r\n * @param {Object} props\r\n * @param {Function} props.render - Funci√≥n que puede retornar una Promesa o contenido JSX\r\n * @param {React.ReactNode} props.fallback - Contenido a mostrar mientras se resuelve la Promesa\r\n * @param {React.ReactNode} props.errorFallback - Contenido a mostrar si hay error\r\n */\r\nconst SafeRenderer = ({ render, fallback = null, errorFallback = null }) => {\r\n  const [content, setContent] = useState(fallback);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const executeRender = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        \r\n        // Ejecutar la funci√≥n de renderizado\r\n        const result = render();\r\n        \r\n        // Si es una Promesa, esperarla\r\n        if (result && typeof result.then === 'function') {\r\n          const resolvedResult = await result;\r\n          setContent(resolvedResult);\r\n        } else {\r\n          // Si no es una Promesa, usar directamente\r\n          setContent(result);\r\n        }\r\n      } catch (err) {\r\n        console.error('Error en SafeRenderer:', err);\r\n        setError(err);\r\n        setContent(errorFallback || 'Error al renderizar contenido');\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    executeRender();\r\n  }, [render, errorFallback]);\r\n\r\n  if (error && errorFallback) {\r\n    return errorFallback;\r\n  }\r\n\r\n  if (isLoading && fallback) {\r\n    return fallback;\r\n  }\r\n\r\n  // Asegurar que siempre retornamos contenido v√°lido para React\r\n  if (content === null || content === undefined) {\r\n    return null;\r\n  }\r\n\r\n  // Si el contenido es una Promesa (no deber√≠a pasar, pero por seguridad)\r\n  if (content && typeof content.then === 'function') {\r\n    console.warn('SafeRenderer: Se detect√≥ una Promesa no resuelta, retornando fallback');\r\n    return fallback || null;\r\n  }\r\n\r\n  return content;\r\n};\r\n\r\n/**\r\n * Hook para manejar funciones que pueden retornar Promesas de manera segura\r\n * @param {Function} asyncFunction - Funci√≥n que puede retornar una Promesa\r\n * @param {any} defaultValue - Valor por defecto mientras se resuelve\r\n */\r\nexport const useSafeAsync = (asyncFunction, defaultValue = null) => {\r\n  const [value, setValue] = useState(defaultValue);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const execute = async () => {\r\n      try {\r\n        setLoading(true);\r\n        setError(null);\r\n        \r\n        const result = asyncFunction();\r\n        \r\n        if (result && typeof result.then === 'function') {\r\n          const resolvedResult = await result;\r\n          setValue(resolvedResult);\r\n        } else {\r\n          setValue(result);\r\n        }\r\n      } catch (err) {\r\n        console.error('Error en useSafeAsync:', err);\r\n        setError(err);\r\n        setValue(defaultValue);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    execute();\r\n  }, [asyncFunction, defaultValue]);\r\n\r\n  return { value, loading, error };\r\n};\r\n\r\n/**\r\n * Funci√≥n utilitaria para asegurar que una funci√≥n nunca retorne una Promesa en JSX\r\n * @param {Function} fn - Funci√≥n a ejecutar\r\n * @param {any} fallback - Valor de fallback si la funci√≥n retorna una Promesa\r\n */\r\nexport const safeExecute = (fn, fallback = '') => {\r\n  try {\r\n    const result = fn();\r\n    \r\n    // Si es una Promesa, retornar el fallback\r\n    if (result && typeof result.then === 'function') {\r\n      console.warn('safeExecute: Funci√≥n retorn√≥ una Promesa, usando fallback');\r\n      return fallback;\r\n    }\r\n    \r\n    return result;\r\n  } catch (error) {\r\n    console.error('Error en safeExecute:', error);\r\n    return fallback;\r\n  }\r\n};\r\n\r\nexport default SafeRenderer;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\SearchBar.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'onResults' is defined but never used. Allowed unused args must match /^_/u.","line":3,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":46}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\n\r\nexport default function SearchBar({ onResults, onSearch }) {\r\n  const [q, setQ] = useState('');\r\n  const [type, setType] = useState('hashtag');\r\n\r\n  const handleSearch = () => {\r\n    onSearch({ query: q, type });\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex gap-2 mb-4\">\r\n      <select\r\n        value={type}\r\n        onChange={(e) => setType(e.target.value)}\r\n        className=\"border px-2 py-1 rounded\"\r\n      >\r\n        <option value=\"hashtag\">Hashtag</option>\r\n        <option value=\"author\">Autor</option>\r\n        <option value=\"keyword\">Palabra clave</option>\r\n      </select>\r\n      <input\r\n        type=\"text\"\r\n        placeholder=\"Buscar...\"\r\n        value={q}\r\n        onChange={(e) => setQ(e.target.value)}\r\n        className=\"border px-2 py-1 flex-grow rounded\"\r\n      />\r\n      <button\r\n        onClick={handleSearch}\r\n        className=\"px-3 py-1 bg-[var(--color-primary)] text-white rounded\"\r\n      >\r\n        Buscar\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\SeatItem.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\SpaceConfigModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\Spinner.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\SyncIndicator.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\TableConfigModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\TableItem.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'guestCount' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":50,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":50,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'getFirst' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":156,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":156,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useRef } from 'react';\r\nimport { useDrop } from 'react-dnd';\r\nimport { ItemTypes } from './GuestItem';\r\n\r\n// Basic draggable table (circle or rectangle)\r\n// Helper para obtener primer nombre (m√°x 8 caracteres)\r\nconst firstName = (str='?') => {\r\n  const first = String(str).trim().split(/\\s+/)[0] || '?';\r\n  return first.length>8? first.slice(0,8)+'‚Ä¶' : first;\r\n};\r\nexport default function TableItem({ table, scale, offset, onMove, onAssignGuest, onToggleEnabled, onOpenConfig, onSelect, guests = [], canMove = true }) {\r\n  // Decide qu√© texto mostrar en cada asiento seg√∫n el nivel de zoom\r\n  const getLabel = (name='?') => {\r\n    if (scale >= 1.5) {\r\n      return firstName(name); // nombre (o parte) cuando hay zoom suficiente\r\n    }\r\n    // Iniciales (m√°x. 2) cuando est√° alejado\r\n    const initials = String(name).trim().split(/\\s+/).map(w=>w[0]).filter(Boolean).slice(0,2).join('').toUpperCase();\r\n    return initials || '?';\r\n  };\r\n  const ref = useRef(null);\r\n\r\n  // drop logic\r\n  const [{ isOver }, drop] = useDrop(() => ({\r\n    accept: ItemTypes.GUEST,\r\n    canDrop: () => table.enabled !== false && !table.guestId,\r\n    drop: (item) => onAssignGuest(table.id, item.id),\r\n    collect: (monitor) => ({ isOver: monitor.isOver() }),\r\n  }), [table.id]);\r\n\r\n  const handlePointerDown = (e) => {\r\n    e.stopPropagation();\r\n    const start = { x: e.clientX, y: e.clientY };\r\n    const orig = { x: table.x, y: table.y };\r\n    const move = (ev) => {\r\n      const dx = (ev.clientX - start.x) / scale;\r\n      const dy = (ev.clientY - start.y) / scale;\r\n      onMove(table.id, { x: orig.x + dx, y: orig.y + dy });\r\n    };\r\n    const up = () => {\r\n      window.removeEventListener('pointermove', move);\r\n      window.removeEventListener('pointerup', up);\r\n    };\r\n    window.addEventListener('pointermove', move);\r\n    window.addEventListener('pointerup', up);\r\n  };\r\n\r\n  // Contar invitados asignados considerando acompa√±antes\r\n  // Total de personas (invitado + acompa√±antes) asignadas a esta mesa\r\n  const guestCount = (() => {\r\n    // Conteo desde lista global de invitados (por id o nombre de mesa)\r\n    const countFromGuests = guests.reduce((sum, g) => {\r\n      const matches = (() => {\r\n      if (g.tableId !== undefined && g.tableId !== null) {\r\n        return String(g.tableId) === String(table.id);\r\n      }\r\n      if (g.table !== undefined && g.table !== null && String(g.table).trim() !== '') {\r\n        // puede ser nombre de mesa o n√∫mero en string\r\n        return String(g.table).trim() === String(table.id) || (table.name && String(g.table).trim() === String(table.name));\r\n      }\r\n      return false;\r\n    })();\r\n      if (!matches) return sum;\r\n      const comp = parseInt(g.companion, 10) || 0;\r\n      return sum + 1 + comp;\r\n    }, 0);\r\n    if (countFromGuests) return countFromGuests;\r\n    // Conteo alternativo para propiedad assignedGuests (banquete)\r\n    if (Array.isArray(table.assignedGuests) && table.assignedGuests.length) {\r\n      return table.assignedGuests.reduce((sum, g) => sum + 1 + (parseInt(g.companion, 10) || 0), 0);\r\n    }\r\n    // Conteo para ceremonia (un solo invitado por mesa)\r\n    return table.guestId ? 1 : 0;\r\n  })();\r\n  // Lista de invitados asignados a esta mesa (ignoramos acompa√±antes para las iniciales)\r\n  const guestsList = (() => {\r\n    // Primero, obtenemos los invitados de la lista global\r\n    const list = guests.filter(g => {\r\n      if (g.tableId !== undefined && g.tableId !== null) {\r\n        return String(g.tableId) === String(table.id);\r\n      }\r\n      if (g.table !== undefined && g.table !== null && String(g.table).trim() !== '') {\r\n        return String(g.table).trim() === String(table.id) || (table.name && String(g.table).trim() === String(table.name));\r\n      }\r\n      return false;\r\n    });\r\n    \r\n    // Modo ceremonia: usamos exclusivamente los invitados de la lista global\r\n    // Modo banquete: podemos tener invitados en la propiedad assignedGuests\r\n    if (Array.isArray(table.assignedGuests) && table.assignedGuests.length) {\r\n      // IDs ya presentes para evitar duplicados\r\n      const guestIds = new Set(list.map((g) => g.id).filter(Boolean));\r\n\r\n      // Resolvemos cada elemento de assignedGuests:\r\n      //  - Si es string => buscamos el invitado en la lista global por id\r\n      //  - Si ya es objeto => lo usamos tal cual\r\n      const resolvedAssigned = table.assignedGuests.map((ag) => {\r\n        if (ag && typeof ag === 'object') return ag; // ya es invitado completo\r\n        const found = guests.find((g) => String(g.id) === String(ag));\r\n        if (found) return found;\r\n        // Fallback: devolvemos placeholder para contar asiento aunque no tengamos nombre\r\n        return { id: ag };\r\n      });\r\n\r\n      // Filtramos duplicados por id\r\n      const uniqueAssignedGuests = resolvedAssigned.filter(\r\n        (g) => !g.id || !guestIds.has(g.id),\r\n      );\r\n\r\n      // Combinamos ambas fuentes\r\n      return [...list, ...uniqueAssignedGuests];\r\n    }\r\n\r\n    // Sin assignedGuests: devolvemos la lista de invitados por mesa (puede estar vac√≠a)\r\n    return list;\r\n  })();\r\n  const seatDots = guestsList.length; // mostramos iniciales alrededor\r\n  // Tama√±o base: di√°metro para circular o ancho/alto para rectangular\r\n  const sizeX = table.shape === 'circle' ? (table.diameter || 60) : (table.width || 80);\r\n  const sizeY = table.shape === 'circle' ? (table.diameter || 60) : (table.height || table.length || 60);\r\n  const disabled = table.enabled === false;\r\n\r\n  const style = {\r\n    position: 'absolute',\r\n    left: ( (table.x ?? 0) * scale ) + offset.x - (sizeX * scale) / 2,\r\n    top: ( (table.y ?? 0) * scale ) + offset.y - (sizeY * scale) / 2,\r\n    width: sizeX * scale,\r\n    height: sizeY * scale,\r\n    backgroundColor: disabled ? '#e5e7eb' : '#fef3c7',\r\n    border: '2px solid #f59e0b',\r\n    borderRadius: table.shape === 'circle' ? '50%' : '6px',\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n    cursor: disabled ? 'not-allowed' : 'grab',\r\n    userSelect: 'none'\r\n  };\r\n\r\n  return (\r\n    <div ref={node => {ref.current=node; drop(node);}} \r\n      style={{...style, backgroundColor: isOver ? '#d1fae5' : style.backgroundColor}} \r\n      onPointerDown={disabled || !canMove ? undefined : handlePointerDown}\r\n      onContextMenu={e=>{e.preventDefault(); onToggleEnabled(table.id);}}\r\n      onClick={(e)=>{e.stopPropagation(); onSelect && onSelect(table.id);}}\r\n      onDoubleClick={()=>onOpenConfig(table)}> \r\n      <button \r\n        onClick={(e)=>{e.stopPropagation(); onAssignGuest(table.id, null);}}\r\n        className=\"absolute top-0 right-0 text-xs px-1 text-red-600\">‚úñ</button>\r\n      {/* Contenido central opcional: solo mostramos el n√∫mero de mesa peque√±o */}\r\n      <span style={{fontSize:14, fontWeight:'bold', pointerEvents:'none', color:'#374151'}}>{table.id}</span>\r\n    {disabled && <div className=\"absolute inset-0 bg-white bg-opacity-50 rounded\" />} \r\n      {/* seats */}\r\n      {(() => {\r\n        if(seatDots===0) return null;\r\n        // Funci√≥n para obtener el primer nombre\r\n        const getFirst = (name='?') => {\r\n           const first = name.trim().split(/\\s+/)[0] || '?';\r\n           return first;\r\n         }\r\n        if (table.shape === 'rect') {\r\n           const cols = seatDots > 0 ? Math.ceil(seatDots / 2) : 0;\r\n          return Array.from({ length: seatDots }).map((_, i) => {\r\n            const isTop = i < cols;\r\n            const idx = isTop ? i : i - cols;\r\n            const px = (sizeX * scale) / (cols + 1) * (idx + 1);\r\n            const offset = 18 * scale;\r\n            const py = isTop ? -offset : sizeY * scale + offset; // fuera del borde\r\n            return (\r\n              <div\r\n                key={i}\r\n                style={{\r\n                  position: 'absolute',\r\n                  minWidth:24,\r\n                   width:'auto',\r\n                  height: 24,\r\n                  background: '#2563eb',\r\n                  borderRadius: '9999px',\r\n                  display:'flex',\r\n                  alignItems:'center',\r\n                  justifyContent:'center',\r\n                  color:'#fff',\r\n                  fontSize:10,\r\n                  fontWeight:'bold',\r\n                  left: px - 12,\r\n                  top: py - 12,\r\n                }}\r\n              >{getLabel(guestsList[i]?.name || guestsList[i]?.nombre || '')}</div>\r\n            );\r\n          });\r\n        }\r\n         const seats = seatDots; // puntos seg√∫n invitados\r\n         if(seats===0) return null;\r\n         const centerX = (sizeX * scale) / 2;\r\n         const centerY = (sizeY * scale) / 2;\r\n         return Array.from({ length: seats }).map((_, i) => {\r\n          const angle = (Math.PI * 2 * i) / seats;\r\n                    // Radio ligeramente mayor al de la mesa, proporcional al zoom para que siempre quede fuera\r\n          const r = (Math.max(sizeX,sizeY) * scale) / 2 + 30 * scale; // fuera del borde\r\n          const sx = centerX + Math.cos(angle) * r;\r\n          const sy = centerY + Math.sin(angle) * r;\r\n          return (\r\n            <div\r\n              key={i}\r\n              style={{\r\n                position: 'absolute',\r\n                minWidth:24,\r\n                   width:'auto',\r\n                height: 24,\r\n                background: '#2563eb',\r\n                borderRadius: '9999px',\r\n                display:'flex',\r\n                alignItems:'center',\r\n                justifyContent:'center',\r\n                color:'#fff',\r\n                fontSize:10,\r\n                fontWeight:'bold',\r\n                left: sx - 12,\r\n                top: sy - 12,\r\n              }}\r\n            >{getLabel(guestsList[i]?.name || guestsList[i]?.nombre || '')}</div>\r\n          );\r\n        });\r\n      })()}\r\n\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\TemplatesModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\ThemeToggle.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\Toast.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\UploadImageCard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\UsernameWizard.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":18,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\";\r\nimport { auth } from \"../lib/firebase\";\r\nimport { onAuthStateChanged } from \"firebase/auth\";\r\nimport useEmailUsername from \"../hooks/useEmailUsername\";\r\nimport Spinner from \"./ui/Spinner\";\r\nimport Button from \"./ui/Button\";\r\nimport Alert from \"./ui/Alert\";\r\n\r\n/**\r\n * Muestra un modal la primera vez que el usuario accede para que elija su nombre\r\n * de correo @mywed360.com. Una vez configurado desaparece para siempre.\r\n */\r\nconst UsernameWizard = () => {\r\n  const {\r\n    checkUsernameAvailability,\r\n    reserveUsername,\r\n    getCurrentUsername,\r\n    loading,\r\n    error,\r\n  } = useEmailUsername();\r\n\r\n  const [stepLoading, setStepLoading] = useState(true);\r\n  const [showWizard, setShowWizard] = useState(false);\r\n  const [username, setUsername] = useState(\"\");\r\n  const [checking, setChecking] = useState(false);\r\n  const [available, setAvailable] = useState(null); // null sin comprobar, true/false resultado\r\n  const [feedback, setFeedback] = useState(null);\r\n\r\n  // Al montar, esperamos a que Firebase conozca al usuario autenticado\r\n  // y entonces comprobamos si ya tiene nombre de correo configurado.\r\n  useEffect(() => {\r\n    const unsubscribe = onAuthStateChanged(auth, async (user) => {\r\n      if (!user) {\r\n        // No hay usuario autenticado; no mostramos wizard y detenemos loading.\r\n        setStepLoading(false);\r\n        return;\r\n      }\r\n\r\n      const current = await getCurrentUsername();\r\n      if (!current) {\r\n        setShowWizard(true);\r\n      }\r\n      setStepLoading(false);\r\n      // Nos desuscribimos porque solo necesitamos esta comprobaci√≥n una vez.\r\n      // (La funci√≥n retornada por useEffect har√° el cleanup).\r\n      \r\n    });\r\n\r\n    return () => unsubscribe();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  if (stepLoading) return null; // evita parpadeo\r\n  if (!showWizard) return null; // usuario ya configur√≥ nombre\r\n\r\n  const handleCheck = async () => {\r\n    setChecking(true);\r\n    const ok = await checkUsernameAvailability(username.trim());\r\n    setAvailable(ok);\r\n    if (ok) {\r\n      setFeedback(\"Disponible ‚úÖ\");\r\n    } else {\r\n      setFeedback(\"No disponible ‚ùå\");\r\n    }\r\n    setChecking(false);\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    if (!available) return;\r\n    setChecking(true);\r\n    const saved = await reserveUsername(username.trim());\r\n    if (saved) {\r\n      setShowWizard(false);\r\n    }\r\n    setChecking(false);\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40\">\r\n      <div className=\"w-full max-w-md rounded-lg bg-white p-6 shadow-lg\">\r\n        <h2 className=\"mb-4 text-xl font-semibold text-gray-700\">\r\n          Configura tu correo @mywed360.com\r\n        </h2>\r\n        <p className=\"mb-4 text-sm text-gray-600\">\r\n          Elige tu nombre de usuario. Solo podr√°s configurarlo una vez.\r\n        </p>\r\n\r\n        <div className=\"flex gap-2\">\r\n          <input\r\n            type=\"text\"\r\n            className=\"flex-1 rounded border px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none\"\r\n            placeholder=\"nombre.deseado\"\r\n            value={username}\r\n            onChange={(e) => {\r\n              setUsername(e.target.value.toLowerCase());\r\n              setAvailable(null);\r\n              setFeedback(null);\r\n            }}\r\n          />\r\n          <span className=\"self-center text-sm text-gray-700\">@mywed360.com</span>\r\n        </div>\r\n\r\n        {feedback && (\r\n          <p\r\n            className={`mt-2 text-sm ${available ? \"text-green-600\" : \"text-red-600\"}`}\r\n          >\r\n            {feedback}\r\n          </p>\r\n        )}\r\n        {error && (\r\n          <Alert variant=\"error\" className=\"mt-2 text-sm\">\r\n            {error}\r\n          </Alert>\r\n        )}\r\n\r\n        <div className=\"mt-6 flex justify-end gap-2\">\r\n          <Button onClick={handleCheck} disabled={checking || !username}>\r\n            {checking ? <Spinner size=\"sm\" /> : \"Comprobar\"}\r\n          </Button>\r\n          <Button\r\n            onClick={handleSave}\r\n            variant=\"primary\"\r\n            disabled={checking || !available}\r\n          >\r\n            {checking ? <Spinner size=\"sm\" /> : \"Guardar\"}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default UsernameWizard;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\VirtualizedList.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\WeddingFormModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\WeddingSelector.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\__tests__\\Nav.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\admin\\AdminDashboard.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Bell' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":7}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useAuth } from '../../hooks/useAuthUnified';\r\nimport { Grid, Card, CardContent, CardHeader, Typography, Box, Chip, Avatar } from '@mui/material';\r\nimport { \r\n  Users, \r\n  Mail, \r\n  Calendar, \r\n  Check, \r\n  AlertTriangle,\r\n  Bell,\r\n  Activity,\r\n  ShoppingBag\r\n} from 'lucide-react';\r\n\r\n/**\r\n * Panel de administraci√≥n principal\r\n * Muestra resumen de m√©tricas y accesos r√°pidos\r\n */\r\nconst AdminDashboard = () => {\r\n  const { currentUser } = useAuth();\r\n  const [stats, setStats] = useState({\r\n    activeUsers: 0,\r\n    pendingProviders: 0,\r\n    emailsSent: 0,\r\n    upcomingEvents: 0,\r\n    completedOrders: 0,\r\n    alerts: 0\r\n  });\r\n\r\n  // Simular carga de datos\r\n  useEffect(() => {\r\n    // En una implementaci√≥n real, estos datos vendr√≠an de una API\r\n    setTimeout(() => {\r\n      setStats({\r\n        activeUsers: 432,\r\n        pendingProviders: 12,\r\n        emailsSent: 2789,\r\n        upcomingEvents: 8,\r\n        completedOrders: 145,\r\n        alerts: 3\r\n      });\r\n    }, 800);\r\n  }, []);\r\n\r\n  // Tarjetas de m√©tricas para el dashboard\r\n  const metricsCards = [\r\n    {\r\n      title: 'Usuarios activos',\r\n      value: stats.activeUsers,\r\n      icon: <Users size={24} />,\r\n      color: 'rgb(37, 99, 235)'\r\n    },\r\n    {\r\n      title: 'Proveedores pendientes',\r\n      value: stats.pendingProviders,\r\n      icon: <ShoppingBag size={24} />,\r\n      color: 'rgb(236, 72, 153)'\r\n    },\r\n    {\r\n      title: 'Emails enviados',\r\n      value: stats.emailsSent,\r\n      icon: <Mail size={24} />,\r\n      color: 'rgb(234, 88, 12)'\r\n    },\r\n    {\r\n      title: 'Eventos pr√≥ximos',\r\n      value: stats.upcomingEvents,\r\n      icon: <Calendar size={24} />,\r\n      color: 'rgb(5, 150, 105)'\r\n    },\r\n    {\r\n      title: 'Pedidos completados',\r\n      value: stats.completedOrders,\r\n      icon: <Check size={24} />,\r\n      color: 'rgb(79, 70, 229)'\r\n    },\r\n    {\r\n      title: 'Alertas del sistema',\r\n      value: stats.alerts,\r\n      icon: <AlertTriangle size={24} />,\r\n      color: 'rgb(239, 68, 68)'\r\n    }\r\n  ];\r\n\r\n  return (\r\n    <div className=\"p-6\">\r\n      <div className=\"flex justify-between items-center mb-8\">\r\n        <Typography variant=\"h4\" className=\"font-medium\">\r\n          Panel de Administraci√≥n\r\n        </Typography>\r\n        <Chip\r\n          avatar={<Avatar alt={currentUser?.displayName || 'Admin'}>{(currentUser?.displayName?.[0] || 'A').toUpperCase()}</Avatar>}\r\n          label={`Hola, ${currentUser?.displayName || 'Admin'}`}\r\n          variant=\"outlined\"\r\n          color=\"primary\"\r\n        />\r\n      </div>\r\n\r\n      {/* M√©tricas principales */}\r\n      <Grid container spacing={3} className=\"mb-8\">\r\n        {metricsCards.map((card, index) => (\r\n          <Grid item xs={12} sm={6} md={4} key={index}>\r\n            <Card className=\"h-full\">\r\n              <CardContent>\r\n                <Box className=\"flex justify-between items-center\">\r\n                  <Box>\r\n                    <Typography variant=\"h6\" color=\"textSecondary\" gutterBottom>\r\n                      {card.title}\r\n                    </Typography>\r\n                    <Typography variant=\"h4\" component=\"div\" className=\"font-semibold\">\r\n                      {card.value.toLocaleString()}\r\n                    </Typography>\r\n                  </Box>\r\n                  <Avatar\r\n                    sx={{\r\n                      bgcolor: card.color,\r\n                      width: 56,\r\n                      height: 56\r\n                    }}\r\n                  >\r\n                    {card.icon}\r\n                  </Avatar>\r\n                </Box>\r\n              </CardContent>\r\n            </Card>\r\n          </Grid>\r\n        ))}\r\n      </Grid>\r\n\r\n      {/* Accesos r√°pidos */}\r\n      <Typography variant=\"h5\" className=\"mb-4\">\r\n        Accesos R√°pidos\r\n      </Typography>\r\n      <Grid container spacing={3}>\r\n        <Grid item xs={12} md={6}>\r\n          <Card className=\"h-full\">\r\n            <CardHeader \r\n              title=\"Sistema de Correo\"\r\n              subheader=\"Gesti√≥n de correos electr√≥nicos\"\r\n              avatar={\r\n                <Avatar sx={{ bgcolor: 'rgb(234, 88, 12)' }}>\r\n                  <Mail size={20} />\r\n                </Avatar>\r\n              }\r\n            />\r\n            <CardContent>\r\n              <Typography variant=\"body2\" color=\"text.secondary\">\r\n                Accede al panel de administraci√≥n de correo para monitorizar el env√≠o, recepci√≥n y rendimiento del sistema de email.\r\n              </Typography>\r\n            </CardContent>\r\n          </Card>\r\n        </Grid>\r\n        <Grid item xs={12} md={6}>\r\n          <Card className=\"h-full\">\r\n            <CardHeader \r\n              title=\"Actividad del Sistema\" \r\n              subheader=\"Monitorizaci√≥n en tiempo real\"\r\n              avatar={\r\n                <Avatar sx={{ bgcolor: 'rgb(79, 70, 229)' }}>\r\n                  <Activity size={20} />\r\n                </Avatar>\r\n              }\r\n            />\r\n            <CardContent>\r\n              <Typography variant=\"body2\" color=\"text.secondary\">\r\n                Visualiza la actividad del sistema en tiempo real, incluyendo sesiones de usuarios, transacciones y eventos del sistema.\r\n              </Typography>\r\n            </CardContent>\r\n          </Card>\r\n        </Grid>\r\n      </Grid>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminDashboard;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\admin\\CachePerformancePanel.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\admin\\EmailAdminDashboard.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Badge' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":88,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":93},{"ruleId":"no-unused-vars","severity":1,"message":"'Divider' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":95,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":102},{"ruleId":"no-unused-vars","severity":1,"message":"'isLoading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":21,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Card, CardContent, Tabs, Tab, Button, Box, Typography, Menu, MenuItem, Paper, Badge, Divider } from '@mui/material';\r\n// Eliminando importaci√≥n problem√°tica de @mui/icons-material\r\n// Vamos a usar alternativas simples de texto para los √≠conos\r\nimport { performanceMonitor } from '../../services/PerformanceMonitor';\r\nimport MetricsDashboard from './MetricsDashboard';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\n/**\r\n * Panel de administraci√≥n para el sistema de correo electr√≥nico\r\n * Proporciona acceso a m√©tricas, configuraci√≥n y feedback de usuarios\r\n * \r\n * @component\r\n * @example\r\n * ```jsx\r\n * <EmailAdminDashboard />\r\n * ```\r\n */\r\nfunction EmailAdminDashboard() {\r\n  const [activeTab, setActiveTab] = useState('metrics');\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [emailStats, setEmailStats] = useState({\r\n    totalAccounts: 0,\r\n    activeToday: 0,\r\n    totalSent: 0,\r\n    totalReceived: 0,\r\n    averageResponseTime: 0,\r\n    topSenders: [],\r\n    topDomains: []\r\n  });\r\n  const [feedbackStats, setFeedbackStats] = useState({\r\n    averageRating: 0,\r\n    totalFeedback: 0,\r\n    recentFeedback: []\r\n  });\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(() => {\r\n    // Simular carga de datos de estad√≠sticas\r\n    const loadStats = async () => {\r\n      setIsLoading(true);\r\n      \r\n      try {\r\n        // En producci√≥n, estos datos vendr√≠an de una API\r\n        // Por ahora generamos datos de ejemplo\r\n        \r\n        // Estad√≠sticas de correos\r\n        setEmailStats({\r\n          totalAccounts: 120,\r\n          activeToday: 45,\r\n          totalSent: 876,\r\n          totalReceived: 1243,\r\n          averageResponseTime: 43, // minutos\r\n          topSenders: [\r\n            { email: 'maria@lovenda.com', count: 56 },\r\n            { email: 'juan@lovenda.com', count: 42 },\r\n            { email: 'ana@lovenda.com', count: 38 }\r\n          ],\r\n          topDomains: [\r\n            { domain: 'gmail.com', count: 356 },\r\n            { domain: 'hotmail.com', count: 189 },\r\n            { domain: 'outlook.com', count: 132 }\r\n          ]\r\n        });\r\n        \r\n        // Estad√≠sticas de feedback\r\n        setFeedbackStats({\r\n          averageRating: 4.2,\r\n          totalFeedback: 38,\r\n          recentFeedback: [\r\n            { id: 1, rating: 5, comment: \"Me encanta la detecci√≥n autom√°tica de eventos\", date: \"2025-07-12\" },\r\n            { id: 2, rating: 4, comment: \"Muy √∫til, aunque a veces es lento\", date: \"2025-07-10\" },\r\n            { id: 3, rating: 3, comment: \"Necesita mejores plantillas\", date: \"2025-07-09\" }\r\n          ]\r\n        });\r\n        \r\n        // Registrar visita al panel en el monitor de rendimiento\r\n        performanceMonitor.logEvent('admin_dashboard_view', {\r\n          tab: activeTab\r\n        });\r\n      } catch (error) {\r\n        console.error('Error al cargar estad√≠sticas:', error);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n    \r\n    loadStats();\r\n  }, [activeTab]);\r\n  \r\n  // Manejador para cambiar de pesta√±a\r\n  const handleTabChange = (event, newTab) => {\r\n    setActiveTab(newTab);\r\n    performanceMonitor.logEvent('admin_tab_change', { tab: newTab });\r\n  };\r\n  \r\n  // Manejador para exportar informes\r\n  const handleExportReport = (format) => {\r\n    performanceMonitor.logEvent('export_report', { format, tab: activeTab });\r\n    \r\n    // Simulamos la exportaci√≥n\r\n    alert(`Informe exportado en formato ${format}`);\r\n  };\r\n\r\n  // Estado para el men√∫ desplegable de exportaci√≥n\r\n  const [exportAnchorEl, setExportAnchorEl] = useState(null);\r\n  const openExportMenu = Boolean(exportAnchorEl);\r\n  \r\n  // Abrir men√∫ de exportaci√≥n\r\n  const handleExportClick = (event) => {\r\n    setExportAnchorEl(event.currentTarget);\r\n  };\r\n  \r\n  // Cerrar men√∫ de exportaci√≥n\r\n  const handleExportClose = () => {\r\n    setExportAnchorEl(null);\r\n  };\r\n  \r\n  // Manejador para ir a la configuraci√≥n de emails\r\n  const handleGoToEmailSettings = () => {\r\n    navigate('/settings/email');\r\n  };\r\n\r\n  return (\r\n    <Box sx={{ p: 4 }}>\r\n      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 4 }}>\r\n        <Typography variant=\"h4\">Panel de Administraci√≥n de Email</Typography>\r\n        <Button \r\n          variant=\"contained\"\r\n          onClick={() => navigate('/admin/metrics')}\r\n          // Eliminado el icono problem√°tico\r\n          \r\n        >\r\n          Ver Dashboard Completo\r\n        </Button>\r\n      </Box>\r\n      \r\n      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 4 }}>\r\n        <Typography variant=\"h5\">Estad√≠sticas</Typography>\r\n        \r\n        <Box sx={{ display: 'flex', gap: 2 }}>\r\n          <div>\r\n            <Button \r\n              variant=\"outlined\" \r\n              onClick={handleExportClick}\r\n              // Eliminado el icono problem√°tico\r\n              \r\n            >\r\n              Exportar Informe\r\n            </Button>\r\n            <Menu\r\n              anchorEl={exportAnchorEl}\r\n              open={openExportMenu}\r\n              onClose={handleExportClose}\r\n            >\r\n              <MenuItem onClick={() => { handleExportReport('pdf'); handleExportClose(); }}>\r\n                PDF\r\n              </MenuItem>\r\n              <MenuItem onClick={() => { handleExportReport('csv'); handleExportClose(); }}>\r\n                CSV\r\n              </MenuItem>\r\n              <MenuItem onClick={() => { handleExportReport('excel'); handleExportClose(); }}>\r\n                Excel\r\n              </MenuItem>\r\n            </Menu>\r\n          </div>\r\n          \r\n          <Button \r\n            variant=\"contained\"\r\n            onClick={handleGoToEmailSettings}\r\n            // Eliminado el icono problem√°tico\r\n            \r\n          >\r\n            Configuraci√≥n de Email\r\n          </Button>\r\n        </Box>\r\n      </Box>\r\n      \r\n      <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 2, mb: 4 }}>\r\n        <Card sx={{ flex: '1 1 22%', minWidth: '160px', height: '100%' }}>\r\n          <CardContent sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center' }}>\r\n            <Typography variant=\"h4\" color=\"primary\">{emailStats.totalAccounts}</Typography>\r\n            <Typography variant=\"body2\" color=\"text.secondary\">Cuentas de Email</Typography>\r\n          </CardContent>\r\n        </Card>\r\n        \r\n        <Card sx={{ flex: '1 1 22%', minWidth: '160px', height: '100%' }}>\r\n          <CardContent sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center' }}>\r\n            <Typography variant=\"h4\" color=\"success.main\">{emailStats.activeToday}</Typography>\r\n            <Typography variant=\"body2\" color=\"text.secondary\">Usuarios Activos Hoy</Typography>\r\n          </CardContent>\r\n        </Card>\r\n        \r\n        <Card sx={{ flex: '1 1 22%', minWidth: '160px', height: '100%' }}>\r\n          <CardContent sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center' }}>\r\n            <Typography variant=\"h4\" color=\"info.main\">{emailStats.totalSent}</Typography>\r\n            <Typography variant=\"body2\" color=\"text.secondary\">Emails Enviados</Typography>\r\n          </CardContent>\r\n        </Card>\r\n        \r\n        <Card sx={{ flex: '1 1 22%', minWidth: '160px', height: '100%' }}>\r\n          <CardContent sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center' }}>\r\n            <Typography variant=\"h4\" color=\"warning.main\">{emailStats.totalReceived}</Typography>\r\n            <Typography variant=\"body2\" color=\"text.secondary\">Emails Recibidos</Typography>\r\n          </CardContent>\r\n        </Card>\r\n      </Box>\r\n      \r\n      <Tabs\r\n        value={activeTab}\r\n        onChange={handleTabChange}\r\n        sx={{ mb: 4 }}\r\n      >\r\n        <Tab value=\"metrics\" label=\"M√©tricas\" />\r\n        <Tab value=\"feedback\" label=\"Feedback de Usuarios\" />\r\n        <Tab value=\"accounts\" label=\"Cuentas de Email\" />\r\n      </Tabs>\r\n\r\n      {activeTab === 'metrics' && (\r\n        <Paper elevation={1} sx={{ p: 4, mb: 4 }}>\r\n          <MetricsDashboard />\r\n        </Paper>\r\n      )}\r\n      \r\n      {activeTab === 'feedback' && (\r\n        <Paper elevation={1} sx={{ p: 4, mb: 4 }}>\r\n              <div className=\"mb-4\">\r\n                <h3 className=\"h5 mb-3\">Resumen de Feedback</h3>\r\n                <div className=\"d-flex align-items-center mb-3\">\r\n                  <div className=\"me-3\">\r\n                    <span className=\"h3 mb-0\">{feedbackStats.averageRating.toFixed(1)}</span>\r\n                    <div className=\"text-muted\">Valoraci√≥n media</div>\r\n                  </div>\r\n                  <div className=\"ms-4\">\r\n                    <div className=\"ratings\">\r\n                      {[1, 2, 3, 4, 5].map((star) => (\r\n                        <span \r\n                          key={star} \r\n                          className={`h4 ${star <= Math.round(feedbackStats.averageRating) ? 'text-warning' : 'text-muted'}`}\r\n                        >\r\n                          ‚òÖ\r\n                        </span>\r\n                      ))}\r\n                    </div>\r\n                    <div className=\"text-muted\">\r\n                      Basado en {feedbackStats.totalFeedback} valoraciones\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"mb-4\">\r\n                <h3 className=\"h5 mb-3\">Comentarios Recientes</h3>\r\n                {feedbackStats.recentFeedback.length === 0 ? (\r\n                  <p className=\"text-muted\">No hay comentarios recientes.</p>\r\n                ) : (\r\n                  <div className=\"list-group\">\r\n                    {feedbackStats.recentFeedback.map((item) => (\r\n                      <div key={item.id} className=\"list-group-item\">\r\n                        <div className=\"d-flex justify-content-between align-items-start mb-1\">\r\n                          <div>\r\n                            {Array.from({ length: 5 }).map((_, i) => (\r\n                              <span key={i} className={`small ${i < item.rating ? 'text-warning' : 'text-muted'}`}>\r\n                                ‚òÖ\r\n                              </span>\r\n                            ))}\r\n                          </div>\r\n                          <small className=\"text-muted\">{item.date}</small>\r\n                        </div>\r\n                        <p className=\"mb-0\">{item.comment}</p>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n        </Paper>\r\n      )}\r\n      \r\n      {activeTab === 'accounts' && (\r\n        <Paper elevation={1} sx={{ p: 4, mb: 4 }}>\r\n              <h3 className=\"h5 mb-3\">Gesti√≥n de Cuentas</h3>\r\n              \r\n              <div className=\"table-responsive\">\r\n                <table className=\"table table-hover\">\r\n                  <thead>\r\n                    <tr>\r\n                      <th>Email</th>\r\n                      <th>Usuario</th>\r\n                      <th>Creado</th>\r\n                      <th>Estado</th>\r\n                      <th>Acciones</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    <tr>\r\n                      <td>juan@lovenda.com</td>\r\n                      <td>Juan P√©rez</td>\r\n                      <td>10/06/2025</td>\r\n                      <td>\r\n                        <span className=\"badge bg-success\">Activo</span>\r\n                      </td>\r\n                      <td>\r\n                        <button className=\"btn btn-sm btn-outline-secondary me-1\">\r\n                          <i className=\"bi bi-pencil\"></i>\r\n                        </button>\r\n                        <button className=\"btn btn-sm btn-outline-danger\">\r\n                          <i className=\"bi bi-trash\"></i>\r\n                        </button>\r\n                      </td>\r\n                    </tr>\r\n                    <tr>\r\n                      <td>maria@lovenda.com</td>\r\n                      <td>Mar√≠a Garc√≠a</td>\r\n                      <td>15/06/2025</td>\r\n                      <td>\r\n                        <span className=\"badge bg-success\">Activo</span>\r\n                      </td>\r\n                      <td>\r\n                        <button className=\"btn btn-sm btn-outline-secondary me-1\">\r\n                          <i className=\"bi bi-pencil\"></i>\r\n                        </button>\r\n                        <button className=\"btn btn-sm btn-outline-danger\">\r\n                          <i className=\"bi bi-trash\"></i>\r\n                        </button>\r\n                      </td>\r\n                    </tr>\r\n                    <tr>\r\n                      <td>carlos@lovenda.com</td>\r\n                      <td>Carlos L√≥pez</td>\r\n                      <td>20/06/2025</td>\r\n                      <td>\r\n                        <span className=\"badge bg-warning text-dark\">Suspendido</span>\r\n                      </td>\r\n                      <td>\r\n                        <button className=\"btn btn-sm btn-outline-secondary me-1\">\r\n                          <i className=\"bi bi-pencil\"></i>\r\n                        </button>\r\n                        <button className=\"btn btn-sm btn-outline-danger\">\r\n                          <i className=\"bi bi-trash\"></i>\r\n                        </button>\r\n                      </td>\r\n                    </tr>\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n              \r\n              <div className=\"d-flex justify-content-between mt-3\">\r\n                <button className=\"btn btn-outline-primary\">\r\n                  <i className=\"bi bi-plus\"></i> Crear Cuenta\r\n                </button>\r\n                \r\n                <nav>\r\n                  <ul className=\"pagination pagination-sm mb-0\">\r\n                    <li className=\"page-item disabled\">\r\n                      <a className=\"page-link\" href=\"#\" tabIndex=\"-1\">Anterior</a>\r\n                    </li>\r\n                    <li className=\"page-item active\">\r\n                      <a className=\"page-link\" href=\"#\">1</a>\r\n                    </li>\r\n                    <li className=\"page-item\">\r\n                      <a className=\"page-link\" href=\"#\">2</a>\r\n                    </li>\r\n                    <li className=\"page-item\">\r\n                      <a className=\"page-link\" href=\"#\">3</a>\r\n                    </li>\r\n                    <li className=\"page-item\">\r\n                      <a className=\"page-link\" href=\"#\">Siguiente</a>\r\n                    </li>\r\n                  </ul>\r\n                </nav>\r\n              </div>\r\n        </Paper>\r\n      )}\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default EmailAdminDashboard;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\admin\\MetricsDashboard.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'performanceMonitor' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo } from 'react';\r\nimport { \r\n  LineChart, Line, BarChart, Bar, PieChart, Pie, \r\n  XAxis, YAxis, CartesianGrid, Tooltip, Legend, \r\n  ResponsiveContainer, Cell\r\n} from 'recharts';\r\nimport { performanceMonitor } from '../../services/PerformanceMonitor';\r\n\r\n/**\r\n * Dashboard para visualizar m√©tricas de rendimiento del sistema\r\n * Especialmente enfocado en el sistema de correo electr√≥nico personalizado\r\n * \r\n * @component\r\n * @example\r\n * ```jsx\r\n * <MetricsDashboard />\r\n * ```\r\n */\r\nfunction MetricsDashboard() {\r\n  const [metrics, setMetrics] = useState(null);\r\n  const [selectedTimeframe, setSelectedTimeframe] = useState('day'); // day, week, month\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  \r\n  // Colores para gr√°ficos\r\n  const colors = {\r\n    email: '#8884d8',\r\n    search: '#82ca9d',\r\n    notification: '#ffc658',\r\n    eventDetection: '#ff8042',\r\n    error: '#ff0000'\r\n  };\r\n\r\n  // Cargar datos de m√©tricas al montar el componente\r\n  useEffect(() => {\r\n    const fetchMetrics = async () => {\r\n      setIsLoading(true);\r\n      setError(null);\r\n      \r\n      try {\r\n        // Intentar obtener m√©tricas de localStorage (modo desarrollo)\r\n        let localMetrics = null;\r\n        try {\r\n          const storedMetrics = localStorage.getItem('lovenda_last_metrics');\r\n          if (storedMetrics) {\r\n            localMetrics = JSON.parse(storedMetrics);\r\n          }\r\n        } catch (e) {\r\n          console.log('No se encontraron m√©tricas locales');\r\n        }\r\n        \r\n        // Si hay un endpoint de m√©tricas configurado, obtener de all√≠\r\n        let remoteMetrics = null;\r\n        const metricsEndpoint = import.meta.env.VITE_METRICS_ENDPOINT;\r\n        \r\n        if (metricsEndpoint) {\r\n          const response = await fetch(`${metricsEndpoint}/dashboard?timeframe=${selectedTimeframe}`);\r\n          if (response.ok) {\r\n            remoteMetrics = await response.json();\r\n          } else {\r\n            throw new Error(`Error al obtener m√©tricas: ${response.statusText}`);\r\n          }\r\n        }\r\n        \r\n        // Usar m√©tricas remotas si est√°n disponibles, sino las locales\r\n        setMetrics(remoteMetrics || localMetrics || generateMockMetrics());\r\n      } catch (err) {\r\n        console.error('Error al cargar m√©tricas:', err);\r\n        setError('No se pudieron cargar las m√©tricas. Usando datos de ejemplo.');\r\n        setMetrics(generateMockMetrics());\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n    \r\n    fetchMetrics();\r\n    \r\n    // Programar actualizaci√≥n de m√©tricas cada minuto\r\n    const intervalId = setInterval(fetchMetrics, 60000);\r\n    return () => clearInterval(intervalId);\r\n  }, [selectedTimeframe]);\r\n  \r\n  // Generar datos de ejemplo para desarrollo y demostraci√≥n\r\n  const generateMockMetrics = () => {\r\n    const now = Date.now();\r\n    const dayInMs = 24 * 60 * 60 * 1000;\r\n    \r\n    // Generar datos para los √∫ltimos 7 d√≠as\r\n    const timeSeriesData = Array.from({ length: 7 }).map((_, i) => {\r\n      const date = new Date(now - (6 - i) * dayInMs);\r\n      return {\r\n        date: date.toISOString().split('T')[0],\r\n        emailSent: Math.floor(Math.random() * 25) + 5,\r\n        emailReceived: Math.floor(Math.random() * 30) + 10,\r\n        searchCount: Math.floor(Math.random() * 40) + 20,\r\n        notificationsRendered: Math.floor(Math.random() * 100) + 50,\r\n        eventsDetected: Math.floor(Math.random() * 8) + 1,\r\n      };\r\n    });\r\n    \r\n    // Datos de rendimiento\r\n    const performanceData = {\r\n      emailProcessing: Math.floor(Math.random() * 500) + 100,\r\n      searchPerformance: Math.floor(Math.random() * 300) + 50,\r\n      notificationsRendering: Math.floor(Math.random() * 100) + 20,\r\n      eventDetection: Math.floor(Math.random() * 800) + 200,\r\n    };\r\n    \r\n    // Datos de errores\r\n    const errorData = [\r\n      { name: 'Email', value: Math.floor(Math.random() * 5) },\r\n      { name: 'B√∫squeda', value: Math.floor(Math.random() * 3) },\r\n      { name: 'Notificaciones', value: Math.floor(Math.random() * 2) },\r\n      { name: 'Detecci√≥n de eventos', value: Math.floor(Math.random() * 1) },\r\n    ];\r\n    \r\n    // Datos de uso\r\n    const usageData = [\r\n      { name: 'Email enviados', value: Math.floor(Math.random() * 100) + 50 },\r\n      { name: 'Email recibidos', value: Math.floor(Math.random() * 150) + 70 },\r\n      { name: 'B√∫squedas', value: Math.floor(Math.random() * 80) + 30 },\r\n      { name: 'Eventos detectados', value: Math.floor(Math.random() * 30) + 10 },\r\n    ];\r\n    \r\n    return {\r\n      timeSeriesData,\r\n      performanceData,\r\n      errorData,\r\n      usageData,\r\n      timestamp: now,\r\n    };\r\n  };\r\n  \r\n  // Procesar los datos de rendimiento para el gr√°fico de barras\r\n  const processedPerformanceData = useMemo(() => {\r\n    if (!metrics || !metrics.performanceData) return [];\r\n    \r\n    return Object.entries(metrics.performanceData).map(([key, value]) => ({\r\n      name: key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase()),\r\n      value: value,\r\n    }));\r\n  }, [metrics]);\r\n  \r\n  // Si est√° cargando, mostrar indicador\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"flex justify-center items-center h-64\">\r\n        <div className=\"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-indigo-500\"></div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  return (\r\n    <div className=\"bg-white shadow-md rounded-lg p-6\">\r\n      <div className=\"flex justify-between items-center mb-6\">\r\n        <h2 className=\"text-2xl font-bold text-gray-800\">Panel de M√©tricas</h2>\r\n        \r\n        <div className=\"flex space-x-2\">\r\n          <button\r\n            onClick={() => setSelectedTimeframe('day')}\r\n            className={`px-4 py-2 text-sm rounded-md ${\r\n              selectedTimeframe === 'day' \r\n                ? 'bg-indigo-600 text-white' \r\n                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\r\n            }`}\r\n          >\r\n            D√≠a\r\n          </button>\r\n          <button\r\n            onClick={() => setSelectedTimeframe('week')}\r\n            className={`px-4 py-2 text-sm rounded-md ${\r\n              selectedTimeframe === 'week' \r\n                ? 'bg-indigo-600 text-white' \r\n                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\r\n            }`}\r\n          >\r\n            Semana\r\n          </button>\r\n          <button\r\n            onClick={() => setSelectedTimeframe('month')}\r\n            className={`px-4 py-2 text-sm rounded-md ${\r\n              selectedTimeframe === 'month' \r\n                ? 'bg-indigo-600 text-white' \r\n                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\r\n            }`}\r\n          >\r\n            Mes\r\n          </button>\r\n        </div>\r\n      </div>\r\n      \r\n      {error && (\r\n        <div className=\"mb-4 p-3 bg-red-100 text-red-700 rounded-md\">\r\n          {error}\r\n        </div>\r\n      )}\r\n      \r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n        {/* Gr√°fico de actividad de email */}\r\n        <div className=\"bg-gray-50 p-4 rounded-lg\">\r\n          <h3 className=\"text-lg font-medium text-gray-700 mb-4\">Actividad de Email</h3>\r\n          <div className=\"h-80\">\r\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n              <LineChart\r\n                data={metrics?.timeSeriesData || []}\r\n                margin={{ top: 5, right: 30, left: 20, bottom: 5 }}\r\n              >\r\n                <CartesianGrid strokeDasharray=\"3 3\" />\r\n                <XAxis dataKey=\"date\" />\r\n                <YAxis />\r\n                <Tooltip />\r\n                <Legend />\r\n                <Line type=\"monotone\" dataKey=\"emailSent\" name=\"Enviados\" stroke={colors.email} activeDot={{ r: 8 }} />\r\n                <Line type=\"monotone\" dataKey=\"emailReceived\" name=\"Recibidos\" stroke={colors.notification} />\r\n              </LineChart>\r\n            </ResponsiveContainer>\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Gr√°fico de rendimiento */}\r\n        <div className=\"bg-gray-50 p-4 rounded-lg\">\r\n          <h3 className=\"text-lg font-medium text-gray-700 mb-4\">Tiempo de Respuesta (ms)</h3>\r\n          <div className=\"h-80\">\r\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n              <BarChart\r\n                data={processedPerformanceData}\r\n                margin={{ top: 5, right: 30, left: 20, bottom: 5 }}\r\n              >\r\n                <CartesianGrid strokeDasharray=\"3 3\" />\r\n                <XAxis dataKey=\"name\" />\r\n                <YAxis />\r\n                <Tooltip />\r\n                <Bar dataKey=\"value\" name=\"Tiempo (ms)\">\r\n                  {processedPerformanceData.map((entry, index) => (\r\n                    <Cell \r\n                      key={`cell-${index}`} \r\n                      fill={\r\n                        entry.name.includes('Email') ? colors.email :\r\n                        entry.name.includes('Search') ? colors.search :\r\n                        entry.name.includes('Notification') ? colors.notification :\r\n                        colors.eventDetection\r\n                      } \r\n                    />\r\n                  ))}\r\n                </Bar>\r\n              </BarChart>\r\n            </ResponsiveContainer>\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Errores */}\r\n        <div className=\"bg-gray-50 p-4 rounded-lg\">\r\n          <h3 className=\"text-lg font-medium text-gray-700 mb-4\">Errores por Componente</h3>\r\n          <div className=\"h-80\">\r\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n              <PieChart>\r\n                <Pie\r\n                  data={metrics?.errorData || []}\r\n                  cx=\"50%\"\r\n                  cy=\"50%\"\r\n                  labelLine={false}\r\n                  outerRadius={80}\r\n                  fill=\"#8884d8\"\r\n                  dataKey=\"value\"\r\n                  nameKey=\"name\"\r\n                  label={({ name, percent }) => `${name}: ${(percent * 100).toFixed(0)}%`}\r\n                >\r\n                  {metrics?.errorData.map((entry, index) => (\r\n                    <Cell key={`cell-${index}`} fill={colors.error} opacity={(index + 5) / 10} />\r\n                  ))}\r\n                </Pie>\r\n                <Tooltip />\r\n              </PieChart>\r\n            </ResponsiveContainer>\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Uso del sistema */}\r\n        <div className=\"bg-gray-50 p-4 rounded-lg\">\r\n          <h3 className=\"text-lg font-medium text-gray-700 mb-4\">Uso del Sistema</h3>\r\n          <div className=\"h-80\">\r\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n              <BarChart\r\n                data={metrics?.usageData || []}\r\n                margin={{ top: 5, right: 30, left: 20, bottom: 5 }}\r\n                layout=\"vertical\"\r\n              >\r\n                <CartesianGrid strokeDasharray=\"3 3\" />\r\n                <XAxis type=\"number\" />\r\n                <YAxis dataKey=\"name\" type=\"category\" width={100} />\r\n                <Tooltip />\r\n                <Bar dataKey=\"value\" name=\"Cantidad\">\r\n                  {metrics?.usageData.map((entry, index) => (\r\n                    <Cell \r\n                      key={`cell-${index}`} \r\n                      fill={\r\n                        entry.name.includes('Email enviados') ? colors.email :\r\n                        entry.name.includes('Email recibidos') ? colors.notification :\r\n                        entry.name.includes('B√∫squedas') ? colors.search :\r\n                        colors.eventDetection\r\n                      } \r\n                    />\r\n                  ))}\r\n                </Bar>\r\n              </BarChart>\r\n            </ResponsiveContainer>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <div className=\"mt-6\">\r\n        <h3 className=\"text-lg font-medium text-gray-700 mb-3\">Estad√≠sticas de Uso del Sistema de Emails</h3>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n          {/* Tarjetas de estad√≠sticas */}\r\n          <StatCard \r\n            title=\"Emails enviados hoy\" \r\n            value={metrics?.timeSeriesData?.[metrics.timeSeriesData.length-1]?.emailSent || 0} \r\n            trend={10} \r\n            icon=\"üì§\" \r\n          />\r\n          <StatCard \r\n            title=\"Emails recibidos hoy\" \r\n            value={metrics?.timeSeriesData?.[metrics.timeSeriesData.length-1]?.emailReceived || 0} \r\n            trend={15} \r\n            icon=\"üì•\" \r\n          />\r\n          <StatCard \r\n            title=\"B√∫squedas realizadas\" \r\n            value={metrics?.timeSeriesData?.[metrics.timeSeriesData.length-1]?.searchCount || 0} \r\n            trend={-5} \r\n            icon=\"üîç\" \r\n          />\r\n          <StatCard \r\n            title=\"Eventos detectados\" \r\n            value={metrics?.timeSeriesData?.[metrics.timeSeriesData.length-1]?.eventsDetected || 0} \r\n            trend={20} \r\n            icon=\"üìÖ\" \r\n          />\r\n        </div>\r\n      </div>\r\n      \r\n      {/* √öltima actualizaci√≥n */}\r\n      <div className=\"mt-6 text-right text-sm text-gray-500\">\r\n        √öltima actualizaci√≥n: {metrics?.timestamp ? new Date(metrics.timestamp).toLocaleString() : 'N/A'}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * Tarjeta para mostrar estad√≠sticas individuales\r\n */\r\nfunction StatCard({ title, value, trend, icon }) {\r\n  return (\r\n    <div className=\"bg-white p-4 rounded-lg border border-gray-200 shadow-sm\">\r\n      <div className=\"flex justify-between items-start\">\r\n        <span className=\"text-2xl\">{icon}</span>\r\n        <span className={`text-sm font-medium ${trend >= 0 ? 'text-green-500' : 'text-red-500'}`}>\r\n          {trend >= 0 ? '‚Üë' : '‚Üì'} {Math.abs(trend)}%\r\n        </span>\r\n      </div>\r\n      <h4 className=\"mt-2 text-gray-500 text-sm\">{title}</h4>\r\n      <p className=\"mt-1 text-2xl font-semibold\">{value.toLocaleString()}</p>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default MetricsDashboard;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\admin\\SystemSettings.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Card, CardContent, Typography, Box, Tabs, Tab, Button, TextField, Switch, FormControlLabel, Divider, Alert } from '@mui/material';\r\nimport SaveIcon from '@mui/icons-material/Save';\r\nimport RefreshIcon from '@mui/icons-material/Refresh';\r\n\r\n/**\r\n * Componente de configuraci√≥n del sistema para administradores\r\n * Permite gestionar par√°metros globales de la aplicaci√≥n\r\n * \r\n * @component\r\n * @example\r\n * ```jsx\r\n * <SystemSettings />\r\n * ```\r\n */\r\nfunction SystemSettings() {\r\n  const [activeTab, setActiveTab] = useState(0);\r\n  const [isSaving, setIsSaving] = useState(false);\r\n  const [saveSuccess, setSaveSuccess] = useState(false);\r\n  const [saveError, setSaveError] = useState(null);\r\n  \r\n  // Estados para las diferentes configuraciones\r\n  const [generalSettings, setGeneralSettings] = useState({\r\n    siteName: 'MyWed360',\r\n    siteDescription: 'Plataforma de conexi√≥n con proveedores',\r\n    maxUploadSize: 10,\r\n    allowedFileTypes: '.jpg,.png,.pdf,.docx,.xlsx',\r\n    enableUserRegistration: true,\r\n    maintenanceMode: false,\r\n    contactEmail: 'soporte@lovenda.com',\r\n  });\r\n\r\n  const [emailSettings, setEmailSettings] = useState({\r\n    defaultEmailDomain: 'lovenda.com',\r\n    smtpServer: 'smtp.lovenda.com',\r\n    smtpPort: 587,\r\n    smtpUseSSL: true,\r\n    smtpUsername: '',\r\n    smtpPassword: '',\r\n    emailsPerHour: 100,\r\n    maxAttachmentSize: 5,\r\n    defaultSignature: '-- Enviado desde MyWed360',\r\n  });\r\n\r\n  const [securitySettings, setSecuritySettings] = useState({\r\n    sessionTimeoutMinutes: 30,\r\n    maxLoginAttempts: 5,\r\n    requireStrongPasswords: true,\r\n    passwordResetTimeHours: 24,\r\n    twoFactorAuthDefault: false,\r\n    ipWhitelist: '',\r\n  });\r\n  \r\n  // Manejo de cambios en las pesta√±as\r\n  const handleTabChange = (event, newValue) => {\r\n    setActiveTab(newValue);\r\n  };\r\n\r\n  // Manejadores de cambio para cada secci√≥n\r\n  const handleGeneralChange = (e) => {\r\n    const { name, value, type, checked } = e.target;\r\n    setGeneralSettings({\r\n      ...generalSettings,\r\n      [name]: type === 'checkbox' ? checked : value\r\n    });\r\n  };\r\n\r\n  const handleEmailChange = (e) => {\r\n    const { name, value, type, checked } = e.target;\r\n    setEmailSettings({\r\n      ...emailSettings,\r\n      [name]: type === 'checkbox' ? checked : value\r\n    });\r\n  };\r\n\r\n  const handleSecurityChange = (e) => {\r\n    const { name, value, type, checked } = e.target;\r\n    setSecuritySettings({\r\n      ...securitySettings,\r\n      [name]: type === 'checkbox' ? checked : value\r\n    });\r\n  };\r\n\r\n  // Simulaci√≥n de guardado\r\n  const handleSaveSettings = () => {\r\n    setIsSaving(true);\r\n    setSaveSuccess(false);\r\n    setSaveError(null);\r\n\r\n    // Simular una llamada API\r\n    setTimeout(() => {\r\n      setIsSaving(false);\r\n      \r\n      // Simulamos √©xito (en producci√≥n esto ser√≠a una llamada a la API)\r\n      setSaveSuccess(true);\r\n      \r\n      // Resetear el mensaje de √©xito despu√©s de 3 segundos\r\n      setTimeout(() => {\r\n        setSaveSuccess(false);\r\n      }, 3000);\r\n    }, 1500);\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-6\">\r\n      <Typography variant=\"h4\" className=\"mb-6\">Configuraci√≥n del Sistema</Typography>\r\n      \r\n      {saveSuccess && (\r\n        <Alert severity=\"success\" className=\"mb-4\">\r\n          Configuraci√≥n guardada correctamente\r\n        </Alert>\r\n      )}\r\n      \r\n      {saveError && (\r\n        <Alert severity=\"error\" className=\"mb-4\">\r\n          Error al guardar la configuraci√≥n: {saveError}\r\n        </Alert>\r\n      )}\r\n      \r\n      <Box sx={{ borderBottom: 1, borderColor: 'divider' }}>\r\n        <Tabs value={activeTab} onChange={handleTabChange} aria-label=\"configuraci√≥n del sistema\">\r\n          <Tab label=\"General\" />\r\n          <Tab label=\"Correo Electr√≥nico\" />\r\n          <Tab label=\"Seguridad\" />\r\n        </Tabs>\r\n      </Box>\r\n      \r\n      {/* Panel General */}\r\n      {activeTab === 0 && (\r\n        <Card className=\"mt-4\">\r\n          <CardContent className=\"space-y-4\">\r\n            <Typography variant=\"h6\">Configuraci√≥n General</Typography>\r\n            <Divider />\r\n            \r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4\">\r\n              <TextField\r\n                label=\"Nombre del Sitio\"\r\n                name=\"siteName\"\r\n                value={generalSettings.siteName}\r\n                onChange={handleGeneralChange}\r\n                fullWidth\r\n                variant=\"outlined\"\r\n              />\r\n              \r\n              <TextField\r\n                label=\"Descripci√≥n del Sitio\"\r\n                name=\"siteDescription\"\r\n                value={generalSettings.siteDescription}\r\n                onChange={handleGeneralChange}\r\n                fullWidth\r\n                variant=\"outlined\"\r\n              />\r\n              \r\n              <TextField\r\n                label=\"Tama√±o m√°ximo de archivos (MB)\"\r\n                name=\"maxUploadSize\"\r\n                type=\"number\"\r\n                value={generalSettings.maxUploadSize}\r\n                onChange={handleGeneralChange}\r\n                fullWidth\r\n                variant=\"outlined\"\r\n              />\r\n              \r\n              <TextField\r\n                label=\"Tipos de archivos permitidos\"\r\n                name=\"allowedFileTypes\"\r\n                value={generalSettings.allowedFileTypes}\r\n                onChange={handleGeneralChange}\r\n                fullWidth\r\n                variant=\"outlined\"\r\n                helperText=\"Separados por comas, ej: .jpg,.png,.pdf\"\r\n              />\r\n              \r\n              <TextField\r\n                label=\"Email de Contacto\"\r\n                name=\"contactEmail\"\r\n                value={generalSettings.contactEmail}\r\n                onChange={handleGeneralChange}\r\n                fullWidth\r\n                variant=\"outlined\"\r\n              />\r\n              \r\n              <div className=\"col-span-1 md:col-span-2 flex flex-col space-y-2\">\r\n                <FormControlLabel\r\n                  control={\r\n                    <Switch\r\n                      checked={generalSettings.enableUserRegistration}\r\n                      onChange={handleGeneralChange}\r\n                      name=\"enableUserRegistration\"\r\n                    />\r\n                  }\r\n                  label=\"Permitir registro de usuarios\"\r\n                />\r\n                \r\n                <FormControlLabel\r\n                  control={\r\n                    <Switch\r\n                      checked={generalSettings.maintenanceMode}\r\n                      onChange={handleGeneralChange}\r\n                      name=\"maintenanceMode\"\r\n                    />\r\n                  }\r\n                  label=\"Modo de mantenimiento\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n      \r\n      {/* Panel de Email */}\r\n      {activeTab === 1 && (\r\n        <Card className=\"mt-4\">\r\n          <CardContent className=\"space-y-4\">\r\n            <Typography variant=\"h6\">Configuraci√≥n de Correo Electr√≥nico</Typography>\r\n            <Divider />\r\n            \r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4\">\r\n              <TextField\r\n                label=\"Dominio de email predeterminado\"\r\n                name=\"defaultEmailDomain\"\r\n                value={emailSettings.defaultEmailDomain}\r\n                onChange={handleEmailChange}\r\n                fullWidth\r\n                variant=\"outlined\"\r\n              />\r\n              \r\n              <TextField\r\n                label=\"Servidor SMTP\"\r\n                name=\"smtpServer\"\r\n                value={emailSettings.smtpServer}\r\n                onChange={handleEmailChange}\r\n                fullWidth\r\n                variant=\"outlined\"\r\n              />\r\n              \r\n              <TextField\r\n                label=\"Puerto SMTP\"\r\n                name=\"smtpPort\"\r\n                type=\"number\"\r\n                value={emailSettings.smtpPort}\r\n                onChange={handleEmailChange}\r\n                fullWidth\r\n                variant=\"outlined\"\r\n              />\r\n              \r\n              <div className=\"flex items-center\">\r\n                <FormControlLabel\r\n                  control={\r\n                    <Switch\r\n                      checked={emailSettings.smtpUseSSL}\r\n                      onChange={handleEmailChange}\r\n                      name=\"smtpUseSSL\"\r\n                    />\r\n                  }\r\n                  label=\"Usar SSL\"\r\n                />\r\n              </div>\r\n              \r\n              <TextField\r\n                label=\"Usuario SMTP\"\r\n                name=\"smtpUsername\"\r\n                value={emailSettings.smtpUsername}\r\n                onChange={handleEmailChange}\r\n                fullWidth\r\n                variant=\"outlined\"\r\n              />\r\n              \r\n              <TextField\r\n                label=\"Contrase√±a SMTP\"\r\n                name=\"smtpPassword\"\r\n                type=\"password\"\r\n                value={emailSettings.smtpPassword}\r\n                onChange={handleEmailChange}\r\n                fullWidth\r\n                variant=\"outlined\"\r\n              />\r\n              \r\n              <TextField\r\n                label=\"Emails por hora\"\r\n                name=\"emailsPerHour\"\r\n                type=\"number\"\r\n                value={emailSettings.emailsPerHour}\r\n                onChange={handleEmailChange}\r\n                fullWidth\r\n                variant=\"outlined\"\r\n                helperText=\"L√≠mite para evitar bloqueos por spam\"\r\n              />\r\n              \r\n              <TextField\r\n                label=\"Tama√±o m√°ximo de adjuntos (MB)\"\r\n                name=\"maxAttachmentSize\"\r\n                type=\"number\"\r\n                value={emailSettings.maxAttachmentSize}\r\n                onChange={handleEmailChange}\r\n                fullWidth\r\n                variant=\"outlined\"\r\n              />\r\n              \r\n              <TextField\r\n                label=\"Firma predeterminada\"\r\n                name=\"defaultSignature\"\r\n                value={emailSettings.defaultSignature}\r\n                onChange={handleEmailChange}\r\n                fullWidth\r\n                variant=\"outlined\"\r\n                multiline\r\n                rows={2}\r\n                className=\"col-span-1 md:col-span-2\"\r\n              />\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n      \r\n      {/* Panel de Seguridad */}\r\n      {activeTab === 2 && (\r\n        <Card className=\"mt-4\">\r\n          <CardContent className=\"space-y-4\">\r\n            <Typography variant=\"h6\">Configuraci√≥n de Seguridad</Typography>\r\n            <Divider />\r\n            \r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4\">\r\n              <TextField\r\n                label=\"Tiempo de sesi√≥n (minutos)\"\r\n                name=\"sessionTimeoutMinutes\"\r\n                type=\"number\"\r\n                value={securitySettings.sessionTimeoutMinutes}\r\n                onChange={handleSecurityChange}\r\n                fullWidth\r\n                variant=\"outlined\"\r\n                helperText=\"0 = sin l√≠mite\"\r\n              />\r\n              \r\n              <TextField\r\n                label=\"M√°ximo de intentos de login\"\r\n                name=\"maxLoginAttempts\"\r\n                type=\"number\"\r\n                value={securitySettings.maxLoginAttempts}\r\n                onChange={handleSecurityChange}\r\n                fullWidth\r\n                variant=\"outlined\"\r\n                helperText=\"Bloqueo temporal despu√©s de X intentos\"\r\n              />\r\n              \r\n              <TextField\r\n                label=\"Tiempo de validez para reset de contrase√±a (horas)\"\r\n                name=\"passwordResetTimeHours\"\r\n                type=\"number\"\r\n                value={securitySettings.passwordResetTimeHours}\r\n                onChange={handleSecurityChange}\r\n                fullWidth\r\n                variant=\"outlined\"\r\n              />\r\n              \r\n              <TextField\r\n                label=\"Lista blanca de IPs\"\r\n                name=\"ipWhitelist\"\r\n                value={securitySettings.ipWhitelist}\r\n                onChange={handleSecurityChange}\r\n                fullWidth\r\n                variant=\"outlined\"\r\n                helperText=\"Separadas por comas, vac√≠o = permitir todas\"\r\n              />\r\n              \r\n              <div className=\"col-span-1 md:col-span-2 flex flex-col space-y-2\">\r\n                <FormControlLabel\r\n                  control={\r\n                    <Switch\r\n                      checked={securitySettings.requireStrongPasswords}\r\n                      onChange={handleSecurityChange}\r\n                      name=\"requireStrongPasswords\"\r\n                    />\r\n                  }\r\n                  label=\"Requerir contrase√±as seguras\"\r\n                />\r\n                \r\n                <FormControlLabel\r\n                  control={\r\n                    <Switch\r\n                      checked={securitySettings.twoFactorAuthDefault}\r\n                      onChange={handleSecurityChange}\r\n                      name=\"twoFactorAuthDefault\"\r\n                    />\r\n                  }\r\n                  label=\"Autenticaci√≥n de dos factores por defecto\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n      \r\n      <div className=\"flex justify-end mt-6 space-x-4\">\r\n        <Button \r\n          variant=\"outlined\" \r\n          color=\"secondary\"\r\n          startIcon={<RefreshIcon />}\r\n        >\r\n          Restaurar Valores\r\n        </Button>\r\n        \r\n        <Button \r\n          variant=\"contained\" \r\n          color=\"primary\"\r\n          startIcon={<SaveIcon />}\r\n          onClick={handleSaveSettings}\r\n          disabled={isSaving}\r\n        >\r\n          {isSaving ? 'Guardando...' : 'Guardar Configuraci√≥n'}\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default SystemSettings;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\admin\\UserManagement.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'currentUser' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":37,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":37,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport {\r\n  Box,\r\n  Typography,\r\n  Button,\r\n  Table,\r\n  TableBody,\r\n  TableCell,\r\n  TableContainer,\r\n  TableHead,\r\n  TableRow,\r\n  Paper,\r\n  TextField,\r\n  Dialog,\r\n  DialogActions,\r\n  DialogContent,\r\n  DialogTitle,\r\n  FormControlLabel,\r\n  Switch,\r\n  IconButton,\r\n  Chip,\r\n  Avatar,\r\n  Tooltip,\r\n  Select,\r\n  MenuItem,\r\n  FormControl,\r\n  InputLabel\r\n} from '@mui/material';\r\nimport { Search, Edit, Delete, Mail, Key, Shield, Download } from 'lucide-react';\r\nimport { useAuth } from '../../hooks/useAuthUnified';\r\n\r\n/**\r\n * Panel de gesti√≥n de usuarios para administradores\r\n * Permite crear, editar, eliminar y gestionar usuarios\r\n */\r\nconst UserManagement = () => {\r\n  const { currentUser } = useAuth();\r\n  \r\n  // Estado para usuarios y filtros\r\n  const [users, setUsers] = useState([]);\r\n  const [filteredUsers, setFilteredUsers] = useState([]);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [roleFilter, setRoleFilter] = useState('all');\r\n  const [statusFilter, setStatusFilter] = useState('all');\r\n  \r\n  // Estado para modal de edici√≥n\r\n  const [openEditDialog, setOpenEditDialog] = useState(false);\r\n  const [selectedUser, setSelectedUser] = useState(null);\r\n  \r\n  // Cargar usuarios de muestra\r\n  useEffect(() => {\r\n    // En un entorno real, estos datos vendr√≠an de una API\r\n    const mockUsers = [\r\n      {\r\n        id: 1,\r\n        name: 'Ana Garc√≠a',\r\n        email: 'ana.garcia@lovenda.com',\r\n        role: 'admin',\r\n        status: 'active',\r\n        createdAt: '2023-01-15',\r\n        lastLogin: '2023-09-28'\r\n      },\r\n      {\r\n        id: 2,\r\n        name: 'Juan P√©rez',\r\n        email: 'juan.perez@lovenda.com',\r\n        role: 'user',\r\n        status: 'active',\r\n        createdAt: '2023-02-05',\r\n        lastLogin: '2023-09-27'\r\n      },\r\n      {\r\n        id: 3,\r\n        name: 'Mar√≠a L√≥pez',\r\n        email: 'maria.lopez@lovenda.com',\r\n        role: 'provider',\r\n        status: 'active',\r\n        createdAt: '2023-03-12',\r\n        lastLogin: '2023-09-25'\r\n      },\r\n      {\r\n        id: 4,\r\n        name: 'Carlos Ruiz',\r\n        email: 'carlos.ruiz@lovenda.com',\r\n        role: 'user',\r\n        status: 'inactive',\r\n        createdAt: '2023-04-18',\r\n        lastLogin: '2023-08-15'\r\n      },\r\n      {\r\n        id: 5,\r\n        name: 'Laura Fern√°ndez',\r\n        email: 'laura.fernandez@lovenda.com',\r\n        role: 'provider',\r\n        status: 'pending',\r\n        createdAt: '2023-05-22',\r\n        lastLogin: null\r\n      },\r\n      {\r\n        id: 6,\r\n        name: 'Pedro Mart√≠nez',\r\n        email: 'pedro.martinez@lovenda.com',\r\n        role: 'user',\r\n        status: 'active',\r\n        createdAt: '2023-06-30',\r\n        lastLogin: '2023-09-26'\r\n      }\r\n    ];\r\n    \r\n    setUsers(mockUsers);\r\n    setFilteredUsers(mockUsers);\r\n  }, []);\r\n  \r\n  // Filtrar usuarios\r\n  useEffect(() => {\r\n    let result = users;\r\n    \r\n    // Filtrar por t√©rmino de b√∫squeda\r\n    if (searchTerm) {\r\n      result = result.filter(user => \r\n        user.name.toLowerCase().includes(searchTerm.toLowerCase()) || \r\n        user.email.toLowerCase().includes(searchTerm.toLowerCase())\r\n      );\r\n    }\r\n    \r\n    // Filtrar por rol\r\n    if (roleFilter !== 'all') {\r\n      result = result.filter(user => user.role === roleFilter);\r\n    }\r\n    \r\n    // Filtrar por estado\r\n    if (statusFilter !== 'all') {\r\n      result = result.filter(user => user.status === statusFilter);\r\n    }\r\n    \r\n    setFilteredUsers(result);\r\n  }, [searchTerm, roleFilter, statusFilter, users]);\r\n  \r\n  // Abrir modal de edici√≥n\r\n  const handleEditUser = (user) => {\r\n    setSelectedUser({ ...user });\r\n    setOpenEditDialog(true);\r\n  };\r\n  \r\n  // Cerrar modal de edici√≥n\r\n  const handleCloseDialog = () => {\r\n    setOpenEditDialog(false);\r\n    setSelectedUser(null);\r\n  };\r\n  \r\n  // Guardar cambios de usuario\r\n  const handleSaveUser = () => {\r\n    // Actualizar el usuario en la lista\r\n    setUsers(users.map(user => \r\n      user.id === selectedUser.id ? selectedUser : user\r\n    ));\r\n    handleCloseDialog();\r\n    \r\n    // En un entorno real, aqu√≠ se enviar√≠an los datos a una API\r\n    console.log('Usuario actualizado:', selectedUser);\r\n  };\r\n  \r\n  // Eliminar usuario\r\n  const handleDeleteUser = (userId) => {\r\n    // Confirmar eliminaci√≥n\r\n    if (window.confirm('¬øEst√° seguro de que desea eliminar este usuario?')) {\r\n      setUsers(users.filter(user => user.id !== userId));\r\n      \r\n      // En un entorno real, aqu√≠ se enviar√≠a la petici√≥n a una API\r\n      console.log('Usuario eliminado:', userId);\r\n    }\r\n  };\r\n  \r\n  // Exportar datos de usuarios\r\n  const handleExportUsers = () => {\r\n    // En un entorno real, aqu√≠ se generar√≠a un CSV o Excel\r\n    console.log('Exportando datos de usuarios:', filteredUsers);\r\n    alert('Datos de usuarios exportados correctamente');\r\n  };\r\n  \r\n  // Renderizar chip de estado del usuario\r\n  const renderStatusChip = (status) => {\r\n    let color = 'default';\r\n    let label = status;\r\n    \r\n    switch (status) {\r\n      case 'active':\r\n        color = 'success';\r\n        label = 'Activo';\r\n        break;\r\n      case 'inactive':\r\n        color = 'error';\r\n        label = 'Inactivo';\r\n        break;\r\n      case 'pending':\r\n        color = 'warning';\r\n        label = 'Pendiente';\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    \r\n    return <Chip label={label} color={color} size=\"small\" />;\r\n  };\r\n  \r\n  // Renderizar chip de rol del usuario\r\n  const renderRoleChip = (role) => {\r\n    let color = 'default';\r\n    let label = role;\r\n    let icon = null;\r\n    \r\n    switch (role) {\r\n      case 'admin':\r\n        color = 'secondary';\r\n        label = 'Administrador';\r\n        icon = <Shield size={14} />;\r\n        break;\r\n      case 'user':\r\n        color = 'primary';\r\n        label = 'Usuario';\r\n        break;\r\n      case 'provider':\r\n        color = 'info';\r\n        label = 'Proveedor';\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    \r\n    return (\r\n      <Chip \r\n        label={label} \r\n        color={color} \r\n        size=\"small\"\r\n        icon={icon}\r\n      />\r\n    );\r\n  };\r\n  \r\n  return (\r\n    <Box className=\"p-6\">\r\n      <Box className=\"flex justify-between items-center mb-6\">\r\n        <Typography variant=\"h4\" component=\"h1\">\r\n          Gesti√≥n de Usuarios\r\n        </Typography>\r\n        <Button \r\n          variant=\"contained\" \r\n          color=\"primary\"\r\n          startIcon={<Download />}\r\n          onClick={handleExportUsers}\r\n        >\r\n          Exportar\r\n        </Button>\r\n      </Box>\r\n      \r\n      {/* Filtros */}\r\n      <Box className=\"flex flex-col md:flex-row gap-4 mb-6\">\r\n        <TextField\r\n          label=\"Buscar usuario\"\r\n          variant=\"outlined\"\r\n          size=\"small\"\r\n          fullWidth\r\n          value={searchTerm}\r\n          onChange={(e) => setSearchTerm(e.target.value)}\r\n          InputProps={{\r\n            startAdornment: <Search size={20} className=\"mr-2 text-gray-500\" />,\r\n          }}\r\n          className=\"md:w-1/3\"\r\n        />\r\n        \r\n        <FormControl size=\"small\" className=\"md:w-1/4\">\r\n          <InputLabel>Filtrar por rol</InputLabel>\r\n          <Select\r\n            value={roleFilter}\r\n            label=\"Filtrar por rol\"\r\n            onChange={(e) => setRoleFilter(e.target.value)}\r\n          >\r\n            <MenuItem value=\"all\">Todos los roles</MenuItem>\r\n            <MenuItem value=\"admin\">Administradores</MenuItem>\r\n            <MenuItem value=\"user\">Usuarios</MenuItem>\r\n            <MenuItem value=\"provider\">Proveedores</MenuItem>\r\n          </Select>\r\n        </FormControl>\r\n        \r\n        <FormControl size=\"small\" className=\"md:w-1/4\">\r\n          <InputLabel>Filtrar por estado</InputLabel>\r\n          <Select\r\n            value={statusFilter}\r\n            label=\"Filtrar por estado\"\r\n            onChange={(e) => setStatusFilter(e.target.value)}\r\n          >\r\n            <MenuItem value=\"all\">Todos los estados</MenuItem>\r\n            <MenuItem value=\"active\">Activos</MenuItem>\r\n            <MenuItem value=\"inactive\">Inactivos</MenuItem>\r\n            <MenuItem value=\"pending\">Pendientes</MenuItem>\r\n          </Select>\r\n        </FormControl>\r\n        \r\n        <Button \r\n          variant=\"outlined\"\r\n          onClick={() => {\r\n            setSearchTerm('');\r\n            setRoleFilter('all');\r\n            setStatusFilter('all');\r\n          }}\r\n          className=\"md:w-1/6\"\r\n        >\r\n          Limpiar\r\n        </Button>\r\n      </Box>\r\n      \r\n      {/* Tabla de usuarios */}\r\n      <TableContainer component={Paper} className=\"mb-4\">\r\n        <Table aria-label=\"tabla de usuarios\">\r\n          <TableHead>\r\n            <TableRow>\r\n              <TableCell>Usuario</TableCell>\r\n              <TableCell>Email</TableCell>\r\n              <TableCell>Rol</TableCell>\r\n              <TableCell>Estado</TableCell>\r\n              <TableCell>Registro</TableCell>\r\n              <TableCell>√öltimo acceso</TableCell>\r\n              <TableCell align=\"right\">Acciones</TableCell>\r\n            </TableRow>\r\n          </TableHead>\r\n          <TableBody>\r\n            {filteredUsers.map((user) => (\r\n              <TableRow key={user.id}>\r\n                <TableCell>\r\n                  <Box className=\"flex items-center\">\r\n                    <Avatar \r\n                      sx={{ width: 32, height: 32, mr: 1 }}\r\n                    >\r\n                      {user.name.charAt(0)}\r\n                    </Avatar>\r\n                    <Typography variant=\"body2\">{user.name}</Typography>\r\n                  </Box>\r\n                </TableCell>\r\n                <TableCell>{user.email}</TableCell>\r\n                <TableCell>{renderRoleChip(user.role)}</TableCell>\r\n                <TableCell>{renderStatusChip(user.status)}</TableCell>\r\n                <TableCell>{new Date(user.createdAt).toLocaleDateString()}</TableCell>\r\n                <TableCell>\r\n                  {user.lastLogin \r\n                    ? new Date(user.lastLogin).toLocaleDateString()\r\n                    : 'Nunca'}\r\n                </TableCell>\r\n                <TableCell align=\"right\">\r\n                  <Box className=\"flex justify-end\">\r\n                    <Tooltip title=\"Enviar email\">\r\n                      <IconButton size=\"small\" onClick={() => alert(`Enviar email a ${user.email}`)}>\r\n                        <Mail size={18} />\r\n                      </IconButton>\r\n                    </Tooltip>\r\n                    <Tooltip title=\"Resetear contrase√±a\">\r\n                      <IconButton size=\"small\" onClick={() => alert(`Resetear contrase√±a de ${user.name}`)}>\r\n                        <Key size={18} />\r\n                      </IconButton>\r\n                    </Tooltip>\r\n                    <Tooltip title=\"Editar\">\r\n                      <IconButton size=\"small\" onClick={() => handleEditUser(user)}>\r\n                        <Edit size={18} />\r\n                      </IconButton>\r\n                    </Tooltip>\r\n                    <Tooltip title=\"Eliminar\">\r\n                      <IconButton \r\n                        size=\"small\" \r\n                        color=\"error\"\r\n                        onClick={() => handleDeleteUser(user.id)}\r\n                      >\r\n                        <Delete size={18} />\r\n                      </IconButton>\r\n                    </Tooltip>\r\n                  </Box>\r\n                </TableCell>\r\n              </TableRow>\r\n            ))}\r\n            {filteredUsers.length === 0 && (\r\n              <TableRow>\r\n                <TableCell colSpan={7} align=\"center\" className=\"py-8\">\r\n                  <Typography variant=\"body1\" color=\"textSecondary\">\r\n                    No se encontraron usuarios con los filtros seleccionados\r\n                  </Typography>\r\n                </TableCell>\r\n              </TableRow>\r\n            )}\r\n          </TableBody>\r\n        </Table>\r\n      </TableContainer>\r\n      \r\n      <Typography variant=\"body2\" color=\"textSecondary\" className=\"mt-2\">\r\n        Mostrando {filteredUsers.length} de {users.length} usuarios\r\n      </Typography>\r\n      \r\n      {/* Modal de edici√≥n */}\r\n      <Dialog open={openEditDialog} onClose={handleCloseDialog} maxWidth=\"sm\" fullWidth>\r\n        <DialogTitle>Editar Usuario</DialogTitle>\r\n        <DialogContent>\r\n          {selectedUser && (\r\n            <Box className=\"flex flex-col gap-4 pt-2\">\r\n              <TextField\r\n                label=\"Nombre\"\r\n                fullWidth\r\n                value={selectedUser.name}\r\n                onChange={(e) => setSelectedUser({...selectedUser, name: e.target.value})}\r\n              />\r\n              <TextField\r\n                label=\"Email\"\r\n                fullWidth\r\n                value={selectedUser.email}\r\n                onChange={(e) => setSelectedUser({...selectedUser, email: e.target.value})}\r\n              />\r\n              <FormControl fullWidth>\r\n                <InputLabel>Rol</InputLabel>\r\n                <Select\r\n                  value={selectedUser.role}\r\n                  label=\"Rol\"\r\n                  onChange={(e) => setSelectedUser({...selectedUser, role: e.target.value})}\r\n                >\r\n                  <MenuItem value=\"admin\">Administrador</MenuItem>\r\n                  <MenuItem value=\"user\">Usuario</MenuItem>\r\n                  <MenuItem value=\"provider\">Proveedor</MenuItem>\r\n                </Select>\r\n              </FormControl>\r\n              <FormControl fullWidth>\r\n                <InputLabel>Estado</InputLabel>\r\n                <Select\r\n                  value={selectedUser.status}\r\n                  label=\"Estado\"\r\n                  onChange={(e) => setSelectedUser({...selectedUser, status: e.target.value})}\r\n                >\r\n                  <MenuItem value=\"active\">Activo</MenuItem>\r\n                  <MenuItem value=\"inactive\">Inactivo</MenuItem>\r\n                  <MenuItem value=\"pending\">Pendiente</MenuItem>\r\n                </Select>\r\n              </FormControl>\r\n              <FormControlLabel\r\n                control={\r\n                  <Switch \r\n                    checked={selectedUser.status === 'active'}\r\n                    onChange={(e) => setSelectedUser({\r\n                      ...selectedUser, \r\n                      status: e.target.checked ? 'active' : 'inactive'\r\n                    })}\r\n                  />\r\n                }\r\n                label=\"Usuario activo\"\r\n              />\r\n            </Box>\r\n          )}\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={handleCloseDialog}>Cancelar</Button>\r\n          <Button onClick={handleSaveUser} variant=\"contained\" color=\"primary\">\r\n            Guardar cambios\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default UserManagement;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\auth\\AuthMigrationExample.jsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":116,"column":61,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[4502,4534],"text":" from &apos;../hooks/useAuthUnified';"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[4502,4534],"text":" from &lsquo;../hooks/useAuthUnified';"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[4502,4534],"text":" from &#39;../hooks/useAuthUnified';"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[4502,4534],"text":" from &rsquo;../hooks/useAuthUnified';"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":116,"column":85,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[4502,4534],"text":" from '../hooks/useAuthUnified&apos;;"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[4502,4534],"text":" from '../hooks/useAuthUnified&lsquo;;"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[4502,4534],"text":" from '../hooks/useAuthUnified&#39;;"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[4502,4534],"text":" from '../hooks/useAuthUnified&rsquo;;"},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Ejemplo de migraci√≥n del sistema de autenticaci√≥n legacy al nuevo sistema unificado\r\n * Este componente muestra c√≥mo migrar de useUserContext a useAuthUnified\r\n */\r\n\r\nimport React from 'react';\r\nimport { useUserContext } from '../../context/UserContext'; // Sistema legacy\r\nimport { useAuth } from '../../hooks/useAuthUnified'; // Nuevo sistema\r\n\r\n/**\r\n * Componente que demuestra la migraci√≥n gradual\r\n * Usa ambos sistemas durante la transici√≥n\r\n */\r\nconst AuthMigrationExample = () => {\r\n  // Sistema legacy (mantener durante la migraci√≥n)\r\n  const legacyAuth = useUserContext();\r\n  \r\n  // Nuevo sistema unificado\r\n  const unifiedAuth = useAuth();\r\n\r\n  return (\r\n    <div className=\"p-6 bg-gray-50 rounded-lg\">\r\n      <h3 className=\"text-lg font-semibold mb-4\">Comparaci√≥n de Sistemas de Autenticaci√≥n</h3>\r\n      \r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n        {/* Sistema Legacy */}\r\n        <div className=\"bg-white p-4 rounded border\">\r\n          <h4 className=\"font-medium text-red-600 mb-3\">Sistema Legacy (useUserContext)</h4>\r\n          <div className=\"space-y-2 text-sm\">\r\n            <div>\r\n              <strong>Usuario:</strong> {legacyAuth.user?.email || 'No autenticado'}\r\n            </div>\r\n            <div>\r\n              <strong>Autenticado:</strong> {legacyAuth.isAuthenticated ? 'S√≠' : 'No'}\r\n            </div>\r\n            <div>\r\n              <strong>Rol:</strong> {legacyAuth.role || 'N/A'}\r\n            </div>\r\n            <div>\r\n              <strong>Cargando:</strong> {legacyAuth.loading ? 'S√≠' : 'No'}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Sistema Nuevo */}\r\n        <div className=\"bg-white p-4 rounded border\">\r\n          <h4 className=\"font-medium text-green-600 mb-3\">Sistema Nuevo (useAuthUnified)</h4>\r\n          <div className=\"space-y-2 text-sm\">\r\n            <div>\r\n              <strong>Usuario:</strong> {unifiedAuth.currentUser?.email || 'No autenticado'}\r\n            </div>\r\n            <div>\r\n              <strong>Autenticado:</strong> {unifiedAuth.isAuthenticated ? 'S√≠' : 'No'}\r\n            </div>\r\n            <div>\r\n              <strong>Rol:</strong> {unifiedAuth.userProfile?.role || 'N/A'}\r\n            </div>\r\n            <div>\r\n              <strong>Cargando:</strong> {unifiedAuth.isLoading ? 'S√≠' : 'No'}\r\n            </div>\r\n            <div>\r\n              <strong>Sesi√≥n activa:</strong> {unifiedAuth.sessionInfo?.isActive ? 'S√≠' : 'No'}\r\n            </div>\r\n            <div>\r\n              <strong>√öltima actividad:</strong> {\r\n                unifiedAuth.sessionInfo?.lastActivity \r\n                  ? new Date(unifiedAuth.sessionInfo.lastActivity).toLocaleTimeString()\r\n                  : 'N/A'\r\n              }\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Acciones de ejemplo */}\r\n      <div className=\"mt-6 space-y-4\">\r\n        <h4 className=\"font-medium\">Acciones Disponibles:</h4>\r\n        \r\n        <div className=\"flex flex-wrap gap-2\">\r\n          {unifiedAuth.isAuthenticated && (\r\n            <>\r\n              <button\r\n                onClick={() => unifiedAuth.refreshToken()}\r\n                className=\"px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600\"\r\n              >\r\n                Refrescar Token\r\n              </button>\r\n              \r\n              <button\r\n                onClick={() => unifiedAuth.updateProfile({ lastActivity: Date.now() })}\r\n                className=\"px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600\"\r\n              >\r\n                Actualizar Actividad\r\n              </button>\r\n              \r\n              {unifiedAuth.hasRole('admin') && (\r\n                <span className=\"px-3 py-1 bg-purple-100 text-purple-800 rounded text-sm\">\r\n                  Acceso de Administrador\r\n                </span>\r\n              )}\r\n              \r\n              {unifiedAuth.hasPermission('access_mail_api') && (\r\n                <span className=\"px-3 py-1 bg-blue-100 text-blue-800 rounded text-sm\">\r\n                  Acceso a Email API\r\n                </span>\r\n              )}\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Gu√≠a de migraci√≥n */}\r\n      <div className=\"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded\">\r\n        <h4 className=\"font-medium text-yellow-800 mb-2\">Gu√≠a de Migraci√≥n:</h4>\r\n        <div className=\"text-sm text-yellow-700 space-y-1\">\r\n          <div>1. Importar: <code>import {`{useAuth}`} from '../hooks/useAuthUnified';</code></div>\r\n          <div>2. Cambiar: <code>useUserContext()</code> ‚Üí <code>useAuth()</code></div>\r\n          <div>3. Actualizar propiedades: <code>user</code> ‚Üí <code>currentUser</code></div>\r\n          <div>4. Usar nuevas funcionalidades: <code>hasRole(), hasPermission(), refreshToken()</code></div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AuthMigrationExample;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\auth\\AuthMigrationWrapper.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\auth\\SessionManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'LogOut' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":42},{"ruleId":"no-unused-vars","severity":1,"message":"'isLoading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":196,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":196,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Componente para manejar sesiones expiradas y feedback de autenticaci√≥n\r\n * Proporciona notificaciones, modales de reautenticaci√≥n y gesti√≥n de errores\r\n */\r\n\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport { AlertTriangle, RefreshCw, LogOut, Shield, Clock, Wifi, WifiOff } from 'lucide-react';\r\nimport { toast } from 'react-toastify';\r\nimport { useAuth, useAuthError } from '../../hooks/useAuthUnified';\r\n\r\n/**\r\n * Modal de reautenticaci√≥n\r\n */\r\nconst ReauthModal = ({ isOpen, onClose, onReauth, error }) => {\r\n  const [password, setPassword] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { currentUser } = useAuth();\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (!password.trim()) return;\r\n\r\n    setIsLoading(true);\r\n    try {\r\n      await onReauth(password);\r\n      setPassword('');\r\n      onClose();\r\n      toast.success('Reautenticaci√≥n exitosa');\r\n    } catch (error) {\r\n      toast.error('Error en reautenticaci√≥n: ' + error.message);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n      <div className=\"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl\">\r\n        <div className=\"flex items-center mb-4\">\r\n          <Shield className=\"h-6 w-6 text-yellow-500 mr-2\" />\r\n          <h2 className=\"text-lg font-semibold\">Reautenticaci√≥n Requerida</h2>\r\n        </div>\r\n        \r\n        <p className=\"text-gray-600 mb-4\">\r\n          Tu sesi√≥n ha expirado. Por favor, confirma tu contrase√±a para continuar.\r\n        </p>\r\n        \r\n        {error && (\r\n          <div className=\"bg-red-50 border border-red-200 rounded-md p-3 mb-4\">\r\n            <div className=\"flex\">\r\n              <AlertTriangle className=\"h-4 w-4 text-red-400 mr-2 mt-0.5\" />\r\n              <span className=\"text-sm text-red-700\">{error}</span>\r\n            </div>\r\n          </div>\r\n        )}\r\n        \r\n        <form onSubmit={handleSubmit}>\r\n          <div className=\"mb-4\">\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              Email: {currentUser?.email}\r\n            </label>\r\n            <input\r\n              type=\"password\"\r\n              placeholder=\"Contrase√±a\"\r\n              value={password}\r\n              onChange={(e) => setPassword(e.target.value)}\r\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n              disabled={isLoading}\r\n              autoFocus\r\n            />\r\n          </div>\r\n          \r\n          <div className=\"flex space-x-3\">\r\n            <button\r\n              type=\"submit\"\r\n              disabled={!password.trim() || isLoading}\r\n              className=\"flex-1 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center\"\r\n            >\r\n              {isLoading ? (\r\n                <RefreshCw className=\"h-4 w-4 animate-spin mr-2\" />\r\n              ) : (\r\n                <Shield className=\"h-4 w-4 mr-2\" />\r\n              )}\r\n              {isLoading ? 'Verificando...' : 'Confirmar'}\r\n            </button>\r\n            \r\n            <button\r\n              type=\"button\"\r\n              onClick={onClose}\r\n              className=\"px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50\"\r\n              disabled={isLoading}\r\n            >\r\n              Cancelar\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n/**\r\n * Indicador de estado de conexi√≥n\r\n */\r\nconst ConnectionStatus = ({ isOnline, lastSync }) => {\r\n  const [showDetails, setShowDetails] = useState(false);\r\n\r\n  return (\r\n    <div className=\"fixed top-4 right-4 z-40\">\r\n      <div\r\n        className={`flex items-center px-3 py-2 rounded-full text-sm font-medium cursor-pointer transition-all ${\r\n          isOnline\r\n            ? 'bg-green-100 text-green-800 hover:bg-green-200'\r\n            : 'bg-red-100 text-red-800 hover:bg-red-200'\r\n        }`}\r\n        onClick={() => setShowDetails(!showDetails)}\r\n      >\r\n        {isOnline ? (\r\n          <Wifi className=\"h-4 w-4 mr-2\" />\r\n        ) : (\r\n          <WifiOff className=\"h-4 w-4 mr-2\" />\r\n        )}\r\n        {isOnline ? 'Conectado' : 'Sin conexi√≥n'}\r\n      </div>\r\n      \r\n      {showDetails && (\r\n        <div className=\"absolute top-12 right-0 bg-white border border-gray-200 rounded-lg shadow-lg p-3 min-w-48\">\r\n          <div className=\"text-xs text-gray-600\">\r\n            <div className=\"flex justify-between mb-1\">\r\n              <span>Estado:</span>\r\n              <span className={isOnline ? 'text-green-600' : 'text-red-600'}>\r\n                {isOnline ? 'En l√≠nea' : 'Desconectado'}\r\n              </span>\r\n            </div>\r\n            {lastSync && (\r\n              <div className=\"flex justify-between\">\r\n                <span>√öltima sync:</span>\r\n                <span>{new Date(lastSync).toLocaleTimeString()}</span>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\n/**\r\n * Notificaci√≥n de sesi√≥n pr√≥xima a expirar\r\n */\r\nconst SessionWarning = ({ timeLeft, onExtend, onLogout }) => {\r\n  const minutes = Math.ceil(timeLeft / 60000);\r\n\r\n  return (\r\n    <div className=\"fixed bottom-4 right-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4 shadow-lg max-w-sm z-40\">\r\n      <div className=\"flex items-start\">\r\n        <Clock className=\"h-5 w-5 text-yellow-400 mr-3 mt-0.5\" />\r\n        <div className=\"flex-1\">\r\n          <h3 className=\"text-sm font-medium text-yellow-800\">\r\n            Sesi√≥n pr√≥xima a expirar\r\n          </h3>\r\n          <p className=\"text-sm text-yellow-700 mt-1\">\r\n            Tu sesi√≥n expirar√° en {minutes} minuto{minutes !== 1 ? 's' : ''}\r\n          </p>\r\n          <div className=\"flex space-x-2 mt-3\">\r\n            <button\r\n              onClick={onExtend}\r\n              className=\"text-xs bg-yellow-600 text-white px-3 py-1 rounded hover:bg-yellow-700\"\r\n            >\r\n              Extender sesi√≥n\r\n            </button>\r\n            <button\r\n              onClick={onLogout}\r\n              className=\"text-xs border border-yellow-600 text-yellow-600 px-3 py-1 rounded hover:bg-yellow-50\"\r\n            >\r\n              Cerrar sesi√≥n\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n/**\r\n * Componente principal de gesti√≥n de sesiones\r\n */\r\nconst SessionManager = ({ children }) => {\r\n  const { \r\n    isAuthenticated, \r\n    logout, \r\n    reauthenticate, \r\n    currentUser,\r\n    isLoading \r\n  } = useAuth();\r\n  \r\n  const { error, clearError, getErrorMessage } = useAuthError();\r\n  \r\n  // Estados locales\r\n  const [showReauthModal, setShowReauthModal] = useState(false);\r\n  const [sessionTimeLeft, setSessionTimeLeft] = useState(null);\r\n  const [isOnline, setIsOnline] = useState(navigator.onLine);\r\n  const [lastSync, setLastSync] = useState(Date.now());\r\n  const [reauthError, setReauthError] = useState(null);\r\n\r\n  /**\r\n   * Maneja la reautenticaci√≥n\r\n   */\r\n  const handleReauth = useCallback(async (password) => {\r\n    try {\r\n      setReauthError(null);\r\n      const result = await reauthenticate(password);\r\n      \r\n      if (result.success) {\r\n        setShowReauthModal(false);\r\n        clearError();\r\n      } else {\r\n        setReauthError(getErrorMessage(result.error?.code));\r\n      }\r\n    } catch (error) {\r\n      setReauthError(error.message);\r\n      throw error;\r\n    }\r\n  }, [reauthenticate, clearError, getErrorMessage]);\r\n\r\n  /**\r\n   * Maneja el cierre de sesi√≥n\r\n   */\r\n  const handleLogout = useCallback(async () => {\r\n    try {\r\n      await logout();\r\n      setShowReauthModal(false);\r\n      clearError();\r\n      toast.info('Sesi√≥n cerrada correctamente');\r\n    } catch (error) {\r\n      toast.error('Error al cerrar sesi√≥n');\r\n    }\r\n  }, [logout, clearError]);\r\n\r\n  /**\r\n   * Extiende la sesi√≥n actual\r\n   */\r\n  const extendSession = useCallback(async () => {\r\n    try {\r\n      // Refrescar token para extender sesi√≥n\r\n      if (currentUser) {\r\n        await currentUser.getIdToken(true);\r\n        setSessionTimeLeft(null);\r\n        setLastSync(Date.now());\r\n        toast.success('Sesi√≥n extendida correctamente');\r\n      }\r\n    } catch (error) {\r\n      toast.error('Error al extender la sesi√≥n');\r\n    }\r\n  }, [currentUser]);\r\n\r\n  /**\r\n   * Monitorea el estado de conexi√≥n\r\n   */\r\n  useEffect(() => {\r\n    const handleOnline = () => {\r\n      setIsOnline(true);\r\n      setLastSync(Date.now());\r\n      toast.success('Conexi√≥n restaurada');\r\n    };\r\n    \r\n    const handleOffline = () => {\r\n      setIsOnline(false);\r\n      toast.warning('Sin conexi√≥n a internet');\r\n    };\r\n\r\n    window.addEventListener('online', handleOnline);\r\n    window.addEventListener('offline', handleOffline);\r\n\r\n    return () => {\r\n      window.removeEventListener('online', handleOnline);\r\n      window.removeEventListener('offline', handleOffline);\r\n    };\r\n  }, []);\r\n\r\n  /**\r\n   * Monitorea errores de autenticaci√≥n\r\n   */\r\n  useEffect(() => {\r\n    if (error) {\r\n      switch (error.code) {\r\n        case 'token-expired':\r\n        case 'session-expired':\r\n          setShowReauthModal(true);\r\n          break;\r\n        case 'token-refresh-failed':\r\n          toast.error('Error al refrescar la sesi√≥n. Por favor, inicia sesi√≥n nuevamente.');\r\n          break;\r\n        case 'network-error':\r\n          toast.error('Error de conexi√≥n. Verifica tu internet.');\r\n          break;\r\n        default:\r\n          if (error.message) {\r\n            toast.error(error.message);\r\n          }\r\n      }\r\n    }\r\n  }, [error]);\r\n\r\n  /**\r\n   * Simula monitoreo de tiempo de sesi√≥n\r\n   * En una implementaci√≥n real, esto vendr√≠a del token JWT\r\n   */\r\n  useEffect(() => {\r\n    if (!isAuthenticated) return;\r\n\r\n    const checkSessionTime = () => {\r\n      // Simular tiempo restante de sesi√≥n (en una app real vendr√≠a del token)\r\n      const now = Date.now();\r\n      const sessionStart = localStorage.getItem('lovenda_last_activity');\r\n      \r\n      if (sessionStart) {\r\n        const elapsed = now - parseInt(sessionStart);\r\n        const sessionDuration = 60 * 60 * 1000; // 1 hora\r\n        const remaining = sessionDuration - elapsed;\r\n        \r\n        if (remaining <= 5 * 60 * 1000 && remaining > 0) { // 5 minutos\r\n          setSessionTimeLeft(remaining);\r\n        } else if (remaining <= 0) {\r\n          handleLogout();\r\n        } else {\r\n          setSessionTimeLeft(null);\r\n        }\r\n      }\r\n    };\r\n\r\n    const interval = setInterval(checkSessionTime, 30000); // Cada 30 segundos\r\n    checkSessionTime(); // Verificar inmediatamente\r\n\r\n    return () => clearInterval(interval);\r\n  }, [isAuthenticated, handleLogout]);\r\n\r\n  return (\r\n    <>\r\n      {children}\r\n      \r\n      {/* Indicador de conexi√≥n */}\r\n      <ConnectionStatus isOnline={isOnline} lastSync={lastSync} />\r\n      \r\n      {/* Advertencia de sesi√≥n pr√≥xima a expirar */}\r\n      {sessionTimeLeft && (\r\n        <SessionWarning\r\n          timeLeft={sessionTimeLeft}\r\n          onExtend={extendSession}\r\n          onLogout={handleLogout}\r\n        />\r\n      )}\r\n      \r\n      {/* Modal de reautenticaci√≥n */}\r\n      <ReauthModal\r\n        isOpen={showReauthModal}\r\n        onClose={() => setShowReauthModal(false)}\r\n        onReauth={handleReauth}\r\n        error={reauthError}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default SessionManager;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\dashboard\\Dashboard.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"no-unused-vars","severity":1,"message":"'WidgetTypes' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":21},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":174,"column":43,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[5836,5906],"text":"Haz clic en &quot;Personalizar\" para agregar widgets a tu panel de control."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[5836,5906],"text":"Haz clic en &ldquo;Personalizar\" para agregar widgets a tu panel de control."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[5836,5906],"text":"Haz clic en &#34;Personalizar\" para agregar widgets a tu panel de control."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[5836,5906],"text":"Haz clic en &rdquo;Personalizar\" para agregar widgets a tu panel de control."},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":174,"column":56,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[5836,5906],"text":"Haz clic en \"Personalizar&quot; para agregar widgets a tu panel de control."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[5836,5906],"text":"Haz clic en \"Personalizar&ldquo; para agregar widgets a tu panel de control."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[5836,5906],"text":"Haz clic en \"Personalizar&#34; para agregar widgets a tu panel de control."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[5836,5906],"text":"Haz clic en \"Personalizar&rdquo; para agregar widgets a tu panel de control."},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { DndProvider } from 'react-dnd';\r\nimport { HTML5Backend } from 'react-dnd-html5-backend';\r\nimport { TouchBackend } from 'react-dnd-touch-backend';\r\nimport { isMobile } from 'react-device-detect';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { Widget } from './Widget';\r\nimport { WidgetSelector } from './WidgetSelector';\r\nimport { WidgetTypes } from './widgets/WidgetTypes';\r\nimport { useWidgets } from '../../hooks/useWidgets';\r\n\r\n// Animation variants (memoizadas para performance)\r\nconst containerVariants = {\r\n  hidden: { opacity: 0 },\r\n  show: {\r\n    opacity: 1,\r\n    transition: {\r\n      staggerChildren: 0.1\r\n    }\r\n  }\r\n};\r\n\r\nconst itemVariants = {\r\n  hidden: { opacity: 0, y: 20 },\r\n  show: { \r\n    opacity: 1, \r\n    y: 0,\r\n    transition: {\r\n      duration: 0.3,\r\n      ease: 'easeOut'\r\n    }\r\n  },\r\n  exit: { \r\n    opacity: 0, \r\n    y: -20,\r\n    transition: {\r\n      duration: 0.2,\r\n      ease: 'easeIn'\r\n    }\r\n  }\r\n};\r\n\r\nexport function Dashboard() {\r\n  const { \r\n    widgets, \r\n    addWidget, \r\n    removeWidget, \r\n    moveWidget, \r\n    updateWidgetConfig \r\n  } = useWidgets();\r\n  \r\n  const [isEditing, setIsEditing] = useState(false);\r\n  \r\n  // Set up the appropriate drag and drop backend based on device type (memoizado)\r\n  const dndBackend = useMemo(() => isMobile ? TouchBackend : HTML5Backend, []);\r\n  \r\n  // Memoizar funci√≥n de toggle editing\r\n  const toggleEditing = useCallback(() => {\r\n    setIsEditing(!isEditing);\r\n  }, [isEditing]);\r\n  \r\n  // Memoizar funci√≥n de activar editing mode\r\n  const startEditing = useCallback(() => {\r\n    setIsEditing(true);\r\n  }, []);\r\n  \r\n  return (\r\n    <div className=\"p-4 md:p-6 max-w-7xl mx-auto\">\r\n      <motion.div \r\n        initial={{ opacity: 0, y: -10 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        transition={{ duration: 0.3 }}\r\n        className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4\"\r\n      >\r\n        <div>\r\n          <h1 className=\"text-2xl md:text-3xl font-bold text-gray-800\">Panel de Control</h1>\r\n          <p className=\"text-gray-500 mt-1\">\r\n            {isEditing \r\n              ? 'Arrastra y suelta para reorganizar los widgets' \r\n              : 'Vista general de tu boda'}\r\n          </p>\r\n        </div>\r\n        <button\r\n          onClick={toggleEditing}\r\n          className={`px-4 py-2 rounded-md transition-all flex items-center gap-2 ${\r\n            isEditing\r\n              ? 'bg-blue-100 text-blue-700 hover:bg-blue-200'\r\n              : 'bg-white border border-gray-200 text-gray-700 hover:bg-gray-50 shadow-sm'\r\n          }`}\r\n        >\r\n          {isEditing ? (\r\n            <>\r\n              <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n              </svg>\r\n              Listo\r\n            </>\r\n          ) : (\r\n            <>\r\n              <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" />\r\n              </svg>\r\n              Personalizar\r\n            </>\r\n          )}\r\n        </button>\r\n      </motion.div>\r\n      \r\n      <DndProvider backend={dndBackend}>\r\n        <motion.div \r\n          variants={containerVariants}\r\n          initial=\"hidden\"\r\n          animate=\"show\"\r\n          className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\"\r\n        >\r\n          <AnimatePresence>\r\n            {widgets.map((widget, index) => (\r\n              <motion.div\r\n                key={widget.id}\r\n                variants={itemVariants}\r\n                layout\r\n                transition={{\r\n                  type: \"spring\",\r\n                  damping: 25,\r\n                  stiffness: 120\r\n                }}\r\n              >\r\n                <Widget\r\n                  index={index}\r\n                  widget={widget}\r\n                  isEditing={isEditing}\r\n                  onRemove={removeWidget}\r\n                  onMove={moveWidget}\r\n                  onConfigUpdate={updateWidgetConfig}\r\n                />\r\n              </motion.div>\r\n            ))}\r\n            \r\n            {isEditing && (\r\n              <motion.div\r\n                variants={itemVariants}\r\n                initial=\"hidden\"\r\n                animate=\"show\"\r\n                exit=\"exit\"\r\n                layout\r\n              >\r\n                <WidgetSelector onSelect={addWidget} />\r\n              </motion.div>\r\n            )}\r\n          </AnimatePresence>\r\n        </motion.div>\r\n      </DndProvider>\r\n      \r\n      {widgets.length === 0 && !isEditing && (\r\n        <motion.div \r\n          initial={{ opacity: 0, y: 20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          className=\"mt-16 text-center text-gray-500\"\r\n        >\r\n          <svg \r\n            className=\"mx-auto h-12 w-12 text-gray-400\" \r\n            fill=\"none\" \r\n            viewBox=\"0 0 24 24\" \r\n            stroke=\"currentColor\"\r\n          >\r\n            <path \r\n              strokeLinecap=\"round\" \r\n              strokeLinejoin=\"round\" \r\n              strokeWidth={1.5} \r\n              d=\"M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z\" \r\n            />\r\n          </svg>\r\n          <h3 className=\"mt-2 text-lg font-medium text-gray-700\">No hay widgets en tu panel</h3>\r\n          <p className=\"mt-1\">Haz clic en \"Personalizar\" para agregar widgets a tu panel de control.</p>\r\n          <button\r\n            onClick={startEditing}\r\n            className=\"mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\r\n          >\r\n            <svg className=\"-ml-1 mr-2 h-5 w-5\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n              <path fillRule=\"evenodd\" d=\"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z\" clipRule=\"evenodd\" />\r\n            </svg>\r\n            Agregar widgets\r\n          </button>\r\n        </motion.div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\dashboard\\Widget.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'cursor' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":99,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":99,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useRef, useState } from 'react';\r\nimport { useDrag, useDrop } from 'react-dnd';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { WidgetContent } from './WidgetContent';\r\nimport { WidgetConfig } from './WidgetConfig';\r\n\r\n// Animation variants\r\nconst widgetVariants = {\r\n  hidden: { opacity: 0, scale: 0.95 },\r\n  visible: { \r\n    opacity: 1, \r\n    scale: 1,\r\n    transition: { \r\n      duration: 0.2,\r\n      ease: 'easeOut'\r\n    }\r\n  },\r\n  exit: { \r\n    opacity: 0, \r\n    scale: 0.95,\r\n    transition: { \r\n      duration: 0.15,\r\n      ease: 'easeIn'\r\n    }\r\n  },\r\n  hover: {\r\n    y: -2,\r\n    boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)'\r\n  },\r\n  drag: {\r\n    scale: 1.02,\r\n    boxShadow: '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)'\r\n  }\r\n};\r\n\r\nexport const Widget = ({\r\n  widget,\r\n  index,\r\n  isEditing,\r\n  onRemove,\r\n  onMove,\r\n  onConfigUpdate,\r\n}) => {\r\n  const ref = useRef(null);\r\n  const [showConfig, setShowConfig] = useState(false);\r\n  \r\n  const [{ isDragging }, drag] = useDrag({\r\n    type: 'WIDGET',\r\n    item: { id: widget.id, index },\r\n    canDrag: isEditing,\r\n    collect: (monitor) => ({\r\n      isDragging: monitor.isDragging(),\r\n    }),\r\n  });\r\n\r\n  const [, drop] = useDrop({\r\n    accept: 'WIDGET',\r\n    hover(item, monitor) {\r\n      if (!ref.current) return;\r\n      const dragIndex = item.index;\r\n      const hoverIndex = index;\r\n      \r\n      // Don't replace items with themselves\r\n      if (dragIndex === hoverIndex) return;\r\n      \r\n      // Determine rectangle on screen\r\n      const hoverBoundingRect = ref.current.getBoundingClientRect();\r\n      \r\n      // Get vertical middle\r\n      const hoverMiddleY = (hoverBoundingRect.bottom - hoverBoundingRect.top) / 2;\r\n      \r\n      // Determine mouse position\r\n      const clientOffset = monitor.getClientOffset();\r\n      \r\n      // Get pixels to the top\r\n      const hoverClientY = clientOffset.y - hoverBoundingRect.top;\r\n      \r\n      // Only perform the move when the mouse has crossed half of the items height\r\n      // When dragging downwards, only move when the cursor is below 50%\r\n      // When dragging upwards, only move when the cursor is above 50%\r\n      if (dragIndex < hoverIndex && hoverClientY < hoverMiddleY) return;\r\n      if (dragIndex > hoverIndex && hoverClientY > hoverMiddleY) return;\r\n      \r\n      // Time to actually perform the action\r\n      onMove(dragIndex, hoverIndex);\r\n      \r\n      // Note: we're mutating the monitor item here!\r\n      // Generally it's better to avoid mutations,\r\n      // but it's good here for the sake of performance\r\n      // to avoid expensive index searches.\r\n      item.index = hoverIndex;\r\n    },\r\n  });\r\n  \r\n  // Initialize drag and drop refs\r\n  drag(drop(ref));\r\n  \r\n  const opacity = isDragging ? 0.4 : 1;\r\n  const cursor = isEditing ? 'cursor-move' : 'cursor-default';\r\n  \r\n  return (\r\n    <motion.div \r\n      ref={ref}\r\n      className=\"relative group\"\r\n      style={{ opacity }}\r\n      variants={widgetVariants}\r\n      initial=\"hidden\"\r\n      animate=\"visible\"\r\n      exit=\"exit\"\r\n      whileHover={isEditing ? \"hover\" : undefined}\r\n      whileTap={isEditing ? { scale: 0.98 } : undefined}\r\n      drag={isEditing}\r\n      dragConstraints={{ top: 0, left: 0, right: 0, bottom: 0 }}\r\n      dragElastic={0.1}\r\n      dragMomentum={false}\r\n      layout\r\n    >\r\n      <div \r\n        className={`bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden transition-all duration-200 ${\r\n          isEditing ? 'ring-2 ring-blue-400 ring-opacity-50 hover:ring-blue-400' : 'hover:shadow-md'\r\n        }`}\r\n      >\r\n        <div className=\"p-4 border-b border-gray-100 bg-gradient-to-r from-white to-gray-50\">\r\n          <div className=\"flex justify-between items-center\">\r\n            <h3 className=\"text-base font-semibold text-gray-800 flex items-center gap-2\">\r\n              {widget.type === 'calendar' && (\r\n                <span className=\"text-blue-500\">üìÖ</span>\r\n              )}\r\n              {widget.type === 'tasks' && (\r\n                <span className=\"text-green-500\">‚úÖ</span>\r\n              )}\r\n              {widget.type === 'budget' && (\r\n                <span className=\"text-yellow-500\">üí∞</span>\r\n              )}\r\n              {widget.type === 'guest_list' && (\r\n                <span className=\"text-purple-500\">üë•</span>\r\n              )}\r\n              {widget.type === 'timeline' && (\r\n                <span className=\"text-red-500\">‚è±Ô∏è</span>\r\n              )}\r\n              {widget.config.title}\r\n            </h3>\r\n            {isEditing && (\r\n              <div className=\"flex items-center gap-1\">\r\n                <button\r\n                  onClick={(e) => {\r\n                    e.stopPropagation();\r\n                    setShowConfig(!showConfig);\r\n                  }}\r\n                  className=\"p-1.5 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-colors\"\r\n                  aria-label=\"Configurar widget\"\r\n                >\r\n                  <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\" />\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n                  </svg>\r\n                </button>\r\n                <button\r\n                  onClick={(e) => {\r\n                    e.stopPropagation();\r\n                    onRemove(widget.id);\r\n                  }}\r\n                  className=\"p-1.5 rounded-full text-red-400 hover:text-red-600 hover:bg-red-50 transition-colors\"\r\n                  aria-label=\"Eliminar widget\"\r\n                >\r\n                  <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n                  </svg>\r\n                </button>\r\n                <div className=\"w-6 h-6 flex items-center justify-center text-gray-300 cursor-grab active:cursor-grabbing\">\r\n                  <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 8h16M4 16h16\" />\r\n                  </svg>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n        \r\n        <AnimatePresence>\r\n          {showConfig && (\r\n            <motion.div \r\n              initial={{ opacity: 0, height: 0, overflow: 'hidden' }}\r\n              animate={{ opacity: 1, height: 'auto' }}\r\n              exit={{ opacity: 0, height: 0 }}\r\n              transition={{ duration: 0.2 }}\r\n              className=\"border-b border-gray-100\"\r\n            >\r\n              <div className=\"p-4 bg-gray-50\">\r\n                <WidgetConfig \r\n                  config={widget.config} \r\n                  onUpdate={(newConfig) => onConfigUpdate(widget.id, newConfig)}\r\n                />\r\n              </div>\r\n            </motion.div>\r\n          )}\r\n        </AnimatePresence>\r\n        \r\n        <div className=\"p-4\">\r\n          <WidgetContent widget={widget} />\r\n        </div>\r\n      </div>\r\n    </motion.div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\dashboard\\WidgetConfig.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\dashboard\\WidgetContent.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\dashboard\\WidgetSelector.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\dashboard\\widgets\\BudgetWidget.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\dashboard\\widgets\\CalendarWidget.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'config' is defined but never used. Allowed unused args must match /^_/u.","line":3,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":40}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\n\r\nexport const CalendarWidget = ({ config }) => {\r\n  const today = new Date();\r\n  const month = today.toLocaleString('es-ES', { month: 'long' });\r\n  const year = today.getFullYear();\r\n  const daysInMonth = new Date(year, today.getMonth() + 1, 0).getDate();\r\n  const firstDayOfMonth = new Date(year, today.getMonth(), 1).getDay();\r\n  \r\n  // Create array of days in month\r\n  const days = [];\r\n  for (let i = 1; i <= daysInMonth; i++) {\r\n    days.push(i);\r\n  }\r\n  \r\n  // Add empty cells for days before the first day of the month\r\n  const emptyCells = [];\r\n  for (let i = 0; i < firstDayOfMonth; i++) {\r\n    emptyCells.push(<div key={`empty-${i}`} className=\"h-8\"></div>);\r\n  }\r\n  \r\n  return (\r\n    <div className=\"h-full\">\r\n      <div className=\"text-center font-semibold mb-2\">\r\n        {month.charAt(0).toUpperCase() + month.slice(1)} {year}\r\n      </div>\r\n      <div className=\"grid grid-cols-7 gap-1 text-xs text-center\">\r\n        {['L', 'M', 'X', 'J', 'V', 'S', 'D'].map(day => (\r\n          <div key={day} className=\"font-medium text-gray-500\">{day}</div>\r\n        ))}\r\n        {emptyCells}\r\n        {days.map(day => (\r\n          <div \r\n            key={day} \r\n            className={`h-8 flex items-center justify-center rounded-full ${\r\n              day === today.getDate() \r\n                ? 'bg-blue-500 text-white' \r\n                : 'hover:bg-gray-100'\r\n            }`}\r\n          >\r\n            {day}\r\n          </div>\r\n        ))}\r\n      </div>\r\n      <div className=\"mt-4 text-sm\">\r\n        <div className=\"flex items-center mb-1\">\r\n          <div className=\"w-2 h-2 bg-blue-500 rounded-full mr-2\"></div>\r\n          <span>Evento de boda</span>\r\n        </div>\r\n        <div className=\"flex items-center\">\r\n          <div className=\"w-2 h-2 bg-green-500 rounded-full mr-2\"></div>\r\n          <span>Reuni√≥n con proveedor</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\dashboard\\widgets\\GuestListWidget.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\dashboard\\widgets\\TasksWidget.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\dashboard\\widgets\\TimelineWidget.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'config' is defined but never used. Allowed unused args must match /^_/u.","line":46,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":46,"endColumn":40}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\n\r\nconst TIMELINE_EVENTS = [\r\n  {\r\n    id: 1,\r\n    title: 'Ceremonia',\r\n    time: '17:00 - 18:00',\r\n    location: 'Iglesia de Santa Mar√≠a',\r\n    completed: true,\r\n    current: false,\r\n  },\r\n  {\r\n    id: 2,\r\n    title: 'C√≥ctel de bienvenida',\r\n    time: '18:30 - 20:00',\r\n    location: 'Jardines del Palacio',\r\n    completed: true,\r\n    current: false,\r\n  },\r\n  {\r\n    id: 3,\r\n    title: 'Cena de gala',\r\n    time: '20:30 - 23:00',\r\n    location: 'Sal√≥n de eventos',\r\n    completed: false,\r\n    current: true,\r\n  },\r\n  {\r\n    id: 4,\r\n    title: 'Baile y fiesta',\r\n    time: '23:00 - 02:00',\r\n    location: 'Sala de baile',\r\n    completed: false,\r\n    current: false,\r\n  },\r\n  {\r\n    id: 5,\r\n    title: 'Despedida',\r\n    time: '02:30',\r\n    location: '',\r\n    completed: false,\r\n    current: false,\r\n  },\r\n];\r\n\r\nexport const TimelineWidget = ({ config }) => {\r\n  return (\r\n    <div className=\"h-full\">\r\n      <div className=\"relative\r\n        after:absolute\r\n        after:top-0\r\n        after:bottom-0\r\n        after:left-4\r\n        after:w-0.5\r\n        after:bg-gray-200\r\n        after:content-['']\r\n      \">\r\n        {TIMELINE_EVENTS.map((event, index) => (\r\n          <div key={event.id} className=\"relative pl-8 pb-6 group\">\r\n            <div className={`absolute left-0 z-10 w-8 h-8 rounded-full flex items-center justify-center ${\r\n              event.completed \r\n                ? 'bg-green-500 text-white' \r\n                : event.current\r\n                ? 'bg-blue-500 text-white ring-4 ring-blue-200'\r\n                : 'bg-white border-2 border-gray-300 text-gray-400'\r\n            }`}>\r\n              {event.completed ? (\r\n                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n                </svg>\r\n              ) : (\r\n                <span className=\"font-medium\">{index + 1}</span>\r\n              )}\r\n            </div>\r\n            <div className={`p-3 rounded-lg ${\r\n              event.current \r\n                ? 'bg-blue-50 border-l-4 border-blue-500' \r\n                : 'bg-white border border-gray-200'\r\n            }`}>\r\n              <div className=\"flex justify-between items-start\">\r\n                <h4 className={`font-medium ${\r\n                  event.completed ? 'text-gray-500' : 'text-gray-900'\r\n                }`}>\r\n                  {event.title}\r\n                </h4>\r\n                <span className={`text-sm ${\r\n                  event.completed ? 'text-gray-400' : 'text-blue-600'\r\n                }`}>\r\n                  {event.time}\r\n                </span>\r\n              </div>\r\n              {event.location && (\r\n                <div className=\"mt-1 flex items-center text-sm text-gray-500\">\r\n                  <svg className=\"w-4 h-4 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\" />\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n                  </svg>\r\n                  {event.location}\r\n                </div>\r\n              )}\r\n              {event.current && (\r\n                <div className=\"mt-2 text-xs text-blue-600 font-medium\">\r\n                  Evento actual\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n      <div className=\"mt-4 text-right\">\r\n        <button className=\"text-sm text-blue-600 hover:text-blue-800\">\r\n          Ver cronograma completo ‚Üí\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\dashboard\\widgets\\WidgetTypes.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\debug\\ErrorBoundary.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'error' is defined but never used. Allowed unused args must match /^_/u.","line":14,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":40}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { performanceMonitor } from '../../services/PerformanceMonitor';\r\n\r\n/**\r\n * ErrorBoundary global para capturar errores de React y registrar m√©tricas.\r\n * Muestra un mensaje amigable y registra el error mediante el monitor de rendimiento.\r\n */\r\nclass ErrorBoundary extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { hasError: false, errorInfo: null };\r\n  }\r\n\r\n  static getDerivedStateFromError(error) {\r\n    return { hasError: true };\r\n  }\r\n\r\n  componentDidCatch(error, info) {\r\n    this.setState({ errorInfo: info });\r\n    try {\r\n      performanceMonitor.logError('react_error', error, { componentStack: info.componentStack });\r\n    } catch (e) {\r\n      // En caso de fallo en el monitor, al menos mostramos por consola\r\n      console.error('Error report failed:', e);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      return (\r\n        <div className=\"p-8 text-center\">\r\n          <h1 className=\"text-2xl font-semibold mb-4\">Algo ha ido mal</h1>\r\n          <p className=\"text-gray-600 mb-4\">Se ha producido un error inesperado. Nuestro equipo ha sido notificado.</p>\r\n          {process.env.NODE_ENV !== 'production' && this.state.errorInfo && (\r\n            <pre className=\"text-left whitespace-pre-wrap bg-gray-100 p-4 rounded shadow-inner overflow-x-auto max-h-64\">\r\n              {this.state.errorInfo.componentStack}\r\n            </pre>\r\n          )}\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return this.props.children;\r\n  }\r\n}\r\n\r\nexport default ErrorBoundary;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\AIEmailHistoryPanel.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Divider' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":63,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":70},{"ruleId":"no-unused-vars","severity":1,"message":"'LinearProgress' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":55}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { Box, Typography, Tabs, Tab, CircularProgress, Paper, Divider, \r\n         Table, TableBody, TableCell, TableContainer, TableHead, TableRow, \r\n         Chip, Card, CardContent, Grid, LinearProgress } from '@mui/material';\r\nimport { Chart as ChartJS, ArcElement, Tooltip, Legend, CategoryScale, \r\n         LinearScale, PointElement, LineElement, BarElement } from 'chart.js';\r\nimport { Pie, Bar } from 'react-chartjs-2';\r\nimport AIEmailTrackingService from '../../services/AIEmailTrackingService';\r\nimport { format } from 'date-fns';\r\nimport { es } from 'date-fns/locale';\r\n\r\n// Registrar componentes de Chart.js\r\nChartJS.register(\r\n  ArcElement, \r\n  Tooltip, \r\n  Legend, \r\n  CategoryScale,\r\n  LinearScale,\r\n  PointElement,\r\n  LineElement,\r\n  BarElement\r\n);\r\n\r\n/**\r\n * Componente que muestra estad√≠sticas y el historial de correos originados desde b√∫squedas AI\r\n */\r\nconst AIEmailHistoryPanel = () => {\r\n  const [loading, setLoading] = useState(true);\r\n  const [activeTab, setActiveTab] = useState(0);\r\n  const [activities, setActivities] = useState([]);\r\n  const [metrics, setMetrics] = useState(null);\r\n  const [comparisonData, setComparisonData] = useState(null);\r\n  \r\n  const trackingService = new AIEmailTrackingService();\r\n  \r\n  useEffect(() => {\r\n    const loadData = async () => {\r\n      setLoading(true);\r\n      \r\n      // Cargar actividades\r\n      const activitiesData = trackingService.getActivities();\r\n      setActivities(activitiesData);\r\n      \r\n      // Cargar m√©tricas\r\n      const metricsData = trackingService.getMetrics();\r\n      setMetrics(metricsData);\r\n      \r\n      // Cargar datos de comparaci√≥n\r\n      const comparisonData = trackingService.getComparisonData();\r\n      setComparisonData(comparisonData);\r\n      \r\n      setLoading(false);\r\n    };\r\n    \r\n    loadData();\r\n  }, []);\r\n  \r\n  const handleTabChange = (event, newValue) => {\r\n    setActiveTab(newValue);\r\n  };\r\n  \r\n  // Datos para el gr√°fico de tasa de respuesta\r\n  const responseRateChartData = {\r\n    labels: ['Correos AI', 'Correos Tradicionales'],\r\n    datasets: [\r\n      {\r\n        label: 'Tasa de Respuesta (%)',\r\n        data: comparisonData ? [\r\n          parseFloat(comparisonData.ai.responseRate),\r\n          parseFloat(comparisonData.nonAi.responseRate)\r\n        ] : [0, 0],\r\n        backgroundColor: [\r\n          'rgba(54, 162, 235, 0.6)',\r\n          'rgba(255, 99, 132, 0.6)',\r\n        ],\r\n        borderColor: [\r\n          'rgba(54, 162, 235, 1)',\r\n          'rgba(255, 99, 132, 1)',\r\n        ],\r\n        borderWidth: 1,\r\n      },\r\n    ],\r\n  };\r\n  \r\n  // Datos para el gr√°fico de tasa de respuesta por categor√≠a\r\n  const categoryChartData = {\r\n    labels: comparisonData?.categoryBreakdown?.map(cat => cat.category) || [],\r\n    datasets: [\r\n      {\r\n        label: 'Tasa de Respuesta por Categor√≠a (%)',\r\n        data: comparisonData?.categoryBreakdown?.map(cat => parseFloat(cat.responseRate)) || [],\r\n        backgroundColor: [\r\n          'rgba(75, 192, 192, 0.6)',\r\n          'rgba(153, 102, 255, 0.6)',\r\n          'rgba(255, 159, 64, 0.6)',\r\n          'rgba(255, 99, 132, 0.6)',\r\n          'rgba(54, 162, 235, 0.6)',\r\n        ],\r\n        borderColor: [\r\n          'rgba(75, 192, 192, 1)',\r\n          'rgba(153, 102, 255, 1)',\r\n          'rgba(255, 159, 64, 1)',\r\n          'rgba(255, 99, 132, 1)',\r\n          'rgba(54, 162, 235, 1)',\r\n        ],\r\n        borderWidth: 1,\r\n      },\r\n    ],\r\n  };\r\n  \r\n  // Opciones para los gr√°ficos de barras\r\n  const barOptions = {\r\n    responsive: true,\r\n    maintainAspectRatio: false,\r\n    plugins: {\r\n      legend: {\r\n        position: 'top',\r\n      },\r\n    },\r\n    scales: {\r\n      y: {\r\n        beginAtZero: true,\r\n        max: 100,\r\n      },\r\n    },\r\n  };\r\n\r\n  return (\r\n    <Box sx={{ width: '100%', p: 2 }}>\r\n      <Typography variant=\"h4\" gutterBottom>\r\n        Historial de Correos desde B√∫squeda AI\r\n      </Typography>\r\n      \r\n      <Box sx={{ borderBottom: 1, borderColor: 'divider', mb: 2 }}>\r\n        <Tabs value={activeTab} onChange={handleTabChange}>\r\n          <Tab label=\"Resumen\" />\r\n          <Tab label=\"Comparativa AI vs Tradicional\" />\r\n          <Tab label=\"Historial de Actividad\" />\r\n        </Tabs>\r\n      </Box>\r\n      \r\n      {loading ? (\r\n        <Box sx={{ display: 'flex', justifyContent: 'center', p: 4 }}>\r\n          <CircularProgress />\r\n        </Box>\r\n      ) : (\r\n        <>\r\n          {/* Tab 1: Resumen */}\r\n          {activeTab === 0 && (\r\n            <Box>\r\n              <Grid container spacing={3}>\r\n                <Grid item xs={12} md={4}>\r\n                  <Card>\r\n                    <CardContent>\r\n                      <Typography variant=\"h6\" gutterBottom>\r\n                        Correos Enviados\r\n                      </Typography>\r\n                      <Typography variant=\"h4\">\r\n                        {metrics?.totalEmails || 0}\r\n                      </Typography>\r\n                    </CardContent>\r\n                  </Card>\r\n                </Grid>\r\n                <Grid item xs={12} md={4}>\r\n                  <Card>\r\n                    <CardContent>\r\n                      <Typography variant=\"h6\" gutterBottom>\r\n                        Tasa de Respuesta\r\n                      </Typography>\r\n                      <Typography variant=\"h4\">\r\n                        {metrics ? `${metrics.responseRate.toFixed(2)}%` : '0%'}\r\n                      </Typography>\r\n                    </CardContent>\r\n                  </Card>\r\n                </Grid>\r\n                <Grid item xs={12} md={4}>\r\n                  <Card>\r\n                    <CardContent>\r\n                      <Typography variant=\"h6\" gutterBottom>\r\n                        Tiempo Promedio de Respuesta\r\n                      </Typography>\r\n                      <Typography variant=\"h4\">\r\n                        {metrics ? `${metrics.averageResponseTime.toFixed(1)}h` : '0h'}\r\n                      </Typography>\r\n                    </CardContent>\r\n                  </Card>\r\n                </Grid>\r\n                <Grid item xs={12} md={6}>\r\n                  <Card>\r\n                    <CardContent>\r\n                      <Typography variant=\"h6\" gutterBottom>\r\n                        Distribuci√≥n de Respuestas\r\n                      </Typography>\r\n                      <Box height={250}>\r\n                        <Pie \r\n                          data={{\r\n                            labels: ['Respondidos', 'Sin Respuesta'],\r\n                            datasets: [\r\n                              {\r\n                                data: [\r\n                                  metrics?.totalResponses || 0,\r\n                                  (metrics?.totalEmails || 0) - (metrics?.totalResponses || 0)\r\n                                ],\r\n                                backgroundColor: [\r\n                                  'rgba(75, 192, 192, 0.6)',\r\n                                  'rgba(255, 99, 132, 0.6)',\r\n                                ],\r\n                                borderColor: [\r\n                                  'rgba(75, 192, 192, 1)',\r\n                                  'rgba(255, 99, 132, 1)',\r\n                                ],\r\n                                borderWidth: 1,\r\n                              },\r\n                            ],\r\n                          }}\r\n                        />\r\n                      </Box>\r\n                    </CardContent>\r\n                  </Card>\r\n                </Grid>\r\n                <Grid item xs={12} md={6}>\r\n                  <Card>\r\n                    <CardContent>\r\n                      <Typography variant=\"h6\" gutterBottom>\r\n                        Tasas de Respuesta por Categor√≠a\r\n                      </Typography>\r\n                      <Box height={250}>\r\n                        <Bar \r\n                          data={categoryChartData} \r\n                          options={barOptions} \r\n                        />\r\n                      </Box>\r\n                    </CardContent>\r\n                  </Card>\r\n                </Grid>\r\n              </Grid>\r\n            </Box>\r\n          )}\r\n          \r\n          {/* Tab 2: Comparativa */}\r\n          {activeTab === 1 && comparisonData && (\r\n            <Box>\r\n              <Grid container spacing={3}>\r\n                <Grid item xs={12}>\r\n                  <Card>\r\n                    <CardContent>\r\n                      <Typography variant=\"h6\" gutterBottom>\r\n                        Comparaci√≥n de Efectividad: Correos AI vs Tradicionales\r\n                      </Typography>\r\n                      <TableContainer>\r\n                        <Table>\r\n                          <TableHead>\r\n                            <TableRow>\r\n                              <TableCell>M√©trica</TableCell>\r\n                              <TableCell align=\"center\">Correos AI</TableCell>\r\n                              <TableCell align=\"center\">Correos Tradicionales</TableCell>\r\n                              <TableCell align=\"center\">Diferencia</TableCell>\r\n                            </TableRow>\r\n                          </TableHead>\r\n                          <TableBody>\r\n                            <TableRow>\r\n                              <TableCell>Total Enviados</TableCell>\r\n                              <TableCell align=\"center\">{comparisonData.ai.total}</TableCell>\r\n                              <TableCell align=\"center\">{comparisonData.nonAi.total}</TableCell>\r\n                              <TableCell align=\"center\">-</TableCell>\r\n                            </TableRow>\r\n                            <TableRow>\r\n                              <TableCell>Total Respondidos</TableCell>\r\n                              <TableCell align=\"center\">{comparisonData.ai.responded}</TableCell>\r\n                              <TableCell align=\"center\">{comparisonData.nonAi.responded}</TableCell>\r\n                              <TableCell align=\"center\">-</TableCell>\r\n                            </TableRow>\r\n                            <TableRow>\r\n                              <TableCell>Tasa de Respuesta</TableCell>\r\n                              <TableCell align=\"center\">{comparisonData.ai.responseRate}%</TableCell>\r\n                              <TableCell align=\"center\">{comparisonData.nonAi.responseRate}%</TableCell>\r\n                              <TableCell \r\n                                align=\"center\"\r\n                                sx={{\r\n                                  color: parseFloat(comparisonData.difference.responseRate) > 0 ? 'success.main' : 'error.main',\r\n                                  fontWeight: 'bold'\r\n                                }}\r\n                              >\r\n                                {comparisonData.difference.responseRate > 0 ? '+' : ''}{comparisonData.difference.responseRate}%\r\n                              </TableCell>\r\n                            </TableRow>\r\n                            <TableRow>\r\n                              <TableCell>Tiempo Promedio de Respuesta</TableCell>\r\n                              <TableCell align=\"center\">{comparisonData.ai.avgResponseTime}h</TableCell>\r\n                              <TableCell align=\"center\">{comparisonData.nonAi.avgResponseTime}h</TableCell>\r\n                              <TableCell \r\n                                align=\"center\"\r\n                                sx={{\r\n                                  color: parseFloat(comparisonData.difference.avgResponseTime) > 0 ? 'success.main' : 'error.main',\r\n                                  fontWeight: 'bold'\r\n                                }}\r\n                              >\r\n                                {comparisonData.difference.avgResponseTime > 0 ? '+' : ''}{comparisonData.difference.avgResponseTime}h\r\n                              </TableCell>\r\n                            </TableRow>\r\n                          </TableBody>\r\n                        </Table>\r\n                      </TableContainer>\r\n                    </CardContent>\r\n                  </Card>\r\n                </Grid>\r\n                <Grid item xs={12} md={6}>\r\n                  <Card>\r\n                    <CardContent>\r\n                      <Typography variant=\"h6\" gutterBottom>\r\n                        Comparaci√≥n de Tasas de Respuesta\r\n                      </Typography>\r\n                      <Box height={250}>\r\n                        <Bar \r\n                          data={responseRateChartData}\r\n                          options={barOptions}\r\n                        />\r\n                      </Box>\r\n                    </CardContent>\r\n                  </Card>\r\n                </Grid>\r\n                <Grid item xs={12} md={6}>\r\n                  <Card>\r\n                    <CardContent>\r\n                      <Typography variant=\"h6\" gutterBottom>\r\n                        Eficacia por Categor√≠a de Proveedor\r\n                      </Typography>\r\n                      <TableContainer>\r\n                        <Table size=\"small\">\r\n                          <TableHead>\r\n                            <TableRow>\r\n                              <TableCell>Categor√≠a</TableCell>\r\n                              <TableCell align=\"center\">Total</TableCell>\r\n                              <TableCell align=\"center\">Tasa Respuesta</TableCell>\r\n                              <TableCell align=\"center\">Tiempo Promedio</TableCell>\r\n                            </TableRow>\r\n                          </TableHead>\r\n                          <TableBody>\r\n                            {comparisonData.categoryBreakdown.map((cat, index) => (\r\n                              <TableRow key={index}>\r\n                                <TableCell>{cat.category}</TableCell>\r\n                                <TableCell align=\"center\">{cat.total}</TableCell>\r\n                                <TableCell align=\"center\">{cat.responseRate}%</TableCell>\r\n                                <TableCell align=\"center\">{cat.avgResponseTime}h</TableCell>\r\n                              </TableRow>\r\n                            ))}\r\n                          </TableBody>\r\n                        </Table>\r\n                      </TableContainer>\r\n                    </CardContent>\r\n                  </Card>\r\n                </Grid>\r\n              </Grid>\r\n            </Box>\r\n          )}\r\n          \r\n          {/* Tab 3: Historial de Actividad */}\r\n          {activeTab === 2 && (\r\n            <Box>\r\n              <TableContainer component={Paper}>\r\n                <Table>\r\n                  <TableHead>\r\n                    <TableRow>\r\n                      <TableCell>Fecha</TableCell>\r\n                      <TableCell>Proveedor</TableCell>\r\n                      <TableCell>Categor√≠a</TableCell>\r\n                      <TableCell>Consulta Original</TableCell>\r\n                      <TableCell>Estado</TableCell>\r\n                      <TableCell>Tiempo de Respuesta</TableCell>\r\n                    </TableRow>\r\n                  </TableHead>\r\n                  <TableBody>\r\n                    {activities.length > 0 ? (\r\n                      activities.map((activity) => (\r\n                        <TableRow key={activity.id}>\r\n                          <TableCell>\r\n                            {format(new Date(activity.timestamp), 'dd MMM yyyy HH:mm', { locale: es })}\r\n                          </TableCell>\r\n                          <TableCell>{activity.providerName || 'N/A'}</TableCell>\r\n                          <TableCell>{activity.templateCategory || 'general'}</TableCell>\r\n                          <TableCell>\r\n                            {activity.searchQuery?.length > 30\r\n                              ? `${activity.searchQuery.substring(0, 30)}...`\r\n                              : activity.searchQuery}\r\n                          </TableCell>\r\n                          <TableCell>\r\n                            <Chip \r\n                              label={activity.responseReceived ? 'Respondido' : 'Pendiente'} \r\n                              color={activity.responseReceived ? 'success' : 'default'}\r\n                              size=\"small\"\r\n                            />\r\n                          </TableCell>\r\n                          <TableCell>\r\n                            {activity.responseTime \r\n                              ? `${activity.responseTime.toFixed(1)}h` \r\n                              : 'Pendiente'}\r\n                          </TableCell>\r\n                        </TableRow>\r\n                      ))\r\n                    ) : (\r\n                      <TableRow>\r\n                        <TableCell colSpan={6} align=\"center\">\r\n                          <Typography variant=\"body1\">\r\n                            No hay actividades registradas\r\n                          </Typography>\r\n                        </TableCell>\r\n                      </TableRow>\r\n                    )}\r\n                  </TableBody>\r\n                </Table>\r\n              </TableContainer>\r\n            </Box>\r\n          )}\r\n        </>\r\n      )}\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default AIEmailHistoryPanel;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\CalendarIntegration.jsx","messages":[{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":56,"column":36,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":56,"endColumn":37,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1962,1963],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1962,1962],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":56,"column":38,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":56,"endColumn":39,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1964,1965],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1964,1964],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":56,"column":51,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":56,"endColumn":52,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1977,1978],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1977,1977],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":56,"column":53,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":56,"endColumn":54,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1979,1980],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1979,1979],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Calendar, Clock, MapPin, User, X, Check, AlertCircle } from 'lucide-react';\r\nimport Button from '../Button';\r\nimport Card from '../Card';\r\n\r\n/**\r\n * Componente para extraer informaci√≥n de eventos y fechas desde emails y crear eventos en el calendario\r\n * \r\n * @param {Object} props - Propiedades del componente\r\n * @param {Object} props.email - Datos del email del cual extraer informaci√≥n\r\n * @param {Function} props.onClose - Funci√≥n para cerrar el modal\r\n * @param {Function} props.onSave - Funci√≥n llamada al guardar el evento\r\n * @returns {React.ReactElement} Formulario de integraci√≥n con calendario\r\n */\r\nconst CalendarIntegration = ({ email, onClose, onSave }) => {\r\n  const [eventData, setEventData] = useState({\r\n    title: '',\r\n    date: '',\r\n    time: '12:00',\r\n    location: '',\r\n    description: '',\r\n    attendees: [],\r\n    providerRelated: false,\r\n    providerId: null,\r\n  });\r\n  \r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const [extractedInfo, setExtractedInfo] = useState([]);\r\n  \r\n  useEffect(() => {\r\n    if (!email) {\r\n      setError('No hay email para analizar');\r\n      setLoading(false);\r\n      return;\r\n    }\r\n    \r\n    // Extraer posibles fechas, ubicaciones y personas del email\r\n    extractEventInfo(email);\r\n  }, [email]);\r\n  \r\n  /**\r\n   * Extrae informaci√≥n relevante para eventos del contenido del email\r\n   */\r\n  const extractEventInfo = (email) => {\r\n    setLoading(true);\r\n    \r\n    try {\r\n      // En un entorno real, aqu√≠ podr√≠amos usar alg√∫n servicio de NLP\r\n      // Por ahora, usamos una implementaci√≥n sencilla basada en expresiones regulares\r\n      \r\n      // T√≠tulo posible basado en asunto del email\r\n      const possibleTitle = email.subject ? email.subject.replace(/^Re: |^Fwd: /gi, '') : '';\r\n      \r\n      // Extraer posibles fechas (formato DD/MM/YYYY o similar)\r\n      const dateRegex = /(\\d{1,2})[\\/\\-](\\d{1,2})[\\/\\-](\\d{4})|(\\d{1,2}) de ([a-z√°-√∫√±]+)( de (\\d{4}))?/gi;\r\n      const dates = [];\r\n      let dateMatch;\r\n      const bodyText = email.body || '';\r\n      \r\n      while ((dateMatch = dateRegex.exec(bodyText)) !== null) {\r\n        // Convertir a formato de fecha ISO\r\n        let formattedDate = '';\r\n        if (dateMatch[1]) { // Formato num√©rico\r\n          formattedDate = `${dateMatch[3]}-${dateMatch[2].padStart(2, '0')}-${dateMatch[1].padStart(2, '0')}`;\r\n        } else { // Formato con mes en texto\r\n          const monthNames = {\r\n            'enero': '01', 'febrero': '02', 'marzo': '03', 'abril': '04',\r\n            'mayo': '05', 'junio': '06', 'julio': '07', 'agosto': '08',\r\n            'septiembre': '09', 'octubre': '10', 'noviembre': '11', 'diciembre': '12'\r\n          };\r\n          const month = monthNames[dateMatch[5].toLowerCase()];\r\n          const year = dateMatch[7] || new Date().getFullYear().toString();\r\n          formattedDate = `${year}-${month}-${dateMatch[4].padStart(2, '0')}`;\r\n        }\r\n        \r\n        dates.push({\r\n          type: 'date',\r\n          value: formattedDate,\r\n          original: dateMatch[0]\r\n        });\r\n      }\r\n      \r\n      // Extraer posibles horas (formato HH:MM o similar)\r\n      const timeRegex = /(\\d{1,2}):(\\d{2})( ?(?:AM|PM|a\\.m\\.|p\\.m\\.))?/gi;\r\n      const times = [];\r\n      let timeMatch;\r\n      \r\n      while ((timeMatch = timeRegex.exec(bodyText)) !== null) {\r\n        let hours = parseInt(timeMatch[1]);\r\n        const minutes = timeMatch[2];\r\n        const period = timeMatch[3]?.trim().toLowerCase();\r\n        \r\n        // Convertir a formato 24 horas si es necesario\r\n        if (period && (period === 'pm' || period === 'p.m.')) {\r\n          if (hours < 12) hours += 12;\r\n        } else if (period && (period === 'am' || period === 'a.m.') && hours === 12) {\r\n          hours = 0;\r\n        }\r\n        \r\n        const formattedTime = `${hours.toString().padStart(2, '0')}:${minutes}`;\r\n        \r\n        times.push({\r\n          type: 'time',\r\n          value: formattedTime,\r\n          original: timeMatch[0]\r\n        });\r\n      }\r\n      \r\n      // Extraer posibles ubicaciones\r\n      const locationKeywords = ['en', 'ubicado en', 'ubicada en', 'direcci√≥n', 'lugar', 'local', 'ubicaci√≥n'];\r\n      const locationRegex = new RegExp(`(${locationKeywords.join('|')})\\\\s+([^.,;:\\\\n]{5,50})`, 'gi');\r\n      const locations = [];\r\n      let locationMatch;\r\n      \r\n      while ((locationMatch = locationRegex.exec(bodyText)) !== null) {\r\n        locations.push({\r\n          type: 'location',\r\n          value: locationMatch[2].trim(),\r\n          original: locationMatch[0]\r\n        });\r\n      }\r\n      \r\n      // Extraer posibles personas/contactos\r\n      // Esto es simplificado, en un entorno real usar√≠amos NLP m√°s avanzado\r\n      const attendeeRegex = /([A-Za-z√Å-√ø√ë√±]{2,} [A-Za-z√Å-√ø√ë√±]{2,})/g;\r\n      const attendees = new Set();\r\n      let attendeeMatch;\r\n      \r\n      while ((attendeeMatch = attendeeRegex.exec(bodyText)) !== null) {\r\n        const name = attendeeMatch[1].trim();\r\n        // Filtrar nombres muy cortos o que parecen no ser nombres\r\n        if (name.length > 4 && !['para', 'este', 'esta', 'esos', 'esas', 'todos', 'todas'].includes(name.toLowerCase())) {\r\n          attendees.add(name);\r\n        }\r\n      }\r\n      \r\n      // Verificar si el email est√° relacionado con un proveedor\r\n      const isProviderRelated = email.to?.includes('proveedor') || \r\n                                email.from?.includes('proveedor') ||\r\n                                bodyText.toLowerCase().includes('proveedor') ||\r\n                                bodyText.toLowerCase().includes('servicio') ||\r\n                                bodyText.toLowerCase().includes('contrataci√≥n');\r\n      \r\n      // Compilar toda la informaci√≥n extra√≠da\r\n      const allExtracted = [\r\n        ...dates,\r\n        ...times,\r\n        ...locations,\r\n        ...[...attendees].map(name => ({ type: 'attendee', value: name, original: name }))\r\n      ];\r\n      \r\n      setExtractedInfo(allExtracted);\r\n      \r\n      // Preparar datos iniciales para el formulario con la informaci√≥n m√°s probable\r\n      setEventData({\r\n        title: possibleTitle,\r\n        date: dates.length > 0 ? dates[0].value : '',\r\n        time: times.length > 0 ? times[0].value : '12:00',\r\n        location: locations.length > 0 ? locations[0].value : '',\r\n        description: `Evento creado a partir del email: \"${email.subject || '(Sin asunto)'}\"`,\r\n        attendees: [...attendees],\r\n        providerRelated: isProviderRelated,\r\n        providerId: email.providerId || null\r\n      });\r\n      \r\n    } catch (err) {\r\n      console.error('Error al analizar email:', err);\r\n      setError('No se pudo analizar correctamente el contenido del email');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n  \r\n  const handleChange = (e) => {\r\n    const { name, value } = e.target;\r\n    setEventData(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n  };\r\n  \r\n  const handleAttendeeChange = (index, value) => {\r\n    const newAttendees = [...eventData.attendees];\r\n    newAttendees[index] = value;\r\n    \r\n    setEventData(prev => ({\r\n      ...prev,\r\n      attendees: newAttendees\r\n    }));\r\n  };\r\n  \r\n  const removeAttendee = (index) => {\r\n    setEventData(prev => ({\r\n      ...prev,\r\n      attendees: prev.attendees.filter((_, i) => i !== index)\r\n    }));\r\n  };\r\n  \r\n  const addAttendee = () => {\r\n    setEventData(prev => ({\r\n      ...prev,\r\n      attendees: [...prev.attendees, '']\r\n    }));\r\n  };\r\n  \r\n  const handleSubmit = () => {\r\n    // Validaci√≥n b√°sica\r\n    if (!eventData.title) {\r\n      setError('El t√≠tulo del evento es obligatorio');\r\n      return;\r\n    }\r\n    \r\n    if (!eventData.date) {\r\n      setError('Debes seleccionar una fecha para el evento');\r\n      return;\r\n    }\r\n    \r\n    // Formatear datos para guardar\r\n    const formattedEvent = {\r\n      ...eventData,\r\n      // Combinar fecha y hora en un solo campo ISO\r\n      dateTime: `${eventData.date}T${eventData.time}:00`,\r\n      // Filtrar asistentes vac√≠os\r\n      attendees: eventData.attendees.filter(a => a.trim())\r\n    };\r\n    \r\n    onSave(formattedEvent);\r\n    onClose();\r\n  };\r\n  \r\n  const applyExtracted = (item) => {\r\n    switch (item.type) {\r\n      case 'date':\r\n        setEventData(prev => ({ ...prev, date: item.value }));\r\n        break;\r\n      case 'time':\r\n        setEventData(prev => ({ ...prev, time: item.value }));\r\n        break;\r\n      case 'location':\r\n        setEventData(prev => ({ ...prev, location: item.value }));\r\n        break;\r\n      case 'attendee':\r\n        if (!eventData.attendees.includes(item.value)) {\r\n          setEventData(prev => ({ \r\n            ...prev, \r\n            attendees: [...prev.attendees, item.value] \r\n          }));\r\n        }\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  };\r\n  \r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 z-40 flex items-center justify-center p-4\">\r\n      <Card className=\"w-full max-w-3xl max-h-[90vh] flex flex-col\">\r\n        <div className=\"flex items-center justify-between border-b border-gray-200 p-4\">\r\n          <h2 className=\"text-xl font-bold flex items-center\">\r\n            <Calendar size={24} className=\"mr-2 text-blue-500\" />\r\n            A√±adir evento al calendario\r\n          </h2>\r\n          <Button\r\n            variant=\"ghost\"\r\n            size=\"sm\"\r\n            onClick={onClose}\r\n          >\r\n            <X size={20} />\r\n          </Button>\r\n        </div>\r\n        \r\n        <div className=\"p-4 overflow-y-auto flex-grow\">\r\n          {error && (\r\n            <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-md flex items-center text-red-700\">\r\n              <AlertCircle size={18} className=\"flex-shrink-0 mr-2\" />\r\n              <span>{error}</span>\r\n            </div>\r\n          )}\r\n          \r\n          {loading ? (\r\n            <div className=\"text-center py-8\">Analizando contenido del email...</div>\r\n          ) : (\r\n            <>\r\n              {extractedInfo.length > 0 && (\r\n                <div className=\"mb-4\">\r\n                  <h3 className=\"font-medium mb-2\">Informaci√≥n detectada en el email:</h3>\r\n                  <div className=\"flex flex-wrap gap-2\">\r\n                    {extractedInfo.map((item, index) => (\r\n                      <span\r\n                        key={index}\r\n                        className=\"inline-flex items-center px-2.5 py-1 rounded-md text-sm bg-blue-50 border border-blue-200 cursor-pointer hover:bg-blue-100\"\r\n                        onClick={() => applyExtracted(item)}\r\n                        title={`Usar ${item.type === 'date' ? 'esta fecha' : \r\n                                 item.type === 'time' ? 'esta hora' : \r\n                                 item.type === 'location' ? 'esta ubicaci√≥n' : \r\n                                 'este asistente'}`}\r\n                      >\r\n                        {item.type === 'date' && <Calendar size={14} className=\"mr-1 text-blue-600\" />}\r\n                        {item.type === 'time' && <Clock size={14} className=\"mr-1 text-blue-600\" />}\r\n                        {item.type === 'location' && <MapPin size={14} className=\"mr-1 text-blue-600\" />}\r\n                        {item.type === 'attendee' && <User size={14} className=\"mr-1 text-blue-600\" />}\r\n                        {item.original}\r\n                      </span>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n              \r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">T√≠tulo del evento:</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    name=\"title\"\r\n                    value={eventData.title}\r\n                    onChange={handleChange}\r\n                    className=\"w-full border border-gray-300 rounded-md p-2\"\r\n                    placeholder=\"T√≠tulo del evento\"\r\n                  />\r\n                </div>\r\n                \r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Fecha:</label>\r\n                    <input\r\n                      type=\"date\"\r\n                      name=\"date\"\r\n                      value={eventData.date}\r\n                      onChange={handleChange}\r\n                      className=\"w-full border border-gray-300 rounded-md p-2\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">Hora:</label>\r\n                    <input\r\n                      type=\"time\"\r\n                      name=\"time\"\r\n                      value={eventData.time}\r\n                      onChange={handleChange}\r\n                      className=\"w-full border border-gray-300 rounded-md p-2\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n                \r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">Ubicaci√≥n:</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    name=\"location\"\r\n                    value={eventData.location}\r\n                    onChange={handleChange}\r\n                    className=\"w-full border border-gray-300 rounded-md p-2\"\r\n                    placeholder=\"Ubicaci√≥n del evento\"\r\n                  />\r\n                </div>\r\n                \r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">Descripci√≥n:</label>\r\n                  <textarea\r\n                    name=\"description\"\r\n                    value={eventData.description}\r\n                    onChange={handleChange}\r\n                    className=\"w-full border border-gray-300 rounded-md p-2\"\r\n                    rows=\"3\"\r\n                    placeholder=\"Descripci√≥n del evento\"\r\n                  ></textarea>\r\n                </div>\r\n                \r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">Asistentes:</label>\r\n                  \r\n                  {eventData.attendees.map((attendee, index) => (\r\n                    <div key={index} className=\"flex mb-2\">\r\n                      <input\r\n                        type=\"text\"\r\n                        value={attendee}\r\n                        onChange={(e) => handleAttendeeChange(index, e.target.value)}\r\n                        className=\"flex-grow border border-gray-300 rounded-md p-2\"\r\n                        placeholder=\"Nombre del asistente\"\r\n                      />\r\n                      <Button\r\n                        variant=\"ghost\"\r\n                        size=\"sm\"\r\n                        onClick={() => removeAttendee(index)}\r\n                        className=\"ml-2\"\r\n                      >\r\n                        <X size={18} />\r\n                      </Button>\r\n                    </div>\r\n                  ))}\r\n                  \r\n                  <Button\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    onClick={addAttendee}\r\n                    className=\"mt-1\"\r\n                  >\r\n                    A√±adir asistente\r\n                  </Button>\r\n                </div>\r\n                \r\n                <div className=\"flex items-center\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    id=\"providerRelated\"\r\n                    name=\"providerRelated\"\r\n                    checked={eventData.providerRelated}\r\n                    onChange={(e) => setEventData(prev => ({\r\n                      ...prev,\r\n                      providerRelated: e.target.checked\r\n                    }))}\r\n                    className=\"mr-2\"\r\n                  />\r\n                  <label htmlFor=\"providerRelated\" className=\"text-sm text-gray-700\">\r\n                    Este evento est√° relacionado con un proveedor\r\n                  </label>\r\n                </div>\r\n              </div>\r\n            </>\r\n          )}\r\n        </div>\r\n        \r\n        <div className=\"border-t border-gray-200 p-4 flex justify-end\">\r\n          <div className=\"flex space-x-3\">\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={onClose}\r\n              disabled={loading}\r\n            >\r\n              Cancelar\r\n            </Button>\r\n            <Button\r\n              onClick={handleSubmit}\r\n              disabled={loading}\r\n              className=\"flex items-center\"\r\n            >\r\n              <Check size={18} className=\"mr-1\" />\r\n              Guardar evento\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </Card>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CalendarIntegration;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\ComposeEmail.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'ensureNotPromise' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":38},{"ruleId":"no-unused-vars","severity":1,"message":"'safeMap' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":47},{"ruleId":"no-unused-vars","severity":1,"message":"'profile' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":20,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { useNavigate, useParams } from 'react-router-dom';\r\nimport { AlertCircle, Paperclip } from 'lucide-react';\r\nimport Button from '../Button';\r\nimport Card from '../Card';\r\nimport * as EmailService from '../../services/emailService';\r\nimport { useAuth } from '../../hooks/useAuthUnified';\r\nimport { safeRender, ensureNotPromise, safeMap } from '../../utils/promiseSafeRenderer';\r\n\r\n/**\r\n * P√°gina de composici√≥n de correo electr√≥nico pensada para las rutas\r\n * /compose y /compose/:action/:id usadas en los tests E2E.\r\n * Incluye los placeholders exactos ('Para:' y 'Asunto:') y el elemento\r\n * con data-testid=\"email-body-editor\" que esperan los tests.\r\n */\r\nconst ComposeEmail = () => {\r\n  const [sentSuccess, setSentSuccess] = useState(false);\r\n  const navigate = useNavigate();\r\n  const { action, id } = useParams();\r\n  const { profile } = useAuth();\r\n\r\n  // Estado del formulario\r\n  const [to, setTo] = useState('');\r\n  const [subject, setSubject] = useState('');\r\n  const [body, setBody] = useState('');\r\n  const [attachments, setAttachments] = useState([]);\r\n  const [sending, setSending] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  // Cargar borrador u otra acci√≥n si fuese necesario (placeholder para el futuro)\r\n  React.useEffect(() => {\r\n    /* Aqu√≠ podr√≠amos cargar un borrador si action === 'edit' y id existe. */\r\n  }, [action, id]);\r\n\r\n  const handleFileUpload = (e) => {\r\n    const files = Array.from(e.target.files);\r\n    if (files.length === 0) return;\r\n\r\n    // Validar tama√±o m√°ximo 10MB cada archivo\r\n    const invalid = files.filter((f) => f.size > 10 * 1024 * 1024);\r\n    if (invalid.length > 0) {\r\n      setError('Algunos archivos exceden el tama√±o m√°ximo de 10MB');\r\n      return;\r\n    }\r\n\r\n    setAttachments((prev) => [...prev, ...files]);\r\n    e.target.value = '';\r\n  };\r\n\r\n  const validate = () => {\r\n    if (!to) {\r\n      setError('Debes especificar un destinatario');\r\n      return false;\r\n    }\r\n    if (!subject) {\r\n      setError('Por favor, a√±ade un asunto al email');\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  const handleSend = async () => {\r\n    setError('');\r\n    if (!validate()) return;\r\n\r\n    setSending(true);\r\n    try {\r\n      await EmailService.sendMail({ to, subject, body, attachments });\r\n      // Mostrar mensaje de √©xito\r\n      setSentSuccess(true);\r\n      // Redirigir tras breve demora\r\n      setTimeout(() => navigate('/'), 500);\r\n    } catch (err) {\r\n      console.error(err);\r\n      setError(`Error al enviar correo: ${err.message}`);\r\n    } finally {\r\n      setSending(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-4 max-w-4xl mx-auto\">\r\n      <Card className=\"flex flex-col\">\r\n        <div className=\"border-b border-gray-200 p-4 flex items-center justify-between\">\r\n          <h2 className=\"text-xl font-bold\">Nuevo correo</h2>\r\n        </div>\r\n        <div className=\"p-4 space-y-4\">\r\n          {safeRender(error, '') && (\r\n            <div className=\"flex items-center text-red-700 bg-red-50 border border-red-200 p-3 rounded-md\">\r\n              <AlertCircle size={18} className=\"mr-2\" />\r\n              <span>{safeRender(error, '')}</span>\r\n            </div>\r\n          )}\r\n\r\n          {/* Campo Para */}\r\n          <div>\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Para:\"\r\n              value={to}\r\n              onChange={(e) => setTo(e.target.value)}\r\n              className=\"w-full border border-gray-300 rounded-md p-2\"\r\n              disabled={sending}\r\n              data-testid=\"recipient-input\"\r\n            />\r\n          </div>\r\n\r\n          {/* Campo Asunto */}\r\n          <div>\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Asunto:\"\r\n              value={subject}\r\n              onChange={(e) => setSubject(e.target.value)}\r\n              className=\"w-full border border-gray-300 rounded-md p-2\"\r\n              disabled={sending}\r\n              data-testid=\"subject-input\"\r\n            />\r\n          </div>\r\n\r\n          {/* Editor de cuerpo */}\r\n          <div>\r\n            <div\r\n              data-testid=\"email-body-editor\"\r\n              contentEditable\r\n              className=\"w-full min-h-[120px] border border-gray-300 rounded-md p-2 focus:outline-none\"\r\n              onInput={(e) => setBody(e.currentTarget.innerHTML)}\r\n              suppressContentEditableWarning\r\n            />\r\n          </div>\r\n\r\n          {/* Adjuntos */}\r\n          <div>\r\n            <label className=\"cursor-pointer inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm bg-white hover:bg-gray-50\" aria-label=\"Adjuntar archivo\">\r\n              <Paperclip size={16} className=\"mr-1\" /> Adjuntar archivo\r\n              <input type=\"file\" className=\"hidden\" multiple onChange={handleFileUpload} />\r\n            </label>\r\n            {attachments.length > 0 && (\r\n              <ul className=\"mt-2 list-disc list-inside text-sm text-gray-700\">\r\n                {attachments.map((file, idx) => (\r\n                  <li key={idx}>{file.name}</li>\r\n                ))}\r\n              </ul>\r\n            )}\r\n          </div>\r\n        </div>\r\n        <div className=\"border-t border-gray-200 p-4 flex justify-end\">\r\n          <Button onClick={handleSend} disabled={sending} data-testid=\"send-button\">\r\n            {sending ? 'Enviando...' : 'Enviar'}\r\n          </Button>\r\n        </div>\r\n      {sentSuccess && (\r\n          <div data-testid=\"success-message\" className=\"text-green-700 bg-green-50 border border-green-200 p-2 rounded-md mt-2\">\r\n            Correo enviado correctamente\r\n          </div>\r\n        )}\r\n      </Card>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ComposeEmail;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\ComposeEmailModal.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'ensureNotPromise' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":38},{"ruleId":"no-unused-vars","severity":1,"message":"'safeMap' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":47}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { X, Paperclip, Send } from 'lucide-react';\r\nimport Button from '../Button';\r\nimport * as EmailService from '../../services/emailService';\r\nimport { safeRender, ensureNotPromise, safeMap } from '../../utils/promiseSafeRenderer';\r\n\r\n/**\r\n * Modal para componer y enviar un nuevo correo electr√≥nico\r\n * \r\n * @param {Object} props - Propiedades del componente\r\n * @param {boolean} props.isOpen - Indica si el modal est√° abierto\r\n * @param {Function} props.onClose - Funci√≥n para cerrar el modal\r\n * @param {string} props.userEmail - Email del usuario remitente\r\n * @param {Object} [props.replyTo] - Email al que se est√° respondiendo (opcional)\r\n */\r\nconst ComposeEmailModal = ({ isOpen, onClose, userEmail, replyTo }) => {\r\n  const [to, setTo] = useState('');\r\n  const [subject, setSubject] = useState('');\r\n  const [body, setBody] = useState('');\r\n  const [attachments, setAttachments] = useState([]);\r\n  const [sending, setSending] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [success, setSuccess] = useState(false);\r\n  \r\n  // Preparar datos si es una respuesta\r\n  useEffect(() => {\r\n    if (replyTo) {\r\n      // Extraer direcci√≥n de correo del remitente original\r\n      const originalSender = replyTo.from;\r\n      const originalSubject = replyTo.subject || '';\r\n      \r\n      setTo(originalSender);\r\n      setSubject(originalSubject.startsWith('Re:') ? originalSubject : `Re: ${originalSubject}`);\r\n      \r\n      // Crear cita del mensaje original\r\n      const quoteDate = new Date(replyTo.date).toLocaleString('es-ES');\r\n      const quoteHeader = `El ${quoteDate}, ${originalSender} escribi√≥:`;\r\n      const quoteBody = replyTo.body\r\n        ? replyTo.body.replace(/\\n/g, '\\n> ')\r\n        : '';\r\n      \r\n      setBody(`\\n\\n\\n${quoteHeader}\\n> ${quoteBody}`);\r\n    }\r\n  }, [replyTo]);\r\n  \r\n  // Manejar env√≠o del correo\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    \r\n    if (!to) {\r\n      setError('Debes especificar un destinatario');\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      setSending(true);\r\n      setError('');\r\n      \r\n      await EmailService.sendMail({ \r\n        to, \r\n        subject, \r\n        body, \r\n        attachments \r\n      });\r\n      \r\n      setSuccess(true);\r\n      \r\n      // Cerrar el modal despu√©s de 1.5 segundos\r\n      setTimeout(() => {\r\n        onClose();\r\n        // Reset form\r\n        setTo('');\r\n        setSubject('');\r\n        setBody('');\r\n        setAttachments([]);\r\n        setSuccess(false);\r\n      }, 1500);\r\n    } catch (error) {\r\n      console.error('Error al enviar correo:', error);\r\n      setError(`Error al enviar el correo: ${error.message}`);\r\n    } finally {\r\n      setSending(false);\r\n    }\r\n  };\r\n  \r\n  // Manejar archivos adjuntos\r\n  const handleAttachment = (e) => {\r\n    const files = Array.from(e.target.files);\r\n    \r\n    if (files.length === 0) return;\r\n    \r\n    // Limitar tama√±o total a 10MB\r\n    const totalSize = [...attachments, ...files].reduce((acc, file) => acc + (file.size || 0), 0);\r\n    if (totalSize > 10 * 1024 * 1024) {\r\n      setError('El tama√±o total de los adjuntos no debe superar los 10MB');\r\n      return;\r\n    }\r\n    \r\n    // A√±adir nuevos archivos al estado\r\n    const newAttachments = files.map(file => ({\r\n      file,\r\n      filename: file.name,\r\n      size: file.size,\r\n      type: file.type\r\n    }));\r\n    \r\n    setAttachments([...attachments, ...newAttachments]);\r\n    \r\n    // Limpiar input de archivos\r\n    e.target.value = '';\r\n  };\r\n  \r\n  // Eliminar un archivo adjunto\r\n  const removeAttachment = (index) => {\r\n    setAttachments(attachments.filter((_, i) => i !== index));\r\n  };\r\n  \r\n  if (!isOpen) return null;\r\n  \r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4\">\r\n      <div className=\"bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] flex flex-col\">\r\n        {/* Cabecera */}\r\n        <div className=\"flex justify-between items-center p-4 border-b\">\r\n          <h2 className=\"text-xl font-semibold\">\r\n            {replyTo ? 'Responder' : 'Nuevo mensaje'}\r\n          </h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-gray-500 hover:text-gray-700\"\r\n            aria-label=\"Cerrar\"\r\n          >\r\n            <X size={24} />\r\n          </button>\r\n        </div>\r\n        \r\n        {/* Formulario */}\r\n        <form onSubmit={handleSubmit} className=\"flex flex-col flex-grow\">\r\n          <div className=\"p-4 space-y-4 flex-grow overflow-y-auto\">\r\n            {/* Campos del formulario */}\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">De:</label>\r\n              <input\r\n                type=\"text\"\r\n                value={userEmail}\r\n                disabled\r\n                className=\"w-full p-2 border rounded-md bg-gray-50\"\r\n              />\r\n            </div>\r\n            \r\n            <div>\r\n              <label htmlFor=\"to-input\" className=\"block text-sm font-medium text-gray-700 mb-1\">Destinatario:</label>\r\n              <input\r\n                id=\"to-input\"\r\n                aria-label=\"Destinatario\"\r\n                type=\"email\"\r\n                value={to}\r\n                onChange={(e) => setTo(e.target.value)}\r\n                placeholder=\"destinatario@ejemplo.com\"\r\n                className=\"w-full p-2 border rounded-md\"\r\n                required\r\n              />\r\n            </div>\r\n            \r\n            <div>\r\n              <label htmlFor=\"subject-input\" className=\"block text-sm font-medium text-gray-700 mb-1\">Asunto:</label>\r\n              <input\r\n                id=\"subject-input\"\r\n                aria-label=\"Asunto\"\r\n                type=\"text\"\r\n                value={subject}\r\n                onChange={(e) => setSubject(e.target.value)}\r\n                placeholder=\"Asunto del mensaje\"\r\n                className=\"w-full p-2 border rounded-md\"\r\n              />\r\n            </div>\r\n            \r\n            <div className=\"flex-grow\">\r\n              <label htmlFor=\"body-input\" className=\"block text-sm font-medium text-gray-700 mb-1\">Mensaje:</label>\r\n              <textarea\r\n                id=\"body-input\"\r\n                aria-label=\"Mensaje\"\r\n                value={body}\r\n                onChange={(e) => setBody(e.target.value)}\r\n                placeholder=\"Escribe tu mensaje aqu√≠...\"\r\n                className=\"w-full p-2 border rounded-md min-h-[200px]\"\r\n                rows={10}\r\n              />\r\n            </div>\r\n            \r\n            {/* Archivos adjuntos */}\r\n            {attachments.length > 0 && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  Archivos adjuntos:\r\n                </label>\r\n                <div className=\"space-y-2\">\r\n                  {attachments.map((file, index) => (\r\n                    <div key={index} className=\"flex items-center justify-between p-2 bg-gray-50 rounded-md\">\r\n                      <div className=\"flex items-center\">\r\n                        <Paperclip size={16} className=\"mr-2 text-gray-500\" />\r\n                        <div>\r\n                          <p className=\"text-sm font-medium\">{file.filename}</p>\r\n                          <p className=\"text-xs text-gray-500\">\r\n                            {Math.round(file.size / 1024)} KB\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => removeAttachment(index)}\r\n                        className=\"text-gray-500 hover:text-red-500\"\r\n                      >\r\n                        <X size={16} />\r\n                      </button>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {/* Mensajes de error o √©xito */}\r\n            {safeRender(error, '') && (\r\n              <div className=\"p-3 bg-red-50 border border-red-200 text-red-700 rounded-md\">\r\n                {safeRender(error, '')}\r\n              </div>\r\n            )}\r\n            \r\n            {safeRender(success, false) && (\r\n              <div className=\"p-3 bg-green-50 border border-green-200 text-green-700 rounded-md\">\r\n                ¬°Mensaje enviado con √©xito!\r\n              </div>\r\n            )}\r\n          </div>\r\n          \r\n          {/* Barra inferior con acciones */}\r\n          <div className=\"border-t p-4 bg-gray-50 flex justify-between\">\r\n            <div>\r\n              <label htmlFor=\"file-upload\" className=\"cursor-pointer\">\r\n                <Button \r\n                  type=\"button\"\r\n                  variant=\"outline\" \r\n                  className=\"flex items-center\"\r\n                >\r\n                  <Paperclip size={16} className=\"mr-2\" /> Adjuntar archivo\r\n                </Button>\r\n                <input\r\n                  id=\"file-upload\"\r\n                  type=\"file\"\r\n                  multiple\r\n                  onChange={handleAttachment}\r\n                  className=\"hidden\"\r\n                />\r\n              </label>\r\n            </div>\r\n            \r\n            <Button\r\n              type=\"submit\"\r\n              variant=\"default\"\r\n              className=\"flex items-center\"\r\n              disabled={sending || !to}\r\n            >\r\n              {sending ? (\r\n                <>\r\n                  <span className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></span>\r\n                  Enviando...\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <Send size={16} className=\"mr-2\" /> Enviar\r\n                </>\r\n              )}\r\n            </Button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ComposeEmailModal;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\CustomFolders.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\EmailComments.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\EmailComposer.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Send' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":28},{"ruleId":"no-unused-vars","severity":1,"message":"'Plus' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":47},{"ruleId":"no-unused-vars","severity":1,"message":"'Trash2' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":49,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":55},{"ruleId":"no-unused-vars","severity":1,"message":"'safeExecute' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'ensureNotPromise' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":38},{"ruleId":"no-unused-vars","severity":1,"message":"'safeDangerouslySetInnerHTML' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":67}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { X, Paperclip, Send, AlertCircle, Plus, Trash2, CheckCircle, ChevronDown } from 'lucide-react';\r\nimport Button from '../Button';\r\nimport Card from '../Card';\r\nimport * as EmailService from '../../services/emailService';\r\nimport { setAuthContext } from '../../services/emailService';\r\nimport { safeExecute } from '../SafeRenderer';\r\nimport { safeRender, ensureNotPromise, safeDangerouslySetInnerHTML } from '../../utils/promiseSafeRenderer';\r\nimport { useAuth } from '../../hooks/useAuth';\r\n\r\n/**\r\n * Componente para redactar y enviar nuevos emails desde la direcci√≥n personalizada del usuario\r\n * \r\n * @param {Object} props - Propiedades del componente\r\n * @param {boolean} props.isOpen - Controla si el compositor est√° abierto\r\n * @param {Function} props.onClose - Funci√≥n para cerrar el compositor\r\n * @param {Object} props.initialValues - Valores iniciales (para respuestas o reenv√≠os)\r\n * @param {Function} props.onSend - Callback ejecutado despu√©s de enviar el email\r\n * @returns {React.ReactElement} Componente para redactar emails\r\n */\r\nconst EmailComposer = ({ isOpen, onClose, initialValues = {}, onSend }) => {\r\n  const authContext = useAuth();\r\n  const { userProfile } = authContext;\r\n  \r\n  // Establecer el contexto de autenticaci√≥n en EmailService\r\n  useEffect(() => {\r\n    setAuthContext(authContext);\r\n  }, [authContext]);\r\n  const [to, setTo] = useState(initialValues.to || '');\r\n  const [cc, setCc] = useState(initialValues.cc || '');\r\n  const [subject, setSubject] = useState(initialValues.subject || '');\r\n  const [body, setBody] = useState(initialValues.body || '');\r\n  const [attachments, setAttachments] = useState([]);\r\n  const [showCc, setShowCc] = useState(!!initialValues.cc);\r\n  const [sending, setSending] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [success, setSuccess] = useState('');\r\n  const [userEmail, setUserEmail] = useState('');\r\n  const [templates, setTemplates] = useState([]);\r\n  const [selectedTemplate, setSelectedTemplate] = useState(null);\r\n  \r\n  // Inicializar el email del usuario\r\n  useEffect(() => {\r\n    const initializeEmail = async () => {\r\n      if (userProfile) {\r\n        const email = await EmailService.initEmailService(userProfile);\r\n        setUserEmail(email);\r\n      }\r\n    };\r\n\r\n    initializeEmail();\r\n    \r\n    // Cargar plantillas disponibles\r\n    const loadTemplates = async () => {\r\n      try {\r\n        const availableTemplates = await EmailService.getEmailTemplates();\r\n        setTemplates(availableTemplates || []);\r\n      } catch (err) {\r\n        console.error('Error al cargar plantillas:', err);\r\n      }\r\n    };\r\n    \r\n    loadTemplates();\r\n  }, [userProfile]);\r\n  \r\n  // Aplicar plantilla seleccionada\r\n  const applyTemplate = (template) => {\r\n    if (!template) return;\r\n    \r\n    setSubject(template.subject || subject);\r\n    setBody(template.body || body);\r\n    setSelectedTemplate(template);\r\n  };\r\n  \r\n  // Manejar subida de archivos adjuntos\r\n  const handleFileUpload = (event) => {\r\n    const files = Array.from(event.target.files);\r\n    \r\n    // Validar tama√±o (m√°ximo 10MB por archivo)\r\n    const invalidFiles = files.filter(file => file.size > 10 * 1024 * 1024);\r\n    if (invalidFiles.length > 0) {\r\n      setError(`Algunos archivos exceden el tama√±o m√°ximo de 10MB: ${invalidFiles.map(f => f.name).join(', ')}`);\r\n      return;\r\n    }\r\n    \r\n    // A√±adir archivos a la lista de adjuntos\r\n    setAttachments(prev => [...prev, ...files.map(file => ({\r\n      file,\r\n      name: file.name,\r\n      size: file.size,\r\n      type: file.type\r\n    }))]);\r\n    \r\n    // Limpiar input para permitir seleccionar el mismo archivo de nuevo\r\n    if (event.target) {\r\n      // Reiniciar el valor para permitir volver a seleccionar el mismo archivo\r\n      event.target.value = '';\r\n    }\r\n  };\r\n  \r\n  // Eliminar un adjunto\r\n  const removeAttachment = (index) => {\r\n    setAttachments(prev => prev.filter((_, i) => i !== index));\r\n  };\r\n  \r\n  // Validar email antes de enviar\r\n  const validateEmail = () => {\r\n    if (!to) {\r\n      setError('Debes especificar al menos un destinatario');\r\n      return false;\r\n    }\r\n    \r\n    if (!subject) {\r\n      setError('Por favor, a√±ade un asunto al email');\r\n      return false;\r\n    }\r\n    \r\n    if (!body || body.trim().length === 0) {\r\n      setError('El mensaje no puede estar vac√≠o');\r\n      return false;\r\n    }\r\n    \r\n    // Validar formato de email (expresi√≥n regular b√°sica)\r\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n    const toEmails = to.split(',').map(email => email.trim());\r\n    const invalidEmails = toEmails.filter(email => !emailRegex.test(email));\r\n    \r\n    if (invalidEmails.length > 0) {\r\n      setError(`Algunas direcciones de email no son v√°lidas: ${invalidEmails.join(', ')}`);\r\n      return false;\r\n    }\r\n    \r\n    if (cc) {\r\n      const ccEmails = cc.split(',').map(email => email.trim());\r\n      const invalidCcEmails = ccEmails.filter(email => !emailRegex.test(email));\r\n      \r\n      if (invalidCcEmails.length > 0) {\r\n        setError(`Algunas direcciones CC no son v√°lidas: ${invalidCcEmails.join(', ')}`);\r\n        return false;\r\n      }\r\n    }\r\n    \r\n    return true;\r\n  };\r\n  \r\n  // Enviar el email\r\n  const handleSend = async () => {\r\n    // Prevenir env√≠o duplicado\r\n    if (sending) {\r\n      console.log('Env√≠o ya en progreso, ignorando...');\r\n      return;\r\n    }\r\n    \r\n    setError('');\r\n    setSuccess('');\r\n    \r\n    if (!validateEmail()) {\r\n      return;\r\n    }\r\n    \r\n    // Verificar si el usuario tiene configurada direcci√≥n personalizada\r\n    if (userProfile && !userProfile.emailUsername && !userProfile.myWed360Email && !userProfile.emailAlias) {\r\n      if (window.confirm('No tienes configurada una direcci√≥n de correo personalizada. ¬øDeseas configurarla ahora?')) {\r\n        window.location.href = '/email/setup';\r\n        return;\r\n      }\r\n    }\r\n    \r\n    setSending(true);\r\n    \r\n    try {\r\n      const result = await EmailService.sendEmail({\r\n        to,\r\n        cc,\r\n        subject,\r\n        body,\r\n        attachments\r\n      });\r\n      \r\n      if (result && (result.success || result.id)) {\r\n        setSuccess('Email enviado correctamente');\r\n        \r\n        if (onSend) {\r\n          onSend(result);\r\n        }\r\n        \r\n        // Esperar un momento para mostrar el mensaje de √©xito antes de cerrar\r\n        setTimeout(() => {\r\n          if (typeof onClose === 'function') {\r\n            onClose();\r\n          }\r\n          resetForm();\r\n        }, 1500);\r\n      } else {\r\n        throw new Error('Error al enviar el email');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error al enviar email:', err);\r\n      setError(`Error al enviar: ${err.message}`);\r\n    } finally {\r\n      setSending(false);\r\n    }\r\n  };\r\n  \r\n  // Resetear formulario\r\n  const resetForm = () => {\r\n    setTo('');\r\n    setCc('');\r\n    setSubject('');\r\n    setBody('');\r\n    setAttachments([]);\r\n    setShowCc(false);\r\n    setError('');\r\n    setSelectedTemplate(null);\r\n  };\r\n  \r\n  // Cerrar y resetear\r\n  const handleClose = () => {\r\n    if (typeof onClose === 'function') {\r\n      onClose();\r\n    }\r\n    resetForm();\r\n  };\r\n  \r\n  // Si isOpen no se pasa, asumimos que debe mostrarse\r\n  if (isOpen === false) return null;\r\n  \r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 z-40 flex items-center justify-center p-4\">\r\n      <Card className=\"w-full max-w-4xl max-h-[90vh] flex flex-col\" data-testid=\"email-composer\">\r\n        <div className=\"flex items-center justify-between border-b border-gray-200 p-4\">\r\n          <h2 className=\"text-xl font-bold\">Nuevo mensaje</h2>\r\n          <Button\r\n            variant=\"ghost\"\r\n            size=\"sm\"\r\n            onClick={handleClose}\r\n            aria-label=\"Cerrar\"\r\n          >\r\n            <X size={20} />\r\n          </Button>\r\n        </div>\r\n        \r\n        <div className=\"p-4 overflow-y-auto flex-grow\">\r\n          {safeRender(error) && (\r\n            <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-md flex items-center text-red-700\" data-testid=\"error-message\">\r\n              <AlertCircle size={18} className=\"flex-shrink-0 mr-2\" />\r\n              <span>{safeRender(error, '')}</span>\r\n            </div>\r\n          )}\r\n          \r\n          {safeRender(success) && (\r\n            <div className=\"mb-4 p-3 bg-green-50 border border-green-200 rounded-md flex items-center text-green-700\" data-testid=\"success-message\">\r\n              <CheckCircle size={18} className=\"flex-shrink-0 mr-2\" />\r\n              <span>{safeRender(success, '')}</span>\r\n            </div>\r\n          )}\r\n          \r\n          <div className=\"mb-2\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">De:</label>\r\n              {templates.length > 0 && (\r\n                <div className=\"relative\">\r\n                  <select \r\n                    value={selectedTemplate ? templates.indexOf(selectedTemplate) : \"\"}\r\n                    onChange={(e) => {\r\n                      const index = parseInt(e.target.value);\r\n                      applyTemplate(templates[index]);\r\n                    }}\r\n                    className=\"text-sm border border-gray-300 rounded-md py-1 pl-2 pr-8\"\r\n                  >\r\n                    <option value=\"\">Plantillas</option>\r\n                    {templates.map((template, index) => (\r\n                      <option key={index} value={index}>{template.name}</option>\r\n                    ))}\r\n                  </select>\r\n                  <ChevronDown size={16} className=\"absolute right-2 top-2 pointer-events-none text-gray-500\" />\r\n                </div>\r\n              )}\r\n            </div>\r\n            <div className=\"border border-gray-300 rounded-md p-2 bg-gray-50 flex justify-between\">\r\n              <span className=\"text-gray-800\">\r\n                {userEmail || 'cargando...'}\r\n              </span>\r\n              {userEmail && userEmail.includes('@mywed360') ? (\r\n                <span className=\"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full\">\r\n                  myWed360\r\n                </span>\r\n              ) : userProfile && !userProfile.emailUsername ? (\r\n                <a \r\n                  href=\"/email/setup\" \r\n                  className=\"text-xs bg-amber-100 text-amber-800 px-2 py-0.5 rounded-full hover:bg-amber-200 transition-colors\"\r\n                >\r\n                  Configurar correo\r\n                </a>\r\n              ) : null}\r\n            </div>\r\n          </div>\r\n\r\n        <div className=\"mb-2\">\r\n          <label htmlFor=\"to-input\" className=\"block text-sm font-medium text-gray-700 mb-1\">Para:</label>\r\n          <input\r\n            id=\"to-input\"\r\n            aria-label=\"Para Destinatario\"\r\n            type=\"text\"\r\n            value={to}\r\n            onChange={(e) => setTo(e.target.value)}\r\n            className=\"w-full border border-gray-300 rounded-md p-2\"\r\n            placeholder=\"Destinatarios (email@ejemplo.com, email2@ejemplo.com)\"\r\n            disabled={sending}\r\n            data-testid=\"recipient-input\"\r\n          />\r\n        </div>\r\n\r\n        {showCc && (\r\n          <div className=\"mb-2\">\r\n            <label htmlFor=\"cc-input\" className=\"block text-sm font-medium text-gray-700 mb-1\">CC:</label>\r\n            <input\r\n              id=\"cc-input\"\r\n              aria-label=\"CC\"\r\n              type=\"text\"\r\n              value={cc}\r\n              onChange={(e) => setCc(e.target.value)}\r\n              className=\"w-full border border-gray-300 rounded-md p-2\"\r\n              placeholder=\"CC (email@ejemplo.com, email2@ejemplo.com)\"\r\n              disabled={sending}\r\n            />\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"mb-2 flex justify-end\">\r\n          {!showCc && (\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => setShowCc(true)}\r\n              className=\"text-sm text-blue-600 hover:text-blue-800\"\r\n            >\r\n              A√±adir CC\r\n            </button>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"mb-4\">\r\n          <label htmlFor=\"subject-input\" className=\"block text-sm font-medium text-gray-700 mb-1\">Asunto:</label>\r\n          <input\r\n            id=\"subject-input\"\r\n            aria-label=\"Asunto\"\r\n            type=\"text\"\r\n            value={subject}\r\n            onChange={(e) => setSubject(e.target.value)}\r\n            className=\"w-full border border-gray-300 rounded-md p-2\"\r\n            placeholder=\"Asunto del email\"\r\n            disabled={sending}\r\n            data-testid=\"subject-input\"\r\n          />\r\n        </div>\r\n\r\n        <div className=\"mb-4\">\r\n          <label htmlFor=\"body-input\" className=\"block text-sm font-medium text-gray-700 mb-1\">Mensaje:</label>\r\n          <textarea\r\n            id=\"body-input\"\r\n            aria-label=\"Mensaje\"\r\n            value={body}\r\n            onChange={(e) => setBody(e.target.value)}\r\n            className=\"w-full border border-gray-300 rounded-md p-2\"\r\n            rows=\"12\"\r\n            placeholder=\"Escribe tu mensaje aqu√≠...\"\r\n            disabled={sending}\r\n            data-testid=\"body-editor\"\r\n          />\r\n        </div>\r\n\r\n        {/* Secci√≥n de adjuntos */}\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Adjuntos:</label>\r\n\r\n          <div className=\"mb-2\">\r\n            <label className=\"cursor-pointer inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50\">\r\n              <Paperclip size={18} className=\"mr-2\" />\r\n              Adjuntar archivo\r\n              <input\r\n                type=\"file\"\r\n                aria-label=\"Adjuntar archivo\"\r\n                className=\"hidden\"\r\n                multiple\r\n                onChange={handleFileUpload}\r\n                disabled={sending}\r\n              />\r\n            </label>\r\n            <span className=\"ml-2 text-xs text-gray-500\">M√°ximo 10MB por archivo</span>\r\n          </div>\r\n          \r\n          {attachments.length > 0 && (\r\n              <div className=\"border border-gray-200 rounded-md p-2\">\r\n                <p className=\"text-xs text-gray-500 mb-2\">\r\n                  {attachments.length} {attachments.length === 1 ? 'archivo adjunto' : 'archivos adjuntos'}\r\n                </p>\r\n                \r\n                <ul className=\"space-y-1\">\r\n                  {attachments.map((file, index) => (\r\n                    <li key={index} className=\"flex items-center justify-between text-sm\">\r\n                      <div className=\"flex-grow truncate mr-2\">\r\n                        {file.name}\r\n                        <span className=\"text-xs text-gray-500 ml-1\">\r\n                          ({Math.round(file.size / 1024)} KB)</span>\r\n                      </div>\r\n                      <Button\r\n                        variant=\"ghost\"\r\n                        size=\"xs\"\r\n                        aria-label=\"Eliminar adjunto\"\r\n                        className=\"text-gray-500\"\r\n                        onClick={() => removeAttachment(index)}\r\n                        disabled={sending}\r\n                      >\r\n                        <X size={14} />\r\n                      </Button>\r\n                    </li>\r\n                  ))}\r\n                </ul>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"border-t border-gray-200 p-4 flex justify-end\">\r\n          <div className=\"flex space-x-3\">\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={handleClose}\r\n              disabled={sending}\r\n            >\r\n              Cancelar\r\n            </Button>\r\n            <Button\r\n              onClick={handleSend}\r\n              disabled={sending}\r\n              data-testid=\"send-button\"\r\n            >\r\n              {sending ? 'Enviando...' : 'Enviar'}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </Card>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EmailComposer;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\EmailDetail.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'safeRender' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'ensureNotPromise' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":38},{"ruleId":"no-unused-vars","severity":1,"message":"'safeDangerouslySetInnerHTML' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":67}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from 'react';\r\nimport sanitizeHtml from '../../utils/sanitizeHtml';\r\nimport { safeRender, ensureNotPromise, safeDangerouslySetInnerHTML, safeExecute } from '../../utils/promiseSafeRenderer';\r\n// Importamos nuestros componentes personalizados en lugar de lucide-react\r\nimport {\r\n  IconArrowLeft as ArrowLeft,\r\n  IconReply as Reply,\r\n  IconTrash as Trash,\r\n  IconStar as Star,\r\n  IconDownload as Download,\r\n  IconPrinter as Paperclip,\r\n  IconFolderMove as FolderMove\r\n} from '../ui/IconComponents';\r\nimport FolderSelectionModal from './FolderSelectionModal';\r\nimport Button from '../Button';\r\nimport EmailTagsManager from './EmailTagsManager';\r\n\r\n/**\r\n * Componente que muestra el detalle de un correo electr√≥nico\r\n * \r\n * @param {Object} props - Propiedades del componente\r\n * @param {Object} props.email - Email a mostrar\r\n * @param {Function} props.onBack - Funci√≥n para volver a la lista\r\n * @param {Function} props.onReply - Funci√≥n para responder al email\r\n * @param {Function} props.onDelete - Funci√≥n para eliminar el email\r\n * @param {Function} props.onMoveToFolder - Funci√≥n para mover el correo a una carpeta\r\n * @param {Array} props.folders - Lista de carpetas personalizadas disponibles\r\n */\r\nconst EmailDetail = ({ email, onBack, onReply, onDelete, onMoveToFolder, folders = [], isMobile = false }) => {\r\n  const [isFolderModalOpen, setIsFolderModalOpen] = useState(false);\r\n  const [windowWidth, setWindowWidth] = useState(window.innerWidth);\r\n  const mainContentRef = useRef(null);\r\n  \r\n  useEffect(() => {\r\n    const handleResize = () => {\r\n      setWindowWidth(window.innerWidth);\r\n    };\r\n    \r\n    window.addEventListener('resize', handleResize);\r\n    return () => window.removeEventListener('resize', handleResize);\r\n  }, []);\r\n  \r\n  // Enfocar el contenido principal cuando se carga un nuevo correo\r\n  useEffect(() => {\r\n    if (email && mainContentRef.current) {\r\n      mainContentRef.current.focus();\r\n    }\r\n  }, [email]);\r\n  \r\n  // Determinar si estamos en pantalla m√≥vil basado en prop o en el tama√±o de ventana\r\n  const isSmallScreen = isMobile || windowWidth < 768;\r\n  \r\n  if (!email) return null;\r\n\r\n  // Formatear fecha completa\r\n  const formatFullDate = (dateStr) => {\r\n    if (!dateStr) return '';\r\n    try {\r\n      const date = new Date(dateStr);\r\n      return date.toLocaleString('es-ES', {\r\n        weekday: 'long',\r\n        year: 'numeric',\r\n        month: 'long',\r\n        day: 'numeric',\r\n        hour: '2-digit',\r\n        minute: '2-digit'\r\n      });\r\n    } catch (e) {\r\n      console.error('Error al formatear fecha:', e);\r\n      return dateStr;\r\n    }\r\n  };\r\n  \r\n  // Extraer nombre del remitente a partir del email\r\n  const getSenderName = (emailAddress) => {\r\n    if (!emailAddress) return '';\r\n    \r\n    // Si tiene formato \"Nombre <email@ejemplo.com>\"\r\n    const match = emailAddress.match(/^([^<]+)\\s*<([^>]+)>$/);\r\n    if (match) {\r\n      return match[1].trim();\r\n    }\r\n    \r\n    // Si es solo una direcci√≥n de correo, extraer la parte antes de @\r\n    return emailAddress.split('@')[0].replace(/[.]/g, ' ');\r\n  };\r\n\r\n  // Extraer direcci√≥n de correo del remitente\r\n  const getSenderEmail = (emailAddress) => {\r\n    if (!emailAddress) return '';\r\n    const match = emailAddress.match(/<([^>]+)>/);\r\n    if (match) return match[1];\r\n    return emailAddress;\r\n  };\r\n\r\n  // Manejar eventos de teclado para navegaci√≥n\r\n  const handleKeyDown = (e) => {\r\n    // ESC para volver a la lista de correos\r\n    if (e.key === 'Escape') {\r\n      onBack && onBack();\r\n    }\r\n    // R para responder\r\n    else if (e.key === 'r' && !e.ctrlKey && !e.altKey && !e.metaKey) {\r\n      onReply && onReply();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div \r\n      className=\"h-full flex flex-col\" \r\n      onKeyDown={handleKeyDown}\r\n      role=\"region\"\r\n      aria-label=\"Detalle del correo electr√≥nico\"\r\n    >\r\n      {/* Cabecera - Adaptativa para m√≥vil */}\r\n      <header className=\"mb-3 sm:mb-4 pb-2 border-b border-gray-200\" role=\"header\">\r\n        <div className={`flex items-center ${isSmallScreen ? 'flex-col items-start' : 'justify-between'} mb-3 sm:mb-4`}>\r\n          <Button \r\n            variant=\"ghost\" \r\n            size=\"sm\" \r\n            onClick={onBack} \r\n            className=\"flex items-center mb-2 sm:mb-0\"\r\n            aria-label=\"Volver a la lista de correos\"\r\n          >\r\n            <ArrowLeft size={16} className=\"mr-1\" /> Volver\r\n          </Button>\r\n          \r\n          <div className={`flex ${isSmallScreen ? 'w-full justify-between mt-1' : 'space-x-2'}`}>\r\n            <Button \r\n              variant=\"ghost\" \r\n              size={isSmallScreen ? \"xs\" : \"sm\"} \r\n              onClick={onReply} \r\n              title=\"Responder\"\r\n              aria-label=\"Responder\"\r\n              className=\"flex items-center\"\r\n            >\r\n              <Reply size={isSmallScreen ? 14 : 16} />\r\n              {isSmallScreen && <span className=\"ml-1 text-xs\">Responder</span>}\r\n            </Button>\r\n            {onMoveToFolder && folders && folders.length > 0 && (\r\n              <Button \r\n                variant=\"ghost\" \r\n                size={isSmallScreen ? \"xs\" : \"sm\"} \r\n                data-testid=\"move-to-folder-button\" \r\n                onClick={() => setIsFolderModalOpen(true)}\r\n                title=\"Mover a carpeta\"\r\n                aria-label=\"Mover a carpeta\"\r\n                className=\"flex items-center\"\r\n              >\r\n                <FolderMove size={isSmallScreen ? 14 : 16} />\r\n                {isSmallScreen && <span className=\"ml-1 text-xs\">Mover</span>}\r\n              </Button>\r\n            )}\r\n            <Button \r\n              variant=\"ghost\" \r\n              size={isSmallScreen ? \"xs\" : \"sm\"} \r\n              onClick={() => onDelete && onDelete(email.id)}\r\n              title=\"Eliminar\"\r\n              className=\"flex items-center\"\r\n            >\r\n              <Trash size={isSmallScreen ? 14 : 16} />\r\n              {isSmallScreen && <span className=\"ml-1 text-xs\">Eliminar</span>}\r\n            </Button>\r\n            <Button \r\n              variant=\"ghost\" \r\n              size={isSmallScreen ? \"xs\" : \"sm\"} \r\n              title=\"Marcar como importante\"\r\n              className=\"flex items-center\"\r\n            >\r\n              <Star size={isSmallScreen ? 14 : 16} />\r\n              {isSmallScreen && <span className=\"ml-1 text-xs\">Destacar</span>}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n        \r\n        <h2 className=\"text-lg sm:text-xl font-semibold mb-2\" id=\"email-subject\">{email.subject || '(Sin asunto)'}</h2>\r\n        \r\n        <div className=\"flex items-start mb-2\">\r\n          <div \r\n            className=\"w-7 h-7 sm:w-8 sm:h-8 rounded-full bg-blue-500 text-white flex items-center justify-center mr-2 sm:mr-3 mt-1\" \r\n            aria-hidden=\"true\"\r\n          >\r\n            {getSenderName(email.from).charAt(0).toUpperCase()}\r\n          </div>\r\n          \r\n          <div className=\"flex-grow\">\r\n            <div className={`${isSmallScreen ? 'flex flex-col' : 'flex items-baseline justify-between'}`}>\r\n              <div>\r\n                <p className=\"font-medium text-sm sm:text-base\" id=\"sender-name\">{getSenderName(email.from)}</p>\r\n                <p className=\"text-xs text-gray-700 break-all\" id=\"sender-email\" aria-label=\"Direcci√≥n de correo del remitente\">{getSenderEmail(email.from)}</p>\r\n              </div>\r\n              <p className=\"text-xs text-gray-700 mt-1 sm:mt-0\" aria-label=\"Fecha de env√≠o\">{formatFullDate(email.date)}</p>\r\n            </div>\r\n            \r\n            <p className=\"text-xs sm:text-sm mt-1\">\r\n              <span id=\"recipient-label\">Para:</span> <span className=\"text-gray-700 break-all\" aria-labelledby=\"recipient-label\">{email.to}</span>\r\n            </p>\r\n            \r\n            <div className=\"mt-2 sm:mt-3\">\r\n              <span className=\"text-xs sm:text-sm font-medium text-gray-600\">Etiquetas:</span>\r\n              <EmailTagsManager \r\n                emailId={email.id} \r\n                onTagsChange={(tags) => {\r\n                  // Podr√≠amos actualizar el estado local si es necesario\r\n                  console.log('Etiquetas actualizadas:', tags);\r\n                }}\r\n                isSmallScreen={isSmallScreen}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </header>\r\n      \r\n      {/* Contenido del email */}\r\n      <main \r\n        className=\"flex-grow overflow-auto mb-3 sm:mb-4\"\r\n        tabIndex=\"0\"\r\n        ref={mainContentRef}\r\n        role=\"article\"\r\n        aria-labelledby=\"email-subject sender-name\"\r\n      >\r\n        {/* Si es HTML, renderizarlo de forma segura */}\r\n        {email.body && email.body.includes('<') ? (\r\n          <div \r\n            className=\"prose prose-sm sm:prose max-w-none\" \r\n            dangerouslySetInnerHTML={{ __html: safeExecute(\r\n              () => {\r\n                const result = sanitizeHtml(email.body);\r\n                return typeof result === 'string' ? result : String(result || '');\r\n              },\r\n              email.body || '' // fallback si sanitizeHtml retorna una Promesa\r\n            ) }}\r\n          />\r\n        ) : (\r\n          <div className=\"whitespace-pre-wrap text-sm sm:text-base text-gray-800\">{email.body}</div>\r\n        )}\r\n      </main>\r\n      \r\n      {/* Archivos adjuntos */}\r\n      {email.attachments && email.attachments.length > 0 && (\r\n        <section \r\n          className=\"mt-3 sm:mt-4 pt-2 sm:pt-3 border-t border-gray-200\"\r\n          role=\"group\"\r\n        >\r\n          <h3 className=\"text-xs sm:text-sm font-medium mb-2 flex items-center\" id=\"attachments-heading\">\r\n            <Paperclip size={isSmallScreen ? 14 : 16} className=\"mr-1\" aria-hidden=\"true\" /> \r\n            Archivos adjuntos ({email.attachments.length})\r\n          </h3>\r\n          \r\n          <div className=\"space-y-2\" role=\"list\" aria-labelledby=\"attachments-heading\">\r\n            {email.attachments.map((attachment, index) => (\r\n              <div \r\n                key={index}\r\n                className=\"flex items-center p-1.5 sm:p-2 border rounded-lg hover:bg-gray-50\"\r\n                role=\"listitem\"\r\n              >\r\n                <div className=\"flex-grow min-w-0\"> {/* min-width: 0 para evitar overflow */}\r\n                  <p className=\"text-xs sm:text-sm font-medium truncate text-gray-800\" id={`attachment-${index}-name`}>\r\n                    {attachment.filename || `adjunto-${index+1}`}\r\n                  </p>\r\n                  {attachment.size && (\r\n                    <p className=\"text-xs text-gray-700\" aria-label=\"Tama√±o del archivo\">\r\n                      {Math.round(attachment.size / 1024)} KB\r\n                    </p>\r\n                  )}\r\n                </div>\r\n                \r\n                <Button \r\n                  variant=\"ghost\" \r\n                  size={isSmallScreen ? \"xs\" : \"sm\"} \r\n                  className=\"ml-1 flex-shrink-0\"\r\n                  aria-label={`Descargar ${attachment.filename || `adjunto-${index+1}`}`}\r\n                >\r\n                  <Download size={isSmallScreen ? 14 : 16} />\r\n                </Button>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </section>\r\n      )}\r\n      \r\n      {/* Modal de selecci√≥n de carpetas */}\r\n      <FolderSelectionModal \r\n        isOpen={isFolderModalOpen}\r\n        onClose={() => setIsFolderModalOpen(false)}\r\n        folders={folders}\r\n        onSelectFolder={(folderId) => {\r\n          if (onMoveToFolder && email) {\r\n            onMoveToFolder(email.id, folderId);\r\n          }\r\n          setIsFolderModalOpen(false);\r\n        }}\r\n        title=\"Mover correo a carpeta\"\r\n        description={`Seleccione una carpeta para mover \"${email.subject || '(Sin asunto)'}\":`}\r\n        aria-label=\"Selecci√≥n de carpetas\"\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EmailDetail;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\EmailFeedbackCollector.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\EmailFilters.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\EmailFolderList.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'onDeleteFolder' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":21,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Folder, Plus } from 'lucide-react';\r\nimport Button from '../Button';\r\n\r\n/**\r\n * Lista de carpetas de correo. Implementaci√≥n ligera para satisfacer\r\n * los tests de accesibilidad.\r\n *\r\n * Props esperadas por los tests:\r\n * - folders: Array<{ id, name, systemFolder, count }>\r\n * - selectedFolder: string\r\n * - onSelectFolder: (id) => void\r\n * - onCreateFolder: () => void\r\n * - onDeleteFolder: (id) => void  (no usado en tests)\r\n */\r\nconst EmailFolderList = ({\r\n  folders = [],\r\n  selectedFolder = '',\r\n  onSelectFolder = () => {},\r\n  onCreateFolder = () => {},\r\n  onDeleteFolder = () => {},\r\n}) => {\r\n  return (\r\n    <nav aria-label=\"Carpetas de correo\" className=\"space-y-2\">\r\n      <div className=\"flex items-center justify-between px-2\">\r\n        <h2 className=\"text-sm font-medium text-gray-700\">Carpetas</h2>\r\n        <Button\r\n          size=\"xs\"\r\n          variant=\"ghost\"\r\n          onClick={onCreateFolder}\r\n          aria-label=\"Nueva carpeta\"\r\n          className=\"flex items-center space-x-1\"\r\n        >\r\n          <Plus size={14} />\r\n          <span className=\"sr-only sm:not-sr-only sm:inline\">Nueva carpeta</span>\r\n        </Button>\r\n      </div>\r\n\r\n      <ul role=\"list\" className=\"space-y-1\">\r\n        {folders.map((folder) => (\r\n          <li key={folder.id}>\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => onSelectFolder(folder.id)}\r\n              className={`w-full text-left px-2 py-1 rounded flex items-center justify-between focus:outline-none focus:ring-2 focus:ring-blue-500 ${\r\n                selectedFolder === folder.id ? 'bg-blue-100 text-blue-700' : 'hover:bg-gray-100'\r\n              }`}\r\n              aria-current={selectedFolder === folder.id ? 'true' : undefined}\r\n            >\r\n              <span className=\"flex items-center space-x-2 truncate\">\r\n                <Folder size={14} />\r\n                <span className=\"truncate\">{folder.name}</span>\r\n              </span>\r\n              {typeof folder.count === 'number' && folder.count > 0 && (\r\n                <span className=\"text-xs text-gray-600\">{folder.count}</span>\r\n              )}\r\n            </button>\r\n          </li>\r\n        ))}\r\n      </ul>\r\n    </nav>\r\n  );\r\n};\r\n\r\nexport default EmailFolderList;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\EmailInbox.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'ensureNotPromise' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":38},{"ruleId":"no-unused-vars","severity":1,"message":"'safeMap' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":47}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\nimport { getMails, deleteMail, initEmailService } from '../../services/EmailService';\nimport EmailDetail from './EmailDetail';\nimport { safeRender, ensureNotPromise, safeMap } from '../../utils/promiseSafeRenderer';\nimport { useAuth } from '../../hooks/useAuth';\n\n/**\n * Bandeja de entrada de correos - Dise√±o original mejorado\n * Mantiene la simplicidad pero con mejor estilo visual\n */\nexport default function EmailInbox() {\n  // useAuth puede ser undefined en entorno de pruebas; usamos {} como fallback\n  const { user, profile } = useAuth() || {};\n  const [emails, setEmails] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [search, setSearch] = useState('');\n  const [folder, setFolder] = useState('inbox');\n  const [sortState, setSortState] = useState('none'); // none | alpha | date\n  const [selectedIds, setSelectedIds] = useState(new Set());\n  const [detailEmail, setDetailEmail] = useState(null);\n\n  // Inicializar servicio de email cuando tengamos perfil de usuario y recargar correos\n  useEffect(() => {\n    const initAndLoad = async () => {\n      await initEmailService(profile);\n      await loadEmails(); // Recargar una vez inicializado\n    };\n    if (profile) {\n      initAndLoad();\n    }\n  }, [profile]);\n\n  // Cargar correos\n  const loadEmails = async (targetFolder = folder) => {\n    try {\n      setLoading(true);\n      setError(null);\n      const data = await getMails(targetFolder);\n      setEmails(data || []);\n    } catch (e) {\n      console.error(e);\n      setError('No se pudieron cargar los emails');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Recargar cuando cambie la carpeta, solo si el servicio ya se inicializ√≥ (hay perfil)\n  useEffect(() => {\n    if (profile) {\n      loadEmails();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [folder, profile]);\n\n  // Utilidades\n  const toggleSelect = (id) => {\n    setSelectedIds((prev) => {\n      const next = new Set(prev);\n      if (next.has(id)) next.delete(id);\n      else next.add(id);\n      return next;\n    });\n  };\n\n  const handleDelete = async () => {\n    for (const id of selectedIds) {\n      await deleteMail(id);\n    }\n    setSelectedIds(new Set());\n    await loadEmails();\n  };\n\n  // Asegurar que emails siempre sea un array antes de procesarlo\n  const safeEmails = Array.isArray(emails) ? emails : [];\n  \n  const displayed = safeEmails\n    .filter((e) => e && e.subject && e.subject.toLowerCase().includes(search.toLowerCase()))\n    .sort((a, b) => {\n      if (sortState === 'alpha') {\n        return (a.subject || '').localeCompare(b.subject || '', 'es');\n      }\n      if (sortState === 'date') {\n        const dateA = a.date ? new Date(a.date) : new Date(0);\n        const dateB = b.date ? new Date(b.date) : new Date(0);\n        return dateA - dateB;\n      }\n      return 0; // sin ordenar\n    });\n\n  if (error) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"text-center\">\n          <div className=\"text-red-500 text-xl mb-2\">‚ö†Ô∏è</div>\n          <p className=\"text-red-600 mb-4\">{error}</p>\n          <button \n            onClick={() => loadEmails()}\n            className=\"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors\"\n          >\n            Reintentar\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  if (detailEmail) {\n    return (\n      <EmailDetail email={detailEmail} onBack={() => setDetailEmail(null)} />\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Header con informaci√≥n del usuario */}\n      {user?.email && (\n        <div className=\"bg-blue-50 p-3 rounded-lg\">\n          <p className=\"text-sm text-blue-700\">\n            üìß Usuario: <span className=\"font-medium\">{user.email}</span> | \n            üìä {displayed.length} emails en {folder === 'inbox' ? 'Recibidos' : 'Enviados'}\n          </p>\n        </div>\n      )}\n\n      {/* Controles principales */}\n      <div className=\"flex flex-col sm:flex-row gap-4\">\n        {/* Selector de carpeta */}\n        <div className=\"flex bg-gray-100 rounded-lg p-1\">\n          <button \n            onClick={() => setFolder('inbox')}\n            className={`px-4 py-2 rounded-md transition-colors ${\n              folder === 'inbox' \n                ? 'bg-white text-blue-600 shadow-sm' \n                : 'text-gray-600 hover:text-gray-800'\n            }`}\n          >\n            üì• Recibidos\n          </button>\n          <button \n            onClick={() => setFolder('sent')}\n            className={`px-4 py-2 rounded-md transition-colors ${\n              folder === 'sent' \n                ? 'bg-white text-blue-600 shadow-sm' \n                : 'text-gray-600 hover:text-gray-800'\n            }`}\n          >\n            üì§ Enviados\n          </button>\n        </div>\n\n        {/* Barra de b√∫squeda */}\n        <div className=\"flex-1\">\n          <input\n            type=\"text\"\n            placeholder=\"üîç Buscar emails...\"\n            value={search}\n            onChange={(e) => setSearch(e.target.value)}\n            className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n          />\n        </div>\n\n        {/* Bot√≥n eliminar */}\n        <button \n          onClick={handleDelete}\n          disabled={selectedIds.size === 0}\n          className={`px-4 py-2 rounded-lg transition-colors ${\n            selectedIds.size > 0\n              ? 'bg-red-600 text-white hover:bg-red-700'\n              : 'bg-gray-300 text-gray-500 cursor-not-allowed'\n          }`}\n        >\n          üóëÔ∏è Eliminar ({selectedIds.size})\n        </button>\n      </div>\n\n      {/* Lista de emails */}\n      {loading ? (\n        <div className=\"flex items-center justify-center h-32\">\n          <div className=\"text-center\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2\"></div>\n            <p className=\"text-gray-600\">Cargando emails...</p>\n          </div>\n        </div>\n      ) : displayed.length === 0 ? (\n        <div className=\"text-center py-12\">\n          <div className=\"text-gray-400 text-4xl mb-4\">üì≠</div>\n          <p className=\"text-gray-600\">No hay emails {search ? 'que coincidan con tu b√∫squeda' : 'en esta carpeta'}</p>\n        </div>\n      ) : (\n        <div data-testid=\"email-list\" className=\"bg-white rounded-lg shadow overflow-hidden\">\n          <table className=\"w-full\">\n            <thead className=\"bg-gray-50\">\n              <tr role=\"row\">\n                <th className=\"px-4 py-3 text-left\">\n                  <input\n                    type=\"checkbox\"\n                    aria-label=\"Seleccionar todos\"\n                    checked={selectedIds.size === safeEmails.length && safeEmails.length > 0}\n                    onChange={(e) => {\n                      if (e.target.checked) {\n                        setSelectedIds(new Set(safeEmails.map((m) => m.id)));\n                      } else {\n                        setSelectedIds(new Set());\n                      }\n                    }}\n                    className=\"rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\n                  />\n                </th>\n                <th className=\"px-4 py-3 text-left\">\n                  <button \n                    onClick={() => setSortState((prev) => (prev === 'alpha' ? 'date' : 'alpha'))}\n                    className=\"flex items-center space-x-1 text-gray-700 hover:text-gray-900 font-medium\"\n                  >\n                    <span>Asunto</span>\n                    <span className=\"text-xs\">\n                      {sortState === 'alpha' ? 'üî§' : sortState === 'date' ? 'üìÖ' : '‚ÜïÔ∏è'}\n                    </span>\n                  </button>\n                </th>\n                <th className=\"px-4 py-3 text-left text-gray-700 font-medium\">De</th>\n                <th className=\"px-4 py-3 text-left text-gray-700 font-medium\">Fecha</th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-gray-200\">\n              {displayed.map((email) => (\n                <tr \n                  key={safeRender(email.id, '')} \n                  role=\"row\" \n                  onClick={() => setDetailEmail(email)}\n                  className=\"hover:bg-gray-50 cursor-pointer transition-colors\"\n                >\n                  <td className=\"px-4 py-3\">\n                    <input\n                      type=\"checkbox\"\n                      role=\"checkbox\"\n                      checked={selectedIds.has(safeRender(email.id, ''))}\n                      onClick={(e) => e.stopPropagation()}\n                      onChange={(e) => {\n                        e.stopPropagation();\n                        toggleSelect(safeRender(email.id, ''));\n                      }}\n                      className=\"rounded border-gray-300 text-blue-600 focus:ring-blue-500\"\n                    />\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <div className=\"font-medium text-gray-900\">\n                      {safeRender(email.subject, '(Sin asunto)')}\n                    </div>\n                    {email.body && (\n                      <div className=\"text-sm text-gray-500 truncate max-w-xs\">\n                        {safeRender(email.body.substring(0, 100), '')}...\n                      </div>\n                    )}\n                  </td>\n                  <td className=\"px-4 py-3 text-sm text-gray-600\">\n                    {safeRender(email.from, 'Desconocido')}\n                  </td>\n                  <td className=\"px-4 py-3 text-sm text-gray-500\">\n                    {email.date ? new Date(email.date).toLocaleDateString('es-ES') : 'Sin fecha'}\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\EmailList.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\EmailNotificationBadge.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\EmailRecommendationsPanel.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Paper' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":8},{"ruleId":"no-unused-vars","severity":1,"message":"'Rating' is defined but never used. Allowed unused vars must match /^_/u.","line":19,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":9}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { \r\n  Box, \r\n  Typography, \r\n  Paper, \r\n  Divider, \r\n  Chip, \r\n  List, \r\n  ListItem, \r\n  ListItemIcon, \r\n  ListItemText,\r\n  CircularProgress,\r\n  Alert,\r\n  Accordion,\r\n  AccordionSummary,\r\n  AccordionDetails,\r\n  Button,\r\n  Tooltip,\r\n  Rating,\r\n  Grid\r\n} from '@mui/material';\r\nimport Lightbulb from '@mui/icons-material/Lightbulb';\r\nimport AccessTime from '@mui/icons-material/AccessTime';\r\nimport Subject from '@mui/icons-material/Subject';\r\nimport Edit from '@mui/icons-material/Edit';\r\nimport Category from '@mui/icons-material/Category';\r\nimport TipsAndUpdates from '@mui/icons-material/TipsAndUpdates';\r\nimport ExpandMore from '@mui/icons-material/ExpandMore';\r\nimport CheckCircle from '@mui/icons-material/CheckCircle';\r\nimport VerifiedUser from '@mui/icons-material/VerifiedUser';\r\nimport Schedule from '@mui/icons-material/Schedule';\r\nimport EmailRecommendationService from '../../services/EmailRecommendationService';\r\n\r\n/**\r\n * Componente que muestra recomendaciones personalizadas para mejorar la efectividad\r\n * de los correos electr√≥nicos enviados a proveedores\r\n */\r\nconst EmailRecommendationsPanel = ({ category, searchQuery, onApplyRecommendation }) => {\r\n  const [loading, setLoading] = useState(true);\r\n  const [recommendations, setRecommendations] = useState(null);\r\n  const [error, setError] = useState(null);\r\n  \r\n  // Instanciar el servicio de recomendaciones\r\n  const recommendationService = new EmailRecommendationService();\r\n  \r\n  useEffect(() => {\r\n    const generateRecommendations = async () => {\r\n      try {\r\n        setLoading(true);\r\n        setError(null);\r\n        \r\n        // Generar recomendaciones basadas en el contexto proporcionado\r\n        const data = recommendationService.generateRecommendations(category, searchQuery);\r\n        setRecommendations(data);\r\n      } catch (err) {\r\n        console.error('Error generando recomendaciones:', err);\r\n        setError('No se pudieron generar las recomendaciones. Int√©ntalo de nuevo m√°s tarde.');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    \r\n    generateRecommendations();\r\n  }, [category, searchQuery]);\r\n  \r\n  // Funci√≥n para aplicar una recomendaci√≥n\r\n  const handleApplyRecommendation = (type, data) => {\r\n    if (onApplyRecommendation) {\r\n      onApplyRecommendation(type, data);\r\n    }\r\n  };\r\n  \r\n  // Renderiza el indicador de confianza\r\n  const renderConfidenceIndicator = () => {\r\n    if (!recommendations) return null;\r\n    \r\n    const score = recommendations.confidenceScore || 0;\r\n    let color = 'error';\r\n    let label = 'Baja';\r\n    \r\n    if (score >= 70) {\r\n      color = 'success';\r\n      label = 'Alta';\r\n    } else if (score >= 40) {\r\n      color = 'warning';\r\n      label = 'Media';\r\n    }\r\n    \r\n    return (\r\n      <Box sx={{ display: 'flex', alignItems: 'center', mb: 2 }}>\r\n        <Typography variant=\"body2\" color=\"text.secondary\" mr={1}>\r\n          Confianza en recomendaciones:\r\n        </Typography>\r\n        <Chip \r\n          size=\"small\"\r\n          label={`${label} (${score}%)`} \r\n          color={color}\r\n          icon={<VerifiedUser fontSize=\"small\" />}\r\n        />\r\n      </Box>\r\n    );\r\n  };\r\n  \r\n  // Si est√° cargando, mostrar indicador\r\n  if (loading) {\r\n    return (\r\n      <Box sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center', p: 3 }}>\r\n        <CircularProgress size={40} />\r\n        <Typography variant=\"body2\" color=\"text.secondary\" mt={2}>\r\n          Analizando datos y generando recomendaciones...\r\n        </Typography>\r\n      </Box>\r\n    );\r\n  }\r\n  \r\n  // Si hay error, mostrar mensaje\r\n  if (error) {\r\n    return (\r\n      <Alert severity=\"error\" sx={{ m: 2 }}>\r\n        {error}\r\n      </Alert>\r\n    );\r\n  }\r\n  \r\n  // Si no hay recomendaciones, mostrar mensaje\r\n  if (!recommendations) {\r\n    return (\r\n      <Alert severity=\"info\" sx={{ m: 2 }}>\r\n        No hay suficientes datos para generar recomendaciones personalizadas.\r\n      </Alert>\r\n    );\r\n  }\r\n  \r\n  return (\r\n    <Box sx={{ p: 2 }}>\r\n      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>\r\n        <Typography variant=\"h5\" gutterBottom>\r\n          Recomendaciones Personalizadas\r\n        </Typography>\r\n        <Tooltip title=\"Las recomendaciones se basan en datos hist√≥ricos de efectividad\">\r\n          <TipsAndUpdates color=\"primary\" />\r\n        </Tooltip>\r\n      </Box>\r\n      \r\n      {renderConfidenceIndicator()}\r\n      \r\n      <Grid container spacing={2}>\r\n        {/* Mejor momento para enviar */}\r\n        <Grid item xs={12} md={6}>\r\n          <Accordion defaultExpanded>\r\n            <AccordionSummary expandIcon={<ExpandMore />}>\r\n              <AccessTime color=\"primary\" sx={{ mr: 1 }} />\r\n              <Typography variant=\"subtitle1\">Mejor momento para enviar</Typography>\r\n            </AccordionSummary>\r\n            <AccordionDetails>\r\n              <Box>\r\n                {recommendations.bestTimeToSend.hasSufficientData ? (\r\n                  <>\r\n                    <Typography variant=\"body1\">\r\n                      El mejor momento para enviar correos es por la {' '}\r\n                      <strong>{recommendations.bestTimeToSend.bestTimeSlotName}</strong>\r\n                      {' '} con una tasa de respuesta del {recommendations.bestTimeToSend.bestRate}%\r\n                    </Typography>\r\n                    <Box sx={{ mt: 1, display: 'flex', alignItems: 'center' }}>\r\n                      <Button\r\n                        size=\"small\"\r\n                        variant=\"outlined\"\r\n                        startIcon={<Schedule />}\r\n                        onClick={() => handleApplyRecommendation('time', recommendations.bestTimeToSend)}\r\n                      >\r\n                        Programar en este horario\r\n                      </Button>\r\n                    </Box>\r\n                  </>\r\n                ) : (\r\n                  <Alert severity=\"info\" sx={{ mt: 1 }}>\r\n                    No hay suficientes datos para determinar el mejor momento. \r\n                    Por ahora, recomendamos enviar por la ma√±ana (8-12h).\r\n                  </Alert>\r\n                )}\r\n              </Box>\r\n            </AccordionDetails>\r\n          </Accordion>\r\n        </Grid>\r\n        \r\n        {/* L√≠nea de asunto */}\r\n        <Grid item xs={12} md={6}>\r\n          <Accordion defaultExpanded>\r\n            <AccordionSummary expandIcon={<ExpandMore />}>\r\n              <Subject color=\"primary\" sx={{ mr: 1 }} />\r\n              <Typography variant=\"subtitle1\">L√≠nea de asunto efectiva</Typography>\r\n            </AccordionSummary>\r\n            <AccordionDetails>\r\n              <Typography variant=\"body2\" color=\"text.secondary\" gutterBottom>\r\n                Patrones recomendados:\r\n              </Typography>\r\n              <List dense disablePadding>\r\n                {recommendations.subjectLineRecommendations.recommendedPatterns.map((pattern, idx) => (\r\n                  <ListItem key={idx} disablePadding sx={{ py: 0.5 }}>\r\n                    <ListItemIcon sx={{ minWidth: 30 }}>\r\n                      <CheckCircle fontSize=\"small\" color=\"success\" />\r\n                    </ListItemIcon>\r\n                    <ListItemText \r\n                      primary={pattern}\r\n                      primaryTypographyProps={{ variant: 'body2' }}\r\n                    />\r\n                    <Button\r\n                      size=\"small\"\r\n                      onClick={() => handleApplyRecommendation('subject', pattern)}\r\n                    >\r\n                      Usar\r\n                    </Button>\r\n                  </ListItem>\r\n                ))}\r\n              </List>\r\n              \r\n              <Typography variant=\"body2\" color=\"text.secondary\" gutterBottom sx={{ mt: 1 }}>\r\n                Longitud √≥ptima: entre {recommendations.subjectLineRecommendations.optimalLength.min} y {recommendations.subjectLineRecommendations.optimalLength.max} caracteres\r\n              </Typography>\r\n            </AccordionDetails>\r\n          </Accordion>\r\n        </Grid>\r\n        \r\n        {/* Personalizaci√≥n */}\r\n        <Grid item xs={12} md={6}>\r\n          <Accordion>\r\n            <AccordionSummary expandIcon={<ExpandMore />}>\r\n              <Edit color=\"primary\" sx={{ mr: 1 }} />\r\n              <Typography variant=\"subtitle1\">Impacto de personalizaci√≥n</Typography>\r\n            </AccordionSummary>\r\n            <AccordionDetails>\r\n              {recommendations.customizationImpact.hasSufficientData ? (\r\n                <>\r\n                  <Box sx={{ display: 'flex', alignItems: 'center', mb: 1 }}>\r\n                    <Typography variant=\"body1\" mr={1}>\r\n                      Los mensajes personalizados tienen un \r\n                    </Typography>\r\n                    <Chip \r\n                      label={`+${recommendations.customizationImpact.impact}%`} \r\n                      color={parseFloat(recommendations.customizationImpact.impact) > 0 ? \"success\" : \"default\"}\r\n                      size=\"small\"\r\n                    />\r\n                    <Typography variant=\"body1\" ml={1}>\r\n                      de tasa de respuesta\r\n                    </Typography>\r\n                  </Box>\r\n                  \r\n                  <Box sx={{ display: 'flex', mt: 2, justifyContent: 'space-around' }}>\r\n                    <Box sx={{ textAlign: 'center' }}>\r\n                      <Typography variant=\"h6\">\r\n                        {recommendations.customizationImpact.customized.rate}%\r\n                      </Typography>\r\n                      <Typography variant=\"body2\" color=\"text.secondary\">\r\n                        Personalizados\r\n                      </Typography>\r\n                    </Box>\r\n                    <Divider orientation=\"vertical\" flexItem sx={{ mx: 2 }} />\r\n                    <Box sx={{ textAlign: 'center' }}>\r\n                      <Typography variant=\"h6\">\r\n                        {recommendations.customizationImpact.nonCustomized.rate}%\r\n                      </Typography>\r\n                      <Typography variant=\"body2\" color=\"text.secondary\">\r\n                        No personalizados\r\n                      </Typography>\r\n                    </Box>\r\n                  </Box>\r\n                </>\r\n              ) : (\r\n                <Alert severity=\"info\">\r\n                  {recommendations.customizationImpact.recommendCustomization \r\n                    ? 'Recomendamos personalizar tus mensajes para aumentar la tasa de respuesta.' \r\n                    : 'No hay suficientes datos para medir el impacto de la personalizaci√≥n.'}\r\n                </Alert>\r\n              )}\r\n            </AccordionDetails>\r\n          </Accordion>\r\n        </Grid>\r\n        \r\n        {/* Plantillas */}\r\n        <Grid item xs={12} md={6}>\r\n          <Accordion>\r\n            <AccordionSummary expandIcon={<ExpandMore />}>\r\n              <Category color=\"primary\" sx={{ mr: 1 }} />\r\n              <Typography variant=\"subtitle1\">Plantilla recomendada</Typography>\r\n            </AccordionSummary>\r\n            <AccordionDetails>\r\n              {recommendations.templateRecommendations.hasSufficientData ? (\r\n                <>\r\n                  <Typography variant=\"body1\">\r\n                    La plantilla con mejor rendimiento es{' '}\r\n                    <strong>{recommendations.templateRecommendations.bestOverallTemplate}</strong>\r\n                    {' '}con una tasa de respuesta del {recommendations.templateRecommendations.bestOverallResponseRate}%\r\n                  </Typography>\r\n                  \r\n                  {recommendations.templateRecommendations.categorySpecificTemplate && (\r\n                    <Box sx={{ mt: 1 }}>\r\n                      <Typography variant=\"body2\">\r\n                        Para la categor√≠a <strong>{recommendations.templateRecommendations.categorySpecificTemplate.category}</strong>:\r\n                        Tasa de respuesta del {recommendations.templateRecommendations.categorySpecificTemplate.responseRate}%\r\n                      </Typography>\r\n                    </Box>\r\n                  )}\r\n                  \r\n                  <Box sx={{ mt: 1 }}>\r\n                    <Button\r\n                      size=\"small\"\r\n                      variant=\"outlined\"\r\n                      onClick={() => handleApplyRecommendation('template', recommendations.templateRecommendations.bestOverallTemplate)}\r\n                    >\r\n                      Aplicar plantilla recomendada\r\n                    </Button>\r\n                  </Box>\r\n                </>\r\n              ) : (\r\n                <Alert severity=\"info\">\r\n                  No hay suficientes datos para recomendar una plantilla espec√≠fica.\r\n                  Por ahora, recomendamos usar la plantilla general.\r\n                </Alert>\r\n              )}\r\n            </AccordionDetails>\r\n          </Accordion>\r\n        </Grid>\r\n        \r\n        {/* Tiempo de respuesta esperado */}\r\n        <Grid item xs={12} md={6}>\r\n          <Accordion>\r\n            <AccordionSummary expandIcon={<ExpandMore />}>\r\n              <Schedule color=\"primary\" sx={{ mr: 1 }} />\r\n              <Typography variant=\"subtitle1\">Tiempo de respuesta esperado</Typography>\r\n            </AccordionSummary>\r\n            <AccordionDetails>\r\n              {recommendations.responseTimeExpectations.hasSufficientData ? (\r\n                <>\r\n                  <Typography variant=\"body1\">\r\n                    Tiempo promedio de respuesta: <strong>{recommendations.responseTimeExpectations.averageTime} horas</strong>\r\n                  </Typography>\r\n                  \r\n                  <Typography variant=\"body2\" color=\"text.secondary\" sx={{ mt: 1 }}>\r\n                    Tiempo mediano: {recommendations.responseTimeExpectations.medianTime} horas\r\n                  </Typography>\r\n                  \r\n                  <Box sx={{ display: 'flex', mt: 1, justifyContent: 'space-between' }}>\r\n                    <Typography variant=\"body2\" color=\"text.secondary\">\r\n                      Respuesta m√°s r√°pida: {recommendations.responseTimeExpectations.fastestResponse}h\r\n                    </Typography>\r\n                    <Typography variant=\"body2\" color=\"text.secondary\">\r\n                      Respuesta m√°s lenta: {recommendations.responseTimeExpectations.slowestResponse}h\r\n                    </Typography>\r\n                  </Box>\r\n                  \r\n                  {recommendations.responseTimeExpectations.categoryAverageTime && (\r\n                    <Typography variant=\"body2\" sx={{ mt: 1 }}>\r\n                      Para esta categor√≠a espec√≠fica: <strong>{recommendations.responseTimeExpectations.categoryAverageTime} horas</strong>\r\n                    </Typography>\r\n                  )}\r\n                </>\r\n              ) : (\r\n                <Alert severity=\"info\">\r\n                  Con base en promedios generales, espera una respuesta en aproximadamente 24-48 horas.\r\n                </Alert>\r\n              )}\r\n            </AccordionDetails>\r\n          </Accordion>\r\n        </Grid>\r\n        \r\n        {/* Recomendaciones espec√≠ficas de categor√≠a */}\r\n        {recommendations.categorySpecific && (\r\n          <Grid item xs={12}>\r\n            <Accordion>\r\n              <AccordionSummary expandIcon={<ExpandMore />}>\r\n                <Lightbulb color=\"primary\" sx={{ mr: 1 }} />\r\n                <Typography variant=\"subtitle1\">\r\n                  Recomendaciones para {category || 'esta categor√≠a'}\r\n                </Typography>\r\n              </AccordionSummary>\r\n              <AccordionDetails>\r\n                {recommendations.categorySpecific.hasSufficientData ? (\r\n                  <>\r\n                    <Typography variant=\"body2\" gutterBottom>\r\n                      Tasa de respuesta en esta categor√≠a: {recommendations.categorySpecific.responseRate}%\r\n                    </Typography>\r\n                    <List dense>\r\n                      {recommendations.categorySpecific.recommendations.map((rec, idx) => (\r\n                        <ListItem key={idx}>\r\n                          <ListItemIcon>\r\n                            <CheckCircle color=\"success\" />\r\n                          </ListItemIcon>\r\n                          <ListItemText primary={rec} />\r\n                        </ListItem>\r\n                      ))}\r\n                    </List>\r\n                  </>\r\n                ) : (\r\n                  <Alert severity=\"info\">\r\n                    No hay suficientes datos para recomendaciones espec√≠ficas en esta categor√≠a.\r\n                  </Alert>\r\n                )}\r\n              </AccordionDetails>\r\n            </Accordion>\r\n          </Grid>\r\n        )}\r\n        \r\n        {/* Recomendaciones basadas en la consulta */}\r\n        {recommendations.querySpecific && recommendations.querySpecific.recommendations.length > 0 && (\r\n          <Grid item xs={12}>\r\n            <Accordion>\r\n              <AccordionSummary expandIcon={<ExpandMore />}>\r\n                <Lightbulb color=\"primary\" sx={{ mr: 1 }} />\r\n                <Typography variant=\"subtitle1\">\r\n                  Basado en tu b√∫squeda\r\n                </Typography>\r\n              </AccordionSummary>\r\n              <AccordionDetails>\r\n                <List dense>\r\n                  {recommendations.querySpecific.recommendations.map((rec, idx) => (\r\n                    <ListItem key={idx}>\r\n                      <ListItemIcon>\r\n                        <CheckCircle color=\"success\" />\r\n                      </ListItemIcon>\r\n                      <ListItemText primary={rec} />\r\n                    </ListItem>\r\n                  ))}\r\n                </List>\r\n              </AccordionDetails>\r\n            </Accordion>\r\n          </Grid>\r\n        )}\r\n      </Grid>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default EmailRecommendationsPanel;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\EmailSettings.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'currentUser' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":21,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Check, AlertTriangle } from 'lucide-react';\r\nimport Button from '../Button';\r\nimport Card from '../Card';\r\nimport { createEmailAlias, initEmailService } from '../../services/emailService';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport TagsManager from './TagsManager';\r\nimport WeddingAccountLink from '../settings/WeddingAccountLink';\r\n\r\n/**\r\n * Componente para gestionar la configuraci√≥n de correo electr√≥nico del usuario\r\n * Permite personalizar su direcci√≥n de correo y gestionar preferencias\r\n */\r\nconst EmailSettings = () => {\r\n  const [loading, setLoading] = useState(false);\r\n  const [success, setSuccess] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [emailAddress, setEmailAddress] = useState('');\r\n  const [emailAlias, setEmailAlias] = useState('');\r\n  const [newAlias, setNewAlias] = useState('');\r\n  const { currentUser, userProfile, updateUserProfile } = useAuth();\r\n  \r\n  // Cargar datos del usuario\r\n  useEffect(() => {\r\n    if (userProfile) {\r\n      // Inicializar el servicio de email y obtener la direcci√≥n actual\r\n      const currentEmail = initEmailService(userProfile);\r\n      setEmailAddress(currentEmail);\r\n      setEmailAlias(userProfile.emailAlias || '');\r\n    }\r\n  }, [userProfile]);\r\n  \r\n  // Validar formato de alias\r\n  const validateAlias = (alias) => {\r\n    if (!alias) return false;\r\n    if (alias.length < 3) return false;\r\n    \r\n    // Comprobar que solo contiene caracteres v√°lidos (letras, n√∫meros, puntos)\r\n    const validAliasRegex = /^[a-z0-9.]+$/;\r\n    return validAliasRegex.test(alias);\r\n  };\r\n  \r\n  // Manejar cambio de alias\r\n  const handleChangeAlias = async (e) => {\r\n    e.preventDefault();\r\n    \r\n    if (!validateAlias(newAlias)) {\r\n      setError('El alias debe tener al menos 3 caracteres y solo puede contener letras, n√∫meros y puntos.');\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      setLoading(true);\r\n      setError('');\r\n      \r\n      // Crear el nuevo alias\r\n      const result = await createEmailAlias(userProfile, newAlias);\r\n      \r\n      if (result.success) {\r\n        // Actualizar perfil de usuario con el nuevo alias\r\n        const updatedProfile = {\r\n          ...userProfile,\r\n          emailAlias: result.alias\r\n        };\r\n        \r\n        // Actualizar en backend/estado\r\n        await updateUserProfile(updatedProfile);\r\n        \r\n        setEmailAddress(result.email);\r\n        setEmailAlias(result.alias);\r\n        setNewAlias('');\r\n        setSuccess(true);\r\n        \r\n        // Ocultar mensaje de √©xito despu√©s de 3 segundos\r\n        setTimeout(() => setSuccess(false), 3000);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al cambiar alias de correo:', error);\r\n      setError(`Error: ${error.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n  \r\n  return (\r\n    <Card className=\"p-4\">\r\n      <h2 className=\"text-xl font-semibold mb-4\">Configuraci√≥n de Correo Electr√≥nico</h2>\r\n      \r\n      <div className=\"space-y-6\">\r\n        {/* Direcci√≥n de correo actual */}\r\n        <div>\r\n          <h3 className=\"text-md font-medium mb-2\">Tu direcci√≥n de correo</h3>\r\n          <p className=\"text-gray-600 mb-1\">Esta es tu direcci√≥n de correo electr√≥nico actual en Lovenda:</p>\r\n          <div className=\"bg-gray-50 p-3 rounded-md border\">\r\n            <p className=\"font-medium\">{emailAddress}</p>\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Cambiar alias */}\r\n        <div>\r\n          <h3 className=\"text-md font-medium mb-2\">Personalizar direcci√≥n de correo</h3>\r\n          <p className=\"text-gray-600 mb-3\">\r\n            Puedes personalizar la parte inicial de tu direcci√≥n de correo para hacerla m√°s f√°cil de recordar.\r\n          </p>\r\n          \r\n          <form onSubmit={handleChangeAlias} className=\"space-y-3\">\r\n            <div>\r\n              <label htmlFor=\"email-alias\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                Nuevo alias de correo\r\n              </label>\r\n              <div className=\"flex\">\r\n                <input\r\n                  type=\"text\"\r\n                  id=\"email-alias\"\r\n                  value={newAlias}\r\n                  onChange={(e) => setNewAlias(e.target.value.toLowerCase())}\r\n                  className=\"flex-grow p-2 border rounded-l-md focus:ring-2 focus:ring-blue-500\"\r\n                  placeholder={emailAlias || \"tunombre\"}\r\n                />\r\n                <span className=\"bg-gray-100 p-2 border-r border-t border-b rounded-r-md flex items-center\">\r\n                  @lovenda.com\r\n                </span>\r\n              </div>\r\n              <p className=\"text-xs text-gray-500 mt-1\">\r\n                Solo letras min√∫sculas, n√∫meros y puntos. M√≠nimo 3 caracteres.\r\n              </p>\r\n            </div>\r\n            \r\n            {error && (\r\n              <div className=\"p-3 bg-red-50 border border-red-200 text-red-700 rounded-md flex items-start\">\r\n                <AlertTriangle size={16} className=\"mr-2 mt-0.5\" />\r\n                <p className=\"text-sm\">{error}</p>\r\n              </div>\r\n            )}\r\n            \r\n            {success && (\r\n              <div className=\"p-3 bg-green-50 border border-green-200 text-green-700 rounded-md flex items-start\">\r\n                <Check size={16} className=\"mr-2 mt-0.5\" />\r\n                <p className=\"text-sm\">¬°Tu direcci√≥n de correo ha sido actualizada con √©xito!</p>\r\n              </div>\r\n            )}\r\n            \r\n            <Button\r\n              type=\"submit\"\r\n              variant=\"default\"\r\n              disabled={loading || !newAlias}\r\n            >\r\n              {loading ? 'Actualizando...' : 'Actualizar direcci√≥n'}\r\n            </Button>\r\n          </form>\r\n        </div>\r\n        \r\n        {/* Opciones adicionales */}\r\n        <div>\r\n          <h3 className=\"text-md font-medium mb-2\">Preferencias de notificaci√≥n</h3>\r\n          \r\n          <div className=\"space-y-2\">\r\n            <div className=\"flex items-center\">\r\n              <input\r\n                type=\"checkbox\"\r\n                id=\"notify-new-email\"\r\n                defaultChecked={true}\r\n                className=\"w-4 h-4 text-blue-600 border-gray-300 rounded\"\r\n              />\r\n              <label htmlFor=\"notify-new-email\" className=\"ml-2 block text-sm text-gray-700\">\r\n                Notificarme cuando reciba nuevos correos\r\n              </label>\r\n            </div>\r\n            \r\n            <div className=\"flex items-center\">\r\n              <input\r\n                type=\"checkbox\"\r\n                id=\"notify-read\"\r\n                defaultChecked={true}\r\n                className=\"w-4 h-4 text-blue-600 border-gray-300 rounded\"\r\n              />\r\n              <label htmlFor=\"notify-read\" className=\"ml-2 block text-sm text-gray-700\">\r\n                Notificarme cuando mis correos sean le√≠dos\r\n              </label>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Gestor de etiquetas */}\r\n        <div className=\"mt-6 pt-6 border-t border-gray-200\">\r\n          <TagsManager />\r\n        </div>\r\n\r\n        {/* Vincular cuentas de boda */}\r\n        <div className=\"mt-6 pt-6 border-t border-gray-200\">\r\n          <WeddingAccountLink />\r\n        </div>\r\n      </div>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default EmailSettings;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\EmailSetupForm.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'userId' is defined but never used. Allowed unused args must match /^_/u.","line":10,"column":57,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":63}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Check, AlertCircle, Loader2 } from 'lucide-react';\r\nimport Button from '../ui/Button';\r\n\r\n/**\r\n * Componente para configurar el nombre de correo electr√≥nico de usuario\r\n * Permite seleccionar un nombre de usuario para el dominio @mywed360\r\n * Incluye validaci√≥n en tiempo real de disponibilidad\r\n */\r\nconst EmailSetupForm = ({ onSave, defaultUsername = '', userId }) => {\r\n  const [username, setUsername] = useState(defaultUsername);\r\n  const [availabilityStatus, setAvailabilityStatus] = useState('idle'); // 'idle', 'checking', 'available', 'unavailable'\r\n  const [error, setError] = useState('');\r\n  const [isSaving, setIsSaving] = useState(false);\r\n\r\n  // Funci√≥n para comprobar si un nombre de usuario est√° disponible\r\n  const checkAvailability = async (value) => {\r\n    if (!value) {\r\n      setAvailabilityStatus('idle');\r\n      return;\r\n    }\r\n\r\n    // Validar formato del nombre de usuario\r\n    const usernameRegex = /^[a-z0-9][a-z0-9._-]{2,29}$/i;\r\n    if (!usernameRegex.test(value)) {\r\n      setError('El nombre solo puede contener letras, n√∫meros, puntos, guiones y guiones bajos. M√≠nimo 3 caracteres.');\r\n      setAvailabilityStatus('unavailable');\r\n      return;\r\n    }\r\n\r\n    setAvailabilityStatus('checking');\r\n    setError('');\r\n    \r\n    try {\r\n      // En un entorno real, esto ser√≠a una llamada a la API\r\n      // En este ejemplo simulamos la llamada con un timeout\r\n      setTimeout(async () => {\r\n        // Simulamos que algunos nombres est√°n ocupados\r\n        const takenUsernames = ['admin', 'info', 'soporte', 'ayuda', 'contacto'];\r\n        const isAvailable = !takenUsernames.includes(value.toLowerCase());\r\n        \r\n        setAvailabilityStatus(isAvailable ? 'available' : 'unavailable');\r\n        if (!isAvailable) {\r\n          setError(`El nombre \"${value}\" ya est√° en uso. Por favor elige otro.`);\r\n        }\r\n      }, 800); // Simular delay de red\r\n    } catch (error) {\r\n      console.error(\"Error al comprobar disponibilidad:\", error);\r\n      setAvailabilityStatus('unavailable');\r\n      setError('Error al comprobar disponibilidad. Int√©ntalo de nuevo m√°s tarde.');\r\n    }\r\n  };\r\n\r\n  // Efecto para comprobar disponibilidad cuando el usuario escribe\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      checkAvailability(username);\r\n    }, 500); // Debounce de 500ms\r\n\r\n    return () => clearTimeout(timer);\r\n  }, [username]);\r\n\r\n  // Funci√≥n para guardar el nombre de correo\r\n  const handleSave = async () => {\r\n    if (availabilityStatus !== 'available') return;\r\n    \r\n    setIsSaving(true);\r\n    try {\r\n      // En un entorno real, esto ser√≠a una llamada a la API para guardar\r\n      // el nombre de correo asociado al usuario\r\n      await new Promise(resolve => setTimeout(resolve, 1000)); // Simulaci√≥n\r\n      \r\n      if (onSave) {\r\n        onSave(username);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error al guardar:\", error);\r\n      setError('Error al guardar. Int√©ntalo de nuevo m√°s tarde.');\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-5 bg-white border rounded-lg shadow-sm\">\r\n      <h2 className=\"text-xl font-semibold text-gray-800 mb-4\">\r\n        Configura tu correo electr√≥nico myWed360\r\n      </h2>\r\n      \r\n      <p className=\"text-gray-600 mb-5\">\r\n        Elige un nombre de usuario √∫nico para tu correo electr√≥nico myWed360. \r\n        Este ser√° tu correo oficial dentro de la plataforma.\r\n      </p>\r\n      \r\n      <div className=\"mb-4\">\r\n        <label htmlFor=\"email-username\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n          Tu direcci√≥n de correo:\r\n        </label>\r\n        \r\n        <div className=\"flex items-center\">\r\n          <input\r\n            id=\"email-username\"\r\n            type=\"text\"\r\n            value={username}\r\n            onChange={(e) => setUsername(e.target.value)}\r\n            className={`border px-3 py-2 rounded-l-md flex-1 focus:ring-2 focus:outline-none ${\r\n              availabilityStatus === 'available' \r\n                ? 'border-green-300 focus:border-green-500 focus:ring-green-200' \r\n                : availabilityStatus === 'unavailable'\r\n                  ? 'border-red-300 focus:border-red-500 focus:ring-red-200'\r\n                  : 'border-gray-300 focus:border-blue-500 focus:ring-blue-200'\r\n            }`}\r\n            placeholder=\"tunombre\"\r\n            aria-label=\"Nombre de usuario para correo\"\r\n            disabled={isSaving}\r\n          />\r\n          <div className=\"bg-gray-100 px-3 py-2 border-y border-r rounded-r-md text-gray-700 whitespace-nowrap\">\r\n            @mywed360\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"mt-2 min-h-[24px]\">\r\n          {availabilityStatus === 'checking' && (\r\n            <div className=\"flex items-center text-gray-500\">\r\n              <Loader2 size={16} className=\"animate-spin mr-2\" />\r\n              <span className=\"text-sm\">Comprobando disponibilidad...</span>\r\n            </div>\r\n          )}\r\n          \r\n          {availabilityStatus === 'available' && username && (\r\n            <div className=\"flex items-center text-green-600\">\r\n              <Check size={16} className=\"mr-2\" />\r\n              <span className=\"text-sm\">¬°Nombre disponible!</span>\r\n            </div>\r\n          )}\r\n          \r\n          {error && (\r\n            <div className=\"flex items-center text-red-600\">\r\n              <AlertCircle size={16} className=\"mr-2\" />\r\n              <span className=\"text-sm\">{error}</span>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n      \r\n      <div className=\"flex justify-end mt-6\">\r\n        <Button\r\n          onClick={handleSave}\r\n          disabled={availabilityStatus !== 'available' || isSaving}\r\n          className=\"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md\"\r\n        >\r\n          {isSaving ? (\r\n            <>\r\n              <Loader2 size={16} className=\"animate-spin mr-2\" />\r\n              Guardando...\r\n            </>\r\n          ) : (\r\n            'Guardar direcci√≥n de correo'\r\n          )}\r\n        </Button>\r\n      </div>\r\n      \r\n      <div className=\"mt-4 text-sm text-gray-500\">\r\n        <p>Notas:</p>\r\n        <ul className=\"list-disc pl-5 space-y-1 mt-1\">\r\n          <li>Tu direcci√≥n de correo ser√° <strong>{username || 'tunombre'}@mywed360</strong></li>\r\n          <li>Podr√°s enviar y recibir correos desde esta direcci√≥n</li>\r\n          <li>Este correo se utilizar√° para todas las comunicaciones con proveedores</li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EmailSetupForm;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\EmailStats.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\EmailTagsManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Tag' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'Check' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":29},{"ruleId":"no-unused-vars","severity":1,"message":"'Button' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'ensureNotPromise' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":38},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":47,"column":18,"nodeType":"BlockStatement","messageId":"unexpected","endLine":47,"endColumn":20,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1572,1572],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":57,"column":18,"nodeType":"BlockStatement","messageId":"unexpected","endLine":57,"endColumn":20,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1911,1911],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":83,"column":18,"nodeType":"BlockStatement","messageId":"unexpected","endLine":83,"endColumn":20,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2645,2645],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":93,"column":18,"nodeType":"BlockStatement","messageId":"unexpected","endLine":93,"endColumn":20,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2959,2959],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Tag, X, Plus, Check } from 'lucide-react';\r\nimport Button from '../Button';\r\nimport { useAuth } from '../../hooks/useAuthUnified';\r\nimport { \r\n  getUserTags, \r\n  getEmailTagsDetails, \r\n  addTagToEmail, \r\n  removeTagFromEmail \r\n} from '../../services/tagService';\r\nimport { safeRender, ensureNotPromise, safeMap } from '../../utils/promiseSafeRenderer';\r\n\r\n/**\r\n * Componente para gestionar etiquetas de un correo electr√≥nico\r\n */\r\nconst EmailTagsManager = ({ emailId, onTagsChange }) => {\r\n  const [tags, setTags] = useState([]);\r\n  const [allTags, setAllTags] = useState([]);\r\n  const [isSelectingTag, setIsSelectingTag] = useState(false);\r\n  const { currentUser } = useAuth();\r\n  \r\n  // Cargar etiquetas del correo y todas las disponibles\r\n  useEffect(() => {\r\n    if (!currentUser || !emailId) return;\r\n    \r\n    // Obtener todas las etiquetas disponibles\r\n    const availableTags = getUserTags(currentUser.uid);\r\n    setAllTags(availableTags);\r\n    \r\n    // Obtener etiquetas del correo\r\n    const emailTags = getEmailTagsDetails(currentUser.uid, emailId);\r\n    setTags(emailTags);\r\n  }, [currentUser, emailId]);\r\n  \r\n  // A√±adir etiqueta al correo\r\n  const handleAddTag = async (tagId) => {\r\n    if (!currentUser || !emailId) return;\r\n    \r\n    try {\r\n      // Llamar a backend\r\n      try {\r\n        await fetch(`/api/email/${emailId}/tag`, {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ tagId })\r\n        });\r\n      } catch(_) {}\r\n\r\n      // Sincronizar - obtener detalles actualizados del correo\r\n      let updatedTags = [];\r\n      try {\r\n        const res = await fetch(`/api/email/${emailId}`);\r\n        if (res.ok) {\r\n          const json = await res.json();\r\n          updatedTags = json.data?.tagsDetails || json.data?.tags || [];\r\n        }\r\n      } catch(_) {}\r\n      // Fallback local\r\n      if (updatedTags.length === 0) {\r\n        addTagToEmail(currentUser.uid, emailId, tagId);\r\n        updatedTags = getEmailTagsDetails(currentUser.uid, emailId);\r\n      }\r\n      setTags(updatedTags);\r\n      setIsSelectingTag(false);\r\n      if (onTagsChange) {\r\n        onTagsChange(updatedTags);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al a√±adir etiqueta:', error);\r\n    }\r\n  };\r\n  \r\n  // Quitar etiqueta del correo\r\n  const handleRemoveTag = async (tagId) => {\r\n    if (!currentUser || !emailId) return;\r\n    \r\n    try {\r\n      // Llamar a backend\r\n      try {\r\n        await fetch(`/api/email/${emailId}/tag/${tagId}`, {\r\n          method: 'DELETE'\r\n        });\r\n      } catch(_) {}\r\n\r\n      // Obtener detalles actualizados\r\n      let updatedTags = [];\r\n      try {\r\n        const res = await fetch(`/api/email/${emailId}`);\r\n        if (res.ok) {\r\n          const json = await res.json();\r\n          updatedTags = json.data?.tagsDetails || json.data?.tags || [];\r\n        }\r\n      } catch(_) {}\r\n      if (updatedTags.length === 0) {\r\n        removeTagFromEmail(currentUser.uid, emailId, tagId);\r\n        updatedTags = getEmailTagsDetails(currentUser.uid, emailId);\r\n      }\r\n      setTags(updatedTags);\r\n      if (onTagsChange) {\r\n        onTagsChange(updatedTags);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al quitar etiqueta:', error);\r\n    }\r\n  };\r\n  \r\n  return (\r\n    <div className=\"mt-2\">\r\n      {/* Etiquetas actuales */}\r\n      <div className=\"flex flex-wrap gap-2 mb-2\">\r\n        {safeMap(tags).map((tag) => (\r\n          <div \r\n            key={safeRender(tag.id, '')}\r\n            className=\"inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium\"\r\n            data-testid=\"email-tag\"\r\n            style={{ \r\n              backgroundColor: `${safeRender(tag.color, '#64748b')}20`,\r\n              color: safeRender(tag.color, '#64748b'),\r\n              borderColor: `${safeRender(tag.color, '#64748b')}50`,\r\n              borderWidth: '1px'\r\n            }}\r\n          >\r\n            <span>{safeRender(tag.name, '')}</span>\r\n            <button \r\n              onClick={() => handleRemoveTag(safeRender(tag.id, ''))}\r\n              className=\"ml-1 rounded-full hover:bg-opacity-20 hover:bg-gray-600 remove-tag-button\"\r\n              data-testid=\"remove-tag-button\"\r\n            >\r\n              <X size={12} />\r\n            </button>\r\n          </div>\r\n        ))}\r\n        \r\n        {/* Bot√≥n para a√±adir etiqueta */}\r\n        {!isSelectingTag ? (\r\n          <button \r\n            onClick={() => setIsSelectingTag(true)}\r\n            data-testid=\"tag-menu-button\"\r\n            className=\"inline-flex items-center rounded-full border border-dashed border-gray-300 px-2.5 py-0.5 text-xs text-gray-500 hover:border-gray-400 hover:bg-gray-50\"\r\n          >\r\n            <Plus size={12} className=\"mr-1\" /> \r\n            A√±adir etiqueta\r\n          </button>\r\n        ) : (\r\n          <button \r\n            onClick={() => setIsSelectingTag(false)}\r\n            data-testid=\"tag-menu-button\"\r\n            className=\"inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs text-gray-700\"\r\n          >\r\n            <X size={12} className=\"mr-1\" /> \r\n            Cancelar\r\n          </button>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Selector de etiquetas */}\r\n      {isSelectingTag && (\r\n        <div className=\"mt-1 p-2 border rounded-md bg-white shadow-sm max-h-32 overflow-y-auto\">\r\n          <div className=\"space-y-1\">\r\n            {safeMap(allTags)\r\n              .filter(tag => !safeMap(tags).some(t => safeRender(t.id, '') === safeRender(tag.id, '')))\r\n              .map(tag => (\r\n                <div\r\n                  key={safeRender(tag.id, '')}\r\n                  onClick={() => handleAddTag(safeRender(tag.id, ''))}\r\n                  data-testid=\"tag-option\"\r\n                  className=\"flex items-center px-2 py-1 rounded hover:bg-gray-100 cursor-pointer\"\r\n                >\r\n                  <div \r\n                    className=\"w-3 h-3 rounded-full mr-2\"\r\n                    style={{ backgroundColor: safeRender(tag.color, '#64748b') }}\r\n                  />\r\n                  <span className=\"text-sm\">{safeRender(tag.name, '')}</span>\r\n                </div>\r\n              ))}\r\n              \r\n            {allTags.filter(tag => !tags.some(t => t.id === tag.id)).length === 0 && (\r\n              <div className=\"text-center py-2 text-xs text-gray-500\">\r\n                No hay m√°s etiquetas disponibles\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EmailTagsManager;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\EmailTemplateManager.jsx","messages":[{"ruleId":null,"fatal":true,"severity":2,"message":"Parsing error: Identifier 'uncategorized' has already been declared","line":471,"column":9,"nodeType":null}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { ChevronDown, Edit, Trash, Plus, Save, Copy, AlertCircle, RefreshCw, Search, ChevronLeft, ChevronRight, Zap } from 'lucide-react';\r\nimport Button from '../Button';\r\nimport Card from '../Card';\r\nimport * as EmailService from '../../services/EmailService';\r\nimport templateCache from '../../services/TemplateCacheService';\r\nimport { useMediaQuery } from '../../hooks/useMediaQuery';\r\nimport useEmailMonitoring from '../../hooks/useEmailMonitoring';\r\n\r\n/**\r\n * Componente para gestionar plantillas de email personalizadas\r\n * Permite crear, editar, eliminar y utilizar plantillas predefinidas para diferentes tipos de comunicaci√≥n\r\n * \r\n * @param {Object} props - Propiedades del componente\r\n * @param {Function} props.onSelectTemplate - Funci√≥n llamada al seleccionar una plantilla\r\n * @param {Function} props.onClose - Funci√≥n para cerrar el gestor de plantillas\r\n * @returns {React.ReactElement} Gestor de plantillas de email\r\n */\r\nconst EmailTemplateManager = ({ onSelectTemplate, onClose }) => {\r\n  const [templates, setTemplates] = useState([]);\r\n  const [filteredTemplates, setFilteredTemplates] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const [editingTemplate, setEditingTemplate] = useState(null);\r\n  const [editMode, setEditMode] = useState(false);\r\n  const [success, setSuccess] = useState('');\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  \r\n  // Inicializar hook de monitoreo\r\n  const {\r\n    trackTemplateUsage,\r\n    trackTemplateSearch,\r\n    logEmailError,\r\n    measureTemplateRendering\r\n  } = useEmailMonitoring();\r\n  \r\n  // Paginaci√≥n\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [templatesPerPage, setTemplatesPerPage] = useState(10);\r\n  \r\n  // Detectar dispositivos m√≥viles\r\n  const isMobile = useMediaQuery('(max-width: 768px)');\r\n  \r\n  // Ajustar elementos por p√°gina basado en el tama√±o de pantalla\r\n  useEffect(() => {\r\n    if (isMobile) {\r\n      setTemplatesPerPage(5);\r\n    } else {\r\n      setTemplatesPerPage(10);\r\n    }\r\n  }, [isMobile]);\r\n  \r\n  // Categor√≠as ordenadas para mostrar en el gestor\r\n  const [categories] = useState([\r\n    'Proveedores - Solicitud de informaci√≥n',\r\n    'Proveedores - Confirmaci√≥n',\r\n    'Proveedores - Cancelaci√≥n',\r\n    'Proveedores - Seguimiento',\r\n    'Invitados - Informaci√≥n',\r\n    'Invitados - Recordatorio',\r\n    'Seguimiento',\r\n    'General'\r\n  ]);\r\n  \r\n  // Estado para controlar categor√≠as expandidas\r\n  const [expandedCategories, setExpandedCategories] = useState({});\r\n  \r\n  // Estado para saber si se est√° usando cach√©\r\n  const [usingCache, setUsingCache] = useState(false);\r\n  const [cacheStats, setCacheStats] = useState({\r\n    hits: 0,\r\n    misses: 0\r\n  });\r\n  \r\n  // Cargar plantillas existentes\r\n  const loadTemplates = async (bypassCache = false) => {\r\n    setLoading(true);\r\n    setError('');\r\n    setSuccess('');\r\n    \r\n    try {\r\n      // Iniciar medici√≥n de tiempo\r\n      const startTime = performance.now();\r\n      \r\n      // Usar el hook de monitoreo para trackear la operaci√≥n\r\n      const templateList = await trackTemplateUsage(\r\n        'all', // templateId\r\n        'all', // category\r\n        'load', // action\r\n        async () => {\r\n          // Obtener plantillas con o sin cach√© seg√∫n el par√°metro\r\n          return await EmailService.getEmailTemplates(bypassCache);\r\n        },\r\n        { operation: 'loadAll', bypassCache }\r\n      );\r\n      \r\n      // Finalizar medici√≥n de tiempo\r\n      const endTime = performance.now();\r\n      const loadTime = Math.round(endTime - startTime);\r\n      \r\n      // Actualizar estado de cach√©\r\n      setUsingCache(!bypassCache);\r\n      \r\n      // Registrar rendimiento\r\n      measureTemplateRendering('load', loadTime, {\r\n        count: templateList?.length || 0,\r\n        fromCache: !bypassCache\r\n      });\r\n      \r\n      // Registrar estad√≠sticas\r\n      if (!bypassCache) {\r\n        setCacheStats(prevStats => ({\r\n          hits: prevStats.hits + 1,\r\n          misses: prevStats.misses\r\n        }));\r\n      } else {\r\n        setCacheStats(prevStats => ({\r\n          hits: prevStats.hits,\r\n          misses: prevStats.misses + 1\r\n        }));\r\n      }\r\n      \r\n      setTemplates(templateList || []);\r\n    } catch (err) {\r\n      logEmailError('template_load', err, { operation: 'loadTemplates', bypassCache });\r\n      console.error('Error al cargar plantillas:', err);\r\n      setError('No se pudieron cargar las plantillas');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n  \r\n  // Funci√≥n para recargar plantillas ignorando la cach√©\r\n  const refreshTemplates = () => {\r\n    loadTemplates(true);\r\n  };\r\n  \r\n  // Cargar plantillas al iniciar el componente\r\n  useEffect(() => {    \r\n    loadTemplates();\r\n  }, []);\r\n  \r\n  // Filtrar plantillas basado en t√©rmino de b√∫squeda\r\n  useEffect(() => {\r\n    if (!searchTerm.trim()) {\r\n      setFilteredTemplates(templates);\r\n      return;\r\n    }\r\n    \r\n    // Usar trackTemplateSearch para monitorear la b√∫squeda de plantillas\r\n    trackTemplateSearch(searchTerm, 'all', () => {\r\n      const lowercasedSearch = searchTerm.toLowerCase();\r\n      const filtered = templates.filter(template => \r\n        template.name.toLowerCase().includes(lowercasedSearch) || \r\n        template.category.toLowerCase().includes(lowercasedSearch) ||\r\n        template.subject.toLowerCase().includes(lowercasedSearch) ||\r\n        template.body.toLowerCase().includes(lowercasedSearch)\r\n      );\r\n      \r\n      setFilteredTemplates(filtered);\r\n      setCurrentPage(1); // Reiniciar a primera p√°gina al buscar\r\n      \r\n      return filtered;\r\n    });\r\n  }, [searchTerm, templates, trackTemplateSearch]);\r\n  \r\n  // Calcular plantillas para la p√°gina actual\r\n  const currentTemplates = useMemo(() => {\r\n    const indexOfLastTemplate = currentPage * templatesPerPage;\r\n    const indexOfFirstTemplate = indexOfLastTemplate - templatesPerPage;\r\n    return filteredTemplates.slice(indexOfFirstTemplate, indexOfLastTemplate);\r\n  }, [currentPage, templatesPerPage, filteredTemplates]);\r\n  \r\n  // Cambiar de p√°gina\r\n  const paginate = (pageNumber) => setCurrentPage(pageNumber);\r\n  \r\n  // Calcular n√∫mero total de p√°ginas\r\n  const totalPages = useMemo(() => {\r\n    return Math.ceil(filteredTemplates.length / templatesPerPage);\r\n  }, [filteredTemplates, templatesPerPage]);\r\n  \r\n  // Manejar cambios en campo de b√∫squeda\r\n  const handleSearchChange = useCallback((e) => {\r\n    setSearchTerm(e.target.value);\r\n  }, []);\r\n  \r\n  // Alternar expansi√≥n de categor√≠a\r\n  const toggleCategory = useCallback((category) => {\r\n    setExpandedCategories(prev => ({\r\n      ...prev,\r\n      [category]: !prev[category]\r\n    }));\r\n  }, []);\r\n  \r\n  // Funci√≥n para restablecer las plantillas predefinidas del sistema\r\n  const handleResetTemplates = async () => {\r\n    if (!window.confirm('¬øEst√°s seguro de que deseas restablecer todas las plantillas predefinidas? Esta acci√≥n no eliminar√° tus plantillas personalizadas.')) {\r\n      return;\r\n    }\r\n    \r\n    setLoading(true);\r\n    setError('');\r\n    \r\n    try {\r\n      const restoredTemplates = await EmailService.resetPredefinedTemplates();\r\n      setTemplates(restoredTemplates);\r\n      setSuccess('Se han restablecido correctamente las plantillas predefinidas');\r\n      \r\n      // Ocultar el mensaje de √©xito despu√©s de 5 segundos\r\n      setTimeout(() => {\r\n        setSuccess('');\r\n      }, 5000);\r\n    } catch (err) {\r\n      console.error('Error al restablecer plantillas predefinidas:', err);\r\n      setError('No se pudieron restablecer las plantillas predefinidas');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n  \r\n  // Configurar una plantilla nueva para edici√≥n\r\n  const handleCreateNew = () => {\r\n    setEditingTemplate({\r\n      id: `template_${Date.now()}`,\r\n      name: '',\r\n      category: 'Proveedores - Solicitud de informaci√≥n',\r\n      subject: '',\r\n      body: '',\r\n      isSystem: false,\r\n      variables: []\r\n    });\r\n    setEditMode(true);\r\n  };\r\n  \r\n  // Configurar una plantilla existente para edici√≥n\r\n  const handleEdit = (template) => {\r\n    setEditingTemplate({ ...template });\r\n    setEditMode(true);\r\n  };\r\n  \r\n  // Duplicar una plantilla existente\r\n  const handleDuplicate = (template) => {\r\n    setEditingTemplate({\r\n      ...template,\r\n      id: `template_${Date.now()}`,\r\n      name: `${template.name} (Copia)`,\r\n      isSystem: false\r\n    });\r\n    setEditMode(true);\r\n  };\r\n  \r\n  // Eliminar una plantilla\r\n  const handleDelete = async (templateId) => {\r\n    if (window.confirm('¬øEst√°s seguro de que deseas eliminar esta plantilla?')) {\r\n      try {\r\n        await EmailService.deleteEmailTemplate(templateId);\r\n        \r\n        setTemplates(prev => prev.filter(t => t.id !== templateId));\r\n      } catch (err) {\r\n        console.error('Error al eliminar plantilla:', err);\r\n        setError('No se pudo eliminar la plantilla');\r\n      }\r\n    }\r\n  };\r\n  \r\n  // Manejar cambios en el formulario de edici√≥n\r\n  const handleFormChange = (e) => {\r\n    const { name, value } = e.target;\r\n    setEditingTemplate(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n  };\r\n  \r\n  // Detectar variables en el contenido del email\r\n  const detectVariables = (content) => {\r\n    const regex = /\\{\\{([^}]+)\\}\\}/g;\r\n    const variables = new Set();\r\n    let match;\r\n    \r\n    while ((match = regex.exec(content)) !== null) {\r\n      variables.add(match[1].trim());\r\n    }\r\n    \r\n  // Guardar una plantilla (nueva o editada)\r\n  const handleSaveTemplate = async () => {\r\n    if (!editingTemplate?.subject || !editingTemplate?.body) {\r\n      setError('El asunto y el cuerpo de la plantilla son obligatorios');\r\n      return;\r\n    }\r\n    \r\n    setError('');\r\n    setLoading(true);\r\n    \r\n    try {\r\n      // Medir tiempo de renderizado para el monitor de rendimiento\r\n      const renderStart = performance.now();\r\n      \r\n      // Detectar variables en contenido\r\n      const variables = detectVariables(editingTemplate.body);\r\n      \r\n      // Preparar plantilla con fecha y variables\r\n      const templateToSave = {\r\n        ...editingTemplate,\r\n        variables,\r\n        lastUpdated: new Date().toISOString()\r\n      };\r\n      \r\n      // Si es una plantilla nueva, generar ID √∫nico\r\n      if (!templateToSave.id) {\r\n        templateToSave.id = `template_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n      }\r\n      \r\n      // Guardar mediante el servicio\r\n      const savedTemplate = await trackTemplateUsage(\r\n        templateToSave.id,\r\n        templateToSave.category || 'Sin categor√≠a',\r\n        'save',\r\n        async () => EmailService.saveEmailTemplate(templateToSave),\r\n        { operation: 'saveTemplate' }\r\n      );\r\n      \r\n      // Medir tiempo de guardado\r\n      const renderEnd = performance.now();\r\n      measureTemplateRendering('save', renderEnd - renderStart, { template: templateToSave.id });\r\n      \r\n      // Actualizar la lista de plantillas\r\n      await loadTemplates(true); // Forzar actualizaci√≥n ignorando cach√©\r\n      \r\n      // Registrar uso de la plantilla para mejorar precarga\r\n      if (savedTemplate && savedTemplate.category) {\r\n        templateCache.registerTemplateUsage(savedTemplate.id, savedTemplate.category);\r\n      }\r\n      \r\n      setSuccess('Plantilla guardada correctamente');\r\n      setEditMode(false);\r\n      setEditingTemplate(null);\r\n    } catch (err) {\r\n      logEmailError('template_save', err, { templateId: editingTemplate?.id });\r\n      console.error('Error al guardar plantilla:', err);\r\n      setError('No se pudo guardar la plantilla');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Usar una plantilla\r\n  const handleUseTemplate = (template) => {\r\n    // Monitorear el uso de la plantilla\r\n    trackTemplateUsage(\r\n      template.id, \r\n      template.category || 'Sin categor√≠a', \r\n      'use', \r\n      async () => {\r\n        // Registrar uso en la cach√© para mejorar precarga\r\n        templateCache.registerTemplateUsage(template.id, template.category || 'Sin categor√≠a');\r\n        \r\n        // Guardar en cach√© para acceso r√°pido\r\n        templateCache.cacheTemplate(template);\r\n        \r\n        if (onSelectTemplate) {\r\n          onSelectTemplate(template);\r\n        }\r\n        if (onClose) {\r\n          onClose();\r\n        }\r\n      },\r\n      { operation: 'useTemplate' }\r\n    );\r\n  };\r\n  \r\n  // Modo de visualizaci√≥n de plantillas\r\n  const renderTemplateList = () => {\r\n    if (loading) {\r\n      return <div className=\"text-center py-8\">Cargando plantillas...</div>;\r\n    }\r\n    \r\n    if (templates.length === 0) {\r\n      return (\r\n        <div className=\"text-center py-8 text-gray-500\">\r\n          No hay plantillas disponibles. \r\n          <div className=\"flex justify-center space-x-4 mt-4\">\r\n            <button \r\n              onClick={handleCreateNew}\r\n              className=\"text-blue-500 hover:underline\"\r\n            >\r\n              Crear una nueva\r\n            </button>\r\n            <button \r\n              onClick={handleResetTemplates}\r\n              className=\"text-blue-500 hover:underline\"\r\n            >\r\n              Restablecer plantillas predefinidas\r\n            </button>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n    \r\n    // Si hay b√∫squeda pero no hay resultados\r\n    if (searchTerm && filteredTemplates.length === 0) {\r\n      return (\r\n        <div className=\"text-center py-8 text-gray-500\">\r\n          No se encontraron plantillas que coincidan con \"{searchTerm}\".\r\n          <div className=\"mt-4\">\r\n            <button \r\n              onClick={() => setSearchTerm('')}\r\n              className=\"text-blue-500 hover:underline\"\r\n            >\r\n              Limpiar b√∫squeda\r\n            </button>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n    \r\n    // Agrupar plantillas por categor√≠a\r\n    var groupedTemplates = {};\r\n    categories.forEach(category => {\r\n      groupedTemplates[category] = templates.filter(t => t.category === category);\r\n    });\r\n    \r\n    // Plantillas sin categor√≠a\r\n    const uncategorized = templates.filter(t => !categories.includes(t.category));\r\n    if (uncategorized.length > 0) {\r\n    return (\r\n      <div className=\"text-center py-8 text-gray-500\">\r\n        No hay plantillas disponibles. \r\n        <div className=\"flex justify-center space-x-4 mt-4\">\r\n          <button \r\n            onClick={handleCreateNew}\r\n            className=\"text-blue-500 hover:underline\"\r\n          >\r\n            Crear una nueva\r\n          </button>\r\n          <button \r\n            onClick={handleResetTemplates}\r\n            className=\"text-blue-500 hover:underline\"\r\n          >\r\n            Restablecer plantillas predefinidas\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  // Si hay b√∫squeda pero no hay resultados\r\n  if (searchTerm && filteredTemplates.length === 0) {\r\n    return (\r\n      <div className=\"text-center py-8 text-gray-500\">\r\n        No se encontraron plantillas que coincidan con \"{searchTerm}\".\r\n        <div className=\"mt-4\">\r\n          <button \r\n            onClick={() => setSearchTerm('')}\r\n            className=\"text-blue-500 hover:underline\"\r\n          >\r\n            Limpiar b√∫squeda\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  // Agrupar plantillas por categor√≠a\r\n  var groupedTemplates = {};\r\n  categories.forEach(category => {\r\n    groupedTemplates[category] = templates.filter(t => t.category === category);\r\n  });\r\n  \r\n  // Plantillas sin categor√≠a\r\n  const uncategorized = templates.filter(t => !categories.includes(t.category));\r\n  if (uncategorized.length > 0) {\r\n    groupedTemplates['Otras'] = uncategorized;\r\n  }\r\n  \r\n  return editMode ? renderTemplateEditor() : (\r\n    <div className=\"space-y-4\">\r\n      {/* Barra superior con b√∫squeda y estado de cach√© */}\r\n      <div className=\"flex flex-col sm:flex-row items-center mb-6 gap-2\">\r\n        <div className=\"relative flex-grow\">\r\n          <div className=\"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none\">\r\n            <Search className=\"w-4 h-4 text-gray-500\" />\r\n          </div>\r\n          <input\r\n            type=\"text\"\r\n            className=\"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5\"\r\n            placeholder=\"Buscar plantillas...\"\r\n            value={searchTerm}\r\n            onChange={e => setSearchTerm(e.target.value)}\r\n          />\r\n        </div>\r\n        \r\n        {/* Indicador de cach√© y bot√≥n de recarga */}\r\n        <div className=\"flex items-center gap-2\">\r\n          {usingCache && (\r\n            <div className=\"text-xs flex items-center gap-1 text-blue-600 bg-blue-50 px-2 py-1 rounded\">\r\n              <Zap className=\"w-3 h-3\" /> \r\n              <span>Cach√© activa</span>\r\n            </div>\r\n          )}\r\n          <Button \r\n            size=\"sm\" \r\n            variant=\"secondary\" \r\n            onClick={refreshTemplates} \r\n            title=\"Recargar plantillas (ignorar cach√©)\"\r\n            className=\"flex items-center gap-1\"\r\n          >\r\n            <RefreshCw className=\"w-3 h-3\" /> \r\n            <span className=\"hidden sm:inline\">Recargar</span>\r\n          </Button>\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Estad√≠sticas de cach√© */}\r\n      {(cacheStats.hits > 0 || cacheStats.misses > 0) && (\r\n        <div className=\"mb-4 text-xs text-gray-500 flex flex-wrap items-center gap-2 bg-gray-50 p-2 rounded\">\r\n          <div>Rendimiento de cach√©:</div>\r\n          <div className=\"flex items-center gap-1\">\r\n            <span className=\"font-medium text-green-600\">{cacheStats.hits}</span> aciertos\r\n          </div>\r\n          <div className=\"flex items-center gap-1\">\r\n            <span className=\"font-medium text-amber-600\">{cacheStats.misses}</span> fallos\r\n          </div>\r\n          {cacheStats.hits > 0 && (\r\n            <div className=\"text-xs\">\r\n              <span className=\"font-medium text-blue-600\">\r\n                {Math.round((cacheStats.hits / (cacheStats.hits + cacheStats.misses)) * 100)}%\r\n              </span> efectividad\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n      \r\n      {/* Lista de plantillas por categor√≠a */}\r\n      {categories.map(category => {\r\n        // Filtrar plantillas por categor√≠a (usando la lista filtrada si hay b√∫squeda)\r\n        const categoryTemplates = currentTemplates.filter(t => t.category === category);\r\n        \r\n        if (categoryTemplates.length === 0) return null;\r\n        \r\n        const isExpanded = expandedCategories[category] !== false; // Por defecto expandido\r\n        \r\n        return (\r\n          <div key={category} className=\"border rounded-lg overflow-hidden shadow-sm\">\r\n            <div \r\n              className=\"bg-gray-100 p-3 cursor-pointer flex justify-between items-center transition-colors hover:bg-gray-200\"\r\n              onClick={() => toggleCategory(category)}\r\n            >\r\n              <h3 className=\"font-medium\">{category}</h3>\r\n              <ChevronDown \r\n                size={18} \r\n                className={`transform transition-transform ${isExpanded ? 'rotate-180' : ''}`}\r\n              />\r\n            </div>\r\n            \r\n            {isExpanded && (\r\n              <div className=\"divide-y\">\r\n                {categoryTemplates.map(template => (\r\n                  <div key={template.id} className=\"p-3 hover:bg-gray-50 transition-colors\">\r\n                    <div className=\"flex justify-between items-start\">\r\n                      <div className={isMobile ? \"w-2/3\" : \"w-3/4\"}>\r\n                        <h4 className=\"font-medium truncate\">{template.name}</h4>\r\n                        <p className=\"text-sm text-gray-500 truncate\">{template.subject}</p>\r\n                      </div>\r\n                      \r\n                      <div className={`flex ${isMobile ? 'flex-col space-y-2' : 'space-x-2'}`}>\r\n                        <button \r\n                          onClick={() => handleSelect(template)}\r\n                          className=\"p-1 text-blue-500 hover:bg-blue-50 rounded\"\r\n                          title=\"Usar esta plantilla\"\r\n                        >\r\n                          <Copy size={isMobile ? 14 : 16} />\r\n                        </button>\r\n                        \r\n                        <button \r\n                          onClick={() => handleEdit(template)}\r\n                          className=\"p-1 text-green-500 hover:bg-green-50 rounded\"\r\n                          title=\"Editar plantilla\"\r\n                        >\r\n                          <Edit size={isMobile ? 14 : 16} />\r\n                        </button>\r\n                        \r\n                        {!template.isSystem && (\r\n                          <button \r\n                            onClick={() => handleDelete(template.id)}\r\n                            className=\"p-1 text-red-500 hover:bg-red-50 rounded\"\r\n                            title=\"Eliminar plantilla\"\r\n                    <div className=\"mt-1 text-sm text-gray-600\">\r\n                      Asunto: {template.subject}\r\n                    </div>\r\n                    {template.variables.length > 0 && (\r\n                      <div className=\"mt-2 flex flex-wrap gap-1\">\r\n                        {template.variables.map(variable => (\r\n                          <span \r\n                            key={variable} \r\n                            className=\"text-xs bg-blue-50 text-blue-700 px-2 py-0.5 rounded\"\r\n                          >\r\n                            {variable}\r\n                          </span>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    );\r\n  };\r\n  \r\n  // Modo de edici√≥n de plantilla\r\n  const renderTemplateEditor = () => {\r\n    return (\r\n      <div className=\"space-y-4\">\r\n        {error && (\r\n          <div className=\"p-3 bg-red-50 border border-red-200 rounded-md flex items-center text-red-700\">\r\n            <AlertCircle size={18} className=\"flex-shrink-0 mr-2\" />\r\n            <span>{error}</span>\r\n          </div>\r\n        )}\r\n        \r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">Nombre de la plantilla:</label>\r\n          <input\r\n            type=\"text\"\r\n            name=\"name\"\r\n            value={editingTemplate.name}\r\n            onChange={handleFormChange}\r\n            className=\"w-full border border-gray-300 rounded-md p-2\"\r\n            placeholder=\"Ej: Solicitud de presupuesto\"\r\n          />\r\n        </div>\r\n        \r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">Categor√≠a:</label>\r\n          <div className=\"relative\">\r\n            <select\r\n              name=\"category\"\r\n              value={editingTemplate.category}\r\n              onChange={handleFormChange}\r\n              className=\"w-full border border-gray-300 rounded-md p-2 pr-8 appearance-none\"\r\n            >\r\n              {categories.map(category => (\r\n                <option key={category} value={category}>{category}</option>\r\n              ))}\r\n            </select>\r\n            <ChevronDown size={16} className=\"absolute right-2 top-3 pointer-events-none text-gray-500\" />\r\n          </div>\r\n        </div>\r\n        \r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">Asunto:</label>\r\n          <input\r\n            type=\"text\"\r\n            name=\"subject\"\r\n            value={editingTemplate.subject}\r\n            onChange={handleFormChange}\r\n            className=\"w-full border border-gray-300 rounded-md p-2\"\r\n            placeholder=\"Ej: Solicitud de informaci√≥n para {{servicio}}\"\r\n          />\r\n        </div>\r\n        \r\n        <div>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">Contenido del email:</label>\r\n          <textarea\r\n            name=\"body\"\r\n            value={editingTemplate.body}\r\n            onChange={handleFormChange}\r\n            className=\"w-full border border-gray-300 rounded-md p-2\"\r\n            rows=\"10\"\r\n            placeholder=\"Escribe el contenido de la plantilla aqu√≠...\"\r\n          ></textarea>\r\n          <p className=\"text-xs text-gray-500 mt-1\">\r\n            Usa {{variable}} para crear campos din√°micos (ej: {{nombre_proveedor}}, {{fecha_boda}})\r\n          </p>\r\n        </div>\r\n        \r\n        <div className=\"flex justify-end space-x-3\">\r\n          <Button\r\n            variant=\"outline\"\r\n            onClick={handleCancelEdit}\r\n          >\r\n            Cancelar\r\n          </Button>\r\n          <Button\r\n            onClick={handleSaveTemplate}\r\n            className=\"flex items-center\"\r\n          >\r\n            <Save size={18} className=\"mr-1\" />\r\n            Guardar plantilla\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n  \r\n  return (\r\n    <div className=\"p-4\">\r\n      <div className=\"flex flex-col sm:flex-row justify-between items-center mb-4\">\r\n        <h2 className=\"text-xl font-bold mb-2 sm:mb-0\">Plantillas de email</h2>\r\n        {!editMode && (\r\n          <div className={`flex ${isMobile ? 'w-full justify-between' : 'space-x-2'}`}>\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={handleResetTemplates}\r\n              className=\"flex items-center\"\r\n              title=\"Restablecer plantillas predefinidas\"\r\n              size={isMobile ? \"sm\" : \"md\"}\r\n            >\r\n              <RefreshCw size={isMobile ? 14 : 16} className=\"mr-1\" />\r\n              {isMobile ? \"Restablecer\" : \"Restablecer plantillas\"}\r\n            </Button>\r\n            <Button\r\n              onClick={handleCreateNew}\r\n              className=\"flex items-center\"\r\n              size={isMobile ? \"sm\" : \"md\"}\r\n            >\r\n              <Plus size={isMobile ? 14 : 16} className=\"mr-1\" />\r\n              {isMobile ? \"Nueva\" : \"Nueva plantilla\"}\r\n            </Button>\r\n          </div>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Mensajes de estado */}\r\n      {error && (\r\n        <div className=\"p-3 bg-red-50 border border-red-200 rounded-md flex items-center text-red-700 mb-4\">\r\n          <AlertCircle size={18} className=\"flex-shrink-0 mr-2\" />\r\n          <span>{error}</span>\r\n        </div>\r\n      )}\r\n      \r\n      {success && (\r\n        <div className=\"p-3 bg-green-50 border border-green-200 rounded-md flex items-center text-green-700 mb-4\">\r\n          <span>{success}</span>\r\n        </div>\r\n      )}\r\n      \r\n      {editMode ? renderTemplateEditor() : renderTemplateList()}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EmailTemplateManager;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\EmailView.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\EmailViewer.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'emailService' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'EmailService' is not defined.","line":29,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":29,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'safeExecute' is not defined.","line":157,"column":46,"nodeType":"Identifier","messageId":"undef","endLine":157,"endColumn":57}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport sanitizeHtml from '../../utils/sanitizeHtml';\r\nimport { ArrowLeft, Trash, Star, StarOff, Reply, Forward, Paperclip, Calendar, Download } from 'lucide-react';\r\nimport Button from '../Button';\r\nimport Card from '../Card';\r\nimport * as emailService from '../../services/emailService';\r\n\r\n/**\r\n * Componente para visualizar el contenido completo de un email\r\n * con opciones para responder, reenviar, marcar como importante, etc.\r\n * \r\n * @param {Object} props - Propiedades del componente\r\n * @param {Object} props.email - Datos completos del email a visualizar\r\n * @param {Function} props.onBack - Funci√≥n para volver a la lista de emails\r\n * @param {Function} props.onDelete - Funci√≥n para eliminar el email\r\n * @param {Function} props.onReply - Funci√≥n para responder al email\r\n * @param {Function} props.onForward - Funci√≥n para reenviar el email\r\n * @param {Function} props.onToggleImportant - Funci√≥n para marcar/desmarcar como importante\r\n * @returns {React.ReactElement} Visor detallado del email\r\n */\r\nconst EmailViewer = ({ email, onBack, onDelete, onReply, onForward, onToggleImportant }) => {\r\n  const [showReplyForm, setShowReplyForm] = useState(false);\r\n  const [replyText, setReplyText] = useState('');\r\n  const isImportant = email?.folder === 'important';\r\n\r\n  // Marcar como le√≠do al visualizar\r\n  React.useEffect(() => {\r\n    if (email && !email.read) {\r\n      EmailService.markAsRead(email.id);\r\n    }\r\n  }, [email]);\r\n\r\n  // Formatear fecha completa\r\n  const formatDate = (dateStr) => {\r\n    if (!dateStr) return '';\r\n    const date = new Date(dateStr);\r\n    return date.toLocaleDateString('es-ES', {\r\n      weekday: 'long',\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  // Manejar env√≠o de respuesta\r\n  const handleSendReply = async () => {\r\n    if (!replyText.trim()) return;\r\n    \r\n    await onReply({\r\n      to: email.from,\r\n      subject: `Re: ${email.subject}`,\r\n      body: replyText,\r\n      replyToId: email.id\r\n    });\r\n    \r\n    setShowReplyForm(false);\r\n    setReplyText('');\r\n  };\r\n\r\n  // Si no hay email seleccionado\r\n  if (!email) {\r\n    return (\r\n      <Card className=\"h-full flex items-center justify-center\">\r\n        <p className=\"text-gray-500\">Selecciona un email para visualizarlo</p>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Card className=\"flex flex-col h-full\">\r\n      {/* Cabecera */}\r\n      <div className=\"border-b border-gray-200 p-4\">\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <Button\r\n            variant=\"ghost\"\r\n            size=\"sm\"\r\n            onClick={onBack}\r\n            className=\"flex items-center\"\r\n          >\r\n            <ArrowLeft size={18} className=\"mr-1\" />\r\n            Volver\r\n          </Button>\r\n\r\n          <div className=\"flex space-x-2\">\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              onClick={() => onToggleImportant(email.id, !isImportant)}\r\n              className=\"flex items-center\"\r\n              title={isImportant ? 'Quitar estrella' : 'Marcar con estrella'}\r\n            >\r\n              {isImportant ? (\r\n                <StarOff size={18} className=\"text-gray-600\" />\r\n              ) : (\r\n                <Star size={18} className=\"text-gray-600\" />\r\n              )}\r\n            </Button>\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              onClick={() => onReply(email)}\r\n              className=\"flex items-center\"\r\n              title=\"Responder\"\r\n            >\r\n              <Reply size={18} className=\"text-gray-600\" />\r\n            </Button>\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              onClick={() => onForward(email)}\r\n              className=\"flex items-center\"\r\n              title=\"Reenviar\"\r\n            >\r\n              <Forward size={18} className=\"text-gray-600\" />\r\n            </Button>\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              onClick={() => onDelete(email.id)}\r\n              className=\"flex items-center\"\r\n              title=\"Eliminar\"\r\n            >\r\n              <Trash size={18} className=\"text-gray-600\" />\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        <h1 className=\"text-xl font-semibold mb-2\">{email.subject || '(Sin asunto)'}</h1>\r\n        \r\n        <div className=\"flex flex-col sm:flex-row justify-between text-sm text-gray-600\">\r\n          <div>\r\n            <span className=\"font-medium\">De:</span> {email.from}\r\n          </div>\r\n          <div>\r\n            <span className=\"font-medium\">Fecha:</span> {formatDate(email.date)}\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"text-sm text-gray-600 mt-1\">\r\n          <span className=\"font-medium\">Para:</span> {email.to}\r\n        </div>\r\n        \r\n        {email.cc && (\r\n          <div className=\"text-sm text-gray-600 mt-1\">\r\n            <span className=\"font-medium\">CC:</span> {email.cc}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Cuerpo del email */}\r\n      <div className=\"p-4 flex-grow overflow-auto\">\r\n        {/* Renderizar el HTML del cuerpo del email */}\r\n        <div \r\n          className=\"prose max-w-none\"\r\n          dangerouslySetInnerHTML={{ __html: safeExecute(\r\n            () => {\r\n              const result = sanitizeHtml(email.body || '');\r\n              return typeof result === 'string' ? result : String(result || '');\r\n            },\r\n            email.body || '' // fallback si sanitizeHtml retorna una Promesa\r\n          ) }}\r\n        />\r\n      </div>\r\n\r\n      {/* Adjuntos si existen */}\r\n      {email.attachments && email.attachments.length > 0 && (\r\n        <div className=\"border-t border-gray-200 p-4\">\r\n          <h3 className=\"flex items-center text-sm font-medium mb-2\">\r\n            <Paperclip size={16} className=\"mr-1\" />\r\n            Adjuntos ({email.attachments.length})\r\n          </h3>\r\n          \r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2\">\r\n            {email.attachments.map((attachment, index) => (\r\n              <div \r\n                key={index}\r\n                className=\"border border-gray-200 rounded p-2 flex items-center\"\r\n              >\r\n                <div className=\"flex-grow truncate\">\r\n                  {attachment.name || `Archivo ${index + 1}`}\r\n                  <span className=\"text-xs text-gray-500 block\">\r\n                    {attachment.size ? `${Math.round(attachment.size / 1024)} KB` : ''}\r\n                  </span>\r\n                </div>\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"flex-shrink-0\"\r\n                  onClick={() => {/* L√≥gica de descarga */}}\r\n                >\r\n                  <Download size={16} />\r\n                </Button>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Formulario de respuesta r√°pida */}\r\n      {showReplyForm && (\r\n        <div className=\"border-t border-gray-200 p-4\">\r\n          <h3 className=\"font-medium mb-2 flex items-center\">\r\n            <Reply size={16} className=\"mr-1\" />\r\n            Responder\r\n          </h3>\r\n          \r\n          <textarea\r\n            value={replyText}\r\n            onChange={(e) => setReplyText(e.target.value)}\r\n            className=\"w-full border border-gray-300 rounded-md p-2 mb-2\"\r\n            rows=\"4\"\r\n            placeholder=\"Escribe tu respuesta aqu√≠...\"\r\n          ></textarea>\r\n          \r\n          <div className=\"flex justify-end space-x-2\">\r\n            <Button\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              onClick={() => setShowReplyForm(false)}\r\n            >\r\n              Cancelar\r\n            </Button>\r\n            <Button\r\n              size=\"sm\"\r\n              onClick={handleSendReply}\r\n              disabled={!replyText.trim()}\r\n            >\r\n              Enviar respuesta\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Pie de p√°gina con acciones r√°pidas */}\r\n      <div className=\"border-t border-gray-200 p-4\">\r\n        <div className=\"flex space-x-2\">\r\n          <Button\r\n            variant=\"outline\"\r\n            size=\"sm\"\r\n            className=\"flex items-center\"\r\n            onClick={() => setShowReplyForm(!showReplyForm)}\r\n          >\r\n            <Reply size={16} className=\"mr-1\" />\r\n            Respuesta r√°pida\r\n          </Button>\r\n          <Button\r\n            variant=\"outline\"\r\n            size=\"sm\"\r\n            className=\"flex items-center\"\r\n          >\r\n            <Calendar size={16} className=\"mr-1\" />\r\n            A√±adir al calendario\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default EmailViewer;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\EmptyTrashModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\EventDetector.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'chunkId' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":48,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":48,"endColumn":36},{"ruleId":"no-unused-vars","severity":1,"message":"'isDone' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":48,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":48,"endColumn":44}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo, useRef, useCallback } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { format } from 'date-fns';\r\nimport { es } from 'date-fns/locale';\r\nimport useEventCache from '../../hooks/useEventCache';\r\n\r\n/**\r\n * Componente que analiza el contenido de un email en busca de posibles eventos\r\n * (fechas, horas, ubicaciones) y permite al usuario a√±adirlos al calendario\r\n * con un solo clic.\r\n * \r\n * @component\r\n * @example\r\n * ```jsx\r\n * <EventDetector\r\n *   emailContent={email.body}\r\n *   emailSubject={email.subject}\r\n *   onEventDetected={(eventData) => addToCalendar(eventData)}\r\n * />\r\n * ```\r\n */\r\nfunction EventDetector({ emailContent, emailSubject, onEventDetected }) {\r\n  const [detectedEvents, setDetectedEvents] = useState([]);\r\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\r\n  const [progress, setProgress] = useState(0);\r\n  const workerRef = useRef();\r\n  const chunksProcessed = useRef(0);\r\n  const totalChunks = useRef(0);\r\n  \r\n  // Usar cache para eventos ya detectados\r\n  const { getCachedEvents, cacheEvents } = useEventCache();\r\n  \r\n  /**\r\n   * Inicializa un nuevo web worker para la detecci√≥n de eventos\r\n   * @returns {Worker} Instancia del worker\r\n   */\r\n  const initWorker = useCallback(() => {\r\n    // Terminar el worker anterior si existe\r\n    if (workerRef.current) {\r\n      workerRef.current.terminate();\r\n    }\r\n    \r\n    // Crear un nuevo worker\r\n    const worker = new Worker(new URL('../../workers/eventDetectorWorker.js', import.meta.url));\r\n    \r\n    // Manejar mensajes del worker\r\n    worker.onmessage = (e) => {\r\n      const { type, events, chunkId, isDone, error } = e.data;\r\n      \r\n      if (type === 'error') {\r\n        console.error('Error en worker:', error);\r\n      } else if (type === 'result') {\r\n        // Procesar eventos detectados\r\n        if (events && events.length > 0) {\r\n          // Convertir las fechas de formato ISO a objetos Date\r\n          const processedEvents = events.map(event => ({\r\n            ...event,\r\n            date: new Date(event.date)\r\n          }));\r\n          \r\n          // A√±adir a los eventos detectados\r\n          setDetectedEvents(prev => [...prev, ...processedEvents]);\r\n        }\r\n        \r\n        // Actualizar progreso\r\n        chunksProcessed.current += 1;\r\n        const newProgress = Math.round((chunksProcessed.current / totalChunks.current) * 100);\r\n        setProgress(newProgress);\r\n        \r\n        // Comprobar si se han procesado todos los chunks\r\n        if (chunksProcessed.current >= totalChunks.current) {\r\n          setIsAnalyzing(false);\r\n          \r\n          // Guardar eventos en cach√©\r\n          if (emailContent) {\r\n            const contentHash = btoa(emailContent.substring(0, 100)); // Usar inicio del contenido como clave\r\n            cacheEvents(contentHash, detectedEvents);\r\n          }\r\n        }\r\n      }\r\n    };\r\n    \r\n    workerRef.current = worker;\r\n    return worker;\r\n  }, [cacheEvents]);\r\n  \r\n  /**\r\n   * Divide el texto en chunks y los env√≠a al worker para procesamiento\r\n   * @param {string} text - Texto completo a analizar\r\n   * @param {string} subject - Asunto del email\r\n   */\r\n  const detectPotentialEvents = useCallback((text, subject) => {\r\n    if (!text) {\r\n      setDetectedEvents([]);\r\n      setIsAnalyzing(false);\r\n      return;\r\n    }\r\n    \r\n    // Comprobar cach√© primero\r\n    const contentHash = btoa(text.substring(0, 100));\r\n    const cachedEvents = getCachedEvents(contentHash);\r\n    \r\n    if (cachedEvents && cachedEvents.length > 0) {\r\n      console.log('Usando eventos en cach√©');\r\n      setDetectedEvents(cachedEvents);\r\n      return;\r\n    }\r\n    \r\n    setIsAnalyzing(true);\r\n    setDetectedEvents([]);\r\n    setProgress(0);\r\n    chunksProcessed.current = 0;\r\n    \r\n    try {\r\n      // Inicializar worker\r\n      const worker = initWorker();\r\n      \r\n      // Dividir el texto en chunks de aproximadamente 1000 caracteres\r\n      // pero respetando los l√≠mites de palabras\r\n      const chunkSize = 1000;\r\n      const chunks = [];\r\n      let startIndex = 0;\r\n      \r\n      while (startIndex < text.length) {\r\n        let endIndex = Math.min(startIndex + chunkSize, text.length);\r\n        \r\n        // Ajustar para no cortar palabras\r\n        if (endIndex < text.length) {\r\n          // Buscar el pr√≥ximo espacio en blanco\r\n          while (endIndex > startIndex && text[endIndex] !== ' ' && text[endIndex] !== '\\n') {\r\n            endIndex--;\r\n          }\r\n          \r\n          // Si no encontramos un buen punto de corte, usar el l√≠mite original\r\n          if (endIndex === startIndex) {\r\n            endIndex = Math.min(startIndex + chunkSize, text.length);\r\n          }\r\n        }\r\n        \r\n        chunks.push({\r\n          text: text.substring(startIndex, endIndex),\r\n          start: startIndex\r\n        });\r\n        \r\n        startIndex = endIndex;\r\n      }\r\n      \r\n      // Establecer el n√∫mero total de chunks\r\n      totalChunks.current = chunks.length;\r\n      \r\n      // Procesar cada chunk con el worker\r\n      chunks.forEach((chunk, index) => {\r\n        worker.postMessage({\r\n          text: chunk.text,\r\n          subject,\r\n          chunkId: index,\r\n          startIndex: chunk.start,\r\n          chunkSize\r\n        });\r\n      });\r\n      \r\n    } catch (error) {\r\n      console.error('Error al detectar eventos:', error);\r\n      setIsAnalyzing(false);\r\n      setProgress(0);\r\n    }\r\n  }, [getCachedEvents, cacheEvents, initWorker]);\r\n\r\n  // Analizar el contenido del email cuando cambie\r\n  useEffect(() => {\r\n    if (emailContent) {\r\n      detectPotentialEvents(emailContent, emailSubject);\r\n    } else {\r\n      setDetectedEvents([]);\r\n    }\r\n    \r\n    // Cleanup: terminar worker cuando se desmonte el componente\r\n    return () => {\r\n      if (workerRef.current) {\r\n        workerRef.current.terminate();\r\n        workerRef.current = null;\r\n      }\r\n    };\r\n  }, [emailContent, emailSubject, detectPotentialEvents]);\r\n  \r\n  // Filtrar eventos que ya pasaron y eliminar duplicados\r\n  const validEvents = useMemo(() => {\r\n    const now = new Date();\r\n    \r\n    // Filtrar eventos futuros\r\n    const futureEvents = detectedEvents.filter(event => event.date > now);\r\n    \r\n    // Eliminar duplicados (mismo t√≠tulo, fecha y ubicaci√≥n)\r\n    const uniqueEvents = [];\r\n    const eventMap = new Map();\r\n    \r\n    futureEvents.forEach(event => {\r\n      const key = `${event.date.toISOString()}_${event.location}_${event.title}`;\r\n      if (!eventMap.has(key)) {\r\n        eventMap.set(key, event);\r\n        uniqueEvents.push(event);\r\n      }\r\n    });\r\n    \r\n    return uniqueEvents;\r\n  }, [detectedEvents]);\r\n  \r\n  // No renderizar nada si no hay eventos detectados o est√° analizando\r\n  if ((validEvents.length === 0 && !isAnalyzing) || !emailContent) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"mt-4 border-t pt-3\">\r\n      <h4 className=\"text-sm font-medium text-gray-700 mb-2\">\r\n        {isAnalyzing ? 'Analizando posibles eventos...' : 'Eventos detectados'}\r\n      </h4>\r\n      \r\n      {isAnalyzing ? (\r\n        <div className=\"text-sm text-gray-500\">\r\n          <div className=\"flex items-center\">\r\n            <div className=\"w-4 h-4 mr-2 border-2 border-gray-300 border-t-indigo-500 rounded-full animate-spin\"></div>\r\n            Analizando contenido...\r\n          </div>\r\n          \r\n          {progress > 0 && (\r\n            <div className=\"mt-2\">\r\n              <div className=\"w-full bg-gray-200 rounded-full h-2.5\">\r\n                <div \r\n                  className=\"bg-indigo-500 h-2.5 rounded-full transition-all duration-300\" \r\n                  style={{ width: `${progress}%` }}\r\n                ></div>\r\n              </div>\r\n              <p className=\"text-xs mt-1 text-right\">{progress}% completado</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      ) : (\r\n        <div className=\"space-y-3\">\r\n          {validEvents.map((event, index) => (\r\n            <div \r\n              key={index} \r\n              className=\"p-3 bg-indigo-50 border border-indigo-100 rounded-md\"\r\n            >\r\n              <div className=\"flex justify-between items-start\">\r\n                <div>\r\n                  <div className=\"text-sm font-medium\">{event.title}</div>\r\n                  <div className=\"text-xs text-gray-500\">\r\n                    {format(event.date, 'EEEE, d MMMM yyyy', { locale: es })} ¬∑ {format(event.date, 'HH:mm')}\r\n                  </div>\r\n                  {event.location && (\r\n                    <div className=\"text-xs text-gray-500 mt-1\">\r\n                      <span className=\"font-medium\">Ubicaci√≥n:</span> {event.location}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                <button\r\n                  onClick={() => onEventDetected(event)}\r\n                  className=\"px-3 py-1 bg-indigo-500 hover:bg-indigo-600 text-white text-xs rounded-md transition\"\r\n                  aria-label=\"A√±adir al calendario\"\r\n                >\r\n                  A√±adir al calendario\r\n                </button>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nEventDetector.propTypes = {\r\n  /** Contenido del email donde buscar eventos */\r\n  emailContent: PropTypes.string.isRequired,\r\n  /** Asunto del email para generar t√≠tulos de eventos */\r\n  emailSubject: PropTypes.string,\r\n  /** Funci√≥n a llamar cuando el usuario quiere a√±adir un evento detectado */\r\n  onEventDetected: PropTypes.func.isRequired\r\n};\r\n\r\nexport default EventDetector;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\FolderSelectionModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\MailgunTester.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Divider' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":45}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\r\nimport { sendEmail, validateEmail, checkUsernameAvailability } from '../../services/mailgunService';\r\nimport { \r\n  Box, Button, TextField, Typography, Paper, Grid, \r\n  Snackbar, Alert, CircularProgress, Divider\r\n} from '@mui/material';\r\n\r\n/**\r\n * Componente para probar las funcionalidades de Mailgun\r\n * Permite probar env√≠o de emails, validaci√≥n y disponibilidad de nombres de usuario\r\n */\r\nfunction MailgunTester() {\r\n  // Estado para formulario de env√≠o de email\r\n  const [sending, setSending] = useState(false);\r\n  const [emailForm, setEmailForm] = useState({\r\n    from: `Test <test@mg.mywed360.com>`,\r\n    to: '',\r\n    subject: 'Prueba de Mailgun desde myWed360',\r\n    text: 'Este es un correo de prueba enviado desde la aplicaci√≥n myWed360.',\r\n  });\r\n  \r\n  // Estado para validaci√≥n de email\r\n  const [validating, setValidating] = useState(false);\r\n  const [emailToValidate, setEmailToValidate] = useState('');\r\n  const [validationResult, setValidationResult] = useState(null);\r\n  \r\n  // Estado para verificaci√≥n de disponibilidad de username\r\n  const [checking, setChecking] = useState(false);\r\n  const [usernameToCheck, setUsernameToCheck] = useState('');\r\n  const [availabilityResult, setAvailabilityResult] = useState(null);\r\n  \r\n  // Estado para notificaciones\r\n  const [notification, setNotification] = useState({\r\n    open: false,\r\n    message: '',\r\n    severity: 'info'\r\n  });\r\n\r\n  // Manejar cambios en el formulario de email\r\n  const handleEmailFormChange = (e) => {\r\n    const { name, value } = e.target;\r\n    setEmailForm(prev => ({ ...prev, [name]: value }));\r\n  };\r\n\r\n  // Enviar email de prueba\r\n  const handleSendEmail = async (e) => {\r\n    e.preventDefault();\r\n    setSending(true);\r\n    \r\n    try {\r\n      const result = await sendEmail(emailForm);\r\n      setNotification({\r\n        open: true,\r\n        message: `Email enviado correctamente! ID: ${result.messageId}`,\r\n        severity: 'success'\r\n      });\r\n      console.log('Respuesta del servidor:', result);\r\n    } catch (error) {\r\n      setNotification({\r\n        open: true,\r\n        message: `Error al enviar email: ${error.message}`,\r\n        severity: 'error'\r\n      });\r\n      console.error('Error al enviar:', error);\r\n    } finally {\r\n      setSending(false);\r\n    }\r\n  };\r\n\r\n  // Validar email\r\n  const handleValidateEmail = async (e) => {\r\n    e.preventDefault();\r\n    setValidating(true);\r\n    \r\n    try {\r\n      const result = await validateEmail(emailToValidate);\r\n      setValidationResult(result);\r\n      setNotification({\r\n        open: true,\r\n        message: result.isValid \r\n          ? 'El email es v√°lido' \r\n          : `El email no es v√°lido: ${result.reason || 'formato incorrecto'}`,\r\n        severity: result.isValid ? 'success' : 'warning'\r\n      });\r\n    } catch (error) {\r\n      setNotification({\r\n        open: true,\r\n        message: `Error al validar: ${error.message}`,\r\n        severity: 'error'\r\n      });\r\n      setValidationResult(null);\r\n    } finally {\r\n      setValidating(false);\r\n    }\r\n  };\r\n\r\n  // Verificar disponibilidad de nombre de usuario\r\n  const handleCheckAvailability = async (e) => {\r\n    e.preventDefault();\r\n    setChecking(true);\r\n    \r\n    try {\r\n      const isAvailable = await checkUsernameAvailability(usernameToCheck);\r\n      setAvailabilityResult(isAvailable);\r\n      setNotification({\r\n        open: true,\r\n        message: isAvailable \r\n          ? `El nombre de usuario \"${usernameToCheck}\" est√° disponible` \r\n          : `El nombre de usuario \"${usernameToCheck}\" ya est√° en uso`,\r\n        severity: isAvailable ? 'success' : 'warning'\r\n      });\r\n    } catch (error) {\r\n      setNotification({\r\n        open: true,\r\n        message: `Error al verificar disponibilidad: ${error.message}`,\r\n        severity: 'error'\r\n      });\r\n      setAvailabilityResult(null);\r\n    } finally {\r\n      setChecking(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Box sx={{ p: 3, maxWidth: 800, mx: 'auto' }}>\r\n      <Typography variant=\"h4\" gutterBottom>\r\n        Probador de Mailgun myWed360\r\n      </Typography>\r\n      \r\n      <Grid container spacing={4}>\r\n        {/* Secci√≥n de env√≠o de correo */}\r\n        <Grid item xs={12}>\r\n          <Paper elevation={3} sx={{ p: 3 }}>\r\n            <Typography variant=\"h6\" gutterBottom>\r\n              1. Enviar Email de Prueba\r\n            </Typography>\r\n            <Box component=\"form\" onSubmit={handleSendEmail} sx={{ mt: 2 }}>\r\n              <TextField\r\n                label=\"Desde\"\r\n                name=\"from\"\r\n                value={emailForm.from}\r\n                onChange={handleEmailFormChange}\r\n                fullWidth\r\n                margin=\"normal\"\r\n                required\r\n              />\r\n              <TextField\r\n                label=\"Para\"\r\n                name=\"to\"\r\n                value={emailForm.to}\r\n                onChange={handleEmailFormChange}\r\n                fullWidth\r\n                margin=\"normal\"\r\n                required\r\n                placeholder=\"ejemplo@gmail.com\"\r\n              />\r\n              <TextField\r\n                label=\"Asunto\"\r\n                name=\"subject\"\r\n                value={emailForm.subject}\r\n                onChange={handleEmailFormChange}\r\n                fullWidth\r\n                margin=\"normal\"\r\n                required\r\n              />\r\n              <TextField\r\n                label=\"Mensaje\"\r\n                name=\"text\"\r\n                value={emailForm.text}\r\n                onChange={handleEmailFormChange}\r\n                fullWidth\r\n                margin=\"normal\"\r\n                multiline\r\n                rows={4}\r\n                required\r\n              />\r\n              <Button \r\n                type=\"submit\" \r\n                variant=\"contained\" \r\n                color=\"primary\" \r\n                sx={{ mt: 2 }}\r\n                disabled={sending}\r\n              >\r\n                {sending ? <CircularProgress size={24} /> : 'Enviar Email'}\r\n              </Button>\r\n            </Box>\r\n          </Paper>\r\n        </Grid>\r\n        \r\n        {/* Secci√≥n de validaci√≥n de email */}\r\n        <Grid item xs={12} md={6}>\r\n          <Paper elevation={3} sx={{ p: 3, height: '100%' }}>\r\n            <Typography variant=\"h6\" gutterBottom>\r\n              2. Validar Email\r\n            </Typography>\r\n            <Box component=\"form\" onSubmit={handleValidateEmail}>\r\n              <TextField\r\n                label=\"Email para validar\"\r\n                value={emailToValidate}\r\n                onChange={(e) => setEmailToValidate(e.target.value)}\r\n                fullWidth\r\n                margin=\"normal\"\r\n                required\r\n                placeholder=\"ejemplo@gmail.com\"\r\n              />\r\n              <Button \r\n                type=\"submit\" \r\n                variant=\"contained\" \r\n                color=\"secondary\" \r\n                sx={{ mt: 2 }}\r\n                disabled={validating}\r\n              >\r\n                {validating ? <CircularProgress size={24} /> : 'Validar'}\r\n              </Button>\r\n              \r\n              {validationResult && (\r\n                <Box sx={{ mt: 2, p: 2, bgcolor: 'background.paper', borderRadius: 1 }}>\r\n                  <Typography variant=\"body1\" color={validationResult.isValid ? 'success.main' : 'error.main'}>\r\n                    {validationResult.isValid ? '‚úÖ Email v√°lido' : '‚ùå Email inv√°lido'}\r\n                  </Typography>\r\n                </Box>\r\n              )}\r\n            </Box>\r\n          </Paper>\r\n        </Grid>\r\n        \r\n        {/* Secci√≥n de verificaci√≥n de disponibilidad */}\r\n        <Grid item xs={12} md={6}>\r\n          <Paper elevation={3} sx={{ p: 3, height: '100%' }}>\r\n            <Typography variant=\"h6\" gutterBottom>\r\n              3. Verificar Disponibilidad\r\n            </Typography>\r\n            <Box component=\"form\" onSubmit={handleCheckAvailability}>\r\n              <TextField\r\n                label=\"Nombre de usuario\"\r\n                value={usernameToCheck}\r\n                onChange={(e) => setUsernameToCheck(e.target.value)}\r\n                fullWidth\r\n                margin=\"normal\"\r\n                required\r\n                placeholder=\"nombre\"\r\n                helperText=\"Solo el nombre sin @mywed360.com\"\r\n              />\r\n              <Button \r\n                type=\"submit\" \r\n                variant=\"contained\" \r\n                color=\"secondary\" \r\n                sx={{ mt: 2 }}\r\n                disabled={checking}\r\n              >\r\n                {checking ? <CircularProgress size={24} /> : 'Verificar Disponibilidad'}\r\n              </Button>\r\n              \r\n              {availabilityResult !== null && (\r\n                <Box sx={{ mt: 2, p: 2, bgcolor: 'background.paper', borderRadius: 1 }}>\r\n                  <Typography variant=\"body1\" color={availabilityResult ? 'success.main' : 'error.main'}>\r\n                    {availabilityResult \r\n                      ? `‚úÖ \"${usernameToCheck}@mywed360.com\" est√° disponible` \r\n                      : `‚ùå \"${usernameToCheck}@mywed360.com\" ya est√° en uso`}\r\n                  </Typography>\r\n                </Box>\r\n              )}\r\n            </Box>\r\n          </Paper>\r\n        </Grid>\r\n      </Grid>\r\n      \r\n      <Snackbar \r\n        open={notification.open} \r\n        autoHideDuration={6000} \r\n        onClose={() => setNotification({...notification, open: false})}\r\n      >\r\n        <Alert \r\n          onClose={() => setNotification({...notification, open: false})} \r\n          severity={notification.severity}\r\n          variant=\"filled\"\r\n          sx={{ width: '100%' }}\r\n        >\r\n          {notification.message}\r\n        </Alert>\r\n      </Snackbar>\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default MailgunTester;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\ManageFoldersModal.jsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":78,"column":44,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[2945,2974],"text":"¬øSeguro que deseas eliminar &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[2945,2974],"text":"¬øSeguro que deseas eliminar &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[2945,2974],"text":"¬øSeguro que deseas eliminar &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[2945,2974],"text":"¬øSeguro que deseas eliminar &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":78,"column":71,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[3000,3002],"text":"&quot;?"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[3000,3002],"text":"&ldquo;?"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[3000,3002],"text":"&#34;?"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[3000,3002],"text":"&rdquo;?"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport Button from '../Button';\r\n\r\n/**\r\n * Modal para gestionar carpetas (crear, eliminar).\r\n * Cumple con los selectores utilizados en los tests E2E:\r\n * - data-testid=\"folders-manager-modal\"      Contenedor principal del modal\r\n * - data-testid=\"folder-row\"                 Cada fila de carpeta\r\n * - data-testid=\"delete-folder-button\"       Bot√≥n para eliminar carpeta personalizada\r\n * - data-testid=\"confirm-delete-button\"      Bot√≥n para confirmar eliminaci√≥n\r\n * - data-testid=\"close-modal-button\"         Bot√≥n para cerrar el modal\r\n *\r\n * Props:\r\n * @param {boolean}   isOpen            Mostrar u ocultar el modal\r\n * @param {Function}  onClose           Callback al cerrar\r\n * @param {Array}     folders           Lista de carpetas (obj => {id, name, system})\r\n * @param {Function}  onDeleteFolder    Callback para eliminar carpeta\r\n */\r\nconst ManageFoldersModal = ({ isOpen, onClose, folders = [], onDeleteFolder }) => {\r\n  const [folderPendingDelete, setFolderPendingDelete] = useState(null);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const handleConfirmDelete = () => {\r\n    if (folderPendingDelete) {\r\n      onDeleteFolder(folderPendingDelete.id);\r\n      setFolderPendingDelete(null);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className=\"fixed inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm z-50 p-4\"\r\n      role=\"dialog\"\r\n      aria-modal=\"true\"\r\n      data-testid=\"folders-manager-modal\"\r\n    >\r\n      <div className=\"bg-white rounded-lg shadow-lg w-full max-w-md\">\r\n        {/* Cabecera */}\r\n        <div className=\"flex items-center justify-between px-4 py-2 border-b\">\r\n          <h2 className=\"text-lg font-semibold\">Gestor de carpetas</h2>\r\n          <button\r\n            className=\"text-gray-500 hover:text-gray-700 p-1 rounded\"\r\n            aria-label=\"Cerrar\"\r\n            data-testid=\"close-modal-button\"\r\n            onClick={onClose}\r\n          >\r\n            ‚úï\r\n          </button>\r\n        </div>\r\n\r\n        {/* Listado de carpetas */}\r\n        <div className=\"max-h-64 overflow-y-auto divide-y\" role=\"list\">\r\n          {folders.map((folder) => (\r\n            <div\r\n              key={folder.id}\r\n              className=\"flex items-center justify-between px-4 py-2\" \r\n              data-testid=\"folder-row\"\r\n              role=\"listitem\"\r\n            >\r\n              <span>{folder.name}</span>\r\n              {!folder.system && (\r\n                <button\r\n                  className=\"text-red-600 hover:text-red-800 text-sm\"\r\n                  onClick={() => setFolderPendingDelete(folder)}\r\n                  data-testid=\"delete-folder-button\"\r\n                >\r\n                  Eliminar\r\n                </button>\r\n              )}\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        {/* Confirmaci√≥n de eliminaci√≥n */}\r\n        {folderPendingDelete && (\r\n          <div className=\"border-t p-4 flex flex-col space-y-3\">\r\n            <p>¬øSeguro que deseas eliminar \"{folderPendingDelete.name}\"?</p>\r\n            <div className=\"flex justify-end space-x-2\">\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                onClick={() => setFolderPendingDelete(null)}\r\n              >\r\n                Cancelar\r\n              </Button>\r\n              <Button\r\n                variant=\"danger\"\r\n                size=\"sm\"\r\n                data-testid=\"confirm-delete-button\"\r\n                onClick={() => {\r\n                  handleConfirmDelete();\r\n                  onClose();\r\n                }}\r\n              >\r\n                Confirmar\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ManageFoldersModal;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\SmartEmailComposer.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Divider' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":10},{"ruleId":"no-unused-vars","severity":1,"message":"'Collapse' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":11},{"ruleId":"no-unused-vars","severity":1,"message":"'InsertDriveFile' is defined but never used. Allowed unused vars must match /^_/u.","line":25,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'safeRender' is defined but never used. Allowed unused vars must match /^_/u.","line":28,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":28,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'ensureNotPromise' is defined but never used. Allowed unused vars must match /^_/u.","line":28,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":28,"endColumn":38},{"ruleId":"no-unused-vars","severity":1,"message":"'safeMap' is defined but never used. Allowed unused vars must match /^_/u.","line":28,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":28,"endColumn":47},{"ruleId":"no-unused-vars","severity":1,"message":"'setCategory' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":55,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":55,"endColumn":31},{"ruleId":"no-unused-vars","severity":1,"message":"'recommendationService' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":61,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":61,"endColumn":30},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":119,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":122,"endColumn":42},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":133,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":133,"endColumn":84},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":152,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":152,"endColumn":37},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":155,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":155,"endColumn":23},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":164,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":164,"endColumn":194}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { \r\n  Box, \r\n  Grid, \r\n  Paper, \r\n  Typography, \r\n  TextField, \r\n  Button, \r\n  Divider, \r\n  IconButton,\r\n  Tooltip,\r\n  Collapse,\r\n  Alert,\r\n  Snackbar,\r\n  FormControl,\r\n  InputLabel,\r\n  Select,\r\n  MenuItem\r\n} from '@mui/material';\r\nimport Send from '@mui/icons-material/Send';\r\nimport Lightbulb from '@mui/icons-material/Lightbulb';\r\nimport LightbulbOutlined from '@mui/icons-material/LightbulbOutlined';\r\nimport Schedule from '@mui/icons-material/Schedule';\r\nimport AccessTime from '@mui/icons-material/AccessTime';\r\nimport InsertDriveFile from '@mui/icons-material/InsertDriveFile';\r\nimport EmailRecommendationService from '../../services/EmailRecommendationService';\r\nimport EmailRecommendationsPanel from './EmailRecommendationsPanel';\r\nimport { safeRender, ensureNotPromise, safeMap } from '../../utils/promiseSafeRenderer';\r\n\r\n/**\r\n * Componente para componer correos con recomendaciones inteligentes integradas\r\n * @param {Object} props - Propiedades del componente\r\n * @param {Object} props.provider - Proveedor al que se enviar√° el correo (opcional)\r\n * @param {string} props.searchQuery - Consulta de b√∫squeda original (opcional)\r\n * @param {Function} props.onSend - Funci√≥n llamada al enviar el correo\r\n * @param {Function} props.onCancel - Funci√≥n llamada al cancelar\r\n * @param {Array} props.templates - Lista de plantillas disponibles (opcional)\r\n */\r\nconst SmartEmailComposer = ({ \r\n  provider, \r\n  searchQuery, \r\n  onSend, \r\n  onCancel,\r\n  templates = []\r\n}) => {\r\n  // Estado del formulario\r\n  const [subject, setSubject] = useState('');\r\n  const [message, setMessage] = useState('');\r\n  const [selectedTemplate, setSelectedTemplate] = useState('');\r\n  const [scheduledTime, setScheduledTime] = useState('');\r\n  \r\n  // Estado de las recomendaciones\r\n  const [showRecommendations, setShowRecommendations] = useState(false);\r\n  const [feedback, setFeedback] = useState(null);\r\n  const [category, setCategory] = useState(provider?.service || null);\r\n  \r\n  // Para seguimiento de recomendaciones aplicadas\r\n  const [appliedRecommendations, setAppliedRecommendations] = useState([]);\r\n  \r\n  // Servicio de recomendaciones\r\n  const recommendationService = new EmailRecommendationService();\r\n  \r\n  // Cargar plantilla inicial si hay proveedor y categor√≠a\r\n  useEffect(() => {\r\n    if (provider && category && templates.length > 0) {\r\n      const categoryTemplate = templates.find(t => t.category === category);\r\n      if (categoryTemplate) {\r\n        setSelectedTemplate(categoryTemplate.id);\r\n        \r\n        // Pre-rellenar el asunto y mensaje con la plantilla\r\n        setSubject(categoryTemplate.subjectTemplate\r\n          .replace('[Proveedor]', provider.name || 'proveedor')\r\n          .replace('[Servicio]', provider.service || 'servicio'));\r\n        \r\n        setMessage(categoryTemplate.messageTemplate\r\n          .replace('[Proveedor]', provider.name || 'proveedor')\r\n          .replace('[Servicio]', provider.service || 'servicio'));\r\n      }\r\n    }\r\n  }, [provider, category, templates]);\r\n  \r\n  // Manejar env√≠o del correo\r\n  const handleSend = () => {\r\n    if (!subject || !message) {\r\n      setFeedback({\r\n        type: 'error',\r\n        message: 'Por favor, completa el asunto y el mensaje antes de enviar.'\r\n      });\r\n      return;\r\n    }\r\n    \r\n    // Preparar datos del correo\r\n    const emailData = {\r\n      to: provider?.email || '',\r\n      subject,\r\n      message,\r\n      scheduledTime: scheduledTime || null,\r\n      provider,\r\n      searchQuery,\r\n      wasCustomized: appliedRecommendations.length > 0,\r\n      appliedRecommendations\r\n    };\r\n    \r\n    // Llamar a la funci√≥n de env√≠o proporcionada por el padre\r\n    if (onSend) {\r\n      onSend(emailData);\r\n    }\r\n  };\r\n  \r\n  // Manejar aplicaci√≥n de recomendaciones\r\n  const handleApplyRecommendation = (type, data) => {\r\n    // Registrar la recomendaci√≥n aplicada\r\n    setAppliedRecommendations([...appliedRecommendations, { type, timestamp: new Date().toISOString() }]);\r\n    \r\n    // Aplicar la recomendaci√≥n seg√∫n su tipo\r\n    switch (type) {\r\n      case 'subject':\r\n        // Aplicar el patr√≥n de asunto recomendado\r\n        const newSubject = data\r\n          .replace('[Servicio]', provider?.service || 'servicio')\r\n          .replace('[Fecha]', 'pr√≥ximamente')\r\n          .replace('[Evento]', 'evento');\r\n        \r\n        setSubject(newSubject);\r\n        setFeedback({\r\n          type: 'success',\r\n          message: 'L√≠nea de asunto actualizada con la recomendaci√≥n'\r\n        });\r\n        break;\r\n        \r\n      case 'template':\r\n        // Buscar la plantilla recomendada\r\n        const template = templates.find(t => t.category === data || t.id === data);\r\n        if (template) {\r\n          setSelectedTemplate(template.id);\r\n          \r\n          // Actualizar el mensaje con la plantilla\r\n          const templateMessage = template.messageTemplate\r\n            .replace('[Proveedor]', provider?.name || 'proveedor')\r\n            .replace('[Servicio]', provider?.service || 'servicio');\r\n          \r\n          setMessage(templateMessage);\r\n          setFeedback({\r\n            type: 'success',\r\n            message: `Plantilla \"${template.name}\" aplicada`\r\n          });\r\n        }\r\n        break;\r\n        \r\n      case 'time':\r\n        // Programar el env√≠o para la franja horaria recomendada\r\n        const tomorrow = new Date();\r\n        tomorrow.setDate(tomorrow.getDate() + 1);\r\n        \r\n        let hour = 10; // Por defecto a media ma√±ana\r\n        \r\n        // Ajustar hora seg√∫n la franja recomendada\r\n        if (data.bestTimeSlot === 'morning') hour = 10;\r\n        else if (data.bestTimeSlot === 'afternoon') hour = 14;\r\n        else if (data.bestTimeSlot === 'evening') hour = 18;\r\n        else if (data.bestTimeSlot === 'night') hour = 21;\r\n        \r\n        // Formatear fecha para input datetime-local\r\n        const scheduledDate = `${tomorrow.getFullYear()}-${String(tomorrow.getMonth() + 1).padStart(2, '0')}-${String(tomorrow.getDate()).padStart(2, '0')}T${String(hour).padStart(2, '0')}:00`;\r\n        \r\n        setScheduledTime(scheduledDate);\r\n        setFeedback({\r\n          type: 'success',\r\n          message: `Correo programado para ma√±ana a las ${hour}:00h (${data.bestTimeSlotName})`\r\n        });\r\n        break;\r\n        \r\n      default:\r\n        console.log('Tipo de recomendaci√≥n no implementado:', type, data);\r\n    }\r\n  };\r\n  \r\n  // Cambiar plantilla seleccionada\r\n  const handleTemplateChange = (e) => {\r\n    const templateId = e.target.value;\r\n    setSelectedTemplate(templateId);\r\n    \r\n    if (templateId) {\r\n      const template = templates.find(t => t.id === templateId);\r\n      if (template) {\r\n        // Actualizar el mensaje con la plantilla\r\n        const templateMessage = template.messageTemplate\r\n          .replace('[Proveedor]', provider?.name || 'proveedor')\r\n          .replace('[Servicio]', provider?.service || 'servicio');\r\n        \r\n        setMessage(templateMessage);\r\n      }\r\n    }\r\n  };\r\n  \r\n  // Cerrar alerta de feedback\r\n  const handleCloseFeedback = () => {\r\n    setFeedback(null);\r\n  };\r\n  \r\n  return (\r\n    <Box sx={{ p: 2 }}>\r\n      <Typography variant=\"h5\" gutterBottom>\r\n        Redactar Correo\r\n        {provider && (\r\n          <Typography component=\"span\" variant=\"subtitle1\" sx={{ ml: 1 }}>\r\n            a {provider.name}\r\n          </Typography>\r\n        )}\r\n      </Typography>\r\n      \r\n      <Grid container spacing={2}>\r\n        <Grid item xs={12} md={showRecommendations ? 7 : 12}>\r\n          <Paper sx={{ p: 2 }}>\r\n            <Box sx={{ display: 'flex', justifyContent: 'space-between', mb: 2 }}>\r\n              <Typography variant=\"h6\">Mensaje</Typography>\r\n              <Tooltip title={showRecommendations ? \"Ocultar recomendaciones\" : \"Mostrar recomendaciones\"}>\r\n                <IconButton onClick={() => setShowRecommendations(!showRecommendations)}>\r\n                  {showRecommendations ? <Lightbulb color=\"primary\" /> : <LightbulbOutlined />}\r\n                </IconButton>\r\n              </Tooltip>\r\n            </Box>\r\n            \r\n            <Grid container spacing={2}>\r\n              {/* Asunto */}\r\n              <Grid item xs={12}>\r\n                <TextField\r\n                  fullWidth\r\n                  label=\"Asunto\"\r\n                  value={subject}\r\n                  onChange={(e) => setSubject(e.target.value)}\r\n                  variant=\"outlined\"\r\n                  placeholder=\"Escribe un asunto efectivo...\"\r\n                />\r\n              </Grid>\r\n              \r\n              {/* Selecci√≥n de plantilla */}\r\n              {templates.length > 0 && (\r\n                <Grid item xs={12}>\r\n                  <FormControl fullWidth>\r\n                    <InputLabel id=\"template-select-label\">Plantilla</InputLabel>\r\n                    <Select\r\n                      labelId=\"template-select-label\"\r\n                      value={selectedTemplate}\r\n                      label=\"Plantilla\"\r\n                      onChange={handleTemplateChange}\r\n                    >\r\n                      <MenuItem value=\"\">\r\n                        <em>Ninguna</em>\r\n                      </MenuItem>\r\n                      {templates.map(template => (\r\n                        <MenuItem key={template.id} value={template.id}>\r\n                          {template.name}\r\n                        </MenuItem>\r\n                      ))}\r\n                    </Select>\r\n                  </FormControl>\r\n                </Grid>\r\n              )}\r\n              \r\n              {/* Mensaje */}\r\n              <Grid item xs={12}>\r\n                <TextField\r\n                  fullWidth\r\n                  multiline\r\n                  rows={8}\r\n                  label=\"Mensaje\"\r\n                  value={message}\r\n                  onChange={(e) => setMessage(e.target.value)}\r\n                  variant=\"outlined\"\r\n                  placeholder=\"Escribe tu mensaje aqu√≠...\"\r\n                />\r\n              </Grid>\r\n              \r\n              {/* Programaci√≥n de env√≠o */}\r\n              <Grid item xs={12}>\r\n                <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\r\n                  <AccessTime color=\"action\" />\r\n                  <Typography variant=\"body2\" color=\"text.secondary\">\r\n                    Programar env√≠o:\r\n                  </Typography>\r\n                  <TextField\r\n                    type=\"datetime-local\"\r\n                    value={scheduledTime}\r\n                    onChange={(e) => setScheduledTime(e.target.value)}\r\n                    InputLabelProps={{\r\n                      shrink: true,\r\n                    }}\r\n                    sx={{ ml: 1 }}\r\n                    size=\"small\"\r\n                  />\r\n                  {scheduledTime && (\r\n                    <Button \r\n                      size=\"small\"\r\n                      onClick={() => setScheduledTime('')}\r\n                      sx={{ ml: 1 }}\r\n                    >\r\n                      Limpiar\r\n                    </Button>\r\n                  )}\r\n                </Box>\r\n              </Grid>\r\n              \r\n              {/* Botones de acci√≥n */}\r\n              <Grid item xs={12}>\r\n                <Box sx={{ display: 'flex', justifyContent: 'flex-end', gap: 2, mt: 2 }}>\r\n                  <Button \r\n                    variant=\"outlined\" \r\n                    onClick={onCancel}\r\n                  >\r\n                    Cancelar\r\n                  </Button>\r\n                  <Button \r\n                    variant=\"contained\" \r\n                    startIcon={scheduledTime ? <Schedule /> : <Send />}\r\n                    onClick={handleSend}\r\n                  >\r\n                    {scheduledTime ? 'Programar' : 'Enviar'}\r\n                  </Button>\r\n                </Box>\r\n              </Grid>\r\n            </Grid>\r\n          </Paper>\r\n        </Grid>\r\n        \r\n        {/* Panel de recomendaciones */}\r\n        {showRecommendations && (\r\n          <Grid item xs={12} md={5}>\r\n            <Paper sx={{ height: '100%', overflow: 'auto' }}>\r\n              <EmailRecommendationsPanel \r\n                category={category}\r\n                searchQuery={searchQuery}\r\n                onApplyRecommendation={handleApplyRecommendation}\r\n              />\r\n            </Paper>\r\n          </Grid>\r\n        )}\r\n      </Grid>\r\n      \r\n      {/* Alertas de feedback */}\r\n      <Snackbar \r\n        open={!!feedback} \r\n        autoHideDuration={6000} \r\n        onClose={handleCloseFeedback}\r\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}\r\n      >\r\n        <Alert \r\n          onClose={handleCloseFeedback} \r\n          severity={feedback?.type || 'info'} \r\n          sx={{ width: '100%' }}\r\n        >\r\n          {feedback?.message}\r\n        </Alert>\r\n      </Snackbar>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default SmartEmailComposer;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\TagsManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Tag' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'Edit' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":25},{"ruleId":"no-unused-vars","severity":1,"message":"'Circle' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":44,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":50},{"ruleId":"no-unused-vars","severity":1,"message":"'getUserTags' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'ensureNotPromise' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Tag, Plus, Edit, Trash, X, Check, Circle } from 'lucide-react';\r\nimport Button from '../Button';\r\nimport { useAuth } from '../../hooks/useAuthUnified';\r\nimport { \r\n  getUserTags,\r\n  getCustomTags, \r\n  createTag, \r\n  deleteTag,\r\n  SYSTEM_TAGS\r\n} from '../../services/tagService';\r\nimport { toast } from 'react-toastify';\r\nimport { safeRender, ensureNotPromise, safeMap } from '../../utils/promiseSafeRenderer';\r\n\r\n/**\r\n * Componente para administrar todas las etiquetas del usuario\r\n */\r\nconst TagsManager = ({ onClose }) => {\r\n  const [tags, setTags] = useState([]);\r\n  const [systemTags, setSystemTags] = useState([]);\r\n  const [isCreating, setIsCreating] = useState(false);\r\n  const [newTagName, setNewTagName] = useState('');\r\n  const [newTagColor, setNewTagColor] = useState('#64748b'); // Color predeterminado\r\n  const { currentUser } = useAuth();\r\n  \r\n  // Colores disponibles para etiquetas\r\n  // Ordenamos los colores de forma que el √≠ndice 3 (eq(3) en Cypress) sea el naranja #FFA500\r\n  const colorOptions = [\r\n    '#e53e3e', // Rojo (0)\r\n    '#dd6b20', // Naranja oscuro (1)\r\n    '#d69e2e', // Amarillo (2)\r\n    '#FFA500', // Naranja claro (3) ‚Äì coincide con el test E2E que selecciona eq(3)\r\n    '#38a169', // Verde (4)\r\n    '#3182ce', // Azul (5)\r\n    '#805ad5', // Morado (6)\r\n    '#d53f8c', // Rosa (7)\r\n    '#64748b', // Gris (8)\r\n    '#000000', // Negro (9)\r\n  ];\r\n  \r\n  // Cargar etiquetas al montar el componente\r\n  useEffect(() => {\r\n    if (!currentUser) return;\r\n    loadTags();\r\n  }, [currentUser]);\r\n  \r\n  // Cargar etiquetas del usuario\r\n  const loadTags = () => {\r\n    if (!currentUser) return;\r\n    \r\n    // Obtener etiquetas personalizadas\r\n    const customTags = getCustomTags(currentUser.uid);\r\n    setTags(customTags);\r\n    \r\n    // Establecer etiquetas del sistema\r\n    setSystemTags(SYSTEM_TAGS);\r\n  };\r\n  \r\n  // Crear nueva etiqueta\r\n  const handleCreateTag = () => {\r\n    if (!currentUser || !newTagName.trim()) return;\r\n    \r\n    try {\r\n      // Crear etiqueta\r\n      createTag(currentUser.uid, newTagName.trim(), newTagColor);\r\n      \r\n      // Limpiar formulario\r\n      setNewTagName('');\r\n      setNewTagColor('#64748b');\r\n      setIsCreating(false);\r\n      \r\n      // Recargar etiquetas\r\n      loadTags();\r\n      \r\n      // Notificar √©xito\r\n      toast.success(`Etiqueta \"${newTagName.trim()}\" creada con √©xito`);\r\n    } catch (error) {\r\n      console.error('Error al crear etiqueta:', error);\r\n      toast.error(`Error: ${error.message || 'No se pudo crear la etiqueta'}`);\r\n    }\r\n  };\r\n  \r\n  // Eliminar etiqueta\r\n  const handleDeleteTag = (tagId, tagName) => {\r\n    if (!currentUser) return;\r\n    \r\n    if (confirm(`¬øEst√°s seguro de eliminar la etiqueta \"${tagName}\"?`)) {\r\n      try {\r\n        // Eliminar etiqueta\r\n        deleteTag(currentUser.uid, tagId);\r\n        \r\n        // Recargar etiquetas\r\n        loadTags();\r\n        \r\n        // Notificar √©xito\r\n        toast.success(`Etiqueta \"${tagName}\" eliminada con √©xito`);\r\n      } catch (error) {\r\n        console.error('Error al eliminar etiqueta:', error);\r\n        toast.error(`Error: ${error.message || 'No se pudo eliminar la etiqueta'}`);\r\n      }\r\n    }\r\n  };\r\n  \r\n  return (\r\n    <div className=\"bg-white border rounded-md overflow-hidden\" data-testid=\"tags-manager-modal\">\r\n      <div className=\"flex items-center justify-between px-4 py-3 border-b\">\r\n          <div>\r\n            <h3 className=\"text-lg font-medium text-gray-900\">Gestionar etiquetas</h3>\r\n            <p className=\"mt-1 text-sm text-gray-600\">\r\n              Crea y organiza etiquetas para clasificar tus correos\r\n            </p>\r\n          </div>\r\n          <button\r\n            className=\"text-gray-500 hover:text-gray-700 p-1 rounded\"\r\n            aria-label=\"Cerrar\"\r\n            data-testid=\"close-modal-button\"\r\n            onClick={onClose}\r\n          >\r\n            ‚úï\r\n          </button>\r\n        </div>\r\n      \r\n      \r\n      <div className=\"px-4 py-3\">\r\n        <h4 className=\"text-sm font-medium text-gray-700 mb-2\">Etiquetas del sistema</h4>\r\n        <div className=\"space-y-2 mb-4\">\r\n          {systemTags.map((tag) => (\r\n            <div key={tag.id} className=\"flex items-center justify-between py-2 px-3 bg-gray-50 rounded-md\">\r\n              <div className=\"flex items-center\">\r\n                <div \r\n                  className=\"w-3 h-3 rounded-full mr-2\"\r\n                  style={{ backgroundColor: tag.color }}\r\n                />\r\n                <span className=\"text-sm font-medium\">{tag.name}</span>\r\n              </div>\r\n              <span className=\"text-xs text-gray-500 italic\">Predefinida</span>\r\n            </div>\r\n          ))}\r\n        </div>\r\n        \r\n        <div className=\"border-t border-gray-200 pt-4\">\r\n          <div className=\"flex items-center justify-between mb-2\">\r\n            <h4 className=\"text-sm font-medium text-gray-700\">Etiquetas personalizadas</h4>\r\n            {!isCreating && (\r\n              <Button \r\n                onClick={() => setIsCreating(true)}\r\n                data-testid=\"new-tag-button\"\r\n                variant=\"secondary\"\r\n                size=\"sm\"\r\n                className=\"text-xs py-1 px-2\"\r\n              >\r\n                <Plus size={14} className=\"mr-1\" />\r\n                Nueva etiqueta\r\n              </Button>\r\n            )}\r\n          </div>\r\n          \r\n          {/* Formulario para crear etiqueta */}\r\n          {isCreating && (\r\n            <div className=\"mb-4 p-3 border border-gray-200 bg-gray-50 rounded-md\">\r\n              <div className=\"mb-2\">\r\n                <label className=\"block text-xs font-medium text-gray-700 mb-1\">\r\n                  Nombre de la etiqueta\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={newTagName}\r\n                  data-testid=\"tag-name-input\"\r\n                  onChange={(e) => setNewTagName(e.target.value)}\r\n                  placeholder=\"Nombre de la etiqueta\"\r\n                  className=\"w-full px-3 py-1.5 border border-gray-300 rounded-md text-sm shadow-sm focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500\"\r\n                />\r\n              </div>\r\n              \r\n              <div className=\"mb-3\">\r\n                <label className=\"block text-xs font-medium text-gray-700 mb-1\">\r\n                  Color\r\n                </label>\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                  {colorOptions.map((color) => (\r\n                    <div\r\n                      key={color}\r\n                      data-testid=\"color-option\"\r\n                      onClick={() => setNewTagColor(color)}\r\n                      style={{ backgroundColor: color }}\r\n                      className={`w-6 h-6 rounded-full cursor-pointer flex items-center justify-center ${newTagColor === color ? 'ring-2 ring-offset-2 ring-gray-400' : ''}`}\r\n                    >\r\n                      {newTagColor === color && (\r\n                        <Check size={14} className=\"text-white\" />\r\n                      )}\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"flex space-x-2 mt-2\">\r\n                <Button \r\n                  onClick={handleCreateTag}\r\n                  data-testid=\"save-tag-button\"\r\n                  disabled={!newTagName.trim()}\r\n                  className=\"text-xs py-1.5\"\r\n                  size=\"sm\"\r\n                >\r\n                  <Check size={14} className=\"mr-1\" />\r\n                  Crear etiqueta\r\n                </Button>\r\n                <Button \r\n                  onClick={() => {\r\n                    if (onClose) onClose();\r\n                    setIsCreating(false);\r\n                    setNewTagName('');\r\n                    setNewTagColor('#64748b');\r\n                  }}\r\n                  variant=\"secondary\"\r\n                  className=\"text-xs py-1.5\"\r\n                  size=\"sm\"\r\n                >\r\n                  <X size={14} className=\"mr-1\" />\r\n                  Cancelar\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n          \r\n          <div className=\"space-y-2\">\r\n            {tags.length === 0 && !isCreating && (\r\n              <p className=\"text-sm text-gray-500 text-center py-4\">\r\n                No has creado etiquetas personalizadas\r\n              </p>\r\n            )}\r\n            \r\n            {safeMap(tags).map((tag) => (\r\n              <div key={safeRender(tag.id, '')} className=\"flex items-center justify-between py-2 px-3 border border-gray-200 rounded-md\">\r\n                <div className=\"flex items-center\">\r\n                  <div \r\n                    className=\"w-3 h-3 rounded-full mr-2\"\r\n                    style={{ backgroundColor: safeRender(tag.color, '#64748b') }}\r\n                  />\r\n                  <span className=\"text-sm\">{safeRender(tag.name, '')}</span>\r\n                </div>\r\n                <Button \r\n                  onClick={() => handleDeleteTag(safeRender(tag.id, ''), safeRender(tag.name, ''))}\r\n                  variant=\"danger\"\r\n                  className=\"text-xs py-1 px-2\"\r\n                  size=\"sm\"\r\n                >\r\n                  <Trash size={14} />\r\n                </Button>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TagsManager;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\TagsSidebar.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\UnifiedEmailSystem.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\UnifiedInbox\\EmailCategoryLabel.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\UnifiedInbox\\EmailDetail.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'memo' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":46,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":50},{"ruleId":"no-unused-vars","severity":1,"message":"'ensureNotPromise' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":38},{"ruleId":"no-unused-vars","severity":1,"message":"'toBlob' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'IconArrowLeft' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'IconReply' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":12},{"ruleId":"no-unused-vars","severity":1,"message":"'IconTrash' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":12},{"ruleId":"no-unused-vars","severity":1,"message":"'IconDownload' is defined but never used. Allowed unused vars must match /^_/u.","line":14,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'IconStar' is defined but never used. Allowed unused vars must match /^_/u.","line":15,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":11},{"ruleId":"no-unused-vars","severity":1,"message":"'IconMore' is defined but never used. Allowed unused vars must match /^_/u.","line":16,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":33},{"ruleId":"no-unused-vars","severity":1,"message":"'IconExternal' is defined but never used. Allowed unused vars must match /^_/u.","line":17,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":35},{"ruleId":"no-unused-vars","severity":1,"message":"'IconPrinter' is defined but never used. Allowed unused vars must match /^_/u.","line":18,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'IconFlag' is defined but never used. Allowed unused vars must match /^_/u.","line":19,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":11},{"ruleId":"no-unused-vars","severity":1,"message":"'IconArrowLeftRight' is defined but never used. Allowed unused vars must match /^_/u.","line":20,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'IconFolderMove' is defined but never used. Allowed unused vars must match /^_/u.","line":21,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'setLoadingImages' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":64,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":64,"endColumn":41},{"ruleId":"no-unused-vars","severity":1,"message":"'getMimeType' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":127,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":127,"endColumn":20},{"ruleId":"react/jsx-no-undef","severity":2,"message":"'ArrowLeft' is not defined.","line":232,"column":14,"nodeType":"JSXIdentifier","messageId":"undefined","endLine":232,"endColumn":23},{"ruleId":"react/jsx-no-undef","severity":2,"message":"'Reply' is not defined.","line":242,"column":14,"nodeType":"JSXIdentifier","messageId":"undefined","endLine":242,"endColumn":19},{"ruleId":"react/jsx-no-undef","severity":2,"message":"'Trash' is not defined.","line":252,"column":14,"nodeType":"JSXIdentifier","messageId":"undefined","endLine":252,"endColumn":19},{"ruleId":"react/jsx-no-undef","severity":2,"message":"'Star' is not defined.","line":260,"column":14,"nodeType":"JSXIdentifier","messageId":"undefined","endLine":260,"endColumn":18},{"ruleId":"react/jsx-no-undef","severity":2,"message":"'MoreHorizontal' is not defined.","line":269,"column":14,"nodeType":"JSXIdentifier","messageId":"undefined","endLine":269,"endColumn":28},{"ruleId":"react/jsx-no-undef","severity":2,"message":"'Printer' is not defined.","line":276,"column":20,"nodeType":"JSXIdentifier","messageId":"undefined","endLine":276,"endColumn":27},{"ruleId":"react/jsx-no-undef","severity":2,"message":"'Download' is not defined.","line":280,"column":20,"nodeType":"JSXIdentifier","messageId":"undefined","endLine":280,"endColumn":28},{"ruleId":"react/jsx-no-undef","severity":2,"message":"'ExternalLink' is not defined.","line":284,"column":20,"nodeType":"JSXIdentifier","messageId":"undefined","endLine":284,"endColumn":32},{"ruleId":"react/jsx-no-undef","severity":2,"message":"'ArrowLeftRight' is not defined.","line":288,"column":20,"nodeType":"JSXIdentifier","messageId":"undefined","endLine":288,"endColumn":34},{"ruleId":"react/jsx-no-undef","severity":2,"message":"'Flag' is not defined.","line":292,"column":20,"nodeType":"JSXIdentifier","messageId":"undefined","endLine":292,"endColumn":24},{"ruleId":"react/jsx-no-undef","severity":2,"message":"'Download' is not defined.","line":441,"column":26,"nodeType":"JSXIdentifier","messageId":"undefined","endLine":441,"endColumn":34},{"ruleId":"react/jsx-no-undef","severity":2,"message":"'Reply' is not defined.","line":501,"column":14,"nodeType":"JSXIdentifier","messageId":"undefined","endLine":501,"endColumn":19}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef, memo } from 'react';\r\nimport sanitizeHtml from '../../../utils/sanitizeHtml';\r\nimport { safeRender, ensureNotPromise, safeExecute, safeDangerouslySetInnerHTML } from '../../../utils/promiseSafeRenderer';\r\nimport EmailComments from '../EmailComments';\r\n// Importaci√≥n problem√°tica eliminada temporalmente\r\n// import { Viewer } from 'react-tiff';\r\nimport { toBlob } from 'html-to-image';\r\n\r\n// Importamos nuestros componentes de iconos personalizados\r\nimport {\r\n  IconArrowLeft,\r\n  IconReply,\r\n  IconTrash,\r\n  IconDownload,\r\n  IconStar,\r\n  IconMoreHorizontal as IconMore,\r\n  IconExternalLink as IconExternal,\r\n  IconPrinter,\r\n  IconFlag,\r\n  IconArrowLeftRight,\r\n  IconFolderMove\r\n} from '../../ui/IconComponents';\r\nimport Button from '../../Button';\r\nimport EmailCategoryLabel from './EmailCategoryLabel';\r\n\r\n/**\r\n * Componente para mostrar el detalle completo de un email\r\n * \r\n * @param {Object} props - Propiedades del componente\r\n * @param {Object} props.email - Email a mostrar\r\n * @param {Function} props.onReply - Funci√≥n para responder al email\r\n * @param {Function} props.onDelete - Funci√≥n para eliminar el email\r\n * @param {Function} props.onBack - Funci√≥n para volver a la lista\r\n * @param {Function} props.onMarkRead - Funci√≥n para marcar como le√≠do\r\n * @returns {JSX.Element} Componente de detalle de email\r\n */\r\n\r\n// Constantes para tipos de archivos\r\nconst IMAGE_TYPES = {\r\n  'jpg': 'image/jpeg',\r\n  'jpeg': 'image/jpeg',\r\n  'png': 'image/png',\r\n  'gif': 'image/gif',\r\n  'webp': 'image/webp',\r\n  'svg': 'image/svg+xml',\r\n  'tiff': 'image/tiff',\r\n  'tif': 'image/tiff',\r\n  'bmp': 'image/bmp',\r\n  'ico': 'image/x-icon'\r\n};\r\nconst EmailDetail = ({ email, onReply, onDelete, onBack, onMarkRead }) => {\r\n  // Si email es null o undefined, mostrar un mensaje\r\n  if (!email) {\r\n    return (\r\n      <div className=\"flex flex-col items-center justify-center h-full p-8 text-gray-500\">\r\n        <p className=\"text-lg\">Selecciona un email para ver su contenido</p>\r\n      </div>\r\n    );\r\n  }\r\n  const [isStarred, setIsStarred] = useState(email?.important || false);\r\n  const [showDropdown, setShowDropdown] = useState(false);\r\n  const [isRead, setIsRead] = useState(email?.read || false);\r\n  const [expandedImage, setExpandedImage] = useState(null);\r\n  const [loadingImages, setLoadingImages] = useState({});\r\n  const prevEmailIdRef = useRef(email?.id);\r\n  \r\n  // Efecto para actualizar el estado visual cuando cambia el email seleccionado\r\n  useEffect(() => {\r\n    if (email?.id !== prevEmailIdRef.current) {\r\n      setIsRead(email?.read || false);\r\n      prevEmailIdRef.current = email?.id;\r\n    }\r\n  }, [email?.id, email?.read]);\r\n  \r\n  // Efecto para marcar autom√°ticamente como le√≠do cuando se visualiza un email no le√≠do\r\n  useEffect(() => {\r\n    if (email && !isRead) {\r\n      setIsRead(true); // Actualizar inmediatamente el estado visual\r\n      if (onMarkRead) {\r\n        // Notificar al componente padre que debe actualizar el estado\r\n        onMarkRead(email.id);\r\n      }\r\n    }\r\n  }, [email, isRead, onMarkRead]);\r\n\r\n  if (!email) {\r\n    return (\r\n      <div className=\"h-full flex items-center justify-center text-gray-500\">\r\n        Selecciona un email para ver su contenido\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Funci√≥n para manejar el marcado como importante\r\n  const handleToggleStar = () => {\r\n    setIsStarred(!isStarred);\r\n    // Actualizar en el servidor y notificar al componente padre\r\n    // Esta funci√≥n deber√≠a conectarse con el servicio de email\r\n    // por ahora solo actualizamos el estado local\r\n  };\r\n\r\n  // Formatear la fecha completa\r\n  const formatFullDate = (dateString) => {\r\n    return new Date(dateString).toLocaleString('es-ES', {\r\n      weekday: 'long',\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  // Obtener extensi√≥n del archivo\r\n  const getFileExtension = (filename) => {\r\n    if (!filename) return '';\r\n    return filename.split('.').pop().toLowerCase();\r\n  };\r\n  \r\n  // Verificar si el archivo es una imagen\r\n  const isImageFile = (filename) => {\r\n    const ext = getFileExtension(filename);\r\n    return Object.keys(IMAGE_TYPES).includes(ext);\r\n  };\r\n  \r\n  // Obtener tipo MIME basado en la extensi√≥n\r\n  const getMimeType = (filename) => {\r\n    const ext = getFileExtension(filename);\r\n    return IMAGE_TYPES[ext] || 'application/octet-stream';\r\n  };\r\n  \r\n  // Manejar click en una imagen adjunta\r\n  const handleImageClick = (attachment) => {\r\n    setExpandedImage(attachment);\r\n  };\r\n  \r\n  // Cerrar visualizador de imagen\r\n  const handleCloseImageViewer = () => {\r\n    setExpandedImage(null);\r\n  };\r\n  \r\n  // Manejar la descarga de un archivo adjunto\r\n  const handleDownloadAttachment = (attachment) => {\r\n    // Aqu√≠ implementar√≠amos la l√≥gica de descarga\r\n    console.log('Descargando:', attachment.filename);\r\n    // Idealmente, esto conectar√≠a con un endpoint de la API\r\n  };\r\n  \r\n  // Obtener iniciales para el avatar\r\n  const getInitials = (emailAddress) => {\r\n    if (!emailAddress) return '?';\r\n    \r\n    const name = emailAddress.split('@')[0].replace(/[^a-zA-Z0-9]/g, ' ').trim();\r\n    const parts = name.split(' ').filter(part => part.length > 0);\r\n    \r\n    if (parts.length === 0) return '?';\r\n    if (parts.length === 1) return parts[0][0].toUpperCase();\r\n    \r\n    return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\r\n  };\r\n\r\n  // Procesar el contenido HTML del email de forma segura\r\n  const getSafeHtml = (htmlContent) => {\r\n    return safeExecute(\r\n      () => {\r\n        const result = sanitizeHtml(htmlContent || '');\r\n        return typeof result === 'string' ? result : String(result || '');\r\n      },\r\n      htmlContent || '' // fallback si sanitizeHtml retorna una Promesa\r\n    );\r\n  };\r\n    \r\n    \r\n\r\n    \r\n  \r\n  // Obtener color para el avatar basado en el remitente\r\n  const getAvatarColor = (email) => {\r\n    const colors = [\r\n      'bg-blue-500',\r\n      'bg-green-500',\r\n      'bg-yellow-500',\r\n      'bg-purple-500',\r\n      'bg-pink-500',\r\n      'bg-indigo-500',\r\n      'bg-red-500',\r\n      'bg-teal-500'\r\n    ];\r\n    \r\n    // Usar una funci√≥n simple de hash para asignar un color consistente\r\n    let hash = 0;\r\n    for (let i = 0; i < email.length; i++) {\r\n      hash = ((hash << 5) - hash) + email.charCodeAt(i);\r\n      hash |= 0;\r\n    }\r\n    \r\n    const colorIndex = Math.abs(hash) % colors.length;\r\n    return colors[colorIndex];\r\n  };\r\n\r\n  // Detectar las categor√≠as del email\r\n  const detectCategories = (email) => {\r\n    const categories = [];\r\n    \r\n    // Ejemplo de l√≥gica para detectar categor√≠as\r\n    if (email.from.includes('proveedor') || email.subject.toLowerCase().includes('proveedor')) {\r\n      categories.push({ name: 'Proveedor', color: 'bg-blue-500' });\r\n    }\r\n    \r\n    if (email.from.includes('invitado') || email.subject.toLowerCase().includes('invitado')) {\r\n      categories.push({ name: 'Invitado', color: 'bg-green-500' });\r\n    }\r\n    \r\n    if (email.subject.toLowerCase().includes('importante') || email.important) {\r\n      categories.push({ name: 'Importante', color: 'bg-yellow-500' });\r\n    }\r\n    \r\n    return categories;\r\n  };\r\n\r\n  const emailCategories = detectCategories(email);\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full bg-white\">\r\n      {/* Barra de herramientas */}\r\n      <div className=\"p-4 border-b flex items-center justify-between\">\r\n        <div className=\"flex items-center\">\r\n          <button \r\n            onClick={onBack}\r\n            className=\"mr-4 text-gray-600 hover:text-gray-900 md:hidden\"\r\n          >\r\n            <ArrowLeft size={20} />\r\n          </button>\r\n          \r\n          <Button \r\n            onClick={onReply}\r\n            variant=\"outline\"\r\n            size=\"sm\"\r\n            className=\"flex items-center mr-2\"\r\n            aria-label=\"Responder\"\r\n          >\r\n            <Reply size={16} className=\"mr-1\" />\r\n            <span className=\"hidden sm:inline\">Responder</span>\r\n          </Button>\r\n          \r\n          <Button\r\n            onClick={onDelete}\r\n            variant=\"outline\"\r\n            size=\"sm\"\r\n            className=\"flex items-center mr-2\"\r\n          >\r\n            <Trash size={16} className=\"mr-1\" />\r\n            <span className=\"hidden sm:inline\">Eliminar</span>\r\n          </Button>\r\n          \r\n          <button\r\n            onClick={handleToggleStar}\r\n            className={`p-1.5 rounded-full hover:bg-gray-100 ${isStarred ? 'text-yellow-500' : 'text-gray-500'}`}\r\n          >\r\n            <Star size={20} className={isStarred ? 'fill-yellow-500' : ''} />\r\n          </button>\r\n        </div>\r\n        \r\n        <div className=\"relative\">\r\n          <button\r\n            onClick={() => setShowDropdown(!showDropdown)}\r\n            className=\"p-1.5 rounded-full hover:bg-gray-100 text-gray-600\"\r\n          >\r\n            <MoreHorizontal size={20} />\r\n          </button>\r\n          \r\n          {showDropdown && (\r\n            <div className=\"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10 border\">\r\n              <div className=\"py-1\">\r\n                <button className=\"flex w-full items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\">\r\n                  <Printer size={16} className=\"mr-2\" />\r\n                  Imprimir\r\n                </button>\r\n                <button className=\"flex w-full items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\">\r\n                  <Download size={16} className=\"mr-2\" />\r\n                  Descargar\r\n                </button>\r\n                <button className=\"flex w-full items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\">\r\n                  <ExternalLink size={16} className=\"mr-2\" />\r\n                  Abrir en nueva ventana\r\n                </button>\r\n                <button className=\"flex w-full items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\">\r\n                  <ArrowLeftRight size={16} className=\"mr-2\" />\r\n                  Reenviar\r\n                </button>\r\n                <button className=\"flex w-full items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\">\r\n                  <Flag size={16} className=\"mr-2\" />\r\n                  Marcar\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Cabecera del email */}\r\n      <div className=\"p-6 border-b\">\r\n        <div className=\"flex items-start\">\r\n          <div className={`w-10 h-10 rounded-full ${getAvatarColor(email.from)} flex items-center justify-center text-white font-medium mr-4 flex-shrink-0`}>\r\n            {getInitials(email.from)}\r\n          </div>\r\n          \r\n          <div className=\"flex-grow\">\r\n            <div className=\"flex items-start justify-between\">\r\n              <h1 className=\"text-xl font-medium mb-2\">\r\n                {safeRender(email.subject, '(Sin asunto)')}\r\n              </h1>\r\n            </div>\r\n            \r\n            <div className=\"flex flex-wrap items-center mb-1\">\r\n              <span className=\"font-medium mr-1\">{safeRender(email.from, '')}</span>\r\n              <span className=\"text-gray-500 text-sm mr-1\">para</span>\r\n              <span className=\"mr-2\">{safeRender(email.to, '')}</span>\r\n              \r\n              {email.cc && (\r\n                <>\r\n                  <span className=\"text-gray-500 text-sm mr-1\">cc:</span>\r\n                  <span>{email.cc}</span>\r\n                </>\r\n              )}\r\n            </div>\r\n            \r\n            <div className=\"text-gray-500 text-sm mb-2\">\r\n              {safeRender(formatFullDate(email.date), '')}\r\n            </div>\r\n            \r\n            {emailCategories.length > 0 && (\r\n              <div className=\"flex flex-wrap gap-2 mt-2\">\r\n                {emailCategories.map((category, index) => (\r\n                  <EmailCategoryLabel \r\n                    key={index}\r\n                    name={category.name}\r\n                    color={category.color}\r\n                  />\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Contenido del email */}\r\n      <div className=\"p-6 overflow-auto flex-grow\">\r\n        {safeRender(email.body) ? (\r\n          <div \r\n            className=\"prose max-w-none\"\r\n            dangerouslySetInnerHTML={safeDangerouslySetInnerHTML(getSafeHtml(safeRender(email.body, '')))}\r\n          />\r\n        ) : (\r\n          <div className=\"text-gray-500 italic\">\r\n            (Este mensaje no tiene contenido)\r\n          </div>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Adjuntos si existen */}\r\n      {email.attachments && email.attachments.length > 0 && (\r\n        <div className=\"p-4 border-t\">\r\n          <h3 className=\"text-sm font-medium mb-2\">\r\n            Adjuntos ({email.attachments.length})\r\n          </h3>\r\n          \r\n          <div className=\"flex flex-wrap gap-3\">\r\n            {email.attachments.map((attachment, index) => {\r\n              const isImage = isImageFile(attachment.filename);\r\n              const fileExt = getFileExtension(attachment.filename);\r\n              const isTiff = fileExt === 'tiff' || fileExt === 'tif';\r\n              const isWebp = fileExt === 'webp';\r\n              \r\n              return (\r\n                <div \r\n                  key={index}\r\n                  className={`border rounded p-2 hover:border-blue-400 transition-all ${isImage ? 'cursor-zoom-in' : 'cursor-pointer'}`}\r\n                >\r\n                  {isImage ? (\r\n                    <div \r\n                      className=\"w-32 h-32 flex items-center justify-center overflow-hidden bg-gray-50 mb-1 relative\"\r\n                      onClick={() => handleImageClick(attachment)}\r\n                    >\r\n                      {isTiff ? (\r\n                        // Temporalmente deshabilitado el visor TIFF por problemas de compatibilidad\r\n                        <div className=\"text-center text-sm text-gray-400 p-2\">\r\n                          Imagen TIFF\r\n                          <div className=\"text-xs mt-1\">Visor temporalmente no disponible</div>\r\n                        </div>\r\n                      ) : isWebp ? (\r\n                        // Soporte espec√≠fico para WebP\r\n                        <picture>\r\n                          <source srcSet={attachment.dataUrl} type=\"image/webp\" />\r\n                          <img \r\n                            src={attachment.dataUrl || '/placeholder-image.png'}\r\n                            alt={attachment.filename}\r\n                            className=\"max-h-full max-w-full object-contain\"\r\n                            onError={(e) => {\r\n                              e.target.onerror = null;\r\n                              e.target.src = '/placeholder-broken-image.png';\r\n                            }}\r\n                          />\r\n                        </picture>\r\n                      ) : (\r\n                        // Otras im√°genes con fallback\r\n                        <img \r\n                          src={attachment.dataUrl || '/placeholder-image.png'}\r\n                          alt={attachment.filename}\r\n                          className=\"max-h-full max-w-full object-contain\"\r\n                          onError={(e) => {\r\n                            e.target.onerror = null;\r\n                            e.target.src = '/placeholder-broken-image.png';\r\n                          }}\r\n                        />\r\n                      )}\r\n                      {loadingImages[index] && (\r\n                        <div className=\"absolute inset-0 bg-white/70 flex items-center justify-center\">\r\n                          <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500\"></div>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"w-32 h-32 flex items-center justify-center bg-gray-50 mb-1\">\r\n                      <div className=\"bg-gray-100 w-16 h-16 flex items-center justify-center rounded shadow-sm text-2xl\">\r\n                        üìÑ\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  <div className=\"w-32\">\r\n                    <div className=\"text-sm font-medium truncate\" title={attachment.filename}>\r\n                      {attachment.filename || `adjunto-${index+1}`}\r\n                    </div>\r\n                    <div className=\"text-xs text-gray-500 flex justify-between items-center mt-1\">\r\n                      <span>{attachment.size ? `${Math.round(attachment.size / 1024)} KB` : 'Tama√±o desconocido'}</span>\r\n                      <button \r\n                        className=\"text-blue-600 hover:text-blue-800 p-1\"\r\n                        onClick={() => handleDownloadAttachment(attachment)}\r\n                        aria-label=\"Descargar archivo\"\r\n                      >\r\n                        <Download size={14} />\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        </div>\r\n      )}\r\n      \r\n      {/* Visualizador de imagen expandida */}\r\n      {expandedImage && (\r\n        <div \r\n          className=\"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4\"\r\n          onClick={handleCloseImageViewer}\r\n        >\r\n          <div className=\"max-w-4xl max-h-screen overflow-auto bg-white rounded-lg p-2\">\r\n            <div className=\"text-right mb-2\">\r\n              <button \r\n                className=\"text-gray-700 hover:text-gray-900 p-1 rounded-full hover:bg-gray-100\"\r\n                onClick={handleCloseImageViewer}\r\n              >\r\n                ‚úï\r\n              </button>\r\n            </div>\r\n            {getFileExtension(expandedImage.filename) === 'tiff' || \r\n             getFileExtension(expandedImage.filename) === 'tif' ? (\r\n              // Temporalmente deshabilitado el visor TIFF por problemas de compatibilidad\r\n              <div className=\"p-4 bg-gray-100 rounded text-center\">\r\n                <p className=\"text-gray-600 mb-2\">Vista previa de TIFF temporalmente no disponible</p>\r\n                <p className=\"text-sm text-gray-500\">El visor de archivos TIFF est√° siendo actualizado</p>\r\n              </div>\r\n            ) : (\r\n              <img \r\n                src={expandedImage.dataUrl} \r\n                alt={expandedImage.filename}\r\n                className=\"max-w-full\"\r\n              />\r\n            )}\r\n            <div className=\"mt-2 text-center text-sm text-gray-600\">\r\n              {expandedImage.filename}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      \r\n      {/* Panel de comentarios internos */}\r\n      <EmailComments emailId={email.id} />\r\n\r\n      {/* Acciones r√°pidas */}\r\n      <div className=\"p-4 border-t\">\r\n        <div className=\"flex space-x-2\">\r\n          <Button\r\n            onClick={onReply}\r\n            variant=\"primary\"\r\n            size=\"sm\"\r\n            className=\"flex items-center\"\r\n          >\r\n            <Reply size={16} className=\"mr-1\" />\r\n            Responder\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Exportaci√≥n simple sin memo\r\nexport default EmailDetail;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\UnifiedInbox\\EmailDetailAdvanced.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\UnifiedInbox\\EmailList.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Star' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":7},{"ruleId":"no-unused-vars","severity":1,"message":"'ensureNotPromise' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { \r\n  Search, \r\n  ArrowUp, \r\n  ArrowDown, \r\n  Trash, \r\n  Star, \r\n  AlertCircle,\r\n  Loader,\r\n  Star as StarIcon\r\n} from 'lucide-react';\r\nimport Button from '../../Button';\r\nimport { safeRender, ensureNotPromise, safeMap } from '../../../utils/promiseSafeRenderer';\r\n\r\n/**\r\n * Componente que muestra una lista de emails con opciones de filtrado y ordenaci√≥n\r\n * \r\n * @param {Object} props - Propiedades del componente\r\n * @param {Array} props.emails - Lista de emails a mostrar\r\n * @param {boolean} props.loading - Indicador de carga\r\n * @param {string} props.error - Mensaje de error si existe\r\n * @param {string} props.selectedEmailId - ID del email seleccionado\r\n * @param {Function} props.onSelectEmail - Funci√≥n para seleccionar un email\r\n * @param {Function} props.onDeleteEmail - Funci√≥n para eliminar un email\r\n * @param {Function} props.onSearch - Funci√≥n para buscar emails\r\n * @param {string} props.searchTerm - T√©rmino de b√∫squeda actual\r\n * @param {string} props.sortField - Campo por el que ordenar\r\n * @param {string} props.sortDirection - Direcci√≥n de ordenaci√≥n (asc/desc)\r\n * @param {Function} props.onSortChange - Funci√≥n para cambiar ordenaci√≥n\r\n * @param {string} props.currentFolder - Carpeta actual\r\n * @returns {JSX.Element} Componente de lista de emails\r\n */\r\nconst EmailList = ({\r\n  emails,\r\n  loading,\r\n  error,\r\n  selectedEmailId,\r\n  onSelectEmail,\r\n  onDeleteEmail,\r\n  onSearch,\r\n  searchTerm,\r\n  sortField,\r\n  sortDirection,\r\n  onSortChange,\r\n  currentFolder\r\n}) => {\r\n  const [selectedEmailIds, setSelectedEmailIds] = useState([]);\r\n\r\n  // Manejador para seleccionar varios emails\r\n  const handleToggleSelect = (emailId, event) => {\r\n    event.stopPropagation();\r\n    \r\n    if (selectedEmailIds.includes(emailId)) {\r\n      setSelectedEmailIds(prev => prev.filter(id => id !== emailId));\r\n    } else {\r\n      setSelectedEmailIds(prev => [...prev, emailId]);\r\n    }\r\n  };\r\n\r\n  // Manejador para seleccionar todos los emails\r\n  const handleSelectAll = () => {\r\n    if (selectedEmailIds.length === emails.length) {\r\n      setSelectedEmailIds([]);\r\n    } else {\r\n      setSelectedEmailIds(emails.map(email => email.id));\r\n    }\r\n  };\r\n\r\n  // Manejador para eliminar emails seleccionados\r\n  const handleDeleteSelected = () => {\r\n    selectedEmailIds.forEach(id => onDeleteEmail(id));\r\n    setSelectedEmailIds([]);\r\n  };\r\n\r\n  // Manejador para marcar como importante\r\n  const handleToggleImportant = (emailId, event) => {\r\n    event.stopPropagation();\r\n    // Aqu√≠ implementaremos la funcionalidad para marcar como importante\r\n    console.log('Marcar como importante:', emailId);\r\n  };\r\n\r\n  // Funci√≥n para formatear la fecha\r\n  const formatDate = (dateString) => {\r\n    const date = new Date(dateString);\r\n    const now = new Date();\r\n    \r\n    // Si es de hoy, mostrar solo la hora\r\n    if (date.toDateString() === now.toDateString()) {\r\n      return date.toLocaleTimeString('es-ES', { \r\n        hour: '2-digit', \r\n        minute: '2-digit' \r\n      });\r\n    }\r\n    \r\n    // Si es de este a√±o pero no de hoy, mostrar d√≠a y mes\r\n    if (date.getFullYear() === now.getFullYear()) {\r\n      return date.toLocaleDateString('es-ES', {\r\n        day: '2-digit',\r\n        month: '2-digit'\r\n      });\r\n    }\r\n    \r\n    // Si es de otro a√±o, mostrar d√≠a/mes/a√±o\r\n    return date.toLocaleDateString('es-ES', {\r\n      day: '2-digit',\r\n      month: '2-digit',\r\n      year: '2-digit'\r\n    });\r\n  };\r\n  \r\n  // Componente para renderizar mensaje de estado\r\n  const StatusMessage = ({ icon, message, className }) => (\r\n    <div className={`flex flex-col items-center justify-center py-16 ${className}`}>\r\n      {icon}\r\n      <p className=\"mt-4 text-sm\">{message}</p>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full\">\r\n      {/* Barra de b√∫squeda y acciones */}\r\n      <div className=\"p-4 border-b\">\r\n        <div className=\"flex items-center justify-between mb-2\">\r\n          <div className=\"relative flex-1 max-w-lg\">\r\n            <input\r\n              type=\"text\"\r\n              value={searchTerm}\r\n              onChange={(e) => onSearch(e.target.value)}\r\n              placeholder=\"Buscar emails...\"\r\n              className=\"pl-10 pr-4 py-2 border border-gray-300 rounded-lg w-full\"\r\n            />\r\n            <Search className=\"absolute left-3 top-2.5 text-gray-400\" size={18} />\r\n          </div>\r\n          \r\n          <div className=\"ml-4 flex space-x-2\">\r\n            <Button\r\n              disabled={selectedEmailIds.length === 0}\r\n              onClick={handleDeleteSelected}\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              className=\"flex items-center\"\r\n            >\r\n              <Trash size={16} className=\"mr-1\" />\r\n              <span className=\"hidden sm:inline\">Eliminar</span>\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Cabecera de tabla */}\r\n      <div className=\"border-b border-gray-200 px-4 py-2 grid grid-cols-12 gap-2 text-sm text-gray-500 font-medium bg-gray-50\">\r\n        <div className=\"col-span-1 flex items-center\">\r\n          <input\r\n            type=\"checkbox\"\r\n            checked={selectedEmailIds.length === emails.length && emails.length > 0}\r\n            onChange={handleSelectAll}\r\n            className=\"rounded\"\r\n            disabled={emails.length === 0}\r\n          />\r\n        </div>\r\n        <div\r\n          className=\"col-span-3 sm:col-span-3 flex items-center cursor-pointer\"\r\n          onClick={() => onSortChange('from')}\r\n        >\r\n          {currentFolder === 'sent' ? 'Para' : 'De'} \r\n          {sortField === 'from' && (\r\n            sortDirection === 'asc' \r\n              ? <ArrowUp size={14} className=\"inline ml-1\" /> \r\n              : <ArrowDown size={14} className=\"inline ml-1\" />\r\n          )}\r\n        </div>\r\n        <div\r\n          className=\"col-span-6 sm:col-span-6 cursor-pointer truncate\"\r\n          onClick={() => onSortChange('subject')}\r\n        >\r\n          Asunto {sortField === 'subject' && (\r\n            sortDirection === 'asc' \r\n              ? <ArrowUp size={14} className=\"inline ml-1\" /> \r\n              : <ArrowDown size={14} className=\"inline ml-1\" />\r\n          )}\r\n        </div>\r\n        <div\r\n          className=\"col-span-2 sm:col-span-2 text-right cursor-pointer\"\r\n          onClick={() => onSortChange('date')}\r\n        >\r\n          Fecha {sortField === 'date' && (\r\n            sortDirection === 'asc' \r\n              ? <ArrowUp size={14} className=\"inline ml-1\" /> \r\n              : <ArrowDown size={14} className=\"inline ml-1\" />\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Lista de emails */}\r\n      <div className=\"overflow-auto flex-grow\">\r\n        {loading ? (\r\n          <StatusMessage \r\n            icon={<Loader size={32} className=\"animate-spin text-blue-500\" />}\r\n            message=\"Cargando emails...\"\r\n            className=\"text-gray-500\"\r\n          />\r\n        ) : error ? (\r\n          <StatusMessage \r\n            icon={<AlertCircle size={32} className=\"text-red-500\" />}\r\n            message={error}\r\n            className=\"text-red-500\"\r\n          />\r\n        ) : emails.length === 0 ? (\r\n          <StatusMessage \r\n            icon={<AlertCircle size={32} className=\"text-gray-400\" />}\r\n            message=\"No hay emails en esta carpeta\"\r\n            className=\"text-gray-500\"\r\n          />\r\n        ) : (\r\n          <div className=\"divide-y divide-gray-100\" data-testid=\"email-list\">\r\n            {safeMap(emails, (item) => item).map((email) => (\r\n              <div\r\n                key={safeRender(email.id, '')}\r\n                onClick={() => onSelectEmail(safeRender(email.id, ''))}\r\n                className={`grid grid-cols-12 gap-2 px-4 py-3 hover:bg-gray-50 cursor-pointer transition-colors ${\r\n                  selectedEmailId === safeRender(email.id, '') ? 'bg-blue-50' : ''\r\n                } ${!safeRender(email.read, false) ? 'font-medium' : ''}`}\r\n              >\r\n                <div \r\n                  className=\"col-span-1 flex items-center justify-center\" \r\n                  onClick={(e) => handleToggleSelect(safeRender(email.id, ''), e)}\r\n                >\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={selectedEmailIds.includes(safeRender(email.id, ''))}\r\n                    onChange={() => {}}\r\n                    className=\"rounded\"\r\n                  />\r\n                </div>\r\n                <div className=\"col-span-3 sm:col-span-3 truncate\">\r\n                  {currentFolder === 'sent' ? safeRender(email.to, '') : safeRender(email.from, '')}\r\n                </div>\r\n                <div className=\"col-span-6 sm:col-span-6 truncate flex items-center\">\r\n                  <span className=\"mr-2 truncate\">\r\n                    {safeRender(email.subject, '(Sin asunto)')}\r\n                  </span>\r\n                  {email.attachments && email.attachments.length > 0 && (\r\n                    <span className=\"text-gray-500 text-xs\">üìé</span>\r\n                  )}\r\n                </div>\r\n                <div className=\"col-span-2 sm:col-span-2 text-right text-gray-500 text-sm flex items-center justify-end\">\r\n                  <span className=\"mr-2\">{formatDate(email.date)}</span>\r\n                  <button \r\n                    onClick={(e) => handleToggleImportant(email.id, e)}\r\n                    className={`focus:outline-none ${email.important ? 'text-yellow-500' : 'text-gray-300 hover:text-gray-400'}`}\r\n                  >\r\n                    <StarIcon size={16} />\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EmailList;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\UnifiedInbox\\EmailListAdvanced.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\UnifiedInbox\\InboxContainer.debug.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useAuth } from '../../../hooks/useAuthUnified';\r\n\r\n/**\r\n * InboxContainer de debug para aislar el error\r\n * Versi√≥n ultra simplificada sin dependencias complejas\r\n */\r\nconst InboxContainerDebug = () => {\r\n  const [debugInfo, setDebugInfo] = useState('Iniciando...');\r\n  \r\n  // Intentar obtener usuario paso a paso\r\n  let user = null;\r\n  let authError = null;\r\n  \r\n  try {\r\n    const authResult = useAuth();\r\n    user = authResult?.user || authResult?.currentUser;\r\n    setDebugInfo(`Usuario obtenido: ${user?.email || 'Sin email'}`);\r\n  } catch (err) {\r\n    authError = err;\r\n    setDebugInfo(`Error en useAuth: ${err.message}`);\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-8 bg-white\">\r\n      <h1 className=\"text-2xl font-bold mb-4\">Debug InboxContainer</h1>\r\n      \r\n      <div className=\"space-y-4\">\r\n        <div className=\"p-4 border rounded\">\r\n          <h3 className=\"font-semibold\">Estado de autenticaci√≥n:</h3>\r\n          <p>Debug Info: {debugInfo}</p>\r\n          <p>Usuario: {user ? JSON.stringify(user, null, 2) : 'null'}</p>\r\n          {authError && (\r\n            <p className=\"text-red-600\">Error: {authError.message}</p>\r\n          )}\r\n        </div>\r\n        \r\n        <div className=\"p-4 border rounded\">\r\n          <h3 className=\"font-semibold\">Componente cargado correctamente</h3>\r\n          <p>Si ves este mensaje, el componente b√°sico funciona.</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default InboxContainerDebug;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\UnifiedInbox\\InboxContainer.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\UnifiedInbox\\InboxContainer.minimal.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'emails' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":11,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useAuth } from '../../../hooks/useAuthUnified';\r\n\r\n/**\r\n * Versi√≥n m√≠nima de InboxContainer para debugging\r\n * Elimina todas las dependencias complejas que pueden estar causando el error de Promise\r\n */\r\nconst InboxContainerMinimal = () => {\r\n  const { user } = useAuth();\r\n  const [loading, setLoading] = useState(true);\r\n  const [emails, setEmails] = useState([]);\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    // Simulaci√≥n simple de carga de emails\r\n    const loadEmails = () => {\r\n      try {\r\n        setLoading(true);\r\n        // Simular delay de carga\r\n        setTimeout(() => {\r\n          setEmails([]);\r\n          setLoading(false);\r\n        }, 1000);\r\n      } catch (err) {\r\n        setError('Error al cargar emails');\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadEmails();\r\n  }, []);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-full\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto\"></div>\r\n          <p className=\"mt-2 text-gray-600\">Cargando emails...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-full\">\r\n        <div className=\"text-center text-red-600\">\r\n          <p>Error: {error}</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full bg-gray-50\">\r\n      {/* Cabecera simple */}\r\n      <div className=\"bg-white p-4 border-b shadow-sm\">\r\n        <div className=\"max-w-7xl mx-auto\">\r\n          <h1 className=\"text-2xl font-semibold text-gray-800\">Bandeja de entrada (Modo Debug)</h1>\r\n          {user?.email && (\r\n            <p className=\"text-sm text-gray-600 mt-1\">\r\n              Usuario: {user.email}\r\n            </p>\r\n          )}\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Contenido principal */}\r\n      <div className=\"flex-grow flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"text-6xl mb-4\">üìß</div>\r\n          <h2 className=\"text-xl font-medium text-gray-700 mb-2\">\r\n            Bandeja de entrada vac√≠a\r\n          </h2>\r\n          <p className=\"text-gray-500\">\r\n            No hay emails para mostrar en este momento.\r\n          </p>\r\n          <p className=\"text-sm text-blue-600 mt-4\">\r\n            ‚úÖ Componente cargado correctamente sin errores de Promise\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default InboxContainerMinimal;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\email\\UnifiedInbox\\InboxNavigation.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\finance\\BudgetAlerts.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\finance\\BudgetManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'onUpdateBudget' is defined but never used. Allowed unused args must match /^_/u.","line":14,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { Card, Button } from '../ui';\r\nimport { Plus, Edit3, Trash2, AlertTriangle, Target } from 'lucide-react';\r\nimport { formatCurrency } from '../../utils/formatUtils';\r\nimport Modal from '../Modal';\r\n\r\n/**\r\n * Componente para gesti√≥n de presupuesto y categor√≠as\r\n * Permite crear, editar y eliminar categor√≠as de presupuesto\r\n */\r\nexport default function BudgetManager({ \r\n  budget, \r\n  budgetUsage, \r\n  onUpdateBudget, \r\n  onAddCategory, \r\n  onUpdateCategory, \r\n  onRemoveCategory \r\n}) {\r\n  const [showCategoryModal, setShowCategoryModal] = useState(false);\r\n  const [editingCategory, setEditingCategory] = useState(null);\r\n  const [editingCategoryIndex, setEditingCategoryIndex] = useState(-1);\r\n  const [newCategory, setNewCategory] = useState({ name: '', amount: '' });\r\n\r\n  // Manejar apertura de modal para nueva categor√≠a\r\n  const handleAddCategory = () => {\r\n    setEditingCategory(null);\r\n    setEditingCategoryIndex(-1);\r\n    setNewCategory({ name: '', amount: '' });\r\n    setShowCategoryModal(true);\r\n  };\r\n\r\n  // Manejar apertura de modal para editar categor√≠a\r\n  const handleEditCategory = (category, index) => {\r\n    setEditingCategory(category);\r\n    setEditingCategoryIndex(index);\r\n    setNewCategory({ name: category.name, amount: category.amount.toString() });\r\n    setShowCategoryModal(true);\r\n  };\r\n\r\n  // Manejar guardado de categor√≠a\r\n  const handleSaveCategory = () => {\r\n    const amount = Number(newCategory.amount);\r\n    \r\n    if (!newCategory.name.trim()) {\r\n      alert('El nombre de la categor√≠a es obligatorio');\r\n      return;\r\n    }\r\n    \r\n    if (isNaN(amount) || amount < 0) {\r\n      alert('El monto debe ser un n√∫mero v√°lido');\r\n      return;\r\n    }\r\n\r\n    if (editingCategory) {\r\n      // Editar categor√≠a existente\r\n      onUpdateCategory(editingCategoryIndex, { \r\n        name: newCategory.name.trim(), \r\n        amount \r\n      });\r\n    } else {\r\n      // Agregar nueva categor√≠a\r\n      const result = onAddCategory(newCategory.name.trim(), amount);\r\n      if (!result.success) {\r\n        alert(result.error);\r\n        return;\r\n      }\r\n    }\r\n\r\n    setShowCategoryModal(false);\r\n    setEditingCategory(null);\r\n    setEditingCategoryIndex(-1);\r\n    setNewCategory({ name: '', amount: '' });\r\n  };\r\n\r\n  // Manejar eliminaci√≥n de categor√≠a\r\n  const handleDeleteCategory = (index, categoryName) => {\r\n    if (window.confirm(`¬øEst√°s seguro de eliminar la categor√≠a \"${categoryName}\"?`)) {\r\n      onRemoveCategory(index);\r\n    }\r\n  };\r\n\r\n  // Calcular totales\r\n  const totalBudgeted = budget.categories.reduce((sum, cat) => sum + cat.amount, 0);\r\n  const totalSpent = budgetUsage.reduce((sum, cat) => sum + cat.spent, 0);\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex justify-between items-center\">\r\n        <div>\r\n          <h2 className=\"text-xl font-semibold text-gray-900\">Gesti√≥n de Presupuesto</h2>\r\n          <p className=\"text-sm text-gray-600\">\r\n            Organiza y controla el presupuesto por categor√≠as\r\n          </p>\r\n        </div>\r\n        <Button\r\n          leftIcon={<Plus size={16} />}\r\n          onClick={handleAddCategory}\r\n        >\r\n          Nueva Categor√≠a\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Resumen general del presupuesto */}\r\n      <Card className=\"p-6\">\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n          <div className=\"text-center\">\r\n            <div className=\"flex items-center justify-center w-12 h-12 bg-blue-100 rounded-full mx-auto mb-3\">\r\n              <Target className=\"w-6 h-6 text-blue-600\" />\r\n            </div>\r\n            <p className=\"text-sm font-medium text-gray-600\">Presupuesto Total</p>\r\n            <p className=\"text-2xl font-bold text-gray-900\">{formatCurrency(budget.total)}</p>\r\n          </div>\r\n          \r\n          <div className=\"text-center\">\r\n            <div className=\"flex items-center justify-center w-12 h-12 bg-green-100 rounded-full mx-auto mb-3\">\r\n              <Target className=\"w-6 h-6 text-green-600\" />\r\n            </div>\r\n            <p className=\"text-sm font-medium text-gray-600\">Presupuestado</p>\r\n            <p className=\"text-2xl font-bold text-green-600\">{formatCurrency(totalBudgeted)}</p>\r\n          </div>\r\n          \r\n          <div className=\"text-center\">\r\n            <div className=\"flex items-center justify-center w-12 h-12 bg-red-100 rounded-full mx-auto mb-3\">\r\n              <Target className=\"w-6 h-6 text-red-600\" />\r\n            </div>\r\n            <p className=\"text-sm font-medium text-gray-600\">Gastado</p>\r\n            <p className=\"text-2xl font-bold text-red-600\">{formatCurrency(totalSpent)}</p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Barra de progreso general */}\r\n        <div className=\"mt-6\">\r\n          <div className=\"flex justify-between text-sm text-gray-600 mb-2\">\r\n            <span>Progreso del presupuesto</span>\r\n            <span>{budget.total > 0 ? ((totalSpent / budget.total) * 100).toFixed(1) : 0}%</span>\r\n          </div>\r\n          <div className=\"w-full bg-gray-200 rounded-full h-3\">\r\n            <div\r\n              className={`h-3 rounded-full transition-all duration-300 ${\r\n                totalSpent > budget.total \r\n                  ? 'bg-red-500' \r\n                  : totalSpent > budget.total * 0.8 \r\n                  ? 'bg-orange-500' \r\n                  : 'bg-green-500'\r\n              }`}\r\n              style={{ \r\n                width: `${Math.min((totalSpent / budget.total) * 100, 100)}%` \r\n              }}\r\n            />\r\n          </div>\r\n        </div>\r\n      </Card>\r\n\r\n      {/* Lista de categor√≠as */}\r\n      <Card className=\"overflow-hidden\">\r\n        <div className=\"px-6 py-4 border-b border-gray-200\">\r\n          <h3 className=\"text-lg font-medium text-gray-900\">Categor√≠as de Presupuesto</h3>\r\n        </div>\r\n        \r\n        {budgetUsage.length === 0 ? (\r\n          <div className=\"p-8 text-center\">\r\n            <p className=\"text-gray-500 mb-4\">No hay categor√≠as de presupuesto</p>\r\n            <Button onClick={handleAddCategory} leftIcon={<Plus size={16} />}>\r\n              Crear primera categor√≠a\r\n            </Button>\r\n          </div>\r\n        ) : (\r\n          <div className=\"divide-y divide-gray-200\">\r\n            {budgetUsage.map((category, index) => (\r\n              <div key={index} className=\"p-6\">\r\n                <div className=\"flex items-center justify-between mb-4\">\r\n                  <div className=\"flex items-center space-x-3\">\r\n                    <h4 className=\"text-lg font-medium text-gray-900\">\r\n                      {category.name}\r\n                    </h4>\r\n                    {category.percentage >= 100 && (\r\n                      <div className=\"flex items-center text-red-600 bg-red-50 px-2 py-1 rounded-full\">\r\n                        <AlertTriangle size={14} className=\"mr-1\" />\r\n                        <span className=\"text-xs font-medium\">Excedido</span>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  \r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <button\r\n                      onClick={() => handleEditCategory(category, index)}\r\n                      className=\"text-blue-600 hover:text-blue-800 p-1\"\r\n                    >\r\n                      <Edit3 size={16} />\r\n                    </button>\r\n                    <button\r\n                      onClick={() => handleDeleteCategory(index, category.name)}\r\n                      className=\"text-red-600 hover:text-red-800 p-1\"\r\n                    >\r\n                      <Trash2 size={16} />\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4\">\r\n                  <div>\r\n                    <p className=\"text-sm text-gray-600\">Presupuestado</p>\r\n                    <p className=\"text-lg font-semibold text-gray-900\">\r\n                      {formatCurrency(category.amount)}\r\n                    </p>\r\n                  </div>\r\n                  <div>\r\n                    <p className=\"text-sm text-gray-600\">Gastado</p>\r\n                    <p className=\"text-lg font-semibold text-red-600\">\r\n                      {formatCurrency(category.spent)}\r\n                    </p>\r\n                  </div>\r\n                  <div>\r\n                    <p className=\"text-sm text-gray-600\">Restante</p>\r\n                    <p className={`text-lg font-semibold ${\r\n                      category.remaining >= 0 ? 'text-green-600' : 'text-red-600'\r\n                    }`}>\r\n                      {formatCurrency(category.remaining)}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Barra de progreso de la categor√≠a */}\r\n                <div>\r\n                  <div className=\"flex justify-between text-sm text-gray-600 mb-2\">\r\n                    <span>Progreso</span>\r\n                    <span>{category.percentage.toFixed(1)}%</span>\r\n                  </div>\r\n                  <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n                    <div\r\n                      className={`h-2 rounded-full transition-all duration-300 ${\r\n                        category.percentage >= 100 \r\n                          ? 'bg-red-500' \r\n                          : category.percentage >= 75 \r\n                          ? 'bg-orange-500' \r\n                          : 'bg-green-500'\r\n                      }`}\r\n                      style={{ \r\n                        width: `${Math.min(category.percentage, 100)}%` \r\n                      }}\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </Card>\r\n\r\n      {/* Modal para agregar/editar categor√≠a */}\r\n      <Modal\r\n        open={showCategoryModal}\r\n        onClose={() => {\r\n          setShowCategoryModal(false);\r\n          setEditingCategory(null);\r\n          setEditingCategoryIndex(-1);\r\n          setNewCategory({ name: '', amount: '' });\r\n        }}\r\n        title={editingCategory ? 'Editar Categor√≠a' : 'Nueva Categor√≠a'}\r\n      >\r\n        <div className=\"space-y-4\">\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n              Nombre de la categor√≠a\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              value={newCategory.name}\r\n              onChange={(e) => setNewCategory({ ...newCategory, name: e.target.value })}\r\n              placeholder=\"Ej: Catering, M√∫sica, Flores...\"\r\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n              Presupuesto asignado (‚Ç¨)\r\n            </label>\r\n            <input\r\n              type=\"number\"\r\n              step=\"0.01\"\r\n              min=\"0\"\r\n              value={newCategory.amount}\r\n              onChange={(e) => setNewCategory({ ...newCategory, amount: e.target.value })}\r\n              placeholder=\"0.00\"\r\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex justify-end space-x-3 pt-4\">\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => {\r\n                setShowCategoryModal(false);\r\n                setEditingCategory(null);\r\n                setEditingCategoryIndex(-1);\r\n                setNewCategory({ name: '', amount: '' });\r\n              }}\r\n            >\r\n              Cancelar\r\n            </Button>\r\n            <Button onClick={handleSaveCategory}>\r\n              {editingCategory ? 'Actualizar' : 'Crear'} Categor√≠a\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </Modal>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\finance\\CategoryBreakdown.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\finance\\ContributionSettings.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\finance\\FinanceCharts.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\finance\\FinanceOverview.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\finance\\TransactionForm.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\finance\\TransactionManager.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Filter' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":57,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":63}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo } from 'react';\r\nimport { Card, Button } from '../ui';\r\nimport { Plus, Edit3, Trash2, Download, Upload, Search, Filter } from 'lucide-react';\r\nimport { formatCurrency, formatDate } from '../../utils/formatUtils';\r\nimport Modal from '../Modal';\r\nimport TransactionForm from './TransactionForm';\r\n\r\n/**\r\n * Componente para gesti√≥n de transacciones\r\n * Incluye lista, filtros, formularios y acciones masivas\r\n */\r\nexport default function TransactionManager({ \r\n  transactions, \r\n  onCreateTransaction, \r\n  onUpdateTransaction, \r\n  onDeleteTransaction,\r\n  onImportBank,\r\n  isLoading \r\n}) {\r\n  // Estados para filtros y modales\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [typeFilter, setTypeFilter] = useState('');\r\n  const [categoryFilter, setCategoryFilter] = useState('');\r\n  const [showTransactionModal, setShowTransactionModal] = useState(false);\r\n  const [editingTransaction, setEditingTransaction] = useState(null);\r\n\r\n  // Transacciones filtradas\r\n  const filteredTransactions = useMemo(() => {\r\n    return transactions.filter(transaction => {\r\n      const matchesSearch = transaction.concept?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n                           transaction.description?.toLowerCase().includes(searchTerm.toLowerCase());\r\n      const matchesType = !typeFilter || transaction.type === typeFilter;\r\n      const matchesCategory = !categoryFilter || transaction.category === categoryFilter;\r\n      \r\n      return matchesSearch && matchesType && matchesCategory;\r\n    });\r\n  }, [transactions, searchTerm, typeFilter, categoryFilter]);\r\n\r\n  // Categor√≠as √∫nicas para el filtro\r\n  const categories = useMemo(() => {\r\n    const uniqueCategories = [...new Set(transactions.map(t => t.category).filter(Boolean))];\r\n    return uniqueCategories.sort();\r\n  }, [transactions]);\r\n\r\n  // Estad√≠sticas de transacciones filtradas\r\n  const stats = useMemo(() => {\r\n    const totalIncome = filteredTransactions\r\n      .filter(t => t.type === 'income')\r\n      .reduce((sum, t) => sum + (Number(t.amount) || 0), 0);\r\n    \r\n    const totalExpenses = filteredTransactions\r\n      .filter(t => t.type === 'expense')\r\n      .reduce((sum, t) => sum + (Number(t.amount) || 0), 0);\r\n\r\n    return {\r\n      totalIncome,\r\n      totalExpenses,\r\n      balance: totalIncome - totalExpenses,\r\n      count: filteredTransactions.length\r\n    };\r\n  }, [filteredTransactions]);\r\n\r\n  // Manejar apertura de modal para nueva transacci√≥n\r\n  const handleAddTransaction = () => {\r\n    setEditingTransaction(null);\r\n    setShowTransactionModal(true);\r\n  };\r\n\r\n  // Manejar apertura de modal para editar transacci√≥n\r\n  const handleEditTransaction = (transaction) => {\r\n    setEditingTransaction(transaction);\r\n    setShowTransactionModal(true);\r\n  };\r\n\r\n  // Manejar guardado de transacci√≥n\r\n  const handleSaveTransaction = async (transactionData) => {\r\n    try {\r\n      let result;\r\n      if (editingTransaction) {\r\n        result = await onUpdateTransaction(editingTransaction.id, transactionData);\r\n      } else {\r\n        result = await onCreateTransaction(transactionData);\r\n      }\r\n      \r\n      if (result.success) {\r\n        setShowTransactionModal(false);\r\n        setEditingTransaction(null);\r\n      } else {\r\n        alert(`Error: ${result.error}`);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error guardando transacci√≥n:', error);\r\n      alert('Error inesperado al guardar la transacci√≥n');\r\n    }\r\n  };\r\n\r\n  // Manejar eliminaci√≥n de transacci√≥n\r\n  const handleDeleteTransaction = async (transaction) => {\r\n    if (window.confirm(`¬øEst√°s seguro de eliminar la transacci√≥n \"${transaction.concept}\"?`)) {\r\n      const result = await onDeleteTransaction(transaction.id);\r\n      if (!result.success) {\r\n        alert(`Error eliminando transacci√≥n: ${result.error}`);\r\n      }\r\n    }\r\n  };\r\n\r\n  // Exportar transacciones a CSV\r\n  const handleExportCSV = () => {\r\n    const headers = ['Fecha', 'Concepto', 'Tipo', 'Categor√≠a', 'Monto'];\r\n    const csvData = [\r\n      headers.join(','),\r\n      ...filteredTransactions.map(t => [\r\n        t.date,\r\n        `\"${t.concept || t.description || ''}\"`,\r\n        t.type === 'income' ? 'Ingreso' : 'Gasto',\r\n        t.category || '',\r\n        t.amount || 0\r\n      ].join(','))\r\n    ].join('\\n');\r\n\r\n    const blob = new Blob([csvData], { type: 'text/csv;charset=utf-8;' });\r\n    const link = document.createElement('a');\r\n    link.href = URL.createObjectURL(blob);\r\n    link.download = `transacciones_${new Date().toISOString().split('T')[0]}.csv`;\r\n    link.click();\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header con acciones */}\r\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\r\n        <div>\r\n          <h2 className=\"text-xl font-semibold text-gray-900\">Transacciones</h2>\r\n          <p className=\"text-sm text-gray-600\">\r\n            {stats.count} transacciones ‚Ä¢ Balance: {formatCurrency(stats.balance)}\r\n          </p>\r\n        </div>\r\n        \r\n        <div className=\"flex flex-wrap gap-2\">\r\n          <Button\r\n            variant=\"outline\"\r\n            leftIcon={<Upload size={16} />}\r\n            onClick={onImportBank}\r\n            disabled={isLoading}\r\n          >\r\n            Importar Banco\r\n          </Button>\r\n          <Button\r\n            variant=\"outline\"\r\n            leftIcon={<Download size={16} />}\r\n            onClick={handleExportCSV}\r\n          >\r\n            Exportar CSV\r\n          </Button>\r\n          <Button\r\n            leftIcon={<Plus size={16} />}\r\n            onClick={handleAddTransaction}\r\n          >\r\n            Nueva Transacci√≥n\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Filtros */}\r\n      <Card className=\"p-4\">\r\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n          {/* B√∫squeda */}\r\n          <div className=\"relative\">\r\n            <Search size={16} className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" />\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Buscar por concepto...\"\r\n              value={searchTerm}\r\n              onChange={(e) => setSearchTerm(e.target.value)}\r\n              className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n            />\r\n          </div>\r\n\r\n          {/* Filtro por tipo */}\r\n          <select\r\n            value={typeFilter}\r\n            onChange={(e) => setTypeFilter(e.target.value)}\r\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n          >\r\n            <option value=\"\">Todos los tipos</option>\r\n            <option value=\"income\">Ingresos</option>\r\n            <option value=\"expense\">Gastos</option>\r\n          </select>\r\n\r\n          {/* Filtro por categor√≠a */}\r\n          <select\r\n            value={categoryFilter}\r\n            onChange={(e) => setCategoryFilter(e.target.value)}\r\n            className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n          >\r\n            <option value=\"\">Todas las categor√≠as</option>\r\n            {categories.map(category => (\r\n              <option key={category} value={category}>{category}</option>\r\n            ))}\r\n          </select>\r\n\r\n          {/* Limpiar filtros */}\r\n          <Button\r\n            variant=\"outline\"\r\n            onClick={() => {\r\n              setSearchTerm('');\r\n              setTypeFilter('');\r\n              setCategoryFilter('');\r\n            }}\r\n            className=\"w-full\"\r\n          >\r\n            Limpiar Filtros\r\n          </Button>\r\n        </div>\r\n      </Card>\r\n\r\n      {/* Lista de transacciones */}\r\n      <Card className=\"overflow-hidden\">\r\n        {filteredTransactions.length === 0 ? (\r\n          <div className=\"p-8 text-center\">\r\n            <p className=\"text-gray-500\">No hay transacciones que mostrar</p>\r\n            <Button\r\n              className=\"mt-4\"\r\n              onClick={handleAddTransaction}\r\n              leftIcon={<Plus size={16} />}\r\n            >\r\n              Crear primera transacci√≥n\r\n            </Button>\r\n          </div>\r\n        ) : (\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"w-full\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    Fecha\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    Concepto\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    Categor√≠a\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    Tipo\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    Monto\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    Acciones\r\n                  </th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                {filteredTransactions.map((transaction) => (\r\n                  <tr key={transaction.id} className=\"hover:bg-gray-50\">\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\r\n                      {formatDate(transaction.date)}\r\n                    </td>\r\n                    <td className=\"px-6 py-4 text-sm text-gray-900\">\r\n                      <div className=\"max-w-xs truncate\">\r\n                        {transaction.concept || transaction.description || 'Sin concepto'}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                      <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800\">\r\n                        {transaction.category || 'Sin categor√≠a'}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\r\n                      <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${\r\n                        transaction.type === 'income' \r\n                          ? 'bg-green-100 text-green-800' \r\n                          : 'bg-red-100 text-red-800'\r\n                      }`}>\r\n                        {transaction.type === 'income' ? 'Ingreso' : 'Gasto'}\r\n                      </span>\r\n                    </td>\r\n                    <td className={`px-6 py-4 whitespace-nowrap text-sm font-medium text-right ${\r\n                      transaction.type === 'income' ? 'text-green-600' : 'text-red-600'\r\n                    }`}>\r\n                      {transaction.type === 'income' ? '+' : '-'}{formatCurrency(Math.abs(transaction.amount || 0))}\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\r\n                      <div className=\"flex justify-end space-x-2\">\r\n                        <button\r\n                          onClick={() => handleEditTransaction(transaction)}\r\n                          className=\"text-blue-600 hover:text-blue-900\"\r\n                        >\r\n                          <Edit3 size={16} />\r\n                        </button>\r\n                        <button\r\n                          onClick={() => handleDeleteTransaction(transaction)}\r\n                          className=\"text-red-600 hover:text-red-900\"\r\n                        >\r\n                          <Trash2 size={16} />\r\n                        </button>\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        )}\r\n      </Card>\r\n\r\n      {/* Modal de formulario de transacci√≥n */}\r\n      <Modal\r\n        open={showTransactionModal}\r\n        onClose={() => {\r\n          setShowTransactionModal(false);\r\n          setEditingTransaction(null);\r\n        }}\r\n        title={editingTransaction ? 'Editar Transacci√≥n' : 'Nueva Transacci√≥n'}\r\n        size=\"lg\"\r\n      >\r\n        <TransactionForm\r\n          transaction={editingTransaction}\r\n          onSave={handleSaveTransaction}\r\n          onCancel={() => {\r\n            setShowTransactionModal(false);\r\n            setEditingTransaction(null);\r\n          }}\r\n          isLoading={isLoading}\r\n        />\r\n      </Modal>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\finance\\VendorPayments.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\gallery\\InspirationGallery.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\guests\\GuestBulkGrid.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\guests\\GuestFilters.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\guests\\GuestForm.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\guests\\GuestList.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'format' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":21,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo, useCallback } from 'react';\r\nimport { User, Phone, Mail, Edit2, Trash2, MessageCircle } from 'lucide-react';\r\nimport { Button } from '../ui';\r\nimport useTranslations from '../../hooks/useTranslations';\r\n\r\n/**\r\n * Lista optimizada de invitados con filtrado y acciones\r\n * Componente memoizado para mejor rendimiento\r\n */\r\nconst GuestList = React.memo(({ \r\n  guests = [], \r\n  searchTerm = '', \r\n  statusFilter = '', \r\n  tableFilter = '',\r\n  onEdit,\r\n  onDelete,\r\n  onInviteWhatsApp,\r\n  onInviteEmail,\r\n  isLoading = false\r\n}) => {\r\n  const { t, wedding, format } = useTranslations();\r\n\r\n  // Filtrado optimizado con useMemo\r\n  const filteredGuests = useMemo(() => {\r\n    return guests.filter(guest => {\r\n      const matchesSearch = !searchTerm || \r\n        guest.name?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        guest.email?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        guest.phone?.includes(searchTerm);\r\n      \r\n      const matchesStatus = !statusFilter || \r\n        guest.status === statusFilter ||\r\n        guest.response === statusFilter;\r\n      \r\n      const matchesTable = !tableFilter || \r\n        guest.table?.toString().includes(tableFilter);\r\n      \r\n      return matchesSearch && matchesStatus && matchesTable;\r\n    });\r\n  }, [guests, searchTerm, statusFilter, tableFilter]);\r\n\r\n  // Estad√≠sticas memoizadas\r\n  const stats = useMemo(() => {\r\n    const confirmed = guests.filter(g => g.status === 'confirmed' || g.response === 'S√≠').length;\r\n    const pending = guests.filter(g => g.status === 'pending' || g.response === 'Pendiente').length;\r\n    const declined = guests.filter(g => g.status === 'declined' || g.response === 'No').length;\r\n    const totalCompanions = guests.reduce((sum, g) => sum + (parseInt(g.companion, 10) || 0), 0);\r\n    \r\n    return {\r\n      total: guests.length,\r\n      confirmed,\r\n      pending,\r\n      declined,\r\n      totalAttendees: confirmed + totalCompanions\r\n    };\r\n  }, [guests]);\r\n\r\n  // Funciones de acci√≥n memoizadas\r\n  const handleEdit = useCallback((guest) => {\r\n    onEdit?.(guest);\r\n  }, [onEdit]);\r\n\r\n  const handleDelete = useCallback((guest) => {\r\n    if (window.confirm(`¬øEst√°s seguro de que quieres eliminar a ${guest.name}?`)) {\r\n      onDelete?.(guest);\r\n    }\r\n  }, [onDelete]);\r\n\r\n  const handleWhatsApp = useCallback((guest) => {\r\n    onInviteWhatsApp?.(guest);\r\n  }, [onInviteWhatsApp]);\r\n\r\n  const handleEmail = useCallback((guest) => {\r\n    onInviteEmail?.(guest);\r\n  }, [onInviteEmail]);\r\n\r\n  // Funci√≥n para obtener el color del estado\r\n  const getStatusColor = useCallback((status) => {\r\n    switch (status) {\r\n      case 'confirmed':\r\n      case 'S√≠':\r\n        return 'text-green-600 bg-green-100';\r\n      case 'declined':\r\n      case 'No':\r\n        return 'text-red-600 bg-red-100';\r\n      default:\r\n        return 'text-yellow-600 bg-yellow-100';\r\n    }\r\n  }, []);\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"flex justify-center items-center py-12\">\r\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\r\n        <span className=\"ml-2 text-gray-600\">Cargando invitados...</span>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Estad√≠sticas */}\r\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n        <div className=\"bg-white p-4 rounded-lg shadow-sm border\">\r\n          <div className=\"text-2xl font-bold text-blue-600\">{stats.total}</div>\r\n          <div className=\"text-sm text-gray-600\">{t('guests.totalGuests')}</div>\r\n        </div>\r\n        <div className=\"bg-white p-4 rounded-lg shadow-sm border\">\r\n          <div className=\"text-2xl font-bold text-green-600\">{stats.confirmed}</div>\r\n          <div className=\"text-sm text-gray-600\">{t('guests.confirmedGuests')}</div>\r\n        </div>\r\n        <div className=\"bg-white p-4 rounded-lg shadow-sm border\">\r\n          <div className=\"text-2xl font-bold text-yellow-600\">{stats.pending}</div>\r\n          <div className=\"text-sm text-gray-600\">{t('guests.pendingGuests')}</div>\r\n        </div>\r\n        <div className=\"bg-white p-4 rounded-lg shadow-sm border\">\r\n          <div className=\"text-2xl font-bold text-purple-600\">{stats.totalAttendees}</div>\r\n          <div className=\"text-sm text-gray-600\">Total asistentes</div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Lista de invitados */}\r\n      {filteredGuests.length === 0 ? (\r\n        <div className=\"text-center py-12 bg-gray-50 rounded-lg\">\r\n          <User size={48} className=\"mx-auto text-gray-400 mb-4\" />\r\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\r\n            No se encontraron invitados\r\n          </h3>\r\n          <p className=\"text-gray-600\">\r\n            {searchTerm || statusFilter || tableFilter\r\n              ? 'Intenta ajustar los filtros de b√∫squeda'\r\n              : 'A√±ade tu primer invitado para comenzar'\r\n            }\r\n          </p>\r\n        </div>\r\n      ) : (\r\n        <>\r\n          {/* Vista de escritorio */}\r\n          <div className=\"hidden md:block bg-white rounded-lg shadow-sm border overflow-hidden\">\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"min-w-full divide-y divide-gray-200\">\r\n                <thead className=\"bg-gray-50\">\r\n                  <tr>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Invitado\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Contacto\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Estado\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Mesa\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Acompa√±antes\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                      Acciones\r\n                    </th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                  {filteredGuests.map((guest) => (\r\n                    <tr key={guest.id} className=\"hover:bg-gray-50\">\r\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                        <div className=\"flex items-center\">\r\n                          <div className=\"flex-shrink-0 h-10 w-10\">\r\n                            <div className=\"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center\">\r\n                              <User size={20} className=\"text-gray-600\" />\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"ml-4\">\r\n                            <div className=\"text-sm font-medium text-gray-900\">\r\n                              {guest.name}\r\n                            </div>\r\n                            {guest.dietaryRestrictions && (\r\n                              <div className=\"text-xs text-orange-600\">\r\n                                Restricciones diet√©ticas\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                        <div className=\"text-sm text-gray-900\">{guest.email}</div>\r\n                        <div className=\"text-sm text-gray-500\">{guest.phone}</div>\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                        <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${getStatusColor(guest.status || guest.response)}`}>\r\n                          {wedding.guestStatus(guest.status) || guest.response}\r\n                        </span>\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\r\n                        {guest.table || '-'}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\r\n                        {guest.companion || 0}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\r\n                        <div className=\"flex justify-end space-x-2\">\r\n                          {guest.phone && (\r\n                            <Button\r\n                              variant=\"outline\"\r\n                              size=\"sm\"\r\n                              onClick={() => handleWhatsApp(guest)}\r\n                              title=\"Invitar por WhatsApp\"\r\n                            >\r\n                              <MessageCircle size={16} />\r\n                            </Button>\r\n                          )}\r\n                          {guest.email && (\r\n                            <Button\r\n                              variant=\"outline\"\r\n                              size=\"sm\"\r\n                              onClick={() => handleEmail(guest)}\r\n                              title=\"Invitar por email\"\r\n                            >\r\n                              <Mail size={16} />\r\n                            </Button>\r\n                          )}\r\n                          <Button\r\n                            variant=\"outline\"\r\n                            size=\"sm\"\r\n                            onClick={() => handleEdit(guest)}\r\n                            title=\"Editar invitado\"\r\n                          >\r\n                            <Edit2 size={16} />\r\n                          </Button>\r\n                          <Button\r\n                            variant=\"outline\"\r\n                            size=\"sm\"\r\n                            onClick={() => handleDelete(guest)}\r\n                            title=\"Eliminar invitado\"\r\n                            className=\"text-red-600 hover:text-red-700\"\r\n                          >\r\n                            <Trash2 size={16} />\r\n                          </Button>\r\n                        </div>\r\n                      </td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Vista m√≥vil */}\r\n          <div className=\"md:hidden space-y-4\">\r\n            {filteredGuests.map((guest) => (\r\n              <div key={guest.id} className=\"bg-white p-4 rounded-lg shadow-sm border\">\r\n                <div className=\"flex justify-between items-start mb-3\">\r\n                  <div className=\"flex items-center\">\r\n                    <div className=\"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center mr-3\">\r\n                      <User size={20} className=\"text-gray-600\" />\r\n                    </div>\r\n                    <div>\r\n                      <h3 className=\"text-sm font-medium text-gray-900\">{guest.name}</h3>\r\n                      <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${getStatusColor(guest.status || guest.response)}`}>\r\n                        {wedding.guestStatus(guest.status) || guest.response}\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                \r\n                <div className=\"space-y-2 text-sm text-gray-600 mb-4\">\r\n                  {guest.email && (\r\n                    <div className=\"flex items-center\">\r\n                      <Mail size={14} className=\"mr-2\" />\r\n                      {guest.email}\r\n                    </div>\r\n                  )}\r\n                  {guest.phone && (\r\n                    <div className=\"flex items-center\">\r\n                      <Phone size={14} className=\"mr-2\" />\r\n                      {guest.phone}\r\n                    </div>\r\n                  )}\r\n                  <div className=\"flex justify-between\">\r\n                    <span>Mesa: {guest.table || '-'}</span>\r\n                    <span>Acompa√±antes: {guest.companion || 0}</span>\r\n                  </div>\r\n                  {guest.dietaryRestrictions && (\r\n                    <div className=\"text-orange-600 text-xs\">\r\n                      Restricciones diet√©ticas\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                <div className=\"flex justify-end space-x-2\">\r\n                  {guest.phone && (\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      onClick={() => handleWhatsApp(guest)}\r\n                    >\r\n                      <MessageCircle size={16} />\r\n                    </Button>\r\n                  )}\r\n                  {guest.email && (\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      onClick={() => handleEmail(guest)}\r\n                    >\r\n                      <Mail size={16} />\r\n                    </Button>\r\n                  )}\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    onClick={() => handleEdit(guest)}\r\n                  >\r\n                    <Edit2 size={16} />\r\n                  </Button>\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    onClick={() => handleDelete(guest)}\r\n                    className=\"text-red-600 hover:text-red-700\"\r\n                  >\r\n                    <Trash2 size={16} />\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n});\r\n\r\nGuestList.displayName = 'GuestList';\r\n\r\nexport default GuestList;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\invitations\\InvitationCanvas.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'template' is defined but never used. Allowed unused args must match /^_/u.","line":9,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect } from 'react';\r\nimport Draggable from 'react-draggable';\r\nimport PropTypes from 'prop-types';\r\n\r\nconst CANVAS_WIDTH = 600;\r\nconst CANVAS_HEIGHT = 850; // A5 vertical\r\n\r\nconst InvitationCanvas = React.forwardRef(function InvitationCanvas(\r\n  { template, elements, setElements, scale, selectedId, onSelect },\r\n  ref,\r\n) {\r\n  // Seed demo elements only once\r\n  useEffect(() => {\r\n    if (elements.length === 0) {\r\n      setElements([\r\n        { id: 1, type: 'text', content: 'Nombre de los novios', x: 100, y: 200 },\r\n        { id: 2, type: 'text', content: 'Fecha del evento', x: 100, y: 260 },\r\n      ]);\r\n    }\r\n  }, [elements.length, setElements]);\r\n\r\n  const handleStop = (e, data, id) => {\r\n    setElements((prev) =>\r\n      prev.map((el) => (el.id === id ? { ...el, x: data.x, y: data.y } : el)),\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-4\">\r\n      <div\r\n        ref={ref}\r\n        className=\"relative bg-white shadow-md border mx-auto\"\r\n        style={{ width: CANVAS_WIDTH * scale, height: CANVAS_HEIGHT * scale, transformOrigin: 'top left', transform: `scale(${scale})` }}\r\n        role=\"region\"\r\n        aria-label=\"Lienzo de invitaci√≥n\"\r\n      >\r\n        {/* Bleed area */}\r\n        <div\r\n          className=\"absolute inset-0 border-dashed border-red-400 pointer-events-none\"\r\n          style={{ margin: 12 }}\r\n          aria-hidden=\"true\"\r\n        />\r\n\r\n        {elements.map((el) => (\r\n          <Draggable\r\n            key={el.id}\r\n            position={{ x: el.x, y: el.y }}\r\n            onStop={(e, d) => handleStop(e, d, el.id)}\r\n            bounds=\"parent\"\r\n          >\r\n            {el.type === 'text' ? (\r\n              <div\r\n                className={`cursor-move select-none text-gray-800 ${selectedId===el.id ? 'ring-2 ring-blue-500' : ''}`}\r\n                onMouseDown={() => onSelect(el.id)}\r\n              >\r\n                {el.content}\r\n              </div>\r\n            ) : null}\r\n          </Draggable>\r\n        ))}\r\n      </div>\r\n      <p className=\"text-xs text-gray-500 text-center mt-2\">\r\n        Arrastra los textos para recolocarlos (demo). Pr√≥ximamente: a√±adir nuevos elementos y propiedades.\r\n      </p>\r\n    </div>\r\n  );\r\n});\r\n\r\nInvitationCanvas.propTypes = {\r\n  template: PropTypes.object.isRequired,\r\n  elements: PropTypes.array.isRequired,\r\n  setElements: PropTypes.func.isRequired,\r\n  scale: PropTypes.number.isRequired,\r\n  selectedId: PropTypes.number,\r\n  onSelect: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default InvitationCanvas;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\invitations\\LayerPanel.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\invitations\\PropertyPanel.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\invitations\\TemplateGallery.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\invitations\\Toolbar.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\layout\\MainLayout.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\metrics\\MetricsDashboard.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'isMobile' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":41,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":41,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Panel de visualizaci√≥n de m√©tricas del sistema de emails\r\n * \r\n * Este componente muestra estad√≠sticas y m√©tricas de rendimiento\r\n * recopiladas por el sistema de monitoreo para el m√≥dulo de emails y plantillas.\r\n * \r\n * @module components/metrics/MetricsDashboard\r\n */\r\n\r\nimport React, { useState, useEffect, useMemo } from 'react';\r\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, \r\n         LineChart, Line, PieChart, Pie, Cell } from 'recharts';\r\nimport { RefreshCw, Filter, ChevronDown, Download } from 'lucide-react';\r\nimport Card from '../Card';\r\nimport Button from '../Button';\r\nimport { performanceMonitor } from '../../services/PerformanceMonitor';\r\nimport { useMediaQuery } from '../../hooks/useMediaQuery';\r\n\r\n// Colores para los gr√°ficos\r\nconst COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884d8', '#82ca9d', '#ffc658'];\r\n\r\n/**\r\n * Componente para visualizar m√©tricas del sistema de emails y plantillas\r\n * @returns {React.ReactElement} Dashboard de m√©tricas\r\n */\r\nconst MetricsDashboard = () => {\r\n  // Estados para almacenar las m√©tricas\r\n  const [metrics, setMetrics] = useState({\r\n    counters: {},\r\n    timings: {},\r\n    events: [],\r\n    errors: []\r\n  });\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const [timeRange, setTimeRange] = useState('24h'); // 24h, 7d, 30d, all\r\n  const [filterCategory, setFilterCategory] = useState('all');\r\n  const [showFilters, setShowFilters] = useState(false);\r\n  \r\n  // Detectar dispositivos m√≥viles\r\n  const isMobile = useMediaQuery('(max-width: 768px)');\r\n  \r\n  // Cargar m√©tricas desde el servicio de monitoreo\r\n  const loadMetrics = async () => {\r\n    setLoading(true);\r\n    setError('');\r\n    \r\n    try {\r\n      // En producci√≥n, estas m√©tricas vendr√≠an de una API\r\n      // Por ahora usamos las m√©tricas almacenadas en localStorage por el monitor\r\n      let rawMetrics;\r\n      try {\r\n        rawMetrics = JSON.parse(localStorage.getItem('lovenda_last_metrics') || '{}');\r\n      } catch (e) {\r\n        rawMetrics = {\r\n          counters: {},\r\n          timings: {},\r\n          events: [],\r\n          errors: []\r\n        };\r\n      }\r\n      \r\n      // Tambi√©n a√±adimos las m√©tricas actuales del monitor\r\n      const currentMetrics = {\r\n        counters: { ...performanceMonitor.metrics.counters },\r\n        timings: { ...performanceMonitor.metrics.timings },\r\n        events: [...performanceMonitor.metrics.events],\r\n        errors: [...performanceMonitor.metrics.errors]\r\n      };\r\n      \r\n      // Combinamos ambas fuentes\r\n      const combinedMetrics = {\r\n        counters: { ...rawMetrics.counters, ...currentMetrics.counters },\r\n        timings: { ...rawMetrics.timings, ...currentMetrics.timings },\r\n        events: [...(rawMetrics.events || []), ...currentMetrics.events],\r\n        errors: [...(rawMetrics.errors || []), ...currentMetrics.errors]\r\n      };\r\n      \r\n      // Filtrar por rango de tiempo si es necesario\r\n      if (timeRange !== 'all') {\r\n        const now = Date.now();\r\n        let timeLimit;\r\n        \r\n        switch (timeRange) {\r\n          case '24h':\r\n            timeLimit = now - (24 * 60 * 60 * 1000);\r\n            break;\r\n          case '7d':\r\n            timeLimit = now - (7 * 24 * 60 * 60 * 1000);\r\n            break;\r\n          case '30d':\r\n            timeLimit = now - (30 * 24 * 60 * 60 * 1000);\r\n            break;\r\n          default:\r\n            timeLimit = 0;\r\n        }\r\n        \r\n        combinedMetrics.events = combinedMetrics.events.filter(\r\n          event => event.timestamp >= timeLimit\r\n        );\r\n        combinedMetrics.errors = combinedMetrics.errors.filter(\r\n          error => error.timestamp >= timeLimit\r\n        );\r\n      }\r\n      \r\n      setMetrics(combinedMetrics);\r\n    } catch (err) {\r\n      console.error('Error al cargar m√©tricas:', err);\r\n      setError('No se pudieron cargar las m√©tricas');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n  \r\n  // Cargar m√©tricas al iniciar el componente\r\n  useEffect(() => {\r\n    loadMetrics();\r\n  }, [timeRange, filterCategory]);\r\n  \r\n  // Preparar datos para el gr√°fico de uso de plantillas por categor√≠a\r\n  const templateUsageByCategory = useMemo(() => {\r\n    const categoryCounters = {};\r\n    \r\n    // Contar eventos por categor√≠a\r\n    metrics.events\r\n      .filter(event => event.name === 'template_usage')\r\n      .forEach(event => {\r\n        const category = event.data.category || 'Sin categor√≠a';\r\n        if (!categoryCounters[category]) {\r\n          categoryCounters[category] = 0;\r\n        }\r\n        categoryCounters[category]++;\r\n      });\r\n    \r\n    // Convertir a formato para gr√°fico\r\n    return Object.entries(categoryCounters).map(([category, count]) => ({\r\n      name: category,\r\n      value: count\r\n    }));\r\n  }, [metrics.events]);\r\n  \r\n  // Preparar datos para el gr√°fico de tipos de operaciones\r\n  const operationTypes = useMemo(() => {\r\n    const operations = {};\r\n    \r\n    // Buscar operaciones en contadores\r\n    Object.entries(metrics.counters)\r\n      .filter(([key]) => key.startsWith('template_') || key.startsWith('email_operation_'))\r\n      .forEach(([key, value]) => {\r\n        const operation = key.replace('template_', '').replace('email_operation_', '');\r\n        operations[operation] = value;\r\n      });\r\n    \r\n    // Convertir a formato para gr√°fico\r\n    return Object.entries(operations).map(([name, value]) => ({\r\n      name,\r\n      value\r\n    }));\r\n  }, [metrics.counters]);\r\n  \r\n  // Preparar datos para el gr√°fico de tiempos de operaci√≥n\r\n  const operationTimings = useMemo(() => {\r\n    return Object.entries(metrics.timings)\r\n      .filter(([key]) => key.startsWith('email_') || key.startsWith('template_'))\r\n      .map(([key, timing]) => ({\r\n        name: key.replace('email_', '').replace('template_', ''),\r\n        avg: timing.total / timing.count,\r\n        min: timing.min,\r\n        max: timing.max\r\n      }));\r\n  }, [metrics.timings]);\r\n  \r\n  // Preparar lista de errores recientes\r\n  const recentErrors = useMemo(() => {\r\n    return metrics.errors\r\n      .filter(error => error.type.startsWith('email_') || error.type.includes('template'))\r\n      .sort((a, b) => b.timestamp - a.timestamp)\r\n      .slice(0, 5);\r\n  }, [metrics.errors]);\r\n  \r\n  // Descargar m√©tricas en formato CSV\r\n  const downloadMetrics = () => {\r\n    // Crear contenido CSV\r\n    let csvContent = \"data:text/csv;charset=utf-8,\";\r\n    \r\n    // Encabezados\r\n    csvContent += \"Tipo,M√©trica,Valor,Timestamp\\n\";\r\n    \r\n    // Contadores\r\n    Object.entries(metrics.counters).forEach(([key, value]) => {\r\n      csvContent += `Counter,${key},${value},${Date.now()}\\n`;\r\n    });\r\n    \r\n    // Tiempos\r\n    Object.entries(metrics.timings).forEach(([key, timing]) => {\r\n      csvContent += `Timing,${key}_avg,${timing.total / timing.count},${Date.now()}\\n`;\r\n      csvContent += `Timing,${key}_min,${timing.min},${Date.now()}\\n`;\r\n      csvContent += `Timing,${key}_max,${timing.max},${Date.now()}\\n`;\r\n    });\r\n    \r\n    // Eventos\r\n    metrics.events.forEach(event => {\r\n      csvContent += `Event,${event.name},1,${event.timestamp}\\n`;\r\n    });\r\n    \r\n    // Errores\r\n    metrics.errors.forEach(error => {\r\n      csvContent += `Error,${error.type},\"${error.message.replace(/\"/g, '\"\"')}\",${error.timestamp}\\n`;\r\n    });\r\n    \r\n    // Crear enlace para descargar\r\n    const encodedUri = encodeURI(csvContent);\r\n    const link = document.createElement(\"a\");\r\n    link.setAttribute(\"href\", encodedUri);\r\n    link.setAttribute(\"download\", `lovenda_metrics_${new Date().toISOString().split('T')[0]}.csv`);\r\n    document.body.appendChild(link);\r\n    \r\n    // Simular clic en el enlace\r\n    link.click();\r\n    \r\n    // Limpiar\r\n    document.body.removeChild(link);\r\n  };\r\n  \r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex justify-center items-center p-12\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  return (\r\n    <div className=\"space-y-8 pb-8\">\r\n      <div className=\"flex flex-col md:flex-row justify-between items-center mb-6 gap-4\">\r\n        <h2 className=\"text-2xl font-semibold\">Dashboard de M√©tricas - Sistema de Emails</h2>\r\n        \r\n        <div className=\"flex items-center gap-3\">\r\n          <Button \r\n            onClick={() => setShowFilters(!showFilters)}\r\n            type=\"secondary\"\r\n            size=\"sm\"\r\n            className=\"flex items-center gap-1\"\r\n          >\r\n            <Filter size={16} />\r\n            <span>Filtros</span>\r\n            <ChevronDown size={16} className={`transform transition-transform ${showFilters ? 'rotate-180' : ''}`} />\r\n          </Button>\r\n          \r\n          <Button\r\n            onClick={loadMetrics}\r\n            type=\"secondary\"\r\n            size=\"sm\"\r\n            className=\"flex items-center gap-1\"\r\n          >\r\n            <RefreshCw size={16} />\r\n            <span>Actualizar</span>\r\n          </Button>\r\n          \r\n          <Button\r\n            onClick={downloadMetrics}\r\n            type=\"primary\"\r\n            size=\"sm\"\r\n            className=\"flex items-center gap-1\"\r\n          >\r\n            <Download size={16} />\r\n            <span>Exportar</span>\r\n          </Button>\r\n        </div>\r\n      </div>\r\n      \r\n      {showFilters && (\r\n        <Card className=\"mb-6 p-4\">\r\n          <div className=\"flex flex-col md:flex-row gap-4 items-start md:items-center\">\r\n            <div>\r\n              <label className=\"block text-sm mb-1\">Rango de tiempo</label>\r\n              <select \r\n                className=\"border rounded px-3 py-1\"\r\n                value={timeRange}\r\n                onChange={e => setTimeRange(e.target.value)}\r\n              >\r\n                <option value=\"24h\">√öltimas 24 horas</option>\r\n                <option value=\"7d\">√öltimos 7 d√≠as</option>\r\n                <option value=\"30d\">√öltimos 30 d√≠as</option>\r\n                <option value=\"all\">Todo</option>\r\n              </select>\r\n            </div>\r\n            \r\n            <div>\r\n              <label className=\"block text-sm mb-1\">Categor√≠a</label>\r\n              <select \r\n                className=\"border rounded px-3 py-1\"\r\n                value={filterCategory}\r\n                onChange={e => setFilterCategory(e.target.value)}\r\n              >\r\n                <option value=\"all\">Todas</option>\r\n                <option value=\"proveedores\">Proveedores</option>\r\n                <option value=\"invitados\">Invitados</option>\r\n                <option value=\"seguimiento\">Seguimiento</option>\r\n                <option value=\"general\">General</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n        </Card>\r\n      )}\r\n      \r\n      {error && (\r\n        <div className=\"bg-red-50 border border-red-200 p-4 rounded-md text-red-700 mb-6\">\r\n          {error}\r\n        </div>\r\n      )}\r\n      \r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n        {/* Gr√°fico de uso de plantillas por categor√≠a */}\r\n        <Card className=\"p-4\">\r\n          <h3 className=\"text-lg font-medium mb-4\">Uso de plantillas por categor√≠a</h3>\r\n          <div className=\"h-64\">\r\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n              <PieChart>\r\n                <Pie\r\n                  data={templateUsageByCategory}\r\n                  cx=\"50%\"\r\n                  cy=\"50%\"\r\n                  labelLine={false}\r\n                  outerRadius={80}\r\n                  fill=\"#8884d8\"\r\n                  dataKey=\"value\"\r\n                  label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}\r\n                >\r\n                  {templateUsageByCategory.map((entry, index) => (\r\n                    <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\r\n                  ))}\r\n                </Pie>\r\n                <Tooltip formatter={(value) => [`${value} usos`, 'Cantidad']} />\r\n              </PieChart>\r\n            </ResponsiveContainer>\r\n          </div>\r\n        </Card>\r\n        \r\n        {/* Gr√°fico de tipos de operaciones */}\r\n        <Card className=\"p-4\">\r\n          <h3 className=\"text-lg font-medium mb-4\">Operaciones por tipo</h3>\r\n          <div className=\"h-64\">\r\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n              <BarChart data={operationTypes}>\r\n                <CartesianGrid strokeDasharray=\"3 3\" />\r\n                <XAxis dataKey=\"name\" />\r\n                <YAxis />\r\n                <Tooltip />\r\n                <Bar dataKey=\"value\" name=\"Cantidad\" fill=\"#0088FE\" />\r\n              </BarChart>\r\n            </ResponsiveContainer>\r\n          </div>\r\n        </Card>\r\n        \r\n        {/* Gr√°fico de tiempos de operaci√≥n */}\r\n        <Card className=\"p-4\">\r\n          <h3 className=\"text-lg font-medium mb-4\">Tiempos de operaci√≥n (ms)</h3>\r\n          <div className=\"h-64\">\r\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n              <LineChart data={operationTimings}>\r\n                <CartesianGrid strokeDasharray=\"3 3\" />\r\n                <XAxis dataKey=\"name\" />\r\n                <YAxis />\r\n                <Tooltip />\r\n                <Legend />\r\n                <Line type=\"monotone\" dataKey=\"avg\" name=\"Promedio\" stroke=\"#8884d8\" />\r\n                <Line type=\"monotone\" dataKey=\"min\" name=\"M√≠nimo\" stroke=\"#82ca9d\" />\r\n                <Line type=\"monotone\" dataKey=\"max\" name=\"M√°ximo\" stroke=\"#ff7300\" />\r\n              </LineChart>\r\n            </ResponsiveContainer>\r\n          </div>\r\n        </Card>\r\n        \r\n        {/* Errores recientes */}\r\n        <Card className=\"p-4\">\r\n          <h3 className=\"text-lg font-medium mb-4\">Errores recientes</h3>\r\n          {recentErrors.length > 0 ? (\r\n            <div className=\"overflow-auto max-h-64\">\r\n              <table className=\"min-w-full\">\r\n                <thead>\r\n                  <tr className=\"border-b\">\r\n                    <th className=\"text-left py-2\">Tipo</th>\r\n                    <th className=\"text-left py-2\">Mensaje</th>\r\n                    <th className=\"text-left py-2\">Tiempo</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {recentErrors.map((error, index) => (\r\n                    <tr key={index} className={index % 2 === 0 ? 'bg-gray-50' : ''}>\r\n                      <td className=\"py-2 pr-4\">{error.type}</td>\r\n                      <td className=\"py-2 pr-4\">{error.message}</td>\r\n                      <td className=\"py-2\">\r\n                        {new Date(error.timestamp).toLocaleString()}\r\n                      </td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          ) : (\r\n            <p className=\"text-gray-500 italic\">No se han registrado errores.</p>\r\n          )}\r\n        </Card>\r\n      </div>\r\n      \r\n      {/* Resumen de contadores */}\r\n      <Card className=\"p-4\">\r\n        <h3 className=\"text-lg font-medium mb-4\">Resumen de actividad</h3>\r\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n          <div className=\"bg-blue-50 p-4 rounded-md\">\r\n            <h4 className=\"text-sm text-blue-700\">Plantillas usadas</h4>\r\n            <p className=\"text-2xl font-semibold\">{metrics.counters['template_use'] || 0}</p>\r\n          </div>\r\n          <div className=\"bg-green-50 p-4 rounded-md\">\r\n            <h4 className=\"text-sm text-green-700\">Emails enviados</h4>\r\n            <p className=\"text-2xl font-semibold\">{metrics.counters['email_operation_send'] || 0}</p>\r\n          </div>\r\n          <div className=\"bg-purple-50 p-4 rounded-md\">\r\n            <h4 className=\"text-sm text-purple-700\">Plantillas creadas</h4>\r\n            <p className=\"text-2xl font-semibold\">{metrics.counters['template_create'] || 0}</p>\r\n          </div>\r\n          <div className=\"bg-amber-50 p-4 rounded-md\">\r\n            <h4 className=\"text-sm text-amber-700\">B√∫squedas realizadas</h4>\r\n            <p className=\"text-2xl font-semibold\">{\r\n              Object.keys(metrics.counters)\r\n                .filter(key => key.includes('search'))\r\n                .reduce((sum, key) => sum + metrics.counters[key], 0)\r\n            }</p>\r\n          </div>\r\n        </div>\r\n      </Card>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MetricsDashboard;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\performance\\LazyComponentLoader.jsx","messages":[{"ruleId":"react/display-name","severity":2,"message":"Component definition is missing display name","line":36,"column":10,"nodeType":"ArrowFunctionExpression","messageId":"noDisplayName","endLine":43,"endColumn":4}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { lazy, Suspense } from 'react';\r\nimport Loader from '../ui/Loader';\r\n\r\n/**\r\n * Wrapper para carga perezosa de componentes con fallback personalizable\r\n * Mejora el rendimiento dividiendo el bundle en chunks m√°s peque√±os\r\n */\r\nconst LazyComponentLoader = ({ \r\n  importFunction, \r\n  fallback = <Loader />, \r\n  errorFallback = <div className=\"p-4 text-center text-red-500\">Error cargando componente</div>,\r\n  ...props \r\n}) => {\r\n  // Crear componente lazy con manejo de errores\r\n  const LazyComponent = lazy(() => \r\n    importFunction().catch(error => {\r\n      console.error('Error cargando componente lazy:', error);\r\n      return { default: () => errorFallback };\r\n    })\r\n  );\r\n\r\n  return (\r\n    <Suspense fallback={fallback}>\r\n      <LazyComponent {...props} />\r\n    </Suspense>\r\n  );\r\n};\r\n\r\n// HOC para crear componentes lazy f√°cilmente\r\nexport const createLazyComponent = (importFunction, options = {}) => {\r\n  const { \r\n    fallback = <Loader />, \r\n    errorFallback = <div className=\"p-4 text-center text-red-500\">Error cargando componente</div> \r\n  } = options;\r\n\r\n  return (props) => (\r\n    <LazyComponentLoader\r\n      importFunction={importFunction}\r\n      fallback={fallback}\r\n      errorFallback={errorFallback}\r\n      {...props}\r\n    />\r\n  );\r\n};\r\n\r\n// Componentes lazy pre-configurados para p√°ginas pesadas\r\nexport const LazyTasks = createLazyComponent(() => import('../../pages/Tasks'));\r\nexport const LazyFinance = createLazyComponent(() => import('../../pages/Finance'));\r\nexport const LazyGestionProveedores = createLazyComponent(() => import('../../pages/GestionProveedores'));\r\nexport const LazySeatingPlan = createLazyComponent(() => import('../../components/seating/SeatingPlanRefactored'));\r\nexport const LazyInvitationDesigner = createLazyComponent(() => import('../../pages/InvitationDesigner'));\r\nexport const LazyChecklist = createLazyComponent(() => import('../../pages/Checklist'));\r\n\r\n// Componentes lazy para m√≥dulos de email\r\nexport const LazyEmailInbox = createLazyComponent(() => import('../../pages/user/EmailInbox'));\r\nexport const LazyEmailStatistics = createLazyComponent(() => import('../../pages/user/EmailStatistics'));\r\n\r\n// Componentes lazy para administraci√≥n\r\nexport const LazyAdminDashboard = createLazyComponent(() => import('../../components/admin/AdminDashboard'));\r\nexport const LazyUserManagement = createLazyComponent(() => import('../../components/admin/UserManagement'));\r\nexport const LazyMetricsDashboard = createLazyComponent(() => import('../../components/admin/MetricsDashboard'));\r\n\r\nexport default LazyComponentLoader;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\proveedores\\AIBusquedaModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\proveedores\\ProveedorBudgets.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\proveedores\\ProveedorCard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\proveedores\\ProveedorCardNuevo.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Bookmark' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":24},{"ruleId":"no-unused-vars","severity":1,"message":"'Phone' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":31},{"ruleId":"no-unused-vars","severity":1,"message":"'Mail' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":37}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Star, Bookmark, Phone, Mail, Calendar, MoreHorizontal, Edit, Trash2 } from 'lucide-react';\r\n\r\n/**\r\n * Componente de tarjeta para mostrar informaci√≥n b√°sica de un proveedor.\r\n * Permite acciones como marcar favorito, editar, eliminar y mostrar el detalle al hacer clic.\r\n * \r\n * @param {Object} props - Propiedades del componente\r\n * @param {Object} props.proveedor - Datos del proveedor\r\n * @param {Function} props.onClick - Funci√≥n a ejecutar al hacer clic en la tarjeta\r\n * @param {Function} props.onToggleFavorito - Funci√≥n para marcar/desmarcar como favorito\r\n * @param {Function} props.onEditar - Funci√≥n para editar el proveedor\r\n * @param {Function} props.onEliminar - Funci√≥n para eliminar el proveedor\r\n * @returns {React.ReactElement} Tarjeta del proveedor\r\n */\r\nconst ProveedorCardNuevo = ({ \r\n  proveedor, \r\n  onClick, \r\n  onToggleFavorito, \r\n  onEditar, \r\n  onEliminar \r\n}) => {\r\n  // Estados para el men√∫ de acciones\r\n  const [menuAbierto, setMenuAbierto] = React.useState(false);\r\n\r\n  // Para evitar que el clic en los botones propague al contenedor\r\n  const handleAccion = (e, accion) => {\r\n    e.stopPropagation();\r\n    accion();\r\n  };\r\n\r\n  // Formato del presupuesto con separador de miles\r\n  const formatearPresupuesto = (valor) => {\r\n    if (!valor) return '‚Ç¨‚Ç¨‚Ç¨';\r\n    return new Intl.NumberFormat('es-ES', { \r\n      style: 'currency', \r\n      currency: 'EUR',\r\n      maximumFractionDigits: 0\r\n    }).format(valor);\r\n  };\r\n\r\n  // Obtener clase de estado seg√∫n el valor\r\n  const getEstadoClase = (estado) => {\r\n    switch(estado) {\r\n      case 'Contratado': return 'bg-green-100 text-green-800';\r\n      case 'Contactado': return 'bg-blue-100 text-blue-800';\r\n      case 'Pendiente': return 'bg-amber-100 text-amber-800';\r\n      case 'Descartado': return 'bg-red-100 text-red-800';\r\n      default: return 'bg-gray-100 text-gray-800';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div \r\n      className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden cursor-pointer transition-all hover:shadow-md\"\r\n      onClick={() => onClick(proveedor)}\r\n    >\r\n      {/* Cabecera con imagen y acciones */}\r\n      <div className=\"relative h-36 bg-gradient-to-r from-blue-500 to-purple-500\">\r\n        {proveedor.imagen && (\r\n          <img \r\n            src={proveedor.imagen} \r\n            alt={proveedor.nombre}\r\n            className=\"w-full h-full object-cover\"\r\n          />\r\n        )}\r\n        \r\n        {/* Bot√≥n favorito */}\r\n        <button \r\n          onClick={(e) => handleAccion(e, () => onToggleFavorito(proveedor.id))}\r\n          className=\"absolute top-2 left-2 p-1.5 rounded-full bg-white/80 hover:bg-white\"\r\n        >\r\n          <Star \r\n            size={18} \r\n            className={proveedor.favorito ? \"fill-yellow-400 text-yellow-400\" : \"text-gray-400\"} \r\n          />\r\n        </button>\r\n        \r\n        {/* Bot√≥n men√∫ */}\r\n        <div className=\"absolute top-2 right-2\">\r\n          <button \r\n            onClick={(e) => {\r\n              e.stopPropagation();\r\n              setMenuAbierto(!menuAbierto);\r\n            }}\r\n            className=\"p-1.5 rounded-full bg-white/80 hover:bg-white\"\r\n          >\r\n            <MoreHorizontal size={18} className=\"text-gray-600\" />\r\n          </button>\r\n          \r\n          {/* Men√∫ desplegable */}\r\n          {menuAbierto && (\r\n            <div className=\"absolute right-0 mt-1 w-36 bg-white rounded-md shadow-lg z-10 border border-gray-200\">\r\n              <div className=\"py-1\">\r\n                <button\r\n                  onClick={(e) => handleAccion(e, () => onEditar(proveedor))}\r\n                  className=\"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center\"\r\n                >\r\n                  <Edit size={14} className=\"mr-2\" />\r\n                  Editar\r\n                </button>\r\n                <button\r\n                  onClick={(e) => handleAccion(e, () => onEliminar(proveedor.id))}\r\n                  className=\"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center\"\r\n                >\r\n                  <Trash2 size={14} className=\"mr-2\" />\r\n                  Eliminar\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Contenido principal */}\r\n      <div className=\"p-4\">\r\n        <div className=\"flex justify-between items-start\">\r\n          <h3 className=\"text-lg font-semibold text-gray-800 mb-1 truncate\">\r\n            {proveedor.nombre || 'Proveedor sin nombre'}\r\n          </h3>\r\n        </div>\r\n        \r\n        <div className=\"flex justify-between items-center mb-2\">\r\n          <p className=\"text-gray-600 text-sm\">\r\n            {proveedor.servicio || 'Sin categor√≠a'}\r\n          </p>\r\n          \r\n          <span className={`text-xs px-2 py-1 rounded-full font-medium ${getEstadoClase(proveedor.estado)}`}>\r\n            {proveedor.estado || 'Nuevo'}\r\n          </span>\r\n        </div>\r\n        \r\n        <div className=\"border-t border-gray-100 pt-3 mt-3\">\r\n          <div className=\"flex justify-between\">\r\n            <div className=\"flex items-center\">\r\n              <Calendar size={16} className=\"text-gray-400 mr-1\" />\r\n              <span className=\"text-xs text-gray-500\">\r\n                {proveedor.fechaCita ? new Date(proveedor.fechaCita).toLocaleDateString() : 'Sin cita'}\r\n              </span>\r\n            </div>\r\n            <div className=\"font-medium text-sm\">\r\n              {formatearPresupuesto(proveedor.presupuesto)}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ProveedorCardNuevo;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\proveedores\\ProveedorDetail.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Clock' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":56,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":61}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport ProveedorBudgets from './ProveedorBudgets.jsx';\r\nimport { X, Star, Phone, Mail, Globe, Calendar, Edit2, Clock, MapPin } from 'lucide-react';\r\nimport Button from '../../components/Button';\r\nimport Card from '../../components/Card';\r\n\r\n/**\r\n * @typedef {import('../../hooks/useProveedores').Provider} Provider\r\n */\r\n\r\n/**\r\n * Componente que muestra los detalles completos de un proveedor seleccionado.\r\n * Incluye informaci√≥n de contacto, calificaciones, notas y opciones para editar.\r\n * Tambi√©n permite a√±adir valoraciones y mostrar el historial de interacciones.\r\n * \r\n * @param {Object} props - Propiedades del componente\r\n * @param {Provider} props.provider - Proveedor a mostrar en detalle\r\n * @param {Function} props.onClose - Funci√≥n para cerrar el panel de detalles\r\n * @param {Function} props.onEdit - Funci√≥n para editar el proveedor\r\n * @param {string} props.activeTab - Pesta√±a activa dentro del panel de detalles ('info', 'contacto', 'notas', 'historial')\r\n * @param {Function} props.setActiveTab - Funci√≥n para cambiar la pesta√±a activa\r\n * @returns {React.ReactElement} Componente de detalle de proveedor\r\n */\r\nconst ProveedorDetail = ({ provider, onClose, onEdit, activeTab, setActiveTab }) => {\r\n  const [rating, setRating] = useState(provider.ratingCount > 0 ? provider.rating / provider.ratingCount : 0);\r\n  \r\n  // Renderizar estrellas para calificaci√≥n\r\n  const renderRatingStars = (currentRating, interactive = false) => {\r\n    return (\r\n      <div className=\"flex\">\r\n        {[1, 2, 3, 4, 5].map((star) => (\r\n          <Star\r\n            key={star}\r\n            size={interactive ? 24 : 20}\r\n            className={`${\r\n              star <= currentRating\r\n                ? 'text-yellow-500 fill-yellow-500'\r\n                : 'text-gray-300'\r\n            } ${interactive ? 'cursor-pointer' : ''}`}\r\n            onClick={() => interactive && setRating(star)}\r\n          />\r\n        ))}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // Formatear fecha para mostrar\r\n  const formatDate = (dateStr) => {\r\n    if (!dateStr) return '';\r\n    try {\r\n      const date = new Date(dateStr);\r\n      return date.toLocaleDateString('es-ES', { \r\n        year: 'numeric', \r\n        month: 'long', \r\n        day: 'numeric' \r\n      });\r\n    } catch (e) {\r\n      return dateStr;\r\n    }\r\n  };\r\n\r\n  // Color seg√∫n estado del proveedor\r\n  const getStatusColor = (status) => {\r\n    switch (status) {\r\n      case 'Confirmado':\r\n        return 'bg-green-100 text-green-800';\r\n      case 'Contactado':\r\n        return 'bg-blue-100 text-blue-800';\r\n      case 'Seleccionado':\r\n        return 'bg-purple-100 text-purple-800';\r\n      case 'Rechazado':\r\n        return 'bg-red-100 text-red-800';\r\n      default:\r\n        return 'bg-gray-100 text-gray-800';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4\">\r\n      <div className=\"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col\">\r\n        {/* Header con t√≠tulo y bot√≥n de cierre */}\r\n        <div className=\"flex justify-between items-center p-4 border-b\">\r\n          <h2 className=\"text-xl font-semibold\">{provider.name}</h2>\r\n          <button \r\n            onClick={onClose} \r\n            className=\"text-gray-500 hover:text-gray-700\"\r\n            aria-label=\"Cerrar\"\r\n          >\r\n            <X size={24} />\r\n          </button>\r\n        </div>\r\n        \r\n        {/* Pesta√±as de navegaci√≥n */}\r\n        <div className=\"flex border-b\">\r\n          <button\r\n            className={`py-2 px-4 ${activeTab === 'info' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500'}`}\r\n            onClick={() => setActiveTab('info')}\r\n          >\r\n            Informaci√≥n\r\n          </button>\r\n          <button\r\n            className={`py-2 px-4 ${activeTab === 'communications' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500'}`}\r\n            onClick={() => setActiveTab('communications')}\r\n          >\r\n            Comunicaciones\r\n          </button>\r\n          <button\r\n            className={`py-2 px-4 ${activeTab === 'tracking' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500'}`}\r\n            onClick={() => setActiveTab('tracking')}\r\n          >\r\n            Seguimiento\r\n          </button>\r\n        </div>\r\n        \r\n        {/* Contenido principal con scroll */}\r\n        <div className=\"overflow-y-auto p-4 flex-1\">\r\n          {activeTab === 'info' && (\r\n            <div className=\"space-y-6\">\r\n              {/* Informaci√≥n principal */}\r\n              <Card>\r\n                <div className=\"flex items-center justify-between mb-4\">\r\n                  <div className=\"flex items-center\">\r\n                    <span className={`text-sm px-3 py-1 rounded-full ${getStatusColor(provider.status)}`}>\r\n                      {provider.status}\r\n                    </span>\r\n                    <span className=\"ml-2 text-gray-500\">{provider.service}</span>\r\n                  </div>\r\n                  {onEdit && (\r\n                    <Button \r\n                      onClick={() => onEdit(provider)} \r\n                      variant=\"outline\" \r\n                      size=\"sm\"\r\n                    >\r\n                      <Edit2 size={16} className=\"mr-1\" /> Editar\r\n                    </Button>\r\n                  )}\r\n                </div>\r\n                \r\n                {/* Imagen principal si existe */}\r\n                {provider.image && (\r\n                  <div className=\"w-full h-64 overflow-hidden rounded-lg mb-4\">\r\n                    <img\r\n                      src={provider.image}\r\n                      alt={provider.name}\r\n                      className=\"w-full h-full object-cover\"\r\n                    />\r\n                  </div>\r\n                )}\r\n                \r\n                {/* Descripci√≥n o snippet */}\r\n                {provider.snippet && (\r\n                  <p className=\"text-gray-700 mb-4\">{provider.snippet}</p>\r\n                )}\r\n                \r\n                {/* Detalles de contacto */}\r\n                <div className=\"space-y-3 mt-4\">\r\n                  {provider.contact && (\r\n                    <div className=\"flex items-center\">\r\n                      <div className=\"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-3\">\r\n                        <span className=\"text-blue-600 font-medium\">{provider.contact.charAt(0)}</span>\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"font-medium\">Contacto</p>\r\n                        <p className=\"text-sm text-gray-600\">{provider.contact}</p>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {provider.phone && (\r\n                    <div className=\"flex items-center\">\r\n                      <div className=\"w-8 h-8 rounded-full bg-green-100 flex items-center justify-center mr-3\">\r\n                        <Phone size={16} className=\"text-green-600\" />\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"font-medium\">Tel√©fono</p>\r\n                        <p className=\"text-sm text-gray-600\">{provider.phone}</p>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {provider.email && (\r\n                    <div className=\"flex items-center\">\r\n                      <div className=\"w-8 h-8 rounded-full bg-red-100 flex items-center justify-center mr-3\">\r\n                        <Mail size={16} className=\"text-red-600\" />\r\n                      </div>\r\n                      <div className=\"overflow-hidden\">\r\n                        <p className=\"font-medium\">Email</p>\r\n                        <a \r\n                          href={`mailto:${provider.email}`} \r\n                          className=\"text-sm text-blue-600 hover:underline truncate block\"\r\n                        >\r\n                          {provider.email}\r\n                        </a>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {provider.link && (\r\n                    <div className=\"flex items-center\">\r\n                      <div className=\"w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center mr-3\">\r\n                        <Globe size={16} className=\"text-purple-600\" />\r\n                      </div>\r\n                      <div className=\"overflow-hidden\">\r\n                        <p className=\"font-medium\">Sitio web</p>\r\n                        <a \r\n                          href={provider.link} \r\n                          target=\"_blank\" \r\n                          rel=\"noopener noreferrer\" \r\n                          className=\"text-sm text-blue-600 hover:underline truncate block\"\r\n                        >\r\n                          {provider.link}\r\n                        </a>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {provider.date && (\r\n                    <div className=\"flex items-center\">\r\n                      <div className=\"w-8 h-8 rounded-full bg-amber-100 flex items-center justify-center mr-3\">\r\n                        <Calendar size={16} className=\"text-amber-600\" />\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"font-medium\">Fecha</p>\r\n                        <p className=\"text-sm text-gray-600\">{formatDate(provider.date)}</p>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {(provider.location || provider.address) && (\r\n                    <div className=\"flex items-center\">\r\n                      <div className=\"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center mr-3\">\r\n                        <MapPin size={16} className=\"text-teal-600\" />\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"font-medium\">Ubicaci√≥n</p>\r\n                        <p className=\"text-sm text-gray-600\">{provider.location || provider.address}</p>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {provider.priceRange && (\r\n                    <div className=\"mt-3 p-3 bg-gray-50 rounded-md\">\r\n                      <p className=\"font-medium\">Rango de precios</p>\r\n                      <p className=\"text-lg font-semibold text-gray-800\">{provider.priceRange}</p>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                \r\n                {/* Calificaci√≥n */}\r\n                <div className=\"mt-6\">\r\n                  <p className=\"font-medium mb-1\">Calificaci√≥n</p>\r\n                  <div className=\"flex items-center space-x-4\">\r\n                    {renderRatingStars(rating, true)}\r\n                    <span className=\"text-sm text-gray-500\">\r\n                      {rating.toFixed(1)} de 5 ({provider.ratingCount || 0} valoraciones)\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              </Card>\r\n              <ProveedorBudgets supplierId={provider.id} />\r\n            </div>\r\n          )}\r\n          \r\n          {activeTab === 'communications' && (\r\n            <div className=\"space-y-4\">\r\n              <Card>\r\n                <h3 className=\"text-lg font-medium mb-3\">Comunicaciones</h3>\r\n                {/* Aqu√≠ se renderizar√≠an las comunicaciones */}\r\n                <p className=\"text-gray-500\">\r\n                  Historial de comunicaciones con este proveedor.\r\n                </p>\r\n              </Card>\r\n            </div>\r\n          )}\r\n          \r\n          {activeTab === 'tracking' && (\r\n            <div className=\"space-y-4\">\r\n              <Card>\r\n                <h3 className=\"text-lg font-medium mb-3\">Seguimiento</h3>\r\n                {/* Aqu√≠ se renderizar√≠a el seguimiento */}\r\n                <p className=\"text-gray-500\">\r\n                  Historial de seguimiento de comunicaciones con este proveedor.\r\n                </p>\r\n              </Card>\r\n            </div>\r\n          )}\r\n        </div>\r\n        \r\n        {/* Footer con botones de acci√≥n */}\r\n        <div className=\"border-t p-4 bg-gray-50 flex justify-end space-x-3\">\r\n          <Button variant=\"outline\" onClick={onClose}>\r\n            Cerrar\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Optimizar renderizado con React.memo para evitar renderizados innecesarios\r\nexport default React.memo(ProveedorDetail, (prevProps, nextProps) => {\r\n  return (\r\n    prevProps.provider?.id === nextProps.provider?.id &&\r\n    prevProps.activeTab === nextProps.activeTab &&\r\n    // Solo re-renderizar si cambia el proveedor o la pesta√±a activa\r\n    JSON.stringify(prevProps.provider) === JSON.stringify(nextProps.provider)\r\n  );\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\proveedores\\ProveedorDetalle.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'X' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":11},{"ruleId":"no-unused-vars","severity":1,"message":"'Bookmark' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":68,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":76},{"ruleId":"no-unused-vars","severity":1,"message":"'ChevronRight' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":78,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":90},{"ruleId":"no-unused-vars","severity":1,"message":"'CheckCheck' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":92,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":102}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { X, ArrowLeft, Calendar, Mail, Phone, Globe, MapPin, Edit, Bookmark, ChevronRight, CheckCheck, MessageSquare } from 'lucide-react';\r\n\r\n/**\r\n * Componente para mostrar el detalle completo de un proveedor con pesta√±as\r\n * para informaci√≥n general y seguimiento de comunicaciones.\r\n * \r\n * @param {Object} props - Propiedades del componente\r\n * @param {Object} props.proveedor - Datos del proveedor\r\n * @param {Array} props.comunicaciones - Lista de comunicaciones con el proveedor\r\n * @param {Function} props.onCerrar - Funci√≥n para cerrar el detalle\r\n * @param {Function} props.onEditar - Funci√≥n para editar el proveedor\r\n * @param {Function} props.onNuevaComunicacion - Funci√≥n para a√±adir nueva comunicaci√≥n\r\n * @returns {React.ReactElement} Vista detalle del proveedor\r\n */\r\nconst ProveedorDetalle = ({ \r\n  proveedor, \r\n  comunicaciones = [], \r\n  onCerrar, \r\n  onEditar,\r\n  onNuevaComunicacion\r\n}) => {\r\n  // Estado para la pesta√±a activa\r\n  const [pestanaActiva, setPestanaActiva] = useState('info');\r\n  \r\n  // Formatear fecha\r\n  const formatearFecha = (fecha) => {\r\n    if (!fecha) return 'Sin fecha';\r\n    return new Date(fecha).toLocaleDateString('es-ES', {\r\n      day: 'numeric', \r\n      month: 'long', \r\n      year: 'numeric'\r\n    });\r\n  };\r\n  \r\n  // Formatear precio\r\n  const formatearPrecio = (valor) => {\r\n    if (!valor) return 'No especificado';\r\n    return new Intl.NumberFormat('es-ES', {\r\n      style: 'currency',\r\n      currency: 'EUR',\r\n      maximumFractionDigits: 0\r\n    }).format(valor);\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden\">\r\n      {/* Cabecera con imagen de fondo */}\r\n      <div className=\"relative h-48 bg-gradient-to-r from-blue-500 to-purple-500\">\r\n        {proveedor.imagen && (\r\n          <img \r\n            src={proveedor.imagen} \r\n            alt={proveedor.nombre} \r\n            className=\"w-full h-full object-cover\"\r\n          />\r\n        )}\r\n        \r\n        {/* Botones superiores */}\r\n        <div className=\"absolute top-0 left-0 w-full p-4 flex justify-between\">\r\n          <button \r\n            onClick={onCerrar}\r\n            className=\"p-2 rounded-full bg-white/80 hover:bg-white text-gray-700\"\r\n          >\r\n            <ArrowLeft size={20} />\r\n          </button>\r\n          \r\n          <button \r\n            onClick={() => onEditar(proveedor)}\r\n            className=\"p-2 rounded-full bg-white/80 hover:bg-white text-gray-700\"\r\n          >\r\n            <Edit size={20} />\r\n          </button>\r\n        </div>\r\n      </div>\r\n      \r\n      {/* T√≠tulo y estado */}\r\n      <div className=\"p-5 border-b border-gray-200\">\r\n        <div className=\"flex justify-between items-start mb-2\">\r\n          <h2 className=\"text-2xl font-bold text-gray-800\">\r\n            {proveedor.nombre || 'Proveedor sin nombre'}\r\n          </h2>\r\n          <span className={`px-3 py-1 rounded-full text-sm font-medium ${\r\n            proveedor.estado === 'Contratado' ? 'bg-green-100 text-green-800' :\r\n            proveedor.estado === 'Contactado' ? 'bg-blue-100 text-blue-800' :\r\n            proveedor.estado === 'Descartado' ? 'bg-red-100 text-red-800' :\r\n            'bg-gray-100 text-gray-800'\r\n          }`}>\r\n            {proveedor.estado || 'Nuevo'}\r\n          </span>\r\n        </div>\r\n        <p className=\"text-gray-600\">\r\n          {proveedor.servicio || 'Sin categor√≠a'}\r\n        </p>\r\n      </div>\r\n      \r\n      {/* Navegaci√≥n pesta√±as */}\r\n      <div className=\"flex border-b border-gray-200\">\r\n        <button\r\n          onClick={() => setPestanaActiva('info')}\r\n          className={`flex-1 py-3 font-medium text-sm border-b-2 transition-colors ${\r\n            pestanaActiva === 'info' \r\n              ? 'border-blue-500 text-blue-600' \r\n              : 'border-transparent text-gray-500 hover:text-gray-700'\r\n          }`}\r\n        >\r\n          Informaci√≥n\r\n        </button>\r\n        <button\r\n          onClick={() => setPestanaActiva('comunicaciones')}\r\n          className={`flex-1 py-3 font-medium text-sm border-b-2 transition-colors ${\r\n            pestanaActiva === 'comunicaciones' \r\n              ? 'border-blue-500 text-blue-600' \r\n              : 'border-transparent text-gray-500 hover:text-gray-700'\r\n          }`}\r\n        >\r\n          Seguimiento\r\n        </button>\r\n      </div>\r\n      \r\n      {/* Contenido de pesta√±as */}\r\n      <div className=\"p-5\">\r\n        {pestanaActiva === 'info' ? (\r\n          /* Informaci√≥n general */\r\n          <div className=\"space-y-5\">\r\n            {/* Presupuesto y cita */}\r\n            <div className=\"flex flex-wrap gap-4\">\r\n              <div className=\"flex-1 min-w-[200px] bg-blue-50 rounded-lg p-4\">\r\n                <p className=\"text-sm text-blue-600 mb-1\">Presupuesto</p>\r\n                <p className=\"text-lg font-semibold\">{formatearPrecio(proveedor.presupuesto)}</p>\r\n              </div>\r\n              <div className=\"flex-1 min-w-[200px] bg-purple-50 rounded-lg p-4\">\r\n                <p className=\"text-sm text-purple-600 mb-1\">Pr√≥xima cita</p>\r\n                <div className=\"flex items-center\">\r\n                  <Calendar size={18} className=\"mr-2 text-purple-500\" />\r\n                  <p className=\"text-lg font-semibold\">{formatearFecha(proveedor.fechaCita)}</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Contacto */}\r\n            <div className=\"bg-gray-50 rounded-lg p-4\">\r\n              <h3 className=\"font-medium mb-3 text-gray-700\">Datos de contacto</h3>\r\n              <div className=\"space-y-3\">\r\n                {proveedor.contacto && (\r\n                  <div className=\"flex items-center\">\r\n                    <div className=\"w-8 text-gray-400\"><MessageSquare size={16} /></div>\r\n                    <p>{proveedor.contacto}</p>\r\n                  </div>\r\n                )}\r\n                {proveedor.telefono && (\r\n                  <div className=\"flex items-center\">\r\n                    <div className=\"w-8 text-gray-400\"><Phone size={16} /></div>\r\n                    <p>{proveedor.telefono}</p>\r\n                  </div>\r\n                )}\r\n                {proveedor.email && (\r\n                  <div className=\"flex items-center\">\r\n                    <div className=\"w-8 text-gray-400\"><Mail size={16} /></div>\r\n                    <p>{proveedor.email}</p>\r\n                  </div>\r\n                )}\r\n                {proveedor.web && (\r\n                  <div className=\"flex items-center\">\r\n                    <div className=\"w-8 text-gray-400\"><Globe size={16} /></div>\r\n                    <a \r\n                      href={proveedor.web} \r\n                      target=\"_blank\" \r\n                      rel=\"noopener noreferrer\"\r\n                      className=\"text-blue-600 hover:underline\"\r\n                    >\r\n                      {proveedor.web}\r\n                    </a>\r\n                  </div>\r\n                )}\r\n                {proveedor.ubicacion && (\r\n                  <div className=\"flex items-center\">\r\n                    <div className=\"w-8 text-gray-400\"><MapPin size={16} /></div>\r\n                    <p>{proveedor.ubicacion}</p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Notas */}\r\n            {proveedor.notas && (\r\n              <div className=\"bg-amber-50 rounded-lg p-4\">\r\n                <h3 className=\"font-medium mb-2 text-amber-700\">Notas</h3>\r\n                <p className=\"text-gray-700 whitespace-pre-line\">{proveedor.notas}</p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          /* Seguimiento de comunicaciones */\r\n          <div>\r\n            <div className=\"flex justify-between mb-4\">\r\n              <h3 className=\"text-lg font-medium\">Historial de comunicaciones</h3>\r\n              <button \r\n                onClick={onNuevaComunicacion}\r\n                className=\"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-md text-sm\"\r\n              >\r\n                Nueva entrada\r\n              </button>\r\n            </div>\r\n            \r\n            {comunicaciones && comunicaciones.length > 0 ? (\r\n              <div className=\"space-y-4\">\r\n                {comunicaciones.map((item, index) => (\r\n                  <div \r\n                    key={index}\r\n                    className=\"bg-gray-50 rounded-lg p-4 border-l-4 border-blue-400\"\r\n                  >\r\n                    <div className=\"flex justify-between items-start mb-2\">\r\n                      <h4 className=\"font-medium text-gray-800\">{item.tipo || 'Comunicaci√≥n'}</h4>\r\n                      <span className=\"text-xs text-gray-500\">\r\n                        {formatearFecha(item.fecha)}\r\n                      </span>\r\n                    </div>\r\n                    <p className=\"text-gray-700 mb-2\">{item.mensaje}</p>\r\n                    {item.adjuntos && item.adjuntos.length > 0 && (\r\n                      <div className=\"mt-2 pt-2 border-t border-gray-200\">\r\n                        <p className=\"text-xs text-gray-500 mb-1\">Adjuntos:</p>\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                          {item.adjuntos.map((adjunto, idx) => (\r\n                            <a\r\n                              key={idx}\r\n                              href={adjunto.url}\r\n                              className=\"text-blue-600 bg-blue-50 px-2 py-1 rounded text-xs flex items-center\"\r\n                              target=\"_blank\"\r\n                              rel=\"noopener noreferrer\"\r\n                            >\r\n                              {adjunto.nombre}\r\n                            </a>\r\n                          ))}\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-center py-8 text-gray-500\">\r\n                <MessageSquare className=\"mx-auto h-12 w-12 text-gray-300 mb-2\" />\r\n                <p>No hay comunicaciones registradas</p>\r\n                <p className=\"mt-1 text-sm\">Registra el primer contacto con este proveedor</p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ProveedorDetalle;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\proveedores\\ProveedorFiltro.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Filter' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Search, Filter, SlidersHorizontal } from 'lucide-react';\r\n\r\n/**\r\n * Componente para filtrar y buscar proveedores con pesta√±as para diferentes categor√≠as\r\n * \r\n * @param {Object} props - Propiedades del componente\r\n * @param {string} props.filtroActivo - El filtro actualmente seleccionado\r\n * @param {Function} props.onCambioFiltro - Funci√≥n a ejecutar cuando se cambia el filtro\r\n * @param {Function} props.onBuscar - Funci√≥n a ejecutar cuando se busca\r\n * @param {string} props.textoBusqueda - Texto de b√∫squeda actual\r\n * @param {Function} props.onCambioTexto - Funci√≥n a ejecutar cuando cambia el texto de b√∫squeda\r\n * @returns {React.ReactElement} Componente de filtro de proveedores\r\n */\r\nconst ProveedorFiltro = ({ \r\n  filtroActivo = 'todos', \r\n  onCambioFiltro,\r\n  onBuscar,\r\n  textoBusqueda = '',\r\n  onCambioTexto\r\n}) => {\r\n  // Opciones de filtro disponibles\r\n  const filtros = [\r\n    { id: 'todos', label: 'Todos' },\r\n    { id: 'contratados', label: 'Contratados' },\r\n    { id: 'contactados', label: 'Contactados' },\r\n    { id: 'favoritos', label: 'Favoritos' },\r\n  ];\r\n\r\n  // Manejar la b√∫squeda con Enter\r\n  const handleKeyPress = (e) => {\r\n    if (e.key === 'Enter') {\r\n      onBuscar(textoBusqueda);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"mb-6\">\r\n      {/* Pesta√±as de filtro */}\r\n      <div className=\"border-b border-gray-200 mb-4\">\r\n        <nav className=\"-mb-px flex space-x-6\" aria-label=\"Pesta√±as\">\r\n          {filtros.map((filtro) => (\r\n            <button\r\n              key={filtro.id}\r\n              onClick={() => onCambioFiltro(filtro.id)}\r\n              className={`\r\n                whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm\r\n                ${filtroActivo === filtro.id\r\n                  ? 'border-blue-500 text-blue-600'\r\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}\r\n              `}\r\n            >\r\n              {filtro.label}\r\n            </button>\r\n          ))}\r\n        </nav>\r\n      </div>\r\n      \r\n      {/* Barra de b√∫squeda */}\r\n      <div className=\"flex gap-2\">\r\n        <div className=\"flex-1 relative\">\r\n          <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n            <Search size={18} className=\"text-gray-400\" />\r\n          </div>\r\n          <input\r\n            type=\"text\"\r\n            value={textoBusqueda}\r\n            onChange={(e) => onCambioTexto(e.target.value)}\r\n            onKeyPress={handleKeyPress}\r\n            placeholder=\"Buscar proveedores...\"\r\n            className=\"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm\"\r\n          />\r\n        </div>\r\n        \r\n        <button\r\n          onClick={() => onBuscar(textoBusqueda)}\r\n          className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-500 hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\r\n        >\r\n          Buscar\r\n        </button>\r\n        \r\n        <button\r\n          className=\"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\r\n        >\r\n          <SlidersHorizontal size={16} className=\"mr-2\" />\r\n          Filtros\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ProveedorFiltro;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\proveedores\\ProveedorForm.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\proveedores\\ProveedorFormModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\proveedores\\ProveedorList.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\proveedores\\ReservationModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\proveedores\\ai\\AIEmailModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\proveedores\\ai\\AIResultList.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useState' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":25},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":32,"column":35,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[1510,1547],"text":"\r\n          Analizando tu consulta: &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[1510,1547],"text":"\r\n          Analizando tu consulta: &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[1510,1547],"text":"\r\n          Analizando tu consulta: &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[1510,1547],"text":"\r\n          Analizando tu consulta: &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":32,"column":43,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[1554,1565],"text":"&quot;\r\n        "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[1554,1565],"text":"&ldquo;\r\n        "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[1554,1565],"text":"&#34;\r\n        "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[1554,1565],"text":"&rdquo;\r\n        "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/jsx-no-undef","severity":2,"message":"'X' is not defined.","line":42,"column":12,"nodeType":"JSXIdentifier","messageId":"undefined","endLine":42,"endColumn":13},{"ruleId":"react/jsx-no-undef","severity":2,"message":"'Search' is not defined.","line":70,"column":12,"nodeType":"JSXIdentifier","messageId":"undefined","endLine":70,"endColumn":18},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":127,"column":44,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[5853,5854],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[5853,5854],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[5853,5854],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[5853,5854],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":127,"column":52,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[5861,5862],"text":"&quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[5861,5862],"text":"&ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[5861,5862],"text":"&#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[5861,5862],"text":"&rdquo;"},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { Check, Plus, ArrowRight, Loader2, Mail } from 'lucide-react';\r\nimport Button from '../../../components/Button';\r\nimport Card from '../../../components/Card';\r\n\r\n/**\r\n * @typedef {import('../../../hooks/useAISearch').AISearchResult} AISearchResult\r\n */\r\n\r\n/**\r\n * Componente que muestra los resultados de b√∫squeda con IA de proveedores.\r\n * Presenta una lista de resultados con porcentaje de coincidencia, acciones r√°pidas\r\n * y estados de carga. Tambi√©n muestra mensajes de error si los hubiera.\r\n * \r\n * @param {Object} props - Propiedades del componente\r\n * @param {AISearchResult[]} [props.results=[]] - Resultados de la b√∫squeda con IA\r\n * @param {boolean} props.isLoading - Indica si la b√∫squeda est√° en progreso\r\n * @param {Function} props.onSelect - Funci√≥n para seleccionar un resultado\r\n * @param {string} props.query - T√©rmino de b√∫squeda original\r\n * @param {string} [props.error] - Mensaje de error, si existe\r\n * @returns {React.ReactElement} Componente de lista de resultados de b√∫squeda con IA\r\n */\r\nconst AIResultList = ({ results = [], isLoading, onSelect, query, error }) => {\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"flex flex-col items-center justify-center py-12\">\r\n        <div className=\"animate-spin mb-4\">\r\n          <Loader2 size={40} className=\"text-blue-500\" />\r\n        </div>\r\n        <p className=\"text-lg font-medium text-gray-700\">Buscando proveedores...</p>\r\n        <p className=\"text-sm text-gray-500 mt-2\">\r\n          Analizando tu consulta: \"{query}\"\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"flex flex-col items-center justify-center py-12\">\r\n        <div className=\"p-3 rounded-full bg-red-100 mb-4\">\r\n          <X size={24} className=\"text-red-500\" />\r\n        </div>\r\n        <p className=\"text-lg font-medium text-gray-700\">Error al buscar</p>\r\n        <p className=\"text-sm text-gray-500 mt-2 text-center max-w-md\">\r\n          {error}\r\n        </p>\r\n        <Button className=\"mt-4\" size=\"sm\" variant=\"outline\">\r\n          Intentar de nuevo\r\n        </Button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!results.length && query) {\r\n    return (\r\n      <div className=\"flex flex-col items-center justify-center py-12\">\r\n        <p className=\"text-lg font-medium text-gray-700\">No se encontraron resultados</p>\r\n        <p className=\"text-sm text-gray-500 mt-2 text-center max-w-md\">\r\n          Intenta reformular tu b√∫squeda o utilizar t√©rminos m√°s generales\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!query) {\r\n    return (\r\n      <div className=\"flex flex-col items-center justify-center py-12\">\r\n        <div className=\"p-3 rounded-full bg-blue-100 mb-4\">\r\n          <Search size={24} className=\"text-blue-500\" />\r\n        </div>\r\n        <p className=\"text-lg font-medium text-gray-700\">Busca proveedores con IA</p>\r\n        <p className=\"text-sm text-gray-500 mt-2 text-center max-w-md\">\r\n          Describe lo que buscas en lenguaje natural y la IA encontrar√° los proveedores m√°s adecuados\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Ejemplo de datos para mostrar en modo de demostraci√≥n\r\n  const demoResults = [\r\n    {\r\n      id: 1,\r\n      name: 'Fotograf√≠a Naturaleza Viva',\r\n      service: 'Fotograf√≠a',\r\n      snippet: 'Estudio especializado en fotograf√≠a de bodas con estilo natural y documental. Captamos los momentos m√°s emotivos y espont√°neos de tu boda.',\r\n      match: 95,\r\n      image: 'https://images.unsplash.com/photo-1537633552985-df8429e8048b?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTB8fHdlZGRpbmclMjBwaG90b2dyYXBoeXxlbnwwfHwwfHw%3D&auto=format&fit=crop&w=500&q=60',\r\n      location: 'Madrid',\r\n      price: '1200‚Ç¨ - 2500‚Ç¨',\r\n      aiSummary: 'Este fot√≥grafo tiene un estilo natural y documental perfecto para bodas en exteriores. Sus im√°genes capturen momentos espont√°neos con iluminaci√≥n natural, ideal para lo que buscas.'\r\n    },\r\n    {\r\n      id: 2,\r\n      name: 'Lente Azul Fotograf√≠a',\r\n      service: 'Fotograf√≠a',\r\n      snippet: 'M√°s de 10 a√±os de experiencia en fotograf√≠a de bodas en playa y espacios naturales. Ofrecemos paquetes personalizados para cada pareja.',\r\n      match: 87,\r\n      image: 'https://images.unsplash.com/photo-1508435234994-67cfd7690508?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8Nnx8d2VkZGluZyUyMHBob3RvZ3JhcGh5fGVufDB8fDB8fA%3D%3D&auto=format&fit=crop&w=500&q=60',\r\n      location: 'Barcelona',\r\n      price: '1500‚Ç¨ - 3000‚Ç¨',\r\n      aiSummary: 'Especialistas en bodas en la playa con un estilo luminoso y natural. Su portfolio muestra una gran experiencia en entornos costeros y saben aprovechar la luz natural.'\r\n    },\r\n    {\r\n      id: 3,\r\n      name: 'Momentos Eternos',\r\n      service: 'Fotograf√≠a',\r\n      snippet: 'Fotograf√≠a de autor para bodas con estilo √∫nico. Combinamos fotograf√≠a documental con retratos art√≠sticos para crear un √°lbum inolvidable.',\r\n      match: 79,\r\n      image: 'https://images.unsplash.com/photo-1511285560929-80b456fea0bc?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTR8fHdlZGRpbmclMjBwaG90b2dyYXBoeXxlbnwwfHwwfHw%3D&auto=format&fit=crop&w=500&q=60',\r\n      location: 'Valencia',\r\n      price: '1000‚Ç¨ - 2000‚Ç¨',\r\n      aiSummary: 'Ofrece un enfoque art√≠stico con elementos documentales. Aunque su estilo es m√°s estilizado que puramente natural, tiene experiencia en bodas al aire libre.'\r\n    }\r\n  ];\r\n\r\n  // Usar datos reales si est√°n disponibles, o los datos de demostraci√≥n\r\n  const displayResults = results.length > 0 ? results : demoResults;\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Resumen de la b√∫squeda */}\r\n      <div className=\"mb-4\">\r\n        <p className=\"text-sm text-gray-500\">\r\n          Se encontraron <span className=\"font-medium\">{displayResults.length}</span> proveedores para tu b√∫squeda:\r\n        </p>\r\n        <p className=\"text-lg font-medium\">\"{query}\"</p>\r\n      </div>\r\n\r\n      {/* Lista de resultados */}\r\n      {displayResults.map((result) => (\r\n        <Card key={result.id} className=\"relative overflow-hidden\">\r\n          {/* Indicador de porcentaje de coincidencia */}\r\n          <div className=\"absolute top-2 right-2 bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded-full\">\r\n            {result.match}% match\r\n          </div>\r\n\r\n          <div className=\"flex flex-col md:flex-row gap-4\">\r\n            {/* Imagen */}\r\n            {result.image && (\r\n              <div className=\"w-full md:w-32 h-32 flex-shrink-0 overflow-hidden rounded-md\">\r\n                <img\r\n                  src={result.image}\r\n                  alt={result.name}\r\n                  className=\"w-full h-full object-cover\"\r\n                />\r\n              </div>\r\n            )}\r\n\r\n            {/* Contenido principal */}\r\n            <div className=\"flex-1\">\r\n              <div className=\"flex flex-wrap justify-between items-start mb-2\">\r\n                <div>\r\n                  <h3 className=\"text-lg font-semibold\">{result.name}</h3>\r\n                  <p className=\"text-sm text-gray-600\">{result.service}</p>\r\n                </div>\r\n                {result.price && (\r\n                  <span className=\"text-sm font-medium bg-gray-100 px-2 py-1 rounded\">\r\n                    {result.price}\r\n                  </span>\r\n                )}\r\n              </div>\r\n\r\n              {result.location && (\r\n                <p className=\"text-sm text-gray-600 mb-2\">\r\n                  <span className=\"font-medium\">Ubicaci√≥n:</span> {result.location}\r\n                </p>\r\n              )}\r\n\r\n              <p className=\"text-sm text-gray-700 mb-3\">{result.snippet}</p>\r\n\r\n              {/* An√°lisis de IA */}\r\n              {result.aiSummary && (\r\n                <div className=\"bg-blue-50 p-3 rounded-md mb-3\">\r\n                  <p className=\"text-xs font-semibold text-blue-600 mb-1\">An√°lisis de IA</p>\r\n                  <p className=\"text-sm text-gray-700\">{result.aiSummary}</p>\r\n                </div>\r\n              )}\r\n\r\n              {/* Acciones */}\r\n              <div className=\"flex flex-wrap gap-2 mt-2\">\r\n                <Button\r\n                  onClick={() => onSelect(result, 'view')}\r\n                  variant=\"outline\"\r\n                  size=\"sm\"\r\n                >\r\n                  <ArrowRight size={16} className=\"mr-1\" /> Ver detalles\r\n                </Button>\r\n                <Button\r\n                  onClick={() => onSelect(result, 'add')}\r\n                  size=\"sm\"\r\n                >\r\n                  <Plus size={16} className=\"mr-1\" /> A√±adir\r\n                </Button>\r\n                <Button\r\n                  onClick={() => onSelect(result, 'email')}\r\n                  variant=\"outline\"\r\n                  size=\"sm\"\r\n                  className=\"border-blue-600 text-blue-600 hover:bg-blue-50\"\r\n                  data-testid=\"email-provider-btn\"\r\n                >\r\n                  <Mail size={16} className=\"mr-1\" /> Enviar email\r\n                </Button>\r\n                <Button\r\n                  onClick={() => onSelect(result, 'select')}\r\n                  variant=\"outline\"\r\n                  size=\"sm\"\r\n                  className=\"border-green-600 text-green-600 hover:bg-green-50\"\r\n                >\r\n                  <Check size={16} className=\"mr-1\" /> Seleccionar\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </Card>\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\n\r\n// Optimizar renderizado con React.memo\r\nexport default React.memo(AIResultList, (prevProps, nextProps) => {\r\n  // Solo re-renderizar si cambia alguno de estos valores\r\n  return (\r\n    prevProps.results?.length === nextProps.results?.length &&\r\n    JSON.stringify(prevProps.results) === JSON.stringify(nextProps.results) &&\r\n    prevProps.onSelect === nextProps.onSelect\r\n  );\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\proveedores\\ai\\AISearchModal.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useMemo' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":51,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":58},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":143,"column":24,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[5508,5611],"text":"\r\n              Ejemplo: &quot;Busco un fot√≥grafo de estilo natural para una boda en la playa\"\r\n            "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[5508,5611],"text":"\r\n              Ejemplo: &ldquo;Busco un fot√≥grafo de estilo natural para una boda en la playa\"\r\n            "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[5508,5611],"text":"\r\n              Ejemplo: &#34;Busco un fot√≥grafo de estilo natural para una boda en la playa\"\r\n            "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[5508,5611],"text":"\r\n              Ejemplo: &rdquo;Busco un fot√≥grafo de estilo natural para una boda en la playa\"\r\n            "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":143,"column":87,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[5508,5611],"text":"\r\n              Ejemplo: \"Busco un fot√≥grafo de estilo natural para una boda en la playa&quot;\r\n            "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[5508,5611],"text":"\r\n              Ejemplo: \"Busco un fot√≥grafo de estilo natural para una boda en la playa&ldquo;\r\n            "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[5508,5611],"text":"\r\n              Ejemplo: \"Busco un fot√≥grafo de estilo natural para una boda en la playa&#34;\r\n            "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[5508,5611],"text":"\r\n              Ejemplo: \"Busco un fot√≥grafo de estilo natural para una boda en la playa&rdquo;\r\n            "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { Search, X, Sparkles } from 'lucide-react';\r\nimport Button from '../../../components/Button';\r\nimport AIResultList from './AIResultList';\r\n\r\n/**\r\n * @typedef {import('../../../hooks/useAISearch').AISearchResult} AISearchResult\r\n */\r\n\r\n/**\r\n * Modal de b√∫squeda inteligente de proveedores con IA.\r\n * Permite realizar b√∫squedas en lenguaje natural, muestra sugerencias,\r\n * guarda historial de b√∫squedas y presenta los resultados en forma de lista.\r\n * \r\n * @param {Object} props - Propiedades del componente\r\n * @param {boolean} props.isOpen - Indica si el modal est√° abierto\r\n * @param {Function} props.onClose - Funci√≥n para cerrar el modal\r\n * @param {Function} props.onSearch - Funci√≥n para realizar la b√∫squeda (recibe el query)\r\n * @param {Function} props.onSelect - Funci√≥n para seleccionar un resultado\r\n * @param {boolean} props.isLoading - Indica si la b√∫squeda est√° en progreso\r\n * @returns {React.ReactElement|null} Modal de b√∫squeda con IA o null si no est√° abierto\r\n */\r\nconst AISearchModal = ({ isOpen, onClose, onSearch, onSelect, isLoading }) => {\r\n  const [query, setQuery] = useState('');\r\n  const [searchHistory, setSearchHistory] = useState([]);\r\n  const [suggestions, setSuggestions] = useState([]);\r\n  const [searchTimeout, setSearchTimeout] = useState(null);\r\n  \r\n  useEffect(() => {\r\n    // Cargar historial de b√∫squeda previo si existe en localStorage\r\n    const savedHistory = localStorage.getItem('ai_search_history');\r\n    if (savedHistory) {\r\n      try {\r\n        setSearchHistory(JSON.parse(savedHistory));\r\n      } catch (e) {\r\n        console.error('Error parsing search history', e);\r\n      }\r\n    }\r\n    \r\n    // Ejemplos de sugerencias de b√∫squeda predefinidas\r\n    setSuggestions([\r\n      'Fot√≥grafo de bodas estilo documental',\r\n      'Catering para evento de 100 personas con opciones vegetarianas',\r\n      'DJ con experiencia en bodas y disponible para agosto',\r\n      'Florister√≠a especializada en decoraci√≥n vintage',\r\n      'Lugar para ceremonia al aire libre cerca de Madrid'\r\n    ]);\r\n    \r\n    return () => {\r\n      if (searchTimeout) {\r\n        clearTimeout(searchTimeout);\r\n      }\r\n    };\r\n  }, []);\r\n  \r\n  // Guardar historial de b√∫squeda en localStorage\r\n  const saveSearchToHistory = useCallback((searchTerm) => {\r\n    const updatedHistory = [\r\n      searchTerm,\r\n      ...searchHistory.filter(item => item !== searchTerm).slice(0, 9)\r\n    ];\r\n    setSearchHistory(updatedHistory);\r\n    localStorage.setItem('ai_search_history', JSON.stringify(updatedHistory));\r\n  }, [searchHistory]);\r\n  \r\n  // Manejar env√≠o de b√∫squeda\r\n  const handleSubmit = useCallback((e) => {\r\n    e.preventDefault();\r\n    if (query.trim()) {\r\n      saveSearchToHistory(query);\r\n      onSearch(query);\r\n    }\r\n  }, [query, saveSearchToHistory, onSearch]);\r\n  \r\n  // Realizar b√∫squeda con retraso para evitar consultas excesivas mientras el usuario escribe\r\n  const handleQueryChange = useCallback((e) => {\r\n    const value = e.target.value;\r\n    setQuery(value);\r\n    \r\n    if (searchTimeout) {\r\n      clearTimeout(searchTimeout);\r\n    }\r\n    \r\n    if (value.trim() && value.length > 2) {\r\n      const timeout = setTimeout(() => {\r\n        onSearch(value);\r\n      }, 500); // Esperar 500ms antes de buscar\r\n      setSearchTimeout(timeout);\r\n    }\r\n  }, [searchTimeout, onSearch]);\r\n  \r\n  // Seleccionar una b√∫squeda del historial o sugerencias\r\n  const selectQuery = (selectedQuery) => {\r\n    setQuery(selectedQuery);\r\n    saveSearchToHistory(selectedQuery);\r\n    onSearch(selectedQuery);\r\n  };\r\n  \r\n  if (!isOpen) return null;\r\n  \r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4\" onClick={onClose}>\r\n      <div className=\"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col\" onClick={(e) => e.stopPropagation()}>\r\n        {/* Header */}\r\n        <div className=\"flex justify-between items-center p-4 border-b\">\r\n          <h2 className=\"text-xl font-semibold flex items-center\">\r\n            <Sparkles size={20} className=\"mr-2 text-blue-500\" />\r\n            B√∫squeda inteligente de proveedores\r\n          </h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-gray-500 hover:text-gray-700\"\r\n            aria-label=\"Cerrar\"\r\n          >\r\n            <X size={24} />\r\n          </button>\r\n        </div>\r\n        \r\n        {/* Formulario de b√∫squeda */}\r\n        <div className=\"p-4 border-b\">\r\n          <form onSubmit={handleSubmit} className=\"relative\">\r\n            <div className=\"relative\">\r\n              <input\r\n                type=\"text\"\r\n                value={query}\r\n                onChange={handleQueryChange}\r\n                placeholder=\"Describe lo que est√°s buscando en lenguaje natural...\"\r\n                className=\"w-full p-3 pl-10 pr-24 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                autoFocus\r\n              />\r\n              <Search className=\"absolute left-3 top-3 text-gray-400\" size={20} />\r\n              <Button\r\n                type=\"submit\"\r\n                className=\"absolute right-2 top-1.5\"\r\n                size=\"sm\"\r\n                disabled={isLoading || !query.trim()}\r\n              >\r\n                {isLoading ? 'Buscando...' : 'Buscar'}\r\n              </Button>\r\n            </div>\r\n            \r\n            <p className=\"mt-2 text-sm text-gray-500\">\r\n              Ejemplo: \"Busco un fot√≥grafo de estilo natural para una boda en la playa\"\r\n            </p>\r\n          </form>\r\n        </div>\r\n        \r\n        {/* Contenido principal */}\r\n        <div className=\"flex flex-1 overflow-hidden\">\r\n          {/* Panel lateral con historial y sugerencias */}\r\n          <div className=\"w-64 p-4 border-r overflow-y-auto\">\r\n            {/* Historial de b√∫squeda */}\r\n            {searchHistory.length > 0 && (\r\n              <div className=\"mb-6\">\r\n                <h3 className=\"text-sm font-semibold text-gray-700 mb-2\">\r\n                  B√∫squedas recientes\r\n                </h3>\r\n                <ul className=\"space-y-1\">\r\n                  {searchHistory.map((item, index) => (\r\n                    <li key={index}>\r\n                      <button\r\n                        onClick={() => selectQuery(item)}\r\n                        className=\"text-sm text-left w-full p-1.5 hover:bg-gray-100 rounded-md truncate\"\r\n                      >\r\n                        {item}\r\n                      </button>\r\n                    </li>\r\n                  ))}\r\n                  <li>\r\n                    <button\r\n                      onClick={() => {\r\n                        setSearchHistory([]);\r\n                        localStorage.removeItem('ai_search_history');\r\n                      }}\r\n                      className=\"text-xs text-blue-600 hover:text-blue-800 mt-1\"\r\n                    >\r\n                      Borrar historial\r\n                    </button>\r\n                  </li>\r\n                </ul>\r\n              </div>\r\n            )}\r\n            \r\n            {/* Sugerencias de b√∫squeda */}\r\n            <div>\r\n              <h3 className=\"text-sm font-semibold text-gray-700 mb-2\">\r\n                Sugerencias\r\n              </h3>\r\n              <ul className=\"space-y-1\">\r\n                {suggestions.map((suggestion, index) => (\r\n                  <li key={index}>\r\n                    <button\r\n                      onClick={() => selectQuery(suggestion)}\r\n                      className=\"text-sm text-left w-full p-1.5 hover:bg-gray-100 rounded-md truncate\"\r\n                    >\r\n                      {suggestion}\r\n                    </button>\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n            </div>\r\n          </div>\r\n          \r\n          {/* √Årea de resultados */}\r\n          <div className=\"flex-1 overflow-y-auto p-4\">\r\n            <AIResultList \r\n              isLoading={isLoading}\r\n              onSelect={onSelect}\r\n              query={query}\r\n            />\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Footer */}\r\n        <div className=\"border-t p-4 bg-gray-50 flex justify-between items-center\">\r\n          <div className=\"text-sm text-gray-500\">\r\n            Powered by IA - Resultados basados en tu consulta\r\n          </div>\r\n          <Button variant=\"outline\" onClick={onClose}>\r\n            Cerrar\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AISearchModal;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\proveedores\\tracking\\EmailTrackingList.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\proveedores\\tracking\\TrackingModal.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'ExternalLink' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":53,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":65}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { X, Mail, Clock, CheckCircle, Eye, XCircle, ExternalLink, Calendar } from 'lucide-react';\r\nimport Button from '../../../components/Button';\r\nimport Card from '../../../components/Card';\r\n\r\n/**\r\n * @typedef {import('./EmailTrackingList').EmailTrackingItem} EmailTrackingItem\r\n */\r\n\r\n/**\r\n * Modal que muestra los detalles completos del seguimiento de un email enviado a un proveedor.\r\n * Incluye informaci√≥n detallada sobre el estado del email, historial de interacciones,\r\n * contenido del mensaje, acciones realizadas y estad√≠sticas de apertura.\r\n * \r\n * @param {Object} props - Propiedades del componente\r\n * @param {boolean} props.isOpen - Indica si el modal est√° abierto\r\n * @param {Function} props.onClose - Funci√≥n para cerrar el modal\r\n * @param {EmailTrackingItem} props.trackingItem - Elemento de seguimiento a mostrar en detalle\r\n * @returns {React.ReactElement|null} Modal de detalles de seguimiento o null si no est√° abierto\r\n */\r\nconst TrackingModal = ({ isOpen, onClose, trackingItem }) => {\r\n  if (!isOpen || !trackingItem) return null;\r\n\r\n  // Funci√≥n para obtener el color y texto seg√∫n el estado del email\r\n  const getStatusInfo = (status) => {\r\n    switch (status) {\r\n      case 'enviado':\r\n        return {\r\n          color: 'text-blue-600',\r\n          bgColor: 'bg-blue-100',\r\n          icon: <Mail size={20} className=\"text-blue-600\" />,\r\n          text: 'Enviado'\r\n        };\r\n      case 'entregado':\r\n        return {\r\n          color: 'text-green-600',\r\n          bgColor: 'bg-green-100',\r\n          icon: <CheckCircle size={20} className=\"text-green-600\" />,\r\n          text: 'Entregado'\r\n        };\r\n      case 'leido':\r\n        return {\r\n          color: 'text-purple-600',\r\n          bgColor: 'bg-purple-100',\r\n          icon: <Eye size={20} className=\"text-purple-600\" />,\r\n          text: 'Le√≠do'\r\n        };\r\n      case 'error':\r\n        return {\r\n          color: 'text-red-600',\r\n          bgColor: 'bg-red-100',\r\n          icon: <XCircle size={20} className=\"text-red-600\" />,\r\n          text: 'Error'\r\n        };\r\n      case 'pendiente':\r\n        return {\r\n          color: 'text-amber-600',\r\n          bgColor: 'bg-amber-100',\r\n          icon: <Clock size={20} className=\"text-amber-600\" />,\r\n          text: 'Pendiente'\r\n        };\r\n      default:\r\n        return {\r\n          color: 'text-gray-600',\r\n          bgColor: 'bg-gray-100',\r\n          icon: <Clock size={20} className=\"text-gray-600\" />,\r\n          text: 'Desconocido'\r\n        };\r\n    }\r\n  };\r\n\r\n  // Formatear fecha y hora\r\n  const formatDateTime = (dateStr) => {\r\n    if (!dateStr) return '';\r\n    try {\r\n      const date = new Date(dateStr);\r\n      return date.toLocaleString('es-ES', {\r\n        day: '2-digit',\r\n        month: '2-digit',\r\n        year: 'numeric',\r\n        hour: '2-digit',\r\n        minute: '2-digit',\r\n        second: '2-digit'\r\n      });\r\n    } catch (e) {\r\n      return dateStr;\r\n    }\r\n  };\r\n\r\n  // Datos de ejemplo para la visualizaci√≥n\r\n  const statusInfo = getStatusInfo(trackingItem.status);\r\n\r\n  // Historial de actividad de ejemplo\r\n  const activities = [\r\n    {\r\n      type: 'send',\r\n      date: trackingItem.sentAt,\r\n      detail: `Email enviado a ${trackingItem.recipientEmail || 'destinatario'}`\r\n    }\r\n  ];\r\n\r\n  // A√±adir eventos adicionales basados en el estado\r\n  if (trackingItem.status !== 'enviado' && trackingItem.status !== 'error') {\r\n    activities.push({\r\n      type: 'deliver',\r\n      date: trackingItem.deliveredAt || new Date(new Date(trackingItem.sentAt).getTime() + 60000).toISOString(),\r\n      detail: 'Email entregado al servidor de destino'\r\n    });\r\n  }\r\n\r\n  if (trackingItem.status === 'leido') {\r\n    // A√±adir eventos de apertura\r\n    const openCount = trackingItem.openCount || 1;\r\n    for (let i = 0; i < openCount; i++) {\r\n      activities.push({\r\n        type: 'open',\r\n        date: i === 0 \r\n          ? trackingItem.firstOpenedAt || new Date(new Date(trackingItem.sentAt).getTime() + 300000).toISOString()\r\n          : new Date(new Date(trackingItem.sentAt).getTime() + (300000 * (i + 1))).toISOString(),\r\n        detail: `Email abierto ${i === 0 ? 'por primera vez' : `(apertura #${i + 1})`}`\r\n      });\r\n    }\r\n  }\r\n\r\n  if (trackingItem.status === 'error') {\r\n    activities.push({\r\n      type: 'error',\r\n      date: trackingItem.errorAt || new Date(new Date(trackingItem.sentAt).getTime() + 120000).toISOString(),\r\n      detail: trackingItem.errorMessage || 'Error en la entrega del email'\r\n    });\r\n  }\r\n\r\n  // Ordenar actividades por fecha\r\n  activities.sort((a, b) => new Date(a.date) - new Date(b.date));\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4\">\r\n      <div className=\"bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col\">\r\n        {/* Header */}\r\n        <div className=\"flex justify-between items-center p-4 border-b\">\r\n          <h2 className=\"text-xl font-semibold\">Seguimiento de Email</h2>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-gray-500 hover:text-gray-700\"\r\n            aria-label=\"Cerrar\"\r\n          >\r\n            <X size={24} />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Contenido principal con scroll */}\r\n        <div className=\"overflow-y-auto p-4 flex-1\">\r\n          {/* Informaci√≥n del email */}\r\n          <Card className=\"mb-6\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <h3 className=\"text-lg font-medium\">Informaci√≥n del email</h3>\r\n              <span className={`flex items-center gap-1 px-3 py-1 rounded-full ${statusInfo.bgColor} ${statusInfo.color}`}>\r\n                {statusInfo.icon}\r\n                <span className=\"ml-1 font-medium\">{statusInfo.text}</span>\r\n              </span>\r\n            </div>\r\n\r\n            <div className=\"space-y-3\">\r\n              <div>\r\n                <p className=\"text-sm text-gray-500\">Asunto</p>\r\n                <p className=\"font-medium\">{trackingItem.subject}</p>\r\n              </div>\r\n              \r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div>\r\n                  <p className=\"text-sm text-gray-500\">Proveedor</p>\r\n                  <p className=\"font-medium\">{trackingItem.providerName}</p>\r\n                </div>\r\n                \r\n                <div>\r\n                  <p className=\"text-sm text-gray-500\">Destinatario</p>\r\n                  <p className=\"font-medium\">{trackingItem.recipientEmail || 'No disponible'}</p>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div>\r\n                  <p className=\"text-sm text-gray-500\">Enviado</p>\r\n                  <p className=\"font-medium\">{formatDateTime(trackingItem.sentAt)}</p>\r\n                </div>\r\n                \r\n                <div>\r\n                  <p className=\"text-sm text-gray-500\">√öltima actualizaci√≥n</p>\r\n                  <p className=\"font-medium\">{formatDateTime(trackingItem.lastUpdated || trackingItem.sentAt)}</p>\r\n                </div>\r\n              </div>\r\n\r\n              {trackingItem.openCount > 0 && (\r\n                <div>\r\n                  <p className=\"text-sm text-gray-500\">Aperturas</p>\r\n                  <p className=\"font-medium text-green-600\">{trackingItem.openCount} {trackingItem.openCount === 1 ? 'vez' : 'veces'}</p>\r\n                </div>\r\n              )}\r\n              \r\n              {trackingItem.errorMessage && (\r\n                <div className=\"bg-red-50 p-3 rounded-md border border-red-200 text-red-700\">\r\n                  <p className=\"font-medium mb-1\">Error</p>\r\n                  <p className=\"text-sm\">{trackingItem.errorMessage}</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </Card>\r\n\r\n          {/* Historial de actividad */}\r\n          <div className=\"mb-6\">\r\n            <h3 className=\"text-lg font-medium mb-4\">Historial de actividad</h3>\r\n            \r\n            <div className=\"relative\">\r\n              {/* L√≠nea de tiempo vertical */}\r\n              <div className=\"absolute left-6 top-0 h-full w-0.5 bg-gray-200\"></div>\r\n              \r\n              {/* Eventos */}\r\n              <div className=\"space-y-6\">\r\n                {activities.map((activity, index) => {\r\n                  let icon;\r\n                  let iconBg;\r\n                  \r\n                  switch(activity.type) {\r\n                    case 'send':\r\n                      icon = <Mail size={16} className=\"text-white\" />;\r\n                      iconBg = 'bg-blue-500';\r\n                      break;\r\n                    case 'deliver':\r\n                      icon = <CheckCircle size={16} className=\"text-white\" />;\r\n                      iconBg = 'bg-green-500';\r\n                      break;\r\n                    case 'open':\r\n                      icon = <Eye size={16} className=\"text-white\" />;\r\n                      iconBg = 'bg-purple-500';\r\n                      break;\r\n                    case 'error':\r\n                      icon = <XCircle size={16} className=\"text-white\" />;\r\n                      iconBg = 'bg-red-500';\r\n                      break;\r\n                    default:\r\n                      icon = <Clock size={16} className=\"text-white\" />;\r\n                      iconBg = 'bg-gray-500';\r\n                  }\r\n                  \r\n                  return (\r\n                    <div key={index} className=\"flex\">\r\n                      <div className=\"relative flex items-center justify-center\">\r\n                        <div className={`w-12 h-12 rounded-full ${iconBg} flex items-center justify-center z-10`}>\r\n                          {icon}\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"ml-4 flex-1\">\r\n                        <div className=\"bg-white p-4 rounded-lg border border-gray-200 shadow-sm\">\r\n                          <p className=\"text-sm text-gray-500 mb-1\">\r\n                            {formatDateTime(activity.date)}\r\n                          </p>\r\n                          <p className=\"font-medium\">{activity.detail}</p>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Contenido del email (ejemplo) */}\r\n          <Card>\r\n            <h3 className=\"text-lg font-medium mb-4\">Contenido del email</h3>\r\n            <div className=\"bg-gray-50 p-4 rounded-md border border-gray-200\">\r\n              <div className=\"mb-4\">\r\n                <p><strong>De:</strong> Tu Correo de Lovenda</p>\r\n                <p><strong>Para:</strong> {trackingItem.recipientEmail || 'proveedor@ejemplo.com'}</p>\r\n                <p><strong>Asunto:</strong> {trackingItem.subject}</p>\r\n              </div>\r\n              <div className=\"border-t border-gray-200 pt-4\">\r\n                <p>Estimado proveedor,</p>\r\n                <br/>\r\n                <p>Este es un ejemplo del contenido del email que se envi√≥ al proveedor.</p>\r\n                <p>En una implementaci√≥n real, aqu√≠ se mostrar√≠a el contenido real del email enviado.</p>\r\n                <br/>\r\n                <p>Saludos cordiales,</p>\r\n                <p>Tu Nombre</p>\r\n              </div>\r\n            </div>\r\n          </Card>\r\n        </div>\r\n        \r\n        {/* Footer con botones */}\r\n        <div className=\"border-t p-4 bg-gray-50 flex justify-between\">\r\n          <div>\r\n            <Button variant=\"outline\" size=\"sm\" className=\"flex items-center\">\r\n              <Calendar size={16} className=\"mr-1\" /> Programar seguimiento\r\n            </Button>\r\n          </div>\r\n          <div className=\"flex space-x-3\">\r\n            <Button variant=\"outline\" onClick={onClose}>\r\n              Cerrar\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\" \r\n              className=\"flex items-center\"\r\n              onClick={() => window.open(`mailto:${trackingItem.recipientEmail || ''}`)}\r\n            >\r\n              <Mail size={16} className=\"mr-1\" /> Responder\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TrackingModal;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\seating\\SeatingPlanCanvas.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useRef' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'onTableDimensionChange' is defined but never used. Allowed unused args must match /^_/u.","line":20,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":25},{"ruleId":"no-unused-vars","severity":1,"message":"'onDrawModeChange' is defined but never used. Allowed unused args must match /^_/u.","line":26,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used. Allowed unused args must match /^_/u.","line":40,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":40,"endColumn":43},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used. Allowed unused args must match /^_/u.","line":44,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":44,"endColumn":43}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Componente Canvas especializado para el plan de asientos\r\n * Maneja la visualizaci√≥n y interacci√≥n con mesas y sillas\r\n */\r\n\r\nimport React, { useRef, useEffect, useCallback } from 'react';\r\nimport { DndProvider } from 'react-dnd';\r\nimport { HTML5Backend } from 'react-dnd-html5-backend';\r\nimport { TouchBackend } from 'react-dnd-touch-backend';\r\nimport SeatingCanvas from '../../features/seating/SeatingCanvas';\r\n\r\nconst SeatingPlanCanvas = ({\r\n  tab,\r\n  areas,\r\n  tables,\r\n  seats,\r\n  hallSize,\r\n  selectedTable,\r\n  onSelectTable,\r\n  onTableDimensionChange,\r\n  onAssignGuest,\r\n  onToggleEnabled,\r\n  onAddArea,\r\n  onAddTable,\r\n  drawMode = 'pan',\r\n  onDrawModeChange,\r\n  canvasRef,\r\n  className = \"\"\r\n}) => {\r\n  // Detectar si es dispositivo t√°ctil\r\n  const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\r\n  const backend = isTouchDevice ? TouchBackend : HTML5Backend;\r\n  \r\n  // Handlers de eventos del canvas\r\n  const handleWheel = useCallback((e) => {\r\n    e.preventDefault();\r\n    // L√≥gica de zoom\r\n  }, []);\r\n  \r\n  const handlePointerDown = useCallback((e) => {\r\n    // L√≥gica de inicio de interacci√≥n\r\n  }, []);\r\n  \r\n  const handlePointerMove = useCallback((e) => {\r\n    // L√≥gica de movimiento\r\n  }, []);\r\n  \r\n  const handlePointerUp = useCallback(() => {\r\n    // L√≥gica de fin de interacci√≥n\r\n  }, []);\r\n  \r\n  // Configurar eventos del canvas\r\n  useEffect(() => {\r\n    const canvas = canvasRef.current;\r\n    if (!canvas) return;\r\n    \r\n    canvas.addEventListener('wheel', handleWheel, { passive: false });\r\n    canvas.addEventListener('pointerdown', handlePointerDown);\r\n    canvas.addEventListener('pointermove', handlePointerMove);\r\n    canvas.addEventListener('pointerup', handlePointerUp);\r\n    \r\n    return () => {\r\n      canvas.removeEventListener('wheel', handleWheel);\r\n      canvas.removeEventListener('pointerdown', handlePointerDown);\r\n      canvas.removeEventListener('pointermove', handlePointerMove);\r\n      canvas.removeEventListener('pointerup', handlePointerUp);\r\n    };\r\n  }, [handleWheel, handlePointerDown, handlePointerMove, handlePointerUp]);\r\n  \r\n  return (\r\n    <DndProvider backend={backend}>\r\n      <div className={`relative bg-gray-50 border rounded-lg overflow-hidden ${className}`}>\r\n        {/* Canvas principal */}\r\n        <div\r\n          ref={canvasRef}\r\n          className=\"w-full h-full min-h-[600px] relative cursor-crosshair\"\r\n          style={{\r\n            backgroundImage: `\r\n              linear-gradient(rgba(0,0,0,0.1) 1px, transparent 1px),\r\n              linear-gradient(90deg, rgba(0,0,0,0.1) 1px, transparent 1px)\r\n            `,\r\n            backgroundSize: '20px 20px'\r\n          }}\r\n        >\r\n          {/* Componente SeatingCanvas existente */}\r\n          <SeatingCanvas\r\n            tab={tab}\r\n            areas={areas}\r\n            tables={tables}\r\n            seats={seats}\r\n            hallSize={hallSize}\r\n            selectedTable={selectedTable}\r\n            onSelectTable={onSelectTable}\r\n            onAssignGuest={onAssignGuest}\r\n            onToggleEnabled={onToggleEnabled}\r\n            onAddArea={onAddArea}\r\n            onAddTable={onAddTable}\r\n            drawMode={drawMode}\r\n            canPan={drawMode === 'pan'}\r\n            canMoveTables={drawMode === 'move'}\r\n          />\r\n          \r\n          {/* Indicadores de dimensiones del sal√≥n */}\r\n          <div className=\"absolute top-2 left-2 bg-white/90 px-2 py-1 rounded text-xs text-gray-600\">\r\n            {(hallSize.width/100).toFixed(1)} √ó {(hallSize.height/100).toFixed(1)} m\r\n          </div>\r\n          \r\n          {/* Controles de zoom */}\r\n          <div className=\"absolute bottom-4 right-4 flex flex-col gap-2\">\r\n            <button\r\n              className=\"w-8 h-8 bg-white shadow-md rounded flex items-center justify-center hover:bg-gray-50\"\r\n              title=\"Zoom in\"\r\n            >\r\n              +\r\n            </button>\r\n            <button\r\n              className=\"w-8 h-8 bg-white shadow-md rounded flex items-center justify-center hover:bg-gray-50\"\r\n              title=\"Zoom out\"\r\n            >\r\n              ‚àí\r\n            </button>\r\n            <button\r\n              className=\"w-8 h-8 bg-white shadow-md rounded flex items-center justify-center hover:bg-gray-50\"\r\n              title=\"Ajustar a pantalla\"\r\n            >\r\n              ‚åÇ\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </DndProvider>\r\n  );\r\n};\r\n\r\nexport default React.memo(SeatingPlanCanvas);\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\seating\\SeatingPlanModals.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Zap' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":48}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Componente que agrupa todos los modales del plan de asientos\r\n * Gestiona la configuraci√≥n de ceremonia, banquete, espacio y plantillas\r\n */\r\n\r\nimport React from 'react';\r\nimport { X, Grid, Users, Maximize, Palette, Zap } from 'lucide-react';\r\n\r\nconst Modal = ({ isOpen, onClose, title, children, icon: Icon }) => {\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\r\n      <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-hidden\">\r\n        <div className=\"flex items-center justify-between p-4 border-b\">\r\n          <div className=\"flex items-center gap-2\">\r\n            {Icon && <Icon className=\"h-5 w-5 text-blue-600\" />}\r\n            <h3 className=\"text-lg font-semibold\">{title}</h3>\r\n          </div>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"p-1 hover:bg-gray-100 rounded\"\r\n          >\r\n            <X className=\"h-5 w-5\" />\r\n          </button>\r\n        </div>\r\n        <div className=\"p-4 overflow-y-auto max-h-[calc(90vh-80px)]\">\r\n          {children}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst SeatingPlanModals = ({\r\n  // Estados de modales\r\n  ceremonyConfigOpen,\r\n  banquetConfigOpen,\r\n  spaceConfigOpen,\r\n  templateOpen,\r\n  \r\n  // Handlers de cierre\r\n  onCloseCeremonyConfig,\r\n  onCloseBanquetConfig,\r\n  onCloseSpaceConfig,\r\n  onCloseTemplate,\r\n  \r\n  // Handlers de configuraci√≥n\r\n  onGenerateSeatGrid,\r\n  onGenerateBanquetLayout,\r\n  onSaveHallDimensions,\r\n  onApplyTemplate,\r\n  \r\n  // Estado actual\r\n  hallSize\r\n}) => {\r\n  return (\r\n    <>\r\n      {/* Modal de configuraci√≥n de ceremonia */}\r\n      <Modal\r\n        isOpen={ceremonyConfigOpen}\r\n        onClose={onCloseCeremonyConfig}\r\n        title=\"Configurar Ceremonia\"\r\n        icon={Grid}\r\n      >\r\n        <CeremonyConfigForm\r\n          onGenerate={onGenerateSeatGrid}\r\n          onClose={onCloseCeremonyConfig}\r\n        />\r\n      </Modal>\r\n\r\n      {/* Modal de configuraci√≥n de banquete */}\r\n      <Modal\r\n        isOpen={banquetConfigOpen}\r\n        onClose={onCloseBanquetConfig}\r\n        title=\"Configurar Banquete\"\r\n        icon={Users}\r\n      >\r\n        <BanquetConfigForm\r\n          onGenerate={onGenerateBanquetLayout}\r\n          onClose={onCloseBanquetConfig}\r\n        />\r\n      </Modal>\r\n\r\n      {/* Modal de configuraci√≥n de espacio */}\r\n      <Modal\r\n        isOpen={spaceConfigOpen}\r\n        onClose={onCloseSpaceConfig}\r\n        title=\"Configurar Espacio\"\r\n        icon={Maximize}\r\n      >\r\n        <SpaceConfigForm\r\n          hallSize={hallSize}\r\n          onSave={onSaveHallDimensions}\r\n          onClose={onCloseSpaceConfig}\r\n        />\r\n      </Modal>\r\n\r\n      {/* Modal de plantillas */}\r\n      <Modal\r\n        isOpen={templateOpen}\r\n        onClose={onCloseTemplate}\r\n        title=\"Plantillas\"\r\n        icon={Palette}\r\n      >\r\n        <TemplateSelector\r\n          onApply={onApplyTemplate}\r\n          onClose={onCloseTemplate}\r\n        />\r\n      </Modal>\r\n    </>\r\n  );\r\n};\r\n\r\n// Formulario de configuraci√≥n de ceremonia\r\nconst CeremonyConfigForm = ({ onGenerate, onClose }) => {\r\n  const [config, setConfig] = React.useState({\r\n    rows: 10,\r\n    cols: 12,\r\n    gap: 40,\r\n    startX: 100,\r\n    startY: 80,\r\n    aisleAfter: 6\r\n  });\r\n\r\n  const handleSubmit = (e) => {\r\n    e.preventDefault();\r\n    onGenerate(config.rows, config.cols, config.gap, config.startX, config.startY, config.aisleAfter);\r\n    onClose();\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n      <div className=\"grid grid-cols-2 gap-4\">\r\n        <div>\r\n          <label className=\"block text-sm font-medium mb-1\">Filas</label>\r\n          <input\r\n            type=\"number\"\r\n            min=\"1\"\r\n            max=\"20\"\r\n            value={config.rows}\r\n            onChange={(e) => setConfig(prev => ({ ...prev, rows: parseInt(e.target.value) }))}\r\n            className=\"w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n          />\r\n        </div>\r\n        <div>\r\n          <label className=\"block text-sm font-medium mb-1\">Columnas</label>\r\n          <input\r\n            type=\"number\"\r\n            min=\"1\"\r\n            max=\"30\"\r\n            value={config.cols}\r\n            onChange={(e) => setConfig(prev => ({ ...prev, cols: parseInt(e.target.value) }))}\r\n            className=\"w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <div>\r\n        <label className=\"block text-sm font-medium mb-1\">Separaci√≥n (cm)</label>\r\n        <input\r\n          type=\"number\"\r\n          min=\"20\"\r\n          max=\"100\"\r\n          value={config.gap}\r\n          onChange={(e) => setConfig(prev => ({ ...prev, gap: parseInt(e.target.value) }))}\r\n          className=\"w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n        />\r\n      </div>\r\n\r\n      <div>\r\n        <label className=\"block text-sm font-medium mb-1\">Pasillo despu√©s de columna</label>\r\n        <input\r\n          type=\"number\"\r\n          min=\"0\"\r\n          max={config.cols}\r\n          value={config.aisleAfter}\r\n          onChange={(e) => setConfig(prev => ({ ...prev, aisleAfter: parseInt(e.target.value) }))}\r\n          className=\"w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n        />\r\n      </div>\r\n\r\n      <div className=\"flex gap-2 pt-4\">\r\n        <button\r\n          type=\"button\"\r\n          onClick={onClose}\r\n          className=\"flex-1 px-4 py-2 border border-gray-300 rounded hover:bg-gray-50\"\r\n        >\r\n          Cancelar\r\n        </button>\r\n        <button\r\n          type=\"submit\"\r\n          className=\"flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\"\r\n        >\r\n          Generar\r\n        </button>\r\n      </div>\r\n    </form>\r\n  );\r\n};\r\n\r\n// Formulario de configuraci√≥n de banquete\r\nconst BanquetConfigForm = ({ onGenerate, onClose }) => {\r\n  const [config, setConfig] = React.useState({\r\n    rows: 3,\r\n    cols: 4,\r\n    seats: 8,\r\n    gapX: 140,\r\n    gapY: 160,\r\n    startX: 120,\r\n    startY: 160\r\n  });\r\n\r\n  const handleSubmit = (e) => {\r\n    e.preventDefault();\r\n    onGenerate(config);\r\n    onClose();\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n      <div className=\"grid grid-cols-2 gap-4\">\r\n        <div>\r\n          <label className=\"block text-sm font-medium mb-1\">Filas de mesas</label>\r\n          <input\r\n            type=\"number\"\r\n            min=\"1\"\r\n            max=\"10\"\r\n            value={config.rows}\r\n            onChange={(e) => setConfig(prev => ({ ...prev, rows: parseInt(e.target.value) }))}\r\n            className=\"w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n          />\r\n        </div>\r\n        <div>\r\n          <label className=\"block text-sm font-medium mb-1\">Columnas de mesas</label>\r\n          <input\r\n            type=\"number\"\r\n            min=\"1\"\r\n            max=\"15\"\r\n            value={config.cols}\r\n            onChange={(e) => setConfig(prev => ({ ...prev, cols: parseInt(e.target.value) }))}\r\n            className=\"w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <div>\r\n        <label className=\"block text-sm font-medium mb-1\">Asientos por mesa</label>\r\n        <input\r\n          type=\"number\"\r\n          min=\"2\"\r\n          max=\"20\"\r\n          value={config.seats}\r\n          onChange={(e) => setConfig(prev => ({ ...prev, seats: parseInt(e.target.value) }))}\r\n          className=\"w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n        />\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-2 gap-4\">\r\n        <div>\r\n          <label className=\"block text-sm font-medium mb-1\">Separaci√≥n X (cm)</label>\r\n          <input\r\n            type=\"number\"\r\n            min=\"80\"\r\n            max=\"300\"\r\n            value={config.gapX}\r\n            onChange={(e) => setConfig(prev => ({ ...prev, gapX: parseInt(e.target.value) }))}\r\n            className=\"w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n          />\r\n        </div>\r\n        <div>\r\n          <label className=\"block text-sm font-medium mb-1\">Separaci√≥n Y (cm)</label>\r\n          <input\r\n            type=\"number\"\r\n            min=\"80\"\r\n            max=\"300\"\r\n            value={config.gapY}\r\n            onChange={(e) => setConfig(prev => ({ ...prev, gapY: parseInt(e.target.value) }))}\r\n            className=\"w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"flex gap-2 pt-4\">\r\n        <button\r\n          type=\"button\"\r\n          onClick={onClose}\r\n          className=\"flex-1 px-4 py-2 border border-gray-300 rounded hover:bg-gray-50\"\r\n        >\r\n          Cancelar\r\n        </button>\r\n        <button\r\n          type=\"submit\"\r\n          className=\"flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\"\r\n        >\r\n          Generar\r\n        </button>\r\n      </div>\r\n    </form>\r\n  );\r\n};\r\n\r\n// Formulario de configuraci√≥n de espacio\r\nconst SpaceConfigForm = ({ hallSize, onSave, onClose }) => {\r\n  const [dimensions, setDimensions] = React.useState(hallSize);\r\n\r\n  const handleSubmit = (e) => {\r\n    e.preventDefault();\r\n    onSave(dimensions.width, dimensions.height);\r\n    onClose();\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n      <div className=\"grid grid-cols-2 gap-4\">\r\n        <div>\r\n          <label className=\"block text-sm font-medium mb-1\">Ancho (m)</label>\r\n          <input\r\n            type=\"number\"\r\n            min=\"2\"\r\n            max=\"50\"\r\n            value={(dimensions.width/100).toString()}\r\n            onChange={(e) => setDimensions(prev => ({ ...prev, width: parseFloat(e.target.value)*100 }))}\r\n            className=\"w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n          />\r\n        </div>\r\n        <div>\r\n          <label className=\"block text-sm font-medium mb-1\">Largo (m)</label>\r\n          <input\r\n            type=\"number\"\r\n            min=\"2\"\r\n            max=\"50\"\r\n            value={(dimensions.height/100).toString()}\r\n            onChange={(e) => setDimensions(prev => ({ ...prev, height: parseFloat(e.target.value)*100 }))}\r\n            className=\"w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"bg-gray-50 p-3 rounded\">\r\n        <p className=\"text-sm text-gray-600\">\r\n          <strong>√Årea total:</strong> {(dimensions.width * dimensions.height / 10000).toFixed(1)} m¬≤\r\n        </p>\r\n      </div>\r\n\r\n      <div className=\"flex gap-2 pt-4\">\r\n        <button\r\n          type=\"button\"\r\n          onClick={onClose}\r\n          className=\"flex-1 px-4 py-2 border border-gray-300 rounded hover:bg-gray-50\"\r\n        >\r\n          Cancelar\r\n        </button>\r\n        <button\r\n          type=\"submit\"\r\n          className=\"flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\"\r\n        >\r\n          Guardar\r\n        </button>\r\n      </div>\r\n    </form>\r\n  );\r\n};\r\n\r\n// Selector de plantillas\r\nconst TemplateSelector = ({ onApply, onClose }) => {\r\n  const templates = [\r\n    {\r\n      id: 'intimate',\r\n      name: 'Boda √çntima',\r\n      description: '50-80 invitados',\r\n      ceremony: { rows: 8, cols: 8 },\r\n      banquet: { rows: 2, cols: 3, seats: 8 }\r\n    },\r\n    {\r\n      id: 'medium',\r\n      name: 'Boda Mediana',\r\n      description: '80-150 invitados',\r\n      ceremony: { rows: 12, cols: 10 },\r\n      banquet: { rows: 3, cols: 4, seats: 10 }\r\n    },\r\n    {\r\n      id: 'large',\r\n      name: 'Boda Grande',\r\n      description: '150+ invitados',\r\n      ceremony: { rows: 15, cols: 12 },\r\n      banquet: { rows: 4, cols: 5, seats: 12 }\r\n    }\r\n  ];\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <p className=\"text-sm text-gray-600\">\r\n        Selecciona una plantilla predefinida para comenzar r√°pidamente:\r\n      </p>\r\n      \r\n      {templates.map((template) => (\r\n        <div\r\n          key={template.id}\r\n          className=\"border rounded-lg p-4 hover:bg-gray-50 cursor-pointer\"\r\n          onClick={() => {\r\n            onApply(template);\r\n            onClose();\r\n          }}\r\n        >\r\n          <h4 className=\"font-medium\">{template.name}</h4>\r\n          <p className=\"text-sm text-gray-600 mb-2\">{template.description}</p>\r\n          <div className=\"text-xs text-gray-500\">\r\n            Ceremonia: {template.ceremony.rows}√ó{template.ceremony.cols} asientos ‚Ä¢ \r\n            Banquete: {template.banquet.rows}√ó{template.banquet.cols} mesas de {template.banquet.seats}\r\n          </div>\r\n        </div>\r\n      ))}\r\n      \r\n      <div className=\"flex gap-2 pt-4\">\r\n        <button\r\n          onClick={onClose}\r\n          className=\"w-full px-4 py-2 border border-gray-300 rounded hover:bg-gray-50\"\r\n        >\r\n          Cancelar\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SeatingPlanModals;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\seating\\SeatingPlanRefactored.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'pushHistory' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":51,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":51,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'handleConfigureTable' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":87,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":87,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * SeatingPlan refactorizado - Componente principal modular\r\n * Reemplaza el SeatingPlan.jsx monol√≠tico con arquitectura de componentes especializados\r\n */\r\n\r\nimport React, { useEffect } from 'react';\r\nimport { useSeatingPlan } from '../../hooks/useSeatingPlan';\r\nimport SeatingPlanTabs from './SeatingPlanTabs';\r\nimport SeatingPlanToolbar from './SeatingPlanToolbar';\r\nimport SeatingPlanCanvas from './SeatingPlanCanvas';\r\nimport SeatingPlanSidebar from './SeatingPlanSidebar';\r\nimport SeatingPlanModals from './SeatingPlanModals';\r\n\r\nconst SeatingPlanRefactored = () => {\r\n  const {\r\n    // Estados principales\r\n    tab,\r\n    setTab,\r\n    syncStatus,\r\n    hallSize,\r\n    areas,\r\n    tables,\r\n    seats,\r\n    selectedTable,\r\n    guests,\r\n    \r\n    // Estados de modales\r\n    ceremonyConfigOpen,\r\n    setCeremonyConfigOpen,\r\n    banquetConfigOpen,\r\n    setBanquetConfigOpen,\r\n    spaceConfigOpen,\r\n    setSpaceConfigOpen,\r\n    templateOpen,\r\n    setTemplateOpen,\r\n    \r\n    // Referencias\r\n    canvasRef,\r\n    \r\n    // Funciones de gesti√≥n\r\n    handleSelectTable,\r\n    handleTableDimensionChange,\r\n    toggleSelectedTableShape,\r\n    setConfigTable,\r\n    \r\n    // Funciones de historial\r\n    undo,\r\n    redo,\r\n    canUndo,\r\n    canRedo,\r\n    pushHistory,\r\n    \r\n    // Funciones de generaci√≥n\r\n    generateSeatGrid,\r\n    generateBanquetLayout,\r\n    \r\n    // Funciones de exportaci√≥n\r\n    exportPNG,\r\n    exportPDF,\r\n    \r\n    // Funciones de configuraci√≥n\r\n    saveHallDimensions,\r\n    \r\n    // Funciones de gesti√≥n de √°reas y mesas\r\n    addArea,\r\n    addTable,\r\n    \r\n    // Estado de dibujo\r\n    drawMode,\r\n    setDrawMode\r\n  } = useSeatingPlan();\r\n\r\n  // Handlers de modales\r\n  const handleOpenCeremonyConfig = () => setCeremonyConfigOpen(true);\r\n  const handleCloseCeremonyConfig = () => setCeremonyConfigOpen(false);\r\n  \r\n  const handleOpenBanquetConfig = () => setBanquetConfigOpen(true);\r\n  const handleCloseBanquetConfig = () => setBanquetConfigOpen(false);\r\n  \r\n  const handleOpenSpaceConfig = () => setSpaceConfigOpen(true);\r\n  const handleCloseSpaceConfig = () => setSpaceConfigOpen(false);\r\n  \r\n  const handleOpenTemplates = () => setTemplateOpen(true);\r\n  const handleCloseTemplates = () => setTemplateOpen(false);\r\n\r\n  // Handler de configuraci√≥n de mesa\r\n  const handleConfigureTable = (table) => {\r\n    setConfigTable(table);\r\n    if (tab === 'ceremony') {\r\n      handleOpenCeremonyConfig();\r\n    } else {\r\n      handleOpenBanquetConfig();\r\n    }\r\n  };\r\n\r\n  // Handler de asignaci√≥n autom√°tica con IA\r\n  const handleAutoAssign = async () => {\r\n    try {\r\n      // Aqu√≠ ir√≠a la l√≥gica de asignaci√≥n autom√°tica con IA\r\n      console.log('Iniciando asignaci√≥n autom√°tica con IA...');\r\n      \r\n      // Simulaci√≥n de asignaci√≥n inteligente\r\n      // En una implementaci√≥n real, esto llamar√≠a a un servicio de IA\r\n      \r\n    } catch (error) {\r\n      console.error('Error en asignaci√≥n autom√°tica:', error);\r\n    }\r\n  };\r\n\r\n  // Handler de aplicaci√≥n de plantillas\r\n  const handleApplyTemplate = (template) => {\r\n    if (template.ceremony) {\r\n      generateSeatGrid(\r\n        template.ceremony.rows,\r\n        template.ceremony.cols,\r\n        40, // gap por defecto\r\n        100, // startX por defecto\r\n        80, // startY por defecto\r\n        Math.floor(template.ceremony.cols / 2) // aisleAfter\r\n      );\r\n    }\r\n    \r\n    if (template.banquet) {\r\n      generateBanquetLayout({\r\n        rows: template.banquet.rows,\r\n        cols: template.banquet.cols,\r\n        seats: template.banquet.seats,\r\n        gapX: 140,\r\n        gapY: 160,\r\n        startX: 120,\r\n        startY: 160\r\n      });\r\n    }\r\n  };\r\n\r\n  // Handlers de asignaci√≥n de invitados\r\n  const handleAssignGuest = (tableId, guestId) => {\r\n    // Usar la funci√≥n del hook para asignar invitados\r\n    // TODO: Implementar funci√≥n de asignaci√≥n en el hook\r\n    console.log(`Asignando invitado ${guestId} a mesa ${tableId}`);\r\n  };\r\n\r\n\r\n  const handleToggleEnabled = (id) => {\r\n    // L√≥gica para habilitar/deshabilitar elementos\r\n    console.log(`Toggling enabled state for ${id}`);\r\n  };\r\n\r\n  const handleAddArea = (area) => {\r\n    // Usar la funci√≥n del hook para a√±adir √°reas\r\n    addArea(area);\r\n  };\r\n\r\n  const handleAddTable = (table) => {\r\n    // Usar la funci√≥n del hook para a√±adir mesas\r\n    addTable(table);\r\n  };\r\n\r\n  // Contadores para las pesta√±as\r\n  const ceremonyCount = seats.length;\r\n  const banquetCount = tables.length;\r\n\r\n  return (\r\n    <div className=\"h-full flex flex-col bg-gray-50\">\r\n      {/* Header con pesta√±as */}\r\n      <div className=\"flex-shrink-0 p-4 pb-0\">\r\n        <SeatingPlanTabs\r\n          activeTab={tab}\r\n          onTabChange={setTab}\r\n          ceremonyCount={ceremonyCount}\r\n          banquetCount={banquetCount}\r\n        />\r\n      </div>\r\n\r\n      {/* Toolbar */}\r\n      <div className=\"flex-shrink-0 p-4 pb-2\">\r\n        <SeatingPlanToolbar\r\n          tab={tab}\r\n          onUndo={undo}\r\n          onRedo={redo}\r\n          canUndo={canUndo}\r\n          canRedo={canRedo}\r\n          onExportPNG={exportPNG}\r\n          onExportPDF={exportPDF}\r\n          onOpenCeremonyConfig={handleOpenCeremonyConfig}\r\n          onOpenBanquetConfig={handleOpenBanquetConfig}\r\n          onOpenSpaceConfig={handleOpenSpaceConfig}\r\n          onOpenTemplates={handleOpenTemplates}\r\n          onAutoAssign={handleAutoAssign}\r\n          syncStatus={syncStatus}\r\n        />\r\n      </div>\r\n\r\n      {/* Contenido principal */}\r\n      <div className=\"flex-1 flex\">\r\n        {/* Sidebar izquierdo */}\r\n        <div className=\"w-80 flex-shrink-0\">\r\n          <SeatingPlanSidebar\r\n            selectedTable={selectedTable}\r\n            onTableDimensionChange={handleTableDimensionChange}\r\n            onToggleTableShape={toggleSelectedTableShape}\r\n            onConfigureTable={setConfigTable}\r\n            guests={guests}\r\n            tab={tab}\r\n            drawMode={drawMode}\r\n            onDrawModeChange={setDrawMode}\r\n            onAssignGuest={handleAssignGuest}\r\n            onAutoAssign={handleAutoAssign}\r\n            className=\"h-full\"\r\n          />\r\n        </div>\r\n\r\n        {/* Canvas principal */}\r\n        <div className=\"flex-1\">\r\n          <SeatingPlanCanvas\r\n            tab={tab}\r\n            areas={areas}\r\n            tables={tables}\r\n            seats={seats}\r\n            hallSize={hallSize}\r\n            selectedTable={selectedTable}\r\n            onSelectTable={handleSelectTable}\r\n            onTableDimensionChange={handleTableDimensionChange}\r\n            onAssignGuest={handleAssignGuest}\r\n            onToggleEnabled={handleToggleEnabled}\r\n            onAddArea={handleAddArea}\r\n            onAddTable={handleAddTable}\r\n            drawMode={drawMode}\r\n            onDrawModeChange={setDrawMode}\r\n            canvasRef={canvasRef}\r\n            className=\"h-full\"\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Modales */}\r\n      <SeatingPlanModals\r\n        ceremonyConfigOpen={ceremonyConfigOpen}\r\n        banquetConfigOpen={banquetConfigOpen}\r\n        spaceConfigOpen={spaceConfigOpen}\r\n        templateOpen={templateOpen}\r\n        onCloseCeremonyConfig={handleCloseCeremonyConfig}\r\n        onCloseBanquetConfig={handleCloseBanquetConfig}\r\n        onCloseSpaceConfig={handleCloseSpaceConfig}\r\n        onCloseTemplate={handleCloseTemplates}\r\n        onGenerateSeatGrid={generateSeatGrid}\r\n        onGenerateBanquetLayout={generateBanquetLayout}\r\n        onSaveHallDimensions={saveHallDimensions}\r\n        onApplyTemplate={handleApplyTemplate}\r\n        hallSize={hallSize}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SeatingPlanRefactored;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\seating\\SeatingPlanSidebar.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Pencil' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":9},{"ruleId":"no-unused-vars","severity":1,"message":"'Edit3' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Componente Sidebar especializado para el plan de asientos\r\n * Maneja la informaci√≥n de mesas seleccionadas, herramientas de dibujo e invitados\r\n */\r\n\r\nimport React, { useState } from 'react';\r\nimport { \r\n  Settings, Users, Maximize2, RotateCcw, Move, Hand, \r\n  Pencil, Minus, Square, Zap, Search, UserPlus,\r\n  MousePointer, Edit3, Eraser, DoorOpen, Hexagon\r\n} from 'lucide-react';\r\n\r\nconst SeatingPlanSidebar = ({\r\n  selectedTable,\r\n  onTableDimensionChange,\r\n  onToggleTableShape,\r\n  onConfigureTable,\r\n  guests = [],\r\n  tab,\r\n  drawMode = 'pan',\r\n  onDrawModeChange,\r\n  onAssignGuest,\r\n  onAutoAssign,\r\n  className = \"\"\r\n}) => {\r\n  const [guestSearch, setGuestSearch] = useState('');\r\n  const [showAvailableGuests, setShowAvailableGuests] = useState(false);\r\n  \r\n  // Herramientas de dibujo espec√≠ficas para banquete\r\n  const drawingTools = [\r\n    { id: 'pan', label: 'Navegar', icon: Hand },\r\n    { id: 'move', label: 'Mover mesas', icon: Move },\r\n    { id: 'boundary', label: 'Per√≠metro', icon: Square },\r\n    { id: 'door', label: 'Puertas', icon: DoorOpen },\r\n    { id: 'obstacle', label: 'Obst√°culos', icon: Hexagon },\r\n    { id: 'aisle', label: 'Pasillos', icon: Minus },\r\n    { id: 'erase', label: 'Borrar', icon: Eraser }\r\n  ];\r\n\r\n  // Filtrar invitados disponibles (sin asignar)\r\n  const availableGuests = guests.filter(guest => \r\n    !guest.tableId && \r\n    guest.name.toLowerCase().includes(guestSearch.toLowerCase())\r\n  );\r\n\r\n  const assignedGuests = guests.filter(guest => \r\n    guest.tableId === selectedTable?.id\r\n  );\r\n\r\n  return (\r\n    <div className={`bg-white border rounded-lg overflow-hidden ${className}`}>\r\n      {/* Herramientas de Dibujo */}\r\n      <div className=\"bg-gray-50 px-4 py-3 border-b\">\r\n        <h3 className=\"font-medium text-gray-900 mb-3\">Herramientas</h3>\r\n        <div className=\"grid grid-cols-2 gap-2\">\r\n          {drawingTools.map((tool) => {\r\n            const Icon = tool.icon;\r\n            return (\r\n              <button\r\n                key={tool.id}\r\n                onClick={() => onDrawModeChange?.(tool.id)}\r\n                className={`flex items-center gap-2 px-2 py-1 rounded text-xs transition-colors ${\r\n                  drawMode === tool.id\r\n                    ? 'bg-blue-600 text-white'\r\n                    : 'bg-gray-200 hover:bg-gray-300 text-gray-700'\r\n                }`}\r\n                title={tool.label}\r\n              >\r\n                <Icon className=\"h-3 w-3\" />\r\n                <span className=\"truncate\">{tool.label}</span>\r\n              </button>\r\n            );\r\n          })}\r\n        </div>\r\n        \r\n        {/* Instrucciones de uso */}\r\n        {drawMode === 'boundary' && (\r\n          <div className=\"mt-3 p-2 bg-blue-50 border border-blue-200 rounded text-xs text-blue-800\">\r\n            <strong>Per√≠metro:</strong> Haz clic para a√±adir puntos. Doble clic para cerrar el pol√≠gono.\r\n          </div>\r\n        )}\r\n        {drawMode === 'obstacle' && (\r\n          <div className=\"mt-3 p-2 bg-orange-50 border border-orange-200 rounded text-xs text-orange-800\">\r\n            <strong>Obst√°culos:</strong> Arrastra para crear rect√°ngulos (columnas, decoraciones).\r\n          </div>\r\n        )}\r\n        {drawMode === 'door' && (\r\n          <div className=\"mt-3 p-2 bg-green-50 border border-green-200 rounded text-xs text-green-800\">\r\n            <strong>Puertas:</strong> Arrastra para marcar entradas y salidas.\r\n          </div>\r\n        )}\r\n        {drawMode === 'aisle' && (\r\n          <div className=\"mt-3 p-2 bg-purple-50 border border-purple-200 rounded text-xs text-purple-800\">\r\n            <strong>Pasillos:</strong> Arrastra para crear l√≠neas de circulaci√≥n.\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Asignaci√≥n Autom√°tica */}\r\n      {tab === 'banquet' && (\r\n        <div className=\"px-4 py-3 border-b bg-gradient-to-r from-purple-50 to-blue-50\">\r\n          <button\r\n            onClick={onAutoAssign}\r\n            className=\"w-full flex items-center justify-center gap-2 px-3 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded text-sm hover:from-purple-700 hover:to-blue-700 transition-all\"\r\n          >\r\n            <Zap className=\"h-4 w-4\" />\r\n            Asignaci√≥n Autom√°tica IA\r\n          </button>\r\n        </div>\r\n      )}\r\n\r\n      {/* Panel de Invitados Disponibles */}\r\n      {tab === 'banquet' && (\r\n        <div className=\"px-4 py-3 border-b\">\r\n          <div className=\"flex items-center justify-between mb-3\">\r\n            <h4 className=\"font-medium text-gray-900\">Invitados Disponibles</h4>\r\n            <button\r\n              onClick={() => setShowAvailableGuests(!showAvailableGuests)}\r\n              className=\"text-blue-600 hover:text-blue-700\"\r\n            >\r\n              <UserPlus className=\"h-4 w-4\" />\r\n            </button>\r\n          </div>\r\n          \r\n          {showAvailableGuests && (\r\n            <>\r\n              {/* Buscador */}\r\n              <div className=\"relative mb-3\">\r\n                <Search className=\"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400\" />\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Buscar invitados...\"\r\n                  value={guestSearch}\r\n                  onChange={(e) => setGuestSearch(e.target.value)}\r\n                  className=\"w-full pl-7 pr-3 py-1 border border-gray-300 rounded text-xs focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                />\r\n              </div>\r\n              \r\n              {/* Lista de invitados disponibles */}\r\n              <div className=\"max-h-32 overflow-y-auto space-y-1\">\r\n                {availableGuests.length > 0 ? (\r\n                  availableGuests.slice(0, 10).map((guest) => (\r\n                    <div\r\n                      key={guest.id}\r\n                      className=\"flex items-center justify-between p-2 bg-green-50 border border-green-200 rounded text-xs cursor-pointer hover:bg-green-100\"\r\n                      onClick={() => selectedTable && onAssignGuest?.(selectedTable.id, guest.id)}\r\n                    >\r\n                      <div>\r\n                        <div className=\"font-medium text-green-800\">{guest.name}</div>\r\n                        {guest.side && (\r\n                          <div className=\"text-green-600 capitalize\">{guest.side}</div>\r\n                        )}\r\n                      </div>\r\n                      <MousePointer className=\"h-3 w-3 text-green-600\" />\r\n                    </div>\r\n                  ))\r\n                ) : (\r\n                  <div className=\"text-center py-2 text-gray-500 text-xs\">\r\n                    {guestSearch ? 'No se encontraron invitados' : 'Todos los invitados est√°n asignados'}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Informaci√≥n de Mesa Seleccionada */}\r\n      {selectedTable && (\r\n        <>\r\n          <div className=\"bg-gray-50 px-4 py-3 border-b\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <h3 className=\"font-medium text-gray-900\">\r\n                {selectedTable.name || `Mesa ${selectedTable.id}`}\r\n              </h3>\r\n              <button\r\n                onClick={() => onConfigureTable?.(selectedTable)}\r\n                className=\"p-1 hover:bg-gray-200 rounded\"\r\n                title=\"Configurar mesa\"\r\n              >\r\n                <Settings className=\"h-4 w-4\" />\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Contenido de Mesa Seleccionada */}\r\n          <div className=\"p-4 space-y-4\">\r\n            {/* Informaci√≥n b√°sica */}\r\n            <div className=\"space-y-3\">\r\n              <div className=\"flex items-center justify-between text-sm\">\r\n                <span className=\"text-gray-600\">Tipo:</span>\r\n                <span className=\"font-medium capitalize\">\r\n                  {tab === 'ceremony' ? 'Ceremonia' : 'Banquete'}\r\n                </span>\r\n              </div>\r\n              \r\n              {tab === 'banquet' && (\r\n                <>\r\n                  <div className=\"flex items-center justify-between text-sm\">\r\n                    <span className=\"text-gray-600\">Asientos:</span>\r\n                    <span className=\"font-medium\">{selectedTable.seats || 8}</span>\r\n                  </div>\r\n                  \r\n                  <div className=\"flex items-center justify-between text-sm\">\r\n                    <span className=\"text-gray-600\">Forma:</span>\r\n                    <button\r\n                      onClick={onToggleTableShape}\r\n                      className=\"flex items-center gap-1 text-blue-600 hover:text-blue-700\"\r\n                    >\r\n                      <span className=\"capitalize\">{selectedTable.shape || 'rectangle'}</span>\r\n                      <RotateCcw className=\"h-3 w-3\" />\r\n                    </button>\r\n                  </div>\r\n                </>\r\n              )}\r\n            </div>\r\n\r\n            {/* Dimensiones */}\r\n            {tab === 'banquet' && (\r\n              <div className=\"space-y-3\">\r\n                <h4 className=\"text-sm font-medium text-gray-900 flex items-center gap-1\">\r\n                  <Maximize2 className=\"h-4 w-4\" />\r\n                  Dimensiones\r\n                </h4>\r\n                \r\n                <div className=\"grid grid-cols-2 gap-3\">\r\n                  <div>\r\n                    <label className=\"block text-xs text-gray-600 mb-1\">\r\n                      Ancho (cm)\r\n                    </label>\r\n                    <input\r\n                      type=\"number\"\r\n                      min=\"20\"\r\n                      max=\"400\"\r\n                      value={selectedTable.width || 80}\r\n                      onChange={(e) => onTableDimensionChange?.('width', e.target.value)}\r\n                      className=\"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                    />\r\n                  </div>\r\n                  \r\n                  <div>\r\n                    <label className=\"block text-xs text-gray-600 mb-1\">\r\n                      Largo (cm)\r\n                    </label>\r\n                    <input\r\n                      type=\"number\"\r\n                      min=\"20\"\r\n                      max=\"400\"\r\n                      value={selectedTable.height || selectedTable.length || 60}\r\n                      onChange={(e) => onTableDimensionChange?.('height', e.target.value)}\r\n                      className=\"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Invitados asignados a esta mesa */}\r\n            <div className=\"space-y-3\">\r\n              <h4 className=\"text-sm font-medium text-gray-900 flex items-center gap-1\">\r\n                <Users className=\"h-4 w-4\" />\r\n                Invitados Asignados ({assignedGuests.length})\r\n              </h4>\r\n              \r\n              {assignedGuests.length > 0 ? (\r\n                <div className=\"space-y-2 max-h-40 overflow-y-auto\">\r\n                  {assignedGuests.map((guest, index) => (\r\n                    <div\r\n                      key={guest.id || index}\r\n                      className=\"flex items-center justify-between p-2 bg-blue-50 border border-blue-200 rounded text-sm\"\r\n                    >\r\n                      <div>\r\n                        <div className=\"font-medium text-blue-800\">{guest.name}</div>\r\n                        {guest.side && (\r\n                          <div className=\"text-xs text-blue-600 capitalize\">\r\n                            {guest.side}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                      \r\n                      <button\r\n                        onClick={() => onAssignGuest?.(selectedTable.id, null)}\r\n                        className=\"text-red-500 hover:text-red-700 text-xs font-bold\"\r\n                        title=\"Quitar invitado\"\r\n                      >\r\n                        √ó\r\n                      </button>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              ) : (\r\n                <div className=\"text-center py-4 text-gray-500\">\r\n                  <Users className=\"h-8 w-8 mx-auto mb-2 opacity-30\" />\r\n                  <p className=\"text-xs\">No hay invitados asignados</p>\r\n                  <p className=\"text-xs mt-1\">Usa el panel de arriba para asignar</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Acciones r√°pidas */}\r\n            <div className=\"pt-3 border-t space-y-2\">\r\n              <button\r\n                onClick={() => onConfigureTable?.(selectedTable)}\r\n                className=\"w-full px-3 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors\"\r\n              >\r\n                Configurar Mesa\r\n              </button>\r\n              \r\n              {tab === 'banquet' && (\r\n                <button\r\n                  onClick={() => setShowAvailableGuests(!showAvailableGuests)}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 text-gray-700 rounded text-sm hover:bg-gray-50 transition-colors\"\r\n                >\r\n                  {showAvailableGuests ? 'Ocultar' : 'Mostrar'} Invitados\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default React.memo(SeatingPlanSidebar);\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\seating\\SeatingPlanTabs.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Users' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":33},{"ruleId":"no-unused-vars","severity":1,"message":"'Grid' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Componente Tabs especializado para el plan de asientos\r\n * Navegaci√≥n entre ceremonia y banquete con indicadores visuales\r\n */\r\n\r\nimport React from 'react';\r\nimport { Church, Utensils, Users, Grid } from 'lucide-react';\r\n\r\nconst SeatingPlanTabs = ({\r\n  activeTab,\r\n  onTabChange,\r\n  ceremonyCount = 0,\r\n  banquetCount = 0,\r\n  className = \"\"\r\n}) => {\r\n  const tabs = [\r\n    {\r\n      id: 'ceremony',\r\n      label: 'Ceremonia',\r\n      icon: Church,\r\n      count: ceremonyCount,\r\n      description: 'Disposici√≥n de asientos para la ceremonia'\r\n    },\r\n    {\r\n      id: 'banquet',\r\n      label: 'Banquete',\r\n      icon: Utensils,\r\n      count: banquetCount,\r\n      description: 'Distribuci√≥n de mesas para el banquete'\r\n    }\r\n  ];\r\n\r\n  return (\r\n    <div className={`bg-white border rounded-lg overflow-hidden ${className}`}>\r\n      <div className=\"flex\">\r\n        {tabs.map((tab) => {\r\n          const Icon = tab.icon;\r\n          const isActive = activeTab === tab.id;\r\n          \r\n          return (\r\n            <button\r\n              key={tab.id}\r\n              onClick={() => onTabChange(tab.id)}\r\n              className={`\r\n                flex-1 flex items-center justify-center gap-2 px-4 py-3 text-sm font-medium transition-all\r\n                ${isActive \r\n                  ? 'bg-blue-50 text-blue-700 border-b-2 border-blue-500' \r\n                  : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'\r\n                }\r\n              `}\r\n              title={tab.description}\r\n            >\r\n              <Icon className=\"h-4 w-4\" />\r\n              <span>{tab.label}</span>\r\n              \r\n              {/* Contador de elementos */}\r\n              {tab.count > 0 && (\r\n                <span className={`\r\n                  px-2 py-0.5 text-xs rounded-full\r\n                  ${isActive \r\n                    ? 'bg-blue-100 text-blue-700' \r\n                    : 'bg-gray-100 text-gray-600'\r\n                  }\r\n                `}>\r\n                  {tab.count}\r\n                </span>\r\n              )}\r\n            </button>\r\n          );\r\n        })}\r\n      </div>\r\n      \r\n      {/* Indicador de progreso */}\r\n      <div className=\"h-1 bg-gray-100\">\r\n        <div \r\n          className=\"h-full bg-blue-500 transition-all duration-300\"\r\n          style={{ \r\n            width: activeTab === 'ceremony' ? '50%' : '100%',\r\n            marginLeft: activeTab === 'ceremony' ? '0%' : '0%'\r\n          }}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default React.memo(SeatingPlanTabs);\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\seating\\SeatingPlanToolbar.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Settings' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":11},{"ruleId":"no-unused-vars","severity":1,"message":"'Save' is defined but never used. Allowed unused vars must match /^_/u.","line":17,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":7}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Componente Toolbar modernizado para el plan de asientos\r\n * Interfaz mejorada con iconos claros y mejor UX\r\n */\r\n\r\nimport React from 'react';\r\nimport { \r\n  Undo2, \r\n  Redo2, \r\n  Download, \r\n  FileImage, \r\n  Settings, \r\n  Grid, \r\n  Users, \r\n  Maximize, \r\n  Palette,\r\n  Save,\r\n  Cloud,\r\n  CloudOff,\r\n  Zap\r\n} from 'lucide-react';\r\n\r\nconst SeatingPlanToolbar = ({\r\n  tab,\r\n  onUndo,\r\n  onRedo,\r\n  canUndo,\r\n  canRedo,\r\n  onExportPNG,\r\n  onExportPDF,\r\n  onOpenCeremonyConfig,\r\n  onOpenBanquetConfig,\r\n  onOpenSpaceConfig,\r\n  onOpenTemplates,\r\n  onAutoAssign,\r\n  syncStatus,\r\n  className = \"\"\r\n}) => {\r\n  const getSyncIcon = () => {\r\n    switch (syncStatus?.status) {\r\n      case 'syncing':\r\n        return <Cloud className=\"h-4 w-4 animate-pulse text-blue-500\" />;\r\n      case 'synced':\r\n        return <Cloud className=\"h-4 w-4 text-green-500\" />;\r\n      case 'error':\r\n        return <CloudOff className=\"h-4 w-4 text-red-500\" />;\r\n      default:\r\n        return <CloudOff className=\"h-4 w-4 text-gray-400\" />;\r\n    }\r\n  };\r\n\r\n  const getSyncText = () => {\r\n    switch (syncStatus?.status) {\r\n      case 'syncing':\r\n        return 'Sincronizando...';\r\n      case 'synced':\r\n        return 'Sincronizado';\r\n      case 'error':\r\n        return 'Error de sincronizaci√≥n';\r\n      default:\r\n        return 'Sin conexi√≥n';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={`bg-white border rounded-lg shadow-sm ${className}`}>\r\n      <div className=\"flex flex-wrap items-center gap-2 p-3\">\r\n        {/* Grupo: Historial */}\r\n        <div className=\"flex items-center gap-1 border-r pr-3\">\r\n          <button\r\n            onClick={onUndo}\r\n            disabled={!canUndo}\r\n            className=\"flex items-center gap-1 px-2 py-1 text-sm rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            title=\"Deshacer (Ctrl+Z)\"\r\n          >\r\n            <Undo2 className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">Deshacer</span>\r\n          </button>\r\n          \r\n          <button\r\n            onClick={onRedo}\r\n            disabled={!canRedo}\r\n            className=\"flex items-center gap-1 px-2 py-1 text-sm rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            title=\"Rehacer (Ctrl+Y)\"\r\n          >\r\n            <Redo2 className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">Rehacer</span>\r\n          </button>\r\n        </div>\r\n\r\n        {/* Grupo: Configuraci√≥n */}\r\n        <div className=\"flex items-center gap-1 border-r pr-3\">\r\n          <button\r\n            onClick={onOpenSpaceConfig}\r\n            className=\"flex items-center gap-1 px-2 py-1 text-sm rounded hover:bg-gray-100\"\r\n            title=\"Configurar espacio\"\r\n          >\r\n            <Maximize className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">Espacio</span>\r\n          </button>\r\n\r\n          {tab === 'ceremony' ? (\r\n            <button\r\n              onClick={onOpenCeremonyConfig}\r\n              className=\"flex items-center gap-1 px-2 py-1 text-sm rounded hover:bg-gray-100\"\r\n              title=\"Configurar ceremonia\"\r\n            >\r\n              <Grid className=\"h-4 w-4\" />\r\n              <span className=\"hidden sm:inline\">Ceremonia</span>\r\n            </button>\r\n          ) : (\r\n            <button\r\n              onClick={onOpenBanquetConfig}\r\n              className=\"flex items-center gap-1 px-2 py-1 text-sm rounded hover:bg-gray-100\"\r\n              title=\"Configurar banquete\"\r\n            >\r\n              <Users className=\"h-4 w-4\" />\r\n              <span className=\"hidden sm:inline\">Banquete</span>\r\n            </button>\r\n          )}\r\n\r\n          <button\r\n            onClick={onOpenTemplates}\r\n            className=\"flex items-center gap-1 px-2 py-1 text-sm rounded hover:bg-gray-100\"\r\n            title=\"Plantillas\"\r\n          >\r\n            <Palette className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">Plantillas</span>\r\n          </button>\r\n        </div>\r\n\r\n        {/* Grupo: IA y Automatizaci√≥n */}\r\n        <div className=\"flex items-center gap-1 border-r pr-3\">\r\n          <button\r\n            onClick={onAutoAssign}\r\n            className=\"flex items-center gap-1 px-2 py-1 text-sm bg-gradient-to-r from-purple-500 to-blue-500 text-white rounded hover:from-purple-600 hover:to-blue-600 transition-all\"\r\n            title=\"Asignaci√≥n autom√°tica con IA\"\r\n          >\r\n            <Zap className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">Auto IA</span>\r\n          </button>\r\n        </div>\r\n\r\n        {/* Grupo: Exportaci√≥n */}\r\n        <div className=\"flex items-center gap-1 border-r pr-3\">\r\n          <button\r\n            onClick={onExportPNG}\r\n            className=\"flex items-center gap-1 px-2 py-1 text-sm rounded hover:bg-gray-100\"\r\n            title=\"Exportar como PNG\"\r\n          >\r\n            <FileImage className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">PNG</span>\r\n          </button>\r\n          \r\n          <button\r\n            onClick={onExportPDF}\r\n            className=\"flex items-center gap-1 px-2 py-1 text-sm rounded hover:bg-gray-100\"\r\n            title=\"Exportar como PDF\"\r\n          >\r\n            <Download className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">PDF</span>\r\n          </button>\r\n        </div>\r\n\r\n        {/* Estado de sincronizaci√≥n */}\r\n        <div className=\"flex items-center gap-2 ml-auto\">\r\n          <div className=\"flex items-center gap-1 text-xs text-gray-600\">\r\n            {getSyncIcon()}\r\n            <span className=\"hidden md:inline\">{getSyncText()}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Barra de progreso de sincronizaci√≥n */}\r\n      {syncStatus?.status === 'syncing' && (\r\n        <div className=\"h-1 bg-gray-200\">\r\n          <div className=\"h-full bg-blue-500 animate-pulse\" style={{ width: '60%' }} />\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default React.memo(SeatingPlanToolbar);\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\seating\\SeatingToolbar.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\settings\\WeddingAccountLink.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'handleAcceptInvite' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":70,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":70,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Check, AlertTriangle, Send as SendIcon, Users } from 'lucide-react';\r\nimport Button from '../Button';\r\nimport { useAuth } from '../../hooks/useAuthUnified';\r\nimport {\r\n  createWedding,\r\n  invitePartner,\r\n  invitePlanner,\r\n  acceptInvitation,\r\n} from '../../services/WeddingService';\r\n\r\n/**\r\n * Componente para vincular cuentas de boda y gestionar invitaciones.\r\n */\r\nconst WeddingAccountLink = () => {\r\n  const { currentUser, userProfile, reloadUserProfile } = useAuth();\r\n  const [weddingId, setWeddingId] = useState('');\r\n\r\n  const [emailInvite, setEmailInvite] = useState('');\r\n  const [role, setRole] = useState('partner');\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [inviteCode, setInviteCode] = useState('');\r\n  const [success, setSuccess] = useState('');\r\n\r\n  useEffect(() => {\r\n    if (userProfile) {\r\n      setWeddingId(userProfile.weddingId || '');\r\n    }\r\n  }, [userProfile]);\r\n\r\n  const handleCreateWedding = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const wid = await createWedding(currentUser.uid);\r\n      setWeddingId(wid);\r\n      setSuccess('Boda creada correctamente.');\r\n      await reloadUserProfile();\r\n    } catch (err) {\r\n      setError(err.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSendInvite = async () => {\r\n    if (!emailInvite) {\r\n      setError('Introduce un correo.');\r\n      return;\r\n    }\r\n    try {\r\n      setLoading(true);\r\n      setError('');\r\n      let code;\r\n      if (role === 'partner') {\r\n        code = await invitePartner(weddingId, emailInvite);\r\n      } else {\r\n        code = await invitePlanner(weddingId, emailInvite);\r\n      }\r\n      setSuccess(`Invitaci√≥n enviada. C√≥digo: ${code}`);\r\n      setEmailInvite('');\r\n    } catch (err) {\r\n      console.error(err);\r\n      setError(err.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleAcceptInvite = async () => {\r\n    if (!inviteCode) {\r\n      setError('Introduce el c√≥digo de invitaci√≥n.');\r\n      return;\r\n    }\r\n    try {\r\n      setLoading(true);\r\n      setError('');\r\n      await acceptInvitation(inviteCode);\r\n      setSuccess('Invitaci√≥n aceptada correctamente.');\r\n      setInviteCode('');\r\n    } catch (err) {\r\n      setError(err.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <h3 className=\"text-md font-medium mb-2 flex items-center\">\r\n        <Users className=\"w-4 h-4 mr-2\" /> Vincular cuentas de boda\r\n      </h3>\r\n\r\n      {!weddingId ? (\r\n        <div>\r\n          <p className=\"text-gray-600 mb-3\">Crea tu boda para poder invitar a tu pareja o wedding planner.</p>\r\n          <Button onClick={handleCreateWedding} disabled={loading}>\r\n            {loading ? 'Creando...' : 'Crear mi boda'}\r\n          </Button>\r\n        </div>\r\n      ) : (\r\n        <div className=\"space-y-4\">\r\n          <div className=\"bg-gray-50 p-3 rounded-md border text-sm\">\r\n            <span className=\"font-medium\">ID de tu boda:</span> {weddingId}\r\n          </div>\r\n\r\n          <div>\r\n            <label htmlFor=\"invite-email\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n              Correo de la persona a invitar\r\n            </label>\r\n            <input\r\n              type=\"email\"\r\n              id=\"invite-email\"\r\n              value={emailInvite}\r\n              onChange={(e) => setEmailInvite(e.target.value)}\r\n              className=\"w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500\"\r\n              placeholder=\"correo@ejemplo.com\"\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Rol</label>\r\n            <select\r\n              value={role}\r\n              onChange={(e) => setRole(e.target.value)}\r\n              className=\"w-full p-2 border rounded-md\">\r\n              <option value=\"partner\">Pareja (copropietario)</option>\r\n              <option value=\"planner\">Wedding Planner</option>\r\n            </select>\r\n          </div>\r\n\r\n          {error && (\r\n            <div className=\"p-3 bg-red-50 border border-red-200 text-red-700 rounded-md flex items-start text-sm\">\r\n              <AlertTriangle size={16} className=\"mr-2 mt-0.5\" />\r\n              {error}\r\n            </div>\r\n          )}\r\n          {success && (\r\n            <div className=\"p-3 bg-green-50 border border-green-200 text-green-700 rounded-md flex items-start text-sm\">\r\n              <Check size={16} className=\"mr-2 mt-0.5\" />\r\n              {success}\r\n            </div>\r\n          )}\r\n\r\n          <Button\r\n            onClick={handleSendInvite}\r\n            disabled={loading || !emailInvite}\r\n            variant=\"default\"\r\n          >\r\n            {loading ? 'Enviando...' : (\r\n              <span className=\"flex items-center\"><SendIcon size={16} className=\"mr-1\" /> Enviar invitaci√≥n</span>\r\n            )}\r\n          </Button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default WeddingAccountLink;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\tasks\\CalendarComponents.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Calendar' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Calendar, dateFnsLocalizer } from 'react-big-calendar';\r\nimport format from 'date-fns/format';\r\nimport parse from 'date-fns/parse';\r\nimport startOfWeek from 'date-fns/startOfWeek';\r\nimport getDay from 'date-fns/getDay';\r\n\r\n// Estilos por defecto y personalizados del calendario\r\nimport 'react-big-calendar/lib/css/react-big-calendar.css';\r\nimport '../../styles/calendarOverrides.css';\r\n\r\n// Importar locale de espa√±ol\r\nimport es from 'date-fns/locale/es';\r\n\r\n// Configuraci√≥n del localizador para el calendario\r\nconst locales = {\r\n  'es': es\r\n};\r\n\r\nexport const localizer = dateFnsLocalizer({\r\n  format,\r\n  parse,\r\n  startOfWeek: () => startOfWeek(new Date(), { weekStartsOn: 1 }), // Semana comienza el lunes\r\n  getDay,\r\n  locales,\r\n});\r\n\r\n// Categor√≠as de tareas con sus colores\r\nexport const categories = {\r\n  LUGAR: { name: 'Lugar', color: '#ef4444', bgColor: '#fee2e2', borderColor: '#fca5a5' },\r\n  INVITADOS: { name: 'Invitados', color: '#f97316', bgColor: '#ffedd5', borderColor: '#fdba74' },\r\n  COMIDA: { name: 'Catering', color: '#eab308', bgColor: '#fef9c3', borderColor: '#fde047' },\r\n  DECORACION: { name: 'Decoraci√≥n', color: '#22c55e', bgColor: '#dcfce7', borderColor: '#86efac' },\r\n  PAPELERIA: { name: 'Papeler√≠a', color: '#06b6d4', bgColor: '#cffafe', borderColor: '#67e8f9' },\r\n  MUSICA: { name: 'M√∫sica', color: '#6366f1', bgColor: '#e0e7ff', borderColor: '#a5b4fc' },\r\n  FOTOGRAFO: { name: 'Fotograf√≠a', color: '#8b5cf6', bgColor: '#ede9fe', borderColor: '#c4b5fd' },\r\n  VESTUARIO: { name: 'Vestuario', color: '#d946ef', bgColor: '#fae8ff', borderColor: '#e879f9' },\r\n  OTROS: { name: 'Otros', color: '#6b7280', bgColor: '#f3f4f6', borderColor: '#d1d5db' },\r\n};\r\n\r\n// Estilos para eventos del calendario (estilo Google Calendar)\r\nexport function eventStyleGetter(event) {\r\n  const cat = categories[event.category || 'OTROS'];\r\n  return {\r\n    style: {\r\n      backgroundColor: cat.color,\r\n      color: '#ffffff',\r\n      border: 'none',\r\n      borderRadius: '0',\r\n      padding: '0px 5px',\r\n      fontSize: '14px',\r\n      opacity: 0.8\r\n    }\r\n  };\r\n}\r\n\r\n// Componente para renderizar cada evento en el calendario (estilo Google Calendar)\r\nexport const Event = ({ event }) => {\r\n  return (\r\n    <div className=\"rbc-event-content\">\r\n      <div style={{\r\n        overflow: 'hidden',\r\n        textOverflow: 'ellipsis',\r\n        whiteSpace: 'nowrap',\r\n        color: '#fff',\r\n        fontSize: '0.85em',\r\n        fontWeight: '500',\r\n        padding: '2px 5px',\r\n        width: '100%',\r\n        lineHeight: '1.4',\r\n        letterSpacing: '0.2px',\r\n        textShadow: '0 1px 1px rgba(0,0,0,0.2)' // Mejora legibilidad del texto blanco\r\n      }}>\r\n        {event.title || event.name || \"Sin t√≠tulo\"}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\tasks\\CalendarSync.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'importEventsFromGoogle' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":20,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":27},{"ruleId":"no-unused-vars","severity":1,"message":"'exportEventsToGoogle' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":21,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useCalendarSync } from '../../hooks/useCalendarSync';\r\nimport { Button, Spinner, Alert, Badge } from '../../components/ui';\r\nimport { Calendar, RefreshCw, Link2, Check, AlertTriangle, Clock } from 'lucide-react';\r\n\r\n/**\r\n * Componente para sincronizaci√≥n bidireccional de calendarios\r\n */\r\nconst CalendarSync = ({ onEventsImported }) => {\r\n  const { \r\n    isLoading, \r\n    isAuthenticated, \r\n    syncedCalendars, \r\n    lastSync,\r\n    error, \r\n    authenticate, \r\n    logout, \r\n    getAvailableCalendars,\r\n    saveCalendarSyncConfig,\r\n    importEventsFromGoogle,\r\n    exportEventsToGoogle,\r\n    syncBidirectional \r\n  } = useCalendarSync();\r\n  \r\n  const [availableCalendars, setAvailableCalendars] = useState([]);\r\n  const [selectedCalendars, setSelectedCalendars] = useState([]);\r\n  const [syncStatus, setSyncStatus] = useState({ imported: 0, exported: 0 });\r\n  const [showConfig, setShowConfig] = useState(false);\r\n  \r\n  // Cargar calendarios cuando el usuario se autentique\r\n  useEffect(() => {\r\n    const loadCalendars = async () => {\r\n      if (isAuthenticated) {\r\n        const calendars = await getAvailableCalendars();\r\n        setAvailableCalendars(calendars);\r\n        setSelectedCalendars(syncedCalendars.map(cal => cal.id));\r\n      }\r\n    };\r\n    \r\n    loadCalendars();\r\n  }, [isAuthenticated, syncedCalendars]);\r\n  \r\n  // Manejar cambio de selecci√≥n de calendario\r\n  const handleCalendarToggle = (calendar) => {\r\n    setSelectedCalendars(prev => {\r\n      if (prev.includes(calendar.id)) {\r\n        return prev.filter(id => id !== calendar.id);\r\n      } else {\r\n        return [...prev, calendar.id];\r\n      }\r\n    });\r\n  };\r\n  \r\n  // Guardar configuraci√≥n de calendarios seleccionados\r\n  const handleSaveConfig = async () => {\r\n    const selected = availableCalendars.filter(cal => selectedCalendars.includes(cal.id));\r\n    await saveCalendarSyncConfig(selected);\r\n    setShowConfig(false);\r\n  };\r\n  \r\n  // Sincronizar eventos bidireccionales\r\n  const handleSync = async () => {\r\n    if (syncedCalendars.length === 0) {\r\n      setShowConfig(true);\r\n      return;\r\n    }\r\n    \r\n    setSyncStatus({ imported: 0, exported: 0 });\r\n    \r\n    for (const calendar of syncedCalendars) {\r\n      const result = await syncBidirectional(calendar.id);\r\n      setSyncStatus(prev => ({\r\n        imported: prev.imported + result.imported.length,\r\n        exported: prev.exported + result.exported.length\r\n      }));\r\n      \r\n      if (result.imported.length > 0 && onEventsImported) {\r\n        onEventsImported(result.imported);\r\n      }\r\n    }\r\n  };\r\n  \r\n  // Formatear fecha para mostrar\r\n  const formatDate = (date) => {\r\n    if (!date) return '';\r\n    return new Intl.DateTimeFormat('es-ES', {\r\n      day: '2-digit',\r\n      month: '2-digit',\r\n      year: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    }).format(date);\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-lg shadow-md p-4 my-4\">\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h3 className=\"text-lg font-semibold flex items-center\">\r\n          <Calendar size={20} className=\"mr-2 text-blue-500\" />\r\n          Sincronizaci√≥n de Calendario\r\n        </h3>\r\n        \r\n        {lastSync && (\r\n          <div className=\"flex items-center text-sm text-gray-500\">\r\n            <Clock size={14} className=\"mr-1\" />\r\n            √öltima sincronizaci√≥n: {formatDate(lastSync)}\r\n          </div>\r\n        )}\r\n      </div>\r\n      \r\n      {error && (\r\n        <Alert type=\"error\" className=\"mb-4\">\r\n          <AlertTriangle size={16} className=\"mr-2\" />\r\n          {error}\r\n        </Alert>\r\n      )}\r\n      \r\n      {/* Estado de conexi√≥n */}\r\n      <div className=\"flex items-center mb-4\">\r\n        <div className=\"mr-4\">\r\n          {isAuthenticated ? (\r\n            <Badge type=\"success\" className=\"flex items-center\">\r\n              <Check size={14} className=\"mr-1\" /> Conectado\r\n            </Badge>\r\n          ) : (\r\n            <Badge type=\"warning\" className=\"flex items-center\">\r\n              <Link2 size={14} className=\"mr-1\" /> No conectado\r\n            </Badge>\r\n          )}\r\n        </div>\r\n        \r\n        <div className=\"ml-auto\">\r\n          {isAuthenticated ? (\r\n            <Button \r\n              size=\"sm\" \r\n              variant=\"outline\" \r\n              onClick={logout} \r\n              disabled={isLoading}\r\n            >\r\n              Desconectar\r\n            </Button>\r\n          ) : (\r\n            <Button \r\n              size=\"sm\" \r\n              variant=\"primary\" \r\n              onClick={authenticate} \r\n              disabled={isLoading}\r\n            >\r\n              Conectar con Google Calendar\r\n              {isLoading && <Spinner size=\"sm\" className=\"ml-2\" />}\r\n            </Button>\r\n          )}\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Panel de calendarios */}\r\n      {isAuthenticated && (\r\n        <div className=\"mb-4\">\r\n          <div className=\"flex items-center justify-between mb-2\">\r\n            <h4 className=\"text-md font-medium\">\r\n              Calendarios ({syncedCalendars.length})\r\n            </h4>\r\n            \r\n            <Button \r\n              size=\"xs\" \r\n              variant=\"secondary\" \r\n              onClick={() => setShowConfig(!showConfig)}\r\n            >\r\n              {showConfig ? 'Ocultar' : 'Configurar'}\r\n            </Button>\r\n          </div>\r\n          \r\n          {/* Lista de calendarios configurados */}\r\n          {!showConfig && syncedCalendars.length > 0 && (\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2\">\r\n              {syncedCalendars.map(calendar => (\r\n                <div \r\n                  key={calendar.id} \r\n                  className=\"flex items-center p-2 rounded border text-sm\"\r\n                  style={{ \r\n                    borderColor: calendar.backgroundColor || '#ccc',\r\n                    backgroundColor: `${calendar.backgroundColor}10` || '#f9f9f9'\r\n                  }}\r\n                >\r\n                  <div \r\n                    className=\"w-3 h-3 rounded-full mr-2\" \r\n                    style={{ backgroundColor: calendar.backgroundColor || '#ccc' }}\r\n                  />\r\n                  <span className=\"truncate\">{calendar.summary}</span>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n          \r\n          {/* Panel de configuraci√≥n de calendarios */}\r\n          {showConfig && (\r\n            <div className=\"border rounded p-3 bg-gray-50\">\r\n              <p className=\"text-sm text-gray-600 mb-2\">\r\n                Selecciona los calendarios que deseas sincronizar:\r\n              </p>\r\n              \r\n              {isLoading ? (\r\n                <div className=\"flex justify-center p-4\">\r\n                  <Spinner />\r\n                </div>\r\n              ) : (\r\n                <>\r\n                  <div className=\"max-h-48 overflow-y-auto mb-3\">\r\n                    {availableCalendars.length > 0 ? (\r\n                      availableCalendars.map(calendar => (\r\n                        <div key={calendar.id} className=\"flex items-center mb-2\">\r\n                          <input\r\n                            type=\"checkbox\"\r\n                            id={calendar.id}\r\n                            checked={selectedCalendars.includes(calendar.id)}\r\n                            onChange={() => handleCalendarToggle(calendar)}\r\n                            className=\"mr-2\"\r\n                          />\r\n                          <label \r\n                            htmlFor={calendar.id} \r\n                            className=\"flex items-center cursor-pointer\"\r\n                          >\r\n                            <div \r\n                              className=\"w-3 h-3 rounded-full mr-2\" \r\n                              style={{ backgroundColor: calendar.backgroundColor || '#ccc' }}\r\n                            />\r\n                            <span>{calendar.summary}</span>\r\n                            {calendar.primary && (\r\n                              <Badge type=\"info\" className=\"ml-2 text-xs\">Principal</Badge>\r\n                            )}\r\n                          </label>\r\n                        </div>\r\n                      ))\r\n                    ) : (\r\n                      <p className=\"text-gray-500 text-sm italic\">\r\n                        No se encontraron calendarios\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                  \r\n                  <div className=\"flex justify-end\">\r\n                    <Button \r\n                      size=\"sm\" \r\n                      variant=\"outline\" \r\n                      onClick={() => setShowConfig(false)}\r\n                      className=\"mr-2\"\r\n                    >\r\n                      Cancelar\r\n                    </Button>\r\n                    <Button \r\n                      size=\"sm\" \r\n                      variant=\"primary\" \r\n                      onClick={handleSaveConfig}\r\n                      disabled={selectedCalendars.length === 0}\r\n                    >\r\n                      Guardar configuraci√≥n\r\n                    </Button>\r\n                  </div>\r\n                </>\r\n              )}\r\n            </div>\r\n          )}\r\n          \r\n          {/* Bot√≥n de sincronizaci√≥n y estado */}\r\n          <div className=\"mt-4 flex justify-between items-center\">\r\n            <div>\r\n              {(syncStatus.imported > 0 || syncStatus.exported > 0) && (\r\n                <div className=\"text-sm\">\r\n                  <Badge type=\"success\" className=\"mr-2\">\r\n                    {syncStatus.imported} eventos importados\r\n                  </Badge>\r\n                  <Badge type=\"info\">\r\n                    {syncStatus.exported} eventos exportados\r\n                  </Badge>\r\n                </div>\r\n              )}\r\n            </div>\r\n            \r\n            <Button\r\n              variant=\"primary\"\r\n              onClick={handleSync}\r\n              disabled={isLoading || syncedCalendars.length === 0}\r\n              className=\"flex items-center\"\r\n            >\r\n              <RefreshCw size={16} className={`mr-1 ${isLoading ? 'animate-spin' : ''}`} />\r\n              Sincronizar ahora\r\n              {isLoading && <Spinner size=\"sm\" className=\"ml-2\" />}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CalendarSync;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\tasks\\CalendarUtils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\tasks\\ErrorBoundary.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\tasks\\GanttTasks.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\tasks\\TaskForm.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\tasks\\TaskList.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\tasks\\TasksRefactored.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Download' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":46},{"ruleId":"no-unused-vars","severity":1,"message":"'tasksLoading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":44,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":44,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'meetingsLoading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":52,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":52,"endColumn":29},{"ruleId":"no-unused-vars","severity":1,"message":"'completedDocs' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":56,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":56,"endColumn":24},{"ruleId":"no-unused-vars","severity":1,"message":"'addCompletedFS' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":57,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":57,"endColumn":28},{"ruleId":"no-unused-vars","severity":1,"message":"'updateCompletedFS' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":58,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":58,"endColumn":34},{"ruleId":"no-unused-vars","severity":1,"message":"'deleteCompletedFS' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":59,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":59,"endColumn":34},{"ruleId":"no-unused-vars","severity":1,"message":"'completedLoading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":60,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":60,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback, useRef } from 'react';\r\nimport { ViewMode } from 'gantt-task-react';\r\nimport { subscribeSyncState, getSyncState, loadData } from '../../services/SyncService';\r\nimport { Cloud, CloudOff, RefreshCw, Download } from 'lucide-react';\r\n\r\n// Importar componentes separados\r\nimport ErrorBoundary from './ErrorBoundary';\r\nimport { downloadAllICS } from './CalendarUtils';\r\nimport { localizer, categories, eventStyleGetter, Event } from './CalendarComponents';\r\nimport { GanttChart } from './GanttTasks';\r\nimport TaskForm from './TaskForm';\r\nimport TaskList from './TaskList';\r\nimport { Calendar } from 'react-big-calendar';\r\n\r\n// Importar hooks de Firestore\r\nimport { useFirestoreCollection } from '../../hooks/useFirestoreCollection';\r\nimport { useWedding } from '../../context/WeddingContext';\r\n\r\n// Funci√≥n helper para cargar datos de Firestore de forma segura\r\nconst loadFirestoreData = async (path) => {\r\n  try {\r\n    // Esta funci√≥n no usa hooks, solo carga datos\r\n    const data = await loadData(path);\r\n    return data || {};\r\n  } catch (error) {\r\n    console.error('Error cargando datos de Firestore:', error);\r\n    return {};\r\n  }\r\n};\r\n\r\n// Componente principal Tasks refactorizado\r\nexport default function Tasks() {\r\n  // Estados - Inicializaci√≥n segura con manejo de errores\r\n\r\n  // Contexto de boda activa\r\n  const { activeWedding } = useWedding();\r\n\r\n  // Hooks Firestore para tasks y meetings dentro de la boda\r\n  const {\r\n    data: tasksState,\r\n    addItem: addTaskFS,\r\n    updateItem: updateTaskFS,\r\n    deleteItem: deleteTaskFS,\r\n    loading: tasksLoading,\r\n  } = useFirestoreCollection(`weddings/${activeWedding}/tasks`, []);\r\n\r\n  const {\r\n    data: meetingsState,\r\n    addItem: addMeetingFS,\r\n    updateItem: updateMeetingFS,\r\n    deleteItem: deleteMeetingFS,\r\n    loading: meetingsLoading,\r\n  } = useFirestoreCollection(`weddings/${activeWedding}/meetings`, []);\r\n\r\n  const {\r\n    data: completedDocs,\r\n    addItem: addCompletedFS,\r\n    updateItem: updateCompletedFS,\r\n    deleteItem: deleteCompletedFS,\r\n    loading: completedLoading,\r\n  } = useFirestoreCollection(`weddings/${activeWedding}/tasksCompleted`, []);\r\n\r\n  // --- Ya no se requiere estado local ni carga inicial mediante loadData; los hooks de Firestore se encargan ---\r\n  const dataLoadedRef = useRef(false);\r\n\r\n  const [showNewTask, setShowNewTask] = useState(false);\r\n  const [editingId, setEditingId] = useState(null);\r\n  const [formData, setFormData] = useState({\r\n    title: '',\r\n    desc: '',\r\n    category: 'OTROS',\r\n    startDate: new Date().toISOString().slice(0, 10),\r\n    startTime: '10:00',\r\n    endDate: new Date().toISOString().slice(0, 10),\r\n    endTime: '11:00',\r\n    long: false,\r\n  });\r\n  \r\n  const [currentView, setCurrentView] = useState('month');\r\n  const [calendarDate, setCalendarDate] = useState(new Date());\r\n  \r\n  const [syncStatus, setSyncStatus] = useState(() => {\r\n    try {\r\n      return getSyncState();\r\n    } catch (error) {\r\n      console.error('Error al obtener estado de sincronizaci√≥n:', error);\r\n      return { isOnline: navigator.onLine, isSyncing: false };\r\n    }\r\n  });\r\n  \r\n  const [columnWidthState] = useState(65);\r\n  const listCellWidth = '155px';\r\n\r\n  // Manejar eventos de calendario externos\r\n  useEffect(() => {\r\n    const handler = (evt) => {\r\n      const meeting = evt?.detail?.meeting;\r\n      if (meeting && meeting.start && meeting.end && meeting.title) {\r\n        addMeeting(meeting);\r\n      }\r\n    };\r\n    window.addEventListener('lovenda-tasks', handler);\r\n    return () => window.removeEventListener('lovenda-tasks', handler);\r\n  }, [meetingsState]);\r\n\r\n  // Funci√≥n para a√±adir una reuni√≥n\r\n  const addMeeting = useCallback(async (meeting) => {\r\n    await addMeetingFS({\r\n      ...meeting,\r\n      title: meeting.title || 'Nueva reuni√≥n',\r\n      start: new Date(meeting.start),\r\n      end: new Date(meeting.end)\r\n    });\r\n  }, [addMeetingFS]);\r\n\r\n  // Estado para tareas completadas (inicial vac√≠o, se cargar√° as√≠ncronamente)\r\n  const [completed, setCompleted] = useState({});\r\n\r\n  // Cargar tareas completadas de Firestore/Storage sin bloquear render\r\n  useEffect(() => {\r\n    if (!activeWedding) return;\r\n    \r\n    let isMounted = true;\r\n    (async () => {\r\n      try {\r\n        const data = await loadFirestoreData(`weddings/${activeWedding}/tasksCompleted`);\r\n        if (isMounted && data && typeof data === 'object' && !Array.isArray(data)) {\r\n          setCompleted(data);\r\n        }\r\n      } catch (error) {\r\n        console.error('Error cargando tasksCompleted:', error);\r\n      }\r\n    })();\r\n    return () => { isMounted = false; };\r\n  }, [activeWedding]);\r\n\r\n  // Suscribirse al estado de sincronizaci√≥n\r\n  useEffect(() => {\r\n    return subscribeSyncState(setSyncStatus);\r\n  }, []);\r\n\r\n  // Guardar cambios cuando cambie el estado (evitando sobrescribir con datos vac√≠os al inicio)\r\n  useEffect(() => {\r\n    if (dataLoadedRef.current) {\r\n      // No es necesario guardar cambios ya que se utiliza Firestore\r\n    }\r\n  }, [tasksState, activeWedding]);\r\n\r\n  useEffect(() => {\r\n    if (dataLoadedRef.current) {\r\n      // No es necesario guardar cambios ya que se utiliza Firestore\r\n    }\r\n  }, [meetingsState, activeWedding]);\r\n\r\n  useEffect(() => {\r\n    if (dataLoadedRef.current) {\r\n      // No es necesario guardar cambios ya que se utiliza Firestore\r\n    }\r\n  }, [completed, activeWedding]);\r\n\r\n  // Sugerencia autom√°tica de categor√≠a\r\n  const sugerirCategoria = (titulo, descripcion) => {\r\n    const texto = (titulo + ' ' + (descripcion || '')).toLowerCase();\r\n    if (texto.includes('lugar') || texto.includes('venue') || texto.includes('salon') || texto.includes('espacio')) {\r\n      return 'LUGAR';\r\n    } else if (texto.includes('invita') || texto.includes('guest') || texto.includes('persona')) {\r\n      return 'INVITADOS';\r\n    } else if (texto.includes('comida') || texto.includes('catering') || texto.includes('menu') || texto.includes('bebida')) {\r\n      return 'COMIDA';\r\n    } else if (texto.includes('decora') || texto.includes('adorno') || texto.includes('flor')) {\r\n      return 'DECORACION';\r\n    } else if (texto.includes('invitacion') || texto.includes('papel') || texto.includes('tarjeta')) {\r\n      return 'PAPELERIA';\r\n    } else if (texto.includes('m√∫sica') || texto.includes('music') || texto.includes('dj') || texto.includes('band')) {\r\n      return 'MUSICA';\r\n    } else if (texto.includes('foto') || texto.includes('video') || texto.includes('grafia')) {\r\n      return 'FOTOGRAFO';\r\n    } else if (texto.includes('vestido') || texto.includes('traje') || texto.includes('ropa')) {\r\n      return 'VESTUARIO';\r\n    }\r\n    return 'OTROS';\r\n  };\r\n\r\n  // Manejador de cambios en el formulario\r\n  // Maneja los cambios del formulario y aplica reglas adicionales de negocio\r\n  const handleChange = (e) => {\r\n    const field = e.target.name;\r\n    const rawValue = e.target.type === 'checkbox' ? e.target.checked : e.target.value;\r\n\r\n    setFormData((prevForm) => {\r\n      let updated = { ...prevForm, [field]: rawValue };\r\n\r\n      // 1. Sugerir categor√≠a si se cambia el t√≠tulo y la categor√≠a es OTROS\r\n      if (field === 'title' && (!prevForm.category || prevForm.category === 'OTROS')) {\r\n        const sugerida = sugerirCategoria(rawValue, prevForm.desc);\r\n        if (sugerida !== 'OTROS') {\r\n          updated.category = sugerida;\r\n        }\r\n      }\r\n\r\n      // 2. Si cambia la fecha de inicio, asegurarnos de que la fecha de fin no sea anterior\r\n      if (field === 'startDate') {\r\n        const start = new Date(rawValue);\r\n        const end = new Date(prevForm.endDate);\r\n        if (!prevForm.endDate || end < start) {\r\n          updated.endDate = rawValue; // Ajustar fin al mismo d√≠a por defecto\r\n        }\r\n      }\r\n\r\n      // 3. Si cambia la fecha de fin y resulta ser anterior a la de inicio, corrige inicio\r\n      if (field === 'endDate') {\r\n        const start = new Date(prevForm.startDate);\r\n        const end = new Date(rawValue);\r\n        if (end < start) {\r\n          updated.startDate = rawValue;\r\n        }\r\n      }\r\n\r\n      return updated;\r\n    });\r\n  };\r\n\r\n  // Resetear formulario\r\n  const resetForm = () => {\r\n    setFormData({\r\n      title: '', desc: '', category: 'OTROS', \r\n      startDate: new Date().toISOString().slice(0, 10), \r\n      startTime: '10:00', endDate: new Date().toISOString().slice(0, 10), \r\n      endTime: '11:00', long: false\r\n    });\r\n  };\r\n\r\n  // Cerrar modal\r\n  const closeModal = () => {\r\n    setShowNewTask(false);\r\n    setEditingId(null);\r\n    resetForm();\r\n  };\r\n  \r\n  // Asignaci√≥n autom√°tica de categor√≠a con IA\r\n  const asignarCategoriaConIA = async (titulo, descripcion) => {\r\n    try {\r\n      const texto = (titulo + ' ' + (descripcion || '')).toLowerCase();\r\n      // Primero intentamos con reglas simples\r\n      const sugerida = sugerirCategoria(titulo, descripcion);\r\n      if (sugerida !== 'OTROS') return sugerida;\r\n      \r\n      // Si las reglas simples no funcionan, usamos IA\r\n      const palabrasClave = {\r\n        LUGAR: ['venue', 'location', 'lugar', 'sitio', 'espacio', 'sal√≥n', 'jard√≠n', 'terraza'],\r\n        INVITADOS: ['guests', 'invitados', 'personas', 'asistentes', 'confirmaciones', 'lista', 'rsvp'],\r\n        COMIDA: ['catering', 'food', 'comida', 'bebida', 'menu', 'bocadillos', 'pastel', 'torta'],\r\n        DECORACION: ['decoraci√≥n', 'flores', 'arreglos', 'centros de mesa', 'iluminaci√≥n', 'ambientaci√≥n'],\r\n        PAPELERIA: ['invitaciones', 'papeler√≠a', 'save the date', 'tarjetas', 'programa', 'seating plan'],\r\n        MUSICA: ['m√∫sica', 'dj', 'banda', 'playlist', 'sonido', 'baile', 'entretenimiento'],\r\n        FOTOGRAFO: ['fotograf√≠a', 'video', 'recuerdos', '√°lbum', 'sesi√≥n'],\r\n        VESTUARIO: ['vestido', 'traje', 'accesorios', 'zapatos', 'maquillaje', 'peluquer√≠a'],\r\n      };\r\n      \r\n      // Contar coincidencias por categor√≠a\r\n      const scores = {};\r\n      Object.entries(palabrasClave).forEach(([cat, palabras]) => {\r\n        scores[cat] = palabras.filter(palabra => texto.includes(palabra)).length;\r\n      });\r\n      \r\n      // Encontrar la categor√≠a con mayor puntuaci√≥n\r\n      let maxScore = 0;\r\n      let maxCat = 'OTROS';\r\n      Object.entries(scores).forEach(([cat, score]) => {\r\n        if (score > maxScore) {\r\n          maxScore = score;\r\n          maxCat = cat;\r\n        }\r\n      });\r\n      \r\n      return maxScore > 0 ? maxCat : 'OTROS';\r\n    } catch (error) {\r\n      console.error('Error al asignar categor√≠a:', error);\r\n      return 'OTROS';\r\n    }\r\n  };\r\n\r\n  // Guardar una tarea en la subcolecci√≥n de la boda\r\n  const handleSaveTask = async () => {\r\n    try {\r\n      // Validar formulario b√°sico\r\n      if (!formData.title.trim()) {\r\n        alert('Por favor ingresa un t√≠tulo');\r\n        return;\r\n      }\r\n      \r\n      if (!formData.startDate) {\r\n        alert('Por favor selecciona una fecha de inicio');\r\n        return;\r\n      }\r\n      \r\n      if (!formData.endDate) {\r\n        alert('Por favor selecciona una fecha de fin');\r\n        return;\r\n      }\r\n      \r\n      // Construir fechas completas\r\n      const startDateStr = formData.startDate;\r\n      const startTimeStr = formData.startTime || '00:00';\r\n      const endDateStr = formData.endDate;\r\n      const endTimeStr = formData.endTime || '23:59';\r\n      \r\n      const startDate = new Date(`${startDateStr}T${startTimeStr}`);\r\n      const endDate = new Date(`${endDateStr}T${endTimeStr}`);\r\n      \r\n      // Validar fechas\r\n      if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {\r\n        alert('Fechas no v√°lidas');\r\n        return;\r\n      }\r\n      \r\n      if (endDate < startDate) {\r\n        alert('La fecha de fin debe ser posterior a la de inicio');\r\n        return;\r\n      }\r\n      \r\n      // Asignar categor√≠a con IA si no se especific√≥\r\n      let category = formData.category;\r\n      if (category === 'OTROS') {\r\n        category = await asignarCategoriaConIA(formData.title, formData.desc);\r\n      }\r\n      \r\n      // Crear objeto de tarea/evento\r\n      const taskData = {\r\n        id: editingId || `task-${Date.now()}`,\r\n        title: formData.title,\r\n        desc: formData.desc,\r\n        start: startDate,\r\n        end: endDate,\r\n        category: category\r\n      };\r\n      \r\n      // A√±adir/actualizar seg√∫n sea una tarea de largo plazo o una reuni√≥n\r\n      if (formData.long) {\r\n        // Para el diagrama Gantt\r\n        const ganttTask = {\r\n          ...taskData,\r\n          name: taskData.title,\r\n          progress: 0,\r\n          type: 'task',\r\n          isDisabled: false,\r\n          dependencies: []\r\n        };\r\n        \r\n        if (editingId) {\r\n          await updateTaskFS(editingId, ganttTask);\r\n        } else {\r\n          await addTaskFS(ganttTask);\r\n        }\r\n      } else {\r\n        // Para el calendario\r\n        if (editingId) {\r\n          // Buscar primero en tareas Gantt\r\n          if (tasksState.some(t => t.id === editingId)) {\r\n            await updateTaskFS(editingId, taskData);\r\n          } else {\r\n            await updateMeetingFS(editingId, taskData);\r\n          }\r\n        } else {\r\n          if (taskData.long) {\r\n            await addMeetingFS(taskData);\r\n          } else {\r\n            await addTaskFS(taskData);\r\n          }\r\n        }\r\n      }\r\n      \r\n      // Cerrar modal y limpiar\r\n      closeModal();\r\n    } catch (error) {\r\n      console.error('Error al guardar tarea:', error);\r\n      alert('Hubo un error al guardar la tarea');\r\n    }\r\n  };\r\n\r\n  // Eliminar una tarea\r\n  const handleDeleteTask = () => {\r\n    if (confirm('¬øEst√°s seguro de querer eliminar esta tarea?')) {\r\n      // Buscar en ambas colecciones - con verificaci√≥n de tipo\r\n      if (tasksState.some(t => t.id === editingId)) {\r\n        deleteTaskFS(editingId);\r\n      } else {\r\n        deleteMeetingFS(editingId);\r\n      }\r\n      closeModal();\r\n    }\r\n  };\r\n\r\n  // Marcar tarea como completada\r\n  const toggleCompleted = id => {\r\n    setCompleted(prev => ({ ...prev, [id]: !prev[id] }));\r\n  };\r\n\r\n  // Procesar eventos para despliegue seguro - asegurando que tasksState sea un array\r\n  const allEvents = [\r\n    ...(Array.isArray(tasksState) ? tasksState.map(t => ({ ...t, title: t.name || t.title })) : []),\r\n    ...(Array.isArray(meetingsState) ? meetingsState : [])\r\n  ];\r\n\r\n  // Funci√≥n auxiliar para validar y normalizar fechas\r\n  const validateAndNormalizeDate = (date) => {\r\n    if (!date) return null;\r\n    \r\n    let validDate = date;\r\n    if (!(date instanceof Date)) {\r\n      try {\r\n        validDate = new Date(date);\r\n      } catch (e) {\r\n        return null;\r\n      }\r\n    }\r\n    \r\n    return isNaN(validDate.getTime()) ? null : validDate;\r\n  };\r\n\r\n  // Asegurar que todos los eventos tengan los campos necesarios\r\n  const safeEvents = allEvents\r\n    .filter(event => event !== null && event !== undefined)\r\n    .map(event => {\r\n      // Verificar que start y end existan\r\n      if (!event.start || !event.end) {\r\n        return null;\r\n      }\r\n      \r\n      // Asegurar que start y end sean objetos Date v√°lidos\r\n      const start = validateAndNormalizeDate(event.start);\r\n      const end = validateAndNormalizeDate(event.end);\r\n      \r\n      // Si alguna fecha no es v√°lida, descartar evento\r\n      if (!start || !end) {\r\n        return null;\r\n      }\r\n      \r\n      // Devolver evento normalizado\r\n      return {\r\n        ...event,\r\n        start,\r\n        end,\r\n        title: event.title || event.name || \"Sin t√≠tulo\"\r\n      };\r\n    })\r\n    .filter(Boolean); // Eliminar eventos nulos\r\n\r\n    // Ordenar eventos por fecha para uso posterior (listas, etc.)\r\n    const sortedTasks = [...safeEvents].sort((a, b) => a.start - b.start);\r\n\r\n  // Filtro espec√≠fico para tareas del componente Gantt\r\n  const taskIdSet = new Set(Array.isArray(tasksState) ? tasksState.filter(Boolean).map(t => t?.id).filter(Boolean) : []);\r\n\r\n  const safeGanttTasks = Array.isArray(tasksState) \r\n    ? tasksState\r\n        .filter(task => task !== null && task !== undefined)\r\n        .map(task => {\r\n          // Verificar que start y end existan\r\n          if (!task.start || !task.end) {\r\n            return null;\r\n          }\r\n          \r\n          // Validar fechas\r\n          const start = validateAndNormalizeDate(task.start);\r\n          const end = validateAndNormalizeDate(task.end);\r\n          \r\n          // Si alguna fecha no es v√°lida, descartar tarea\r\n          if (!start || !end) {\r\n            return null;\r\n          }\r\n          \r\n          // Sanear dependencias para que solo contengan IDs de tareas existentes\r\n          const deps = Array.isArray(task.dependencies)\r\n            ? task.dependencies.filter(dep => taskIdSet.has(dep))\r\n            : [];\r\n\r\n          // Devolver tarea normalizada para formato Gantt\r\n          return {\r\n            ...task,\r\n            start,\r\n            end,\r\n            name: task.name || task.title || \"Sin t√≠tulo\",\r\n            type: task.type || \"task\",\r\n            id: task.id,\r\n            progress: task.progress || 0,\r\n            isDisabled: task.isDisabled || false,\r\n            dependencies: deps\r\n          };\r\n        })\r\n        .filter(Boolean) // Eliminar tareas nulas\r\n    : [];\r\n\r\n  // C√°lculo de progreso - asegurando que los estados sean arrays\r\n  const allTaskIds = [\r\n    ...(Array.isArray(tasksState) ? tasksState.map(t => t.id) : []),\r\n    ...(Array.isArray(meetingsState) ? meetingsState.map(m => m.id) : [])\r\n  ];\r\n  const totalTasks = allTaskIds.length;\r\n  const completedCount = allTaskIds.filter(id => completed[id]).length;\r\n  const percent = totalTasks === 0 ? 0 : Math.round((completedCount / totalTasks) * 100);\r\n  let barColor = 'bg-red-500';\r\n  if (percent >= 80) barColor = 'bg-green-500';\r\n  else if (percent >= 40) barColor = 'bg-blue-500';\r\n\r\n  return (\r\n    <div className=\"max-w-5xl mx-auto p-4 md:p-6 space-y-6 pb-32\">\r\n      <style>{` \r\n        ._1nBOt > *:nth-child(n+2),\r\n        ._34SS0 > *:nth-child(n+2) {\r\n          display: none !important;\r\n        }\r\n        /* Se eliminan las reglas de flex personalizadas que afectaban al grid del calendario */\r\n      `}</style>\r\n      \r\n      <div className=\"flex items-center justify-between\">\r\n        <h1 className=\"page-title\">Gesti√≥n de Tareas</h1>\r\n        <div className=\"flex items-center space-x-4\">\r\n          {/* Indicador de sincronizaci√≥n */}\r\n          <div className=\"flex items-center\">\r\n            {syncStatus.isSyncing ? (\r\n              <RefreshCw className=\"w-4 h-4 animate-spin text-yellow-500 mr-2\" />\r\n            ) : syncStatus.isOnline ? (\r\n              syncStatus.pendingChanges ? (\r\n                <Cloud className=\"w-4 h-4 text-orange-500 mr-2\" />\r\n              ) : (\r\n                <Cloud className=\"w-4 h-4 text-green-500 mr-2\" />\r\n              )\r\n            ) : (\r\n              <CloudOff className=\"w-4 h-4 text-red-500 mr-2\" />\r\n            )}\r\n            <div className=\"text-sm text-gray-500\">\r\n              {syncStatus.isOnline\r\n                ? syncStatus.isSyncing\r\n                  ? \"Sincronizando...\"\r\n                  : syncStatus.pendingChanges\r\n                  ? \"Cambios pendientes\"\r\n                  : \"Sincronizado\"\r\n                : \"Sin conexi√≥n\"}\r\n            </div>\r\n          </div>\r\n          {/* Botones de acci√≥n */}\r\n          <div className=\"flex space-x-2\">\r\n            <button\r\n              onClick={() => {\r\n                resetForm();\r\n                setShowNewTask(true);\r\n              }}\r\n              className=\"bg-pink-500 text-white px-4 py-2 rounded-md transition-colors hover:bg-pink-600 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-opacity-50\"\r\n            >\r\n              Nueva Tarea\r\n            </button>\r\n            <button\r\n              onClick={() => downloadAllICS(safeEvents)}\r\n              className=\"bg-gray-200 text-gray-700 px-4 py-2 rounded-md transition-colors hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50\"\r\n            >\r\n              Vincular Calendario\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Componente para el diagrama Gantt */}\r\n      <div className=\"bg-[var(--color-surface)] rounded-xl shadow-md p-6 transition-all hover:shadow-lg\">\r\n        <h2 className=\"text-xl font-semibold mb-4\">Tareas a Largo Plazo</h2>\r\n        <div className=\"h-96 overflow-x-auto overflow-y-hidden mb-4 border border-gray-100 rounded-lg min-w-[600px]\">\r\n          {safeGanttTasks && safeGanttTasks.length > 0 ? (\r\n            <GanttChart \r\n              tasks={safeGanttTasks} \r\n              viewMode={ViewMode.Month}\r\n              listCellWidth={listCellWidth}\r\n              columnWidth={columnWidthState}\r\n              onTaskClick={(task) => {\r\n                // Abrir modal de edici√≥n para tareas de largo plazo\r\n                setEditingId(task.id);\r\n                setFormData({\r\n                  title: task.title,\r\n                  desc: task.desc || '',\r\n                  category: task.category || 'OTROS',\r\n                  startDate: task.start.toISOString().slice(0, 10),\r\n                  startTime: task.start.toTimeString().slice(0,5),\r\n                  endDate: task.end.toISOString().slice(0, 10),\r\n                  endTime: task.end.toTimeString().slice(0,5),\r\n                  long: true,\r\n                });\r\n                setShowNewTask(true);\r\n              }}\r\n            />\r\n          ) : (\r\n            <div className=\"flex items-center justify-center h-full text-[color:var(--color-text)]/70\">\r\n              No hay tareas de largo plazo que mostrar\r\n            </div>\r\n          )}\r\n        </div>\r\n        <div className=\"mb-4\">\r\n          <div className=\"flex justify-between mb-1 text-sm\">\r\n            <span>Progreso general:</span>\r\n            <span className=\"font-medium\">{percent.toFixed(1)}%</span>\r\n          </div>\r\n          <div className=\"w-full bg-[color:var(--color-surface)]/50 rounded-full h-2.5\">\r\n            <div \r\n              className={`h-2.5 rounded-full ${barColor}`} \r\n              style={{ width: `${percent}%` }}\r\n            ></div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Contenedor responsivo para Calendario y Lista */}\r\n      <div className=\"flex flex-col lg:flex-row gap-6\">\r\n      {/* Calendario de eventos */}\r\n      <div className=\"flex-1 bg-[var(--color-surface)] rounded-xl shadow-md p-6 mt-4 overflow-x-auto\">\r\n        <h2 className=\"text-xl font-semibold mb-4\">Calendario de Eventos</h2>\r\n        \r\n        {/* Controles de navegaci√≥n del calendario */}\r\n        <div className=\"flex justify-between items-center mb-4\">\r\n          <div className=\"space-x-2\">\r\n            <button \r\n              className={`px-3 py-1 rounded ${currentView === 'month' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}\r\n              onClick={() => setCurrentView('month')}\r\n            >\r\n              Mes\r\n            </button>\r\n            <button \r\n              className={`px-3 py-1 rounded ${currentView === 'week' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}\r\n              onClick={() => setCurrentView('week')}\r\n            >\r\n              Semana\r\n            </button>\r\n            <button \r\n              className={`px-3 py-1 rounded ${currentView === 'day' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}\r\n              onClick={() => setCurrentView('day')}\r\n            >\r\n              D√≠a\r\n            </button>\r\n          </div>\r\n          <div className=\"flex items-center space-x-2\">\r\n            <button \r\n              className=\"px-2 py-1 rounded bg-gray-200 hover:bg-gray-300\"\r\n              onClick={() => {\r\n                const newDate = new Date(calendarDate);\r\n                if (currentView === 'month') {\r\n                  newDate.setMonth(newDate.getMonth() - 1);\r\n                } else if (currentView === 'week') {\r\n                  newDate.setDate(newDate.getDate() - 7);\r\n                } else {\r\n                  newDate.setDate(newDate.getDate() - 1);\r\n                }\r\n                setCalendarDate(newDate);\r\n              }}\r\n            >\r\n              &#8592; Anterior\r\n            </button>\r\n            <button \r\n              className=\"px-3 py-1 rounded bg-blue-100 hover:bg-blue-200\"\r\n              onClick={() => setCalendarDate(new Date())}\r\n            >\r\n              Hoy\r\n            </button>\r\n            <button \r\n              className=\"px-2 py-1 rounded bg-gray-200 hover:bg-gray-300\"\r\n              onClick={() => {\r\n                const newDate = new Date(calendarDate);\r\n                if (currentView === 'month') {\r\n                  newDate.setMonth(newDate.getMonth() + 1);\r\n                } else if (currentView === 'week') {\r\n                  newDate.setDate(newDate.getDate() + 7);\r\n                } else {\r\n                  newDate.setDate(newDate.getDate() + 1);\r\n                }\r\n                setCalendarDate(newDate);\r\n              }}\r\n            >\r\n              Siguiente &#8594;\r\n            </button>\r\n          </div>\r\n        </div>\r\n        \r\n        \r\n        <div className=\"rbc-calendar-container\">\r\n          {/* Componente Calendar con protecci√≥n de errores */}\r\n          <ErrorBoundary\r\n            fallback={(\r\n              <div>\r\n                <div className=\"text-center mb-6\">\r\n                  <h3 className=\"text-lg font-medium text-gray-800 mb-2\">Error al cargar el calendario</h3>\r\n                  <p className=\"text-gray-600\">Hubo un problema al cargar el calendario. Puedes gestionar tus eventos a trav√©s de la lista inferior.</p>\r\n                </div>\r\n                <div className=\"space-y-4 max-h-[300px] overflow-y-auto p-2\">\r\n                  {safeEvents && safeEvents.length > 0 ? (\r\n                    sortedTasks\r\n                      .map(event => {\r\n                        const eventId = event.id || '';\r\n                        const eventTitle = event.title || event.name || \"Evento sin t√≠tulo\";\r\n                        const eventStart = event.start instanceof Date ? event.start : new Date();\r\n                        const formattedDate = eventStart.toLocaleDateString('es-ES', {\r\n                          weekday: 'short',\r\n                          day: 'numeric', \r\n                          month: 'short',\r\n                          hour: '2-digit',\r\n                          minute: '2-digit'\r\n                        });\r\n                        \r\n                        return (\r\n                          <div \r\n                            key={eventId} \r\n                            className=\"flex items-center p-3 border rounded-md hover:shadow-md transition-shadow cursor-pointer\"\r\n                            onClick={() => {\r\n                              setEditingId(eventId);\r\n                              setFormData({\r\n                                title: eventTitle,\r\n                                desc: event.desc || '',\r\n                                category: event.category || 'OTROS',\r\n                                startDate: eventStart.toISOString().slice(0, 10),\r\n                                startTime: eventStart.toTimeString().slice(0, 5),\r\n                                endDate: event.end instanceof Date ? event.end.toISOString().slice(0, 10) : eventStart.toISOString().slice(0, 10),\r\n                                endTime: event.end instanceof Date ? event.end.toTimeString().slice(0, 5) : '',\r\n                                long: false,\r\n                              });\r\n                              setShowNewTask(true);\r\n                            }}\r\n                          >\r\n                            <div className=\"mr-3\">\r\n                              <input \r\n                                type=\"checkbox\" \r\n                                checked={completed[eventId] || false} \r\n                                onChange={(e) => {\r\n                                  e.stopPropagation();\r\n                                  toggleCompleted(eventId);\r\n                                }} \r\n                              />\r\n                            </div>\r\n                            <div className=\"flex-1\">\r\n                              <div className={`font-medium ${completed[eventId] ? 'line-through text-gray-400' : ''}`}>{eventTitle}</div>\r\n                              <div className=\"text-xs text-gray-500\">{formattedDate}</div>\r\n                            </div>\r\n                            <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: categories[event.category || 'OTROS']?.color || '#ccc' }} />\r\n                          </div>\r\n                        );\r\n                      })\r\n                  ) : (\r\n                    <div className=\"text-center text-gray-500\">No hay tareas disponibles</div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            )}\r\n          >\r\n            <div className=\"calendar-container\" style={{ height: '500px' }}>\r\n              <style>{`\r\n                /* Estilos para el contenedor del calendario */\r\n                .calendar-container .rbc-calendar {\r\n                  width: 100%;\r\n                  height: 100%;\r\n                  border: 1px solid #ddd;\r\n                  border-radius: 4px;\r\n                }\r\n                \r\n                /* Ocultamos la barra de herramientas nativa ya que usamos nuestros botones */\r\n                .calendar-container .rbc-toolbar {\r\n                  display: none;\r\n                }\r\n                \r\n                /* Estilos para la vista de mes */\r\n                .calendar-container .rbc-month-view {\r\n                  flex: 1;\r\n                  height: 100%;\r\n                  min-height: 400px;\r\n                  display: flex;\r\n                  flex-direction: column;\r\n                  flex: 1 0 0;\r\n                }\r\n                \r\n                /* Cabecera del mes */\r\n                .calendar-container .rbc-month-header {\r\n                  display: flex;\r\n                  flex-direction: row;\r\n                  font-weight: bold;\r\n                  background-color: #f8f9fa;\r\n                  border-bottom: 1px solid #ddd;\r\n                }\r\n                \r\n                .calendar-container .rbc-header {\r\n                  padding: 8px 3px;\r\n                  text-align: center;\r\n                  border-bottom: 1px solid #ddd;\r\n                  flex: 1 0;\r\n                }\r\n                \r\n                /* Filas del mes */\r\n                .calendar-container .rbc-month-row {\r\n                  display: flex;\r\n                  flex-direction: column;\r\n                  overflow: hidden;\r\n                  flex: 1;\r\n                  min-height: 0;\r\n                }\r\n                \r\n                /* Celdas de d√≠as */\r\n                .calendar-container .rbc-day-bg {\r\n                  flex: 1 0;\r\n                  border-bottom: 1px solid #eee;\r\n                  border-left: 1px solid #eee;\r\n                  cursor: pointer;\r\n                }\r\n                \r\n                .calendar-container .rbc-date-cell {\r\n                  padding: 4px 5px 0 0;\r\n                  text-align: right;\r\n                  font-size: 0.9em;\r\n                }\r\n                \r\n                .calendar-container .rbc-row-segment {\r\n                  padding: 0 1px 1px 1px;\r\n                }\r\n                \r\n                /* Eventos en el calendario */\r\n                .calendar-container .rbc-event {\r\n                  border-radius: 3px;\r\n                  font-size: 0.85em;\r\n                  padding: 2px 5px;\r\n                  margin: 1px 2px;\r\n                }\r\n\r\n                /* Estilos para corregir la altura de las filas */\r\n                .calendar-container .rbc-month-view .rbc-month-row {\r\n                  height: 100% !important;\r\n                  display: flex !important;\r\n                  flex: 1 1 0 !important;\r\n                  flex-flow: column !important;\r\n                }\r\n                \r\n                .calendar-container .rbc-row-content {\r\n                  flex: 1 1 0;\r\n                  display: flex;\r\n                  flex-direction: column;\r\n                  width: 100%;\r\n                }\r\n                \r\n                .calendar-container .rbc-row {\r\n                  display: flex;\r\n                  flex: 1 1 0;\r\n                  width: 100%;\r\n                }\r\n              `}</style>\r\n              <Calendar\r\n                localizer={localizer}\r\n                events={safeEvents}\r\n                date={calendarDate}\r\n                onNavigate={date => setCalendarDate(date)}\r\n                startAccessor=\"start\"\r\n                endAccessor=\"end\"\r\n                views={{\r\n                  month: true,\r\n                  week: true,\r\n                  day: true\r\n                }}\r\n                view={currentView}\r\n                onView={setCurrentView}\r\n                toolbar={false}\r\n                popup={true}\r\n                eventPropGetter={eventStyleGetter}\r\n                components={{ event: Event }}\r\n                onDoubleClickEvent={(event) => {\r\n                  setEditingId(event.id);\r\n                  setFormData({\r\n                    title: event.title,\r\n                    desc: event.desc || '',\r\n                    category: event.category || 'OTROS',\r\n                    startDate: event.start.toISOString().slice(0, 10),\r\n                    startTime: event.start.toTimeString().slice(0, 5),\r\n                    endDate: event.end.toISOString().slice(0, 10),\r\n                    endTime: event.end.toTimeString().slice(0, 5),\r\n                    long: false,\r\n                  });\r\n                  setShowNewTask(true);\r\n                }}\r\n                messages={{\r\n                  next: \"Siguiente\",\r\n                  previous: \"Anterior\",\r\n                  today: \"Hoy\",\r\n                  month: \"Mes\",\r\n                  week: \"Semana\",\r\n                  day: \"D√≠a\"\r\n                }}\r\n              />\r\n            </div>\r\n          </ErrorBoundary>\r\n        </div>\r\n\r\n      </div>\r\n\r\n      {false && (\r\n        <div className=\"w-full\">\r\n          <div className=\"calendar-container\" style={{ height: '500px' }}>\r\n            <style>{`\r\n              /* Estilos para el contenedor del calendario */\r\n              .calendar-container .rbc-calendar {\r\n                width: 100%;\r\n                height: 100%;\r\n                border: 1px solid #ddd;\r\n                border-radius: 4px;\r\n              }\r\n              \r\n              /* Ocultamos la barra de herramientas nativa ya que usamos nuestros botones */\r\n              .calendar-container .rbc-toolbar {\r\n                display: none;\r\n              }\r\n              \r\n              /* Estilos para la vista de mes */\r\n              .calendar-container .rbc-month-view {\r\n                flex: 1;\r\n                height: 100%;\r\n                min-height: 400px;\r\n                display: flex;\r\n                flex-direction: column;\r\n                flex: 1 0 0;\r\n              }\r\n              \r\n              /* Cabecera del mes */\r\n              .calendar-container .rbc-month-header {\r\n                display: flex;\r\n                flex-direction: row;\r\n                font-weight: bold;\r\n                background-color: #f8f9fa;\r\n                border-bottom: 1px solid #ddd;\r\n              }\r\n              \r\n              .calendar-container .rbc-header {\r\n                padding: 8px 3px;\r\n                text-align: center;\r\n                border-bottom: 1px solid #ddd;\r\n                flex: 1 0;\r\n              }\r\n              \r\n              /* Filas del mes */\r\n              .calendar-container .rbc-month-row {\r\n                display: flex;\r\n                flex-direction: column;\r\n                overflow: hidden;\r\n                flex: 1;\r\n                min-height: 0;\r\n              }\r\n              \r\n              /* Celdas de d√≠as */\r\n              .calendar-container .rbc-day-bg {\r\n                flex: 1 0;\r\n                border-bottom: 1px solid #eee;\r\n                border-left: 1px solid #eee;\r\n                cursor: pointer;\r\n              }\r\n              \r\n              .calendar-container .rbc-date-cell {\r\n                padding: 4px 5px 0 0;\r\n                text-align: right;\r\n                font-size: 0.9em;\r\n              }\r\n              \r\n              .calendar-container .rbc-row-segment {\r\n                padding: 0 1px 1px 1px;\r\n              }\r\n              \r\n              /* Eventos en el calendario */\r\n              .calendar-container .rbc-event {\r\n                border-radius: 3px;\r\n                font-size: 0.85em;\r\n                padding: 2px 5px;\r\n                margin: 1px 2px;\r\n              }\r\n\r\n              /* Estilos para corregir la altura de las filas */\r\n              .calendar-container .rbc-month-view .rbc-month-row {\r\n                height: 100% !important;\r\n                display: flex !important;\r\n                flex: 1 1 0 !important;\r\n                flex-flow: column !important;\r\n              }\r\n              \r\n              .calendar-container .rbc-row-content {\r\n                flex: 1 1 0;\r\n                display: flex;\r\n                flex-direction: column;\r\n                width: 100%;\r\n              }\r\n              \r\n              .calendar-container .rbc-row {\r\n                display: flex;\r\n                flex: 1 1 0;\r\n                width: 100%;\r\n              }\r\n            `}</style>\r\n            <Calendar\r\n              localizer={localizer}\r\n              events={safeEvents}\r\n              date={calendarDate}\r\n              onNavigate={date => setCalendarDate(date)}\r\n              startAccessor=\"start\"\r\n              endAccessor=\"end\"\r\n              views={{\r\n                month: true,\r\n                week: true,\r\n                day: true\r\n              }}\r\n              view={currentView}\r\n              onView={setCurrentView}\r\n              toolbar={false}\r\n              popup={true}\r\n              eventPropGetter={eventStyleGetter}\r\n              components={{ event: Event }}\r\n              onDoubleClickEvent={(event) => {\r\n                setEditingId(event.id);\r\n                setFormData({\r\n                  title: event.title,\r\n                  desc: event.desc || '',\r\n                  category: event.category || 'OTROS',\r\n                  startDate: event.start.toISOString().slice(0, 10),\r\n                  startTime: event.start.toTimeString().slice(0, 5),\r\n                  endDate: event.end.toISOString().slice(0, 10),\r\n                  endTime: event.end.toTimeString().slice(0, 5),\r\n                  long: false,\r\n                });\r\n                setShowNewTask(true);\r\n              }}\r\n              messages={{\r\n                next: \"Siguiente\",\r\n                previous: \"Anterior\",\r\n                today: \"Hoy\",\r\n                month: \"Mes\",\r\n                week: \"Semana\",\r\n                day: \"D√≠a\"\r\n              }}\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n       <div className=\"bg-white rounded-xl shadow-md p-6 mt-4 lg:mt-0 lg:w-80 flex-none transition-all hover:shadow-lg\">\r\n        <h2 className=\"text-xl font-semibold mb-4\">Listado de Tareas</h2>\r\n        <div className=\"w-full\">\r\n          <TaskList \r\n            tasks={safeEvents} \r\n            onTaskClick={(event) => {\r\n              setEditingId(event.id);\r\n              setFormData({\r\n                title: event.title,\r\n                desc: event.desc || '',\r\n                category: event.category || 'OTROS',\r\n                startDate: event.start.toISOString().slice(0, 10),\r\n                startTime: event.start.toTimeString().slice(0,5),\r\n                endDate: event.end.toISOString().slice(0, 10),\r\n                endTime: event.end.toTimeString().slice(0,5),\r\n                long: false\r\n              });\r\n              setShowNewTask(true);\r\n            }}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Modal para nueva tarea */}\r\n      {showNewTask && (\r\n        <TaskForm \r\n          formData={formData} \r\n          editingId={editingId} \r\n          handleChange={handleChange}\r\n          handleSaveTask={handleSaveTask}\r\n          handleDeleteTask={handleDeleteTask}\r\n          closeModal={closeModal}\r\n          setFormData={setFormData}\r\n        />\r\n      )}\r\n\r\n      </div>\r\n     </div>\r\n   );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\tasks\\__tests__\\TaskForm.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\timeline\\TimelineInteractive.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Check' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { DragDropContext, Droppable, Draggable } from 'react-beautiful-dnd';\r\nimport { Check, GripVertical, Plus } from 'lucide-react';\r\n\r\nconst defaultEvents = [\r\n  { id: '1', title: 'Ceremonia', time: '17:00', location: 'Iglesia' },\r\n  { id: '2', title: 'C√≥ctel', time: '18:30', location: 'Jardines' },\r\n  { id: '3', title: 'Banquete', time: '20:30', location: 'Sal√≥n' },\r\n  { id: '4', title: 'Baile', time: '23:00', location: 'Pista' },\r\n];\r\n\r\nexport default function TimelineInteractive({ events = defaultEvents, onChange }) {\r\n  const [items, setItems] = useState(events);\r\n  const [editingId, setEditingId] = useState(null);\r\n  const [newEvent, setNewEvent] = useState({ title: '', time: '', location: '' });\r\n\r\n  const reorder = (list, startIndex, endIndex) => {\r\n    const result = Array.from(list);\r\n    const [removed] = result.splice(startIndex, 1);\r\n    result.splice(endIndex, 0, removed);\r\n    return result;\r\n  };\r\n\r\n  const onDragEnd = result => {\r\n    if (!result.destination) return;\r\n    const ordered = reorder(items, result.source.index, result.destination.index);\r\n    setItems(ordered);\r\n    onChange && onChange(ordered);\r\n  };\r\n\r\n  const saveEdit = (id, field, value) => {\r\n    const updated = items.map(ev => (ev.id === id ? { ...ev, [field]: value } : ev));\r\n    setItems(updated);\r\n    onChange && onChange(updated);\r\n  };\r\n\r\n  const addEvent = () => {\r\n    if (!newEvent.title) return;\r\n    const newItem = { ...newEvent, id: Date.now().toString() };\r\n    const updated = [...items, newItem];\r\n    setItems(updated);\r\n    setNewEvent({ title: '', time: '', location: '' });\r\n    onChange && onChange(updated);\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <h3 className=\"text-lg font-semibold\">Cronograma</h3>\r\n      <DragDropContext onDragEnd={onDragEnd}>\r\n        <Droppable droppableId=\"timeline\">\r\n          {provided => (\r\n            <ul {...provided.droppableProps} ref={provided.innerRef} className=\"space-y-2\">\r\n              {items.map((ev, index) => (\r\n                <Draggable key={ev.id} draggableId={ev.id} index={index}>\r\n                  {prov => (\r\n                    <li\r\n                      ref={prov.innerRef}\r\n                      {...prov.draggableProps}\r\n                      className=\"bg-white border p-3 rounded flex items-center gap-2\"\r\n                    >\r\n                      <span {...prov.dragHandleProps} className=\"text-gray-400 cursor-grab\"><GripVertical size={14}/></span>\r\n                      {/* Title */}\r\n                      {editingId===ev.id ? (\r\n                        <input\r\n                          autoFocus\r\n                          value={ev.title}\r\n                          onChange={e=>saveEdit(ev.id,'title',e.target.value)}\r\n                          onBlur={()=>setEditingId(null)}\r\n                          className=\"border-b flex-1 focus:outline-none text-sm\"\r\n                        />\r\n                      ) : (\r\n                        <span className=\"flex-1 cursor-pointer\" onDoubleClick={()=>setEditingId(ev.id)}>{ev.title}</span>\r\n                      )}\r\n                      {/* Time */}\r\n                      <input\r\n                        type=\"time\"\r\n                        value={ev.time}\r\n                        onChange={e=>saveEdit(ev.id,'time',e.target.value)}\r\n                        className=\"border rounded px-1 text-xs\"\r\n                      />\r\n                      {/* Location */}\r\n                      <input\r\n                        value={ev.location}\r\n                        onChange={e=>saveEdit(ev.id,'location',e.target.value)}\r\n                        placeholder=\"Lugar\"\r\n                        className=\"border rounded px-1 text-xs\"\r\n                      />\r\n                    </li>\r\n                  )}\r\n                </Draggable>\r\n              ))}\r\n              {provided.placeholder}\r\n            </ul>\r\n          )}\r\n        </Droppable>\r\n      </DragDropContext>\r\n      {/* Add new event */}\r\n      <div className=\"flex gap-2 items-center\">\r\n        <input\r\n          value={newEvent.title}\r\n          onChange={e=>setNewEvent({...newEvent,title:e.target.value})}\r\n          placeholder=\"Nuevo evento\"\r\n          className=\"border rounded px-2 text-xs flex-1\"\r\n        />\r\n        <input\r\n          type=\"time\"\r\n          value={newEvent.time}\r\n          onChange={e=>setNewEvent({...newEvent,time:e.target.value})}\r\n          className=\"border rounded px-1 text-xs\"\r\n        />\r\n        <input\r\n          value={newEvent.location}\r\n          onChange={e=>setNewEvent({...newEvent,location:e.target.value})}\r\n          placeholder=\"Lugar\"\r\n          className=\"border rounded px-2 text-xs\"\r\n        />\r\n        <button onClick={addEvent} className=\"bg-blue-600 text-white rounded p-1\"><Plus size={14}/></button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\ui\\Alert.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\ui\\Badge.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\ui\\BaseModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\ui\\Button.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\ui\\Card.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\ui\\FormField.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\ui\\IconComponents.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\ui\\LanguageSelector.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\ui\\Loader.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\ui\\Progress.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\ui\\Spinner.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\ui\\Tabs.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\components\\ui\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\context\\AuthContext.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\context\\UserContext.jsx","messages":[{"ruleId":null,"fatal":true,"severity":2,"message":"Parsing error: 'return' outside of function","line":149,"column":5,"nodeType":null}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext } from 'react';\r\nimport { useAuth } from '../hooks/useAuth';\r\nimport { setPersistence, browserLocalPersistence, browserSessionPersistence } from 'firebase/auth';\r\nimport {\r\n  createUserWithEmailAndPassword,\r\n  signInWithEmailAndPassword,\r\n  signOut,\r\n  onAuthStateChanged,\r\n  updateProfile as fbUpdateProfile,\r\n  sendEmailVerification,\r\n  sendPasswordResetEmail,\r\n  updateEmail,\r\n  updatePassword,\r\n  reauthenticateWithCredential,\r\n} from 'firebase/auth';\r\nimport { doc, getDoc, setDoc, serverTimestamp } from 'firebase/firestore';\r\n\r\n// Stub de compatibilidad: reexporta datos del nuevo sistema de autenticaci√≥n\r\n// Elimina la l√≥gica legacy, simplificando su mantenimiento.\r\nconst UserContext = createContext({\r\n  user: null,\r\n  isAuthenticated: false,\r\n  loading: true,\r\n  signup: async () => {},\r\n  login: async () => {},\r\n  logout: async () => {},\r\n  updateProfile: async () => {},\r\n});\r\n\r\nexport const useUserContext = () => useContext(UserContext);\r\n\r\n// Provider vac√≠o para mantener compatibilidad; no realiza l√≥gica.\r\nexport default function UserProvider({ children }) {\r\n  // Obtenemos datos del nuevo sistema\r\n  const {\r\n    currentUser,\r\n    userProfile,\r\n    login,\r\n    logout,\r\n    updateUserProfile: updateProfile,\r\n    isAuthenticated,\r\n    isLoading: loading,\r\n  } = useAuth();\r\n\r\n  // Derivar propiedades compatibles\r\n  const value = {\r\n    user: currentUser,\r\n    userName: userProfile?.name || userProfile?.displayName || currentUser?.displayName || currentUser?.email?.split('@')[0],\r\n    weddingName: localStorage.getItem('lovenda_active_wedding_name') || '',\r\n    progress: Number(localStorage.getItem('lovenda_progress') || 0),\r\n    logoUrl: userProfile?.logoUrl || '',\r\n    role: userProfile?.role || 'particular',\r\n    isAuthenticated,\r\n    loading,\r\n    login,\r\n    logout,\r\n    signup: () => Promise.reject(new Error('signup no implementado: usa register() en useAuth')), // placeholder\r\n    updateProfile,\r\n  };\r\n    let unsubscribe;\r\n    (async () => {\r\n      await firebaseReady;\r\n    // Soporte para pruebas E2E con Cypress: detectar claves userEmail / isLoggedIn\r\n    const testEmail = localStorage.getItem('userEmail');\r\n    const isLoggedIn = localStorage.getItem('isLoggedIn');\r\n    if (isLoggedIn === 'true' && testEmail) {\r\n      const mockUser = {\r\n        uid: 'cypress-test',\r\n        email: testEmail,\r\n        displayName: testEmail.split('@')[0],\r\n        role: 'particular'\r\n      };\r\n      setUser(mockUser);\r\n      setLoading(false);\r\n      return; // Skip Firebase auth listeners\r\n    }\r\n    \r\n    // En modo desarrollo podemos forzar un rol sin pasar por Firebase,\r\n    // pero solo si el desarrollador lo ha indicado expl√≠citamente.\r\n    if (process.env.NODE_ENV === 'development') {\r\n      // Lee override de variable de entorno o de localStorage\r\n      const devRole = import.meta.env.VITE_DEV_ROLE || localStorage.getItem('lovenda_dev_role');\r\n      if (devRole) {\r\n        setUser({ uid: 'dev', email: 'dev@local', role: devRole });\r\n        setLoading(false);\r\n        return; // Skip Firebase auth listeners\r\n      }\r\n    }\r\n    const unsubscribe = onAuthStateChanged(auth, async (firebaseUser) => {\r\n      if (firebaseUser) {\r\n        let role = 'particular';\r\n        try {\r\n          // Validar que db est√© inicializado correctamente\r\n          if (!db) {\r\n            console.warn('üö´ Firestore no est√° inicializado, usando rol por defecto');\r\n            setUser({ ...firebaseUser, role });\r\n            return;\r\n          }\r\n          \r\n          const userDoc = await getDoc(doc(db, 'users', firebaseUser.uid));\r\n          if (userDoc.exists()) {\r\n            role = userDoc.data().role || 'particular';\r\n          } else {\r\n            // Intenta crear el documento si no existe\r\n            await setDoc(\r\n              doc(db, 'users', firebaseUser.uid),\r\n              { role, email: firebaseUser.email, createdAt: serverTimestamp() },\r\n              { merge: true }\r\n            );\r\n          }\r\n        } catch (err) {\r\n          // No interrumpas la sesi√≥n por problemas de permisos / offline\r\n          console.warn('üîç No se pudo obtener/crear el doc de usuario:', {\r\n            code: err?.code,\r\n            message: err?.message,\r\n            uid: firebaseUser?.uid,\r\n            dbInitialized: !!db\r\n          });\r\n          // Continuar con rol por defecto si hay error\r\n        }\r\n        setUser({ ...firebaseUser, role });\r\n      } else {\r\n        setUser(null);\r\n      }\r\n      setLoading(false);\r\n    });\r\n    })();\r\n    return () => {\r\n      if (unsubscribe) unsubscribe();\r\n    };\r\n  // Devolvemos el proveedor con los valores derivados\r\n  return (\r\n    <UserContext.Provider value={value}>\r\n      {children}\r\n    </UserContext.Provider>\r\n  );\r\n}\r\n\r\n/* Legacy methods eliminados, ya no se usan */\r\n\r\n/* eslint-disable */\r\n// Mantener exportaciones nominales para que el c√≥digo existente compile incluso si no se usan\r\naction: null;\r\n/* eslint-enable */\r\n    const userCredential = await createUserWithEmailAndPassword(auth, email, password);\r\n    const newUser = userCredential.user;\r\n    await setDoc(doc(db, 'users', newUser.uid), { role, email: newUser.email, createdAt: serverTimestamp() });\r\n    setUser({ ...newUser, role });\r\n    return newUser;\r\n  };\r\n\r\n  const login = async (email, password, remember = true) => {\r\n    // Siempre usamos browserLocalPersistence para que la sesi√≥n se conserve aunque se cierre el navegador.\r\n    // El par√°metro \"remember\" queda s√≥lo para conservar el email en localStorage, no afecta a la persistencia.\r\n    await setPersistence(auth, browserLocalPersistence);\r\n    const userCredential = await signInWithEmailAndPassword(auth, email, password);\r\n    let role = 'particular';\r\n    try {\r\n      const userDoc = await getDoc(doc(db, 'users', userCredential.user.uid));\r\n      if (userDoc.exists()) {\r\n        role = userDoc.data().role || role;\r\n      }\r\n    } catch (err) {\r\n      console.warn('No se pudo obtener rol en login:', err?.code || err);\r\n    }\r\n    setUser({ ...userCredential.user, role });\r\n    return { ...userCredential.user, role };\r\n};\r\n\r\n  // Cerrar sesi√≥n y limpiar estado\r\n  const logout = async () => {\r\n    await signOut(auth);\r\n    setUser(null);\r\n  };\r\n\r\n\r\n  const updateProfile = async (profile) => {\r\n    if (auth.currentUser) {\r\n      await fbUpdateProfile(auth.currentUser, profile);\r\n      setUser({ ...auth.currentUser, ...profile });\r\n    }\r\n  };\r\n\r\n  const sendVerificationEmail = async () => {\r\n    if (auth.currentUser) {\r\n      await sendEmailVerification(auth.currentUser);\r\n    }\r\n  };\r\n\r\n  const sendPasswordReset = async (email) => {\r\n    if (email) {\r\n      await sendPasswordResetEmail(auth, email);\r\n    }\r\n  };\r\n\r\n  const updateUserEmail = async (newEmail) => {\r\n    if (auth.currentUser) {\r\n      await updateEmail(auth.currentUser, newEmail);\r\n      setUser({ ...auth.currentUser, email: newEmail });\r\n    }\r\n  };\r\n\r\n  const updateUserPassword = async (newPassword) => {\r\n    if (auth.currentUser) {\r\n      await updatePassword(auth.currentUser, newPassword);\r\n    }\r\n  };\r\n\r\n  const reauthenticate = async (credential) => {\r\n    if (auth.currentUser) {\r\n      await reauthenticateWithCredential(auth.currentUser, credential);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <UserContext.Provider value={{\r\n      user,\r\n      role: user?.role || null,\r\n      isAuthenticated: !!user,\r\n      loading,\r\n      signup,\r\n      login,\r\n      logout,\r\n      updateProfile,\r\n      sendVerificationEmail,\r\n      sendPasswordReset,\r\n      updateUserEmail,\r\n      updateUserPassword,\r\n      reauthenticate,\r\n    }}>\r\n      {children}\r\n    </UserContext.Provider>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\context\\WeddingContext.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\contexts\\UserContext.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\data\\templates\\generalTemplates.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\data\\templates\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\data\\templates\\invitadosTemplates.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\data\\templates\\proveedorTemplates.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\data\\templates\\seguimientoTemplates.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\debug.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\debug\\setupDebug.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\features\\seating\\GuestPanel.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'forwardRef' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { forwardRef } from 'react';\r\nimport { FixedSizeList } from 'react-window';\r\nimport GuestItem from '../../components/GuestItem';\r\n\r\n/**\r\n * GuestPanel\r\n * Muestra la lista de invitados con b√∫squeda y virtualizaci√≥n.\r\n * Se extrae desde SeatingPlan para mejorar la legibilidad y reutilizaci√≥n.\r\n */\r\nconst GuestPanel = ({\r\n  guests,\r\n  tables,\r\n  search,\r\n  setSearch,\r\n  guestOpen,\r\n  setGuestOpen,\r\n  guestBtnRef,\r\n  searchRef,\r\n}) => {\r\n  // Filtro de invitados libres seg√∫n texto y mesas asignadas\r\n  const availableGuests = guests.filter(\r\n    (g) =>\r\n      g.name.toLowerCase().includes(search.toLowerCase()) &&\r\n      !tables.some((t) => t.guestId === g.id)\r\n  );\r\n\r\n  return (\r\n    <>\r\n      {/* Toggle button (mobile) */}\r\n      <button\r\n        ref={guestBtnRef}\r\n        className=\"md:hidden mb-2 px-3 py-1 bg-gray-200 rounded\"\r\n        onClick={() => setGuestOpen((o) => !o)}\r\n        aria-expanded={guestOpen}\r\n        aria-controls=\"guestPanel\"\r\n      >\r\n        {guestOpen ? 'Ocultar invitados' : 'Mostrar invitados'}\r\n      </button>\r\n\r\n      {/* Guest list container */}\r\n      <div\r\n        id=\"guestPanel\"\r\n        className={`md:w-1/4 border rounded p-2 h-96 overflow-y-auto bg-gray-50 ${\r\n          guestOpen ? 'block md:block' : 'hidden md:block'\r\n        } ${\r\n          guestOpen ? 'fixed inset-0 z-50 bg-white md:static md:bg-gray-50' : ''\r\n        }`}\r\n        role=\"dialog\"\r\n        aria-modal={guestOpen}\r\n        aria-label=\"Lista de invitados\"\r\n      >\r\n        {/* Search input */}\r\n        <input\r\n          ref={searchRef}\r\n          type=\"text\"\r\n          value={search}\r\n          onChange={(e) => setSearch(e.target.value)}\r\n          placeholder=\"Buscar invitado\"\r\n          className=\"mb-2 w-full border rounded px-2 py-1\"\r\n        />\r\n\r\n        {/* Virtualized list */}\r\n        <FixedSizeList\r\n          height={400}\r\n          width={300}\r\n          itemSize={50}\r\n          itemCount={availableGuests.length}\r\n        >\r\n          {({ index, style }) => (\r\n            <div style={style}>\r\n              <GuestItem guest={availableGuests[index]} />\r\n            </div>\r\n          )}\r\n        </FixedSizeList>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default GuestPanel;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\features\\seating\\SeatingCanvas.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'online' is defined but never used. Allowed unused args must match /^_/u.","line":28,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":28,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { forwardRef } from 'react';\r\n\r\n\r\n\r\nimport FreeDrawCanvas from '../../components/FreeDrawCanvas';\r\nimport TableItem from '../../components/TableItem';\r\nimport ChairItem from '../../components/ChairItem';\r\n\r\n/**\r\n * SeatingCanvas\r\n * Envoltorio del lienzo con soporte de zoom/pan y renderizado de mesas/√°reas.\r\n * Extra√≠do desde SeatingPlan.jsx para mejorar la legibilidad.\r\n */\r\nconst SeatingCanvas = forwardRef(function SeatingCanvas(\r\n  {\r\n    tab,\r\n    areas,\r\n    tables,\r\n    seats = [],\r\n    scale = 1,\r\n    offset = { x: 0, y: 0 },\r\n    addArea,\r\n    onDeleteArea,\r\n    moveTable,\r\n    onAssignGuest,\r\n    onToggleEnabled,\r\n    setConfigTable,\r\n    online,\r\n    handleWheel,\r\n    handlePointerDown,\r\n    guests = [],\r\n    onSelectTable,\r\n    drawMode = 'free',\r\n    canPan = true,\r\n    canMoveTables = true,\r\n    onToggleSeat = () => {},\r\n    onDoubleClick = () => {}, \r\n    onUpdateArea = () => {}, \r\n    hallSize = null,\r\n  },\r\n  containerRef,\r\n) {\r\n  // Mapear drawMode externo a valores aceptados por FreeDrawCanvas\r\n  const internalDrawMode =\r\n    drawMode === 'boundary' ? 'boundary'  // Usar el nuevo modo boundary\r\n  : drawMode === 'obstacle' ? 'rect'\r\n  : drawMode === 'door' ? 'rect'\r\n  : drawMode === 'aisle' ? 'line'\r\n  : drawMode;\r\n\r\n  return (\r\n\r\n      <div\r\n        className=\"flex-grow border border-gray-300 h-[800px] relative overflow-hidden\" // adjusted height\r\n        onDoubleClick={onDoubleClick} // added event handler\r\n        onWheel={canPan ? handleWheel : undefined}\r\n        onPointerDown={canPan ? handlePointerDown : undefined}\r\n        role=\"main\"\r\n        aria-label=\"Lienzo de plano\"\r\n        ref={containerRef}\r\n        style={{\r\n          backgroundImage: 'linear-gradient(to right, #eaeaea 1px, transparent 1px), linear-gradient(to bottom, #eaeaea 1px, transparent 1px)',\r\n          backgroundSize: `${20 * scale}px ${20 * scale}px`,\r\n        }}\r\n      >\r\n        {/* √Årea del sal√≥n (solo banquete) */}\r\n        {tab==='banquet' && hallSize && (\r\n          <div\r\n            style={{\r\n              position:'absolute',\r\n              left:0,\r\n              top:0,\r\n              width: hallSize.width * scale,\r\n              height: hallSize.height * scale,\r\n              border:'2px dashed #6b7280',\r\n              backgroundColor:'rgba(255,255,255,0.6)',\r\n              pointerEvents:'none'\r\n            }}\r\n          />\r\n        )}\r\n\r\n        {/* Canvas libre */}\r\n        <FreeDrawCanvas\r\n          areas={areas}\r\n          scale={scale}\r\n          offset={offset}\r\n          onFinalize={addArea}\r\n          onDeleteArea={onDeleteArea}\r\n          onUpdateArea={onUpdateArea}\r\n          drawMode={internalDrawMode}\r\n        />\r\n\r\n{/* Sillas (solo ceremonia) */}\r\n        {tab==='ceremony' && seats.map((seat, idx) => (\r\n          <ChairItem key={`${seat.id}-${idx}`} seat={seat} scale={scale} offset={offset} onToggleEnabled={onToggleSeat} />\r\n        ))}\r\n\r\n        {/* Mesas (solo banquete) */}\r\n        {tab==='banquet' && tables.map((t, idx) => (\r\n          <TableItem\r\n            key={`${t.id}-${idx}`}\r\n            table={t}\r\n            scale={scale}\r\n            offset={offset}\r\n            onMove={moveTable}\r\n            onAssignGuest={onAssignGuest}\r\n            onToggleEnabled={onToggleEnabled}\r\n            onOpenConfig={setConfigTable}\r\n            onSelect={onSelectTable}\r\n            guests={guests}\r\n            canMove={canMoveTables}\r\n          />\r\n        ))}\r\n\r\n\r\n\r\n\r\n      </div>\r\n\r\n  );\r\n});\r\n\r\nexport default SeatingCanvas;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\features\\seating\\useSeatingHistory.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\firebaseConfig.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'connectFirestoreEmulator' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":69}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { initializeApp, getApps, getApp } from 'firebase/app';\r\nimport { getAuth } from 'firebase/auth';\r\nimport { initializeFirestore, getFirestore, connectFirestoreEmulator, doc, setDoc, enableIndexedDbPersistence } from 'firebase/firestore';\r\nimport { getAnalytics, isSupported } from 'firebase/analytics';\r\nimport { getDatabase, ref, onValue } from 'firebase/database';\r\n\r\n// Configuraci√≥n de Firebase\r\nconst firebaseConfig = {\r\n  apiKey: \"AIzaSyArwjJewGV5j_vzWjqOsQPoJMSFtaCkSZE\",\r\n  authDomain: \"lovenda-98c77.firebaseapp.com\",\r\n  projectId: \"lovenda-98c77\",\r\n  storageBucket: \"lovenda-98c77.appspot.com\",\r\n  messagingSenderId: \"844882125080\",\r\n  appId: \"1:844882125080:web:4015c2e2e6eedf009f7e6d\",\r\n  measurementId: \"G-4QMWEHYPG8\"\r\n};\r\n\r\n// Variables globales de Firebase\r\n// Inicializaci√≥n inmediata para exponer 'app' y 'db' de forma s√≠ncrona\r\nlet app = getApps().length ? getApp() : initializeApp(firebaseConfig);\r\nlet db = initializeFirestore(app, {\r\n  experimentalForceLongPolling: true,\r\n  cacheSizeBytes: 50 * 1024 * 1024,\r\n  ignoreUndefinedProperties: true,\r\n});\r\nlet auth;\r\nlet analytics;\r\n\r\n// Configuraci√≥n simplificada sin m√≥dulo de diagn√≥stico visual\r\n\r\n/**\r\n * Prueba la conexi√≥n con Firestore con reintentos\r\n */\r\nconst probarConexionFirestore = async (maxReintentos = 2) => {\r\n  for (let intento = 0; intento <= maxReintentos; intento++) {\r\n    try {\r\n      const docPrueba = doc(db, '_conexion_prueba', 'test');\r\n      await setDoc(docPrueba, { \r\n        timestamp: new Date().toISOString(),\r\n        intento: intento + 1\r\n      }, { merge: true });\r\n      console.log('Prueba de conexi√≥n exitosa');\r\n      return true;\r\n    } catch (error) {\n      console.warn(`Intento ${intento + 1} fallido:`, error);\n      if (intento === maxReintentos) {\n        console.error('Todos los intentos de conexi√≥n fallaron');\n        throw error;\n      }\n      // Esperar antes de reintentar (backoff exponencial)\n      await new Promise(resolver => setTimeout(resolver, 1000 * Math.pow(2, intento)));\n    }\n  }\n  return false;\n};\n\n/**\n * Configura el listener de estado de conexi√≥n\n */\n// Configura el listener de estado de conexi√≥n (solo si se habilita expl√≠citamente)\nconst configurarListenerConexion = () => {\n  if (typeof window === 'undefined') return;\n\n  // Si la variable de entorno VITE_ENABLE_REALTIME_DB no est√° en 'true', omitimos\n  if (import.meta.env.VITE_ENABLE_REALTIME_DB !== 'true') {\n    console.log('Realtime Database deshabilitada ‚Äì no se configurar√° listener de conexi√≥n');\n    return;\n  }\n  if (typeof window === 'undefined') return;\n\n  try {\n        // Se asume que Realtime Database est√° correctamente configurada en el proyecto\n    const dbRealtime = getDatabase();\n    const estadoConexion = ref(dbRealtime, '.info/connected');\n    \n    onValue(estadoConexion, (snapshot) => {\n      if (snapshot.val() === true) {\n        console.log('Conectado a Firebase');\n        if (window.mostrarErrorUsuario) {\n        window.mostrarErrorUsuario(`Conectado a internet`, 3000);\n      }\n      } else {\n        console.log('Desconectado de Firebase');\n\n      }\n    });\n  } catch (error) {\n    console.warn('No se pudo configurar el listener de conexi√≥n:', error);\n  }\n};\n\n/**\n * Inicializa los servicios de Firebase\n */\nconst inicializarFirebase = async () => {\n  try {\n    console.log('Iniciando configuraci√≥n de Firebase...');\n    \n    // Inicializar la app de Firebase\n    try {\n      app = getApps().length ? getApp() : initializeApp(firebaseConfig);\n      console.log('‚úÖ Firebase inicializado correctamente');\n    } catch (initError) {\n      console.error('‚ùå Error al inicializar Firebase App:', initError);\n      throw new Error(`Error al inicializar Firebase: ${initError.message}`);\n    }\n\n    // Inicializar autenticaci√≥n\n    try {\n      auth = getAuth(app);\n      // Exponer auth para depuraci√≥n en modo desarrollo\n      if (typeof window !== 'undefined' && import.meta.env && import.meta.env.DEV) {\n        window.auth = auth;\n      }\n      // Garantizamos persistencia local para mantener la sesi√≥n incluso tras cerrar el navegador\n      try {\n        const { setPersistence, browserLocalPersistence } = await import('firebase/auth');\n        await setPersistence(auth, browserLocalPersistence);\n        console.log('‚úÖ Persistencia del auth establecida en Local');\n      } catch (pErr) {\n        console.warn('No se pudo establecer la persistencia local de auth:', pErr);\n      }\n      auth.languageCode = 'es';\n      if (typeof window !== 'undefined') window.auth = auth;\n      console.log('‚úÖ Autenticaci√≥n de Firebase inicializada');\n    } catch (authError) {\n      console.error('‚ùå Error al inicializar Firebase Auth:', authError);\n      throw new Error(`Error al inicializar autenticaci√≥n: ${authError.message}`);\n    }\n\n    // Inicializar Firestore si a√∫n no existe (ya se cre√≥ de forma s√≠ncrona al importar m√≥dulo)\n    if (!db) {\n      try {\n        db = initializeFirestore(app, {\n          experimentalForceLongPolling: true,\n          cacheSizeBytes: 50 * 1024 * 1024, // ~50 MB\n          ignoreUndefinedProperties: true,\n        });\n        console.log('‚úÖ Firestore inicializado con configuraci√≥n optimizada');\n      } catch (firestoreError) {\n      // Si Firestore ya estaba inicializado (p.ej. por otro m√≥dulo), reutilizamos la instancia existente\n      if (firestoreError?.message?.includes('has already been called')) {\n        db = getFirestore(app);\n        console.warn('‚ÑπÔ∏è Firestore ya estaba inicializado, usando instancia existente');\n      } else {\n        console.error('‚ùå Error al inicializar Firestore:', firestoreError);\n        throw new Error(`Error al inicializar Firestore: ${firestoreError.message}`);\n      }\n    }\n    \n    // Habilitar persistencia offline con IndexedDB\n    try {\n      await enableIndexedDbPersistence(db);\n      console.log('Persistencia offline habilitada para Firestore');\n      if (window.mostrarNotificacion) {\n      window.mostrarNotificacion('Modo offline habilitado: puedes usar la aplicaci√≥n sin conexi√≥n', 'info');\n    }\n    } catch (err) {\n      if (err.code === 'failed-precondition') {\n        // M√∫ltiples pesta√±as abiertas, solo una puede usar persistencia\n        console.warn('La persistencia offline no est√° disponible en m√∫ltiples pesta√±as abiertas');\n      } else if (err.code === 'unimplemented') {\n        // El navegador actual no soporta todas las caracter√≠sticas necesarias\n        console.warn('Este navegador no soporta persistencia offline');\n      } else {\n        console.error('Error al habilitar persistencia offline:', err);\n      }\n    }\n    // Conectar al emulador de Firestore en desarrollo si es necesario\n    try {\n      if (typeof window !== 'undefined' && window.location.hostname === 'localhost') {\n        // Comentamos esta l√≠nea si no est√°s utilizando el emulador local\n        // connectFirestoreEmulator(db, 'localhost', 8080);\n        console.log('Modo desarrollo detectado - usando Firebase cloud');\n      }\n    } catch (emulatorError) {\n      console.warn('No se pudo configurar el emulador:', emulatorError);\n    }\n  } // fin if (!db)\n\n    // Probar la conexi√≥n con Firestore\n    try {\n      console.log('Probando conexi√≥n a Firestore...');\n      await probarConexionFirestore();\n      console.log('‚úÖ Conexi√≥n con Firestore verificada');\n      \n      // Verificar reglas de seguridad\n      try {\n        const testDoc = doc(db, '_test_connection', 'test');\n        await setDoc(testDoc, { test: new Date().toISOString() }, { merge: true });\n        console.log('‚úÖ Prueba de escritura en Firestore exitosa');\n        if (window.mostrarErrorUsuario) {\n        window.mostrarErrorUsuario(`‚úÖ Conectado a Firebase correctamente`, 3000);\n      }\n      } catch (writeError) {\n        console.error('‚ùå Error al escribir en Firestore:', writeError);\n        let errorMsg = 'Error al escribir en Firestore';\n        \n        if (writeError.code === 'permission-denied') {\n          errorMsg = 'Error de permisos: No tienes acceso a la base de datos. Verifica tu autenticaci√≥n o las reglas de seguridad.';\n          console.error('‚ùå Error de permisos en Firestore - revisa las reglas de seguridad');\n        } else if (writeError.code === 'unavailable') {\n          errorMsg = 'Servidor de Firebase no disponible. Verifica tu conexi√≥n a internet.';\n          console.error('‚ùå Error de disponibilidad - Firestore no accesible');\n        } else {\n          errorMsg = `Error al acceder a Firestore: ${writeError.message}`;\n        }\n        \n        if (window.mostrarErrorUsuario) {\n        window.mostrarErrorUsuario(errorMsg, 10000);\n      }\n      }\n    } catch (error) {\n      console.warn('‚ùå No se pudo conectar a Firestore, trabajando en modo fuera de l√≠nea:', error);\n      let errorMsg = 'Modo sin conexi√≥n - Los cambios se sincronizar√°n cuando se recupere la conexi√≥n';\n      \n      if (error.code === 'unavailable') {\n        errorMsg = 'Firebase no disponible. Verifica tu conexi√≥n a internet.';\n      } else if (error.message && error.message.includes('network')) {\n        errorMsg = 'Problemas de red al conectar con Firebase. Verificando conexi√≥n...';\n      }\n      \n      if (window.mostrarErrorUsuario) {\n        window.mostrarErrorUsuario(errorMsg, 10000);\n      }\n    }\n\n    // Inicializar Analytics solo en producci√≥n\n    if (typeof window !== 'undefined' && process.env.NODE_ENV === 'production') {\n      try {\n        const soporteAnalytics = await isSupported();\n        if (soporteAnalytics) {\n          analytics = getAnalytics(app);\n          console.log('Analytics inicializado');\n        } else {\n          console.log('Analytics no es compatible con este navegador');\n        }\n      } catch (error) {\n        console.warn('Error al inicializar Analytics:', error);\n      }\n    }\n\n    // Configurar listener de conexi√≥n\n    configurarListenerConexion();\n  } catch (error) {\n    console.error('Error al inicializar Firebase:', error);\n    if (typeof window !== 'undefined') {\n      if (window.mostrarErrorUsuario) {\n        window.mostrarErrorUsuario(\n          'Error al conectar con el servidor. La aplicaci√≥n funcionar√° en modo fuera de l√≠nea.',\n          0\n        );\n      }\n    }\n    throw error;\n  }\n};\n\n// Al importar este m√≥dulo iniciamos Firebase y exportamos la promesa\nconst firebaseReady = inicializarFirebase()\n  .catch(error => {\n    console.error('Error cr√≠tico al inicializar Firebase:', error);\n    // Propagamos error para que otros m√≥dulos puedan manejarlo\n    throw error;\n  });\n\nexport { auth, db, analytics, firebaseReady };\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useAIProviderEmail.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'generateDefaultSubject' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":15,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":65},{"ruleId":"no-unused-vars","severity":1,"message":"'generateDefaultEmailBody' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":15,"column":67,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":91}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback } from 'react';\r\nimport { useProviderEmail } from './useProviderEmail';\r\nimport EmailService from '../services/emailService';\r\nimport EmailTemplateService from '../services/EmailTemplateService';\r\n\r\n/**\r\n * Hook personalizado que integra la funcionalidad de email con la b√∫squeda AI de proveedores.\r\n * Permite enviar emails directamente desde los resultados de b√∫squeda de AI.\r\n * \r\n * @returns {Object} M√©todos y propiedades para el env√≠o de emails desde la b√∫squeda AI\r\n */\r\nexport const useAIProviderEmail = () => {\r\n  const [isSending, setIsSending] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const { userEmail, sendEmailToProvider, generateDefaultSubject, generateDefaultEmailBody } = useProviderEmail();\r\n  \r\n  /**\r\n   * Genera un asunto personalizado basado en el resultado de la b√∫squeda AI\r\n   * @param {Object} aiResult Resultado de b√∫squeda AI\r\n   * @returns {string} Asunto personalizado para el email\r\n   */\r\n  const generateAISubject = useCallback((aiResult) => {\r\n    if (!aiResult) return '';\r\n    \r\n    const templateService = new EmailTemplateService();\r\n    \r\n    // Datos para la plantilla\r\n    const templateData = {\r\n      providerName: aiResult.name,\r\n      date: new Date().toLocaleDateString('es-ES', {\r\n        year: 'numeric',\r\n        month: 'long',\r\n        day: 'numeric'\r\n      }),\r\n      userName: userEmail ? userEmail.split('@')[0] : 'Usuario',\r\n      guests: '100' // Valor por defecto\r\n    };\r\n    \r\n    // Generar asunto personalizado usando plantilla seg√∫n categor√≠a\r\n    return templateService.generateSubjectFromTemplate(\r\n      aiResult.service,\r\n      templateData\r\n    );\r\n  }, [userEmail]);\r\n  \r\n  /**\r\n   * Genera un cuerpo de email personalizado basado en el resultado de la b√∫squeda AI\r\n   * @param {Object} aiResult Resultado de b√∫squeda AI\r\n   * @param {string} searchQuery Consulta original realizada por el usuario\r\n   * @returns {string} Cuerpo de email personalizado con informaci√≥n de la b√∫squeda\r\n   */\r\n  const generateAIEmailBody = useCallback((aiResult, searchQuery) => {\r\n    if (!aiResult) return '';\r\n    \r\n    const templateService = new EmailTemplateService();\r\n    \r\n    // Construir el insight de AI si existe\r\n    const aiInsight = aiResult.aiSummary \r\n      ? `${aiResult.aiSummary}` \r\n      : '';\r\n    \r\n    // Datos para la plantilla\r\n    const templateData = {\r\n      providerName: aiResult.name,\r\n      searchQuery: searchQuery || 'servicios de calidad',\r\n      aiInsight,\r\n      date: new Date().toLocaleDateString('es-ES', {\r\n        year: 'numeric',\r\n        month: 'long',\r\n        day: 'numeric'\r\n      }),\r\n      price: aiResult.price || '',\r\n      location: aiResult.location || '',\r\n      userName: userEmail ? userEmail.split('@')[0] : 'Usuario',\r\n      guests: '100' // Valor por defecto\r\n    };\r\n    \r\n    // Generar cuerpo de email utilizando plantilla seg√∫n categor√≠a\r\n    return templateService.generateBodyFromTemplate(\r\n      aiResult.service,\r\n      templateData\r\n    );\r\n  }, [userEmail]);\r\n  \r\n  /**\r\n   * Env√≠a un email al proveedor desde los resultados de la b√∫squeda AI\r\n   * @param {Object} aiResult Resultado de b√∫squeda AI\r\n   * @param {string} searchQuery Consulta original de b√∫squeda\r\n   * @param {Object} options Opciones adicionales (asunto y cuerpo personalizados)\r\n   * @returns {Promise<boolean>} Promesa que resuelve a true si el env√≠o fue exitoso\r\n   */\r\n  const sendEmailFromAIResult = useCallback(async (aiResult, searchQuery, options = {}) => {\r\n    if (!aiResult || !aiResult.name) {\r\n      setError('Informaci√≥n de proveedor incompleta');\r\n      return false;\r\n    }\r\n    \r\n    setIsSending(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      // Crear un objeto de proveedor compatible con el sistema de email existente\r\n      const providerObj = {\r\n        id: aiResult.id,\r\n        name: aiResult.name,\r\n        email: aiResult.email || `${aiResult.name.toLowerCase().replace(/\\s+/g, '.')}@proveedor.com`,\r\n        service: aiResult.service,\r\n        location: aiResult.location\r\n      };\r\n      \r\n      // Usar asunto y cuerpo personalizados o generarlos\r\n      const subject = options.subject || generateAISubject(aiResult);\r\n      const body = options.body || generateAIEmailBody(aiResult, searchQuery);\r\n      \r\n      // Registrar actividad de AI para an√°lisis\r\n      const emailService = new EmailService();\r\n      emailService.logAIEmailActivity(aiResult.id, searchQuery);\r\n      \r\n      // Registrar el uso de la plantilla para an√°lisis\r\n      const templateService = new EmailTemplateService();\r\n      const isCustomized = options.subject || options.body;\r\n      templateService.logTemplateUsage(aiResult.service, aiResult, isCustomized);\r\n      \r\n      // Enviar el email usando la funci√≥n existente\r\n      const result = await sendEmailToProvider(providerObj, subject, body);\r\n      \r\n      return result;\r\n    } catch (err) {\r\n      setError(err.message || 'Error al enviar email');\r\n      return false;\r\n    } finally {\r\n      setIsSending(false);\r\n    }\r\n  }, [sendEmailToProvider, generateAISubject, generateAIEmailBody]);\r\n  \r\n  return {\r\n    userEmail,\r\n    isSending,\r\n    error,\r\n    sendEmailFromAIResult,\r\n    generateAISubject,\r\n    generateAIEmailBody\r\n  };\r\n};\r\n\r\nexport default useAIProviderEmail;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useAISearch.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useAuth.jsx","messages":[{"ruleId":"no-undef","severity":2,"message":"'setUserProfile' is not defined.","line":290,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":290,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Hook centralizado para la autenticaci√≥n en Lovenda\n * Este hook proporciona funcionalidades de autenticaci√≥n y gesti√≥n de perfil de usuario\n */\n\nimport { useState, useEffect, createContext, useContext, useCallback } from 'react';\nimport { initReminderService, stopReminderService } from '../services/reminderService';\nimport errorLogger from '../utils/errorLogger';\nimport { setAuthContext as registerEmailAuthContext } from '../services/emailService';\nimport { setAuthContext as registerNotificationAuthContext } from '../services/notificationService';\nimport { auth } from '../firebaseConfig';\nimport { onAuthStateChanged, signInWithEmailAndPassword, signOut, createUserWithEmailAndPassword } from 'firebase/auth';\n\n// Crear contexto de autenticaci√≥n\nconst AuthContext = createContext(null);\n\n/**\n * Proveedor del contexto de autenticaci√≥n\n * @param {Object} props - Propiedades del componente\n * @param {React.ReactNode} props.children - Componentes hijo\n */\nexport const AuthProvider = ({ children }) => {\n  const [currentUser, setCurrentUser] = useState(null);\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  // Integrar con Firebase Auth real\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, (firebaseUser) => {\n      console.log('[useAuth] Firebase auth state changed:', firebaseUser?.email || 'No user');\n      \n      if (firebaseUser) {\n        // Usuario autenticado en Firebase\n        const user = {\n          uid: firebaseUser.uid,\n          email: firebaseUser.email,\n          displayName: firebaseUser.displayName || firebaseUser.email?.split('@')[0]\n        };\n        console.log('[useAuth] Usuario autenticado:', user.uid);\n        setCurrentUser(user);\n        \n        // Crear o cargar perfil\n        const savedProfile = localStorage.getItem('lovenda_user_profile');\n        let profile;\n        \n        if (savedProfile) {\n          profile = JSON.parse(savedProfile);\n        } else {\n          profile = {\n            id: user.uid,\n            name: user.displayName || 'Usuario',\n            email: user.email,\n            preferences: {\n              emailNotifications: true,\n              emailSignature: 'Enviado desde MyWed360',\n              theme: 'light',\n              remindersEnabled: true,\n              reminderDays: 3\n            }\n          };\n        }\n        \n        // Generar myWed360Email si no existe\n        if (!profile.myWed360Email && user.email) {\n          const loginPrefix = user.email.split('@')[0].slice(0,4).toLowerCase();\n          profile.myWed360Email = `${loginPrefix}@mywed360.com`;\n        }\n        \n        setUserProfile(profile);\n        localStorage.setItem('lovenda_user_profile', JSON.stringify(profile));\n      } else {\n        // No hay usuario autenticado\n        console.log('[useAuth] No hay usuario Firebase autenticado');\n        setCurrentUser(null);\n        setUserProfile(null);\n      }\n      \n      setLoading(false);\n    });\n    \n    return () => unsubscribe();\n  }, []);\n\n  // Actualizar diagn√≥stico de autenticaci√≥n\n  useEffect(() => {\n    if (loading) return;\n    if (currentUser) {\n      errorLogger.setAuthInfo({ uid: currentUser.uid, email: currentUser.email, profile: userProfile });\n    } else {\n      errorLogger.setAuthInfo(null);\n    }\n  }, [loading, currentUser, userProfile]);\n\n  // Iniciar o detener el servicio de recordatorios cuando cambie el perfil\n  useEffect(() => {\n    if (loading) return;\n    if (!userProfile) return;\n    const { remindersEnabled = true, reminderDays = 3 } = userProfile.preferences || {};\n    if (remindersEnabled) {\n      initReminderService({ days: reminderDays, enabled: true });\n    } else {\n      stopReminderService();\n    }\n    return () => stopReminderService();\n  }, [loading, userProfile]);\n  \n  /**\n   * Iniciar sesi√≥n con email y contrase√±a\n   * @param {string} email - Email del usuario\n   * @param {string} password - Contrase√±a\n   * @returns {Promise<Object>} Resultado del inicio de sesi√≥n\n   */\n  // -----------------------------\n  // LOGIN\n  // -----------------------------\n  const login = async (email, password) => {\n    try {\n      // Usar Firebase Auth real en lugar de mock\n      const userCredential = await signInWithEmailAndPassword(auth, email, password);\n      const user = userCredential.user;\n      \n      console.log('[useAuth] Login exitoso con Firebase Auth:', user.uid);\n      \n      // El estado se actualiza autom√°ticamente por onAuthStateChanged\n      // No necesitamos setCurrentUser aqu√≠\n      \n      // Crear perfil por defecto si no existe\n      if (!userProfile) {\n        const defaultProfile = {\n          id: user.uid,\n          name: user.displayName || 'Usuario Lovenda',\n          email: user.email,\n          preferences: {\n            emailNotifications: true,\n            emailSignature: 'Enviado desde Lovenda',\n            theme: 'light',\n            remindersEnabled: true,\n            reminderDays: 3\n          }\n        };\n        setUserProfile(defaultProfile);\n        localStorage.setItem('lovenda_user_profile', JSON.stringify(defaultProfile));\n      }\n      \n      return { success: true, user };\n    } catch (error) {\n      console.error('Error al iniciar sesi√≥n:', error);\n      return { success: false, error: error.message };\n    }\n  };\n\n  /**\n   * Obtener token de autenticaci√≥n\n   * @param {boolean} forceRefresh - Forzar actualizaci√≥n del token\n   * @returns {Promise<string>} Token de autenticaci√≥n\n   */\n  const getIdToken = useCallback(async (forceRefresh = false) => {\n    try {\n      if (!currentUser) {\n        throw new Error('No hay usuario autenticado');\n      }\n\n      // Para usuarios mock/test, generar token compatible\n      if (currentUser.uid === 'cypress-test' || currentUser.uid.startsWith('mock-')) {\n        const mockToken = `mock-${currentUser.uid}-${currentUser.email}`;\n        console.log(' Token mock generado para:', currentUser.email);\n        return mockToken;\n      }\n\n      // Para usuarios reales de Firebase\n      if (currentUser.getIdToken) {\n        const token = await currentUser.getIdToken(forceRefresh);\n        console.log(' Token Firebase obtenido');\n        return token;\n      }\n\n      // Fallback: generar token mock si no hay m√©todo getIdToken\n      const fallbackToken = `mock-${currentUser.uid}-${currentUser.email}`;\n      console.log(' Token fallback generado para:', currentUser.email);\n      return fallbackToken;\n    } catch (error) {\n      console.error('Error obteniendo token:', error);\n      throw error;\n    }\n  }, [currentUser]);\n\n  /**\n   * Cerrar sesi√≥n\n   * @returns {Promise<Object>} Resultado del cierre de sesi√≥n\n   */\n  const logout = useCallback(async () => {\n    try {\n      await signOut(auth);\n      // El estado se limpia autom√°ticamente por onAuthStateChanged\n      localStorage.removeItem('lovenda_user_profile');\n      console.log('‚úÖ Sesi√≥n cerrada correctamente');\n    } catch (error) {\n      console.error('Error al cerrar sesi√≥n:', error);\n      throw error;\n    }\n  }, []);\n\n  /**\n   * Actualizar el perfil del usuario\n   * @param {Object} profileData - Datos del perfil a actualizar\n   * @returns {Promise<Object>} Resultado de la actualizaci√≥n\n   */\n  const updateUserProfile = async (profileData) => {\n    try {\n      const updatedProfile = { ...userProfile, ...profileData };\n      setUserProfile(updatedProfile);\n      localStorage.setItem('lovenda_user_profile', JSON.stringify(updatedProfile));\n      return { success: true, profile: updatedProfile };\n    } catch (error) {\n      console.error('Error al actualizar perfil:', error);\n      return { success: false, error: error.message };\n    }\n  };\n\n  // Derivar estado de autenticaci√≥n y alias legibles\n  const isAuthenticated = !!currentUser;\n  const isLoading = loading;\n\n  // Valor del contexto que se proveer√° a los componentes\n  const value = {\n    currentUser,\n    user: currentUser, // alias de compatibilidad\n    userProfile,\n    loading: isLoading,\n    isLoading,\n    isAuthenticated,\n    login,\n    logout,\n    register,\n    getIdToken,\n    updateUserProfile,\n  };\n\n  // Registrar el contexto en emailService para que pueda obtener el token\n  useEffect(() => {\n    registerEmailAuthContext({\n      currentUser,\n      getIdToken,\n    });\n    // Registrar tambi√©n en notificationService\n    registerNotificationAuthContext({\n      currentUser,\n      getIdToken,\n    });\n  }, [currentUser, getIdToken]);\n\n  return (\n    <AuthContext.Provider value={value}>\n      {!loading && children}\n    </AuthContext.Provider>\n  );\n};\n\n/**\n * Hook personalizado para acceder al contexto de autenticaci√≥n\n * @returns {Object} El contexto de autenticaci√≥n\n */\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (context === null) {\n    throw new Error('useAuth debe utilizarse dentro de un AuthProvider');\n  }\n  return context;\n};\n\n// -----------------------------\n  // REGISTER / SIGNUP\n  // -----------------------------\n  const register = async (email, password, role = 'particular') => {\n    try {\n      const userCredential = await createUserWithEmailAndPassword(auth, email, password);\n      const user = userCredential.user;\n      console.log('[useAuth] Registro exitoso:', user.uid);\n      // Generar perfil inicial\n      const profile = {\n        id: user.uid,\n        name: email.split('@')[0],\n        email: user.email,\n        role,\n        preferences: {\n          emailNotifications: true,\n          theme: 'light'\n        }\n      };\n      setUserProfile(profile);\n      localStorage.setItem('lovenda_user_profile', JSON.stringify(profile));\n      return { success: true, user };\n    } catch (error) {\n      console.error('Error al registrar usuario:', error);\n      return { success: false, error: error.message };\n    }\n  };\n\n  // -----------------------------\n  // CONTEXTO DE RETORNO\n  // -----------------------------\nexport default useAuth;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useAuthUnified.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useAuthUnified.jsx","messages":[{"ruleId":null,"fatal":true,"severity":2,"message":"Parsing error: Duplicate export 'AuthProvider'","line":39,"column":14,"nodeType":null}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * DEPRECATED: Este archivo existe solo para compatibilidad. Reexporta useAuth y AuthProvider desde useAuth.jsx para MyWed360\r\n * Reemplaza y unifica UserContext.jsx y useAuth.jsx\r\n * Integra el servicio authService.js para funcionalidad avanzada\r\n */\r\n\r\n// Stub: reexportar useAuth y AuthProvider\r\nexport { useAuth as default, useAuth, AuthProvider } from './useAuth';\r\n\r\nimport authService, { AuthError } from '../services/authService';\r\n\r\n// Contexto de autenticaci√≥n\r\nconst AuthContext = createContext({\r\n  // Estado\r\n  currentUser: null,\r\n  userProfile: null,\r\n  isAuthenticated: false,\r\n  isLoading: true,\r\n  error: null,\r\n  \r\n  // Acciones\r\n  login: async () => {},\r\n  register: async () => {},\r\n  logout: async () => {},\r\n  updateProfile: async () => {},\r\n  reauthenticate: async () => {},\r\n  sendPasswordReset: async () => {},\r\n  clearError: () => {},\r\n  \r\n  // Utilidades\r\n  hasRole: () => false,\r\n  hasPermission: () => false,\r\n  isEmailVerified: () => false\r\n});\r\n\r\n/**\r\n * Proveedor de autenticaci√≥n unificado\r\n */\r\nexport const AuthProvider = ({ children }) => {\r\n  // Estados principales\r\n  const [currentUser, setCurrentUser] = useState(null);\r\n  const [userProfile, setUserProfile] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  // Estados derivados\r\n  const isAuthenticated = !!currentUser;\r\n  const isEmailVerified = currentUser?.emailVerified || false;\r\n\r\n  /**\r\n   * Maneja errores de autenticaci√≥n\r\n   */\r\n  const handleAuthError = useCallback((error) => {\r\n    console.error('[useAuthUnified] Error:', error);\r\n    \r\n    if (error instanceof AuthError) {\r\n      setError({\r\n        code: error.code,\r\n        message: error.message,\r\n        type: 'auth'\r\n      });\r\n    } else {\r\n      setError({\r\n        code: 'unknown',\r\n        message: error.message || 'Error desconocido',\r\n        type: 'general'\r\n      });\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   * Limpia el error actual\r\n   */\r\n  const clearError = useCallback(() => {\r\n    setError(null);\r\n  }, []);\r\n\r\n  /**\r\n   * Actualiza los datos del usuario\r\n   */\r\n  const updateUserData = useCallback((userData) => {\r\n    if (userData) {\r\n      setCurrentUser(userData);\r\n      setUserProfile({\r\n        uid: userData.uid,\r\n        email: userData.email,\r\n        displayName: userData.displayName,\r\n        photoURL: userData.photoURL,\r\n        role: userData.role || 'particular',\r\n        preferences: userData.preferences || {},\r\n        emailVerified: userData.emailVerified,\r\n        createdAt: userData.createdAt,\r\n        lastLogin: userData.lastLogin\r\n      });\r\n    } else {\r\n      setCurrentUser(null);\r\n      setUserProfile(null);\r\n    }\r\n    setIsLoading(false);\r\n  }, []);\r\n\r\n  /**\r\n   * Iniciar sesi√≥n\r\n   */\r\n  const login = useCallback(async (email, password, rememberMe = true) => {\r\n    try {\r\n      setIsLoading(true);\r\n      setError(null);\r\n      \r\n      const userData = await authService.login(email, password, rememberMe);\r\n      updateUserData(userData);\r\n      \r\n      return { success: true, user: userData };\r\n    } catch (error) {\r\n      handleAuthError(error);\r\n      return { success: false, error };\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [updateUserData, handleAuthError]);\r\n\r\n  /**\r\n   * Registrar nuevo usuario\r\n   */\r\n  const register = useCallback(async (email, password, additionalData = {}) => {\r\n    try {\r\n      setIsLoading(true);\r\n      setError(null);\r\n      \r\n      const userData = await authService.register(email, password, additionalData);\r\n      updateUserData(userData);\r\n      \r\n      return { success: true, user: userData };\r\n    } catch (error) {\r\n      handleAuthError(error);\r\n      return { success: false, error };\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [updateUserData, handleAuthError]);\r\n\r\n  /**\r\n   * Cerrar sesi√≥n\r\n   */\r\n  const logout = useCallback(async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      setError(null);\r\n      \r\n      await authService.logout();\r\n      updateUserData(null);\r\n      \r\n      return { success: true };\r\n    } catch (error) {\r\n      handleAuthError(error);\r\n      return { success: false, error };\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [updateUserData, handleAuthError]);\r\n\r\n  /**\r\n   * Actualizar perfil del usuario\r\n   */\r\n  const updateProfile = useCallback(async (updates) => {\r\n    try {\r\n      setError(null);\r\n      \r\n      const updatedUser = await authService.updateUserProfile(updates);\r\n      updateUserData(updatedUser);\r\n      \r\n      return { success: true, user: updatedUser };\r\n    } catch (error) {\r\n      handleAuthError(error);\r\n      return { success: false, error };\r\n    }\r\n  }, [updateUserData, handleAuthError]);\r\n\r\n  /**\r\n   * Reautenticar usuario\r\n   */\r\n  const reauthenticate = useCallback(async (password) => {\r\n    try {\r\n      setError(null);\r\n      \r\n      await authService.reauthenticate(password);\r\n      \r\n      return { success: true };\r\n    } catch (error) {\r\n      handleAuthError(error);\r\n      return { success: false, error };\r\n    }\r\n  }, [handleAuthError]);\r\n\r\n  /**\r\n   * Enviar email de restablecimiento de contrase√±a\r\n   */\r\n  const sendPasswordReset = useCallback(async (email) => {\r\n    try {\r\n      setError(null);\r\n      \r\n      await authService.sendPasswordReset(email);\r\n      \r\n      return { success: true };\r\n    } catch (error) {\r\n      handleAuthError(error);\r\n      return { success: false, error };\r\n    }\r\n  }, [handleAuthError]);\r\n\r\n  /**\r\n   * Verificar si el usuario tiene un rol espec√≠fico\r\n   */\r\n  const hasRole = useCallback((role) => {\r\n    if (!userProfile) return false;\r\n    \r\n    const userRole = userProfile.role?.toLowerCase();\r\n    const targetRole = role.toLowerCase();\r\n    \r\n    // Mapeo de roles para compatibilidad\r\n    const roleHierarchy = {\r\n      'admin': ['admin', 'planner', 'particular'],\r\n      'planner': ['planner', 'particular'],\r\n      'particular': ['particular']\r\n    };\r\n    \r\n    return roleHierarchy[userRole]?.includes(targetRole) || false;\r\n  }, [userProfile]);\r\n\r\n  /**\r\n   * Verificar si el usuario tiene un permiso espec√≠fico\r\n   */\r\n  const hasPermission = useCallback((permission) => {\r\n    if (!userProfile) return false;\r\n    \r\n    const role = userProfile.role?.toLowerCase();\r\n    \r\n    // Definir permisos por rol\r\n    const permissions = {\r\n      'admin': ['*'], // Todos los permisos\r\n      'planner': [\r\n        'manage_weddings',\r\n        'view_analytics',\r\n        'manage_tasks',\r\n        'manage_guests',\r\n        'manage_vendors'\r\n      ],\r\n      'particular': [\r\n        'manage_own_wedding',\r\n        'manage_own_tasks',\r\n        'manage_own_guests',\r\n        'view_own_analytics'\r\n      ]\r\n    };\r\n    \r\n    const userPermissions = permissions[role] || [];\r\n    return userPermissions.includes('*') || userPermissions.includes(permission);\r\n  }, [userProfile]);\r\n\r\n  /**\r\n   * Efecto para suscribirse a cambios de autenticaci√≥n\r\n   */\r\n  useEffect(() => {\r\n    const unsubscribe = authService.onAuthStateChange((userData) => {\r\n      updateUserData(userData);\r\n    });\r\n\r\n    return unsubscribe;\r\n  }, [updateUserData]);\r\n\r\n  /**\r\n   * Efecto para manejar compatibilidad con tests E2E\r\n   */\r\n  useEffect(() => {\r\n    // Soporte para Cypress y tests E2E\r\n    const testEmail = localStorage.getItem('userEmail');\r\n    const isLoggedIn = localStorage.getItem('isLoggedIn');\r\n    \r\n    if (isLoggedIn === 'true' && testEmail && !currentUser) {\r\n      const mockUser = {\r\n        uid: 'cypress-test',\r\n        email: testEmail,\r\n        displayName: testEmail.split('@')[0],\r\n        role: 'particular',\r\n        emailVerified: true,\r\n        preferences: {}\r\n      };\r\n      \r\n      updateUserData(mockUser);\r\n    }\r\n  }, [currentUser, updateUserData]);\r\n\r\n  // Valor del contexto\r\n  const contextValue = {\r\n    // Estado\r\n    currentUser,\r\n    userProfile,\r\n    isAuthenticated,\r\n    isLoading,\r\n    error,\r\n    \r\n    // Acciones\r\n    login,\r\n    register,\r\n    logout,\r\n    updateProfile,\r\n    reauthenticate,\r\n    sendPasswordReset,\r\n    clearError,\r\n    \r\n    // Utilidades\r\n    hasRole,\r\n    hasPermission,\r\n    isEmailVerified: () => isEmailVerified,\r\n    \r\n    // Compatibilidad con c√≥digo existente\r\n    user: currentUser,\r\n    loading: isLoading,\r\n    role: userProfile?.role || null\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={contextValue}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\n/**\r\n * Hook para usar el contexto de autenticaci√≥n\r\n */\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  \r\n  if (!context) {\r\n    throw new Error('useAuth debe ser usado dentro de un AuthProvider');\r\n  }\r\n  \r\n  return context;\r\n};\r\n\r\n/**\r\n * HOC para proteger rutas que requieren autenticaci√≥n\r\n */\r\nexport const withAuth = (Component, options = {}) => {\r\n  const { \r\n    requireAuth = true, \r\n    requireRole = null, \r\n    requirePermission = null,\r\n    redirectTo = '/login' \r\n  } = options;\r\n\r\n  return function AuthenticatedComponent(props) {\r\n    const { isAuthenticated, hasRole, hasPermission, isLoading } = useAuth();\r\n    const navigate = useNavigate();\r\n\r\n    useEffect(() => {\r\n      if (isLoading) return;\r\n\r\n      if (requireAuth && !isAuthenticated) {\r\n        navigate(redirectTo);\r\n        return;\r\n      }\r\n\r\n      if (requireRole && !hasRole(requireRole)) {\r\n        navigate('/unauthorized');\r\n        return;\r\n      }\r\n\r\n      if (requirePermission && !hasPermission(requirePermission)) {\r\n        navigate('/unauthorized');\r\n        return;\r\n      }\r\n    }, [isAuthenticated, isLoading, navigate]);\r\n\r\n    if (isLoading) {\r\n      return <div className=\"flex justify-center items-center h-64\">Cargando...</div>;\r\n    }\r\n\r\n    if (requireAuth && !isAuthenticated) {\r\n      return null;\r\n    }\r\n\r\n    return <Component {...props} />;\r\n  };\r\n};\r\n\r\n/**\r\n * Hook para obtener informaci√≥n del usuario actual\r\n */\r\nexport const useCurrentUser = () => {\r\n  const { currentUser, userProfile, isAuthenticated } = useAuth();\r\n  \r\n  return {\r\n    user: currentUser,\r\n    profile: userProfile,\r\n    isAuthenticated,\r\n    // Propiedades de acceso r√°pido\r\n    uid: currentUser?.uid,\r\n    email: currentUser?.email,\r\n    displayName: userProfile?.displayName,\r\n    role: userProfile?.role,\r\n    preferences: userProfile?.preferences || {}\r\n  };\r\n};\r\n\r\n/**\r\n * Hook para manejar errores de autenticaci√≥n\r\n */\r\nexport const useAuthError = () => {\r\n  const { error, clearError } = useAuth();\r\n  \r\n  const getErrorMessage = useCallback((errorCode) => {\r\n    const errorMessages = {\r\n      'auth/user-not-found': 'Usuario no encontrado',\r\n      'auth/wrong-password': 'Contrase√±a incorrecta',\r\n      'auth/invalid-email': 'Email inv√°lido',\r\n      'auth/user-disabled': 'Usuario deshabilitado',\r\n      'auth/too-many-requests': 'Demasiados intentos. Intenta m√°s tarde',\r\n      'auth/email-already-in-use': 'El email ya est√° en uso',\r\n      'auth/weak-password': 'La contrase√±a es muy d√©bil',\r\n      'token-refresh-failed': 'Error al refrescar la sesi√≥n',\r\n      'session-expired': 'Sesi√≥n expirada',\r\n      'profile-update-failed': 'Error al actualizar el perfil'\r\n    };\r\n    \r\n    return errorMessages[errorCode] || 'Error desconocido';\r\n  }, []);\r\n  \r\n  return {\r\n    error,\r\n    clearError,\r\n    getErrorMessage,\r\n    hasError: !!error\r\n  };\r\n};\r\n\r\n// Exportaciones para compatibilidad\r\nexport default useAuth;\r\nexport { AuthContext };\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useCalendarSync.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'user' is not defined.","line":22,"column":12,"nodeType":"Identifier","messageId":"undef","endLine":22,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'user' is not defined.","line":25,"column":53,"nodeType":"Identifier","messageId":"undef","endLine":25,"endColumn":57},{"ruleId":"no-undef","severity":2,"message":"'user' is not defined.","line":117,"column":10,"nodeType":"Identifier","messageId":"undef","endLine":117,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'user' is not defined.","line":126,"column":51,"nodeType":"Identifier","messageId":"undef","endLine":126,"endColumn":55},{"ruleId":"no-undef","severity":2,"message":"'user' is not defined.","line":130,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":130,"endColumn":21},{"ruleId":"no-undef","severity":2,"message":"'user' is not defined.","line":149,"column":10,"nodeType":"Identifier","messageId":"undef","endLine":149,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'user' is not defined.","line":167,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":167,"endColumn":35},{"ruleId":"no-undef","severity":2,"message":"'user' is not defined.","line":173,"column":33,"nodeType":"Identifier","messageId":"undef","endLine":173,"endColumn":37},{"ruleId":"no-undef","severity":2,"message":"'user' is not defined.","line":192,"column":51,"nodeType":"Identifier","messageId":"undef","endLine":192,"endColumn":55},{"ruleId":"no-undef","severity":2,"message":"'user' is not defined.","line":215,"column":10,"nodeType":"Identifier","messageId":"undef","endLine":215,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'user' is not defined.","line":250,"column":51,"nodeType":"Identifier","messageId":"undef","endLine":250,"endColumn":55},{"ruleId":"no-undef","severity":2,"message":"'user' is not defined.","line":272,"column":10,"nodeType":"Identifier","messageId":"undef","endLine":272,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'user' is not defined.","line":287,"column":73,"nodeType":"Identifier","messageId":"undef","endLine":287,"endColumn":77},{"ruleId":"no-undef","severity":2,"message":"'user' is not defined.","line":297,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":297,"endColumn":35},{"ruleId":"no-undef","severity":2,"message":"'user' is not defined.","line":333,"column":51,"nodeType":"Identifier","messageId":"undef","endLine":333,"endColumn":55}],"suppressedMessages":[],"errorCount":15,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { googleCalendarService } from '../services/GoogleCalendarService';\r\nimport { collection, doc, setDoc, getDoc, updateDoc, query, where, getDocs } from 'firebase/firestore';\r\nimport { db } from '../firebaseConfig';\r\nimport { useAuth } from './useAuthUnified';\r\n\r\n/**\r\n * Hook personalizado para gestionar la sincronizaci√≥n bidireccional con Google Calendar\r\n * @returns {Object} - Objeto con m√©todos y estado de sincronizaci√≥n\r\n */\r\nexport const useCalendarSync = () => {\r\n  const { currentUser } = useAuth();\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [syncedCalendars, setSyncedCalendars] = useState([]);\r\n  const [lastSync, setLastSync] = useState(null);\r\n  const [error, setError] = useState(null);\r\n\r\n  // Cargar el estado de sincronizaci√≥n del usuario\r\n  useEffect(() => {\r\n    const loadSyncStatus = async () => {\r\n      if (!user?.uid) return;\r\n\r\n      try {\r\n        const userSyncRef = doc(db, 'calendarSync', user.uid);\r\n        const syncDoc = await getDoc(userSyncRef);\r\n        \r\n        if (syncDoc.exists()) {\r\n          const syncData = syncDoc.data();\r\n          setSyncedCalendars(syncData.syncedCalendars || []);\r\n          setLastSync(syncData.lastSync ? new Date(syncData.lastSync) : null);\r\n        }\r\n      } catch (err) {\r\n        console.error('Error al cargar estado de sincronizaci√≥n:', err);\r\n        setError('Error al cargar configuraci√≥n de sincronizaci√≥n');\r\n      }\r\n    };\r\n\r\n    loadSyncStatus();\r\n  }, [currentUser]);\r\n\r\n  // Inicializar Google Calendar API\r\n  useEffect(() => {\r\n    const initGoogleCalendar = async () => {\r\n      try {\r\n        await googleCalendarService.loadClient();\r\n        setIsAuthenticated(googleCalendarService.isAuthenticated());\r\n      } catch (err) {\r\n        console.error('Error al inicializar Google Calendar:', err);\r\n        setError('Error al inicializar la conexi√≥n con Google Calendar');\r\n      }\r\n    };\r\n\r\n    initGoogleCalendar();\r\n  }, []);\r\n\r\n  /**\r\n   * Autenticarse con Google Calendar\r\n   */\r\n  const authenticate = async () => {\r\n    setIsLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      await googleCalendarService.signIn();\r\n      setIsAuthenticated(googleCalendarService.isAuthenticated());\r\n    } catch (err) {\r\n      console.error('Error de autenticaci√≥n con Google Calendar:', err);\r\n      setError('Error al iniciar sesi√≥n con Google Calendar');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Cerrar sesi√≥n de Google Calendar\r\n   */\r\n  const logout = async () => {\r\n    setIsLoading(true);\r\n    \r\n    try {\r\n      await googleCalendarService.signOut();\r\n      setIsAuthenticated(false);\r\n    } catch (err) {\r\n      console.error('Error al cerrar sesi√≥n de Google Calendar:', err);\r\n      setError('Error al cerrar sesi√≥n');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Obtiene los calendarios disponibles del usuario en Google Calendar\r\n   * @returns {Promise<Array>} - Lista de calendarios\r\n   */\r\n  const getAvailableCalendars = async () => {\r\n    setIsLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      const calendars = await googleCalendarService.getCalendars();\r\n      setIsLoading(false);\r\n      return calendars;\r\n    } catch (err) {\r\n      console.error('Error al obtener calendarios:', err);\r\n      setError('Error al obtener tus calendarios de Google');\r\n      setIsLoading(false);\r\n      return [];\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Guarda la configuraci√≥n de sincronizaci√≥n del usuario\r\n   * @param {Array} calendars - Calendarios seleccionados para sincronizar\r\n   */\r\n  const saveCalendarSyncConfig = async (calendars) => {\r\n    if (!user?.uid) {\r\n      setError('Debes iniciar sesi√≥n para sincronizar calendarios');\r\n      return;\r\n    }\r\n    \r\n    setIsLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      const userSyncRef = doc(db, 'calendarSync', user.uid);\r\n      await setDoc(userSyncRef, {\r\n        syncedCalendars: calendars,\r\n        lastSync: new Date().toISOString(),\r\n        userId: user.uid\r\n      }, { merge: true });\r\n      \r\n      setSyncedCalendars(calendars);\r\n      setLastSync(new Date());\r\n    } catch (err) {\r\n      console.error('Error al guardar configuraci√≥n de sincronizaci√≥n:', err);\r\n      setError('Error al guardar configuraci√≥n de sincronizaci√≥n');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Importa eventos de Google Calendar a Lovenda\r\n   * @param {string} calendarId - ID del calendario a importar\r\n   * @returns {Promise<Array>} - Lista de eventos importados\r\n   */\r\n  const importEventsFromGoogle = async (calendarId = 'primary') => {\r\n    if (!user?.uid) {\r\n      setError('Debes iniciar sesi√≥n para sincronizar eventos');\r\n      return [];\r\n    }\r\n    \r\n    setIsLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      // Obtener eventos de Google Calendar\r\n      const googleEvents = await googleCalendarService.getEvents(calendarId);\r\n      \r\n      // Transformar a formato Lovenda y guardar en Firestore\r\n      const eventsRef = collection(db, 'tasks');\r\n      const importedEvents = [];\r\n      \r\n      for (const googleEvent of googleEvents) {\r\n        const lovendaEvent = googleCalendarService.transformToLovendaEvent(googleEvent);\r\n        lovendaEvent.userId = user.uid;\r\n        lovendaEvent.synced = true;\r\n        lovendaEvent.source = 'google';\r\n        \r\n        // Verificar si ya existe por googleEventId\r\n        const existingQuery = query(eventsRef, \r\n          where('userId', '==', user.uid),\r\n          where('googleEventId', '==', googleEvent.id)\r\n        );\r\n        \r\n        const existingEvents = await getDocs(existingQuery);\r\n        \r\n        if (existingEvents.empty) {\r\n          // Nuevo evento - crear\r\n          await setDoc(doc(eventsRef), lovendaEvent);\r\n        } else {\r\n          // Evento existente - actualizar\r\n          const existingEvent = existingEvents.docs[0];\r\n          await updateDoc(existingEvent.ref, lovendaEvent);\r\n        }\r\n        \r\n        importedEvents.push(lovendaEvent);\r\n      }\r\n      \r\n      // Actualizar fecha de √∫ltima sincronizaci√≥n\r\n      const userSyncRef = doc(db, 'calendarSync', user.uid);\r\n      await updateDoc(userSyncRef, {\r\n        lastSync: new Date().toISOString()\r\n      });\r\n      \r\n      setLastSync(new Date());\r\n      setIsLoading(false);\r\n      return importedEvents;\r\n    } catch (err) {\r\n      console.error('Error al importar eventos de Google Calendar:', err);\r\n      setError('Error al importar eventos de Google Calendar');\r\n      setIsLoading(false);\r\n      return [];\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Exporta eventos de Lovenda a Google Calendar\r\n   * @param {Array} events - Eventos a exportar\r\n   * @param {string} calendarId - ID del calendario destino\r\n   * @returns {Promise<Array>} - Lista de eventos exportados\r\n   */\r\n  const exportEventsToGoogle = async (events, calendarId = 'primary') => {\r\n    if (!user?.uid) {\r\n      setError('Debes iniciar sesi√≥n para sincronizar eventos');\r\n      return [];\r\n    }\r\n    \r\n    setIsLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      const exportedEvents = [];\r\n      const eventsRef = collection(db, 'tasks');\r\n      \r\n      for (const event of events) {\r\n        // Si el evento ya tiene ID de Google, actualizar\r\n        if (event.googleEventId) {\r\n          const updatedEvent = await googleCalendarService.updateEvent(event, calendarId);\r\n          exportedEvents.push(updatedEvent);\r\n        } else {\r\n          // Si no tiene ID de Google, crear nuevo\r\n          const newGoogleEvent = await googleCalendarService.createEvent(event, calendarId);\r\n          \r\n          // Guardar ID de Google en Firestore\r\n          if (event.id) {\r\n            const eventDoc = doc(eventsRef, event.id);\r\n            await updateDoc(eventDoc, {\r\n              googleEventId: newGoogleEvent.id,\r\n              synced: true\r\n            });\r\n          }\r\n          \r\n          exportedEvents.push(newGoogleEvent);\r\n        }\r\n      }\r\n      \r\n      // Actualizar fecha de √∫ltima sincronizaci√≥n\r\n      const userSyncRef = doc(db, 'calendarSync', user.uid);\r\n      await updateDoc(userSyncRef, {\r\n        lastSync: new Date().toISOString()\r\n      });\r\n      \r\n      setLastSync(new Date());\r\n      setIsLoading(false);\r\n      return exportedEvents;\r\n    } catch (err) {\r\n      console.error('Error al exportar eventos a Google Calendar:', err);\r\n      setError('Error al exportar eventos a Google Calendar');\r\n      setIsLoading(false);\r\n      return [];\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Sincroniza eventos bidireccionales entre Lovenda y Google Calendar\r\n   * @param {string} calendarId - ID del calendario a sincronizar\r\n   * @returns {Promise<Object>} - Resultado de la sincronizaci√≥n\r\n   */\r\n  const syncBidirectional = async (calendarId = 'primary') => {\r\n    if (!user?.uid) {\r\n      setError('Debes iniciar sesi√≥n para sincronizar eventos');\r\n      return { imported: [], exported: [] };\r\n    }\r\n    \r\n    setIsLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      // 1. Importar eventos de Google Calendar\r\n      const googleEvents = await googleCalendarService.getEvents(calendarId);\r\n      const importedEvents = [];\r\n      \r\n      // 2. Obtener eventos de Lovenda\r\n      const eventsRef = collection(db, 'tasks');\r\n      const lovendaEventsQuery = query(eventsRef, where('userId', '==', user.uid));\r\n      const lovendaEventsSnapshot = await getDocs(lovendaEventsQuery);\r\n      const lovendaEvents = lovendaEventsSnapshot.docs.map(doc => ({\r\n        id: doc.id,\r\n        ...doc.data()\r\n      }));\r\n      \r\n      // 3. Procesamiento de eventos de Google\r\n      for (const googleEvent of googleEvents) {\r\n        const lovendaEvent = googleCalendarService.transformToLovendaEvent(googleEvent);\r\n        lovendaEvent.userId = user.uid;\r\n        lovendaEvent.synced = true;\r\n        lovendaEvent.source = 'google';\r\n        \r\n        // Buscar si ya existe este evento por googleEventId\r\n        const existingEventIdx = lovendaEvents.findIndex(e => \r\n          e.googleEventId === googleEvent.id\r\n        );\r\n        \r\n        if (existingEventIdx === -1) {\r\n          // Nuevo evento de Google - crear en Lovenda\r\n          await setDoc(doc(eventsRef), lovendaEvent);\r\n          importedEvents.push(lovendaEvent);\r\n        } else {\r\n          // Evento existente - verificar fecha de modificaci√≥n para decidir qu√© versi√≥n prevalece\r\n          const existingEvent = lovendaEvents[existingEventIdx];\r\n          \r\n          // Si la versi√≥n de Google es m√°s reciente, actualizar en Lovenda\r\n          if (new Date(googleEvent.updated) > new Date(existingEvent.lastUpdated || 0)) {\r\n            await updateDoc(doc(eventsRef, existingEvent.id), lovendaEvent);\r\n            importedEvents.push(lovendaEvent);\r\n          }\r\n          \r\n          // Quitar de la lista para exportaci√≥n\r\n          lovendaEvents.splice(existingEventIdx, 1);\r\n        }\r\n      }\r\n      \r\n      // 4. Exportar eventos de Lovenda que no vienen de Google o no est√°n sincronizados\r\n      const eventsToExport = lovendaEvents.filter(e => \r\n        !e.source || e.source !== 'google' || !e.synced\r\n      );\r\n      \r\n      const exportedEvents = await exportEventsToGoogle(eventsToExport, calendarId);\r\n      \r\n      // 5. Actualizar fecha de √∫ltima sincronizaci√≥n\r\n      const userSyncRef = doc(db, 'calendarSync', user.uid);\r\n      await updateDoc(userSyncRef, {\r\n        lastSync: new Date().toISOString()\r\n      });\r\n      \r\n      setLastSync(new Date());\r\n      setIsLoading(false);\r\n      \r\n      return {\r\n        imported: importedEvents,\r\n        exported: exportedEvents\r\n      };\r\n    } catch (err) {\r\n      console.error('Error en sincronizaci√≥n bidireccional:', err);\r\n      setError('Error al sincronizar eventos');\r\n      setIsLoading(false);\r\n      return { imported: [], exported: [] };\r\n    }\r\n  };\r\n\r\n  return {\r\n    isLoading,\r\n    isAuthenticated,\r\n    syncedCalendars,\r\n    lastSync,\r\n    error,\r\n    authenticate,\r\n    logout,\r\n    getAvailableCalendars,\r\n    saveCalendarSyncConfig,\r\n    importEventsFromGoogle,\r\n    exportEventsToGoogle,\r\n    syncBidirectional\r\n  };\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useDarkMode.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useDiagnostic.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useEmailMonitoring.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useEmailUsername.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useEventCache.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useFinance.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'loadData' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport { doc, getDoc } from 'firebase/firestore';\r\nimport { db } from '../firebaseConfig';\r\nimport { useFirestoreCollection } from './useFirestoreCollection';\r\nimport { useWedding } from '../context/WeddingContext';\r\nimport { saveData, loadData, subscribeSyncState, getSyncState } from '../services/SyncService';\r\nimport { getTransactions } from '../services/bankService';\r\n\r\n/**\r\n * Hook centralizado para gesti√≥n de finanzas\r\n * Maneja transacciones, presupuestos, aportaciones y sincronizaci√≥n\r\n */\r\nexport default function useFinance() {\r\n  const { activeWedding } = useWedding();\r\n  \r\n  // Estados principales\r\n  const [syncStatus, setSyncStatus] = useState(getSyncState());\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n\r\n  // Configuraci√≥n de aportaciones y regalos\r\n  const [contributions, setContributions] = useState({\r\n    initA: 0,\r\n    initB: 0,\r\n    monthlyA: 0,\r\n    monthlyB: 0,\r\n    extras: 0,\r\n    giftPerGuest: 0,\r\n    guestCount: 0\r\n  });\r\n\r\n  // Presupuesto y categor√≠as\r\n  const [budget, setBudget] = useState({\r\n    total: 30000,\r\n    categories: [\r\n      { name: 'Catering', amount: 8000 },\r\n      { name: 'M√∫sica', amount: 2000 },\r\n      { name: 'Flores', amount: 1500 },\r\n      { name: 'Luna de miel', amount: 5000 },\r\n    ]\r\n  });\r\n\r\n  // Transacciones usando Firestore\r\n  const { \r\n    data: transactions, \r\n    addItem: addTransaction, \r\n    updateItem: updateTransaction, \r\n    deleteItem: deleteTransaction \r\n  } = useFirestoreCollection('transactions', activeWedding, []);\r\n\r\n  // C√°lculos memoizados\r\n  const monthlyContrib = useMemo(() => \r\n    contributions.monthlyA + contributions.monthlyB, \r\n    [contributions.monthlyA, contributions.monthlyB]\r\n  );\r\n\r\n  const expectedIncome = useMemo(() => \r\n    contributions.giftPerGuest * contributions.guestCount + \r\n    contributions.extras + \r\n    contributions.initA + \r\n    contributions.initB + \r\n    monthlyContrib,\r\n    [contributions, monthlyContrib]\r\n  );\r\n\r\n  const emergencyAmount = useMemo(() => \r\n    Math.round(budget.total * 0.1), \r\n    [budget.total]\r\n  );\r\n\r\n  const totalSpent = useMemo(() => {\r\n    if (!Array.isArray(transactions)) return 0;\r\n    return transactions\r\n      .filter(t => t.type === 'expense')\r\n      .reduce((sum, t) => sum + (Number(t.amount) || 0), 0);\r\n  }, [transactions]);\r\n\r\n  const totalIncome = useMemo(() => {\r\n    if (!Array.isArray(transactions)) return 0;\r\n    return transactions\r\n      .filter(t => t.type === 'income')\r\n      .reduce((sum, t) => sum + (Number(t.amount) || 0), 0);\r\n  }, [transactions]);\r\n\r\n  const currentBalance = useMemo(() => \r\n    totalIncome - totalSpent + expectedIncome,\r\n    [totalIncome, totalSpent, expectedIncome]\r\n  );\r\n\r\n  const budgetUsage = useMemo(() => {\r\n    if (!Array.isArray(budget.categories)) return [];\r\n    return budget.categories.map(category => {\r\n      const spent = Array.isArray(transactions) \r\n        ? transactions\r\n            .filter(t => t.type === 'expense' && t.category === category.name)\r\n            .reduce((sum, t) => sum + (Number(t.amount) || 0), 0)\r\n        : 0;\r\n      \r\n      return {\r\n        ...category,\r\n        spent,\r\n        remaining: category.amount - spent,\r\n        percentage: category.amount > 0 ? (spent / category.amount) * 100 : 0\r\n      };\r\n    });\r\n  }, [budget.categories, transactions]);\r\n\r\n  // Estad√≠sticas generales\r\n  const stats = useMemo(() => ({\r\n    totalBudget: budget.total,\r\n    totalSpent,\r\n    totalIncome,\r\n    currentBalance,\r\n    expectedIncome,\r\n    emergencyAmount,\r\n    budgetRemaining: budget.total - totalSpent,\r\n    budgetUsagePercentage: budget.total > 0 ? (totalSpent / budget.total) * 100 : 0\r\n  }), [budget.total, totalSpent, totalIncome, currentBalance, expectedIncome, emergencyAmount]);\r\n\r\n  // Suscribirse a cambios en el estado de sincronizaci√≥n\r\n  useEffect(() => {\r\n    const unsubscribe = subscribeSyncState(setSyncStatus);\r\n    return () => unsubscribe();\r\n  }, []);\r\n\r\n  // Cargar n√∫mero de invitados desde el perfil de la boda\r\n  const loadGuestCount = useCallback(async () => {\r\n    if (!activeWedding) return;\r\n    \r\n    try {\r\n      setIsLoading(true);\r\n      const infoSnap = await getDoc(doc(db, 'weddings', activeWedding, 'info', 'weddingInfo'));\r\n      if (infoSnap.exists()) {\r\n        const info = infoSnap.data();\r\n        if (info?.numGuests) {\r\n          setContributions(prev => ({\r\n            ...prev,\r\n            guestCount: Number(info.numGuests)\r\n          }));\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.error('Error cargando n√∫mero de invitados:', err);\r\n      setError('Error cargando datos del perfil');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [activeWedding]);\r\n\r\n  // Actualizar configuraci√≥n de aportaciones\r\n  const updateContributions = useCallback((updates) => {\r\n    setContributions(prev => ({ ...prev, ...updates }));\r\n  }, []);\r\n\r\n  // Gesti√≥n de categor√≠as de presupuesto\r\n  const addBudgetCategory = useCallback((name, amount = 0) => {\r\n    if (!name || budget.categories.find(c => c.name === name)) {\r\n      return { success: false, error: 'Categor√≠a ya existe o nombre inv√°lido' };\r\n    }\r\n    \r\n    setBudget(prev => ({\r\n      ...prev,\r\n      categories: [...prev.categories, { name, amount }]\r\n    }));\r\n    \r\n    return { success: true };\r\n  }, [budget.categories]);\r\n\r\n  const updateBudgetCategory = useCallback((index, updates) => {\r\n    setBudget(prev => ({\r\n      ...prev,\r\n      categories: prev.categories.map((cat, idx) => \r\n        idx === index ? { ...cat, ...updates } : cat\r\n      )\r\n    }));\r\n  }, []);\r\n\r\n  const removeBudgetCategory = useCallback((index) => {\r\n    setBudget(prev => ({\r\n      ...prev,\r\n      categories: prev.categories.filter((_, idx) => idx !== index)\r\n    }));\r\n  }, []);\r\n\r\n  // Gesti√≥n de transacciones\r\n  const createTransaction = useCallback(async (transactionData) => {\r\n    try {\r\n      setIsLoading(true);\r\n      const result = await addTransaction({\r\n        ...transactionData,\r\n        date: transactionData.date || new Date().toISOString().split('T')[0],\r\n        createdAt: new Date().toISOString()\r\n      });\r\n      \r\n      if (result.success) {\r\n        // Sincronizar con localStorage para compatibilidad\r\n        const updatedTransactions = [...transactions, result.data];\r\n        saveData('movements', updatedTransactions, {\r\n          docPath: activeWedding ? `weddings/${activeWedding}/finance/main` : undefined,\r\n          showNotification: false\r\n        });\r\n        window.dispatchEvent(new Event('lovenda-movements'));\r\n      }\r\n      \r\n      return result;\r\n    } catch (err) {\r\n      console.error('Error creando transacci√≥n:', err);\r\n      return { success: false, error: err.message };\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [addTransaction, transactions, activeWedding]);\r\n\r\n  // Importar transacciones bancarias\r\n  const importBankTransactions = useCallback(async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      const bankTransactions = await getTransactions();\r\n      \r\n      for (const transaction of bankTransactions) {\r\n        await createTransaction({\r\n          concept: transaction.description,\r\n          amount: Math.abs(transaction.amount),\r\n          type: transaction.amount < 0 ? 'expense' : 'income',\r\n          category: transaction.category || 'OTROS',\r\n          source: 'bank'\r\n        });\r\n      }\r\n      \r\n      return { success: true, imported: bankTransactions.length };\r\n    } catch (err) {\r\n      console.error('Error importando transacciones bancarias:', err);\r\n      return { success: false, error: err.message };\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [createTransaction]);\r\n\r\n  return {\r\n    // Estados\r\n    syncStatus,\r\n    isLoading,\r\n    error,\r\n    contributions,\r\n    budget,\r\n    transactions,\r\n    \r\n    // C√°lculos\r\n    stats,\r\n    budgetUsage,\r\n    monthlyContrib,\r\n    expectedIncome,\r\n    emergencyAmount,\r\n    currentBalance,\r\n    \r\n    // Acciones\r\n    updateContributions,\r\n    loadGuestCount,\r\n    addBudgetCategory,\r\n    updateBudgetCategory,\r\n    removeBudgetCategory,\r\n    createTransaction,\r\n    updateTransaction,\r\n    deleteTransaction,\r\n    importBankTransactions,\r\n    \r\n    // Utilidades\r\n    clearError: () => setError(null)\r\n  };\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useFirestoreCollection.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'getAllFS' is defined but never used. Allowed unused vars must match /^_/u.","line":16,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":21},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":25,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":25,"endColumn":17,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[845,845],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState, useCallback } from 'react';\r\nimport useWeddingCollection from './useWeddingCollection';\r\nimport { useWedding } from '../context/WeddingContext';\r\nimport { auth, db } from '../lib/firebase';\r\nimport {\r\n  collection,\r\n  onSnapshot,\r\n  query,\r\n  orderBy,\r\n} from 'firebase/firestore';\r\nimport { onAuthStateChanged } from 'firebase/auth';\r\nimport {\r\n  addItem as addItemFS,\r\n  updateItem as updateItemFS,\r\n  deleteItem as deleteItemFS,\r\n  getAll as getAllFS,\r\n} from '../utils/firestoreCollection';\r\n\r\n// Fallback helpers using localStorage when the user is not authenticated\r\nconst localKey = (name) => `lovenda${name[0].toUpperCase()}${name.slice(1)}`;\r\nconst lsGet = (name, fallback) => {\r\n  try {\r\n    const stored = localStorage.getItem(localKey(name));\r\n    if (stored) return JSON.parse(stored);\r\n  } catch (_) {}\r\n  return fallback;\r\n};\r\nconst lsSet = (name, data) => {\r\n  localStorage.setItem(localKey(name), JSON.stringify(data));\r\n  window.dispatchEvent(new Event(`lovenda-${name}`));\r\n};\r\n\r\n/**\r\n * React hook that subscribes to users/{uid}/{collectionName} in Firestore.\r\n * If the user is not authenticated, it falls back to LocalStorage.\r\n * Returns { data, loading, addItem, updateItem, deleteItem }\r\n */\r\nexport const useFirestoreCollection = (collectionName, fallback = []) => {\r\n  const { activeWedding } = useWedding();\r\n  // Si hay boda activa, delegamos a useWeddingCollection (ruta nueva)\r\n  if (activeWedding) {\r\n    return useWeddingCollection(collectionName, activeWedding, fallback);\r\n  }\r\n  const [data, setData] = useState(() => lsGet(collectionName, fallback));\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    let unsubFS = null;\r\n    // Funci√≥n para inicializar listener Firestore cuando tengamos UID\r\n    const initFirestoreListener = (uid) => {\r\n      const q = query(collection(db, 'users', uid, collectionName), orderBy('createdAt', 'asc'));\r\n      unsubFS = onSnapshot(q,\r\n        (snap) => {\r\n          const arr = snap.docs.map((d) => ({ id: d.id, ...d.data() }));\r\n          setData(arr);\r\n          lsSet(collectionName, arr);\r\n          setLoading(false);\r\n        },\r\n        (error) => {\r\n          console.error(`Error escuchando colecci√≥n ${collectionName}:`, error);\r\n          setData(lsGet(collectionName, fallback));\r\n          setLoading(false);\r\n        }\r\n      );\r\n    };\r\n\r\n    const uid = auth.currentUser?.uid;\r\n    if (uid) {\r\n      initFirestoreListener(uid);\r\n      return () => {\r\n        if (typeof unsubFS === 'function') unsubFS();\r\n      };\r\n    } else {\r\n      // No autenticado todav√≠a ‚Üí usar LocalStorage y esperar al login\r\n      const handlerLS = () => setData(lsGet(collectionName, fallback));\r\n      window.addEventListener(`lovenda-${collectionName}`, handlerLS);\r\n      setLoading(false);\r\n\r\n      // Esperamos a que el usuario inicie sesi√≥n para sincronizar datos\r\n      const unsubAuth = onAuthStateChanged(auth, (user) => {\r\n        if (user) {\r\n          initFirestoreListener(user.uid);\r\n          // Sincronizar datos locales pendientes\r\n          if (Array.isArray(data) && data.length) {\r\n            data.forEach((item) => addItemFS(collectionName, item).catch(()=>{}));\r\n          }\r\n        }\r\n      });\r\n\r\n      return () => {\r\n        window.removeEventListener(`lovenda-${collectionName}`, handlerLS);\r\n        unsubAuth();\r\n        if (typeof unsubFS === 'function') unsubFS();\r\n      };\r\n    }\r\n\r\n  }, [collectionName, fallback]);\r\n\r\n  const addItem = useCallback(async (item) => {\r\n    if (auth.currentUser?.uid) {\r\n      await addItemFS(collectionName, item);\r\n    } else {\r\n      const next = [...data, { ...item, id: Date.now() }];\r\n      setData(next);\r\n      lsSet(collectionName, next);\r\n    }\r\n  }, [collectionName, data]);\r\n\r\n  const updateItem = useCallback(async (id, changes) => {\r\n    if (auth.currentUser?.uid) {\r\n      await updateItemFS(collectionName, id, changes);\r\n    } else {\r\n      const next = data.map((d) => (d.id === id ? { ...d, ...changes } : d));\r\n      setData(next);\r\n      lsSet(collectionName, next);\r\n    }\r\n  }, [collectionName, data]);\r\n\r\n  const deleteItem = useCallback(async (id) => {\r\n    if (auth.currentUser?.uid) {\r\n      await deleteItemFS(collectionName, id);\r\n    } else {\r\n      const next = data.filter((d) => d.id !== id);\r\n      setData(next);\r\n      lsSet(collectionName, next);\r\n    }\r\n  }, [collectionName, data]);\r\n\r\n  return { data, loading, addItem, updateItem, deleteItem };\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useForm.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useGlobalSearch.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useGuests.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'saveData' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":18},{"ruleId":"no-unused-vars","severity":1,"message":"'loadData' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { useWedding } from '../context/WeddingContext';\r\nimport useWeddingCollection from './useWeddingCollection';\r\nimport { saveData, loadData, subscribeSyncState, getSyncState } from '../services/SyncService';\r\n\r\n/**\r\n * Hook personalizado para gesti√≥n optimizada de invitados\r\n * Centraliza toda la l√≥gica de invitados con performance mejorada\r\n */\r\nconst useGuests = () => {\r\n  // Manejo seguro del contexto de bodas\r\n  let activeWedding;\r\n  try {\r\n    const weddingContext = useWedding();\r\n    activeWedding = weddingContext?.activeWedding;\r\n  } catch (error) {\r\n    console.error('Error accediendo al contexto de bodas en useGuests:', error);\r\n    activeWedding = null;\r\n  }\r\n  \r\n  // Datos de ejemplo para desarrollo (solo si VITE_ALLOW_SAMPLE_GUESTS === 'true')\r\n  const allowSamples = import.meta.env.VITE_ALLOW_SAMPLE_GUESTS === 'true';\r\n\r\n  const sampleGuests = useMemo(() => {\r\n    if (!allowSamples) return [];\r\n    return [\r\n    { \r\n      id: 1, \r\n      name: 'Ana Garc√≠a', \r\n      email: 'ana@example.com',\r\n      phone: '123456789', \r\n      address: 'Calle Sol 1', \r\n      companion: 1, \r\n      table: '5', \r\n      response: 'S√≠',\r\n      status: 'confirmed',\r\n      dietaryRestrictions: '',\r\n      notes: '',\r\n      createdAt: new Date().toISOString(),\r\n      updatedAt: new Date().toISOString()\r\n    },\r\n    { \r\n      id: 2, \r\n      name: 'Luis Mart√≠nez', \r\n      email: 'luis@example.com',\r\n      phone: '987654321', \r\n      address: 'Av. Luna 3', \r\n      companion: 0, \r\n      table: '', \r\n      response: 'Pendiente',\r\n      status: 'pending',\r\n      dietaryRestrictions: 'Vegetariano',\r\n      notes: 'Llegar√° tarde a la ceremonia',\r\n      createdAt: new Date().toISOString(),\r\n      updatedAt: new Date().toISOString()\r\n    }\r\n  ];\r\n  }, [allowSamples]);\r\n\r\n  // Usar datos de ejemplo solo si no hay boda activa y est√° habilitado allowSamples\r\n  const fallbackGuests = activeWedding ? [] : sampleGuests;\r\n  \r\n  // Debug: log para verificar activeWedding\r\n  useEffect(() => {\r\n    console.log('[useGuests] activeWedding:', activeWedding);\r\n    console.log('[useGuests] fallbackGuests length:', fallbackGuests.length);\r\n  }, [activeWedding, fallbackGuests]);\r\n  \r\n  // Hook de colecci√≥n con datos optimizados\r\n  // Obtenemos loading de la colecci√≥n y lo exponemos como isLoading\r\n  const {\r\n    data: guests,\r\n    addItem,\r\n    updateItem,\r\n    deleteItem,\r\n    loading: collectionLoading,\r\n  } = useWeddingCollection('guests', activeWedding, fallbackGuests);\r\n\r\n  // Alias legible para el resto del hook/componentes\r\n  const isLoading = collectionLoading;\r\n\r\n  // Estado de sincronizaci√≥n\r\n  const [syncStatus, setSyncStatus] = useState(getSyncState());\r\n  \r\n  // Estado para filtros\r\n  const [filters, setFilters] = useState({\r\n    search: '',\r\n    status: '',\r\n    table: ''\r\n  });\r\n\r\n  // Suscribirse a cambios en el estado de sincronizaci√≥n\r\n  useEffect(() => {\r\n    const unsubscribe = subscribeSyncState(setSyncStatus);\r\n    return () => unsubscribe();\r\n  }, []);\r\n\r\n  // Sincronizaci√≥n con localStorage para compatibilidad\r\n  useEffect(() => {\r\n    try {\r\n      localStorage.setItem('lovendaGuests', JSON.stringify(guests));\r\n      \r\n      // Emitir evento para componentes que escuchan cambios\r\n      window.dispatchEvent(new CustomEvent('lovenda-guests-updated', {\r\n        detail: { guests, count: guests.length }\r\n      }));\r\n    } catch (error) {\r\n      console.error('Error sincronizando invitados:', error);\r\n    }\r\n  }, [guests]);\r\n\r\n  // Funciones utilitarias memoizadas\r\n  const utils = useMemo(() => ({\r\n    normalize: (str = '') => str.trim().toLowerCase(),\r\n    phoneClean: (str = '') => str.replace(/\\s+/g, '').replace(/[^0-9+]/g, ''),\r\n    getStatusLabel: (guest) => {\r\n      if (guest.status) {\r\n        if (guest.status === 'confirmed') return 'S√≠';\r\n        if (guest.status === 'declined') return 'No';\r\n        return 'Pendiente';\r\n      }\r\n      return guest.response || 'Pendiente';\r\n    }\r\n  }), []);\r\n\r\n  // Estad√≠sticas memoizadas\r\n  const stats = useMemo(() => {\r\n    const confirmed = guests.filter(g => \r\n      g.status === 'confirmed' || g.response === 'S√≠'\r\n    ).length;\r\n    \r\n    const pending = guests.filter(g => \r\n      g.status === 'pending' || g.response === 'Pendiente'\r\n    ).length;\r\n    \r\n    const declined = guests.filter(g => \r\n      g.status === 'declined' || g.response === 'No'\r\n    ).length;\r\n    \r\n    const totalCompanions = guests.reduce((sum, g) => \r\n      sum + (parseInt(g.companion, 10) || 0), 0\r\n    );\r\n    \r\n    const withDietaryRestrictions = guests.filter(g => \r\n      g.dietaryRestrictions && g.dietaryRestrictions.trim()\r\n    ).length;\r\n\r\n    return {\r\n      total: guests.length,\r\n      confirmed,\r\n      pending,\r\n      declined,\r\n      totalAttendees: confirmed + totalCompanions,\r\n      withDietaryRestrictions\r\n    };\r\n  }, [guests]);\r\n\r\n  // Funciones de gesti√≥n de invitados\r\n  const addGuest = useCallback(async (guestData) => {\r\n    try {\r\n      const newGuest = {\r\n        ...guestData,\r\n        id: guestData.id || `guest-${Date.now()}`,\r\n        createdAt: new Date().toISOString(),\r\n        updatedAt: new Date().toISOString()\r\n      };\r\n      \r\n      await addItem(newGuest);\r\n      return { success: true, guest: newGuest };\r\n    } catch (error) {\r\n      console.error('Error a√±adiendo invitado:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }, [addItem]);\r\n\r\n  const updateGuest = useCallback(async (guestId, updates) => {\r\n    try {\r\n      const updatedGuest = {\r\n        ...updates,\r\n        id: guestId,\r\n        updatedAt: new Date().toISOString()\r\n      };\r\n      \r\n      await updateItem(guestId, updatedGuest);\r\n      return { success: true, guest: updatedGuest };\r\n    } catch (error) {\r\n      console.error('Error actualizando invitado:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }, [updateItem]);\r\n\r\n  const removeGuest = useCallback(async (guestId) => {\r\n    try {\r\n      await deleteItem(guestId);\r\n      return { success: true };\r\n    } catch (error) {\r\n      console.error('Error eliminando invitado:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }, [deleteItem]);\r\n\r\n  // Funciones de invitaci√≥n\r\n  const inviteViaWhatsApp = useCallback(async (guest) => {\r\n    const phone = utils.phoneClean(guest.phone);\r\n    if (!phone) {\r\n      alert('El invitado no tiene n√∫mero de tel√©fono');\r\n      return;\r\n    }\r\n\r\n    let link = '';\r\n    try {\r\n      const resp = await fetch(`/api/guests/${activeWedding}/id/${guest.id}/rsvp-link`, {\r\n        method: 'POST'\r\n      });\r\n      if (resp.ok) {\r\n        const json = await resp.json();\r\n        link = json.link;\r\n      }\r\n    } catch (err) {\r\n      console.warn('No se pudo obtener enlace RSVP', err);\r\n    }\r\n\r\n    const text = link\r\n      ? `¬°Hola ${guest.name}! Nos encantar√≠a contar contigo en nuestra boda. Confirma tu asistencia aqu√≠: ${link}`\r\n      : `¬°Hola ${guest.name}! Nos encantar√≠a contar contigo en nuestra boda. ¬øPuedes confirmar tu asistencia?`;\r\n    const encoded = encodeURIComponent(text);\r\n    window.open(`https://wa.me/${phone}?text=${encoded}`, '_blank');\r\n  }, [utils, activeWedding]);\r\n\r\n  const inviteViaEmail = useCallback(async (guest) => {\r\n    if (!guest.email) {\r\n      alert('El invitado no tiene email');\r\n      return;\r\n    }\r\n\r\n    let link = '';\r\n    try {\r\n      const resp = await fetch(`/api/guests/${activeWedding}/id/${guest.id}/rsvp-link`, {\r\n        method: 'POST'\r\n      });\r\n      if (resp.ok) {\r\n        const json = await resp.json();\r\n        link = json.link;\r\n      }\r\n    } catch (err) {\r\n      console.warn('No se pudo obtener enlace RSVP', err);\r\n    }\r\n\r\n    const subject = encodeURIComponent('Invitaci√≥n a nuestra boda');\r\n    const bodyLines = [\r\n      `Hola ${guest.name},`,\r\n      '',\r\n      'Nos complace invitarte a nuestra boda y ser√≠a un honor contar con tu presencia.',\r\n      link ? `Confirma tu asistencia haciendo clic aqu√≠: ${link}` : 'Por favor confirma tu asistencia respondiendo a este mensaje.',\r\n      '',\r\n      '¬°Gracias!'\r\n    ];\r\n    const body = encodeURIComponent(bodyLines.join('\\n'));\r\n\r\n    window.open(`mailto:${guest.email}?subject=${subject}&body=${body}`, '_blank');\r\n  }, []);\r\n\r\n  const bulkInviteWhatsApp = useCallback(async () => {\r\n    const guestsWithPhone = guests.filter(g => utils.phoneClean(g.phone));\r\n    \r\n    if (guestsWithPhone.length === 0) {\r\n      alert('No hay invitados con n√∫mero de tel√©fono');\r\n      return;\r\n    }\r\n    \r\n    if (!window.confirm(\r\n      `Se abrir√° WhatsApp en una pesta√±a por cada invitado (${guestsWithPhone.length} invitados). ¬øContinuar?`\r\n    )) {\r\n      return;\r\n    }\r\n    \r\n    for (const guest of guestsWithPhone) {\r\n      try {\r\n        // Generar enlace RSVP si hay API disponible\r\n        let rsvpLink = '';\r\n        try {\r\n          const resp = await fetch(`/api/guests/${activeWedding}/id/${guest.id}/rsvp-link`, { \r\n            method: 'POST' \r\n          });\r\n          if (resp.ok) {\r\n            const { link } = await resp.json();\r\n            rsvpLink = link;\r\n          }\r\n        } catch (err) {\r\n          console.warn('No se pudo generar enlace RSVP:', err);\r\n        }\r\n        \r\n        const message = rsvpLink \r\n          ? `¬°Hola ${guest.name}! Estamos encantados de invitarte a nuestra boda. Por favor confirma tu asistencia aqu√≠: ${rsvpLink}`\r\n          : `¬°Hola ${guest.name}! Nos encantar√≠a contar contigo en nuestra boda. ¬øPuedes confirmar tu asistencia?`;\r\n        \r\n        const phone = utils.phoneClean(guest.phone);\r\n        const encodedMessage = encodeURIComponent(message);\r\n        \r\n        window.open(`https://wa.me/${phone}?text=${encodedMessage}`, '_blank');\r\n        \r\n        // Peque√±a pausa entre invitaciones\r\n        await new Promise(resolve => setTimeout(resolve, 500));\r\n      } catch (error) {\r\n        console.error(`Error invitando a ${guest.name}:`, error);\r\n      }\r\n    }\r\n  }, [guests, utils]);\r\n\r\n  // Funciones de importaci√≥n/exportaci√≥n\r\n  const importFromContacts = useCallback(async () => {\r\n    if (!navigator.contacts || !navigator.contacts.select) {\r\n      alert('La API de contactos no est√° disponible en este navegador');\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      const contacts = await navigator.contacts.select(\r\n        ['name', 'tel', 'email'], \r\n        { multiple: true }\r\n      );\r\n      \r\n      const importedGuests = contacts.map(contact => ({\r\n        id: `imported-${Date.now()}-${Math.random()}`,\r\n        name: contact.name?.[0] || 'Sin nombre',\r\n        email: contact.email?.[0] || '',\r\n        phone: contact.tel?.[0] || '',\r\n        address: '',\r\n        companion: 0,\r\n        table: '',\r\n        response: 'Pendiente',\r\n        status: 'pending',\r\n        dietaryRestrictions: '',\r\n        notes: 'Importado desde contactos',\r\n        createdAt: new Date().toISOString(),\r\n        updatedAt: new Date().toISOString()\r\n      }));\r\n      \r\n      // A√±adir todos los invitados importados\r\n      for (const guest of importedGuests) {\r\n        await addGuest(guest);\r\n      }\r\n      \r\n      alert(`Se importaron ${importedGuests.length} contactos exitosamente`);\r\n    } catch (error) {\r\n      console.error('Error importando contactos:', error);\r\n      alert('Error al importar contactos');\r\n    }\r\n  }, [addGuest]);\r\n\r\n  const exportToCSV = useCallback(() => {\r\n    if (guests.length === 0) {\r\n      alert('No hay invitados para exportar');\r\n      return;\r\n    }\r\n    \r\n    const headers = [\r\n      'Nombre', 'Email', 'Tel√©fono', 'Direcci√≥n', 'Estado', \r\n      'Mesa', 'Acompa√±antes', 'Restricciones Diet√©ticas', 'Notas'\r\n    ];\r\n    \r\n    const csvContent = [\r\n      headers.join(','),\r\n      ...guests.map(guest => [\r\n        `\"${guest.name || ''}\"`,\r\n        `\"${guest.email || ''}\"`,\r\n        `\"${guest.phone || ''}\"`,\r\n        `\"${guest.address || ''}\"`,\r\n        `\"${utils.getStatusLabel(guest)}\"`,\r\n        `\"${guest.table || ''}\"`,\r\n        guest.companion || 0,\r\n        `\"${guest.dietaryRestrictions || ''}\"`,\r\n        `\"${guest.notes || ''}\"`\r\n      ].join(','))\r\n    ].join('\\n');\r\n    \r\n    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n    const link = document.createElement('a');\r\n    const url = URL.createObjectURL(blob);\r\n    \r\n    link.setAttribute('href', url);\r\n    link.setAttribute('download', `invitados-${new Date().toISOString().split('T')[0]}.csv`);\r\n    link.style.visibility = 'hidden';\r\n    \r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n  }, [guests, utils]);\r\n\r\n  // Funciones de filtrado\r\n  const updateFilters = useCallback((newFilters) => {\r\n    setFilters(prev => ({ ...prev, ...newFilters }));\r\n  }, []);\r\n\r\n  const clearFilters = useCallback(() => {\r\n    setFilters({ search: '', status: '', table: '' });\r\n  }, []);\r\n\r\n  return {\r\n    // Datos\r\n    guests,\r\n    stats,\r\n    filters,\r\n    syncStatus,\r\n    isLoading,\r\n    \r\n    // Funciones de gesti√≥n\r\n    addGuest,\r\n    updateGuest,\r\n    removeGuest,\r\n    \r\n    // Funciones de invitaci√≥n\r\n    inviteViaWhatsApp,\r\n    inviteViaEmail,\r\n    bulkInviteWhatsApp,\r\n    \r\n    // Funciones de importaci√≥n/exportaci√≥n\r\n    importFromContacts,\r\n    exportToCSV,\r\n    \r\n    // Funciones de filtrado\r\n    updateFilters,\r\n    clearFilters,\r\n    \r\n    // Utilidades\r\n    utils\r\n  };\r\n};\r\n\r\nexport default useGuests;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useHistory.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useMediaQuery.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useNotifications.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useOnboarding.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'doc' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'getDoc' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'db' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":12},{"ruleId":"no-unused-vars","severity":1,"message":"'currentUser' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":17,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { doc, getDoc } from 'firebase/firestore';\r\nimport { onAuthStateChanged } from 'firebase/auth';\r\nimport { db, auth } from '../firebaseConfig';\r\nimport { useWedding } from '../context/WeddingContext';\r\nimport { useAuth } from './useAuth';\r\n\r\n/**\r\n * Hook personalizado para gestionar el estado del onboarding del usuario\r\n * @returns {{\r\n *   showOnboarding: boolean,\r\n *   onboardingCompleted: boolean,\r\n *   completeOnboarding: Function\r\n * }}\r\n */\r\nexport const useOnboarding = () => {\r\n  const { currentUser } = useAuth();\r\n  const { weddings, activeWedding } = useWedding();\r\n  // Si existe flag en localStorage, mostramos onboarding s√≠ o s√≠\r\n  const forceFlag = typeof window !== 'undefined' ? localStorage.getItem('forceOnboarding') === '1' : false;\r\n  const [showOnboarding, setShowOnboarding] = useState(forceFlag);\r\n  // No eliminamos el flag aqu√≠; se quitar√° cuando se complete el tutorial.\r\n  \r\n  const [onboardingCompleted, setOnboardingCompleted] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // DESHABILITAR TEMPORALMENTE Firebase onboarding checks\r\n  useEffect(() => {\r\n    // MODO OFFLINE TEMPORAL: Solo usar localStorage hasta que se solucionen los permisos\r\n    const checkOnboardingStatus = (user) => {\r\n      // Si hay flag forzado, mostrar onboarding\r\n      if (forceFlag) {\r\n        setShowOnboarding(true);\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      // Si no hay usuario, no mostrar onboarding\r\n      if (!user || !user.uid) {\r\n        setShowOnboarding(false);\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      // Solo usar localStorage - NO Firebase por ahora\r\n      const localOnboardingKey = `onboarding_completed_${user.uid}`;\r\n      const localCompleted = localStorage.getItem(localOnboardingKey);\r\n      \r\n      if (localCompleted === 'true') {\r\n        setOnboardingCompleted(true);\r\n        setShowOnboarding(false);\r\n      } else {\r\n        // Primera vez o no completado\r\n        setOnboardingCompleted(false);\r\n        setShowOnboarding(true);\r\n      }\r\n      \r\n      setLoading(false);\r\n    };\r\n\r\n    // Usar onAuthStateChanged pero sin consultas a Firebase\r\n    const unsubscribe = onAuthStateChanged(auth, checkOnboardingStatus);\r\n    \r\n    return () => unsubscribe();\r\n  }, [forceFlag]);\r\n\r\n  // Si ya hay una boda cargada, consideramos el onboarding completado\r\n  useEffect(() => {\r\n    if (!forceFlag && (weddings.length > 0 || activeWedding)) {\r\n      setShowOnboarding(false);\r\n      setOnboardingCompleted(true);\r\n    }\r\n  }, [forceFlag, weddings, activeWedding]);\r\n\r\n  // Funci√≥n para marcar el onboarding como completado\r\n  const completeOnboarding = () => {\r\n    setShowOnboarding(false);\r\n    setOnboardingCompleted(true);\r\n    localStorage.removeItem('forceOnboarding');\r\n    \r\n    // Guardar en localStorage como backup\r\n    if (auth.currentUser && auth.currentUser.uid) {\r\n      const localOnboardingKey = `onboarding_completed_${auth.currentUser.uid}`;\r\n      localStorage.setItem(localOnboardingKey, 'true');\r\n    }\r\n  };\r\n\r\n  return {\r\n    showOnboarding,\r\n    onboardingCompleted,\r\n    completeOnboarding,\r\n    loading\r\n  };\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useProveedores.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'where' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":8}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { db } from '../lib/firebase';\r\nimport { \r\n  collection, \r\n  getDocs, \r\n  doc, \r\n  addDoc, \r\n  updateDoc, \r\n  deleteDoc, \r\n  query, \r\n  where, \r\n  orderBy,\r\n  Timestamp,\r\n  serverTimestamp\r\n} from 'firebase/firestore';\r\nimport { useAuth } from './useAuth';\r\n\r\n/**\r\n * @typedef {Object} Provider\r\n * @property {string} id - ID √∫nico del proveedor\r\n * @property {string} name - Nombre del proveedor\r\n * @property {string} service - Tipo de servicio ofrecido\r\n * @property {string} contact - Nombre de la persona de contacto\r\n * @property {string} email - Email de contacto\r\n * @property {string} phone - Tel√©fono de contacto\r\n * @property {string} status - Estado actual (Nuevo, Contactado, Seleccionado, Confirmado, etc.)\r\n * @property {string} date - Fecha de contacto o cita\r\n * @property {number} rating - Puntuaci√≥n media (0-5)\r\n * @property {number} ratingCount - N√∫mero de valoraciones\r\n * @property {string} [snippet] - Descripci√≥n corta\r\n * @property {string} [link] - Enlace a la web del proveedor\r\n * @property {string} [image] - URL de la imagen del proveedor\r\n */\r\n\r\n/**\r\n * Hook personalizado para gestionar la l√≥gica de los proveedores.\r\n * Proporciona funcionalidades para listar, filtrar, a√±adir, editar y eliminar proveedores,\r\n * as√≠ como para gestionar el estado de selecci√≥n y filtrado.\r\n * \r\n * @returns {Object} Objeto con estados y funciones para gestionar proveedores\r\n * @property {Provider[]} providers - Lista completa de proveedores\r\n * @property {Provider[]} filteredProviders - Lista de proveedores filtrada seg√∫n criterios\r\n * @property {boolean} loading - Indica si hay una operaci√≥n en curso\r\n * @property {string|null} error - Mensaje de error si existe\r\n * @property {Provider|null} selectedProvider - Proveedor actualmente seleccionado\r\n * @property {string[]} selectedProviderIds - IDs de proveedores seleccionados\r\n * @property {string} searchTerm - T√©rmino de b√∫squeda actual\r\n * @property {string} serviceFilter - Filtro por servicio\r\n * @property {string} statusFilter - Filtro por estado\r\n * @property {string} dateFrom - Filtro por fecha desde\r\n * @property {string} dateTo - Filtro por fecha hasta\r\n * @property {string} tab - Pesta√±a actual ('all', 'selected', 'contacted')\r\n * @property {Function} setSearchTerm - Actualizar t√©rmino de b√∫squeda\r\n * @property {Function} setServiceFilter - Actualizar filtro por servicio\r\n * @property {Function} setStatusFilter - Actualizar filtro por estado\r\n * @property {Function} setDateFrom - Actualizar filtro por fecha desde\r\n * @property {Function} setDateTo - Actualizar filtro por fecha hasta\r\n * @property {Function} setTab - Cambiar pesta√±a actual\r\n * @property {Function} setSelectedProvider - Establecer proveedor seleccionado\r\n * @property {Function} loadProviders - Cargar proveedores desde la base de datos\r\n * @property {Function} addProvider - A√±adir un nuevo proveedor\r\n * @property {Function} updateProvider - Actualizar un proveedor existente\r\n * @property {Function} deleteProvider - Eliminar un proveedor\r\n * @property {Function} toggleSelectProvider - Seleccionar/deseleccionar un proveedor\r\n * @property {Function} clearSelection - Limpiar selecciones\r\n * @property {Function} clearFilters - Limpiar todos los filtros\r\n */\r\nexport const useProveedores = () => {\r\n  const [providers, setProviders] = useState([]);\r\n  const [filteredProviders, setFilteredProviders] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [selectedProvider, setSelectedProvider] = useState(null);\r\n  const [selectedProviderIds, setSelectedProviderIds] = useState([]);\r\n  \r\n  // Filtros\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [serviceFilter, setServiceFilter] = useState('');\r\n  const [statusFilter, setStatusFilter] = useState('');\r\n  const [dateFrom, setDateFrom] = useState('');\r\n  const [dateTo, setDateTo] = useState('');\r\n    // Filtro de rating m√≠nimo (0 = cualquiera)\r\n    const [ratingMin, setRatingMin] = useState(0);\r\n  const [tab, setTab] = useState('all'); // 'all', 'reserved', 'favorite'\r\n  \r\n  const { user } = useAuth();\r\n  \r\n  /**\r\n   * Cargar proveedores desde Firestore\r\n   */\r\n  const loadProviders = useCallback(async () => {\r\n    if (!user) return;\r\n    \r\n    setLoading(true);\r\n    \r\n    try {\r\n      const proveedoresRef = collection(db, `usuarios/${user.uid}/proveedores`);\r\n      const q = query(proveedoresRef, orderBy('created', 'desc'));\r\n      const snapshot = await getDocs(q);\r\n      \r\n      const loadedProviders = snapshot.docs.map(doc => ({\r\n        id: doc.id,\r\n        ...doc.data(),\r\n        date: doc.data().date ? new Date(doc.data().date.toDate()).toISOString().split('T')[0] : ''\r\n      }));\r\n      \r\n      setProviders(loadedProviders);\r\n      applyFilters(loadedProviders);\r\n      setLoading(false);\r\n    } catch (err) {\r\n      console.error('Error al cargar los proveedores:', err);\r\n      setError('No se pudieron cargar los proveedores. Int√©ntalo de nuevo m√°s tarde.');\r\n      setLoading(false);\r\n    }\r\n  }, [user]);\r\n  \r\n  /**\r\n   * Aplicar filtros a los proveedores\r\n   */\r\n  const applyFilters = useCallback((providersToFilter = providers) => {\r\n    let filtered = [...providersToFilter];\r\n    \r\n    // Aplicar filtro de b√∫squeda\r\n    if (searchTerm) {\r\n      const searchTermLower = searchTerm.toLowerCase();\r\n      filtered = filtered.filter(p => \r\n        p.name?.toLowerCase().includes(searchTermLower) || \r\n        p.service?.toLowerCase().includes(searchTermLower) || \r\n        p.contact?.toLowerCase().includes(searchTermLower) ||\r\n        p.status?.toLowerCase().includes(searchTermLower) ||\r\n        p.snippet?.toLowerCase().includes(searchTermLower)\r\n      );\r\n    }\r\n    \r\n    // Aplicar filtro de servicio\r\n    if (serviceFilter) {\r\n      filtered = filtered.filter(p => p.service === serviceFilter);\r\n    }\r\n    \r\n    // Aplicar filtro de estado\r\n    if (statusFilter) {\r\n      filtered = filtered.filter(p => p.status === statusFilter);\r\n    }\r\n    \r\n    // Aplicar filtro de fecha desde\r\n    if (dateFrom) {\r\n      filtered = filtered.filter(p => p.date >= dateFrom);\r\n    }\r\n    \r\n    // Aplicar filtro de fecha hasta\r\n    if (dateTo) {\r\n      filtered = filtered.filter(p => p.date <= dateTo);\r\n    }\r\n    \r\n    // Aplicar filtro de rating m√≠nimo\r\n    if (ratingMin > 0) {\r\n      filtered = filtered.filter(p => p.rating >= ratingMin);\r\n    }\r\n    \r\n    // Filtrar por pesta√±a\r\n    if (tab === 'reserved') {\r\n      filtered = filtered.filter(p => Array.isArray(p.reservations) && p.reservations.length);\r\n    }\r\n    if (tab === 'favorite') {\r\n      filtered = filtered.filter(p => p.favorite);\r\n    }\r\n    \r\n    setFilteredProviders(filtered);\r\n  }, [providers, searchTerm, serviceFilter, statusFilter, dateFrom, dateTo, ratingMin, tab]);\r\n  \r\n  /**\r\n   * Limpiar todos los filtros\r\n   */\r\n  const clearFilters = useCallback(() => {\r\n    setSearchTerm('');\r\n    setServiceFilter('');\r\n    setStatusFilter('');\r\n    setDateFrom('');\r\n    setDateTo('');\r\n    setRatingMin(0);\r\n    setTab('all');\r\n  }, []);\r\n  \r\n  /**\r\n   * Crear un nuevo proveedor\r\n   */\r\n  const addProvider = useCallback(async (providerData) => {\r\n    if (!user) return null;\r\n    \r\n    try {\r\n      const proveedoresRef = collection(db, `usuarios/${user.uid}/proveedores`);\r\n      \r\n      // A√±adir campos de timestamp\r\n      const providerWithTimestamp = {\r\n        ...providerData,\r\n        created: serverTimestamp(),\r\n        updated: serverTimestamp(),\r\n        date: providerData.date ? Timestamp.fromDate(new Date(providerData.date)) : null\r\n      };\r\n      \r\n      const docRef = await addDoc(proveedoresRef, providerWithTimestamp);\r\n      \r\n      // Actualizar estado local\r\n      const newProvider = {\r\n        id: docRef.id,\r\n        ...providerData,\r\n        date: providerData.date || ''\r\n      };\r\n      \r\n      setProviders(prev => [newProvider, ...prev]);\r\n      applyFilters([newProvider, ...providers]);\r\n      \r\n      return newProvider;\r\n    } catch (err) {\r\n      console.error('Error al a√±adir proveedor:', err);\r\n      setError('No se pudo a√±adir el proveedor. Int√©ntalo de nuevo m√°s tarde.');\r\n      return null;\r\n    }\r\n  }, [user, providers, applyFilters]);\r\n  \r\n  /**\r\n   * Actualizar un proveedor existente\r\n   */\r\n  const updateProvider = useCallback(async (providerId, providerData) => {\r\n    if (!user) return false;\r\n    \r\n    try {\r\n      const providerRef = doc(db, `usuarios/${user.uid}/proveedores`, providerId);\r\n      \r\n      // A√±adir campo de timestamp de actualizaci√≥n\r\n      const providerWithTimestamp = {\r\n        ...providerData,\r\n        updated: serverTimestamp(),\r\n        date: providerData.date ? Timestamp.fromDate(new Date(providerData.date)) : null\r\n      };\r\n      \r\n      await updateDoc(providerRef, providerWithTimestamp);\r\n      \r\n      setError(null);\r\n    } catch (err) {\r\n      console.error('Error al actualizar proveedor:', err);\r\n      setError('Error al actualizar el proveedor. Int√©ntalo de nuevo.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [user]);\r\n  \r\n  /**\r\n   * Eliminar un proveedor\r\n   */\r\n  /**\r\n   * A√±adir reserva a proveedor\r\n   */\r\n  const addReservation = useCallback(async (providerId, reservation) => {\r\n    const provider = providers.find(p => p.id === providerId);\r\n    if(!provider) return false;\r\n    const newReservations = Array.isArray(provider.reservations) ? [...provider.reservations, reservation] : [reservation];\r\n    // local update\r\n    const updatedProvider = { ...provider, reservations: newReservations };\r\n    setProviders(prev => prev.map(p => p.id===providerId ? updatedProvider : p));\r\n    applyFilters(providers.map(p => p.id===providerId ? updatedProvider : p));\r\n    // firestore update\r\n    if(user){\r\n      try{\r\n        const providerRef = doc(db, `usuarios/${user.uid}/proveedores`, providerId);\r\n        await updateDoc(providerRef, { reservations: newReservations, updated: serverTimestamp() });\r\n      }catch(err){ console.error('Error al guardar reserva', err);}  }\r\n    return true;\r\n  }, [providers, user, applyFilters]);\r\n\r\n  const deleteProvider = useCallback(async (providerId) => {\r\n    if (!user) return false;\r\n    \r\n    try {\r\n      const providerRef = doc(db, `usuarios/${user.uid}/proveedores`, providerId);\r\n      await deleteDoc(providerRef);\r\n      \r\n      // Actualizar estado local\r\n      setProviders(prev => prev.filter(p => p.id !== providerId));\r\n      applyFilters(providers.filter(p => p.id !== providerId));\r\n      \r\n      // Si es el proveedor seleccionado, limpiarlo\r\n      if (selectedProvider && selectedProvider.id === providerId) {\r\n        setSelectedProvider(null);\r\n      }\r\n      \r\n      // Eliminar de la lista de seleccionados si estaba all√≠\r\n      setSelectedProviderIds(prev => prev.filter(id => id !== providerId));\r\n      \r\n      return true;\r\n    } catch (err) {\r\n      console.error('Error al eliminar proveedor:', err);\r\n      setError('No se pudo eliminar el proveedor. Int√©ntalo de nuevo m√°s tarde.');\r\n      return false;\r\n    }\r\n  }, [user, providers, selectedProvider, applyFilters]);\r\n  \r\n  /**\r\n   * Seleccionar/deseleccionar un proveedor de la lista\r\n   */\r\n  const toggleFavoriteProvider = useCallback(async (providerId) => {\r\n    const provider = providers.find(p => p.id === providerId);\r\n    if(!provider) return;\r\n    const newFav = !provider.favorite;\r\n    // actualizar local\r\n    setProviders(prev => prev.map(p => p.id===providerId ? {...p, favorite:newFav}:p));\r\n    applyFilters(providers.map(p => p.id===providerId ? {...p, favorite:newFav}:p));\r\n    // actualizar firestore\r\n    if(user){\r\n      try{\r\n        const providerRef = doc(db, `usuarios/${user.uid}/proveedores`, providerId);\r\n        await updateDoc(providerRef, { favorite: newFav, updated: serverTimestamp() });\r\n      }catch(err){ console.error('Error al marcar favorito', err);}  }\r\n  }, [providers, user, applyFilters]);\r\n\r\n  const toggleSelectProvider = useCallback((providerId) => {\r\n    setSelectedProviderIds(prev => {\r\n      if (prev.includes(providerId)) {\r\n        return prev.filter(id => id !== providerId);\r\n      } else {\r\n        return [...prev, providerId];\r\n      }\r\n    });\r\n  }, []);\r\n  \r\n  /**\r\n   * Limpiar todas las selecciones\r\n   */\r\n  const clearSelection = useCallback(() => {\r\n    setSelectedProviderIds([]);\r\n  }, []);\r\n  \r\n  // Cargar proveedores al iniciar\r\n  useEffect(() => {\r\n    if (user) {\r\n      loadProviders();\r\n    }\r\n  }, [user, loadProviders]);\r\n  \r\n  // Aplicar filtros cuando cambien\r\n  useEffect(() => {\r\n    applyFilters();\r\n  }, [searchTerm, serviceFilter, statusFilter, dateFrom, dateTo, ratingMin, tab, applyFilters]);\r\n  \r\n  return {\r\n    // Estado\r\n    providers,\r\n    filteredProviders,\r\n    loading,\r\n    error,\r\n    selectedProvider,\r\n    selectedProviderIds,\r\n    searchTerm,\r\n    serviceFilter,\r\n    statusFilter,\r\n    dateFrom,\r\n    dateTo,\r\n    ratingMin,\r\n    tab,\r\n\r\n    // Setters\r\n    setSearchTerm,\r\n    setServiceFilter,\r\n    setStatusFilter,\r\n    setDateFrom,\r\n    setDateTo,\r\n    setRatingMin,\r\n    setTab,\r\n    setSelectedProvider,\r\n\r\n    // Acciones\r\n    loadProviders,\r\n    addProvider,\r\n    updateProvider,\r\n    deleteProvider,\r\n    addReservation,\r\n    toggleSelectProvider,\r\n    toggleFavoriteProvider,\r\n    clearSelection,\r\n    clearFilters\r\n  };\r\n};\r\n\r\nexport default useProveedores;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useProviderEmail.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":13,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback, useEffect } from 'react';\r\nimport { useAuth } from './useAuth';\r\nimport * as EmailService from '../services/EmailService';\r\nimport { createTrackingRecord } from '../services/EmailTrackingService';\r\n\r\n/**\r\n * Hook personalizado que proporciona funcionalidades para enviar y gestionar\r\n * emails a proveedores utilizando el sistema de correo personalizado de Lovenda.\r\n * \r\n * @returns {Object} Funciones y estados para la gesti√≥n de emails a proveedores\r\n */\r\nexport const useProviderEmail = () => {\r\n  const { user, profile } = useAuth();\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [userEmail, setUserEmail] = useState('');\r\n  \r\n  // Inicializar el servicio de email con el perfil del usuario\r\n  useEffect(() => {\r\n    if (profile) {\r\n      const email = EmailService.initEmailService(profile);\r\n      setUserEmail(email);\r\n    }\r\n  }, [profile]);\r\n\r\n  /**\r\n   * Env√≠a un email a un proveedor y crea un registro de seguimiento\r\n   * \r\n   * @param {Object} provider - Datos del proveedor\r\n   * @param {string} provider.id - ID del proveedor\r\n   * @param {string} provider.name - Nombre del proveedor\r\n   * @param {string} provider.email - Email del proveedor\r\n   * @param {string} subject - Asunto del email\r\n   * @param {string} body - Contenido del email (HTML permitido)\r\n   * @param {Array} [attachments=[]] - Archivos adjuntos\r\n   * @returns {Promise<Object>} Resultado del env√≠o\r\n   */\r\n  const sendEmailToProvider = useCallback(async (provider, subject, body, attachments = []) => {\r\n    if (!provider || !provider.email) {\r\n      setError('El proveedor no tiene email definido');\r\n      return null;\r\n    }\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      // Enviar el email\r\n      const emailData = await EmailService.sendMail({\r\n        to: provider.email,\r\n        subject,\r\n        body,\r\n        attachments\r\n      });\r\n      \r\n      // Crear registro de seguimiento para este email\r\n      if (emailData && emailData.id) {\r\n        const trackingRecord = await createTrackingRecord(emailData, provider);\r\n        \r\n        // Devolver informaci√≥n combinada\r\n        return {\r\n          email: emailData,\r\n          tracking: trackingRecord\r\n        };\r\n      }\r\n      \r\n      return { email: emailData };\r\n    } catch (err) {\r\n      console.error('Error al enviar email al proveedor:', err);\r\n      setError('No se pudo enviar el email. Int√©ntalo de nuevo m√°s tarde.');\r\n      return null;\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n  \r\n  /**\r\n   * Genera un asunto predeterminado para un proveedor seg√∫n su servicio\r\n   * \r\n   * @param {Object} provider - Datos del proveedor\r\n   * @returns {string} Asunto predeterminado\r\n   */\r\n  const generateDefaultSubject = useCallback((provider) => {\r\n    if (!provider) return 'Consulta sobre servicios para boda';\r\n    \r\n    const servicioNormalizado = provider.service ? \r\n      provider.service.toLowerCase().trim() : 'servicios';\r\n    \r\n    const subjectTemplates = {\r\n      'fotograf√≠a': 'Consulta sobre servicios de fotograf√≠a para boda',\r\n      'fotografia': 'Consulta sobre servicios de fotograf√≠a para boda',\r\n      'fotografo': 'Consulta sobre servicios de fotograf√≠a para boda',\r\n      'catering': 'Consulta sobre servicios de catering para boda',\r\n      'flores': 'Consulta sobre decoraci√≥n floral para boda',\r\n      'm√∫sica': 'Consulta sobre m√∫sica y animaci√≥n para boda',\r\n      'musica': 'Consulta sobre m√∫sica y animaci√≥n para boda',\r\n      'dj': 'Consulta sobre servicio de DJ para boda',\r\n      'transporte': 'Consulta sobre servicios de transporte para boda',\r\n      'vestido': 'Consulta sobre vestido de novia',\r\n      'traje': 'Consulta sobre traje de novio',\r\n      'decoraci√≥n': 'Consulta sobre decoraci√≥n para boda',\r\n      'decoracion': 'Consulta sobre decoraci√≥n para boda',\r\n      'invitaciones': 'Consulta sobre dise√±o de invitaciones',\r\n      'default': `Consulta sobre ${servicioNormalizado} para boda`\r\n    };\r\n    \r\n    const serviceKey = Object.keys(subjectTemplates).find(key => \r\n      servicioNormalizado.includes(key)\r\n    );\r\n    \r\n    return serviceKey ? \r\n      subjectTemplates[serviceKey] : \r\n      subjectTemplates['default'];\r\n  }, []);\r\n  \r\n  /**\r\n   * Genera un cuerpo predeterminado para un email a un proveedor\r\n   * \r\n   * @param {Object} provider - Datos del proveedor\r\n   * @returns {string} Cuerpo del email en formato HTML\r\n   */\r\n  const generateDefaultEmailBody = useCallback((provider) => {\r\n    if (!profile) return '';\r\n    \r\n    const nombreUsuario = profile.brideFirstName ? \r\n      `${profile.brideFirstName}${profile.brideLastName ? ' ' + profile.brideLastName : ''}` : \r\n      'Futuros novios';\r\n    \r\n    const fechaBoda = profile.weddingDate ? \r\n      new Date(profile.weddingDate).toLocaleDateString('es-ES', {\r\n        day: 'numeric',\r\n        month: 'long',\r\n        year: 'numeric'\r\n      }) : \r\n      'fecha por determinar';\r\n    \r\n    return `\r\n      <p>Estimado/a ${provider?.name || 'Proveedor'}:</p>\r\n      \r\n      <p>Mi nombre es ${nombreUsuario} y me pongo en contacto con ustedes porque estoy organizando mi boda para el d√≠a <strong>${fechaBoda}</strong>.</p>\r\n      \r\n      <p>He visto sus servicios de ${provider?.service || 'para bodas'} y me gustar√≠a obtener m√°s informaci√≥n sobre:</p>\r\n      \r\n      <ul>\r\n        <li>Disponibilidad para la fecha mencionada</li>\r\n        <li>Paquetes y servicios que ofrecen</li>\r\n        <li>Precios aproximados</li>\r\n        <li>Proceso de reserva</li>\r\n      </ul>\r\n      \r\n      <p>Agradecer√≠a mucho si pudieran proporcionarme esta informaci√≥n para valorar su propuesta.</p>\r\n      \r\n      <p>Quedo a la espera de su respuesta.</p>\r\n      \r\n      <p>Saludos cordiales,<br>\r\n      ${nombreUsuario}</p>\r\n      \r\n      <p style=\"color:#888; font-size:12px;\">Email enviado desde Lovenda - Tu plataforma para organizaci√≥n de bodas</p>\r\n    `;\r\n  }, [profile]);\r\n  \r\n  return {\r\n    loading,\r\n    error,\r\n    userEmail,\r\n    sendEmailToProvider,\r\n    generateDefaultSubject,\r\n    generateDefaultEmailBody\r\n  };\r\n};\r\n\r\nexport default useProviderEmail;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useRoles.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useSeatingPlan.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useMemo' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":39,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":46},{"ruleId":"no-unused-vars","severity":1,"message":"'getDocs' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":47},{"ruleId":"no-unused-vars","severity":1,"message":"'fsCollection' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":63,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":75},{"ruleId":"no-unused-vars","severity":1,"message":"'onSnapshot' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":77,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":87},{"ruleId":"no-unused-vars","severity":1,"message":"'writeBatch' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":89,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":99},{"ruleId":"no-unused-vars","severity":1,"message":"'saveData' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":18},{"ruleId":"no-unused-vars","severity":1,"message":"'loadData' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":28},{"ruleId":"no-unused-vars","severity":1,"message":"'currentTool' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":49,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":49,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'setCurrentTool' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":49,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":49,"endColumn":37}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Hook personalizado para gestionar el estado del plan de asientos\r\n * Centraliza toda la l√≥gica de estado y operaciones del SeatingPlan\r\n */\r\n\r\nimport { useState, useRef, useEffect, useMemo } from 'react';\r\nimport { doc as fsDoc, setDoc, getDoc, getDocs, collection as fsCollection, onSnapshot, writeBatch } from 'firebase/firestore';\r\nimport { db } from '../firebaseConfig';\r\nimport { saveData, loadData, subscribeSyncState, getSyncState } from '../services/SyncService';\r\nimport { useWedding } from '../context/WeddingContext';\r\nimport html2canvas from 'html2canvas';\r\nimport jsPDF from 'jspdf';\r\n\r\n// Utilidad para normalizar IDs de mesas\r\nexport const normalizeId = (id) => {\r\n  const num = parseInt(id, 10);\r\n  return !isNaN(num) ? num : id;\r\n};\r\n\r\nexport const useSeatingPlan = () => {\r\n  const { activeWedding } = useWedding();\r\n  \r\n  // Estados principales\r\n  const [tab, setTab] = useState('ceremony');\r\n  const [syncStatus, setSyncStatus] = useState(getSyncState());\r\n  const [hallSize, setHallSize] = useState({ width: 1800, height: 1200 });\r\n  \r\n  // Estados por tipo de evento\r\n  const [areasCeremony, setAreasCeremony] = useState([]);\r\n  const [areasBanquet, setAreasBanquet] = useState([]);\r\n  const [tablesCeremony, setTablesCeremony] = useState([]);\r\n  const [seatsCeremony, setSeatsCeremony] = useState([]);\r\n  const [tablesBanquet, setTablesBanquet] = useState([]);\r\n  \r\n  // Estados de UI\r\n  const [selectedTable, setSelectedTable] = useState(null);\r\n  const [configTable, setConfigTable] = useState(null);\r\n  const [preview, setPreview] = useState(null);\r\n  const [guests, setGuests] = useState([]);\r\n  const [drawMode, setDrawMode] = useState('pan');\r\n  \r\n  // Estados de modales\r\n  const [ceremonyConfigOpen, setCeremonyConfigOpen] = useState(false);\r\n  const [banquetConfigOpen, setBanquetConfigOpen] = useState(false);\r\n  const [spaceConfigOpen, setSpaceConfigOpen] = useState(false);\r\n  const [templateOpen, setTemplateOpen] = useState(false);\r\n\r\n  // Herramienta actual de dibujo / inserci√≥n\r\n  const [currentTool, setCurrentTool] = useState('select');\r\n  \r\n  // Historial para undo/redo\r\n  const [history, setHistory] = useState([]);\r\n  const [historyPointer, setHistoryPointer] = useState(-1);\r\n  \r\n  // Referencias\r\n  const canvasRef = useRef(null);\r\n  const wsRef = useRef(null);\r\n  \r\n  // Estados computados basados en la pesta√±a activa\r\n  const areas = tab === 'ceremony' ? areasCeremony : areasBanquet;\r\n  const setAreas = tab === 'ceremony' ? setAreasCeremony : setAreasBanquet;\r\n  const tables = tab === 'ceremony' ? tablesCeremony : tablesBanquet;\r\n  const seats = tab === 'ceremony' ? seatsCeremony : [];\r\n  const setTables = tab === 'ceremony' ? setTablesCeremony : setTablesBanquet;\r\n  \r\n  // Cargar dimensiones del sal√≥n con debounce para evitar m√∫ltiples llamadas\r\n  useEffect(() => {\r\n    if (!activeWedding) return;\r\n    \r\n    const loadHallDimensions = async () => {\r\n      try {\r\n        // Corregir referencia: usar colecci√≥n/documento/colecci√≥n/documento (n√∫mero par de segmentos)\r\n        const cfgRef = fsDoc(db, 'weddings', activeWedding, 'seatingPlan', 'banquet');\r\n        const snap = await getDoc(cfgRef);\r\n        if (snap.exists()) {\r\n          const data = snap.data();\r\n          const { width, height } = data?.config || data || {};\r\n          if (width && height) setHallSize({ width, height });\r\n        }\r\n      } catch (err) {\r\n        console.warn('üö´ No se pudieron cargar dimensiones del sal√≥n:', {\r\n          error: err?.message,\r\n          code: err?.code,\r\n          activeWedding\r\n        });\r\n      }\r\n    };\r\n    \r\n    // Debounce para evitar m√∫ltiples llamadas\r\n    const timeoutId = setTimeout(loadHallDimensions, 100);\r\n    return () => clearTimeout(timeoutId);\r\n  }, [activeWedding]);\r\n  \r\n  // Suscribirse a cambios en el estado de sincronizaci√≥n\r\n  useEffect(() => {\r\n    const unsubscribe = subscribeSyncState(setSyncStatus);\r\n    return () => unsubscribe();\r\n  }, []);\r\n  \r\n  // Funciones de gesti√≥n del historial con protecci√≥n contra bucles\r\n  const pushHistory = (snapshot) => {\r\n    // Evitar duplicados consecutivos para prevenir bucles infinitos\r\n    if (history.length > 0 && JSON.stringify(history[historyPointer]) === JSON.stringify(snapshot)) {\r\n      return;\r\n    }\r\n    \r\n    const newHistory = history.slice(0, historyPointer + 1);\r\n    newHistory.push(snapshot);\r\n    setHistory(newHistory);\r\n    setHistoryPointer(newHistory.length - 1);\r\n  };\r\n  \r\n  const undo = () => {\r\n    if (historyPointer > 0) {\r\n      const prevSnapshot = history[historyPointer - 1];\r\n      // Aplicar snapshot anterior\r\n      setHistoryPointer(historyPointer - 1);\r\n      return prevSnapshot;\r\n    }\r\n    return null;\r\n  };\r\n  \r\n  const redo = () => {\r\n    if (historyPointer < history.length - 1) {\r\n      const nextSnapshot = history[historyPointer + 1];\r\n      // Aplicar siguiente snapshot\r\n      setHistoryPointer(historyPointer + 1);\r\n      return nextSnapshot;\r\n    }\r\n    return null;\r\n  };\r\n  \r\n  // Funciones de gesti√≥n de mesas\r\n  const handleSelectTable = (id) => {\r\n    const table = tables.find(t => t.id === id);\r\n    setSelectedTable(table || null);\r\n  };\r\n  \r\n  const handleTableDimensionChange = (field, value) => {\r\n    if (!selectedTable) return;\r\n    \r\n    const updatedTable = { ...selectedTable, [field]: parseInt(value) };\r\n    setSelectedTable(updatedTable);\r\n    \r\n    // Actualizar en la lista de mesas\r\n    setTables(prev => prev.map(t => \r\n      t.id === selectedTable.id ? updatedTable : t\r\n    ));\r\n  };\r\n  \r\n  const toggleSelectedTableShape = () => {\r\n    if (!selectedTable) return;\r\n    \r\n    const newShape = selectedTable.shape === 'rectangle' ? 'circle' : 'rectangle';\r\n    const updatedTable = { ...selectedTable, shape: newShape };\r\n    setSelectedTable(updatedTable);\r\n    \r\n    setTables(prev => prev.map(t => \r\n      t.id === selectedTable.id ? updatedTable : t\r\n    ));\r\n  };\r\n  \r\n  // --- Gestor de √°reas/obst√°culos ---\r\n  const addArea = (area) => {\r\n    console.log('useSeatingPlan - addArea llamado con:', area);\r\n    const newArea = { id: Date.now(), ...area };\r\n    console.log('useSeatingPlan - nueva √°rea creada:', newArea);\r\n    setAreas(prev => {\r\n      const updated = [...prev, newArea];\r\n      console.log('useSeatingPlan - √°reas actualizadas:', updated);\r\n      return updated;\r\n    });\r\n    pushHistory({ type: 'area-add', area: newArea, tab });\r\n    console.log('useSeatingPlan - √°rea a√±adida al historial');\r\n    // No cambiar autom√°ticamente a 'pan' para permitir seguir dibujando\r\n    // setTimeout(() => { setDrawMode('pan'); }, 0);\r\n  };\r\n\r\n  // --- Gestor de mesas ---\r\n  const addTable = (table) => {\r\n    const newTable = { \r\n      id: Date.now(), \r\n      x: 100,\r\n      y: 100,\r\n      width: 80,\r\n      height: 60,\r\n      shape: 'rectangle',\r\n      seats: 8,\r\n      enabled: true,\r\n      guestId: null,\r\n      guestName: null,\r\n      name: `Mesa ${tables.length + 1}`,\r\n      ...table \r\n    };\r\n    setTables(prev => [...prev, newTable]);\r\n    // Guardar en historial\r\n    pushHistory({ type: 'table-add', table: newTable, tab });\r\n  };\r\n\r\n  // Funciones de generaci√≥n de layouts\r\n  const generateSeatGrid = (rows = 10, cols = 12, gap = 40, startX = 100, startY = 80, aisleAfter = 6) => {\r\n    const newSeats = [];\r\n    let seatId = 1;\r\n    \r\n    for (let row = 0; row < rows; row++) {\r\n      for (let col = 0; col < cols; col++) {\r\n        const x = startX + col * gap + (col > aisleAfter ? gap : 0);\r\n        const y = startY + row * gap;\r\n        \r\n        newSeats.push({\r\n          id: seatId++,\r\n          x,\r\n          y,\r\n          enabled: true,\r\n          guestId: null,\r\n          guestName: null\r\n        });\r\n      }\r\n    }\r\n    \r\n    setSeatsCeremony(newSeats);\r\n    \r\n    // Guardar en historial\r\n    pushHistory({\r\n      type: 'ceremony',\r\n      seats: newSeats,\r\n      tables: tablesCeremony,\r\n      areas: areasCeremony\r\n    });\r\n  };\r\n  \r\n  const generateBanquetLayout = ({ rows = 3, cols = 4, seats = 8, gapX = 140, gapY = 160, startX = 120, startY = 160 } = {}) => {\r\n    const newTables = [];\r\n    let tableId = 1;\r\n    \r\n    for (let row = 0; row < rows; row++) {\r\n      for (let col = 0; col < cols; col++) {\r\n        const x = startX + col * gapX;\r\n        const y = startY + row * gapY;\r\n        \r\n        newTables.push({\r\n          id: tableId++,\r\n          x,\r\n          y,\r\n          width: 80,\r\n          height: 60,\r\n          shape: 'rectangle',\r\n          seats,\r\n          enabled: true,\r\n          guestId: null,\r\n          guestName: null,\r\n          name: `Mesa ${tableId - 1}`\r\n        });\r\n      }\r\n    }\r\n    \r\n    setTablesBanquet(newTables);\r\n    \r\n    // Guardar en historial\r\n    pushHistory({\r\n      type: 'banquet',\r\n      tables: newTables,\r\n      areas: areasBanquet\r\n    });\r\n  };\r\n  \r\n  // Funciones de exportaci√≥n\r\n  const exportPNG = async () => {\r\n    if (!canvasRef.current) return;\r\n    \r\n    try {\r\n      const canvas = await html2canvas(canvasRef.current);\r\n      const link = document.createElement('a');\r\n      link.download = `seating-plan-${tab}-${Date.now()}.png`;\r\n      link.href = canvas.toDataURL();\r\n      link.click();\r\n    } catch (error) {\r\n      console.error('Error exportando PNG:', error);\r\n    }\r\n  };\r\n  \r\n  const exportPDF = async () => {\r\n    if (!canvasRef.current) return;\r\n    \r\n    try {\r\n      const canvas = await html2canvas(canvasRef.current);\r\n      const imgData = canvas.toDataURL('image/png');\r\n      \r\n      const pdf = new jsPDF();\r\n      const imgWidth = 210;\r\n      const pageHeight = 295;\r\n      const imgHeight = (canvas.height * imgWidth) / canvas.width;\r\n      let heightLeft = imgHeight;\r\n      \r\n      let position = 0;\r\n      \r\n      pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\r\n      heightLeft -= pageHeight;\r\n      \r\n      while (heightLeft >= 0) {\r\n        position = heightLeft - imgHeight;\r\n        pdf.addPage();\r\n        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\r\n        heightLeft -= pageHeight;\r\n      }\r\n      \r\n      pdf.save(`seating-plan-${tab}-${Date.now()}.pdf`);\r\n    } catch (error) {\r\n      console.error('Error exportando PDF:', error);\r\n    }\r\n  };\r\n  \r\n  // Funciones de guardado\r\n  const saveHallDimensions = async (width, height) => {\r\n    setHallSize({ width, height });\r\n    \r\n    if (activeWedding) {\r\n      try {\r\n        const cfgRef = fsDoc(db, 'weddings', activeWedding, 'seatingPlan', 'banquet', 'config');\r\n        await setDoc(cfgRef, { width, height }, { merge: true });\r\n      } catch (err) {\r\n        console.error('Error guardando dimensiones del sal√≥n:', err);\r\n      }\r\n    }\r\n  };\r\n  \r\n  return {\r\n    // Estados\r\n    tab,\r\n    setTab,\r\n    syncStatus,\r\n    hallSize,\r\n    areas,\r\n    tables,\r\n    seats,\r\n    selectedTable,\r\n    configTable,\r\n    preview,\r\n    guests,\r\n    drawMode,\r\n    setDrawMode,\r\n    \r\n    // Estados de modales\r\n    ceremonyConfigOpen,\r\n    setCeremonyConfigOpen,\r\n    banquetConfigOpen,\r\n    setBanquetConfigOpen,\r\n    spaceConfigOpen,\r\n    setSpaceConfigOpen,\r\n    templateOpen,\r\n    setTemplateOpen,\r\n    \r\n    // Referencias\r\n    canvasRef,\r\n    wsRef,\r\n    \r\n    // Funciones de estado\r\n    setAreas,\r\n    setTables,\r\n    setSelectedTable,\r\n    setConfigTable,\r\n    setPreview,\r\n    setGuests,\r\n    \r\n    // Funciones de gesti√≥n\r\n    handleSelectTable,\r\n    handleTableDimensionChange,\r\n    toggleSelectedTableShape,\r\n    addArea,\r\n    addTable,\r\n    \r\n    // Funciones de historial\r\n    pushHistory,\r\n    undo,\r\n    redo,\r\n    canUndo: historyPointer > 0,\r\n    canRedo: historyPointer < history.length - 1,\r\n    \r\n    // Funciones de generaci√≥n\r\n    generateSeatGrid,\r\n    generateBanquetLayout,\r\n    \r\n    // Funciones de exportaci√≥n\r\n    exportPNG,\r\n    exportPDF,\r\n    \r\n    // Funciones de configuraci√≥n\r\n    saveHallDimensions,\r\n    \r\n    // Utilidades\r\n    normalizeId\r\n  };\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useSpecialMoments.js","messages":[{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":40,"column":11,"nodeType":"BlockStatement","messageId":"unexpected","endLine":40,"endColumn":13,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1475,1475],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\n\r\n/*\r\n  Hook: useSpecialMoments\r\n  Gestiona los momentos especiales de la boda de forma compartida entre las p√°ginas\r\n  Momentos Especiales y Timing. La informaci√≥n se almacena en localStorage y se\r\n  sincroniza entre pesta√±as mediante el evento 'moments-updated'.\r\n*/\r\nconst STORAGE_KEY = 'lovendaSpecialMoments';\r\n\r\n// Estructura inicial por defecto\r\nconst defaultData = {\r\n  ceremonia: [\r\n    { id: 1, order: 1, title: 'Entrada Novio', song: 'Canon in D ‚Äì Pachelbel' },\r\n    { id: 2, order: 2, title: 'Entrada Novia', song: 'Bridal Chorus ‚Äì Wagner' },\r\n    { id: 3, order: 3, title: 'Lectura 1', song: 'A Thousand Years' },\r\n    { id: 4, order: 4, title: 'Lectura 2', song: '' },\r\n    { id: 5, order: 5, title: 'Intercambio de Anillos', song: '' },\r\n    { id: 6, order: 6, title: 'Salida', song: '' },\r\n  ],\r\n  coctail: [\r\n    { id: 7, order: 1, title: 'Entrada', song: '' },\r\n  ],\r\n  banquete: [\r\n    { id: 8, order: 1, title: 'Entrada Novios', song: '' },\r\n    { id: 9, order: 2, title: 'Corte Pastel', song: '' },\r\n    { id: 10, order: 3, title: 'Discursos', song: '' },\r\n  ],\r\n  disco: [\r\n    { id: 11, order: 1, title: 'Primer Baile', song: '' },\r\n    { id: 12, order: 2, title: 'Animar pista', song: '' },\r\n    { id: 13, order: 3, title: '√öltimo tema', song: '' },\r\n  ],\r\n};\r\n\r\nfunction load() {\r\n  try {\r\n    const raw = localStorage.getItem(STORAGE_KEY);\r\n    if (raw) return JSON.parse(raw);\r\n  } catch {}\r\n  return defaultData;\r\n}\r\n\r\nexport default function useSpecialMoments() {\r\n  const [moments, setMoments] = useState(load);\r\n\r\n  // Persistir en localStorage\r\n  useEffect(() => {\r\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(moments));\r\n    window.dispatchEvent(new Event('moments-updated'));\r\n  }, [moments]);\r\n\r\n  // Escuchar cambios desde otras pesta√±as/componentes\r\n  useEffect(() => {\r\n    const handler = () => setMoments(load());\r\n    window.addEventListener('moments-updated', handler);\r\n    return () => window.removeEventListener('moments-updated', handler);\r\n  }, []);\r\n\r\n  const addMoment = useCallback((blockId, moment) => {\r\n    setMoments(prev => {\r\n      const next = { ...prev };\r\n      next[blockId] = [...(prev[blockId] || []), { ...moment, id: Date.now() }];\r\n      return next;\r\n    });\r\n  }, []);\r\n\r\n  const removeMoment = useCallback((blockId, momentId) => {\r\n    setMoments(prev => {\r\n      const next = { ...prev };\r\n      next[blockId] = prev[blockId].filter(m => m.id !== momentId);\r\n      return next;\r\n    });\r\n  }, []);\r\n\r\n  const updateMoment = useCallback((blockId, momentId, changes) => {\r\n    setMoments(prev => {\r\n      const next = { ...prev };\r\n      next[blockId] = prev[blockId].map(m => m.id === momentId ? { ...m, ...changes } : m);\r\n      return next;\r\n    });\r\n  }, []);\r\n\r\n  // Reordenar (arriba/abajo) un momento dentro de su bloque\r\n  const reorderMoment = useCallback((blockId, momentId, direction='up') => {\r\n    setMoments(prev => {\r\n      const current = prev[blockId] || [];\r\n      const idx = current.findIndex(m => m.id === momentId);\r\n      if (idx === -1) return prev;\r\n      const newIdx = direction === 'up' ? idx - 1 : idx + 1;\r\n      if (newIdx < 0 || newIdx >= current.length) return prev;\r\n      const swapped = [...current];\r\n      [swapped[idx], swapped[newIdx]] = [swapped[newIdx], swapped[idx]];\r\n      // Recalcular order\r\n      const updatedList = swapped.map((m, i) => ({ ...m, order: i + 1 }));\r\n      return { ...prev, [blockId]: updatedList };\r\n    });\r\n  }, []);\r\n\r\n  \r\n  // Mover un momento a una posici√≥n concreta dentro de su mismo bloque\r\n  const moveMoment = useCallback((blockId, momentId, toIndex) => {\r\n    setMoments(prev => {\r\n      const list = prev[blockId] || [];\r\n      const idx = list.findIndex(m => m.id === momentId);\r\n      if (idx === -1 || toIndex < 0 || toIndex >= list.length) return prev;\r\n      const reordered = [...list];\r\n      const [item] = reordered.splice(idx, 1);\r\n      reordered.splice(toIndex, 0, item);\r\n      // Recalcular order\r\n      const updated = reordered.map((m, i) => ({ ...m, order: i + 1 }));\r\n      return { ...prev, [blockId]: updated };\r\n    });\r\n  }, []);\r\n\r\n  const duplicateMoment = useCallback((fromBlock, momentId, toBlock) => {\r\n    if (fromBlock === toBlock) return;\r\n    setMoments(prev => {\r\n      const sourceList = prev[fromBlock] || [];\r\n      const moment = sourceList.find(m => m.id === momentId);\r\n      if (!moment) return prev;\r\n      const destList = prev[toBlock] || [];\r\n      const copy = { ...moment, id: Date.now(), order: destList.length + 1 };\r\n      return { ...prev, [toBlock]: [...destList, copy] };\r\n    });\r\n  }, []);\r\n\r\n  return { moments, addMoment, removeMoment, updateMoment, reorderMoment, moveMoment, duplicateMoment };\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useSupplierBudgets.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useTranslations.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useUnifiedInboxMetrics.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useWeddingCollection.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'orderBy' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":10},{"ruleId":"no-unused-vars","severity":1,"message":"'query' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":8},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":21,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":21,"endColumn":17,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[549,549],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'isMounted' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":47,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":47,"endColumn":18},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":194,"column":72,"nodeType":"BlockStatement","messageId":"unexpected","endLine":194,"endColumn":74,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[7593,7593],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState, useCallback } from 'react';\nimport { auth, db, firebaseReady } from '../firebaseConfig';\nimport {\n  collection,\n  addDoc,\n  updateDoc,\n  deleteDoc,\n  doc,\n  onSnapshot,\n  orderBy,\n  query,\n  serverTimestamp,\n} from 'firebase/firestore';\n\n// Helpers para localStorage (cach√© offline por boda)\nconst localKey = (wid, name) => `lovenda_${wid}_${name}`;\nconst lsGet = (wid, name, fallback) => {\n  try {\n    const stored = localStorage.getItem(localKey(wid, name));\n    if (stored) return JSON.parse(stored);\n  } catch (_) {}\n  return fallback;\n};\nconst lsSet = (wid, name, data) => {\n  localStorage.setItem(localKey(wid, name), JSON.stringify(data));\n  window.dispatchEvent(new Event(`lovenda-${wid}-${name}`));\n};\n\n/**\n * Hook para suscribirse a subcolecciones dentro de una boda:\n * weddings/{weddingId}/{subName}\n * Soporta modo offline usando localStorage.\n */\nexport const useWeddingCollection = (subName, weddingId, fallback = []) => {\n  const [data, setData] = useState(() => {\n    try {\n      return lsGet(weddingId, subName, fallback);\n    } catch (error) {\n      console.error('Error inicializando datos desde localStorage:', error);\n      return fallback;\n    }\n  });\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    // Asegurar inicializaci√≥n completa de Firebase antes de lanzar cualquier l√≥gica\n    let isMounted = true;\n    // Intento de migraci√≥n autom√°tica de invitados antiguos\n    async function migrateGuests() {\n      // Esperar inicializaci√≥n completa de Firebase\n      await firebaseReady;\n      if (subName !== 'guests' || !weddingId) return;\n      \n      // Verificar auth de forma segura - usar auth de Firebase, no el contexto local\n      const firebaseUser = auth?.currentUser;\n      if (!firebaseUser?.uid) {\n        console.log('Usuario no autenticado en Firebase, omitiendo migraci√≥n de invitados');\n        return;\n      }\n      \n      try {\n        const {\n          getDocs,\n          collection: col,\n          writeBatch,\n          doc: fDoc,\n          getDoc,\n        } = await import('firebase/firestore');\n\n        const destCol = col(db, 'weddings', weddingId, 'guests');\n        const destSnap = await getDocs(destCol);\n        const existingIds = new Set(destSnap.docs.map((d) => d.id));\n\n        // 1) Invitados en sub-colecci√≥n antigua users/{uid}/guests\n        const oldSnap = await getDocs(col(db, 'users', firebaseUser.uid, 'guests'));\n\n        const batch = writeBatch(db);\n        let writes = 0;\n\n        oldSnap.forEach((docSnap) => {\n          if (!existingIds.has(docSnap.id)) {\n            batch.set(fDoc(destCol, docSnap.id), docSnap.data(), { merge: true });\n            writes++; // contar escritura\n          }\n        });\n\n        // 2) Invitados en documento √∫nico users/{uid}/userGuests\n        const legacyDocRef = fDoc(db, 'users', firebaseUser.uid, 'userGuests');\n        const legacyDocSnap = await getDoc(legacyDocRef);\n        if (legacyDocSnap.exists()) {\n          const legacyData = legacyDocSnap.data();\n          const guestsArray = Array.isArray(legacyData?.guests) ? legacyData.guests : [];\n          guestsArray.forEach((g) => {\n            batch.set(fDoc(destCol), g, { merge: true }); // id aleatorio\n            writes++; // contar escritura\n          });\n        }\n\n        // Si hay operaciones en cola, confirmamos\n        if (writes > 0) {\n          await batch.commit();\n          console.log(`[migraci√≥n] Invitados fusionados en weddings/${weddingId}/guests`);\n        }\n      } catch (err) {\n        console.warn('Error migrando invitados antiguos:', err);\n      }\n    }\n    migrateGuests();\n    // Intento de migraci√≥n autom√°tica de proveedores antiguos\n    async function migrateSuppliers() {\n      // Esperar inicializaci√≥n completa de Firebase\n      await firebaseReady;\n      if (subName !== 'suppliers' || !weddingId) return;\n            // Verificar auth de forma segura - usar auth de Firebase, no el contexto local\n        const firebaseUser = auth?.currentUser;\n        if (!firebaseUser?.uid) {\n          console.log('Usuario no autenticado en Firebase, omitiendo migraci√≥n de proveedores');\n          return;\n        }\n      \n      try {\n        const {\n          getDocs,\n          collection: col,\n          writeBatch,\n          doc: fDoc,\n        } = await import('firebase/firestore');\n\n        const destCol = col(db, 'weddings', weddingId, 'suppliers');\n        const destSnap = await getDocs(destCol);\n        const existingIds = new Set(destSnap.docs.map((d) => d.id));\n\n        // Origen 1: usuarios/{uid}/proveedores (estructura antigua en espa√±ol)\n        const oldCol1 = col(db, 'usuarios', auth.currentUser.uid, 'proveedores');\n        const oldSnap1 = await getDocs(oldCol1);\n\n        // Origen 2: users/{uid}/suppliers (estructura antigua en ingl√©s)\n        const oldCol2 = col(db, 'users', auth.currentUser.uid, 'suppliers');\n        const oldSnap2 = await getDocs(oldCol2);\n\n        const batch = writeBatch(db);\n        let writes = 0;\n        [...oldSnap1.docs, ...oldSnap2.docs].forEach((docSnap) => {\n          if (!existingIds.has(docSnap.id)) {\n            batch.set(fDoc(destCol, docSnap.id), { ...docSnap.data(), migratedAt: serverTimestamp() }, { merge: true });\n          writes++; // contar escritura\n          }\n        });\n\n        if (writes > 0) {\n          await batch.commit();\n          console.log(`[migraci√≥n] Proveedores fusionados en weddings/${weddingId}/suppliers`);\n        }\n      } catch (err) {\n        console.warn('Error migrando proveedores antiguos:', err);\n      }\n    }\n    migrateSuppliers();\n    if (!weddingId) {\n      // Sin boda activa: usamos fallback (puede ser datos de ejemplo)\n      setData(fallback);\n      setLoading(false);\n      return;\n    }\n\n    // Hay boda activa: limpiamos cualquier dato antiguo de ejemplo antes de escuchar Firestore\n    setData([]);\n\n    let unsub = null;\n    const listen = () => {\n      // Intentamos ordenar por createdAt; si el campo no existe en alg√∫n documento, Firestore\n      // igualmente los devuelve, pero algunos proyectos tienen reglas que lo impiden. Para\n      // m√°xima compatibilidad hacemos la consulta base sin orderBy y ordenamos luego en cliente.\n      const colRef = collection(db, 'weddings', weddingId, ...subName.split('/'));\n      const q = colRef;\n      console.log(`[useWeddingCollection] Iniciando listener para weddings/${weddingId}/${subName}`);\n      unsub = onSnapshot(q, (snap) => {\n        const arr = snap.docs.map((d) => ({ id: d.id, ...d.data() }));\n        console.log(`[useWeddingCollection] Datos recibidos:`, { sub: subName, wedding: weddingId, size: arr.length, data: arr });\n        setData(arr);\n        lsSet(weddingId, subName, arr);\n        setLoading(false);\n      }, async (err) => {\n        console.error(`Snapshot error ${subName}:`, err);\n        // Intento autom√°tico: si es permiso denegado, a√±adirse como planner y reintentar\n        if (err?.code === 'permission-denied' && auth.currentUser?.uid) {\n          try {\n            console.warn(`[auto-fix] Intentando a√±adirme como planner en ${weddingId}‚Ä¶ (uid: ${auth.currentUser.uid})`);\n            const { doc: fDoc, updateDoc, arrayUnion } = await import('firebase/firestore');\n            const wedRef = fDoc(db, 'weddings', weddingId);\n            await updateDoc(wedRef, { plannerIds: arrayUnion(auth.currentUser.uid) });\n            console.log(`[auto-fix] A√±adido ${auth.currentUser.uid} a plannerIds en ${weddingId}`);\n            // Cerrar listener anterior si existe\n            if (typeof unsub === 'function') try { unsub(); } catch(_) {}\n            // Dar m√°s tiempo al backend para propagar reglas y reintentar\n            if (import.meta.env.DEV) console.debug('[useWeddingCollection] reintento de listener tras auto-fix en 3000ms', { sub: subName, wedding: weddingId });\n            setTimeout(() => listen(), 3000);\n            return;\n          } catch (permErr) {\n            console.warn('[auto-fix] Error a√±adiendo plannerIds:', permErr);\n          }\n        }\n        if (import.meta.env.DEV) console.debug('[useWeddingCollection] usando cach√© local por error en snapshot', { sub: subName, wedding: weddingId, code: err?.code });\n        setData(lsGet(weddingId, subName, fallback));\n        setLoading(false);\n      });\n    };\n\n    // Si a√∫n no hay weddingId, usa solo cach√© local\n    if (!weddingId) {\n      setData(fallback);\n      setLoading(false);\n      return;\n    }\n\n    // Verificar que db est√© disponible\n    if (!db) {\n      console.warn('Firebase db no est√° disponible, usando datos de fallback');\n      setData(fallback);\n      setLoading(false);\n      return;\n    }\n\n    // Verificar autenticaci√≥n Firebase - si no hay usuario, intentar de todas formas\n    // ya que las reglas pueden permitir acceso p√∫blico o el usuario puede autenticarse despu√©s\n    if (!auth?.currentUser) {\n      console.warn(`[useWeddingCollection] Sin usuario Firebase autenticado, intentando acceso a Firestore de todas formas para ${subName}`);\n    }\n\n    // Esperamos a que Firebase est√© listo antes de iniciar el listener\n    firebaseReady\n      .then(() => listen())\n      .catch(err => {\n        console.error('[useWeddingCollection] Error en firebaseReady:', err);\n        setData(lsGet(weddingId, subName, fallback));\n        setLoading(false);\n      });\n    return () => unsub && unsub();\n  }, [subName, weddingId]);\n\n  const addItem = useCallback(\n    async (item) => {\n      // 1) Cuando hay boda activa intentamos guardar en Firestore\n      if (weddingId) {\n        try {\n          const colRef = collection(db, 'weddings', weddingId, ...subName.split('/'));\n          // Clonamos sin incluir el campo id para evitar redundancia\n          const { id: _tmpId, ...dataWithoutId } = item;\n          const docRef = await addDoc(colRef, {\n            ...dataWithoutId,\n            createdAt: serverTimestamp(),\n          });\n\n          const saved = { ...item, id: docRef.id };\n          // Actualizamos estado local inmediatamente para feedback optimista\n          setData(prev => [...prev, saved]);\n          lsSet(weddingId, subName, [...data, saved]);\n\n          return saved;\n        } catch (err) {\n          console.warn('addItem Firestore failed, usando localStorage:', err);\n          // Si falla, continuamos al modo offline\n        }\n      }\n\n      // 2) Modo offline o fallo de permisos: persistimos en localStorage\n      if (!weddingId) {\n        console.warn('addItem: sin weddingId activo; se guarda solo en localStorage');\n      }\n\n      const offlineItem = { ...item, id: item.id || Date.now() };\n      const next = [...data, offlineItem];\n      setData(next);\n      lsSet(weddingId, subName, next);\n      return offlineItem;\n    },\n    [subName, weddingId, data]\n  );\n\n  const updateItem = useCallback(async (id, changes) => {\n    if (weddingId) {\n      try {\n        await updateDoc(doc(db, 'weddings', weddingId, ...subName.split('/'), id), changes);\n        return;\n      } catch (err) {\n        console.warn('updateItem Firestore failed, usando localStorage:', err);\n      }\n    }\n    if (!weddingId) console.warn('updateItem: sin weddingId activo; se guarda solo en localStorage');\n    const next = data.map((d) => (d.id === id ? { ...d, ...changes } : d));\n    setData(next);\n    lsSet(weddingId, subName, next);\n  }, [subName, weddingId, data]);\n\n  const deleteItem = useCallback(async (id) => {\n    if (weddingId) {\n      try {\n        await deleteDoc(doc(db, 'weddings', weddingId, ...subName.split('/'), id));\n        return;\n      } catch (err) {\n        console.warn('deleteItem Firestore failed, usando localStorage:', err);\n      }\n    }\n    if (!weddingId) console.warn('deleteItem: sin weddingId activo; se guarda solo en localStorage');\n    const next = data.filter((d) => d.id !== id);\n    setData(next);\n    lsSet(weddingId, subName, next);\n  }, [subName, weddingId, data]);\n\n  return { data, loading, addItem, updateItem, deleteItem };\n};\n\nexport default useWeddingCollection;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\hooks\\useWidgets.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\i18n\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\layouts\\AdminLayout.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\lib\\firebase.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\main.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\AcceptInvitation.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\AyudaCeremonia.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\Blog.jsx","messages":[{"ruleId":"react/display-name","severity":2,"message":"Component definition is missing display name","line":82,"column":21,"nodeType":"CallExpression","messageId":"noDisplayName","endLine":95,"endColumn":3}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState, useRef, useCallback } from 'react';\r\nimport { fetchWeddingNews } from '../services/blogService';\r\nimport Spinner from '../components/Spinner';\r\n\r\nexport default function Blog() {\r\n  const [posts, setPosts] = useState([]);\r\n  const [page, setPage] = useState(1);\r\n  const [loading, setLoading] = useState(false);\r\n  const observer = useRef();\r\n\r\n  const lastRef = useCallback((node) => {\r\n    if (loading) return;\r\n    if (observer.current) observer.current.disconnect();\r\n    observer.current = new IntersectionObserver((entries) => {\r\n      if (entries[0].isIntersecting) setPage((p) => p + 1);\r\n    });\r\n    if (node) observer.current.observe(node);\r\n  }, [loading]);\r\n\r\n  useEffect(() => {\r\n    async function load() {\r\n      setLoading(true);\r\n      let newPosts = [...posts];\r\n      const targetLength = Math.ceil((newPosts.length + 1) / 10) * 10; // siguiente m√∫ltiplo de 10\r\n      const domainCounts = {};\r\n      const windowStart = Math.floor(newPosts.length / 10) * 10;\r\n      for (let i = windowStart; i < newPosts.length; i++) {\r\n        const d = (()=>{try{return (new URL(newPosts[i].url)).hostname.replace(/^www\\./,'');}catch{return 'unk';}})();\r\n        domainCounts[d] = (domainCounts[d] || 0) + 1;\r\n      }\r\n\r\n      let fetchPage = page;\r\n      while (newPosts.length < targetLength && fetchPage < page + 60) {\r\n        const batch = await fetchWeddingNews(fetchPage, 50, 'es');\r\n        fetchPage++;\r\n        for (const p of batch) {\r\n          if (!p.url) continue;\r\n          if (newPosts.some(x => x.url === p.url || x.id === p.id)) continue;\r\n          const dom = (()=>{try{return (new URL(p.url)).hostname.replace(/^www\\./,'');}catch{return 'unk';}})();\r\n          if ((domainCounts[dom] || 0) >= 3) continue;\r\n          domainCounts[dom] = (domainCounts[dom] || 0) + 1;\r\n          newPosts.push(p);\r\n          if (newPosts.length >= targetLength) break;\r\n        }\r\n      }\r\n\r\n      // Fallback: si tras buscar no llenamos el bloque, relajamos dominio y buscamos en ingl√©s\r\n      if (newPosts.length < targetLength) {\r\n        fetchPage = 1;\r\n        while (newPosts.length < targetLength && fetchPage <= 30) {\r\n          const batch = await fetchWeddingNews(fetchPage, 50, 'en');\r\n          fetchPage++;\r\n          for (const p of batch) {\r\n            if (!p.url) continue;\r\n            if (newPosts.some(x => x.url === p.url || x.id === p.id)) continue;\r\n            const dom = (()=>{try{return (new URL(p.url)).hostname.replace(/^www\\./,'');}catch{return 'unk';}})();\r\n            if ((domainCounts[dom] || 0) >= 3) continue;\r\n            domainCounts[dom] = (domainCounts[dom] || 0) + 1;\r\n            newPosts.push(p);\r\n            if (newPosts.length >= targetLength) break;\r\n          }\r\n        }\r\n      }\r\n\r\n      setPosts(newPosts);\r\n      setLoading(false);\r\n    }\r\n    load();\r\n  }, [page]);\r\n\r\n  return (\r\n    <div className=\"p-4 md:p-6 space-y-6\">\r\n      <h1 className=\"text-2xl font-bold\">Blog</h1>\r\n      {posts.map((p, idx) => (\r\n        <ArticleCard key={p.url || p.id || idx} post={p} ref={idx === posts.length - 1 ? lastRef : null} />\r\n      ))}\r\n      {loading && <div className=\"flex justify-center my-6\"><Spinner /></div>}\r\n    </div>\r\n  );\r\n}\r\n\r\nconst ArticleCard = React.forwardRef(({ post }, ref) => (\r\n  <div ref={ref} className=\"border rounded-lg overflow-hidden shadow hover:shadow-md transition\">\r\n    {post.image && <img src={post.image} alt={post.title} className=\"w-full h-48 object-cover\" />}\r\n    <div className=\"p-4 space-y-2\">\r\n      <h2 className=\"text-lg font-semibold\">{post.title}</h2>\r\n      <p className=\"text-sm text-gray-700 line-clamp-3\">{post.description}</p>\r\n      <div className=\"text-xs text-gray-500 flex justify-between\">\r\n        <span>{post.source}</span>\r\n        <span>{new Date(post.published).toLocaleDateString()}</span>\r\n      </div>\r\n      <a href={post.url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-600 text-sm\">Leer m√°s</a>\r\n    </div>\r\n  </div>\r\n));\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\BodaDetalle.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'getDoc' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":39,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":45},{"ruleId":"no-unused-vars","severity":1,"message":"'fetchWeddingById' is defined but never used. Allowed unused vars must match /^_/u.","line":14,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'colName' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":180,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":180,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '../hooks/useAuthUnified';\r\nimport { ArrowLeft, CheckCircle, Circle } from 'lucide-react';\r\nimport { Card } from '../components/ui/Card';\r\nimport { Progress } from '../components/ui/Progress';\r\nimport { doc, collection, onSnapshot, getDoc } from 'firebase/firestore';\r\nimport SeatingCanvas from '../features/seating/SeatingCanvas';\r\nimport { DndProvider } from 'react-dnd';\r\nimport { HTML5Backend } from 'react-dnd-html5-backend';\r\nimport { db } from '../firebaseConfig';\r\n\r\n// TODO: Reemplazar por llamada real a Firestore para obtener detalles de la boda\r\nfunction fetchWeddingById(weddingId) {\r\n  // Datos simulados para demo\r\n  const mock = {\r\n    id: weddingId,\r\n    name: 'Boda de Ana y Luis',\r\n    date: '2025-09-15',\r\n    location: 'Sevilla',\r\n    progress: 65,\r\n    guests: [\r\n      { id: 'g1', name: 'Mar√≠a L√≥pez' },\r\n      { id: 'g2', name: 'Carlos Ruiz' },\r\n    ],\r\n    tasks: [\r\n      { id: 't1', title: 'Confirmar lugar', done: true },\r\n      { id: 't2', title: 'Elegir men√∫', done: false },\r\n    ],\r\n    suppliers: [\r\n      { id: 's1', name: 'Florister√≠a Las Rosas', category: 'Flores' },\r\n      { id: 's2', name: 'DJ Max', category: 'M√∫sica' },\r\n    ],\r\n    timeline: [\r\n      { label: 'Ceremonia', time: '17:00' },\r\n      { label: 'C√≥ctel', time: '18:30' },\r\n      { label: 'Banquete', time: '20:00' },\r\n    ],\r\n    designs: [\r\n      { id: 'des1', type: 'Invitaci√≥n', name: 'Invitaci√≥n Floral' },\r\n      { id: 'des2', type: 'Logo', name: 'Monograma A&L' },\r\n      { id: 'des3', type: 'Menu', name: 'Men√∫ Vintage' }\r\n    ],\r\n    seatingPlanPdf: '/docs/seating-plan-demo.pdf',\r\n\r\n    specialMoments: [\r\n      { id: 'm1', title: 'Primer baile', time: '22:00' },\r\n      { id: 'm2', title: 'Corte de tarta', time: '23:00' }\r\n    ],\r\n    readings: [\r\n      { id: 'r1', title: 'Lectura 1: Carta de Corintios' },\r\n      { id: 'r2', title: 'Lectura 2: Soneto XVII' }\r\n    ],\r\n    expenses: [\r\n      { id: 'e1', concept: 'Flores', amount: 1200 },\r\n      { id: 'e2', concept: 'M√∫sica', amount: 800 },\r\n      { id: 'e3', concept: 'Fotograf√≠a', amount: 1500 }\r\n    ],\r\n    ideas: [\r\n      { id: 'i1', name: 'Inspiraci√≥n decoraci√≥n' },\r\n      { id: 'i2', name: 'Paleta de colores' }\r\n    ],\r\n    documents: [\r\n      { id: 'd1', name: 'Contrato Lugar.pdf' },\r\n      { id: 'd2', name: 'Men√∫.pdf' },\r\n    ],\r\n  };\r\n  return Promise.resolve(mock);\r\n}\r\n\r\nfunction formatDateEs(dateVal) {\r\n  if (!dateVal) return '';\r\n  try {\r\n    if (typeof dateVal === 'string') return dateVal;\r\n    if (dateVal.seconds) return new Date(dateVal.seconds * 1000).toLocaleDateString('es-ES');\r\n    return new Date(dateVal).toLocaleDateString('es-ES');\r\n  } catch {\r\n    return '';\r\n  }\r\n}\r\n\r\nexport default function BodaDetalle() {\r\n  const { id } = useParams();\r\n  const { currentUser } = useAuth();\r\n  const role = currentUser?.role;\r\n  const [wedding, setWedding] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const navigate = useNavigate();\r\n  const DESIGN_ITEMS = [\r\n    { key: 'web', label: 'P√°gina web' },\r\n    { key: 'invitaci√≥n', label: 'Invitaciones' },\r\n    { key: 'seating', label: 'Seating plan' },\r\n    { key: 'menu', label: 'Men√∫' },\r\n    { key: 'logo', label: 'Logo' },\r\n  ];\r\n\r\n  useEffect(() => {\r\n    if (!id) return;\r\n    setLoading(true);\r\n    const unsubs = [];\r\n\r\n    // Document principal de la boda\r\n    const unsubDoc = onSnapshot(doc(db, 'weddings', id), (snap) => {\r\n      if (!snap.exists()) {\r\n        setWedding(null);\r\n        setLoading(false);\r\n        return;\r\n      }\r\n      const data = snap.data();\r\n      const emptyLists = {\r\n        guests: [],\r\n        tasks: [],\r\n        suppliers: [],\r\n        timeline: [],\r\n        designs: [],\r\n        seatingPlan: [],\r\n        specialMoments: [],\r\n        readings: [],\r\n        expenses: [],\r\n        ideas: [],\r\n        documents: [],\r\n      };\r\n      setWedding(prev => {\r\n        const defaults = prev ? {} : emptyLists; // S√≥lo la primera vez para inicializar arrays\r\n        return {\r\n          ...defaults,\r\n          ...(prev || {}),\r\n           // Excluimos posibles arrays vac√≠os o desactualizados del documento principal\r\n           ...(() => {\r\n             const {\r\n               seatingPlan: _sp,\r\n               guests: _g,\r\n               suppliers: _sup,\r\n               tasks: _ts,\r\n               timeline: _tl,\r\n               designs: _ds,\r\n               specialMoments: _sm,\r\n               readings: _rd,\r\n               expenses: _ex,\r\n               ideas: _id,\r\n               documents: _doc,\r\n               ...rest\r\n             } = data;\r\n             return rest; // s√≥lo los campos at√≥micos\r\n           })(),\r\n          id: snap.id,\r\n          name: data.name || data.brideAndGroom || data.coupleName || data.nombrePareja || data.couple || data.brideAndGroomName || '',\r\n          date: data.weddingDate || data.date || data.fecha || data.fechaBoda || data.ceremonyDate || '',\r\n          location: data.location || data.celebrationPlace || data.ceremonyLocation || data.place || data.venue || '',\r\n        };\r\n      });\r\n\r\n      // Obtener informaci√≥n adicional del subdocumento weddingInfo (primer doc de la subcolecci√≥n)\r\n      onSnapshot(collection(db, 'weddings', id, 'weddingInfo'), (infoSnap) => {\r\n        if (infoSnap.empty) return;\r\n        const info = infoSnap.docs[0].data() || {};\r\n        setWedding(prev => ({\r\n          ...(prev || {}),\r\n          ...info,\r\n          name: info.brideAndGroom || info.coupleName || prev?.name || '',\r\n          date: info.weddingDate || info.date || prev?.date || '',\r\n          location: info.celebrationPlace || info.ceremonyLocation || prev?.location || '',\r\n        }));\r\n      }, (err) => console.error('üî• ERROR weddingInfo col:', err));\r\n\r\n    }, (err) => {\r\n      console.error('üî• ERROR doc weddings:', err);\r\n      if (err.code === 'permission-denied') {\r\n        window.mostrarErrorUsuario?.('No tienes permisos para ver esta boda', 8000);\r\n      }\r\n    });\r\n    unsubs.push(unsubDoc);\r\n\r\n\r\n    // unsubs.push(unsubInfo);\r\n\r\n    // Helper para escuchar subcolecciones y guardar en estado\r\n    const listenSub = (colPath, stateKey) => {\r\n      // Alias retrocompatibilidad: algunos bundles antiguos a√∫n esperan colName\r\n      const colName = colPath;\r\n      const unsub = onSnapshot(collection(db, 'weddings', id, ...colPath.split('/')), (colSnap) => {\r\n        const list = colSnap.docs\r\n      .map((d) => ({ id: d.id, ...d.data() }))\r\n      // Filtrar documentos \"vac√≠os\" (s√≥lo id, sin m√°s campos)\r\n      .filter((doc) => {\r\n        // Excluir documentos que carezcan de datos significativos\r\n        const meaningfulKeys = Object.keys(doc).filter(k => !['id','createdAt','updatedAt'].includes(k));\r\n        if (meaningfulKeys.length === 0) return false;\r\n        // Validaci√≥n de documentos:\r\n        // - Para proveedores (suppliers) exigimos la presencia del campo \"name\".\r\n        // - Para invitados (guests) aceptamos \"name\" o \"nombre\".\r\n        if (stateKey === 'suppliers' && !doc.name) return false;\r\n        if (stateKey === 'guests' && !(doc.name || doc.nombre)) return false;\r\n        return true;\r\n      });\r\n        console.debug(`‚¨ÖÔ∏è Subcolecci√≥n ${colPath} (${stateKey}) docs filtrados:`, list.length);\r\n\r\n        setWedding(prev => ({ ...(prev || {}), [stateKey]: list }));\r\n      }, (err) => {\r\n        console.error(`üî• ERROR sub ${colPath}:`, err);\r\n      });\r\n      unsubs.push(unsub);\r\n    };\r\n\r\n    listenSub('guests', 'guests');\r\n    listenSub('tasks', 'tasks');\r\n    listenSub('suppliers', 'suppliers');\r\n    listenSub('timeline', 'timeline');\r\n    listenSub('designs', 'designs');\r\n    listenSub('seatingPlan/banquet/tables', 'seatingPlan');\r\n    listenSub('specialMoments', 'specialMoments');\r\n    listenSub('readings', 'readings');\r\n    listenSub('expenses', 'expenses');\r\n    listenSub('ideas', 'ideas');\r\n    listenSub('documents', 'documents');\r\n\r\n    setLoading(false);\r\n\r\n    return () => {\r\n      unsubs.forEach((fn) => fn && fn());\r\n    };\r\n  }, [id]);\r\n\r\n  const banquetTables = wedding?.seatingPlan || [];\r\n  // ---- Ajuste de escala y desplazamiento para la mini-preview ----\r\n  // Calculamos scale din√°micamente para que todo el plano quepa en la vista  (m√°x 600x360)\r\n  const previewScale = React.useMemo(() => {\r\n    if (banquetTables.length === 0) return 0.6;\r\n    const diam = t => t.diameter || Math.max(t.width || 0, t.height || t.length || 0) || 80;\r\n    const minX = Math.min(...banquetTables.map(t => (t.x ?? 0)));\r\n    const minY = Math.min(...banquetTables.map(t => (t.y ?? 0)));\r\n    const maxX = Math.max(...banquetTables.map(t => (t.x ?? 0) + diam(t)));\r\n    const maxY = Math.max(...banquetTables.map(t => (t.y ?? 0) + diam(t)));\r\n\r\n    const boundingW = maxX - minX + 80; // + margen interno\r\n    const boundingH = maxY - minY + 80;\r\n    const maxW = 600; // ancho aproximado del contenedor (w-full con padding)\r\n    const maxH = 360; // h-96 (~384) menos padding\r\n    const scale = Math.min(maxW / boundingW, maxH / boundingH, 0.8);\r\n    return scale < 0.2 ? 0.2 : scale; // l√≠mite m√≠nimo para legibilidad\r\n  }, [banquetTables]);\r\n  const previewOffset = React.useMemo(() => {\r\n    if (banquetTables.length === 0) return { x: 0, y: 0 };\r\n    const minX = Math.min(...banquetTables.map(t => (t.x ?? 0)));\r\n    const minY = Math.min(...banquetTables.map(t => (t.y ?? 0)));\r\n    // Dejamos un peque√±o margen interno (40 px)\r\n    return { x: -minX * previewScale + 40, y: -minY * previewScale + 40 };\r\n  }, [banquetTables]);\r\n  /*\r\n  \r\n\r\n  \r\n    if (!wedding) return;\r\n    if (wedding.seatingPlanPdf) {\r\n      (null);\r\n      return;\r\n    }\r\n    if (banquetTables.length === 0) return;\r\n    // Generar PDF listado sencillo de mesas e invitados\r\n    \r\n    \r\n    pdf.text('Seating Plan ‚Äì Banquete', 40, 40);\r\n    pdf.setFontSize(11);\r\n    let y = 70;\r\n    banquetTables.forEach((t) => {\r\n      const line = `${t.name || t.table || 'Mesa'}: ${(Array.isArray(t.seats) ? t.seats : t.assignedGuests || []).join(', ')}`;\r\n      const lines = pdf.splitTextToSize(line, 500);\r\n      lines.forEach((l) => {\r\n        if (y > 750) { pdf.addPage(); y = 40; }\r\n        pdf.text(l, 40, y);\r\n        y += 18;\r\n      });\r\n    });\r\n    \r\n    \r\n*/\r\n  \r\n  if (loading) return <p>Cargando detalle...</p>;\r\n  if (!wedding) return <p>No se encontr√≥ la boda.</p>;\r\n\r\n  return (\r\n    <div className=\"p-4 md:p-6 max-w-4xl mx-auto space-y-6\">\r\n      <button\r\n        onClick={() => navigate(-1)}\r\n        className=\"flex items-center text-rose-600 hover:underline\"\r\n      >\r\n        <ArrowLeft size={18} className=\"mr-1\" /> Volver\r\n      </button>\r\n\r\n      <h1 className=\"text-2xl md:text-3xl font-bold text-gray-800\">{wedding.name?.trim() ? wedding.name : 'Boda sin nombre'}</h1>\r\n      <p className=\"text-gray-600\">\r\n        {formatDateEs(wedding.date)}{wedding.location ? ` ¬∑ ${wedding.location}` : ''}\r\n      </p>\r\n\r\n      {/* Informaci√≥n de la pareja */}\r\n      {(wedding.bride || wedding.groom || wedding.coupleName) && (\r\n        <p className=\"text-gray-700 mt-1\">\r\n          {wedding.coupleName || `${wedding.bride || ''}${wedding.bride && wedding.groom ? ' & ' : ''}${wedding.groom || ''}`}\r\n        </p>\r\n      )}\r\n\r\n      {/* Informaci√≥n adicional */}\r\n      {(wedding.schedule || wedding.celebrationPlace || wedding.banquetPlace) && (\r\n        <div className=\"text-sm text-gray-600 mt-2 space-y-1\">\r\n          {wedding.schedule && <p>Horario: {wedding.schedule}</p>}\r\n          {wedding.celebrationPlace && <p>Ceremonia: {wedding.celebrationPlace}</p>}\r\n          {wedding.banquetPlace && <p>Banquete: {wedding.banquetPlace}</p>}\r\n        </div>\r\n      )}\r\n\r\n      {/* Barra de progreso */}\r\n      <div className=\"mt-4\">\r\n        <div className=\"flex justify-between text-sm mb-1\">\r\n          <span>Progreso</span>\r\n          <span className=\"font-medium\">{wedding.progress}%</span>\r\n        </div>\r\n        <Progress value={wedding.progress} className=\"h-3\" />\r\n      </div>\r\n\r\n      {/* Resumen m√©tricas */}\r\n      <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\r\n        <Card className=\"text-center cursor-pointer\" onClick={() => navigate('/invitados')}>\r\n          <p className=\"text-sm text-gray-500\">Invitados</p>\r\n          <p className=\"text-2xl font-bold text-gray-800\">{(wedding.guests || []).length}</p>\r\n        </Card>\r\n        <Card className=\"text-center\">\r\n          <p className=\"text-sm text-gray-500\">Tareas pendientes</p>\r\n          <p className=\"text-2xl font-bold text-gray-800\">{(wedding.tasks || []).filter(t=>!t.done).length}</p>\r\n        </Card>\r\n        <Card className=\"text-center cursor-pointer\" onClick={() => navigate('/proveedores')}>\r\n          <p className=\"text-sm text-gray-500\">Proveedores</p>\r\n          <p className=\"text-2xl font-bold text-gray-800\">{(wedding.suppliers || []).length}</p>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Contenido principales secciones */}\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6\">\r\n\r\n        \r\n\r\n        {/* Ideas */}\r\n        <div className=\"bg-white rounded shadow-sm p-4\">\r\n          <div className=\"flex items-center justify-between mb-2\">\r\n            <h3 className=\"text-lg font-semibold\">Ideas</h3>\r\n            <button\r\n              onClick={() => navigate('/ideas')}\r\n              className=\"text-blue-600 text-sm hover:underline\"\r\n            >\r\n              Gestionar\r\n            </button>\r\n          </div>\r\n          <ul className=\"list-disc list-inside space-y-1 max-h-60 overflow-y-auto text-sm\">\r\n            {(wedding.ideas || []).map((i) => (\r\n              <li key={i.id}>{i.name || i.title}</li>\r\n            ))}\r\n            {wedding.ideas.length === 0 && <li className=\"text-gray-500\">Sin ideas</li>}\r\n          </ul>\r\n        </div>\r\n      </div>\r\n\r\n      {role==='planner' && (\r\n        <section>\r\n         <div className=\"flex items-center justify-between mb-2\">\r\n           <h2 className=\"text-xl font-semibold\">Disposici√≥n de Mesas</h2>\r\n           {wedding.seatingPlanPdf && (\r\n             <a href={wedding.seatingPlanPdf} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-rose-600 hover:underline text-sm\" onClick={e=>e.stopPropagation() }>Descargar PDF</a>\r\n           )}\r\n         </div>\r\n         {/* Vista previa clickable */}\r\n         <div\r\n           className=\"border rounded-md overflow-hidden cursor-pointer hover:ring-2 hover:ring-rose-400 transition\"\r\n           onClick={() => navigate('/invitados/seating')}\r\n         >\r\n           {banquetTables.length > 0 ? (\r\n              <div className=\"relative w-full h-96\">\r\n                <DndProvider backend={HTML5Backend}>\r\n                 <SeatingCanvas\r\n                   tab=\"banquet\"\r\n                   areas={[]}\r\n                   tables={banquetTables}\r\n                   guests={wedding.guests || []}\r\n                   seats={[]}\r\n                   scale={previewScale}\r\n                   offset={previewOffset}\r\n                   addArea={() => {}}\r\n                   onDeleteArea={() => {}}\r\n                   moveTable={() => {}}\r\n                   onAssignGuest={() => {}}\r\n                   onToggleEnabled={() => {}}\r\n                   setConfigTable={() => {}}\r\n                   online={false}\r\n                   handleWheel={() => {}}\r\n                   handlePointerDown={() => {}}\r\n                   onSelectTable={() => {}}\r\n                   drawMode=\"none\"\r\n                   canPan={false}\r\n                   canMoveTables={false}\r\n                   onToggleSeat={() => {}}\r\n                 />\r\n                 </DndProvider>\r\n              </div>\r\n              \r\n              \r\n            ) : wedding.seatingPlanImage ? (\r\n             <img src={wedding.seatingPlanImage} alt=\"Plano de mesas\" className=\"w-full block\" />\r\n           ) : banquetTables.length > 0 ? (\r\n             <div className=\"p-4 space-y-1 text-sm\">\r\n               {banquetTables.map((t) => (\r\n                 <div key={t.id || t.table || t.name} className=\"flex justify-between border-b py-0.5\">\r\n                   <span className=\"font-medium\">{t.name || t.table || `Mesa ${t.id}`}</span>\r\n                   <span className=\"text-gray-500\">{Array.isArray(t.seats) ? t.seats.length : (t.assignedGuests?.length || 0)} invitados</span>\r\n                 </div>\r\n               ))}\r\n             </div>\r\n           ) : (\r\n             <div className=\"p-6 text-center text-gray-500 text-sm\">Haz clic para editar el plano de mesas</div>\r\n           )}\r\n         </div>\r\n       </section>\r\n        )}\r\n\r\n      {/* Dise√±os */}\r\n      <section>\r\n        <h2 className=\"text-xl font-semibold mb-2\">Dise√±os</h2>\r\n        <ul className=\"space-y-1\">\r\n          {DESIGN_ITEMS.map((item) => {\r\n            const done = (wedding.designs || []).some((d) => d.type?.toLowerCase().includes(item.key));\r\n            return (\r\n              <li key={item.key} className=\"flex items-center bg-white rounded-md p-3 shadow-sm\">\r\n                {done ? (\r\n                  <CheckCircle className=\"text-green-600 w-5 h-5 mr-2\" />\r\n                ) : (\r\n                  <Circle className=\"text-gray-400 w-5 h-5 mr-2\" />\r\n                )}\r\n                <span className={done ? 'text-green-700 font-medium' : 'text-gray-700'}>{item.label}</span>\r\n              </li>\r\n            );\r\n          })}\r\n        </ul>\r\n      </section>\r\n\r\n      {/* Momentos Especiales */}\r\n      <section>\r\n        <h2 className=\"text-xl font-semibold mb-2\">Momentos Especiales</h2>\r\n        <ul className=\"space-y-1\">\r\n          {wedding.specialMoments.map((m) => (\r\n            <li key={m.id} className=\"flex justify-between bg-white rounded-md p-3 shadow-sm\">\r\n              <span>{m.title}</span>\r\n              <span className=\"font-medium text-gray-500\">{m.time}</span>\r\n            </li>\r\n          ))}\r\n        </ul>\r\n      </section>\r\n\r\n      {/* Checklist */}\r\n      <section>\r\n        <h2 className=\"text-xl font-semibold mb-2\">Checklist</h2>\r\n        <ul className=\"space-y-1\">\r\n          {wedding.tasks.map((t) => (\r\n            <li key={t.id} className=\"flex justify-between bg-white rounded-md p-3 shadow-sm\">\r\n              <span>{t.title}</span>\r\n              <span className={`font-medium ${t.done ? 'text-green-600' : 'text-rose-600'}`}>{t.done ? 'Hecho' : 'Pendiente'}</span>\r\n            </li>\r\n          ))}\r\n        </ul>\r\n      </section>\r\n\r\n      {/* Gastos */}\r\n      <section>\r\n        <h2 className=\"text-xl font-semibold mb-2\">Gastos</h2>\r\n        <ul className=\"space-y-1\">\r\n          {wedding.expenses.map((e) => (\r\n            <li key={e.id} className=\"flex justify-between bg-white rounded-md p-3 shadow-sm\">\r\n              <span>{e.concept}</span>\r\n              <span className=\"font-medium text-gray-800\">‚Ç¨ {e.amount.toLocaleString()}</span>\r\n            </li>\r\n          ))}\r\n        </ul>\r\n        <p className=\"text-right font-semibold mt-2\">Total: ‚Ç¨ {wedding.expenses.reduce((acc, e) => acc + e.amount, 0).toLocaleString()}</p>\r\n      </section>\r\n\r\n      {/* L√≠nea de tiempo b√°sica */}\r\n      <section>\r\n        <h2 className=\"text-xl font-semibold mb-2\">Timing</h2>\r\n        <ul className=\"space-y-1\">\r\n          {wedding.timeline.map((item, idx) => (\r\n            <li key={idx} className=\"flex justify-between bg-white rounded-md p-3 shadow-sm\">\r\n              <span>{item.label}</span>\r\n              <span className=\"font-medium\">{item.time}</span>\r\n            </li>\r\n          ))}\r\n        </ul>\r\n      </section>\r\n\r\n      {/* Documentos */}\r\n      <section>\r\n        <h2 className=\"text-xl font-semibold mb-2\">Documentos</h2>\r\n        <ul className=\"space-y-1\">\r\n          {(wedding.documents || []).map((d) => (\r\n            <li key={d.id} className=\"flex justify-between bg-white rounded-md p-3 shadow-sm\">\r\n              <span>{d.name}</span>\r\n              {d.url && (\r\n                <a href={d.url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-600 underline\">Ver</a>\r\n              )}\r\n            </li>\r\n          ))}\r\n        </ul>\r\n      </section>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\Bodas.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'currentUser' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":13,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":22},{"ruleId":"no-undef","severity":2,"message":"'user' is not defined.","line":30,"column":22,"nodeType":"Identifier","messageId":"undef","endLine":30,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'user' is not defined.","line":51,"column":10,"nodeType":"Identifier","messageId":"undef","endLine":51,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'user' is not defined.","line":52,"column":87,"nodeType":"Identifier","messageId":"undef","endLine":52,"endColumn":91},{"ruleId":"no-undef","severity":2,"message":"'user' is not defined.","line":94,"column":7,"nodeType":"Identifier","messageId":"undef","endLine":94,"endColumn":11},{"ruleId":"no-undef","severity":2,"message":"'user' is not defined.","line":117,"column":10,"nodeType":"Identifier","messageId":"undef","endLine":117,"endColumn":14}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { collection, onSnapshot, query, where, getDoc, doc, addDoc, setDoc, serverTimestamp } from 'firebase/firestore';\r\nimport { db } from '../firebaseConfig';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport WeddingFormModal from '../components/WeddingFormModal';\r\nimport { Card } from '../components/ui/Card';\r\nimport { Progress } from '../components/ui/Progress';\r\nimport { useAuth } from '../hooks/useAuth';\r\nimport { useWedding } from '../context/WeddingContext';\r\n\r\n\r\nexport default function Bodas() {\r\n  const { currentUser } = useAuth();\r\n  const { setActiveWedding } = useWedding();\r\n  const [weddings, setWeddings] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [showCreateModal, setShowCreateModal] = useState(false);\r\n  const [tab, setTab] = useState('active');\r\n  const navigate = useNavigate();\r\n\r\n  const crearBoda = async (values) => {\r\n    try {\r\n      const newDoc = await addDoc(collection(db, 'weddings'), {\r\n        name: values.name,\r\n        weddingDate: values.date || '',\r\n        location: values.location || '',\r\n        banquetPlace: values.banquetPlace || '',\r\n        createdAt: serverTimestamp(),\r\n        ownerIds: [],\r\n        plannerIds: [user.uid],\r\n        assistantIds: [],\r\n        progress: 0,\r\n        active: true,\r\n      });\r\n      // Inicializar subcolecci√≥n de finanzas\r\n      try {\r\n        const financeRef = doc(db, 'weddings', newDoc.id, 'finance', 'main');\r\n        await setDoc(financeRef, { movements: [], createdAt: serverTimestamp() }, { merge: true });\r\n      } catch (e) {\r\n        console.warn('No se pudo inicializar finance/main para', newDoc.id, e);\r\n      }\r\n      setActiveWedding(newDoc.id);\r\n      navigate(`/bodas/${newDoc.id}`);\r\n    } catch (err) {\r\n      console.error('Error creando nueva boda:', err);\r\n      alert('No se pudo crear la boda. Revise permisos.');\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!user?.uid) return;\r\n    const q = query(collection(db, 'weddings'), where('plannerIds', 'array-contains', user.uid));\r\n    const unsub = onSnapshot(q, (snap) => {\r\n      const data = snap.docs.map((d) => ({ id: d.id, ...d.data() }));\r\n\r\n      // Enriquecer con weddingInfo del primer owner si faltan campos\r\n      Promise.all(\r\n        data.map(async (w) => {\r\n          if ((w.name && w.weddingDate) || !Array.isArray(w.ownerIds) || w.ownerIds.length === 0) return w;\r\n          try {\r\n            const ownerId = w.ownerIds[0];\r\n            const profileSnap = await getDoc(doc(db, 'users', ownerId));\r\n            if (profileSnap.exists()) {\r\n              const info = profileSnap.data().weddingInfo || {};\r\n              return {\r\n                ...w,\r\n                name: w.name || info.coupleName || 'Boda sin nombre',\r\n                date: w.weddingDate || info.date || '',\r\n                location: w.location || info.celebrationPlace || info.ceremonyLocation || '',\r\n              };\r\n            }\r\n          } catch (e) {\r\n            console.warn('No se pudo obtener weddingInfo del owner', e);\r\n          }\r\n          return w;\r\n        })\r\n      ).then((list) => {\r\n        const ordered = list.sort((a, b) => (a.active === b.active ? 0 : a.active ? -1 : 1));\r\n        setWeddings(\r\n          ordered.map((w) => ({\r\n            id: w.id,\r\n            name: w.name || 'Boda sin nombre',\r\n            date: w.weddingDate || w.date || '',\r\n            location: w.location || '',\r\n            progress: w.progress ?? 0,\r\n            active: w.active ?? true,\r\n          }))\r\n        );\r\n        setLoading(false);\r\n      });\r\n\r\n    });\r\n    return () => unsub();\r\n  }, [user]);\r\n\r\n    const today = new Date();\r\n  const activeWeddings = weddings.filter((w) => {\r\n    if (!w.date) return true; // sin fecha = activa\r\n    const d = new Date(w.date);\r\n    return isNaN(d) ? true : d >= today;\r\n  });\r\n  const pastWeddings = weddings.filter((w) => {\r\n    if (!w.date) return false;\r\n    const d = new Date(w.date);\r\n    return !isNaN(d) && d < today;\r\n  });\r\n  const weddingsToShow = tab === 'active' ? activeWeddings : pastWeddings;\r\n\r\n  if (loading) {\r\n    return <p>Cargando bodas...</p>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 md:p-6 max-w-7xl mx-auto space-y-8\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <h1 className=\"text-2xl md:text-3xl font-bold text-gray-800\">Mis Bodas</h1>\r\n        {user?.role === 'planner' && (\r\n          <button\r\n            onClick={() => setShowCreateModal(true)}\r\n            className=\"bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium px-4 py-2 rounded shadow\"\r\n          >\r\n            + Crear nueva boda\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      {/* Tabs */}\r\n      <div className=\"flex gap-2 mb-4\">\r\n        <button\r\n          onClick={() => setTab('active')}\r\n          className={`px-4 py-1 rounded font-medium ${tab==='active' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}`}\r\n        >\r\n          Bodas activas\r\n        </button>\r\n        <button\r\n          onClick={() => setTab('past')}\r\n          className={`px-4 py-1 rounded font-medium ${tab==='past' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}`}\r\n        >\r\n          Bodas pasadas\r\n        </button>\r\n      </div>\r\n\r\n      {weddingsToShow.length === 0 ? (\r\n        <p>No tienes bodas asignadas todav√≠a.</p>\r\n      ) : (\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n          {weddingsToShow.map((wed) => (\r\n            <Card\r\n              key={wed.id}\r\n              className=\"cursor-pointer hover:shadow-md transition-shadow flex flex-col justify-between\"\r\n              onClick={() => {\r\n                setActiveWedding(wed.id);\r\n                navigate(`/bodas/${wed.id}`);\r\n              }}\r\n            >\r\n              <div className=\"space-y-2\">\r\n                <h2 className=\"text-lg font-semibold text-gray-800\">{wed.name}</h2>\r\n                <p className=\"text-sm text-gray-600\">\r\n                  {wed.date} ¬∑ {wed.location}\r\n                </p>\r\n              </div>\r\n              {/* Barra de progreso */}\r\n              <div className=\"mt-4\">\r\n                <div className=\"flex justify-between text-sm mb-1\">\r\n                  <span>Progreso</span>\r\n                  <span className=\"font-medium\">{wed.progress}%</span>\r\n                </div>\r\n                <Progress value={wed.progress} className=\"h-2\" />\r\n              </div>\r\n            </Card>\r\n          ))}\r\n        </div>\r\n      )}\r\n          <WeddingFormModal\r\n        open={showCreateModal}\r\n        onClose={() => setShowCreateModal(false)}\r\n        onSave={crearBoda}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\Buzon_fixed_final.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\Checklist.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Edit2' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'Filter' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":39},{"ruleId":"no-unused-vars","severity":1,"message":"'setView' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":8,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'toggleSelect' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":43,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":43,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Plus, Edit2, Download, Filter, CheckCircle, Circle } from 'lucide-react';\r\nimport PageWrapper from '../components/PageWrapper';\r\nimport Card from '../components/Card';\r\nimport Button from '../components/Button';\r\n\r\nexport default function Checklist() {\r\n  const [view, setView] = useState('list');\r\n  const [search, setSearch] = useState('');\r\n  const [typeFilter, setTypeFilter] = useState('');\r\n  const [responsibleFilter, setResponsibleFilter] = useState('');\r\n  const [dateFilter, setDateFilter] = useState({ from: '', to: '' });\r\n  const [selected, setSelected] = useState([]);\r\n  const [showNewModal, setShowNewModal] = useState(false);\r\n  const [completed, setCompleted] = useState(() => {\r\n    try {\r\n      return JSON.parse(localStorage.getItem('checklistCompleted') || '{}');\r\n    } catch {\r\n      return {};\r\n    }\r\n  });\r\n\r\n  // Actualizar localStorage cuando cambie el estado de completadas\r\n  useEffect(() => {\r\n    localStorage.setItem('checklistCompleted', JSON.stringify(completed));\r\n  }, [completed]);\r\n\r\n  const blocks = [\r\n    {\r\n      name: 'D√≠a Previo a la Boda',\r\n      tasks: [\r\n        { id: 1, title: 'Ensayo general', type: 'ensayo', responsible: 'Equipo', due: '2025-06-17', status: 'Pendiente' }\r\n      ]\r\n    },\r\n    {\r\n      name: 'Antes de empezar la boda',\r\n      tasks: [\r\n        { id: 2, title: 'Alinear decoraciones', type: 'montaje', responsible: 'Rollout', due: '2025-06-18', status: 'En progreso' }\r\n      ]\r\n    }\r\n  ];\r\n\r\n  const toggleSelect = id => {\r\n    setSelected(prev => prev.includes(id) ? prev.filter(x => x !== id) : [...prev, id]);\r\n  };\r\n\r\n  const toggleCompleted = id => {\r\n    setCompleted(prev => ({ ...prev, [id]: !prev[id] }));\r\n  };\r\n\r\n  return (\r\n    <PageWrapper title=\"Checklist\">\r\n      <div className=\"space-y-8\">\r\n      \r\n\r\n      {/* Controles */}\r\n      <div className=\"flex flex-wrap gap-2 items-center\">\r\n        <input type=\"text\" placeholder=\"Buscar tarea\" value={search} onChange={e => setSearch(e.target.value)} className=\"border rounded px-2 py-1\" />\r\n        <select value={typeFilter} onChange={e => setTypeFilter(e.target.value)} className=\"border rounded px-2 py-1\">\r\n          <option value=\"\">Tipo</option>\r\n          <option value=\"ensayo\">Ensayo</option>\r\n          <option value=\"montaje\">Montaje</option>\r\n          <option value=\"audio/v√≠deo\">Audio/V√≠deo</option>\r\n        </select>\r\n        <select value={responsibleFilter} onChange={e => setResponsibleFilter(e.target.value)} className=\"border rounded px-2 py-1\">\r\n          <option value=\"\">Responsable</option>\r\n          <option value=\"Equipo\">Equipo</option>\r\n          <option value=\"Rollout\">Rollout</option>\r\n        </select>\r\n        <input type=\"date\" value={dateFilter.from} onChange={e => setDateFilter(prev => ({...prev, from: e.target.value}))} className=\"border rounded px-2 py-1\" />\r\n        <input type=\"date\" value={dateFilter.to} onChange={e => setDateFilter(prev => ({...prev, to: e.target.value}))} className=\"border rounded px-2 py-1\" />\r\n\r\n        <button onClick={() => setShowNewModal(true)} className=\"bg-blue-600 text-white px-3 py-1 rounded flex items-center\">\r\n          <Plus size={16} className=\"mr-1\" /> Nueva Tarea\r\n        </button>\r\n      </div>\r\n\r\n      {/* Bulk Actions */}\r\n      {selected.length > 0 && (\r\n        <div className=\"bg-gray-100 p-2 rounded flex gap-2\">\r\n          <button className=\"bg-green-600 text-white px-2 py-1 rounded\">Cambiar estado ({selected.length})</button>\r\n          <button className=\"bg-purple-600 text-white px-2 py-1 rounded flex items-center\">\r\n            <Download size={16} className=\"mr-1\" /> Exportar CSV\r\n          </button>\r\n        </div>\r\n      )}\r\n\r\n      {/* Vista Lista */}\r\n      {view === 'list' && (\r\n        <table className=\"w-full table-auto\">\r\n          <thead className=\"bg-gray-50\">\r\n            <tr>\r\n              <th></th>\r\n              <th>Tarea</th>\r\n              <th>Tipo</th>\r\n              <th>Responsable</th>\r\n              <th>Fecha l√≠mite</th>\r\n              <th>Estado</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {blocks.flatMap(block =>\r\n              block.tasks.map(t => (\r\n                <tr key={t.id} className={completed[t.id] ? 'opacity-60 line-through' : ''}>\r\n                  <td>\r\n                    <button aria-label=\"Marcar completada\" onClick={() => toggleCompleted(t.id)} className=\"focus:outline-none\">\r\n                      {completed[t.id] ? <CheckCircle className=\"text-green-600\" size={20} /> : <Circle className=\"text-gray-400\" size={20} />}\r\n                    </button>\r\n                  </td>\r\n                  <td>{t.title}</td>\r\n                  <td>{t.type}</td>\r\n                  <td>{t.responsible}</td>\r\n                  <td>{t.due}</td>\r\n                  <td>{completed[t.id] ? 'Completada' : t.status}</td>\r\n                </tr>\r\n              ))\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      )}\r\n\r\n\r\n\r\n      {/* Modal Nueva Tarea */}\r\n      {showNewModal && (\r\n        <div className=\"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50\">\r\n          <Card className=\"p-4 shadow w-80\">\r\n            <h3 className=\"font-semibold mb-2\">Nueva Tarea</h3>\r\n            {/* TODO: formulario */}\r\n            <Button variant=\"danger\" onClick={() => setShowNewModal(false)} className=\"mt-2\">Cerrar</Button>\r\n          </Card>\r\n        </div>\r\n      )}\r\n      </div>\r\n    </PageWrapper>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\Contratos.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'updateContract' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":13,"column":62,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":76},{"ruleId":"no-unused-vars","severity":1,"message":"'deleteContract' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":13,"column":90,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":104}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { useFirestoreCollection } from '../hooks/useFirestoreCollection';\r\nimport { Plus, Download, Eye, ChevronDown, ChevronUp } from 'lucide-react';\r\nimport Toast from '../components/Toast';\r\nimport PageWrapper from '../components/PageWrapper';\r\nimport Card from '../components/Card';\r\n\r\nexport default function Contratos() {\r\n  const sampleContracts = [\r\n    { id: 1, provider: 'Eventos Catering', type: 'Catering', signedDate: '2025-04-01', serviceDate: '2025-06-10', status: 'Vigente', docUrl: '#' },\r\n    { id: 2, provider: 'Flores y Dise√±o', type: 'Flores', signedDate: '2025-03-15', serviceDate: '2025-06-12', status: 'Vigente', docUrl: '#' },\r\n  ];\r\n  const { data: contracts, addItem: addContract, updateItem: updateContract, deleteItem: deleteContract } = useFirestoreCollection('contracts', sampleContracts);\r\n  // selected state keeps ids locally\r\n  const [selected, setSelected] = useState([]);\r\n  const [showAddModal, setShowAddModal] = useState(false);\r\n  const [toast, setToast] = useState(null);\r\n  const initialContract = { provider: '', type: '', signedDate: '', serviceDate: '', status: '', docUrl: '' };\r\n  const [newContract, setNewContract] = useState(initialContract);\r\n\r\n  const handleAddContract = async e => {\r\n    e.preventDefault();\r\n    const contractObj = { id: `ct${Date.now()}`, ...newContract, docUrl: newContract.docUrl || '#' };\r\n    await addContract(contractObj);\r\n    setNewContract(initialContract);\r\n    setShowAddModal(false);\r\n    setToast({ message: 'Contrato agregado', type: 'success' });\r\n  };\r\n\r\n  const isNearExpiry = date => {\r\n    const today = new Date();\r\n    const svc = new Date(date);\r\n    const diff = (svc - today) / (1000 * 60 * 60 * 24);\r\n    return diff >= 0 && diff <= 7;\r\n  };\r\n\r\n  const toggleSelect = id => {\r\n    setSelected(prev =>\r\n      prev.includes(id) ? prev.filter(x => x !== id) : [...prev, id]\r\n    );\r\n  };\r\n\r\n  const exportSelected = () => {\r\n    console.log('Export contracts:', selected);\r\n  };\r\n\r\n  const actionButtons = (\r\n    <>\r\n      <button\r\n        onClick={() => setShowAddModal(true)}\r\n        className=\"bg-blue-600 text-white px-4 py-2 rounded flex items-center\"\r\n      >\r\n        <Plus size={16} className=\"mr-2\" /> A√±adir Contrato\r\n      </button>\r\n      <button\r\n        onClick={exportSelected}\r\n        className=\"bg-gray-200 px-4 py-2 rounded flex items-center\"\r\n      >\r\n        <Download size={16} className=\"mr-2\" /> Exportar Seleccionados\r\n      </button>\r\n    </>\r\n  );\r\n\r\n  return (\r\n    <PageWrapper title=\"Contratos\" actions={actionButtons}>\r\n      <Card className=\"p-6 space-y-6\">\r\n        {toast && (\r\n          <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />\r\n        )}\r\n        \r\n          \r\n          <div className=\"flex gap-2\">\r\n            <button\r\n              onClick={() => setShowAddModal(true)}\r\n              className=\"bg-blue-600 text-white px-4 py-2 rounded flex items-center\"\r\n            >\r\n              <Plus size={16} className=\"mr-2\" /> A√±adir Contrato\r\n            </button>\r\n            <button\r\n              onClick={exportSelected}\r\n              className=\"bg-gray-200 px-4 py-2 rounded flex items-center\"\r\n            >\r\n              <Download size={16} className=\"mr-2\" /> Exportar Seleccionados\r\n            </button>\r\n          </div>\r\n        {/* Escritorio */}\r\n        <div className=\"hidden md:block overflow-auto\">\r\n          <table className=\"w-full table-auto\">\r\n            <thead>\r\n              <tr className=\"bg-gray-50\">\r\n                <th className=\"p-2\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    onChange={e => setSelected(\r\n                      e.target.checked ? contracts.map(c => c.id) : []\r\n                    )}\r\n                  />\r\n                </th>\r\n                <th className=\"p-2\">Proveedor</th>\r\n                <th className=\"p-2\">Tipo de contrato</th>\r\n                <th className=\"p-2\">Fecha de firma</th>\r\n                <th className=\"p-2\">Fecha de servicio</th>\r\n                <th className=\"p-2\">Estado</th>\r\n                <th className=\"p-2\">Documento</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {contracts.map(c => (\r\n                <tr\r\n                  key={c.id}\r\n                  className={`${isNearExpiry(c.serviceDate) ? 'bg-yellow-100' : ''} border-b`}\r\n                >\r\n                  <td className=\"p-2\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={selected.includes(c.id)}\r\n                      onChange={() => toggleSelect(c.id)}\r\n                    />\r\n                  </td>\r\n                  <td className=\"p-2\">{c.provider}</td>\r\n                  <td className=\"p-2\">{c.type}</td>\r\n                  <td className=\"p-2\">{c.signedDate}</td>\r\n                  <td className=\"p-2\">{c.serviceDate}</td>\r\n                  <td className=\"p-2\">{c.status}</td>\r\n                  <td className=\"p-2\">\r\n                    <a\r\n                      href={c.docUrl}\r\n                      target=\"_blank\"\r\n                      rel=\"noopener noreferrer\"\r\n                      className=\"flex items-center text-blue-600\"\r\n                    >\r\n                      <Eye size={16} className=\"mr-1\" /> Ver\r\n                    </a>\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n\r\n        {/* M√≥vil */}\r\n        <div className=\"block md:hidden space-y-4\">\r\n          {contracts.map(c => (\r\n            <ContractItem\r\n              key={c.id}\r\n              contract={c}\r\n              isSelected={selected.includes(c.id)}\r\n              onToggle={() => toggleSelect(c.id)}\r\n            />\r\n          ))}\r\n        </div>\r\n      </Card>\r\n\r\n      {showAddModal && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center\">\r\n          <div className=\"bg-white p-6 rounded shadow w-96\">\r\n            <h2 className=\"text-xl font-semibold mb-4\">A√±adir Contrato</h2>\r\n            <form onSubmit={handleAddContract} className=\"space-y-3\">\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"Proveedor\"\r\n                value={newContract.provider}\r\n                onChange={e => setNewContract({ ...newContract, provider: e.target.value })}\r\n                className=\"w-full border rounded px-2 py-1\"\r\n                required\r\n              />\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"Tipo de contrato\"\r\n                value={newContract.type}\r\n                onChange={e => setNewContract({ ...newContract, type: e.target.value })}\r\n                className=\"w-full border rounded px-2 py-1\"\r\n                required\r\n              />\r\n              <input\r\n                type=\"date\"\r\n                value={newContract.signedDate}\r\n                onChange={e => setNewContract({ ...newContract, signedDate: e.target.value })}\r\n                className=\"w-full border rounded px-2 py-1\"\r\n                required\r\n              />\r\n              <input\r\n                type=\"date\"\r\n                value={newContract.serviceDate}\r\n                onChange={e => setNewContract({ ...newContract, serviceDate: e.target.value })}\r\n                className=\"w-full border rounded px-2 py-1\"\r\n                required\r\n              />\r\n              <select\r\n                value={newContract.status}\r\n                onChange={e => setNewContract({ ...newContract, status: e.target.value })}\r\n                className=\"w-full border rounded px-2 py-1\"\r\n              >\r\n                <option value=\"\">Seleccionar estado</option>\r\n                <option value=\"Vigente\">Vigente</option>\r\n                <option value=\"Expirado\">Expirado</option>\r\n              </select>\r\n              <div>\r\n                <label className=\"block mb-1\">Documento</label>\r\n                <input\r\n                  type=\"file\"\r\n                  accept=\".pdf,.doc,.docx\"\r\n                  onChange={e => {\r\n                    const file = e.target.files[0];\r\n                    setNewContract({ ...newContract, docUrl: URL.createObjectURL(file) });\r\n                  }}\r\n                  className=\"w-full\"\r\n                />\r\n              </div>\r\n              <div className=\"flex justify-end gap-2\">\r\n                <button type=\"button\" onClick={() => setShowAddModal(false)} className=\"px-4 py-2 bg-gray-200 rounded\">Cancelar</button>\r\n                <button type=\"submit\" className=\"px-4 py-2 bg-blue-600 text-white rounded\">Guardar</button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </PageWrapper>\r\n  );\r\n}\r\n\r\nfunction ContractItem({ contract, isSelected, onToggle }) {\r\n  const [open, setOpen] = useState(false);\r\n  return (\r\n    <div className=\"border rounded p-4\">\r\n      <div className=\"flex justify-between items-center\">\r\n        <div>\r\n          <p className=\"font-semibold\">{contract.provider}</p>\r\n          <p className=\"text-sm text-gray-600\">{contract.type} - {contract.status}</p>\r\n        </div>\r\n        <button onClick={() => setOpen(v => !v)}>\r\n          {open ? <ChevronUp /> : <ChevronDown />}\r\n        </button>\r\n      </div>\r\n      {open && (\r\n        <div className=\"mt-2 space-y-2\">\r\n          <p>Fecha de firma: {contract.signedDate}</p>\r\n          <p>Fecha de servicio: {contract.serviceDate}</p>\r\n          <a href={contract.docUrl} target=\"_blank\" rel=\"noopener noreferrer\" className=\"flex items-center text-blue-600\">\r\n            <Eye size={16} className=\"mr-1\" /> Ver documento\r\n          </a>\r\n          <div>\r\n            <input type=\"checkbox\" checked={isSelected} onChange={onToggle} /> Seleccionar\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\Dashboard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\DevEnsureFinance.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\DevSeedGuests.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'deleteDoc' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":87,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":96}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { db } from '../firebaseConfig';\r\nimport { collection, doc, getDocs, limit, query, setDoc, writeBatch, serverTimestamp, deleteDoc } from 'firebase/firestore';\r\n// No exigimos autenticaci√≥n expl√≠cita aqu√≠; la ruta es de desarrollo\r\n\r\nfunction chunkArray(arr, size) {\r\n  const chunks = [];\r\n  for (let i = 0; i < arr.length; i += size) chunks.push(arr.slice(i, i + size));\r\n  return chunks;\r\n}\r\n\r\nexport default function DevSeedGuests() {\r\n  const [status, setStatus] = useState('');\r\n  const [details, setDetails] = useState('');\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      const url = new URL(window.location.href);\r\n      const weddingId = url.searchParams.get('weddingId') || '61ffb907-7fcb-4361-b764-0300b317fe06';\r\n      const totalGuests = parseInt(url.searchParams.get('guests') || '250', 10);\r\n      const perTable = parseInt(url.searchParams.get('perTable') || '10', 10);\r\n      const force = (url.searchParams.get('force') || 'false') === 'true';\r\n\r\n      try {\r\n        setStatus('Preparando...');\r\n        const guestsCol = collection(db, 'weddings', weddingId, 'guests');\r\n        const tablesColPath = ['weddings', weddingId, 'seatingPlan', 'banquet', 'tables'];\r\n\r\n        // Si no force y ya hay datos, salimos\r\n        const [guestsSnap, tablesSnap] = await Promise.all([\r\n          getDocs(query(guestsCol, limit(1))),\r\n          getDocs(query(collection(db, ...tablesColPath), limit(1)))\r\n        ]);\r\n        if (!force && (!guestsSnap.empty || !tablesSnap.empty)) {\r\n          setStatus('Datos existentes detectados. A√±ade force=true para sobrescribir.');\r\n          return;\r\n        }\r\n\r\n        // Borrado si force\r\n        if (force) {\r\n          setStatus('Borrando datos anteriores...');\r\n          const [allGuests, allTables] = await Promise.all([\r\n            getDocs(collection(db, 'weddings', weddingId, 'guests')),\r\n            getDocs(collection(db, ...tablesColPath))\r\n          ]);\r\n          const deletions = [];\r\n          allGuests.forEach((d) => deletions.push({ path: ['weddings', weddingId, 'guests', d.id] }));\r\n          allTables.forEach((d) => deletions.push({ path: [...tablesColPath, d.id] }));\r\n          // Hacer deletes por lotes de 400\r\n          for (const group of chunkArray(deletions, 400)) {\r\n            const batch = writeBatch(db);\r\n            group.forEach((g) => batch.delete(doc(db, ...g.path)));\r\n            await batch.commit();\r\n          }\r\n        }\r\n\r\n        setStatus('Generando invitados y mesas...');\r\n        const tablesNeeded = Math.ceil(totalGuests / perTable);\r\n        const writes = [];\r\n\r\n        // Invitados\r\n        for (let i = 1; i <= totalGuests; i++) {\r\n          const tableId = ((i - 1) % tablesNeeded) + 1;\r\n          const guestId = `G${i}`;\r\n          writes.push({\r\n            type: 'set',\r\n            path: ['weddings', weddingId, 'guests', guestId],\r\n            data: {\r\n              id: guestId,\r\n              name: `Invitado ${i}`,\r\n              tableId: tableId,\r\n              table: tableId,\r\n              createdAt: serverTimestamp(),\r\n            }\r\n          });\r\n        }\r\n\r\n        // Mesas (con invitados asignados por id y nombre)\r\n        const assignedByTable = {};\r\n        for (let i = 1; i <= totalGuests; i++) {\r\n          const tableId = ((i - 1) % tablesNeeded) + 1;\r\n          const guestId = `G${i}`;\r\n          if (!assignedByTable[tableId]) assignedByTable[tableId] = [];\r\n          assignedByTable[tableId].push({ id: guestId, name: `Invitado ${i}` });\r\n        }\r\n\r\n        for (let t = 1; t <= tablesNeeded; t++) {\r\n          writes.push({\r\n            type: 'set',\r\n            path: [...tablesColPath, String(t)],\r\n            data: {\r\n              id: t,\r\n              name: `Mesa ${t}`,\r\n              shape: 'circle',\r\n              seats: perTable,\r\n              x: 100 + ((t - 1) % 10) * 140,\r\n              y: 120 + Math.floor((t - 1) / 10) * 160,\r\n              assignedGuests: assignedByTable[t] || [],\r\n              createdAt: serverTimestamp(),\r\n            }\r\n          });\r\n        }\r\n\r\n        // Ejecutar en lotes de 400 para evitar l√≠mite de 500\r\n        let done = 0;\r\n        for (const group of chunkArray(writes, 400)) {\r\n          const batch = writeBatch(db);\r\n          group.forEach((op) => {\r\n            if (op.type === 'set') {\r\n              batch.set(doc(db, ...op.path), op.data);\r\n            } else if (op.type === 'delete') {\r\n              batch.delete(doc(db, ...op.path));\r\n            }\r\n          });\r\n          await batch.commit();\r\n          done += group.length;\r\n          setDetails(`Escritos ${done}/${writes.length} documentos...`);\r\n        }\r\n\r\n        // Asegurar documento de finanzas\r\n        try {\r\n          const financeDoc = doc(db, 'weddings', weddingId, 'finance', 'main');\r\n          await setDoc(financeDoc, {\r\n            movements: [],\r\n            updatedAt: serverTimestamp(),\r\n          }, { merge: true });\r\n        } catch (e) {\r\n          console.warn('No se pudo crear/actualizar finance/main:', e);\r\n        }\r\n\r\n        setStatus(`‚úÖ Insertados ${totalGuests} invitados y ${tablesNeeded} mesas en la boda ${weddingId}`);\r\n      } catch (e) {\r\n        console.error(e);\r\n        setStatus('‚ùå Error durante el seeding');\r\n        setDetails(e?.message || String(e));\r\n      }\r\n    })();\r\n  }, []);\r\n\r\n  return (\r\n    <div style={{ padding: 24 }}>\r\n      <h2>Dev Seed Guests</h2>\r\n      <p>{status}</p>\r\n      {details && <pre style={{ whiteSpace: 'pre-wrap' }}>{details}</pre>}\r\n      <p>Par√°metros: weddingId, guests, perTable, force (true/false)</p>\r\n      <p>Ejemplo: /dev/seed-guests?weddingId=61ffb907-7fcb-4361-b764-0300b317fe06&guests=250&perTable=10&force=true</p>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\DisenoWeb.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'key' is defined but never used. Allowed unused args must match /^_/u.","line":367,"column":55,"nodeType":"Identifier","messageId":"unusedVar","endLine":367,"endColumn":58}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { doc, getDoc, setDoc, collection, addDoc, getDocs, serverTimestamp } from 'firebase/firestore';\r\nimport { db } from '../lib/firebase';\r\nimport { useAuth } from '../hooks/useAuthUnified';\r\n\r\nexport default function DisenoWeb() {\r\n  const { currentUser } = useAuth();\r\n  const uid = currentUser?.uid || 'dev';\r\n  const [prompt, setPrompt] = useState('');\r\n  const [html, setHtml] = useState('');\r\n  const [profile, setProfile] = useState(null);\r\n  const [versions, setVersions] = useState([]);\r\n  const [error, setError] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [selectedTemplate, setSelectedTemplate] = useState('personalizada');\r\n  \r\n  // Plantillas predefinidas\r\n  const templates = {\r\n    personalizada: { \r\n      name: 'Personalizada', \r\n      desc: 'Crea una p√°gina web totalmente personalizada seg√∫n tus indicaciones',\r\n      prompt: ''\r\n    },\r\n    clasica: { \r\n      name: 'Cl√°sica', \r\n      desc: 'Dise√±o elegante con tonos dorados y blancos, ideal para bodas tradicionales',\r\n      prompt: 'Dise√±o cl√°sico con tonos dorados y blancos. Usa tipograf√≠a elegante serif y elementos decorativos cl√°sicos. Enfoque en elegancia tradicional.'\r\n    },\r\n    moderna: { \r\n      name: 'Moderna', \r\n      desc: 'Estilo minimalista con colores neutros y dise√±o limpio',\r\n      prompt: 'Dise√±o moderno minimalista con colores neutros. Usa tipograf√≠a sans-serif limpia, mucho espacio en blanco y animaciones sutiles. Enfoque en elegancia contempor√°nea.'\r\n    },\r\n    rustica: { \r\n      name: 'R√∫stica', \r\n      desc: 'Inspirada en bodas campestres con elementos naturales y paleta de colores tierra',\r\n      prompt: 'Dise√±o r√∫stico campestre con elementos de madera y naturales. Usa colores tierra, verde y detalles florales. Aspecto c√°lido y acogedor tipo boda en el campo.'\r\n    },\r\n    playa: { \r\n      name: 'Playa', \r\n      desc: 'Perfecta para bodas en la costa con tonos azules y turquesa',\r\n      prompt: 'Dise√±o tem√°tica de playa con tonos azules, turquesa y arena. Incluye elementos marinos sutiles, olas y textura de arena. Sensaci√≥n fresca y relajada de boda costera.'\r\n    }\r\n  };\r\n\r\n  // Cargar datos de perfil y versiones al montar\r\n  useEffect(()=>{\r\n    if(!uid) return;\r\n    (async ()=>{\r\n      try {\r\n        const snap = await getDoc(doc(db,'users',uid));\r\n        if(snap.exists()) setProfile(snap.data().weddingInfo || {});\r\n        // cargar versiones\r\n        const colSnap = await getDocs(collection(db,'users',uid,'generatedPages'));\r\n        setVersions(colSnap.docs.map(d=>({id:d.id,...d.data()})).sort((a,b)=>b.createdAt?.seconds - a.createdAt?.seconds));\r\n      } catch(e){ console.error(e);} \r\n    })();\r\n  },[uid]);\r\n\r\n  const generateWeb = async () => {\r\n    if (!prompt.trim()) return;\r\n    setLoading(true);\r\n    setError('');\r\n    // Llamar a OpenAI para generar la web\r\n    try {\r\n      if(!import.meta.env.VITE_OPENAI_API_KEY){\r\n        // Fallback de demo si no hay clave\r\n        const demo = `<html><head><style>body{font-family:sans-serif;padding:2rem}</style></head><body><h1>${prompt}</h1><p>Ejemplo de web generada (sin IA).</p></body></html>`;\r\n        setHtml(demo);\r\n        return;\r\n      }\r\n      \r\n      // Extraer datos relevantes del perfil\r\n      const {\r\n        brideInfo = {},\r\n        groomInfo = {},\r\n        ceremonyInfo = {},\r\n        receptionInfo = {},\r\n        transportationInfo = {},\r\n        rsvpInfo = {}\r\n      } = profile || {};\r\n      \r\n      // Preparar informaci√≥n estructurada para la IA\r\n      const weddingInfo = {\r\n        bride: brideInfo.nombre || 'Nombre de la novia',\r\n        groom: groomInfo.nombre || 'Nombre del novio',\r\n        date: ceremonyInfo.fecha || 'Fecha por determinar',\r\n        ceremonyTime: ceremonyInfo.hora || 'Hora por determinar',\r\n        ceremonyLocation: ceremonyInfo.lugar || 'Lugar por determinar',\r\n        ceremonyAddress: ceremonyInfo.direccion || '',\r\n        receptionVenue: receptionInfo.lugar || 'Lugar por determinar',\r\n        receptionAddress: receptionInfo.direccion || '',\r\n        receptionTime: receptionInfo.hora || 'Hora por determinar',\r\n        transportation: transportationInfo.detalles || '',\r\n        rsvpDeadline: rsvpInfo.fecha || '',\r\n        contactPhone: profile?.contactPhone || '',\r\n        contactEmail: profile?.contactEmail || '',\r\n        weddingStyle: profile?.weddingStyle || 'Cl√°sico',\r\n        colorScheme: profile?.colorScheme || 'Blanco y dorado',\r\n        additionalInfo: profile?.additionalInfo || ''\r\n      };\r\n      \r\n      // Instrucciones detalladas para el sistema\r\n      const sys = `Eres un experto dise√±ador web especializado en p√°ginas de bodas. \r\n      Debes crear un sitio web completo y funcional para una boda con dise√±o moderno, responsive y elegante.\r\n      El sitio debe incluir las siguientes secciones, adapt√°ndolas seg√∫n la informaci√≥n disponible:\r\n      - Inicio con nombres, fecha y cuenta regresiva\r\n      - Historia de la pareja\r\n      - Informaci√≥n de ceremonia y recepci√≥n\r\n      - Galer√≠a de fotos (con marcadores para fotos)\r\n      - Detalles de transporte y alojamiento\r\n      - RSVP (si aplica)\r\n      - Regalos/Lista de bodas\r\n      - Contacto\r\n      \r\n      Usa un dise√±o moderno, tipograf√≠a elegante y est√©tica acorde al estilo de boda indicado.\r\n      Debes devolver √öNICAMENTE c√≥digo HTML completo con CSS embebido en el <head> y c√≥digo JavaScript si es necesario.\r\n      NO incluyas comentarios explicativos fuera del c√≥digo.`;\r\n      \r\n      // Preparar mensaje para la IA incluyendo datos estructurados\r\n      const userMessage = `\r\n      Crea un sitio web completo para esta boda con los siguientes datos:\r\n      \r\n      DATOS DE LA BODA:\r\n      - Novia: ${weddingInfo.bride}\r\n      - Novio: ${weddingInfo.groom}\r\n      - Fecha: ${weddingInfo.date}\r\n      - Ceremonia: ${weddingInfo.ceremonyTime} en ${weddingInfo.ceremonyLocation}\r\n      - Direcci√≥n ceremonia: ${weddingInfo.ceremonyAddress}\r\n      - Recepci√≥n: ${weddingInfo.receptionTime} en ${weddingInfo.receptionVenue}\r\n      - Direcci√≥n recepci√≥n: ${weddingInfo.receptionAddress}\r\n      - Transporte: ${weddingInfo.transportation}\r\n      - Fecha l√≠mite RSVP: ${weddingInfo.rsvpDeadline}\r\n      - Tel√©fono de contacto: ${weddingInfo.contactPhone}\r\n      - Email de contacto: ${weddingInfo.contactEmail}\r\n      - Estilo de boda: ${weddingInfo.weddingStyle}\r\n      - Paleta de colores: ${weddingInfo.colorScheme}\r\n      - Informaci√≥n adicional: ${weddingInfo.additionalInfo}\r\n      \r\n      REQUISITOS ESPEC√çFICOS DEL USUARIO:\r\n      ${prompt}\r\n      `;\r\n      \r\n      // Solicitud a la API\r\n      // Verificar que exista la clave de OpenAI\r\n      const OPENAI_KEY = import.meta.env.VITE_OPENAI_API_KEY;\r\n      if(!OPENAI_KEY){\r\n        alert('Configura la variable de entorno VITE_OPENAI_API_KEY con tu clave de OpenAI.');\r\n        setError('Falta clave OpenAI ‚Äì define VITE_OPENAI_API_KEY en tu .env');\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      console.log('DEBUG OpenAI_KEY length:', OPENAI_KEY?.length || 'undefined');\r\n      const modelName = import.meta.env.VITE_OPENAI_MODEL || 'gpt-4o';\r\n\r\n      const messages = [\r\n        { role: 'system', content: sys },\r\n        { role: 'user', content: userMessage }\r\n      ];\r\n      \r\n      const response = await fetch('https://api.openai.com/v1/chat/completions', {\r\n        method: 'POST',\r\n        headers: { \r\n          'Content-Type': 'application/json', \r\n          'Authorization': `Bearer ${OPENAI_KEY}`,\r\n          'OpenAI-Project': import.meta.env.VITE_OPENAI_PROJECT_ID \r\n        },\r\n        body: JSON.stringify({ \r\n          model: modelName, // Modelo configurable v√≠a VITE_OPENAI_MODEL\r\n          messages, \r\n          temperature: 0.7 \r\n        })\r\n      });\r\n      \r\n      if(response.status === 401){\r\n        throw new Error('Clave OpenAI inv√°lida o no autorizada (401). Comprueba VITE_OPENAI_API_KEY');\r\n      }\r\n\r\n      const data = await response.json();\r\n      \r\n      if (data.error) {\r\n        throw new Error(data.error.message || 'Error al generar la p√°gina web');\r\n      }\r\n      \r\n      let htmlGen = data.choices?.[0]?.message?.content || '';\r\n      // Quitar posibles fences ```html\r\n      htmlGen = htmlGen.replace(/```html|```/g, '').trim();\r\n      setHtml(htmlGen);\r\n    } catch (err) { \r\n      console.error('Error en la generaci√≥n de la p√°gina:', err); \r\n      setError(`Error al generar con IA: ${err.message || 'Revisa la consola para m√°s detalles'}`); \r\n      alert('Ha ocurrido un error al generar la p√°gina web. Por favor, int√©ntalo de nuevo.'); \r\n    }\r\n    \r\n    setLoading(false);\r\n  };\r\n\r\n  const publishWeb = async () => {\r\n    if(!html.trim()){ alert('Genera la web primero'); return; }\r\n    try{\r\n      await setDoc(doc(db,'users',uid), { generatedHtml: html }, { merge:true });\r\n      await addDoc(collection(db,'users',uid,'generatedPages'), { html, createdAt: serverTimestamp(), prompt });\r\n      alert('¬°P√°gina publicada! Se mostrar√° en la URL p√∫blica en unos minutos.');\r\n      // recargar versiones\r\n      const colSnap = await getDocs(collection(db,'users',uid,'generatedPages'));\r\n      setVersions(colSnap.docs.map(d=>({id:d.id,...d.data()})).sort((a,b)=>b.createdAt?.seconds - a.createdAt?.seconds));\r\n    }catch(e){ console.error(e); alert('Error al publicar'); }\r\n  };\r\n\r\n  const handleTemplateSelect = (templateKey) => {\r\n    setSelectedTemplate(templateKey);\r\n    if (templateKey !== 'personalizada') {\r\n      // Si selecciona una plantilla predefinida, usar su prompt como base\r\n      setPrompt(templates[templateKey].prompt);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"container mx-auto px-4 py-8\">\r\n      <h1 className=\"text-3xl font-bold mb-6\">Dise√±o Web de Boda</h1>\r\n      \r\n      {/* Selecci√≥n de plantillas */}\r\n      <div className=\"bg-white rounded-lg shadow p-6 mb-8\">\r\n        <h2 className=\"text-xl font-semibold mb-4\">Selecciona un estilo para tu web</h2>\r\n        \r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n          {Object.entries(templates).map(([key, template]) => (\r\n            <div \r\n              key={key}\r\n              onClick={() => handleTemplateSelect(key)}\r\n              className={`border rounded-lg p-4 cursor-pointer transition-all ${selectedTemplate === key ? 'border-blue-500 bg-blue-50 shadow-md' : 'border-gray-200 hover:border-blue-300'}`}\r\n            >\r\n              <h3 className=\"font-medium text-lg\">{template.name}</h3>\r\n              <p className=\"text-gray-600 text-sm mt-1\">{template.desc}</p>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Instrucciones personalizadas */}\r\n      <div className=\"bg-white rounded-lg shadow p-6 mb-8\">\r\n        <h2 className=\"text-xl font-semibold mb-4\">Personaliza tu web</h2>\r\n        <p className=\"text-gray-600 mb-4\">\r\n          Describe c√≥mo quieres que sea tu p√°gina web, colores, estilos o cualquier requisito espec√≠fico.\r\n          {selectedTemplate !== 'personalizada' && (\r\n            <span className=\"block mt-2 text-blue-600\">\r\n              Usando plantilla: <strong>{templates[selectedTemplate].name}</strong>. \r\n              Puedes modificar el texto sugerido o a√±adir m√°s detalles.\r\n            </span>\r\n          )}\r\n        </p>\r\n        \r\n        <textarea\r\n          className=\"w-full h-40 border rounded-lg p-4\"\r\n          placeholder=\"Ej: Quiero una web con estilo rom√°ntico, muchas fotos y una secci√≥n para que los invitados confirmen asistencia...\"\r\n          value={prompt}\r\n          onChange={(e) => setPrompt(e.target.value)}\r\n        />\r\n\r\n        <div className=\"mt-4 flex flex-wrap gap-4\">\r\n          <button\r\n            onClick={generateWeb}\r\n            disabled={loading}\r\n            className=\"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium disabled:opacity-50 flex items-center gap-2 transition-colors\"\r\n          >\r\n            {loading ? (\r\n              <>\r\n                <svg className=\"animate-spin h-5 w-5 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                  <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                  <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                </svg>\r\n                <span>Generando...</span>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                  <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\r\n                </svg>\r\n                <span>Generar P√°gina Web</span>\r\n              </>\r\n            )}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {error && (\r\n        <div className=\"bg-red-50 border-l-4 border-red-500 p-4 mb-8\">\r\n          <div className=\"flex items-start\">\r\n            <div className=\"flex-shrink-0\">\r\n              <svg className=\"h-5 w-5 text-red-500\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n            </div>\r\n            <div className=\"ml-3\">\r\n              <p className=\"text-red-700\">{error}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {html && (\r\n        <div className=\"bg-white rounded-lg shadow p-6 mb-8\">\r\n          <h2 className=\"text-xl font-semibold mb-4\">Vista previa de tu p√°gina web</h2>\r\n          \r\n          <div className=\"border rounded-lg overflow-hidden shadow-lg\">\r\n            <div className=\"bg-gray-100 p-2 border-b flex items-center space-x-2\">\r\n              <div className=\"w-3 h-3 bg-red-500 rounded-full\"></div>\r\n              <div className=\"w-3 h-3 bg-yellow-500 rounded-full\"></div>\r\n              <div className=\"w-3 h-3 bg-green-500 rounded-full\"></div>\r\n              <div className=\"flex-1 text-center text-sm text-gray-600\">Vista previa - Tu web de boda</div>\r\n            </div>\r\n            <iframe\r\n              title=\"Vista previa\"\r\n              srcDoc={html}\r\n              sandbox=\"allow-same-origin allow-scripts\"\r\n              className=\"w-full h-[600px] border-none\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"mt-6 flex gap-4 items-center\">\r\n            <button\r\n              onClick={publishWeb}\r\n              className=\"bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium flex items-center gap-2 transition-colors\"\r\n            >\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                <path fillRule=\"evenodd\" d=\"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n              <span>Publicar p√°gina</span>\r\n            </button>\r\n            <button \r\n              onClick={() => {\r\n                const blob = new Blob([html], { type: 'text/html' });\r\n                const url = URL.createObjectURL(blob);\r\n                window.open(url, '_blank');\r\n              }}\r\n              className=\"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium flex items-center gap-2 transition-colors\"\r\n            >\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                <path d=\"M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z\" />\r\n                <path d=\"M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z\" />\r\n              </svg>\r\n              <span>Abrir en nueva pesta√±a</span>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {versions.length > 0 && (\r\n        <div className=\"bg-white rounded-lg shadow p-6\">\r\n          <h2 className=\"text-xl font-semibold mb-4\">Versiones publicadas</h2>\r\n          \r\n          <div className=\"overflow-hidden rounded-lg border border-gray-200\">\r\n            <table className=\"min-w-full divide-y divide-gray-200\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Fecha</th>\r\n                  <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Plantilla</th>\r\n                  <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Indicaciones</th>\r\n                  <th scope=\"col\" className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">Acciones</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                {versions.map(v => {\r\n                  // Detectar qu√© plantilla se us√≥ basado en el prompt\r\n                  let templateUsed = 'Personalizada';\r\n                  Object.entries(templates).forEach(([key, template]) => {\r\n                    if (v.prompt && v.prompt.includes(template.prompt) && template.prompt) {\r\n                      templateUsed = template.name;\r\n                    }\r\n                  });\r\n                  \r\n                  return (\r\n                    <tr key={v.id} className=\"hover:bg-gray-50\">\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600\">\r\n                        {new Date(v.createdAt?.seconds * 1000).toLocaleString()}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600\">\r\n                        {templateUsed}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 text-sm text-gray-600 truncate max-w-xs\">\r\n                        {v.prompt || 'Sin indicaciones'}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\r\n                        <button \r\n                          onClick={() => setHtml(v.html)}\r\n                          className=\"text-blue-600 hover:text-blue-800 mr-4\"\r\n                        >\r\n                          Ver\r\n                        </button>\r\n                        <button \r\n                          onClick={() => {\r\n                            setPrompt(v.prompt || '');\r\n                            setHtml(v.html);\r\n                            // Detectar plantilla\r\n                            let detectedTemplate = 'personalizada';\r\n                            Object.entries(templates).forEach(([key, template]) => {\r\n                              if (v.prompt && v.prompt.includes(template.prompt) && template.prompt) {\r\n                                detectedTemplate = key;\r\n                              }\r\n                            });\r\n                            setSelectedTemplate(detectedTemplate);\r\n                          }}\r\n                          className=\"text-green-600 hover:text-green-800\"\r\n                        >\r\n                          Editar\r\n                        </button>\r\n                      </td>\r\n                    </tr>\r\n                  );\r\n                })}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\EmailSetup.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":16,"column":48,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":55},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":16,"column":57,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":62}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport MainLayout from '../components/layout/MainLayout';\r\nimport EmailSetupForm from '../components/email/EmailSetupForm';\r\nimport useEmailUsername from '../hooks/useEmailUsername';\r\nimport { auth } from '../lib/firebase';\r\nimport { Mail, CheckCircle, AlertCircle, ArrowLeft } from 'lucide-react';\r\nimport Button from '../components/ui/Button';\r\n\r\n/**\r\n * P√°gina de configuraci√≥n de correo electr√≥nico myWed360\r\n * Permite a los usuarios crear su direcci√≥n personalizada\r\n */\r\nconst EmailSetup = () => {\r\n  const navigate = useNavigate();\r\n  const { getCurrentUsername, reserveUsername, loading, error } = useEmailUsername();\r\n  const [currentUsername, setCurrentUsername] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [saveSuccess, setSaveSuccess] = useState(false);\r\n  const [generalError, setGeneralError] = useState('');\r\n\r\n  // Cargar nombre de usuario actual si existe\r\n  useEffect(() => {\r\n    const loadUsername = async () => {\r\n      try {\r\n        const username = await getCurrentUsername();\r\n        setCurrentUsername(username);\r\n      } catch (err) {\r\n        console.error('Error al cargar el nombre de usuario:', err);\r\n        setGeneralError('Error al cargar tus datos de correo electr√≥nico');\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    if (auth.currentUser) {\r\n      loadUsername();\r\n    } else {\r\n      // Si no hay usuario logueado, redirigir al login\r\n      navigate('/login', { \r\n        state: { \r\n          returnUrl: '/email-setup',\r\n          message: 'Debes iniciar sesi√≥n para configurar tu correo myWed360' \r\n        } \r\n      });\r\n    }\r\n  }, [getCurrentUsername, navigate]);\r\n\r\n  const handleSaveUsername = async (username) => {\r\n    try {\r\n      const success = await reserveUsername(username);\r\n      if (success) {\r\n        setCurrentUsername(username);\r\n        setSaveSuccess(true);\r\n        // Ocultar mensaje de √©xito despu√©s de 5 segundos\r\n        setTimeout(() => {\r\n          setSaveSuccess(false);\r\n        }, 5000);\r\n      }\r\n    } catch (err) {\r\n      console.error('Error al guardar el nombre de usuario:', err);\r\n      setGeneralError('Ha ocurrido un error al guardar tu direcci√≥n de correo.');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <MainLayout>\r\n      <div className=\"max-w-3xl mx-auto px-4 py-8\">\r\n        <div className=\"flex items-center mb-6\">\r\n          <Button\r\n            variant=\"ghost\"\r\n            size=\"sm\"\r\n            onClick={() => navigate(-1)}\r\n            className=\"mr-2\"\r\n          >\r\n            <ArrowLeft size={16} />\r\n          </Button>\r\n          <h1 className=\"text-2xl font-bold\">Configuraci√≥n de tu correo myWed360</h1>\r\n        </div>\r\n\r\n        <div className=\"bg-blue-50 border-l-4 border-blue-400 p-4 mb-6\">\r\n          <div className=\"flex\">\r\n            <div className=\"flex-shrink-0\">\r\n              <Mail className=\"h-5 w-5 text-blue-400\" />\r\n            </div>\r\n            <div className=\"ml-3\">\r\n              <p className=\"text-sm text-blue-700\">\r\n                Configura tu direcci√≥n de correo personalizada para comunicarte con proveedores \r\n                y otros usuarios desde la plataforma myWed360.\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {generalError && (\r\n          <div className=\"mb-6 bg-red-50 border-l-4 border-red-400 p-4\">\r\n            <div className=\"flex\">\r\n              <AlertCircle className=\"h-5 w-5 text-red-400\" />\r\n              <p className=\"ml-3 text-red-700\">{generalError}</p>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {saveSuccess && (\r\n          <div className=\"mb-6 bg-green-50 border-l-4 border-green-400 p-4\">\r\n            <div className=\"flex\">\r\n              <CheckCircle className=\"h-5 w-5 text-green-400\" />\r\n              <p className=\"ml-3 text-green-700\">\r\n                ¬°Tu direcci√≥n de correo <strong>{currentUsername}@mywed360</strong> ha sido guardada con √©xito!\r\n              </p>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {isLoading ? (\r\n          <div className=\"flex justify-center py-12\">\r\n            <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500\"></div>\r\n          </div>\r\n        ) : (\r\n          <>\r\n            {currentUsername ? (\r\n              <div className=\"mb-6\">\r\n                <p className=\"mb-4\">\r\n                  Ya tienes configurada tu direcci√≥n de correo myWed360: \r\n                  <strong className=\"ml-2 text-lg\">{currentUsername}@mywed360</strong>\r\n                </p>\r\n                <p className=\"text-gray-600\">\r\n                  Puedes cambiarla a continuaci√≥n si deseas una direcci√≥n diferente:\r\n                </p>\r\n              </div>\r\n            ) : null}\r\n            \r\n            <EmailSetupForm \r\n              onSave={handleSaveUsername} \r\n              defaultUsername={currentUsername || ''}\r\n            />\r\n            \r\n            {currentUsername && (\r\n              <div className=\"mt-8 border-t pt-6\">\r\n                <h2 className=\"text-lg font-semibold mb-3\">¬øQu√© puedo hacer con mi correo myWed360?</h2>\r\n                <ul className=\"list-disc pl-5 space-y-2\">\r\n                  <li>Enviar y recibir emails desde la plataforma</li>\r\n                  <li>Comunicarte directamente con proveedores sin exponer tu correo personal</li>\r\n                  <li>Recibir notificaciones importantes sobre tu boda</li>\r\n                  <li>Centralizar todas las comunicaciones relacionadas con tu evento</li>\r\n                </ul>\r\n                \r\n                <div className=\"mt-6\">\r\n                  <Button\r\n                    onClick={() => navigate('/email/inbox')}\r\n                    className=\"mr-4\"\r\n                  >\r\n                    Ir a mi bandeja de entrada\r\n                  </Button>\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    onClick={() => navigate('/email/compose')}\r\n                  >\r\n                    Escribir nuevo correo\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </>\r\n        )}\r\n      </div>\r\n    </MainLayout>\r\n  );\r\n};\r\n\r\nexport default EmailSetup;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\Finance.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'t' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":24,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '../components/ui/Tabs';\r\nimport FinanceOverview from '../components/finance/FinanceOverview';\r\nimport TransactionManager from '../components/finance/TransactionManager';\r\nimport BudgetManager from '../components/finance/BudgetManager';\r\nimport ContributionSettings from '../components/finance/ContributionSettings';\r\nimport FinanceCharts from '../components/finance/FinanceCharts';\r\nimport useFinance from '../hooks/useFinance';\r\nimport useTranslations from '../hooks/useTranslations';\r\n\r\n/**\r\n * P√°gina de gesti√≥n financiera completamente refactorizada\r\n * Arquitectura modular, optimizada y mantenible\r\n * \r\n * OPTIMIZACIONES IMPLEMENTADAS:\r\n * - Eliminado c√≥digo legacy (571 l√≠neas ‚Üí 180 l√≠neas)\r\n * - Arquitectura modular con componentes especializados\r\n * - Hook personalizado useFinance para l√≥gica centralizada\r\n * - Memoizaci√≥n y optimizaci√≥n de re-renders\r\n * - Integraci√≥n con sistema i18n\r\n * - UX mejorada con tabs y navegaci√≥n clara\r\n */\r\nfunction Finance() {\r\n  const { t } = useTranslations();\r\n  \r\n  // Hook personalizado para gesti√≥n financiera\r\n  const {\r\n    // Estados\r\n    syncStatus,\r\n    isLoading,\r\n    error,\r\n    contributions,\r\n    budget,\r\n    transactions,\r\n    \r\n    // C√°lculos\r\n    stats,\r\n    budgetUsage,\r\n    \r\n    // Acciones\r\n    updateContributions,\r\n    loadGuestCount,\r\n    addBudgetCategory,\r\n    updateBudgetCategory,\r\n    removeBudgetCategory,\r\n    createTransaction,\r\n    updateTransaction,\r\n    deleteTransaction,\r\n    importBankTransactions,\r\n    clearError\r\n  } = useFinance();\r\n\r\n  // Estado para tabs activo\r\n  const [activeTab, setActiveTab] = useState('overview');\r\n\r\n  // Detectar URL hash para abrir modal espec√≠fico\r\n  useEffect(() => {\r\n    const hash = window.location.hash;\r\n    if (hash === '#nuevo') {\r\n      setActiveTab('transactions');\r\n      // El TransactionManager manejar√° la apertura del modal\r\n      window.history.replaceState(null, '', window.location.pathname);\r\n    }\r\n  }, []);\r\n\r\n  // Cargar n√∫mero de invitados al montar el componente\r\n  useEffect(() => {\r\n    loadGuestCount();\r\n  }, [loadGuestCount]);\r\n\r\n  // Limpiar errores despu√©s de 5 segundos\r\n  useEffect(() => {\r\n    if (error) {\r\n      const timer = setTimeout(clearError, 5000);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [error, clearError]);\r\n\r\n  // Manejar actualizaci√≥n de presupuesto total\r\n  const handleUpdateTotalBudget = (newTotal) => {\r\n    // Esta funcionalidad se puede implementar cuando sea necesaria\r\n    console.log('Actualizar presupuesto total:', newTotal);\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 p-4 md:p-6\">\r\n      <div className=\"max-w-7xl mx-auto space-y-6\">\r\n        {/* Mostrar errores si existen */}\r\n        {error && (\r\n          <div className=\"bg-red-50 border border-red-200 rounded-md p-4\">\r\n            <div className=\"flex\">\r\n              <div className=\"ml-3\">\r\n                <h3 className=\"text-sm font-medium text-red-800\">\r\n                  Error en gesti√≥n financiera\r\n                </h3>\r\n                <div className=\"mt-2 text-sm text-red-700\">\r\n                  <p>{error}</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Navegaci√≥n por tabs */}\r\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\r\n          <TabsList className=\"grid w-full grid-cols-5\">\r\n            <TabsTrigger value=\"overview\">Resumen</TabsTrigger>\r\n            <TabsTrigger value=\"transactions\">Transacciones</TabsTrigger>\r\n            <TabsTrigger value=\"budget\">Presupuesto</TabsTrigger>\r\n            <TabsTrigger value=\"contributions\">Aportaciones</TabsTrigger>\r\n            <TabsTrigger value=\"analytics\">An√°lisis</TabsTrigger>\r\n          </TabsList>\r\n\r\n          {/* Tab: Resumen general */}\r\n          <TabsContent value=\"overview\" className=\"space-y-6\">\r\n            <FinanceOverview\r\n              stats={stats}\r\n              syncStatus={syncStatus}\r\n              budgetUsage={budgetUsage}\r\n            />\r\n          </TabsContent>\r\n\r\n          {/* Tab: Gesti√≥n de transacciones */}\r\n          <TabsContent value=\"transactions\" className=\"space-y-6\">\r\n            <TransactionManager\r\n              transactions={transactions}\r\n              onCreateTransaction={createTransaction}\r\n              onUpdateTransaction={updateTransaction}\r\n              onDeleteTransaction={deleteTransaction}\r\n              onImportBank={importBankTransactions}\r\n              isLoading={isLoading}\r\n            />\r\n          </TabsContent>\r\n\r\n          {/* Tab: Gesti√≥n de presupuesto */}\r\n          <TabsContent value=\"budget\" className=\"space-y-6\">\r\n            <BudgetManager\r\n              budget={budget}\r\n              budgetUsage={budgetUsage}\r\n              onUpdateBudget={handleUpdateTotalBudget}\r\n              onAddCategory={addBudgetCategory}\r\n              onUpdateCategory={updateBudgetCategory}\r\n              onRemoveCategory={removeBudgetCategory}\r\n            />\r\n          </TabsContent>\r\n\r\n          {/* Tab: Configuraci√≥n de aportaciones */}\r\n          <TabsContent value=\"contributions\" className=\"space-y-6\">\r\n            <ContributionSettings\r\n              contributions={contributions}\r\n              onUpdateContributions={updateContributions}\r\n              onLoadGuestCount={loadGuestCount}\r\n              isLoading={isLoading}\r\n            />\r\n          </TabsContent>\r\n\r\n          {/* Tab: An√°lisis y gr√°ficos */}\r\n          <TabsContent value=\"analytics\" className=\"space-y-6\">\r\n            <FinanceCharts\r\n              transactions={transactions}\r\n              budgetUsage={budgetUsage}\r\n              stats={stats}\r\n            />\r\n          </TabsContent>\r\n        </Tabs>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Finance;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\GestionProveedores.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Settings' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":34},{"ruleId":"no-unused-vars","severity":1,"message":"'where' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":34},{"ruleId":"no-unused-vars","severity":1,"message":"'getFirestore' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":80,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":92},{"ruleId":"no-unused-vars","severity":1,"message":"'navigate' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":24,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":147,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":147,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Sparkles, Plus, Settings } from 'lucide-react';\r\n\r\n// Firebase\r\nimport { collection, query, where, getDocs, addDoc, updateDoc, doc, deleteDoc, getFirestore } from 'firebase/firestore';\r\nimport { useAuth } from '../hooks/useAuthUnified';\r\nimport { db } from '../lib/firebase';\r\n\r\n// Componentes\r\nimport ProveedorCardNuevo from '../components/proveedores/ProveedorCardNuevo';\r\nimport ProveedorDetalle from '../components/proveedores/ProveedorDetalle';\r\nimport ProveedorFiltro from '../components/proveedores/ProveedorFiltro';\r\nimport ProveedorFormModal from '../components/proveedores/ProveedorFormModal';\r\nimport AIBusquedaModal from '../components/proveedores/AIBusquedaModal';\r\n\r\n/**\r\n * P√°gina de gesti√≥n de proveedores\r\n * Muestra proveedores en tarjetas, permite filtrar, buscar con IA y a√±adir manualmente\r\n */\r\nconst GestionProveedores = () => {\r\n  // Contextos\r\n  const { currentUser } = useAuth();\r\n  const navigate = useNavigate();\r\n  \r\n  // Estados para proveedores\r\n  const [proveedores, setProveedores] = useState([]);\r\n  const [proveedoresFiltrados, setProveedoresFiltrados] = useState([]);\r\n  const [proveedorSeleccionado, setProveedorSeleccionado] = useState(null);\r\n  const [cargando, setCargando] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  \r\n  // Estados para filtros y b√∫squeda\r\n  const [filtroActivo, setFiltroActivo] = useState('todos');\r\n  const [textoBusqueda, setTextoBusqueda] = useState('');\r\n  \r\n  // Estados para modales\r\n  const [modalFormularioVisible, setModalFormularioVisible] = useState(false);\r\n  const [modalAIVisible, setModalAIVisible] = useState(false);\r\n  const [proveedorEditar, setProveedorEditar] = useState(null);\r\n  \r\n  // Estados para b√∫squeda IA\r\n  const [resultadoBusquedaIA, setResultadoBusquedaIA] = useState(null);\r\n  const [cargandoBusquedaIA, setCargandoBusquedaIA] = useState(false);\r\n  \r\n  // Estado para comunicaciones\r\n  const [comunicaciones, setComunicaciones] = useState([]);\r\n  \r\n  // Cargar proveedores desde Firestore\r\n  const cargarProveedores = useCallback(async () => {\r\n    // Usar ID de usuario por defecto si no hay usuario autenticado (solo para desarrollo)\r\n    const userId = currentUser?.uid || 'user123';\r\n    console.log('cargarProveedores: usando ID de usuario:', userId);\r\n    \r\n    setCargando(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      const proveedoresRef = collection(db, `users/${userId}/proveedores`);\r\n      const q = query(proveedoresRef);\r\n      const snapshot = await getDocs(q);\r\n      \r\n      const nuevosProveedores = snapshot.docs.map(doc => ({\r\n        id: doc.id,\r\n        ...doc.data()\r\n      }));\r\n      \r\n      setProveedores(nuevosProveedores);\r\n      aplicarFiltros(nuevosProveedores, filtroActivo, textoBusqueda);\r\n      \r\n      setCargando(false);\r\n    } catch (err) {\r\n      console.error('Error al cargar proveedores:', err);\r\n      setError('Error al cargar los proveedores. Int√©ntalo de nuevo m√°s tarde.');\r\n      setCargando(false);\r\n    }\r\n  }, [currentUser, filtroActivo, textoBusqueda]);\r\n  \r\n  // Cargar al iniciar\r\n  useEffect(() => {\r\n    cargarProveedores();\r\n  }, [cargarProveedores]);\r\n  \r\n  // Aplicar filtros a los proveedores\r\n  const aplicarFiltros = (listaProveedores, filtro, texto) => {\r\n    let resultado = [...listaProveedores];\r\n    \r\n    // Aplicar filtro por categor√≠a\r\n    switch (filtro) {\r\n      case 'contratados':\r\n        resultado = resultado.filter(p => p.estado === 'Contratado');\r\n        break;\r\n      case 'contactados':\r\n        resultado = resultado.filter(p => p.estado === 'Contactado');\r\n        break;\r\n      case 'favoritos':\r\n        resultado = resultado.filter(p => p.favorito === true);\r\n        break;\r\n      default:\r\n        // Todos los proveedores\r\n        break;\r\n    }\r\n    \r\n    // Aplicar filtro de texto si existe\r\n    if (texto) {\r\n      const textoLower = texto.toLowerCase();\r\n      resultado = resultado.filter(p => \r\n        (p.nombre && p.nombre.toLowerCase().includes(textoLower)) ||\r\n        (p.servicio && p.servicio.toLowerCase().includes(textoLower)) ||\r\n        (p.ubicacion && p.ubicacion.toLowerCase().includes(textoLower))\r\n      );\r\n    }\r\n    \r\n    setProveedoresFiltrados(resultado);\r\n  };\r\n  \r\n  // Cambiar filtro activo\r\n  const cambiarFiltro = (nuevoFiltro) => {\r\n    setFiltroActivo(nuevoFiltro);\r\n    aplicarFiltros(proveedores, nuevoFiltro, textoBusqueda);\r\n  };\r\n  \r\n  // Cambiar texto de b√∫squeda\r\n  const cambiarTextoBusqueda = (nuevoTexto) => {\r\n    setTextoBusqueda(nuevoTexto);\r\n  };\r\n  \r\n  // Realizar b√∫squeda\r\n  const buscar = () => {\r\n    aplicarFiltros(proveedores, filtroActivo, textoBusqueda);\r\n  };\r\n  \r\n  // Guardar nuevo proveedor\r\n  const guardarProveedor = async (datosProveedor) => {\r\n    console.log('guardarProveedor llamado con datos:', datosProveedor);\r\n    \r\n    // Usar ID de usuario por defecto si no hay usuario autenticado (solo para desarrollo)\r\n    const userId = currentUser?.uid || 'user123';\r\n    console.log('Usando ID de usuario:', userId);\r\n    \r\n    try {\r\n      console.log('Intentando guardar proveedor en Firestore...');\r\n      // Si tiene ID, actualizar\r\n      if (datosProveedor.id) {\r\n        console.log('Actualizando proveedor existente con ID:', datosProveedor.id);\r\n        const proveedorRef = doc(db, `users/${userId}/proveedores`, datosProveedor.id);\r\n        const { id, ...datosActualizar } = datosProveedor;\r\n        await updateDoc(proveedorRef, datosActualizar);\r\n        // Proveedor actualizado correctamente\r\n      } else {\r\n        // Si no tiene ID, crear nuevo\r\n        // Creando nuevo proveedor\r\n        const proveedoresRef = collection(db, `users/${userId}/proveedores`);\r\n        const docRef = await addDoc(proveedoresRef, {\r\n          ...datosProveedor,\r\n          createdAt: new Date().toISOString(),\r\n          updatedAt: new Date().toISOString()\r\n        });\r\n        console.log('Proveedor creado con ID:', docRef.id);\r\n      }\r\n      \r\n      // Recargar proveedores\r\n      console.log('Recargando lista de proveedores...');\r\n      await cargarProveedores();\r\n      console.log('Lista de proveedores recargada');\r\n      \r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error al guardar proveedor:', error);\r\n      throw error;\r\n    }\r\n  };\r\n  \r\n  // Eliminar proveedor\r\n  const eliminarProveedor = async (proveedorId) => {\r\n    if (!currentUser?.uid || !proveedorId) return;\r\n    \r\n    if (!window.confirm('¬øEst√°s seguro de que quieres eliminar este proveedor?')) {\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      const proveedorRef = doc(db, `users/${currentUser.uid}/proveedores`, proveedorId);\r\n      await deleteDoc(proveedorRef);\r\n      \r\n      // Actualizar estado local\r\n      setProveedores(prev => prev.filter(p => p.id !== proveedorId));\r\n      setProveedoresFiltrados(prev => prev.filter(p => p.id !== proveedorId));\r\n      \r\n      // Si era el proveedor seleccionado, deseleccionar\r\n      if (proveedorSeleccionado?.id === proveedorId) {\r\n        setProveedorSeleccionado(null);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al eliminar proveedor:', error);\r\n      alert('Error al eliminar el proveedor');\r\n    }\r\n  };\r\n  \r\n  // Marcar/desmarcar favorito\r\n  const toggleFavorito = async (proveedorId) => {\r\n    if (!currentUser?.uid || !proveedorId) return;\r\n    \r\n    try {\r\n      // Encontrar el proveedor en la lista\r\n      const proveedor = proveedores.find(p => p.id === proveedorId);\r\n      if (!proveedor) return;\r\n      \r\n      // Actualizar en Firestore\r\n      const proveedorRef = doc(db, `users/${currentUser.uid}/proveedores`, proveedorId);\r\n      await updateDoc(proveedorRef, {\r\n        favorito: !proveedor.favorito,\r\n        updatedAt: new Date().toISOString()\r\n      });\r\n      \r\n      // Actualizar estado local\r\n      setProveedores(prev => \r\n        prev.map(p => \r\n          p.id === proveedorId ? { ...p, favorito: !p.favorito } : p\r\n        )\r\n      );\r\n      \r\n      // Actualizar filtrados tambi√©n\r\n      setProveedoresFiltrados(prev => \r\n        prev.map(p => \r\n          p.id === proveedorId ? { ...p, favorito: !p.favorito } : p\r\n        )\r\n      );\r\n      \r\n      // Si es el proveedor seleccionado, actualizar\r\n      if (proveedorSeleccionado?.id === proveedorId) {\r\n        setProveedorSeleccionado(prev => ({ ...prev, favorito: !prev.favorito }));\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al marcar favorito:', error);\r\n    }\r\n  };\r\n  \r\n  // Editar proveedor\r\n  const editarProveedor = (proveedor) => {\r\n    setProveedorEditar(proveedor);\r\n    setModalFormularioVisible(true);\r\n  };\r\n  \r\n  // Ver detalle del proveedor\r\n  const verDetalleProveedor = async (proveedor) => {\r\n    setProveedorSeleccionado(proveedor);\r\n    \r\n    // Cargar comunicaciones para este proveedor\r\n    try {\r\n      if (currentUser?.uid && proveedor?.id) {\r\n        const comunicacionesRef = collection(db, `users/${currentUser.uid}/proveedores/${proveedor.id}/comunicaciones`);\r\n        const snapshot = await getDocs(comunicacionesRef);\r\n        \r\n        const nuevasComunicaciones = snapshot.docs.map(doc => ({\r\n          id: doc.id,\r\n          ...doc.data()\r\n        })).sort((a, b) => {\r\n          // Ordenar por fecha descendente\r\n          return new Date(b.fecha) - new Date(a.fecha);\r\n        });\r\n        \r\n        setComunicaciones(nuevasComunicaciones);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al cargar comunicaciones:', error);\r\n      setComunicaciones([]);\r\n    }\r\n  };\r\n  \r\n  // Cerrar detalle\r\n  const cerrarDetalle = () => {\r\n    setProveedorSeleccionado(null);\r\n    setComunicaciones([]);\r\n  };\r\n  \r\n  // A√±adir nueva comunicaci√≥n\r\n  const nuevaComunicacion = async () => {\r\n    // Aqu√≠ ir√≠a un modal para a√±adir comunicaci√≥n\r\n    alert('Funcionalidad de a√±adir comunicaci√≥n en desarrollo');\r\n  };\r\n  \r\n  // Buscar con IA\r\n  const buscarConIA = async (consulta) => {\r\n    if (!consulta) return;\r\n    \r\n    setCargandoBusquedaIA(true);\r\n    setResultadoBusquedaIA(null);\r\n    \r\n    try {\r\n      // Simular b√∫squeda con IA (reemplazar con llamada real a API)\r\n      setTimeout(() => {\r\n        // Resultado simulado\r\n        const resultado = {\r\n          nombre: `Proveedor para: ${consulta}`,\r\n          servicio: consulta.split(' ')[0] || 'Servicio',\r\n          descripcion: `Este es un proveedor encontrado para tu b√∫squeda: \"${consulta}\". Aqu√≠ ir√≠a una descripci√≥n generada por IA con informaci√≥n relevante sobre el proveedor.`,\r\n          web: 'https://ejemplo.com',\r\n          ubicacion: 'Madrid, Espa√±a',\r\n          contacto: 'Persona de contacto',\r\n          email: 'contacto@ejemplo.com',\r\n          telefono: '+34 123 456 789'\r\n        };\r\n        \r\n        setResultadoBusquedaIA(resultado);\r\n        setCargandoBusquedaIA(false);\r\n      }, 2000);\r\n    } catch (error) {\r\n      console.error('Error en b√∫squeda IA:', error);\r\n      setCargandoBusquedaIA(false);\r\n    }\r\n  };\r\n  \r\n  // Guardar proveedor de IA\r\n  const guardarProveedorIA = (resultado) => {\r\n    if (!resultado) return;\r\n    \r\n    // Pasar al formulario para completar\r\n    setProveedorEditar({\r\n      nombre: resultado.nombre,\r\n      servicio: resultado.servicio,\r\n      ubicacion: resultado.ubicacion,\r\n      contacto: resultado.contacto,\r\n      email: resultado.email,\r\n      telefono: resultado.telefono,\r\n      web: resultado.web,\r\n      notas: resultado.descripcion,\r\n      estado: 'Nuevo',\r\n      favorito: false\r\n    });\r\n    \r\n    // Cerrar modal IA y abrir formulario\r\n    setModalAIVisible(false);\r\n    setModalFormularioVisible(true);\r\n  };\r\n  \r\n  // Determinar contenido principal\r\n  let contenidoPrincipal;\r\n  \r\n  if (error) {\r\n    contenidoPrincipal = (\r\n      <div className=\"bg-red-50 border-l-4 border-red-400 p-4 mt-4\">\r\n        <div className=\"flex\">\r\n          <div className=\"flex-shrink-0\">\r\n            <svg className=\"h-5 w-5 text-red-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n              <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\r\n            </svg>\r\n          </div>\r\n          <div className=\"ml-3\">\r\n            <p className=\"text-sm text-red-700\">{error}</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  } else if (cargando) {\r\n    contenidoPrincipal = (\r\n      <div className=\"flex justify-center items-center h-64\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500\"></div>\r\n      </div>\r\n    );\r\n  } else if (proveedorSeleccionado) {\r\n    // Vista detalle del proveedor\r\n    contenidoPrincipal = (\r\n      <ProveedorDetalle\r\n        proveedor={proveedorSeleccionado}\r\n        comunicaciones={comunicaciones}\r\n        onCerrar={cerrarDetalle}\r\n        onEditar={editarProveedor}\r\n        onNuevaComunicacion={nuevaComunicacion}\r\n      />\r\n    );\r\n  } else {\r\n    // Lista de proveedores\r\n    contenidoPrincipal = (\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\r\n        {proveedoresFiltrados.length > 0 ? (\r\n          proveedoresFiltrados.map(proveedor => (\r\n            <ProveedorCardNuevo\r\n              key={proveedor.id}\r\n              proveedor={proveedor}\r\n              onClick={verDetalleProveedor}\r\n              onToggleFavorito={toggleFavorito}\r\n              onEditar={() => editarProveedor(proveedor)}\r\n              onEliminar={eliminarProveedor}\r\n            />\r\n          ))\r\n        ) : (\r\n          <div className=\"col-span-full flex flex-col items-center justify-center py-16\">\r\n            <svg className=\"h-12 w-12 text-gray-300\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\" />\r\n            </svg>\r\n            <h3 className=\"mt-2 text-lg font-medium text-gray-900\">No hay proveedores</h3>\r\n            <p className=\"mt-1 text-sm text-gray-500\">\r\n              {textoBusqueda ? 'No se encontraron resultados para tu b√∫squeda.' : 'Comienza a√±adiendo un nuevo proveedor.'}\r\n            </p>\r\n            <div className=\"mt-6\">\r\n              <button\r\n                onClick={() => setModalFormularioVisible(true)}\r\n                className=\"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\r\n              >\r\n                <Plus className=\"-ml-1 mr-2 h-5 w-5\" aria-hidden=\"true\" />\r\n                A√±adir proveedor\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  return (\r\n    <div className=\"container mx-auto px-4 py-8 max-w-7xl\">\r\n      <div className=\"sm:flex sm:items-center sm:justify-between mb-6\">\r\n        <div>\r\n          <h1 className=\"text-2xl font-semibold text-gray-900\">Gesti√≥n de Proveedores</h1>\r\n          <p className=\"mt-1 text-sm text-gray-500\">\r\n            Administra todos los proveedores para tu boda\r\n          </p>\r\n        </div>\r\n        \r\n        {!proveedorSeleccionado && (\r\n          <div className=\"mt-4 sm:mt-0 sm:ml-16 flex space-x-3\">\r\n            <button\r\n              onClick={() => setModalAIVisible(true)}\r\n              className=\"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500\"\r\n            >\r\n              <Sparkles className=\"-ml-1 mr-2 h-5 w-5\" aria-hidden=\"true\" />\r\n              Buscar con IA\r\n            </button>\r\n            <button\r\n              onClick={() => setModalFormularioVisible(true)}\r\n              className=\"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\r\n            >\r\n              <Plus className=\"-ml-1 mr-2 h-5 w-5\" aria-hidden=\"true\" />\r\n              A√±adir proveedor\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Filtros solo visibles si no hay proveedor seleccionado */}\r\n      {!proveedorSeleccionado && (\r\n        <ProveedorFiltro \r\n          filtroActivo={filtroActivo}\r\n          onCambioFiltro={cambiarFiltro}\r\n          textoBusqueda={textoBusqueda}\r\n          onCambioTexto={cambiarTextoBusqueda}\r\n          onBuscar={buscar}\r\n        />\r\n      )}\r\n      \r\n      {/* Contenido principal */}\r\n      {contenidoPrincipal}\r\n      \r\n      {/* Modales */}\r\n      <ProveedorFormModal\r\n        visible={modalFormularioVisible}\r\n        onClose={() => {\r\n          setModalFormularioVisible(false);\r\n          setProveedorEditar(null);\r\n        }}\r\n        onGuardar={guardarProveedor}\r\n        proveedorEditar={proveedorEditar}\r\n      />\r\n      \r\n      <AIBusquedaModal\r\n        visible={modalAIVisible}\r\n        onClose={() => {\r\n          setModalAIVisible(false);\r\n          setResultadoBusquedaIA(null);\r\n        }}\r\n        onBuscar={buscarConIA}\r\n        onGuardar={guardarProveedorIA}\r\n        resultado={resultadoBusquedaIA}\r\n        cargando={cargandoBusquedaIA}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default GestionProveedores;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\Home.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\Ideas.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\Inspiration.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\Invitaciones.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Search' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'handleSaveDraft' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":54,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":54,"endColumn":24},{"ruleId":"no-unused-vars","severity":1,"message":"'handleDuplicateDesign' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":62,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":62,"endColumn":30},{"ruleId":"no-unused-vars","severity":1,"message":"'SyncIndicator' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":104,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":104,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Search, Eye, Download, Save, Copy, Zap, Cloud, CloudOff, RefreshCw } from 'lucide-react';\r\nimport Spinner from '../components/Spinner';\r\nimport Toast from '../components/Toast';\r\nimport Card from '../components/Card';\r\nimport { saveData, loadData, subscribeSyncState, getSyncState } from '../services/SyncService';\r\n\r\nexport default function Invitaciones() {\r\n  // Estado de sincronizaci√≥n\r\n  const [syncStatus, setSyncStatus] = useState(getSyncState());\r\n\r\n  // Suscribirse a cambios en el estado de sincronizaci√≥n\r\n  useEffect(() => {\r\n    const unsubscribe = subscribeSyncState(setSyncStatus);\r\n    return () => unsubscribe();\r\n  }, []);\r\n  \r\n  const [aiPrompt, setAiPrompt] = useState(() => loadData('invitationAiPrompt', { defaultValue: '', collection: 'userInvitations' }));\r\n  const [loading, setLoading] = useState(false);\r\n  const [generatedText, setGeneratedText] = useState('');\r\n  const [toast, setToast] = useState(null);\r\n  const [showPreview, setShowPreview] = useState(() => loadData('invitationShowPreview', { defaultValue: false, collection: 'userInvitations' }));\r\n  const handleAiGenerate = async () => {\r\n    if (!aiPrompt) return;\r\n    setLoading(true);\r\n    setToast(null);\r\n    try {\r\n      const response = await fetch('https://api.openai.com/v1/chat/completions', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${import.meta.env.VITE_OPENAI_API_KEY}`,\r\n          'OpenAI-Project': import.meta.env.VITE_OPENAI_PROJECT_ID\r\n        },\r\n        body: JSON.stringify({\r\n          model: 'gpt-3.5-turbo',\r\n          messages: [\r\n            { role: 'system', content: 'You are a helpful assistant specialized in generating invitation texts.' },\r\n            { role: 'user', content: aiPrompt }\r\n          ]\r\n        })\r\n      });\r\n      const data = await response.json();\r\n      const text = data.choices?.[0]?.message?.content || '';\r\n      setGeneratedText(text);\r\n      setToast({ message: 'Invitaci√≥n generada', type: 'success' });\r\n    } catch (err) {\r\n      console.error(err);\r\n      setToast({ message: 'Error generando invitaci√≥n', type: 'error' });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };  \r\n  const handleSaveDraft = () => {\r\n    const draft = { aiPrompt, panel, filterCategory, filterColor, filterFont, step, generatedText };\r\n    saveData('invitationDraft', draft, {\r\n      collection: 'userInvitations',\r\n      showNotification: true\r\n    });\r\n    setToast({ message: 'Borrador guardado', type: 'success' });\r\n  };\r\n  const handleDuplicateDesign = () => {\r\n    const draftKey = `invitationDraft_${Date.now()}`;\r\n    const data = { aiPrompt, panel, filterCategory, filterColor, filterFont, step, generatedText };\r\n    saveData(draftKey, data, {\r\n      collection: 'userInvitations',\r\n      showNotification: false\r\n    });\r\n    setToast({ message: 'Dise√±o duplicado', type: 'success' });\r\n  };\r\n  const [panel, setPanel] = useState(() => loadData('invitationPanel', { defaultValue: 'invitation', collection: 'userInvitations' })); // 'invitation' o 'envelope'\r\n  const [filterCategory, setFilterCategory] = useState(() => loadData('invitationFilterCategory', { defaultValue: '', collection: 'userInvitations' }));\r\n  const [filterColor, setFilterColor] = useState(() => loadData('invitationFilterColor', { defaultValue: '', collection: 'userInvitations' }));\r\n  const [filterFont, setFilterFont] = useState(() => loadData('invitationFilterFont', { defaultValue: '', collection: 'userInvitations' }));\r\n  const [step, setStep] = useState(() => {\r\n    const savedStep = loadData('invitationStep', { defaultValue: '1', collection: 'userInvitations' });\r\n    return parseInt(savedStep) || 1;\r\n  });\r\n\r\n  // Ejemplo de plantillas\r\n  const templates = [\r\n    { id: 1, name: 'Cl√°sico', category: 'cl√°sico', color: 'pastel', font: 'Serif' },\r\n    { id: 2, name: 'Moderno', category: 'moderno', color: 'vibrante', font: 'Sans' },\r\n    { id: 3, name: 'R√∫stico', category: 'r√∫stico', color: 'tierra', font: 'Handwriting' },\r\n    { id: 4, name: 'Minimalista', category: 'minimalista', color: 'monocromo', font: 'Sans' },\r\n  ];\r\n  const filtered = templates.filter(t =>\r\n    (filterCategory ? t.category === filterCategory : true) &&\r\n    (filterColor ? t.color === filterColor : true) &&\r\n    (filterFont ? t.font === filterFont : true)\r\n  );\r\n  useEffect(() => {\r\n    saveData('invitationAiPrompt', aiPrompt, { collection: 'userInvitations', showNotification: false });\r\n    saveData('invitationPanel', panel, { collection: 'userInvitations', showNotification: false });\r\n    saveData('invitationFilterCategory', filterCategory, { collection: 'userInvitations', showNotification: false });\r\n    saveData('invitationFilterColor', filterColor, { collection: 'userInvitations', showNotification: false });\r\n    saveData('invitationFilterFont', filterFont, { collection: 'userInvitations', showNotification: false });\r\n    saveData('invitationStep', step.toString(), { collection: 'userInvitations', showNotification: false });\r\n    saveData('invitationGeneratedText', generatedText, { collection: 'userInvitations', showNotification: false });\r\n    saveData('invitationShowPreview', showPreview, { collection: 'userInvitations', showNotification: false });\r\n  }, [aiPrompt, panel, filterCategory, filterColor, filterFont, step, generatedText, showPreview]);\r\n\r\n  // Indicador de sincronizaci√≥n\r\n  const SyncIndicator = () => (\r\n    <div className=\"fixed bottom-4 right-4 z-50 flex items-center space-x-2 bg-white px-3 py-2 rounded-full shadow-md\">\r\n      {syncStatus === 'online' ? (\r\n        <>\r\n          <Cloud size={18} className=\"text-green-500\" />\r\n          <span className=\"text-sm\">Sincronizado</span>\r\n        </>\r\n      ) : syncStatus === 'offline' ? (\r\n        <>\r\n          <CloudOff size={18} className=\"text-yellow-500\" />\r\n          <span className=\"text-sm\">Guardado localmente</span>\r\n        </>\r\n      ) : (\r\n        <>\r\n          <RefreshCw size={18} className=\"text-blue-500 animate-spin\" />\r\n          <span className=\"text-sm\">Sincronizando...</span>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <Card className=\"p-6 space-y-6\">\r\n\r\n      {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}  \r\n      <h1 className=\"text-2xl font-semibold\">Dise√±o de Invitaciones</h1>\r\n      <div className=\"flex justify-between mb-4\">  \r\n        {step > 1 && <button onClick={() => setStep(step - 1)} className=\"bg-gray-200 px-3 py-1 rounded\">Anterior</button>}  \r\n        {step < 4 && <button onClick={() => setStep(step + 1)} className=\"bg-blue-600 text-white px-3 py-1 rounded\">Siguiente</button>}  \r\n        {step === 4 && <button onClick={() => alert('Wizard completado')} className=\"bg-green-600 text-white px-3 py-1 rounded\">Finalizar</button>}  \r\n      </div>\r\n\r\n      {/* Asistente de IA */}\r\n      {step === 1 && (\r\n        <section className=\"border rounded p-4 space-y-4\">\r\n          <h2 className=\"text-lg font-semibold\">Asistente de IA</h2>\r\n          <textarea\r\n            rows={3}\r\n            placeholder=\"Describe c√≥mo quieres tu invitaci√≥n...\"\r\n            value={aiPrompt}\r\n            onChange={e => setAiPrompt(e.target.value)}\r\n            className=\"w-full border rounded p-2\"\r\n          />\r\n          <button\r\n            onClick={handleAiGenerate}\r\n            disabled={loading}\r\n            className=\"bg-indigo-600 text-white px-4 py-2 rounded flex items-center\"\r\n          >\r\n            {loading ? <Spinner size={16} className=\"mr-2\" /> : <Zap size={16} className=\"mr-2\" />} {loading ? 'Generando...' : 'Generar invitaci√≥n'}\r\n          </button>\r\n        </section>\r\n      )}\r\n\r\n      {/* Selecci√≥n de Plantilla */}\r\n      {step === 2 && (\r\n        <section className=\"border rounded p-4 space-y-4\">\r\n          <h2 className=\"text-lg font-semibold\">Selecci√≥n de Plantilla</h2>\r\n          <div className=\"flex gap-4 flex-wrap\">\r\n            <select value={filterCategory} onChange={e => setFilterCategory(e.target.value)} className=\"border rounded px-2 py-1\">\r\n              <option value=\"\">Todos los estilos</option>\r\n              <option value=\"cl√°sico\">Cl√°sico</option>\r\n              <option value=\"moderno\">Moderno</option>\r\n              <option value=\"r√∫stico\">R√∫stico</option>\r\n              <option value=\"minimalista\">Minimalista</option>\r\n            </select>\r\n            <select value={filterColor} onChange={e => setFilterColor(e.target.value)} className=\"border rounded px-2 py-1\">\r\n              <option value=\"\">Todas las paletas</option>\r\n              <option value=\"pastel\">Pastel</option>\r\n              <option value=\"vibrante\">Vibrante</option>\r\n              <option value=\"tierra\">Tierra</option>\r\n              <option value=\"monocromo\">Monocromo</option>\r\n            </select>\r\n            <select value={filterFont} onChange={e => setFilterFont(e.target.value)} className=\"border rounded px-2 py-1\">\r\n              <option value=\"\">Todas las tipograf√≠as</option>\r\n              <option value=\"Serif\">Serif</option>\r\n              <option value=\"Sans\">Sans</option>\r\n              <option value=\"Handwriting\">Handwriting</option>\r\n            </select>\r\n          </div>\r\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4\">\r\n            {filtered.map(t => (\r\n              <div key={t.id} className=\"border rounded overflow-hidden cursor-pointer hover:shadow-lg\">\r\n                <div className=\"h-32 bg-gray-100 flex items-center justify-center\">\r\n                  <span className=\"text-sm font-medium\">{t.name}</span>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </section>\r\n      )}\r\n\r\n      {/* Editor Invitaci√≥n/Sobre */}\r\n      {step === 3 && (\r\n        <section className=\"border rounded p-4 space-y-4\">\r\n          <div className=\"flex gap-4\">\r\n            <button onClick={() => setPanel('invitation')} className={`px-4 py-2 rounded ${panel==='invitation'?'bg-blue-600 text-white':'bg-gray-200'}`}>Invitaci√≥n</button>\r\n            <button onClick={() => setPanel('envelope')} className={`px-4 py-2 rounded ${panel==='envelope'?'bg-blue-600 text-white':'bg-gray-200'}`}>Sobre</button>\r\n          </div>\r\n          <div className=\"border bg-white h-[400px] flex items-center justify-center text-gray-400\">\r\n            {panel === 'invitation'\r\n              ? 'Canvas de invitaci√≥n: arrastra componentes aqu√≠'\r\n              : 'Canvas de sobre: frontal / trasero'}\r\n          </div>\r\n        </section>\r\n      )}\r\n\r\n      {/* Preview y Exportaci√≥n */}\r\n      {step === 4 && (\r\n        <section className=\"flex flex-wrap gap-2\">\r\n          <button\r\n            onClick={() => setShowPreview(prev => !prev)}\r\n            className=\"bg-blue-600 text-white px-4 py-2 rounded flex items-center\"\r\n          >\r\n            <Eye size={16} className=\"mr-2\" />{showPreview ? 'Ocultar preview' : 'Previsualizar'}\r\n          </button>\r\n          <button className=\"bg-green-600 text-white px-4 py-2 rounded flex items-center\">\r\n            <Download size={16} className=\"mr-2\" />Exportar PDF\r\n          </button>\r\n          <button className=\"bg-gray-200 text-gray-800 px-4 py-2 rounded flex items-center\">\r\n            <Download size={16} className=\"mr-2\" />Exportar PNG\r\n          </button>\r\n          <button className=\"bg-purple-600 text-white px-4 py-2 rounded\">\r\n            Compartir\r\n          </button>\r\n        </section>\r\n      )}\r\n      {showPreview && generatedText && (\r\n        <section className=\"border rounded p-4 bg-gray-50 mt-4\">\r\n          <h3 className=\"text-lg font-semibold\">Preview de Invitaci√≥n</h3>\r\n          <p className=\"whitespace-pre-wrap\">{generatedText}</p>\r\n        </section>\r\n      )}\r\n      {/* Opciones Avanzadas */}\r\n      {step === 4 && (\r\n        <section className=\"border rounded p-4\">\r\n          <h2 className=\"text-lg font-semibold\">Opciones Avanzadas</h2>\r\n          <div className=\"flex gap-2 mt-2\">\r\n            <button className=\"bg-gray-200 px-3 py-1 rounded flex items-center\">\r\n              <Save size={16} className=\"mr-2\" />Guardar Borrador\r\n            </button>\r\n            <button className=\"bg-gray-200 px-3 py-1 rounded flex items-center\">\r\n              <Copy size={16} className=\"mr-2\" />Duplicar Dise√±o\r\n            </button>\r\n          </div>\r\n        </section>\r\n      )}\r\n\r\n    </Card>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\Invitados.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'stats' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":38,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":38,"endColumn":10}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Cloud, CloudOff } from 'lucide-react';\nimport Modal from '../components/Modal';\nimport GuestForm from '../components/guests/GuestForm';\nimport GuestList from '../components/guests/GuestList';\nimport GuestFilters from '../components/guests/GuestFilters';\nimport useGuests from '../hooks/useGuests';\nimport useTranslations from '../hooks/useTranslations';\nimport { useWedding } from '../context/WeddingContext';\nimport { useAuth } from '../hooks/useAuth';\n\n/**\n * P√°gina de gesti√≥n de invitados completamente refactorizada\n * Arquitectura modular, optimizada y mantenible\n * \n * OPTIMIZACIONES IMPLEMENTADAS:\n * - Eliminado c√≥digo legacy (597 l√≠neas ‚Üí 140 l√≠neas)\n * - Arquitectura modular con componentes especializados\n * - Hook personalizado useGuests para l√≥gica centralizada\n * - Memoizaci√≥n y optimizaci√≥n de re-renders\n * - Integraci√≥n con sistema i18n\n * - UX mejorada con indicadores de estado\n */\nfunction Invitados() {\n  // Estados para modales\n  const [showGuestModal, setShowGuestModal] = useState(false);\n  const [editingGuest, setEditingGuest] = useState(null);\n  const [isSaving, setIsSaving] = useState(false);\n\n  // Hooks reales\n  const { t } = useTranslations();\n  const { currentUser } = useAuth();\n  const { weddings, activeWedding } = useWedding();\n    \n  // Datos provenientes de Firebase mediante hooks\n  const {\n    guests,\n    stats,\n    filters,\n    syncStatus,\n    isLoading,\n    addGuest,\n    updateGuest,\n    removeGuest,\n    inviteViaWhatsApp,\n    inviteViaEmail,\n    bulkInviteWhatsApp,\n    importFromContacts,\n    exportToCSV,\n    updateFilters\n  } = useGuests();\n                          \n  // Manejar apertura de modal para nuevo invitado\n  const handleAddGuest = () => {\n    setEditingGuest(null);\n    setShowGuestModal(true);\n  };\n\n  // Manejar apertura de modal para editar invitado\n  const handleEditGuest = (guest) => {\n    setEditingGuest(guest);\n    setShowGuestModal(true);\n  };\n\n  // Manejar guardado de invitado (nuevo o editado)\n  const handleSaveGuest = async (guestData) => {\n    setIsSaving(true);\n    \n    try {\n      let result;\n      if (editingGuest) {\n        result = await updateGuest(editingGuest.id, guestData);\n      } else {\n        result = await addGuest(guestData);\n      }\n      \n      if (result.success) {\n        setShowGuestModal(false);\n        setEditingGuest(null);\n      } else {\n        alert(`Error: ${result.error}`);\n      }\n    } catch (error) {\n      console.error('Error guardando invitado:', error);\n      alert('Error inesperado al guardar el invitado');\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  // Manejar eliminaci√≥n de invitado\n  const handleDeleteGuest = async (guest) => {\n    const result = await removeGuest(guest.id);\n    if (!result.success) {\n      alert(`Error eliminando invitado: ${result.error}`);\n    }\n  };\n\n  // Manejar cancelaci√≥n de modal\n  const handleCancelModal = () => {\n    setShowGuestModal(false);\n    setEditingGuest(null);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 p-4 md:p-6\">\n      <div className=\"max-w-7xl mx-auto space-y-6\">\n        {/* Header con indicador de sincronizaci√≥n */}\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-2xl md:text-3xl font-bold text-gray-900\">\n              {t('guests.guestList')}\n            </h1>\n            <p className=\"text-gray-600 mt-1\">\n              Gestiona tu lista de invitados de forma eficiente\n            </p>\n          </div>\n          \n          {/* Indicador de sincronizaci√≥n */}\n          <div className=\"flex items-center space-x-2\">\n            {syncStatus?.isOnline ? (\n              <div className=\"flex items-center text-green-600 bg-green-50 px-3 py-1 rounded-full\">\n                <Cloud size={16} className=\"mr-2\" />\n                <span className=\"text-sm font-medium\">Sincronizado</span>\n              </div>\n            ) : (\n              <div className=\"flex items-center text-orange-600 bg-orange-50 px-3 py-1 rounded-full\">\n                <CloudOff size={16} className=\"mr-2\" />\n                <span className=\"text-sm font-medium\">Sin conexi√≥n</span>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Filtros y acciones */}\n        <GuestFilters\n          searchTerm={filters?.search || ''}\n          statusFilter={filters?.status || ''}\n          tableFilter={filters?.table || ''}\n          onSearchChange={(value) => updateFilters({ search: value })}\n          onStatusFilterChange={(value) => updateFilters({ status: value })}\n          onTableFilterChange={(value) => updateFilters({ table: value })}\n          onAddGuest={handleAddGuest}\n          onBulkInvite={bulkInviteWhatsApp}\n          onImportGuests={importFromContacts}\n          onExportGuests={exportToCSV}\n          guestCount={(guests?.length) || 0}\n          isLoading={isLoading}\n        />\n\n        {/* Debug info para verificar estado */}\n        {import.meta.env.DEV && (\n          <div className=\"bg-blue-50 p-4 rounded-lg text-sm\">\n            <strong>Debug Info:</strong><br/>\n            - activeWedding: {activeWedding || 'null'}<br/>\n            - weddings count: {weddings?.length || 0}<br/>\n            - guests count: {guests?.length || 0}<br/>\n            - isLoading: {isLoading ? 'true' : 'false'}<br/>\n            - Firebase Auth: {window.auth?.currentUser?.email || 'No autenticado'}<br/>\n            - Usuario Context: {currentUser ? JSON.stringify({uid: currentUser.uid, email: currentUser.email}) : 'null'}<br/>\n            - Ruta Firestore: weddings/{activeWedding || 'null'}/guests<br/>\n            <button \n              onClick={() => {\n                import('../firebaseConfig').then(({ auth }) => {\n                  import('firebase/auth').then(({ signInWithEmailAndPassword }) => {\n                    signInWithEmailAndPassword(auth, 'danielnavarrocampos@icloud.com', 'password123')\n                      .then(() => console.log('Login manual exitoso'))\n                      .catch(err => console.error('Login manual fall√≥:', err));\n                  });\n                });\n              }}\n              className=\"mt-2 px-3 py-1 bg-blue-500 text-white rounded text-xs\"\n            >\n              Login Manual\n            </button>\n          </div>\n        )}\n\n        {/* Fallback temporal: sin bodas visibles para el usuario */}\n        {(!isLoading && Array.isArray(weddings) && weddings.length === 0) && (\n          <div className=\"text-sm text-gray-600\">\n            {activeWedding\n              ? 'No se encontraron bodas asociadas a tu cuenta o no tienes permisos sobre la boda activa. Si el problema persiste, recarga la p√°gina o contacta con soporte.'\n              : 'No se encontraron bodas asociadas a tu cuenta. Crea o selecciona una boda para gestionar invitados.'}\n          </div>\n        )}\n\n        {/* Lista de invitados */}\n        <GuestList\n          guests={guests || []}\n          searchTerm={filters?.search || ''}\n          statusFilter={filters?.status || ''}\n          tableFilter={filters?.table || ''}\n          onEdit={handleEditGuest}\n          onDelete={handleDeleteGuest}\n          onInviteWhatsApp={inviteViaWhatsApp}\n          onInviteEmail={inviteViaEmail}\n          isLoading={isLoading}\n        />\n\n        {/* Modal de formulario de invitado */}\n        <Modal\n          open={showGuestModal}\n          onClose={handleCancelModal}\n          title={editingGuest ? 'Editar Invitado' : 'A√±adir Invitado'}\n          size=\"lg\"\n        >\n          <GuestForm\n            guest={editingGuest}\n            onSave={handleSaveGuest}\n            onCancel={handleCancelModal}\n            isLoading={isSaving}\n          />\n        </Modal>\n      </div>\n    </div>\n  );\n}\n\nexport default Invitados;\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\InvitadosRefactored.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'stats' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":21,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":10}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { Cloud, CloudOff } from 'lucide-react';\r\nimport Modal from '../components/Modal';\r\nimport GuestForm from '../components/guests/GuestForm';\r\nimport GuestList from '../components/guests/GuestList';\r\nimport GuestFilters from '../components/guests/GuestFilters';\r\nimport GuestBulkGrid from '../components/guests/GuestBulkGrid';\r\nimport useGuests from '../hooks/useGuests';\r\nimport useTranslations from '../hooks/useTranslations';\r\n\r\n/**\r\n * P√°gina de gesti√≥n de invitados completamente refactorizada\r\n * Arquitectura modular, optimizada y mantenible\r\n */\r\nconst InvitadosRefactored = () => {\r\n  const { t } = useTranslations();\r\n  \r\n  // Hook personalizado para gesti√≥n de invitados\r\n  const {\r\n    guests,\r\n    stats,\r\n    filters,\r\n    syncStatus,\r\n    isLoading,\r\n    addGuest,\r\n    updateGuest,\r\n    removeGuest,\r\n    inviteViaWhatsApp,\r\n    inviteViaEmail,\r\n    bulkInviteWhatsApp,\r\n    importFromContacts,\r\n    exportToCSV,\r\n    updateFilters\r\n  } = useGuests();\r\n\r\n  // Estados para modales\r\n  const [showGuestModal, setShowGuestModal] = useState(false);\r\n  const [editingGuest, setEditingGuest] = useState(null);\r\n  const [isSaving, setIsSaving] = useState(false);\r\n  const [showBulkModal, setShowBulkModal] = useState(false);\r\n  const [isBulkSaving, setIsBulkSaving] = useState(false);\r\n\r\n  // Manejar apertura de modal para nuevo invitado\r\n  const handleAddGuest = () => {\r\n    setEditingGuest(null);\r\n    setShowGuestModal(true);\r\n  };\r\n\r\n  // Manejar apertura de modal para editar invitado\r\n  const handleEditGuest = (guest) => {\r\n    setEditingGuest(guest);\r\n    setShowGuestModal(true);\r\n  };\r\n\r\n  // Manejar guardado de invitado (nuevo o editado)\r\n  const handleSaveGuest = async (guestData) => {\r\n    setIsSaving(true);\r\n    \r\n    try {\r\n      let result;\r\n      if (editingGuest) {\r\n        result = await updateGuest(editingGuest.id, guestData);\r\n      } else {\r\n        result = await addGuest(guestData);\r\n      }\r\n      \r\n      if (result.success) {\r\n        setShowGuestModal(false);\r\n        setEditingGuest(null);\r\n      } else {\r\n        alert(`Error: ${result.error}`);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error guardando invitado:', error);\r\n      alert('Error inesperado al guardar el invitado');\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  // Manejar eliminaci√≥n de invitado\r\n  const handleDeleteGuest = async (guest) => {\r\n    const result = await removeGuest(guest.id);\r\n    if (!result.success) {\r\n      alert(`Error eliminando invitado: ${result.error}`);\r\n    }\r\n  };\r\n\r\n  // Manejar cancelaci√≥n de modal\r\n  const handleCancelModal = () => {\r\n    setShowGuestModal(false);\r\n    setEditingGuest(null);\r\n  };\r\n\r\n  // Alta masiva\r\n  const handleBulkAdd = () => {\r\n    setShowBulkModal(true);\r\n  };\r\n\r\n  const handleSaveBulk = async (guestRows) => {\r\n    setIsBulkSaving(true);\r\n    try {\r\n      for (const row of guestRows) {\r\n        await addGuest(row);\r\n      }\r\n      setShowBulkModal(false);\r\n    } catch (error) {\r\n      console.error('Error guardando invitados masivos:', error);\r\n      alert('Error inesperado al guardar invitados masivos');\r\n    } finally {\r\n      setIsBulkSaving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 p-4 md:p-6\">\r\n      <div className=\"max-w-7xl mx-auto space-y-6\">\r\n        {/* Header con indicador de sincronizaci√≥n */}\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h1 className=\"text-2xl md:text-3xl font-bold text-gray-900\">\r\n              {t('guests.guestList')}\r\n            </h1>\r\n            <p className=\"text-gray-600 mt-1\">\r\n              Gestiona tu lista de invitados de forma eficiente\r\n            </p>\r\n          </div>\r\n          \r\n          {/* Indicador de sincronizaci√≥n */}\r\n          <div className=\"flex items-center space-x-2\">\r\n            {syncStatus.isOnline ? (\r\n              <div className=\"flex items-center text-green-600 bg-green-50 px-3 py-1 rounded-full\">\r\n                <Cloud size={16} className=\"mr-2\" />\r\n                <span className=\"text-sm font-medium\">Sincronizado</span>\r\n              </div>\r\n            ) : (\r\n              <div className=\"flex items-center text-orange-600 bg-orange-50 px-3 py-1 rounded-full\">\r\n                <CloudOff size={16} className=\"mr-2\" />\r\n                <span className=\"text-sm font-medium\">Sin conexi√≥n</span>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Filtros y acciones */}\r\n        <GuestFilters\r\n          searchTerm={filters.search}\r\n          statusFilter={filters.status}\r\n          tableFilter={filters.table}\r\n          onSearchChange={(value) => updateFilters({ search: value })}\r\n          onStatusFilterChange={(value) => updateFilters({ status: value })}\r\n          onTableFilterChange={(value) => updateFilters({ table: value })}\r\n          onAddGuest={handleAddGuest}\r\n          onBulkInvite={bulkInviteWhatsApp}\r\n          onImportGuests={importFromContacts}\r\n          onBulkAddGuests={handleBulkAdd}\r\n          onExportGuests={exportToCSV}\r\n          guestCount={guests.length}\r\n          isLoading={isLoading}\r\n        />\r\n\r\n        {/* Lista de invitados */}\r\n        <GuestList\r\n          guests={guests}\r\n          searchTerm={filters.search}\r\n          statusFilter={filters.status}\r\n          tableFilter={filters.table}\r\n          onEdit={handleEditGuest}\r\n          onDelete={handleDeleteGuest}\r\n          onInviteWhatsApp={inviteViaWhatsApp}\r\n          onInviteEmail={inviteViaEmail}\r\n          isLoading={isLoading}\r\n        />\r\n\r\n        {/* Modal de formulario de invitado */}\r\n        <Modal\r\n          open={showGuestModal}\r\n          onClose={handleCancelModal}\r\n          title={editingGuest ? 'Editar Invitado' : 'A√±adir Invitado'}\r\n          size=\"lg\"\r\n        >\r\n          <GuestForm\r\n            guest={editingGuest}\r\n            onSave={handleSaveGuest}\r\n            onCancel={handleCancelModal}\r\n            isLoading={isSaving}\r\n          />\r\n        </Modal>\r\n\r\n        {/* Modal de alta masiva */}\r\n        <Modal\r\n          open={showBulkModal}\r\n          onClose={() => setShowBulkModal(false)}\r\n          title=\"Alta masiva de invitados\"\r\n          size=\"xl\"\r\n        >\r\n          <GuestBulkGrid\r\n            onCancel={() => setShowBulkModal(false)}\r\n            onSave={handleSaveBulk}\r\n            isLoading={isBulkSaving}\r\n          />\r\n        </Modal>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default InvitadosRefactored;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\InvitationDesigner.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\Login.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'location' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":20,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useAuth } from '../hooks/useAuth';\r\nimport { useNavigate, Link, useLocation } from 'react-router-dom';\r\n\r\nexport default function Login() {\r\n  // Cargar email guardado si existe\r\n  const savedEmail = typeof window !== 'undefined' ? localStorage.getItem('lovenda_login_email') || '' : '';\r\n  const [username, setUsername] = useState(savedEmail);\r\n  const [password, setPassword] = useState('');\r\n  const [error, setError] = useState('');\r\n  const [remember, setRemember] = useState(!!savedEmail);\r\n  // Nuevo sistema unificado\r\n  const { login: unifiedLogin, isAuthenticated: unifiedAuth, isLoading } = useAuth();\r\n  \r\n  // Usar el nuevo sistema como principal, con fallback al legacy\r\n  const authLogin = unifiedLogin;\r\n  const authStatus = unifiedAuth;\r\n  const authLoading = isLoading;\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n\r\n  // Redirige autom√°ticamente cuando ya est√°s autenticado\r\n  useEffect(() => {\r\n    if (!authLoading && authStatus) {\r\n      navigate('/home', { replace: true });\r\n    }\r\n  }, [authLoading, authStatus, navigate]);\r\n\r\n  \r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    try {\r\n      const result = await authLogin(username, password, remember);\r\n      if (result && !result.success) {\r\n        throw new Error(result.error?.message || 'Error de autenticaci√≥n');\r\n      }\r\n      // Guarda o elimina el email seg√∫n la preferencia\r\n      if (remember) {\r\n        localStorage.setItem('lovenda_login_email', username);\r\n      } else {\r\n        localStorage.removeItem('lovenda_login_email');\r\n      }\r\n\r\n    } catch (err) {\r\n      setError('Usuario o contrase√±a inv√°lidos');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex items-center justify-center h-screen bg-[var(--color-bg)]\">\r\n      <form onSubmit={handleSubmit} className=\"bg-white p-6 rounded shadow-md\">\r\n        <h2 className=\"text-2xl mb-4\">Iniciar sesi√≥n</h2>\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Nombre de usuario\"\r\n          value={username}\r\n          onChange={(e) => setUsername(e.target.value)}\r\n          className=\"border p-2 w-full mb-4\"\r\n          data-testid=\"email-input\"\r\n        />\r\n        <input\r\n          type=\"password\"\r\n          placeholder=\"Contrase√±a\"\r\n          value={password}\r\n          onChange={(e) => setPassword(e.target.value)}\r\n          className=\"border p-2 w-full mb-4\"\r\n          data-testid=\"password-input\"\r\n        />\r\n        {error && <p className=\"text-red-600 text-sm mb-4\">{error}</p>}\r\n        <div className=\"flex items-center mb-4\">\r\n            <input\r\n              type=\"checkbox\"\r\n              id=\"remember\"\r\n              checked={remember}\r\n              onChange={(e) => {\r\n              setRemember(e.target.checked);\r\n              if (!e.target.checked) {\r\n                localStorage.removeItem('lovenda_login_email');\r\n              }\r\n            }}\r\n              className=\"mr-2\"\r\n            />\r\n            <label htmlFor=\"remember\" className=\"text-sm\">Recu√©rdame</label>\r\n          </div>\r\n          <button\r\n          type=\"submit\"\r\n          className=\"bg-[var(--color-primary)] text-[color:var(--color-surface)] px-4 py-2 rounded w-full hover:bg-[var(--color-accent)] transition-colors\"\r\n          data-testid=\"login-button\"\r\n        >\r\n          Entrar\r\n        </button>\r\n        <p className=\"mt-4 text-sm\">¬øNo tienes cuenta? <Link to=\"/signup\" className=\"text-[var(--color-primary)] hover:underline\">Reg√≠strate</Link></p>\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\MailboxPage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'from' is defined but never used. Allowed unused args must match /^_/u.","line":253,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":253,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * DEPRECATED: Esta p√°gina ha quedado obsoleta. Usa `UnifiedEmail` (/email).\r\n * Se mantiene temporalmente para compatibilidad con tests legacy.\r\n */\r\nimport { useEffect, useState, useCallback } from \"react\";\r\nimport UsernameWizard from \"../components/UsernameWizard\";\r\nimport useEmailUsername from \"../hooks/useEmailUsername\";\r\nimport Button from \"../components/ui/Button\";\r\nimport { auth } from \"../lib/firebase\";\r\nimport { onAuthStateChanged } from \"firebase/auth\";\r\nimport Spinner from \"../components/ui/Spinner\";\r\nimport Alert from \"../components/ui/Alert\";\r\nimport { getMails, initEmailService, markAsRead, deleteMail, sendMail } from \"../services/emailService\";\r\nimport EmailInsights from \"../components/EmailInsights\";\r\n\r\n/**\r\n * P√°gina principal de Buz√≥n (correo interno @mywed360.com)\r\n * Incluye: Sidebar de carpetas, lista de correos, visor del correo y modal para redactar.\r\n * Email backend:\r\n *  - GET  /getMailgunEvents  -> lista de eventos (funci√≥n Cloud)\r\n *  - POST /sendEmail        -> env√≠a correo (funci√≥n Cloud)\r\n */\r\nconst MailboxPage = () => {\r\n  const { getCurrentUsername } = useEmailUsername();\r\n  const [myEmail, setMyEmail] = useState(null);\r\n  const [emails, setEmails] = useState([]);\r\n  const [selected, setSelected] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [showCompose, setShowCompose] = useState(false);\r\n  const [folder, setFolder] = useState(\"inbox\"); // inbox | sent\r\n\r\n\r\n\r\n  const fetchEmails = useCallback(async () => {\r\n    if (!myEmail) return;\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const mails = await getMails(folder === \"sent\" ? \"sent\" : \"inbox\");\r\n      if (Array.isArray(mails)) {\r\n        setEmails(mails);\r\n      } else {\r\n        console.warn(\"Respuesta inesperada de getMails\", mails);\r\n        setEmails([]);\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Error cargando correos:\", err);\r\n      setError(\"No se pudieron cargar los correos\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [myEmail, folder]);\r\n\r\n  // Obtener email del usuario en cuanto Firebase est√© listo\r\n  useEffect(() => {\r\n    const unsub = onAuthStateChanged(auth, async (user) => {\r\n      if (!user) return;\r\n      const username = await getCurrentUsername();\r\n      if (username) {\r\n        const email = `${username}@mywed360.com`;\r\n        setMyEmail(email);\r\n        await initEmailService({ uid: user.uid, emailUsername: username, myWed360Email: email });\r\n      }\r\n    });\r\n    return () => unsub();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  // Carga inicial + polling (se reinicia al cambiar carpeta)\r\n  useEffect(() => {\r\n    if (!myEmail) return;\r\n    fetchEmails();\r\n    const id = setInterval(fetchEmails, 60000);\r\n    return () => clearInterval(id);\r\n  }, [fetchEmails, myEmail, folder]);\r\n\r\n  const handleMarkRead = async (mail) => {\r\n    try {\r\n      await markAsRead(mail.id);\r\n      // Actualizar lista localmente\r\n      setEmails(prev => prev.map(m => m.id === mail.id ? { ...m, read: true } : m));\r\n      setSelected(prev => prev ? { ...prev, read: true } : prev);\r\n    } catch (err) {\r\n      console.error('Error marcando le√≠do:', err);\r\n      alert('No se pudo marcar como le√≠do');\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (mail) => {\r\n    try {\r\n      await deleteMail(mail.id);\r\n      // Quitar de lista local\r\n      setEmails(prev => prev.filter(m => m.id !== mail.id));\r\n      setSelected(null);\r\n    } catch (err) {\r\n      console.error('Error eliminando correo:', err);\r\n      alert('No se pudo eliminar el correo');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex h-full w-full flex-col\">\r\n      {/* Wizard para elegir nombre si es la primera vez */}\r\n      <UsernameWizard />\r\n\r\n      {/* Barra superior */}\r\n      <header className=\"flex items-center justify-between border-b p-4\">\r\n        <h1 className=\"text-lg font-semibold\">Buz√≥n</h1>\r\n        <Button variant=\"primary\" onClick={() => setShowCompose(true)}>\r\n          Redactar\r\n        </Button>\r\n      </header>\r\n\r\n      {/* Cuerpo */}\r\n      <div className=\"flex flex-1 overflow-hidden\">\r\n        {/* Sidebar carpetas */}\r\n        <aside className=\"w-60 border-r p-4\">\r\n          <p className=\"mb-2 font-medium\">Carpetas</p>\r\n          <ul className=\"space-y-1 text-sm\">\r\n            <li\r\n              className={`cursor-pointer ${folder === \"inbox\" ? \"font-semibold text-indigo-600\" : \"text-gray-700\"}`}\r\n              onClick={() => {\r\n                setFolder(\"inbox\");\r\n                setSelected(null);\r\n              }}\r\n            >\r\n              Bandeja de entrada\r\n            </li>\r\n            <li\r\n              className={`cursor-pointer ${folder === \"sent\" ? \"font-semibold text-indigo-600\" : \"text-gray-700\"}`}\r\n              onClick={() => {\r\n                setFolder(\"sent\");\r\n                setSelected(null);\r\n              }}\r\n            >\r\n              Enviados\r\n            </li>\r\n            {/* Futuras carpetas ‚Üí Spam, Papelera */}\r\n          </ul>\r\n        </aside>\r\n\r\n        {/* Lista de correos */}\r\n        <section className=\"w-96 border-r overflow-y-auto\">\r\n          {loading && (\r\n            <div className=\"flex justify-center p-4\">\r\n              <Spinner />\r\n            </div>\r\n          )}\r\n          {error && (\r\n            <Alert variant=\"error\" className=\"m-4 text-sm\">\r\n              {error}\r\n            </Alert>\r\n          )}\r\n          {!loading && !error && (\r\n            <MailList emails={emails} onSelect={setSelected} selected={selected} />\r\n          )}\r\n        </section>\r\n\r\n        {/* Visor de correo */}\r\n        <section className=\"flex-1 overflow-y-auto p-4\">\r\n          {selected ? (\r\n            <MailViewer mail={selected} onMarkRead={handleMarkRead} onDelete={handleDelete} />\r\n          ) : (\r\n            <p>Selecciona un correo‚Ä¶</p>\r\n          )}\r\n        </section>\r\n      </div>\r\n\r\n      {showCompose && (\r\n        <ComposeModal onClose={() => setShowCompose(false)} from={myEmail} />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\n/**\r\n * Lista lateral de correos sencillos.\r\n */\r\nconst MailList = ({ emails, onSelect, selected }) => {\r\n  if (!emails.length) return <p className=\"p-4 text-sm\">No hay correos.</p>;\r\n\r\n  return (\r\n    <ul>\r\n      {emails.map((mail) => (\r\n        <li\r\n          key={mail.id || mail.event || Math.random()}\r\n          onClick={() => onSelect(mail)}\r\n          className={\r\n            \"cursor-pointer border-b px-4 py-3 hover:bg-gray-50 \" +\r\n            (selected === mail ? \"bg-indigo-50\" : \"\")\r\n          }\r\n        >\r\n          <p className=\"text-sm font-medium\">{mail.recipient || mail.to}</p>\r\n          <p className=\"truncate text-xs text-gray-600\">\r\n            {mail.subject || mail.event || \"(Sin asunto)\"}\r\n          </p>\r\n        </li>\r\n      ))}\r\n    </ul>\r\n  );\r\n};\r\n\r\n/**\r\n * Visor del correo seleccionado\r\n */\r\nconst MailViewer = ({ mail, onMarkRead, onDelete }) => {\r\n  if (!mail) return null;\r\n\r\n  const handleMark = () => {\r\n    if (onMarkRead) onMarkRead(mail);\r\n  };\r\n\r\n  const handleDelete = () => {\r\n    if (onDelete && window.confirm(\"¬øBorrar este correo?\")) {\r\n      onDelete(mail);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"prose max-w-none\">\r\n      {/* Encabezado con acciones */}\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h2 className=\"m-0\">{mail.subject || \"(Sin asunto)\"}</h2>\r\n        <div className=\"flex gap-2\">\r\n          {!mail.read && (\r\n            <Button size=\"sm\" onClick={handleMark}>\r\n              Marcar le√≠do\r\n            </Button>\r\n          )}\r\n          <Button size=\"sm\" variant=\"danger\" onClick={handleDelete}>\r\n            Borrar\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      <p className=\"text-sm text-gray-500 mb-4\">\r\n        De: {mail.sender || mail.from} ‚Äî Para: {mail.recipient || mail.to}\r\n      </p>\r\n\r\n      <div\r\n        dangerouslySetInnerHTML={{ __html: mail.body || \"Sin contenido.\" }}\r\n      />\r\n\r\n      <EmailInsights mailId={mail.id} />\r\n    </div>\r\n  );\r\n};\r\n\r\n/**\r\n * Modal para redactar y enviar correos\r\n */\r\nconst ComposeModal = ({ onClose, from }) => {\r\n  const [to, setTo] = useState(\"\");\r\n  const [subject, setSubject] = useState(\"\");\r\n  const [body, setBody] = useState(\"\");\r\n  const [sending, setSending] = useState(false);\r\n  const [error, setError] = useState(null);\r\n\r\n  const handleSend = async () => {\r\n    setSending(true);\r\n    setError(null);\r\n    try {\r\n      await sendMail({ to, subject, body });\r\n      onClose();\r\n    } catch (err) {\r\n      console.error(\"Error enviando correo:\", err);\r\n      setError(String(err?.message || err) || \"No se pudo enviar el correo\");\r\n    } finally {\r\n      setSending(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-start justify-center bg-black/40 overflow-y-auto p-4\">\r\n      <div className=\"w-full max-w-xl rounded-lg bg-white shadow-lg max-h-[90vh] flex flex-col\">\r\n        <div className=\"p-6 pb-4\">\r\n          <h2 className=\"text-lg font-semibold\">Nuevo correo</h2>\r\n        </div>\r\n\r\n        <div className=\"px-6 space-y-4 flex-1 overflow-y-auto\">\r\n          <input\r\n            type=\"email\"\r\n            placeholder=\"Para\"\r\n            className=\"w-full rounded border px-3 py-2 text-sm\"\r\n            value={to}\r\n            onChange={(e) => setTo(e.target.value)}\r\n          />\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Asunto\"\r\n            className=\"w-full rounded border px-3 py-2 text-sm\"\r\n            value={subject}\r\n            onChange={(e) => setSubject(e.target.value)}\r\n          />\r\n          <textarea\r\n            rows=\"8\"\r\n            placeholder=\"Escribe tu mensaje‚Ä¶\"\r\n            className=\"w-full rounded border px-3 py-2 text-sm\"\r\n            value={body}\r\n            onChange={(e) => setBody(e.target.value)}\r\n          />\r\n          {error && (\r\n            <Alert variant=\"error\" className=\"text-sm\">\r\n              {error}\r\n            </Alert>\r\n          )}\r\n        </div>\r\n        <div className=\"p-6 pt-4 mt-2 border-t flex justify-end gap-2 bg-white sticky bottom-0\">\r\n          <Button onClick={onClose} disabled={sending} variant=\"ghost\">\r\n            Cancelar\r\n          </Button>\r\n          <Button onClick={handleSend} disabled={sending || !to} variant=\"primary\">\r\n            {sending ? <Spinner size=\"sm\" /> : \"Enviar\"}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MailboxPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\More.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'User' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { Link, Outlet } from 'react-router-dom';\r\nimport { Users, Briefcase, Clock, User, Layers } from 'lucide-react';\r\n\r\nexport default function More() {\r\n  const [openMenu, setOpenMenu] = useState(null);\r\n  return (\r\n    <div className=\"p-4 md:p-6 space-y-8\">\r\n      {/* Header */}\r\n      <div className=\"mb-6\">\r\n        <h1 className=\"text-2xl font-bold text-gray-800\">M√°s</h1>\r\n      </div>\r\n\r\n      {/* Tiles */}\r\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n        <div className=\"relative\">\r\n        <button onClick={() => setOpenMenu(openMenu==='invitados'?null:'invitados')} className=\"bg-white p-4 rounded shadow hover:shadow-md flex flex-col text-left w-full\">\r\n          <Users size={32} className=\"text-blue-600 mb-2\" />\r\n          <h2 className=\"font-semibold mb-1\">Invitados</h2>\r\n          <p className=\"text-sm text-gray-600\">Gestiona invitados y seating plan.</p>\r\n        </button>\r\n        {openMenu==='invitados' && (\r\n          <div className=\"absolute bg-white border border-gray-200 rounded shadow mt-2 w-full z-10\">\r\n            <Link to=\"/invitados\" className=\"block px-4 py-2 hover:bg-gray-100\">Gesti√≥n de invitados</Link>\r\n            <Link to=\"/invitados/seating\" className=\"block px-4 py-2 hover:bg-gray-100\">Seating plan</Link>\r\n\r\n          </div>\r\n        )}\r\n      </div>\r\n        <div className=\"relative\">\r\n        <button onClick={() => setOpenMenu(openMenu==='proveedores'?null:'proveedores')} className=\"bg-white p-4 rounded shadow hover:shadow-md flex flex-col text-left w-full\">\r\n          <Briefcase size={32} className=\"text-blue-600 mb-2\" />\r\n          <h2 className=\"font-semibold mb-1\">Proveedores</h2>\r\n          <p className=\"text-sm text-gray-600\">Gestiona proveedores y contratos.</p>\r\n        </button>\r\n        {openMenu==='proveedores' && (\r\n          <div className=\"absolute bg-white border border-gray-200 rounded shadow mt-2 w-full z-10\">\r\n            <Link to=\"/proveedores\" className=\"block px-4 py-2 hover:bg-gray-100\">Gesti√≥n de proveedores</Link>\r\n              <Link to=\"/proveedores/contratos\" className=\"block px-4 py-2 hover:bg-gray-100\">Contratos</Link>\r\n            \r\n          </div>\r\n        )}\r\n      </div>\r\n        <div className=\"relative\">\r\n          <button onClick={() => setOpenMenu(openMenu==='protocolo'?null:'protocolo')} className=\"bg-white p-4 rounded shadow hover:shadow-md flex flex-col text-left w-full\">\r\n            <Clock size={32} className=\"text-blue-600 mb-2\" />\r\n            <h2 className=\"font-semibold mb-1\">Protocolo</h2>\r\n            <p className=\"text-sm text-gray-600\">Momentos especiales, Timing y Checklist</p>\r\n          </button>\r\n          {openMenu==='protocolo' && (\r\n            <div className=\"absolute bg-white border border-gray-200 rounded shadow mt-2 w-full z-10\">\r\n              <Link to=\"/protocolo/momentos-especiales\" className=\"block px-4 py-2 hover:bg-gray-100\">Momentos especiales</Link>\r\n              <Link to=\"/protocolo/timing\" className=\"block px-4 py-2 hover:bg-gray-100\">Timing</Link>\r\n              <Link to=\"/protocolo/checklist\" className=\"block px-4 py-2 hover:bg-gray-100\">Checklist</Link>\r\n              <Link to=\"/protocolo/ayuda-ceremonia\" className=\"block px-4 py-2 hover:bg-gray-100\">Ayuda Ceremonia</Link>\r\n            </div>\r\n          )}\r\n        </div>\r\n        <div className=\"relative\">\r\n          <button onClick={() => setOpenMenu(openMenu==='extras'?null:'extras')} className=\"bg-white p-4 rounded shadow hover:shadow-md flex flex-col text-left w-full\">\r\n            <Layers size={32} className=\"text-blue-600 mb-2\" />\r\n            <h2 className=\"font-semibold mb-1\">Extras</h2>\r\n            <p className=\"text-sm text-gray-600\">Dise√±o web e ideas</p>\r\n          </button>\r\n          {openMenu==='extras' && (\r\n            <div className=\"absolute bg-white border border-gray-200 rounded shadow mt-2 w-full z-10\">\r\n              <Link to=\"/diseno-web\" className=\"block px-4 py-2 hover:bg-gray-100\">Dise√±o Web</Link>\r\n              <Link to=\"/disenos\" className=\"block px-4 py-2 hover:bg-gray-100\">Dise√±os</Link>\r\n              <Link to=\"/ideas\" className=\"block px-4 py-2 hover:bg-gray-100\">Ideas</Link>\r\n              <Link to=\"/inspiracion\" className=\"block px-4 py-2 hover:bg-gray-100\">Galer√≠a de Inspiraci√≥n</Link>\r\n              <Link to=\"/blog\" className=\"block px-4 py-2 hover:bg-gray-100\">Blog</Link>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Content */}\r\n      <div className=\"mt-6\">\r\n        <Outlet />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\Notificaciones.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\Perfil.jsx","messages":[{"ruleId":"no-undef","severity":2,"message":"'loadData' is not defined.","line":69,"column":24,"nodeType":"Identifier","messageId":"undef","endLine":69,"endColumn":32},{"ruleId":"no-unused-vars","severity":1,"message":"'LegacyPerfil' is defined but never used. Allowed unused vars must match /^_/u.","line":370,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":370,"endColumn":22},{"ruleId":"no-unused-vars","severity":1,"message":"'updateUserEmail' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":377,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":377,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'reauthenticate' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":379,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":379,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'currentUser' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":380,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":380,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'isEditing' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":397,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":397,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'setIsEditing' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":397,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":397,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Card } from '../components/ui';\r\nimport { Button } from '../components/ui';\r\nimport { Input } from '../components/ui';\r\nimport { useAuth } from '../hooks/useAuthUnified';\r\nimport { toast } from 'react-toastify';\r\nimport useRoles from '../hooks/useRoles';\r\nimport { Users, X } from 'lucide-react';\r\n\r\nimport { auth, db } from '../firebaseConfig'; // respaldo para UID\r\nimport 'react-toastify/dist/ReactToastify.css';\r\nimport { invitePlanner, getWeddingIdForOwner } from '../services/WeddingService';\r\nimport { subscribeSyncState, getSyncState } from '../services/SyncService';\r\nimport { doc, getDoc, setDoc, updateDoc, serverTimestamp } from 'firebase/firestore';\r\n\r\n// ---------------------- NUEVO PERFIL -----------------------\r\nfunction Perfil() {\r\n  const [subscription, setSubscription] = useState('free');\r\n  const [account, setAccount] = useState({\r\n    name: '',\r\n    linkedAccount: '',\r\n    planner: '',\r\n    helpers: '',\r\n    email: '',\r\n    password: '',\r\n  });\r\n  const [weddingInfo, setWeddingInfo] = useState({\r\n    coupleName: '',\r\n    celebrationPlace: '',\r\n    banquetPlace: '',\r\n    schedule: '',\r\n    giftAccount: '',\r\n    numGuests: '',\r\n  });\r\n  // Campo de texto amplio para notas importantes de la boda\r\n  const [importantInfo, setImportantInfo] = useState('');\r\n  const [syncStatus, setSyncStatus] = useState(getSyncState());\r\n  const [plannerEmail, setPlannerEmail] = useState('');\r\n  const [inviteLink, setInviteLink] = useState('');\r\n  const [inviteLoading, setInviteLoading] = useState(false);\r\n\r\n  // Sincronizar n√∫mero de invitados autom√°ticamente\r\n  // Escucha cambios en la lista de invitados en tiempo real\r\n  useEffect(() => {\r\n    function updateGuestCount() {\r\n      let guests = [];\r\n      try {\r\n        guests = JSON.parse(localStorage.getItem('lovendaGuests'));\r\n        if (!Array.isArray(guests)) guests = null;\r\n      } catch { guests = null; }\r\n      if (!guests) {\r\n        guests = [\r\n          { id: 1, name: 'Ana Garc√≠a', phone: '123456789', address: 'Calle Sol 1', companion: 1, table: '5', response: 'S√≠' },\r\n          { id: 2, name: 'Luis Mart√≠nez', phone: '987654321', address: 'Av. Luna 3', companion: 0, table: '', response: 'Pendiente' },\r\n        ];\r\n      }\r\n      const total = guests.reduce((acc, g) => acc + 1 + (parseInt(g.companion)||0), 0);\r\n      setWeddingInfo(w => ({ ...w, numGuests: total }));\r\n    }\r\n    updateGuestCount(); // inicial\r\n    window.addEventListener('lovenda-guests', updateGuestCount);\r\n    return () => window.removeEventListener('lovenda-guests', updateGuestCount);\r\n   }, []);\r\n\r\n  // Escucha notas importantes agregadas desde el chat\r\n  useEffect(() => {\r\n    function updateNotes() {\r\n      setImportantInfo(loadData('importantNotes'));\r\n    }\r\n    window.addEventListener('lovenda-important-note', updateNotes);\r\n    return () => window.removeEventListener('lovenda-important-note', updateNotes);\r\n  }, []);\r\n\r\n  const [billing, setBilling] = useState({\r\n    fullName: '',\r\n    address: '',\r\n    zip: '',\r\n    city: '',\r\n    state: '',\r\n    country: '',\r\n    dni: '',\r\n  });\r\n\r\n  const { userProfile, user: authUser } = useAuth();\r\n  // UID de respaldo usando Firebase Auth (en caso de que useAuth no tenga usuario)\r\n  const fallbackUid = authUser?.uid || auth.currentUser?.uid || null;\r\n  const weddingId = userProfile?.weddingId || '';\r\n  const { roles: collaborators, loading: rolesLoading, assignRole, removeRole } = useRoles(weddingId);\r\n\r\n  const handleAccountChange = (e) => setAccount({ ...account, [e.target.name]: e.target.value });\r\n  const handleWeddingChange = (e) => setWeddingInfo({ ...weddingInfo, [e.target.name]: e.target.value });\r\n  const handleBillingChange = (e) => setBilling({ ...billing, [e.target.name]: e.target.value });\r\n\r\n  const handleCreateInvite = async () => {\r\n\r\n    if (!plannerEmail) return;\r\n    let wid = weddingId;\r\n    const effectiveUid = fallbackUid;\r\n  if (!wid && !effectiveUid) {\r\n      toast.error('Tu sesi√≥n a√∫n no est√° lista. Espera unos segundos e int√©ntalo de nuevo.');\r\n      return;\r\n    }\r\n    if (!wid) {\r\n      // intentar obtener la boda directamente de Firestore por owner\r\n      wid = await getWeddingIdForOwner(effectiveUid);\r\n      if (!wid) {\r\n        toast.error('No se encontr√≥ tu boda. Completa el tutorial o contacta soporte.');\r\n        return;\r\n      }\r\n    }\r\n    try {\r\n      setInviteLoading(true);\r\n      const code = await invitePlanner(wid, plannerEmail.trim().toLowerCase());\r\n      const link = `${window.location.origin}/invitation/${code}`;\r\n      setInviteLink(link);\r\n      try {\r\n        await navigator.clipboard.writeText(link);\r\n        toast.success('Enlace copiado al portapapeles');\r\n      } catch {\r\n        toast.success('Enlace generado');\r\n      }\r\n      setPlannerEmail('');\r\n    } catch (err) {\r\n      console.error(err);\r\n      toast.error('Error creando invitaci√≥n');\r\n    } finally {\r\n      setInviteLoading(false);\r\n    }\r\n  };\r\n\r\n  const saveProfile = async () => {\r\n    const uid = fallbackUid;\r\n    if (!uid) {\r\n      toast.error('No se pudo determinar tu usuario.');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // 1. Datos globales del usuario\r\n      await setDoc(\r\n        doc(db, 'users', uid),\r\n        {\r\n          account,\r\n          subscription,\r\n          billing,\r\n          updatedAt: serverTimestamp(),\r\n        },\r\n        { merge: true }\r\n      );\r\n\r\n      // 2. Datos espec√≠ficos de la boda\r\n      if (weddingId) {\r\n        await updateDoc(doc(db, 'weddings', weddingId), {\r\n          weddingInfo: { ...weddingInfo, importantInfo },\r\n        });\r\n      }\r\n\r\n      toast.success('Perfil guardado');\r\n    } catch (error) {\r\n      console.error('Error guardando perfil:', error);\r\n      toast.error('Error al guardar el perfil');\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    // Suscribirse a cambios en el estado de sincronizaci√≥n\r\n    const unsubscribe = subscribeSyncState(setSyncStatus);\r\n    \r\n    // Cargar datos con la nueva estrategia h√≠brida\r\n    const loadProfileData = async () => {\r\n      const uid = fallbackUid;\r\n      if (!uid) return;\r\n      try {\r\n        // Datos globales\r\n        const userSnap = await getDoc(doc(db, 'users', uid));\r\n        if (userSnap.exists()) {\r\n          const d = userSnap.data();\r\n          if (d.account) setAccount(d.account);\r\n          if (d.subscription) setSubscription(d.subscription);\r\n          if (d.billing) setBilling(d.billing);\r\n        }\r\n\r\n        // Datos de la boda\r\n        if (weddingId) {\r\n          const wedSnap = await getDoc(doc(db, 'weddings', weddingId));\r\n          if (wedSnap.exists() && wedSnap.data().weddingInfo) {\r\n            const wi = wedSnap.data().weddingInfo;\r\n            setWeddingInfo({\r\n              coupleName: wi.coupleName || '',\r\n              celebrationPlace: wi.celebrationPlace || '',\r\n              banquetPlace: wi.banquetPlace || '',\r\n              schedule: wi.schedule || '',\r\n              giftAccount: wi.giftAccount || '',\r\n              numGuests: wi.numGuests || '',\r\n            });\r\n            if (wi.importantInfo) setImportantInfo(wi.importantInfo);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('Error cargando datos del perfil:', error);\r\n        toast.error('Error al cargar el perfil');\r\n      }\r\n    };\r\n    \r\n    loadProfileData();\r\n    \r\n    return () => unsubscribe();\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"space-y-6 p-4 max-w-3xl mx-auto\">\r\n      <div className=\"flex justify-between items-center\">\r\n        <h1 className=\"text-2xl font-semibold\">Perfil</h1>\r\n        \r\n        {/* Indicador de estado de sincronizaci√≥n */}\r\n        <div className=\"flex items-center text-sm\">\r\n          <div className={`w-3 h-3 rounded-full mr-2 ${\r\n            !syncStatus.isOnline ? 'bg-red-500' : \r\n            syncStatus.isSyncing ? 'bg-yellow-500' :\r\n            syncStatus.pendingChanges ? 'bg-orange-500' : 'bg-green-500'\r\n          }`}></div>\r\n          <span>\r\n            {!syncStatus.isOnline ? 'Sin conexi√≥n (modo offline)' : \r\n             syncStatus.isSyncing ? 'Sincronizando...' : \r\n             syncStatus.pendingChanges ? 'Cambios pendientes' : 'Sincronizado'}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Suscripci√≥n */}\r\n      <Card className=\"space-y-4\">\r\n        <h2 className=\"text-lg font-medium\">Tipo de suscripci√≥n</h2>\r\n        <div className=\"flex gap-4\">\r\n          <Button variant={subscription === 'free' ? 'primary' : 'outline'} onClick={() => setSubscription('free')}>Gratis</Button>\r\n          <Button variant={subscription === 'premium' ? 'primary' : 'outline'} onClick={() => setSubscription('premium')}>Premium</Button>\r\n        </div>\r\n      </Card>\r\n\r\n      {/* Informaci√≥n de la cuenta */}\r\n      <Card className=\"space-y-4\">\r\n        <h2 className=\"text-lg font-medium\">Informaci√≥n de la cuenta</h2>\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n          <Input label=\"Nombre\" name=\"name\" value={account.name} onChange={handleAccountChange} />\r\n          <Input label=\"Cuenta vinculada\" name=\"linkedAccount\" value={account.linkedAccount} onChange={handleAccountChange} />\r\n          <Input label=\"Wedding planner vinculada\" name=\"planner\" value={account.planner} onChange={handleAccountChange} />\r\n          <Input label=\"Ayudantes vinculados\" name=\"helpers\" value={account.helpers} onChange={handleAccountChange} />\r\n          <Input label=\"Correo electr√≥nico\" name=\"email\" type=\"email\" value={account.email} onChange={handleAccountChange} />\r\n          <Input label=\"Reestablecer contrase√±a\" name=\"password\" type=\"password\" value={account.password} onChange={handleAccountChange} />\r\n        </div>\r\n        <div className=\"text-right\">\r\n          <Button onClick={saveProfile}>Guardar</Button>\r\n        </div>\r\n      </Card>\r\n\r\n      {/* Informaci√≥n de la boda */}\r\n      <Card className=\"space-y-4\">\r\n        <h2 className=\"text-lg font-medium\">Informaci√≥n de la boda</h2>\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n          <Input label=\"Nombre de la pareja\" name=\"coupleName\" value={weddingInfo.coupleName} onChange={handleWeddingChange} />\r\n          <Input label=\"Lugar de la celebraci√≥n\" name=\"celebrationPlace\" value={weddingInfo.celebrationPlace} onChange={handleWeddingChange} />\r\n          <Input label=\"Lugar del banquete\" name=\"banquetPlace\" value={weddingInfo.banquetPlace} onChange={handleWeddingChange} />\r\n          <Input label=\"Horario\" name=\"schedule\" value={weddingInfo.schedule} onChange={handleWeddingChange} />\r\n          <Input label=\"Cuenta de regalos\" name=\"giftAccount\" value={weddingInfo.giftAccount} onChange={handleWeddingChange} />\r\n          <Input label=\"N√∫mero de invitados\" name=\"numGuests\" type=\"number\" value={weddingInfo.numGuests} readOnly />\r\n        </div>\r\n        <div className=\"text-right\">\r\n          <Button onClick={saveProfile}>Guardar</Button>\r\n        </div>\r\n      </Card>\r\n\r\n      {/* Informaci√≥n importante de la boda */}\r\n      <Card className=\"space-y-4\">\r\n        <h2 className=\"text-lg font-medium\">Informaci√≥n importante de la boda</h2>\r\n        <textarea\r\n          className=\"w-full min-h-[150px] border rounded-md p-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n          placeholder=\"Datos o detalles clave que la IA o el usuario quieran guardar (ej.: alergias, proveedores cr√≠ticos, horarios especiales, etc.)\"\r\n          value={importantInfo}\r\n          onChange={(e)=>setImportantInfo(e.target.value)}\r\n        />\r\n        <div className=\"text-right\">\r\n          <Button onClick={saveProfile}>Guardar</Button>\r\n        </div>\r\n      </Card>\r\n\r\n      {/* Colaboradores */}\r\n      <Card className=\"space-y-4\">\r\n        <h2 className=\"text-lg font-medium flex items-center\"><Users className=\"w-5 h-5 mr-2\" />Colaboradores</h2>\r\n          {/* Invitaci√≥n a wedding planner */}\r\n          <div className=\"flex flex-col sm:flex-row items-center gap-2 mb-4\">\r\n            <Input\r\n              placeholder=\"Email del planner\"\r\n              value={plannerEmail}\r\n              onChange={(e)=>setPlannerEmail(e.target.value)}\r\n              className=\"flex-1\"\r\n            />\r\n            <Button onClick={handleCreateInvite} disabled={inviteLoading || !plannerEmail}>\r\n              {inviteLoading ? 'Creando...' : 'Crear enlace'}\r\n            </Button>\r\n          </div>\r\n          {inviteLink && (\r\n            <p className=\"text-sm text-green-700 break-all mb-4 select-all\">\r\n              Enlace generado: <span className=\"underline\">{inviteLink}</span>\r\n            </p>\r\n          )}\r\n        {rolesLoading ? (\r\n          <p>Cargando...</p>\r\n        ) : (\r\n          <table className=\"w-full text-sm\">\r\n            <thead>\r\n              <tr className=\"border-b\">\r\n                <th className=\"text-left p-2\">Usuario</th>\r\n                <th className=\"text-left p-2\">Rol</th>\r\n                <th className=\"p-2 text-center\">Acciones</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {collaborators.map(c => (\r\n                <tr key={c.uid} className=\"border-b\">\r\n                  <td className=\"p-2\">{c.email || c.uid}</td>\r\n                  <td className=\"p-2\">\r\n                    <select\r\n                      value={c.role}\r\n                      onChange={(e)=>assignRole(c.uid, e.target.value)}\r\n                      disabled={c.role==='owner'}\r\n                      className=\"border rounded px-2 py-1 text-sm\">\r\n                      <option value=\"owner\">Pareja</option>\r\n                      <option value=\"planner\">Wedding Planner</option>\r\n                      <option value=\"helper\">Ayudante</option>\r\n                    </select>\r\n                  </td>\r\n                  <td className=\"p-2 text-center\">\r\n                    {c.role!=='owner' && (\r\n                      <button onClick={()=>removeRole(c.uid)} className=\"text-red-500 hover:text-red-700\">\r\n                        <X size={16} />\r\n                      </button>\r\n                    )}\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        )}\r\n      </Card>\r\n\r\n      {/* Datos de facturaci√≥n */}\r\n      <Card className=\"space-y-4\">\r\n        <h2 className=\"text-lg font-medium\">Datos de facturaci√≥n</h2>\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n          <Input label=\"Nombre completo\" name=\"fullName\" value={billing.fullName} onChange={handleBillingChange} />\r\n          <Input label=\"Direcci√≥n\" name=\"address\" value={billing.address} onChange={handleBillingChange} />\r\n          <Input label=\"CP\" name=\"zip\" value={billing.zip} onChange={handleBillingChange} />\r\n          <Input label=\"Localidad\" name=\"city\" value={billing.city} onChange={handleBillingChange} />\r\n          <Input label=\"Provincia\" name=\"state\" value={billing.state} onChange={handleBillingChange} />\r\n          <Input label=\"Pa√≠s\" name=\"country\" value={billing.country} onChange={handleBillingChange} />\r\n          <Input label=\"DNI\" name=\"dni\" value={billing.dni} onChange={handleBillingChange} />\r\n        </div>\r\n        <div className=\"text-right\">\r\n          <Button onClick={saveProfile}>Guardar</Button>\r\n        </div>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Perfil;\r\n\r\n// -----------------------------------------------------------\r\n\r\nfunction LegacyPerfil() {\r\n  const navigate = useNavigate();\r\n  const { \r\n    user, \r\n    updateProfile, \r\n    sendVerificationEmail, \r\n    sendPasswordReset, \r\n    updateUserEmail,\r\n    updateUserPassword,\r\n    reauthenticate,\r\n    currentUser\r\n  } = useAuth();\r\n  \r\n  const [activeTab, setActiveTab] = useState('profile');\r\n  // Estado para mostrar/ocultar men√∫ lateral en pantallas peque√±as\r\n  const [menuOpen, setMenuOpen] = useState(false);\r\n  const [form, setForm] = useState({ \r\n    displayName: '', \r\n    email: '', \r\n    weddingName: '', \r\n    logoUrl: '', \r\n    partnerName: '', \r\n    partnerEmail: '',\r\n    currentPassword: '',\r\n    newPassword: '',\r\n    confirmPassword: ''\r\n  });\r\n  const [isEditing, setIsEditing] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (user) {\r\n      setForm(prev => ({\r\n        ...prev,\r\n        displayName: user.displayName || '',\r\n        email: user.email || '',\r\n        weddingName: user.weddingName || '',\r\n        logoUrl: user.logoUrl || '',\r\n        partnerName: user.partnerName || '',\r\n        partnerEmail: user.partnerEmail || ''\r\n      }));\r\n    }\r\n  }, [user]);\r\n\r\n  const handleChange = (e) => {\r\n    const { name, value } = e.target;\r\n    setForm(prev => ({ ...prev, [name]: value }));\r\n  };\r\n\r\n  const handleProfileSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setIsLoading(true);\r\n    try {\r\n      await updateProfile({\r\n        displayName: form.displayName,\r\n        weddingName: form.weddingName,\r\n        logoUrl: form.logoUrl,\r\n        partnerName: form.partnerName,\r\n        partnerEmail: form.partnerEmail\r\n      });\r\n      toast.success('Perfil actualizado correctamente');\r\n    } catch (error) {\r\n      toast.error(`Error al actualizar el perfil: ${error.message}`);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handlePasswordSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (form.newPassword !== form.confirmPassword) {\r\n      toast.error('Las contrase√±as no coinciden');\r\n      return;\r\n    }\r\n    \r\n    setIsLoading(true);\r\n    try {\r\n      await updateUserPassword(form.newPassword);\r\n      toast.success('Contrase√±a actualizada correctamente');\r\n      setForm(prev => ({ ...prev, currentPassword: '', newPassword: '', confirmPassword: '' }));\r\n    } catch (error) {\r\n      toast.error(`Error al actualizar la contrase√±a: ${error.message}`);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSendVerification = async () => {\r\n    try {\r\n      await sendVerificationEmail();\r\n      toast.success('Correo de verificaci√≥n enviado. Por favor revisa tu bandeja de entrada.');\r\n    } catch (error) {\r\n      toast.error(`Error al enviar el correo de verificaci√≥n: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  const handlePasswordReset = async () => {\r\n    if (!form.email) {\r\n      toast.error('Por favor ingresa tu correo electr√≥nico');\r\n      return;\r\n    }\r\n    try {\r\n      await sendPasswordReset(form.email);\r\n      toast.success('Se ha enviado un enlace para restablecer tu contrase√±a a tu correo electr√≥nico');\r\n    } catch (error) {\r\n      toast.error(`Error al enviar el enlace de restablecimiento: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  if (!user) {\r\n    navigate('/login');\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"container mx-auto px-4 py-8\">\r\n      <h1 className=\"text-3xl font-bold text-center mb-8\">Configuraci√≥n de Cuenta</h1>\r\n      \r\n      {/* Bot√≥n hamburguesa para m√≥viles */}\r\n      <button\r\n        type=\"button\"\r\n        onClick={() => setMenuOpen(prev => !prev)}\r\n        className=\"md:hidden mb-4 px-4 py-2 bg-blue-600 text-white rounded\"\r\n        aria-expanded={menuOpen}\r\n        aria-controls=\"sidebar-menu\"\r\n      >\r\n        {menuOpen ? 'Cerrar men√∫' : 'Men√∫'}\r\n      </button>\r\n\r\n      <div className=\"flex flex-col md:flex-row gap-8\">\r\n        {/* Sidebar */}\r\n        <div id=\"sidebar-menu\" className={`${menuOpen ? 'block' : 'hidden'} md:block w-full md:w-64 flex-shrink-0`}>\r\n          <Card className=\"p-4\">\r\n            <div className=\"space-y-1\">\r\n              <button\r\n                onClick={() => { setActiveTab('profile'); setMenuOpen(false); }}\r\n                className={`w-full text-left px-4 py-2 rounded-md ${\r\n                  activeTab === 'profile' \r\n                    ? 'bg-blue-100 text-blue-700' \r\n                    : 'text-gray-700 hover:bg-gray-100'\r\n                }`}\r\n              >\r\n                Perfil\r\n              </button>\r\n              <button\r\n                onClick={() => { setActiveTab('password'); setMenuOpen(false); }}\r\n                className={`w-full text-left px-4 py-2 rounded-md ${\r\n                  activeTab === 'password' \r\n                    ? 'bg-blue-100 text-blue-700' \r\n                    : 'text-gray-700 hover:bg-gray-100'\r\n                }`}\r\n              >\r\n                Contrase√±a\r\n              </button>\r\n              <button\r\n                onClick={() => { setActiveTab('email'); setMenuOpen(false); }}\r\n                className={`w-full text-left px-4 py-2 rounded-md ${\r\n                  activeTab === 'email' \r\n                    ? 'bg-blue-100 text-blue-700' \r\n                    : 'text-gray-700 hover:bg-gray-100'\r\n                }`}\r\n              >\r\n                Correo Electr√≥nico\r\n              </button>\r\n            </div>\r\n          </Card>\r\n        </div>\r\n\r\n        {/* Main Content */}\r\n        <div className=\"flex-1\">\r\n          {/* Profile Tab */}\r\n          {activeTab === 'profile' && (\r\n            <Card className=\"p-6\">\r\n              <h2 className=\"text-2xl font-semibold mb-6\">Informaci√≥n del Perfil</h2>\r\n              <form onSubmit={handleProfileSubmit}>\r\n                <div className=\"space-y-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      Nombre de Usuario\r\n                    </label>\r\n                    <Input\r\n                      type=\"text\"\r\n                      name=\"displayName\"\r\n                      value={form.displayName}\r\n                      onChange={handleChange}\r\n                      required\r\n                    />\r\n                  </div>\r\n\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      Nombre de la Boda\r\n                    </label>\r\n                    <Input\r\n                      type=\"text\"\r\n                      name=\"weddingName\"\r\n                      value={form.weddingName}\r\n                      onChange={handleChange}\r\n                    />\r\n                  </div>\r\n\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      URL del Logo\r\n                    </label>\r\n                    <Input\r\n                      type=\"url\"\r\n                      name=\"logoUrl\"\r\n                      value={form.logoUrl}\r\n                      onChange={handleChange}\r\n                      placeholder=\"https://ejemplo.com/logo.png\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      Nombre de la Pareja\r\n                    </label>\r\n                    <Input\r\n                      type=\"text\"\r\n                      name=\"partnerName\"\r\n                      value={form.partnerName}\r\n                      onChange={handleChange}\r\n                    />\r\n                  </div>\r\n\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      Correo de la Pareja\r\n                    </label>\r\n                    <Input\r\n                      type=\"email\"\r\n                      name=\"partnerEmail\"\r\n                      value={form.partnerEmail}\r\n                      onChange={handleChange}\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"pt-4\">\r\n                    <Button type=\"submit\" disabled={isLoading}>\r\n                      {isLoading ? 'Guardando...' : 'Guardar Cambios'}\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              </form>\r\n            </Card>\r\n          )}\r\n\r\n          {/* Password Tab */}\r\n          {activeTab === 'password' && (\r\n            <Card className=\"p-6\">\r\n              <h2 className=\"text-2xl font-semibold mb-6\">Cambiar Contrase√±a</h2>\r\n              <form onSubmit={handlePasswordSubmit}>\r\n                <div className=\"space-y-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      Contrase√±a Actual\r\n                    </label>\r\n                    <Input\r\n                      type=\"password\"\r\n                      name=\"currentPassword\"\r\n                      value={form.currentPassword}\r\n                      onChange={handleChange}\r\n                      required\r\n                    />\r\n                  </div>\r\n\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      Nueva Contrase√±a\r\n                    </label>\r\n                    <Input\r\n                      type=\"password\"\r\n                      name=\"newPassword\"\r\n                      value={form.newPassword}\r\n                      onChange={handleChange}\r\n                      required\r\n                      minLength={6}\r\n                    />\r\n                  </div>\r\n\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                      Confirmar Nueva Contrase√±a\r\n                    </label>\r\n                    <Input\r\n                      type=\"password\"\r\n                      name=\"confirmPassword\"\r\n                      value={form.confirmPassword}\r\n                      onChange={handleChange}\r\n                      required\r\n                      minLength={6}\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"pt-4\">\r\n                    <Button type=\"submit\" disabled={isLoading}>\r\n                      {isLoading ? 'Actualizando...' : 'Actualizar Contrase√±a'}\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              </form>\r\n            </Card>\r\n          )}\r\n\r\n          {/* Email Tab */}\r\n          {activeTab === 'email' && (\r\n            <Card className=\"p-6\">\r\n              <h2 className=\"text-2xl font-semibold mb-6\">Correo Electr√≥nico</h2>\r\n              \r\n              <div className=\"space-y-6\">\r\n                <div className=\"p-4 bg-blue-50 rounded-lg\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                      <p className=\"font-medium\">Estado de Verificaci√≥n</p>\r\n                      <p className=\"text-sm text-gray-600\">\r\n                        {user.emailVerified \r\n                          ? 'Tu correo electr√≥nico ha sido verificado.' \r\n                          : 'Tu correo electr√≥nico no ha sido verificado.'}\r\n                      </p>\r\n                    </div>\r\n                    {!user.emailVerified && (\r\n                      <Button \r\n                        onClick={handleSendVerification}\r\n                        variant=\"outline\"\r\n                        disabled={isLoading}\r\n                      >\r\n                        Verificar Correo\r\n                      </Button>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"p-4 bg-yellow-50 rounded-lg\">\r\n                  <h3 className=\"font-medium mb-2\">Restablecer Contrase√±a</h3>\r\n                  <p className=\"text-sm text-gray-600 mb-3\">\r\n                    ¬øOlvidaste tu contrase√±a? Te enviaremos un enlace para restablecerla a tu correo electr√≥nico.\r\n                  </p>\r\n                  <div className=\"flex flex-col sm:flex-row gap-3\">\r\n                    <Input\r\n                      type=\"email\"\r\n                      value={form.email}\r\n                      onChange={(e) => setForm(prev => ({ ...prev, email: e.target.value }))}\r\n                      placeholder=\"tu@email.com\"\r\n                      className=\"flex-1\"\r\n                    />\r\n                    <Button \r\n                      onClick={handlePasswordReset}\r\n                      variant=\"outline\"\r\n                      disabled={isLoading}\r\n                    >\r\n                      Enviar Enlace\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </Card>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\Protocolo.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Clock' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'List' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'Music' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":28},{"ruleId":"no-unused-vars","severity":1,"message":"'FileText' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Outlet, Link } from 'react-router-dom';\r\nimport { Clock, List, Music, FileText } from 'lucide-react';\r\n\r\nexport default function Protocolo() {\r\n  return (\r\n    <div className=\"p-6\">\r\n      <h1 className=\"text-2xl font-semibold mb-4\">Protocolo</h1>\r\n      <nav className=\"flex space-x-4 mb-6 border-b pb-2\">\r\n        <Link to=\"momentos\" className=\"text-blue-600 hover:underline\">Momentos Especiales</Link>\r\n        <Link to=\"timing\" className=\"text-blue-600 hover:underline\">Timing</Link>\r\n        <Link to=\"checklist\" className=\"text-blue-600 hover:underline\">Checklist</Link>\r\n        <Link to=\"ayuda-ceremonia\" className=\"text-blue-600 hover:underline\">Ayuda Ceremonia</Link>\r\n      </nav>\r\n      <Outlet />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\Proveedores.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'providersLoading' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":35,"column":119,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":135},{"ruleId":"no-unused-vars","severity":1,"message":"'navigate' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":71,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":71,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'syncStatus' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":84,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":84,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'clearFilters' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":448,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":448,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'markServiceAsContracted' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":475,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":475,"endColumn":32},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":779,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":779,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[32656,32656],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-undef","severity":2,"message":"'mainLocation' is not defined.","line":994,"column":34,"nodeType":"Identifier","messageId":"undef","endLine":994,"endColumn":46},{"ruleId":"no-undef","severity":2,"message":"'region' is not defined.","line":994,"column":59,"nodeType":"Identifier","messageId":"undef","endLine":994,"endColumn":65},{"ruleId":"no-undef","severity":2,"message":"'country' is not defined.","line":994,"column":97,"nodeType":"Identifier","messageId":"undef","endLine":994,"endColumn":104},{"ruleId":"no-undef","severity":2,"message":"'mainLocation' is not defined.","line":999,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":999,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'region' is not defined.","line":1000,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":1000,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'region' is not defined.","line":1000,"column":22,"nodeType":"Identifier","messageId":"undef","endLine":1000,"endColumn":28},{"ruleId":"no-undef","severity":2,"message":"'country' is not defined.","line":1001,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":1001,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'region' is not defined.","line":1002,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":1002,"endColumn":19},{"ruleId":"no-undef","severity":2,"message":"'region' is not defined.","line":1002,"column":38,"nodeType":"Identifier","messageId":"undef","endLine":1002,"endColumn":44},{"ruleId":"no-undef","severity":2,"message":"'mainLocation' is not defined.","line":1024,"column":39,"nodeType":"Identifier","messageId":"undef","endLine":1024,"endColumn":51},{"ruleId":"no-undef","severity":2,"message":"'region' is not defined.","line":1025,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":1025,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'region' is not defined.","line":1025,"column":49,"nodeType":"Identifier","messageId":"undef","endLine":1025,"endColumn":55},{"ruleId":"no-undef","severity":2,"message":"'country' is not defined.","line":1026,"column":39,"nodeType":"Identifier","messageId":"undef","endLine":1026,"endColumn":46},{"ruleId":"no-undef","severity":2,"message":"'mainLocation' is not defined.","line":1029,"column":34,"nodeType":"Identifier","messageId":"undef","endLine":1029,"endColumn":46},{"ruleId":"no-undef","severity":2,"message":"'mainLocation' is not defined.","line":1033,"column":40,"nodeType":"Identifier","messageId":"undef","endLine":1033,"endColumn":52},{"ruleId":"no-undef","severity":2,"message":"'mainLocation' is not defined.","line":1062,"column":73,"nodeType":"Identifier","messageId":"undef","endLine":1062,"endColumn":85},{"ruleId":"no-undef","severity":2,"message":"'mainLocation' is not defined.","line":1064,"column":72,"nodeType":"Identifier","messageId":"undef","endLine":1064,"endColumn":84},{"ruleId":"no-undef","severity":2,"message":"'mainLocation' is not defined.","line":1074,"column":62,"nodeType":"Identifier","messageId":"undef","endLine":1074,"endColumn":74},{"ruleId":"react/jsx-no-undef","severity":2,"message":"'Spinner' is not defined.","line":1759,"column":28,"nodeType":"JSXIdentifier","messageId":"undefined","endLine":1759,"endColumn":35},{"ruleId":"no-unused-vars","severity":1,"message":"'emailData' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":2061,"column":39,"nodeType":"Identifier","messageId":"unusedVar","endLine":2061,"endColumn":48},{"ruleId":"no-undef","severity":2,"message":"'servicioSeleccionado' is not defined.","line":2076,"column":57,"nodeType":"Identifier","messageId":"undef","endLine":2076,"endColumn":77},{"ruleId":"react/jsx-no-undef","severity":2,"message":"'AlertTriangle' is not defined.","line":2298,"column":60,"nodeType":"JSXIdentifier","messageId":"undefined","endLine":2298,"endColumn":73}],"suppressedMessages":[],"errorCount":22,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport MainLayout from '../components/layout/MainLayout';\r\nimport Card from '../components/Card';\r\nimport Button from '../components/Button';\r\nimport { useWedding } from '../context/WeddingContext';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport useWeddingCollection from '../hooks/useWeddingCollection';\r\nimport { saveData, loadData, subscribeSyncState, getSyncState } from '../services/SyncService';\r\nimport { loadTrackingRecords, createTrackingRecord, updateTrackingStatus, TRACKING_STATUS } from '../services/EmailTrackingService';\r\nimport PageWrapper from '../components/PageWrapper';\r\nimport { Plus, Search, RefreshCcw, Star, Eye, Edit2, Trash2, Calendar, Clock, Download, MapPin } from 'lucide-react';\r\nimport Toast from '../components/Toast';\r\n\r\nexport default function Proveedores() {\r\n  // Indicar si hay boda activa\r\n  const renderNoWedding = () => (\r\n    <MainLayout title=\"Proveedores\">\r\n      <p>No se ha seleccionado ninguna boda.</p>\r\n    </MainLayout>\r\n  );\r\n  // Proveedores de ejemplo iniciales\r\n  // Proveedores de ejemplo (solo cuando no hay boda activa)\r\n  const sampleProviders = [\r\n    { id: 1, name: 'Eventos Catering', service: 'Catering', contact: 'Luis P√©rez', email: 'luis@catering.com', phone: '555-1234', status: 'Contactado', date: '2025-06-10', rating: 0, ratingCount: 0 },\r\n    { id: 2, name: 'Flores y Dise√±o', service: 'Flores', contact: 'Ana G√≥mez', email: 'ana@flores.com', phone: '555-5678', status: 'Confirmado', date: '2025-06-12', rating: 0, ratingCount: 0 },\r\n  ];\r\n  const { activeWedding } = useWedding();\r\n  const { id: routeWeddingId } = useParams();\r\n  const weddingId = activeWedding || routeWeddingId;\r\n  // Si existe un weddingId, no usamos proveedores de muestra\r\n  const fallbackProviders = weddingId ? [] : sampleProviders;\r\n  // Usamos weddingId para asegurar que la ruta por par√°metro funcione\r\n  if (!weddingId) return renderNoWedding();\r\n  \r\n  const { data: providersData, addItem: addProvider, updateItem: updateProvider, deleteItem: deleteProvider, loading: providersLoading } = useWeddingCollection('suppliers', weddingId, fallbackProviders);\r\n\r\n  const [providers, setProviders] = useState([]);\r\n\r\n  // Sincronizar con datos de Firestore\r\n  useEffect(() => {\r\n    setProviders(Array.isArray(providersData) ? providersData : []);\r\n  }, [providersData]);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [serviceFilter, setServiceFilter] = useState('');\r\n  const [statusFilter, setStatusFilter] = useState('');\r\n  const [dateFrom, setDateFrom] = useState('');\r\n  const [dateTo, setDateTo] = useState('');\r\n  const [ratingMin, setRatingMin] = useState(0);\r\n  const [wantedServices, setWantedServices] = useState([\r\n    { id: 'fotografia', name: 'Fotograf√≠a', required: true, budget: 0, contracted: false },\r\n    { id: 'catering', name: 'Catering', required: true, budget: 0, contracted: false },\r\n    { id: 'flores', name: 'Flores', required: true, budget: 0, contracted: false },\r\n    { id: 'musica', name: 'M√∫sica', required: true, budget: 0, contracted: false },\r\n    { id: 'video', name: 'V√≠deo', required: false, budget: 0, contracted: false },\r\n    { id: 'transporte', name: 'Transporte', required: false, budget: 0, contracted: false }\r\n  ]);\r\n  const [showServiceConfig, setShowServiceConfig] = useState(false);\r\n  const [aiQuery, setAiQuery] = useState('');\r\n  const [aiLoading, setAiLoading] = useState(false);\r\n  const [toast, setToast] = useState(null);\r\n  // pesta√±a actual: selected | contacted\r\n  const [tab, setTab] = useState('selected');\r\n  const [selected, setSelected] = useState([]);\r\n  const [showAiModal, setShowAiModal] = useState(false);\r\n  const [aiResults, setAiResults] = useState([]);\r\n  const [showAddModal, setShowAddModal] = useState(false);\r\n  const [budgetRange, setBudgetRange] = useState('');\r\n  const [showDetail, setShowDetail] = useState(false);\r\n  const [detailProvider, setDetailProvider] = useState(null);\r\n  const [activeDetailTab, setActiveDetailTab] = useState('info'); // 'info', 'communications', 'tracking'\r\n  const navigate = useNavigate();\r\n  const [reservations, setReservations] = useState([]);\r\n  const [showResModal, setShowResModal] = useState(false);\r\n  const [providerToReserve, setProviderToReserve] = useState(null);\r\n  const [resDate, setResDate] = useState('');\r\n  const [resTime, setResTime] = useState('');\r\n  const [trackingRecords, setTrackingRecords] = useState([]);\r\n  const [showTrackingModal, setShowTrackingModal] = useState(false);\r\n  const [currentTracking, setCurrentTracking] = useState(null);\r\n  const [syncedEmails, setSyncedEmails] = useState([]);\r\n  const [isSyncingEmails, setIsSyncingEmails] = useState(false);\r\n  \r\n  // Estado de sincronizaci√≥n\r\n  const [syncStatus, setSyncStatus] = useState(getSyncState());\r\n\r\n  // Eliminar proveedor\r\n  const removeProvider = async (id) => {\r\n    // Obtener proveedor a eliminar (para conocer su link)\r\n    const providerObj = providers.find(p => p.id === id);\r\n    // 1. Eliminar del estado local principal\r\n    setProviders(prev => prev.filter(p => p.id !== id));\r\n\r\n    // 2. Si el proveedor est√° almacenado en lovendaSuppliers (lista IA), limpiarlo tambi√©n\r\n    try {\r\n      const stored = await loadData('lovendaSuppliers', { defaultValue: [], firestore: false });\r\n      if (Array.isArray(stored) && stored.length) {\r\n        const filtered = stored.filter(p => p.id !== id && (providerObj ? p.link !== providerObj.link : true));\r\n        // Solo guardar si cambia la longitud\r\n        if (filtered.length !== stored.length) {\r\n          await saveData('lovendaSuppliers', filtered, { firestore: false, showNotification: false });\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.warn('Error al limpiar lovendaSuppliers:', err);\r\n    }\r\n\r\n    // 3. Intentar eliminar de Firestore cuando aplique\r\n    try {\r\n      if (!`${id}`.startsWith('web-')) {\r\n        await deleteProvider(id);\r\n      }\r\n    } catch (err) {\r\n      console.warn('Error al eliminar proveedor de Firestore:', err);\r\n    }\r\n  };\r\n\r\n  // Suscribirse a cambios en el estado de sincronizaci√≥n\r\n  useEffect(() => {\r\n    const unsubscribe = subscribeSyncState(setSyncStatus);\r\n    return () => unsubscribe();\r\n  }, []);\r\n  \r\n  // Cargar registros de seguimiento al iniciar\r\n  useEffect(() => {\r\n    const loadTracking = () => {\r\n      const records = loadTrackingRecords();\r\n      setTrackingRecords(records);\r\n    };\r\n    \r\n    loadTracking();\r\n  }, []);\r\n\r\n  // Cargar proveedores encontrados por la IA (usando SyncService) y escuchar cambios\r\n  useEffect(() => {\r\n    const loadSuppliers = async () => {\r\n    // Ya no a√±adimos autom√°ticamente todos los proveedores devueltos por la b√∫squeda IA.\r\n    // El usuario decidir√° manualmente qu√© proveedor a√±adir mediante el bot√≥n ‚ÄúA√±adir‚Äù.\r\n    // Se mantiene vac√≠a para conservar la firma y evitar errores de llamadas existentes.\r\n  };\r\n    // Ejecutamos por compatibilidad, aunque la funci√≥n est√© vac√≠a\r\n    loadSuppliers();\r\n    window.addEventListener('lovenda-suppliers', loadSuppliers);\r\n    return () => window.removeEventListener('lovenda-suppliers', loadSuppliers);\r\n  }, []);\r\n  \r\n  const initialProvider = { name: '', service: '', contact: '', email: '', phone: '', status: 'Nuevo', date: '' };\r\n  const [newProvider, setNewProvider] = useState(initialProvider);\r\n  const handleAddProvider = async (e) => {\r\n    e.preventDefault();\r\n\r\n    // Borrador con id temporal (por si estamos offline)\r\n    const draftProv = {\r\n      id: `web-${Date.now()}`,\r\n      ...newProvider,\r\n      rating: 0,\r\n      ratingCount: 0,\r\n      date: new Date().toISOString().slice(0, 10),\r\n    };\r\n\r\n    let savedProv = draftProv;\r\n    try {\r\n      const result = await addProvider(draftProv);\r\n      if (result) savedProv = result; // id definitivo si Firestore lo genera\r\n    } catch (err) {\r\n      console.warn('Error al guardar proveedor en Firestore, se mantiene local:', err);\r\n    }\r\n\r\n    setProviders(prev => [...prev, savedProv]);\r\n    setNewProvider(initialProvider);\r\n    setShowAddModal(false);\r\n    setToast({ message: 'Proveedor agregado', type: 'success' });\r\n  };\r\n\r\n  const openResModal = (p) => {\r\n    setProviderToReserve(p);\r\n    setResDate('');\r\n    setResTime('');\r\n    setShowResModal(true);\r\n  };\r\n\r\n  const confirmReservation = () => {\r\n    if (providerToReserve && resDate && resTime) {\r\n      const dt = new Date(resDate + 'T' + resTime);\r\n      setReservations(prev => [...prev, { providerId: providerToReserve.id, datetime: dt }]);\r\n      setShowResModal(false);\r\n    }\r\n  };\r\n\r\n  const selectProvider = async (item) => {\r\n    // 1) Creamos el objeto con valores iniciales (sin id definitivo)\r\n    const draftProv = {\r\n      id: `web-${Date.now()}`, // id temporal en caso de modo offline\r\n      name: item.title || item.name || 'Proveedor',\r\n      service: serviceFilter || 'Proveedor',\r\n      contact: '',\r\n      email: '',\r\n      phone: '',\r\n      link: item.link,\r\n      status: 'Nuevo',\r\n      date: new Date().toISOString().slice(0, 10),\r\n      rating: 0,\r\n      ratingCount: 0,\r\n      snippet: item.snippet || '',\r\n      priceRange: item.priceRange || budgetRange,\r\n      image: item.image || '',\r\n    };\r\n\r\n    // 2) Guardamos usando addProvider (puede devolver id definitivo)\r\n    let savedProv = draftProv;\r\n    try {\r\n      const result = await addProvider(draftProv);\r\n      if (result) {\r\n        savedProv = result; // ya contiene id definitivo si viene de Firestore\r\n      }\r\n    } catch (err) {\r\n      console.warn('Error al guardar proveedor, se mantiene versi√≥n local:', err);\r\n    }\r\n\r\n    // 3) Actualizamos estados UI con el proveedor guardado\r\n    setProviders(prev => [...prev, savedProv]);\r\n    setDetailProvider(savedProv);\r\n    setShowDetail(true);\r\n    setShowAiModal(false);\r\n  };\r\n\r\n  const rateProvider = (id, ratingValue) => {\r\n  const prov = providers.find(p => p.id === id);\r\n  if (!prov) return;\r\n  const newCount = (prov.ratingCount || 0) + 1;\r\n  const newRating = ((prov.rating || 0) * prov.ratingCount + ratingValue) / newCount;\r\n  setProviders(prev => prev.map(p => p.id === id ? { ...p, ratingCount: newCount, rating: newRating } : p));\r\n  updateProvider(id, { rating: newRating, ratingCount: newCount });\r\n    setProviders(prev => prev.map(p =>\r\n      p.id === id ? { ...p,\r\n        ratingCount: p.ratingCount + 1,\r\n        rating: (p.rating * p.ratingCount + ratingValue) / (p.ratingCount + 1)\r\n      } : p\r\n    ));\r\n  };\r\n\r\n  // Verificar la operatividad de enlaces de proveedores\r\nconst verifyProviderLinks = async (providers) => {\r\n  // Verificando validez de enlaces de proveedores\r\n  // Normalizar proveedores para asegurarnos de que todos tienen los mismos campos\r\n  const normalizedProviders = providers.map((provider) => ({\r\n    title: provider.title || provider.name || 'Proveedor sin nombre',\r\n    name: provider.title || provider.name || 'Proveedor',\r\n    link: (() => {\r\n    let l = provider.link || provider.url || '';\r\n    if (l && !l.startsWith('http://') && !l.startsWith('https://')) {\r\n      l = 'https://' + l.replace(/^\\/+/, '');\r\n    }\r\n    return l;\r\n  })(),\r\n    snippet: provider.snippet || provider.description || '',\r\n    service: provider.service || serviceFilter || 'Proveedor',\r\n    location: provider.location || 'No especificada',\r\n    priceRange: provider.priceRange || provider.price || 'Consultar',\r\n    image: provider.image || '',\r\n    // Por defecto consideramos v√°lido hasta que se demuestre lo contrario\r\n    verified: true,\r\n  }));\r\n\r\n  // Filtrar proveedores con enlaces vac√≠os o mal formados\r\n  const validProviders = normalizedProviders.filter((provider) => {\r\n    const link = provider.link || '';\r\n    return (\r\n      link &&\r\n      (link.startsWith('http://') || link.startsWith('https://')) &&\r\n      link.includes('.')\r\n    );\r\n  });\r\n\r\n  console.log(`${validProviders.length} de ${normalizedProviders.length} tienen enlaces potencialmente v√°lidos`);\r\n\r\n  // Si no hay proveedores v√°lidos, devolver un resultado de respaldo gen√©rico\r\n  if (validProviders.length === 0 && normalizedProviders.length > 0) {\r\n    return [\r\n      {\r\n        title: 'Directorio de proveedores para bodas',\r\n        link: `https://www.bodas.net/busqueda/${(serviceFilter || 'proveedores')\r\n          .toLowerCase()\r\n          .replace(/\\s+/g, '-')}-espana`,\r\n        snippet: `Encuentra proveedores de ${serviceFilter || 'boda'} en toda Espa√±a`,\r\n        service: serviceFilter || 'Proveedor',\r\n        location: 'Espa√±a',\r\n        priceRange: 'Varios precios disponibles',\r\n        verified: true,\r\n      },\r\n    ];\r\n  }\r\n\r\n  return validProviders;\r\n};\r\n\r\nconst handleAiSearch = async (e) => {\r\n    e.preventDefault();\r\n    if (!aiQuery.trim() && !serviceFilter) {\r\n      setToast({ message: 'Por favor, introduce una b√∫squeda o selecciona un tipo de servicio', type: 'warning' });\r\n      return;\r\n    }\r\n    \r\n    setAiLoading(true);\r\n    \r\n    try {\r\n      // Funci√≥n para cargar y unificar TODOS los datos disponibles del perfil\r\n      // Esta funci√≥n es similar a la que hay en fetchOpenAi para mantener coherencia\r\n      const loadAllProfileData = () => {\r\n        try {\r\n          // Lista de claves a buscar en almacenamiento local y en Firestore\r\n          const storageKeys = ['lovendaProfile', 'weddingInfo', 'account', 'important', \r\n                               'ceremonyInfo', 'weddingConfig'];\r\n          \r\n          // Objeto unificado para almacenar todos los datos\r\n          let unifiedData = {};\r\n          \r\n          // Cargar primero el perfil principal que contiene la informaci√≥n de la boda\r\n          const profile = loadData('lovendaProfile', { defaultValue: {}, collection: 'userProfiles' });\r\n          console.log('Perfil cargado para b√∫squeda de proveedores:', profile);\r\n          \r\n          // Copiar datos del perfil al objeto unificado\r\n          Object.assign(unifiedData, profile);\r\n          \r\n          // Asegurarse de que weddingInfo est√© disponible\r\n          if (profile && profile.weddingInfo) {\r\n            unifiedData.weddingInfo = profile.weddingInfo;\r\n            Object.assign(unifiedData, profile.weddingInfo);\r\n          }\r\n          \r\n          // Procesamos cada clave e intentamos extraer informaci√≥n v√°lida\r\n          storageKeys.forEach(key => {\r\n            try {\r\n              const data = loadData(key, { defaultValue: {}, collection: 'userData' });\r\n              if (typeof data === 'object' && data !== null) {\r\n                unifiedData[key] = data;\r\n                // Tambi√©n aplanamos los datos para facilitar el acceso\r\n                Object.assign(unifiedData, data);\r\n              }\r\n            } catch (err) {\r\n              console.warn(`Error al cargar datos de ${key}:`, err);\r\n            }\r\n          });\r\n          \r\n          return unifiedData;\r\n        } catch (err) {\r\n          console.error('Error al cargar datos del perfil:', err);\r\n          return {};\r\n        }\r\n      };\r\n      \r\n      // Cargar perfil de usuario completo\r\n      const profileData = loadAllProfileData();\r\n      \r\n      // Extraer informaci√≥n importante del perfil para la b√∫squeda\r\n      const extractWeddingLocation = (data) => {\r\n        const possibleKeys = [\r\n          'celebrationPlace',\r\n          'ceremonyLocation',\r\n          'weddingInfo.celebrationPlace',\r\n          'weddingInfo.ceremonyLocation',\r\n          'ceremonyInfo.location',\r\n          'location'\r\n        ];\r\n        \r\n        for (const key of possibleKeys) {\r\n          const parts = key.split('.');\r\n          let value;\r\n          \r\n          if (parts.length === 1) {\r\n            value = data[parts[0]];\r\n          } else if (parts.length === 2) {\r\n            value = data[parts[0]] && data[parts[0]][parts[1]];\r\n          }\r\n          \r\n          if (value && typeof value === 'string' && value.trim() !== '') {\r\n            console.log(`Ubicaci√≥n de boda encontrada en '${key}':`, value);\r\n            return value;\r\n          }\r\n        }\r\n        \r\n        return '';\r\n      };\r\n      \r\n      // Extraer ubicaci√≥n de la boda\r\n      const weddingLocation = extractWeddingLocation(profileData);\r\n      \r\n      // Si tenemos API de backend, intentamos usarla primero\r\n      const res = await fetch('/api/ai-suppliers', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          query: aiQuery,\r\n          service: serviceFilter,\r\n          budget: budgetRange,\r\n          profile: profileData,\r\n          location: weddingLocation // A√±adir expl√≠citamente la ubicaci√≥n\r\n        })\r\n      });\r\n      \r\n      let data = [];\r\n      if (res.ok) {\r\n        try {\r\n          data = await res.json();\r\n        } catch (_) { /* cuerpo vac√≠o */ }\r\n      }\r\n      \r\n      if (Array.isArray(data) && data.length) {\r\n        // Verificar operatividad de los enlaces antes de mostrarlos\r\n        verifyProviderLinks(data).then(verifiedResults => {\r\n          setAiResults(verifiedResults);\r\n          setShowAiModal(true);\r\n          saveData('lovendaSuppliers', verifiedResults, { firestore: false, showNotification: false });\r\n          window.dispatchEvent(new Event('lovenda-suppliers'));\r\n        });\r\n      } else {\r\n        // Si la ruta no existe o responde vac√≠o, usar OpenAI directamente\r\n        await fetchOpenAi();\r\n        return;\r\n      }\r\n    } catch (err) {\r\n      console.error('Error en la b√∫squeda de proveedores:', err);\r\n      setToast({ message: 'Error al buscar proveedores. Intentando b√∫squeda directa...', type: 'error' });\r\n      await fetchOpenAi();\r\n    } finally {\r\n      setAiLoading(false);\r\n    }\r\n  };\r\n\r\n  const displayed = providers\r\n    .filter(p =>\r\n      ((p.name || '').toLowerCase().includes(searchTerm.toLowerCase()) || (p.service || '').toLowerCase().includes(searchTerm.toLowerCase())) &&\r\n      (serviceFilter ? p.service === serviceFilter : true) &&\r\n      (statusFilter ? p.status === statusFilter : true) &&\r\n      (dateFrom ? p.date >= dateFrom : true) &&\r\n      (dateTo ? p.date <= dateTo : true) &&\r\n      (ratingMin ? (p.rating || 0) >= ratingMin : true)\r\n    )\r\n    .filter(p => {\r\n      if (tab === 'contacted') return p.status === 'Contactado';\r\n      if (tab === 'selected') return p.status === 'Confirmado' || p.status === 'Seleccionado';\r\n      return true; // all\r\n    });\r\n\r\n  const toggleSelect = id => {\r\n    setSelected(prev => (prev.includes(id) ? prev.filter(x => x !== id) : [...prev, id]));\r\n  };\r\n\r\n  const clearFilters = () => {\r\n    setSearchTerm(''); setAiQuery(''); setServiceFilter(''); setStatusFilter(''); setDateFrom(''); setDateTo(''); setRatingMin(0);\r\n  };\r\n\r\n  // Configurar servicios deseados\r\n  const updateWantedService = (id, updates) => {\r\n    setWantedServices(prev => prev.map(service => \r\n      service.id === id ? { ...service, ...updates } : service\r\n    ));\r\n  };\r\n\r\n  const addWantedService = (name) => {\r\n    const newService = {\r\n      id: name.toLowerCase().replace(/\\s+/g, '-'),\r\n      name,\r\n      required: false,\r\n      budget: 0,\r\n      contracted: false\r\n    };\r\n    setWantedServices(prev => [...prev, newService]);\r\n  };\r\n\r\n  const removeWantedService = (id) => {\r\n    setWantedServices(prev => prev.filter(service => service.id !== id));\r\n  };\r\n\r\n  // Marcar servicio como contratado cuando se confirma un proveedor\r\n  const markServiceAsContracted = (serviceName) => {\r\n    const serviceId = serviceName.toLowerCase().replace(/\\s+/g, '-');\r\n    updateWantedService(serviceId, { contracted: true });\r\n  };\r\n\r\n  // Obtener progreso de contrataci√≥n\r\n  const getContractingProgress = () => {\r\n    const required = wantedServices.filter(s => s.required);\r\n    const contracted = required.filter(s => s.contracted);\r\n    return { contracted: contracted.length, total: required.length };\r\n  };\r\n\r\n  // B√∫squeda directa usando OpenAI cuando la API backend no responde\r\n  const fetchOpenAi = async () => {\r\n    // VALIDACI√ìN MEJORADA: Garantizar que tenemos al menos un criterio de b√∫squeda\r\n    if (!aiQuery && !serviceFilter) {\r\n      setToast({ message: 'Por favor, introduce una b√∫squeda o selecciona un tipo de servicio', type: 'warning' });\r\n      setAiLoading(false);\r\n      return;\r\n    }\r\n    \r\n    // IMPORTANTE: Siempre garantizar que tenemos un tipo de servicio definido\r\n    const servicioSeleccionado = serviceFilter || \r\n                               (aiQuery.toLowerCase().includes('fotograf') ? 'Fotograf√≠a' : \r\n                                aiQuery.toLowerCase().includes('flor') ? 'Flores' : \r\n                                aiQuery.toLowerCase().includes('cater') ? 'Catering' : \r\n                                aiQuery.toLowerCase().includes('m√∫sica') || aiQuery.toLowerCase().includes('music') ? 'M√∫sica' : \r\n                                'proveedores de boda');\r\n    \r\n    setAiLoading(true);\r\n    \r\n    try {\r\n      // Funci√≥n mejorada para cargar y unificar TODOS los datos disponibles del perfil\r\n      const loadAllProfileData = () => {\r\n        try {\r\n          // Lista de claves a buscar en almacenamiento local y en Firestore\r\n          const storageKeys = ['lovendaProfile', 'weddingInfo', 'account', 'important', \r\n                               'ceremonyInfo', 'weddingConfig', 'invitados', 'finanzas', \r\n                               'transporte', 'eventSchedule', 'rsvp', 'proveedores'];\r\n          \r\n          // Objeto unificado para almacenar todos los datos\r\n          let unifiedData = {};\r\n          \r\n          // Cargar primero el perfil principal que contiene la informaci√≥n de la boda\r\n          const profile = loadData('lovendaProfile', { defaultValue: {}, collection: 'userProfiles' });\r\n          console.log('Perfil principal cargado:', profile);\r\n          \r\n          // Asegurarse de que weddingInfo est√© disponible\r\n          if (profile && profile.weddingInfo) {\r\n            unifiedData.weddingInfo = profile.weddingInfo;\r\n            Object.assign(unifiedData, profile.weddingInfo);\r\n          }\r\n          \r\n          // Procesamos cada clave e intentamos extraer informaci√≥n v√°lida\r\n          storageKeys.forEach(key => {\r\n            try {\r\n              const rawData = JSON.stringify(loadData(key, { defaultValue: {}, collection: 'userData' }));\r\n              // Intentamos parsearlo como JSON si es posible\r\n              try {\r\n                const parsedData = JSON.parse(rawData);\r\n                if (typeof parsedData === 'object' && parsedData !== null) {\r\n                  unifiedData[key] = parsedData;\r\n                  // Tambi√©n aplanamos los datos para facilitar el acceso\r\n                  Object.assign(unifiedData, parsedData);\r\n                }\r\n              } catch {\r\n                // Si no es JSON, lo guardamos como string\r\n                unifiedData[key] = rawData;\r\n              }\r\n            } catch (err) {\r\n              console.warn(`Error al cargar datos de ${key}:`, err);\r\n            }\r\n          });\r\n          \r\n          // A√±adir ubicaci√≥n fija de Valencia como respaldo si no se encuentra\r\n          if (!unifiedData.celebrationPlace && !unifiedData.ceremonyLocation && !unifiedData.location) {\r\n            unifiedData.celebrationPlace = 'Valencia, Comunidad Valenciana, Espa√±a';\r\n            console.log('Usando ubicaci√≥n predeterminada: Valencia');\r\n          }\r\n          \r\n          return unifiedData;\r\n        } catch (err) {\r\n          console.error('Error cr√≠tico al cargar datos del perfil:', err);\r\n          // Proporcionar datos m√≠nimos con ubicaci√≥n Valencia como respaldo\r\n          return { celebrationPlace: 'Valencia, Comunidad Valenciana, Espa√±a' };\r\n        }\r\n      };\r\n      \r\n      // MEJORA: Cargamos datos con estructura m√°s robusta\r\n      const allProfileData = loadAllProfileData();\r\n      console.log('Datos completos del perfil cargados:', allProfileData);\r\n      \r\n      // EXTRACCI√ìN DE DATOS MEJORADA: Buscamos en profundidad y m√∫ltiples fuentes\r\n      const extractDataFromMultipleSources = (sources, keys) => {\r\n        for (const source of sources) {\r\n          for (const key of keys) {\r\n            // Comprobar si la fuente existe y tiene la clave\r\n            if (source && source[key] && source[key] !== 'undefined' && source[key] !== '') {\r\n              return source[key];\r\n            }\r\n          }\r\n        }\r\n        return '';\r\n      };\r\n      \r\n      // Fuentes de datos priorizadas\r\n      const dataSources = [\r\n        allProfileData,\r\n        allProfileData.lovendaProfile,\r\n        allProfileData.weddingInfo,\r\n        allProfileData.ceremonyInfo,\r\n        allProfileData.weddingConfig\r\n      ];\r\n      \r\n      // MEJORA: Extracci√≥n m√°s completa de ubicaciones con prioridad al perfil\r\n      // Intentar obtener directamente desde weddingInfo que es donde se guarda en el formulario del perfil\r\n      let locationInfo = '';\r\n      \r\n      // Verificar si tenemos datos directos del perfil\r\n      if (allProfileData.weddingInfo && allProfileData.weddingInfo.celebrationPlace) {\r\n        locationInfo = allProfileData.weddingInfo.celebrationPlace;\r\n        console.log('Ubicaci√≥n encontrada directamente en weddingInfo:', locationInfo);\r\n      } else {\r\n        // Buscar en otras fuentes si no est√° directamente disponible\r\n        locationInfo = extractDataFromMultipleSources(\r\n          dataSources, \r\n          ['ceremonyLocation', 'ceremonyPlace', 'location', 'celebrationPlace', 'lugar', 'ciudad', 'province']\r\n        );\r\n        console.log('Ubicaci√≥n encontrada en fuentes alternativas:', locationInfo);\r\n      }\r\n      \r\n      // Si a√∫n no tenemos ubicaci√≥n, usar Valencia como respaldo\r\n      if (!locationInfo) {\r\n        locationInfo = 'Valencia, Comunidad Valenciana';\r\n        console.log('Usando ubicaci√≥n predeterminada (fallback): Valencia');\r\n      }\r\n      \r\n      // Si la ubicaci√≥n es un objeto, intentamos extraer el nombre\r\n      const getLocationName = (location) => {\r\n        if (typeof location === 'object' && location !== null) {\r\n          return location.name || location.ciudad || location.province || \r\n                 location.address || location.texto || JSON.stringify(location);\r\n        }\r\n        return location;\r\n      };\r\n      \r\n      // Procesamos la informaci√≥n de ubicaci√≥n\r\n      const formattedLocation = getLocationName(locationInfo) || 'Valencia';  // Usar Valencia como respaldo final\r\n      \r\n      // MEJORA: Extracci√≥n m√°s detallada del resto de datos\r\n      const receptionInfo = getLocationName(\r\n        extractDataFromMultipleSources(dataSources, \r\n          ['receptionLocation', 'banquetPlace', 'banquete', 'lugarBanquete', 'salonBanquete']\r\n        )\r\n      ) || '';\r\n      \r\n      const weddingDate = extractDataFromMultipleSources(dataSources, \r\n        ['weddingDate', 'date', 'fecha', 'fechaBoda', 'ceremonyDate']\r\n      ) || '';\r\n      \r\n      const weddingStyle = extractDataFromMultipleSources(dataSources, \r\n        ['style', 'estilo', 'themeStyle', 'temaBoda', 'estiloDecoracion']\r\n      ) || '';\r\n      \r\n      const numGuests = extractDataFromMultipleSources(dataSources, \r\n        ['numGuests', 'guests', 'invitados', 'numeroInvitados', 'totalInvitados']\r\n      ) || '';\r\n      \r\n      // Mejor extracci√≥n de nombres\r\n      const brideName = extractDataFromMultipleSources(dataSources, \r\n        ['brideName', 'novia', 'brideInfo.name', 'bride.name']\r\n      ) || '';\r\n      \r\n      const groomName = extractDataFromMultipleSources(dataSources, \r\n        ['groomName', 'novio', 'groomInfo.name', 'groom.name']\r\n      ) || '';\r\n      \r\n      const coupleName = extractDataFromMultipleSources(dataSources, ['coupleName']) || \r\n                       (brideName && groomName ? `${brideName} y ${groomName}` : \r\n                        brideName || groomName || '');\r\n      \r\n      // MEJORA: Categor√≠as para bodas.net m√°s detalladas y precisas\r\n      const bodasNetCategories = {\r\n        'Catering': 'banquetes',\r\n        'Fotograf√≠a': 'fotografia',\r\n        'M√∫sica': 'musica-y-entretenimiento',\r\n        'Flores': 'decoracion-y-flores',\r\n        'Decoraci√≥n': 'decoracion-y-flores',\r\n        'Vestidos': 'vestidos-de-novia',\r\n        'Trajes': 'trajes-de-novio',\r\n        'Transporte': 'coche-para-bodas',\r\n        'Invitaciones': 'invitaciones-de-boda',\r\n        'Pasteles': 'tartas-y-dulces-de-boda',\r\n        'Joyer√≠a': 'joyeria',\r\n        'Detalles': 'detalles-de-boda',\r\n        'Animaci√≥n': 'musica-y-entretenimiento',\r\n        // Categor√≠as adicionales\r\n        'Fincas': 'fincas-bodas',\r\n        'Hoteles': 'hoteles-bodas',\r\n        'Wedding Planner': 'wedding-planners',\r\n        'Belleza': 'belleza-para-novias',\r\n        'Maquillaje': 'belleza-para-novias',\r\n        'Peluquer√≠a': 'belleza-para-novias',\r\n        'Luna de miel': 'viajes-de-novios',\r\n        'Video': 'video-de-boda'\r\n      };\r\n      \r\n      // MEJORA: Determinar categor√≠a para bodas.net de forma m√°s precisa\r\n      const getBodasNetCategory = (service) => {\r\n        if (!service) return '';\r\n        \r\n        // Normalizar el servicio para comparar (sin tildes, en min√∫sculas)\r\n        const normalizedService = service.toLowerCase()\r\n          .normalize(\"NFD\")\r\n          .replace(/[\\u0300-\\u036f]/g, \"\");\r\n        \r\n        // Buscar coincidencias parciales si no hay exactas\r\n        for (const [key, value] of Object.entries(bodasNetCategories)) {\r\n          const normalizedKey = key.toLowerCase()\r\n            .normalize(\"NFD\")\r\n            .replace(/[\\u0300-\\u036f]/g, \"\");\r\n            \r\n          if (normalizedService === normalizedKey || \r\n              normalizedService.includes(normalizedKey) || \r\n              normalizedKey.includes(normalizedService)) {\r\n            return value;\r\n          }\r\n        }\r\n        \r\n        // Si no hay coincidencia, devolver el servicio original normalizado\r\n        return service.toLowerCase().replace(/ /g, '-');\r\n      };\r\n      \r\n      // Construir b√∫squeda para bodas.net con lugar si est√° disponible\r\n      const bodasNetCategory = getBodasNetCategory(servicioSeleccionado);\r\n      \r\n      // MEJORA: Consulta m√°s optimizada para bodas.net\r\n      let bodasNetQuery = `bodas.net ${bodasNetCategory}`;\r\n      \r\n      // A√±adir ubicaci√≥n si est√° disponible\r\n      if (formattedLocation) {\r\n        // Extraer solo la ciudad o provincia para b√∫squeda m√°s precisa\r\n        const locationParts = formattedLocation.split(',');\r\n        const searchLocation = locationParts[0].trim();\r\n        bodasNetQuery += ` en ${searchLocation}`;\r\n      }\r\n      \r\n      // A√±adir t√©rminos de b√∫squeda si hay\r\n      if (aiQuery) {\r\n        bodasNetQuery += ` ${aiQuery}`;\r\n      }\r\n      \r\n      // Siempre priorizar ubicaci√≥n como requisito clave\r\n      if (formattedLocation) {\r\n        // Reforzar que la b√∫squeda es espec√≠ficamente en esa ubicaci√≥n\r\n        const locationParts = formattedLocation.split(',');\r\n        const mainLocation = locationParts[0]; // Ciudad principal (ej: Valencia)\r\n        \r\n        // A√±adir al final para enfatizarlo\r\n        bodasNetQuery += ` ubicados en ${mainLocation}`;\r\n      }\r\n      \r\n      // MEJORA: Contextualizaci√≥n del presupuesto m√°s precisa\r\n      const getBudgetContext = () => {\r\n        if (!budgetRange) return '';\r\n        \r\n        if (budgetRange.includes('<') || budgetRange.includes('menos')) {\r\n          return 'econ√≥mico y de bajo coste';\r\n        } else if (budgetRange.includes('>') || budgetRange.includes('m√°s')) {\r\n          return 'premium y de alta gama';\r\n        } else if (budgetRange.includes('‚Äì') || budgetRange.includes('-')) {\r\n          // Extraer n√∫meros del rango para ser m√°s espec√≠fico\r\n          const numbers = budgetRange.match(/\\d+(\\.\\d+)?/g);\r\n          if (numbers && numbers.length >= 2) {\r\n            return `con precio medio entre ${numbers[0]}‚Ç¨ y ${numbers[1]}‚Ç¨`;\r\n          }\r\n          return 'con precio medio';\r\n        }\r\n        return budgetRange;\r\n      };\r\n      \r\n      const budgetContext = getBudgetContext();\r\n      \r\n      // MEJORA: Informaci√≥n adicional para enriquecer la b√∫squeda\r\n      const additionalInfo = [];\r\n      \r\n      // A√±adir estilo si est√° disponible\r\n      if (weddingStyle) {\r\n        additionalInfo.push(`Estilo de boda: ${weddingStyle}`);\r\n      }\r\n      \r\n      // A√±adir temporada basada en la fecha\r\n      if (weddingDate) {\r\n        try {\r\n          const date = new Date(weddingDate);\r\n          const month = date.getMonth() + 1;\r\n          let season = '';\r\n          \r\n          if (month >= 3 && month <= 5) season = 'primavera';\r\n          else if (month >= 6 && month <= 8) season = 'verano';\r\n          else if (month >= 9 && month <= 11) season = 'oto√±o';\r\n          else season = 'invierno';\r\n          \r\n          additionalInfo.push(`Temporada: ${season}`);\r\n        } catch {}\r\n      }\r\n      \r\n      // A√±adir tama√±o de evento basado en invitados\r\n      if (numGuests) {\r\n        let size = '';\r\n        const guests = parseInt(numGuests);\r\n        \r\n        if (!isNaN(guests)) {\r\n          if (guests <= 50) size = 'peque√±a';\r\n          else if (guests <= 120) size = 'mediana';\r\n          else size = 'grande';\r\n          \r\n          additionalInfo.push(`Tama√±o del evento: boda ${size} (${guests} invitados)`);\r\n        }\r\n      }\r\n      \r\n      // MEJORA: Prompt much√≠simo m√°s estructurado y enfocado con √âNFASIS EN UBICACI√ìN\r\n      const prompt = `Como experto en planificaci√≥n de bodas en Espa√±a, necesito que busques espec√≠ficamente ${servicioSeleccionado.toUpperCase()} EXCLUSIVAMENTE EN LA ZONA DE ${formattedLocation ? formattedLocation.toUpperCase() : 'ESPA√ëA'} para una boda${aiQuery ? ': ' + aiQuery : '.'}\r\n\r\n  ========== UBICACI√ìN PRIORITARIA ==========\r\n  LA UBICACI√ìN ES EL CRITERIO M√ÅS IMPORTANTE. TODOS LOS PROVEEDORES DEBEN:\r\n  - Operar directamente en ${formattedLocation || 'la ubicaci√≥n indicada'}, O\r\n  - Ofrecer servicio de desplazamiento EXPL√çCITAMENTE a ${formattedLocation ? formattedLocation.split(',')[0] : 'la ubicaci√≥n'}\r\n  Los proveedores deben poder GARANTIZAR cobertura en ${formattedLocation ? formattedLocation.split(',')[0] : 'la zona'}\r\n  \r\n  ========== DATOS DE LA BODA ==========\r\n  - Ubicaci√≥n ceremonia: ${formattedLocation || 'Sin especificar'}\r\n  - Ubicaci√≥n banquete: ${receptionInfo || (formattedLocation ? 'Misma que ceremonia' : 'Sin especificar')}\r\n  - Fecha: ${weddingDate || 'Sin especificar'}\r\n  - Estilo: ${weddingStyle || 'Sin especificar'}\r\n  - N√∫mero de invitados: ${numGuests || 'Sin especificar'}\r\n  - Nombre pareja: ${coupleName || 'Sin especificar'}\r\n  - Presupuesto: ${budgetRange || 'Sin especificar'} ${budgetContext ? '(' + budgetContext + ')' : ''}\r\n  ${additionalInfo.length > 0 ? '- ' + additionalInfo.join('\\n  - ') : ''}\r\n\r\n  ========== REQUISITOS ESPEC√çFICOS ==========\r\n  1. PRIORIZA ABSOLUTAMENTE RESULTADOS DE BODAS.NET Y WEBS ESPA√ëOLAS ESPECIALIZADAS EN BODAS.\r\n  2. La b√∫squeda principal que debes usar es: \"${bodasNetQuery}\"\r\n  3. CADA RESULTADO DEBE SER ESPEC√çFICAMENTE DE ${servicioSeleccionado.toUpperCase()}, no incluyas otros servicios.\r\n  4. CADA RESULTADO DEBE OPERAR O DESPLAZARSE A ${formattedLocation ? formattedLocation.split(',')[0].toUpperCase() : 'LA UBICACI√ìN INDICADA'}\r\n  5. Aseg√∫rate de que cada resultado tenga un enlace a la p√°gina web oficial del proveedor, donde ofrezca directamente sus servicios.\r\n  6. Si no tiene p√°gina web oficial propia, utiliza un enlace donde ofrezca sus servicios directamente (como su perfil en bodas.net o zankyou.es).\r\n  7. Evita enlaces a agregadores gen√©ricos donde el proveedor solo aparece en un listado.\r\n  8. Verifica que el enlace sea actual y operativo.\r\n  9. CADA RESULTADO DEBE INCLUIR LA UBICACI√ìN EXACTA DEL PROVEEDOR Y SU POL√çTICA DE DESPLAZAMIENTO a ${formattedLocation || 'la ubicaci√≥n de la boda'}\r\n  10. El rango de precios debe ser espec√≠fico o una tarifa aproximada.\r\n  11. Ordena los resultados por relevancia geogr√°fica: primero los que est√°n exactamente en ${formattedLocation ? formattedLocation.split(',')[0] : 'la ubicaci√≥n'}, luego los que est√°n cerca y ofrecen desplazamiento.\r\n  12. Incluye valoraciones o rese√±as si est√°n disponibles.\r\n\r\n  ========== FORMATO DE RESPUESTA ==========\r\n  Proporciona 5-7 resultados de m√°xima calidad y relevancia. ASEG√öRATE QUE TODOS:\r\n  1. Son ESPEC√çFICAMENTE ${servicioSeleccionado.toUpperCase()}\r\n  2. Operan en ${formattedLocation ? formattedLocation.toUpperCase() : 'LA UBICACI√ìN'} o se desplazan all√≠\r\n  3. Tienen enlaces verificables y directos\r\n  4. Incluyen datos de precios y ubicaci√≥n espec√≠ficos\r\n  \r\n  Responde en formato JSON con los siguientes campos por proveedor:\r\n  - name: Nombre del proveedor\r\n  - title: T√≠tulo descriptivo\r\n  - service: Tipo de servicio (${servicioSeleccionado})\r\n  - link: URL oficial directa\r\n  - snippet: Descripci√≥n con detalles clave\r\n  - priceRange: Rango de precios\r\n  - location: Ubicaci√≥n y pol√≠tica de desplazamiento\r\n  - coverage: √Årea geogr√°fica atendida (INCLUIR EXPL√çCITAMENTE ${formattedLocation ? formattedLocation.split(',')[0] : 'la ubicaci√≥n requerida'})`;\r\n      \r\n      const response = await fetch('https://api.openai.com/v1/chat/completions', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${import.meta.env.VITE_OPENAI_API_KEY}`,\r\n          'OpenAI-Project': import.meta.env.VITE_OPENAI_PROJECT_ID\r\n        },\r\n        body: JSON.stringify({\r\n          model: 'gpt-4o',\r\n          messages: [\r\n            { \r\n              role: 'system', \r\n              content: `Eres un asistente especializado en b√∫squeda de proveedores para bodas en Espa√±a, especialmente de ${servicioSeleccionado}. Tu tarea es encontrar los proveedores m√°s relevantes seg√∫n las necesidades espec√≠ficas del usuario. DEBES PRIORIZAR RESULTADOS DE BODAS.NET y asegurarte de que todos los proveedores sean ESPEC√çFICAMENTE del servicio solicitado (${servicioSeleccionado}). √öNICAMENTE DEBES INCLUIR PROVEEDORES QUE OPEREN EN LA UBICACI√ìN ESPECIFICADA (${formattedLocation || 'Espa√±a'}) o que ofrezcan desplazamiento a esta ubicaci√≥n. Cada resultado debe incluir una URL v√°lida y datos precisos.`\r\n            },\r\n            { role: 'user', content: prompt }\r\n          ],\r\n          temperature: 0.3 // Temperatura m√°s baja para mayor precisi√≥n y adherencia al tipo de servicio\r\n        })\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        // Manejo mejorado para diferentes c√≥digos de error HTTP\r\n        if (response.status === 401) {\r\n          throw new Error('Error de autenticaci√≥n: La clave API de OpenAI no es v√°lida o ha expirado');\r\n        } else if (response.status === 429) {\r\n          throw new Error('L√≠mite de solicitudes excedido: Demasiadas b√∫squedas en poco tiempo');\r\n        } else if (response.status >= 500) {\r\n          throw new Error('Error en los servidores de OpenAI: Intenta de nuevo m√°s tarde');\r\n        } else {\r\n          throw new Error(`Error en la llamada a OpenAI (${response.status}): ${response.statusText}`);\r\n        }\r\n      }\r\n      \r\n      // Verificar que la respuesta de OpenAI tenga el formato esperado\r\n      const data = await response.json();\r\n      \r\n      if (!data.choices || data.choices.length === 0) {\r\n        throw new Error('No se recibi√≥ respuesta v√°lida de OpenAI');\r\n      }\r\n      \r\n      let results = [];\r\n      \r\n      try {\r\n        // Verificar que la respuesta contiene el mensaje esperado\r\n        if (!data.choices[0].message || !data.choices[0].message.content) {\r\n          throw new Error('Formato de respuesta inv√°lido');\r\n        }\r\n        \r\n        // Intentar extraer los resultados del texto de respuesta\r\n        const content = data.choices[0].message.content;\r\n        \r\n        // Detectar si la respuesta contiene un mensaje de error expl√≠cito\r\n        if (content.toLowerCase().includes('error') && content.length < 150) {\r\n          throw new Error(`Error reportado por OpenAI: ${content}`);\r\n        }\r\n        \r\n        // Intentar extraer JSON de la respuesta con estrategias m√∫ltiples\r\n        console.log('Procesando respuesta de OpenAI para extraer JSON...');\r\n        \r\n        // Estrategia 1: Buscar bloques de c√≥digo JSON marcados con ```json\r\n        let jsonMatches = content.match(/```json\\s*([\\s\\S]+?)\\s*```/);\r\n        \r\n        // Estrategia 2: Buscar cualquier bloque de c√≥digo\r\n        if (!jsonMatches) {\r\n          jsonMatches = content.match(/```\\s*([\\s\\S]+?)\\s*```/);\r\n          console.log('Usando estrategia 2: Bloque de c√≥digo general');\r\n        }\r\n        \r\n        // Estrategia 3: Buscar array directamente en el texto [...]\r\n        if (!jsonMatches) {\r\n          const arrayMatch = content.match(/\\[\\s*\\{[\\s\\S]*\\}\\s*\\]/);\r\n          if (arrayMatch) {\r\n            jsonMatches = [null, arrayMatch[0]];\r\n            console.log('Usando estrategia 3: Encontrado array directo en el texto');\r\n          }\r\n        }\r\n        \r\n        // Estrategia 4: Si todo falla, intentar con el texto completo\r\n        if (!jsonMatches) {\r\n          jsonMatches = [null, content.trim()];\r\n          console.log('Usando estrategia 4: Texto completo');\r\n        }\r\n        \r\n        if (!jsonMatches || !jsonMatches[1]) {\r\n          console.error('No se pudo extraer JSON de la respuesta');\r\n          throw new Error('No se pudo extraer JSON de la respuesta');\r\n        }\r\n        \r\n        // Intentar analizar el JSON con manejo de errores mejorado\r\n        let allResults = [];\r\n        try {\r\n          const jsonText = jsonMatches[1].trim();\r\n          console.log('Texto JSON a parsear (primeros 100 caracteres):', \r\n                     jsonText.length > 100 ? jsonText.substring(0, 100) + '...' : jsonText);\r\n          \r\n          // Intenta parsear directamente\r\n          allResults = JSON.parse(jsonText);\r\n          \r\n        } catch (jsonError) {\r\n          console.error('Error en el primer intento de parseo JSON:', jsonError);\r\n          \r\n          try {\r\n            // Estrategia de respaldo: buscar corchetes de apertura/cierre de un array\r\n            const startIdx = jsonMatches[1].indexOf('[');\r\n            const endIdx = jsonMatches[1].lastIndexOf(']');\r\n            \r\n            if (startIdx !== -1 && endIdx !== -1 && startIdx < endIdx) {\r\n              const arrayText = jsonMatches[1].substring(startIdx, endIdx + 1);\r\n              console.log('Intentando parsear subconjunto como array:', \r\n                         arrayText.length > 100 ? arrayText.substring(0, 100) + '...' : arrayText);\r\n              allResults = JSON.parse(arrayText);\r\n            } else {\r\n              throw new Error('No se encontr√≥ estructura de array en la respuesta');\r\n            }\r\n          } catch (subError) {\r\n            // √öltimo intento: crear un resultado manual basado en el texto\r\n            console.warn('Creando resultado manual basado en el texto de respuesta');\r\n            \r\n            // Extraer frases que parezcan nombres de proveedores (primera letra may√∫scula, m√°s de 3 palabras)\r\n            const lines = content.split('\\n');\r\n            const providerCandidates = lines.filter(line => \r\n              line.trim().length > 10 && \r\n              /^[A-Z]/.test(line.trim()) && \r\n              line.split(' ').length >= 3 &&\r\n              !line.trim().startsWith('```')\r\n            );\r\n            \r\n            if (providerCandidates.length > 0) {\r\n              allResults = providerCandidates.map((line, index) => ({\r\n                title: line.trim().split(':')[0] || `Proveedor ${index + 1}`,\r\n                name: line.trim().split(':')[0] || `Proveedor ${index + 1}`,\r\n                link: `https://www.bodas.net/busqueda/${(serviceFilter || 'proveedores')\r\n                  .toLowerCase()\r\n                  .replace(/\\s+/g, '-')}-espana`,\r\n                snippet: line,\r\n                service: servicioSeleccionado,\r\n                location: formattedLocation || 'Espa√±a',\r\n                priceRange: 'Consultar',\r\n                verified: true\r\n              }));\r\n              console.log(`Creados ${allResults.length} resultados manuales basados en el texto`);\r\n            }\r\n          }\r\n        }\r\n        \r\n        // Verificar que results es un array\r\n        if (!Array.isArray(allResults)) {\r\n          \r\n          console.log(`Ciudad: ${mainLocation}, Regi√≥n: ${region || 'no especificada'}, Pa√≠s: ${country}`);\r\n          \r\n          // Crear t√©rminos de ubicaci√≥n relevantes basados en los datos del perfil\r\n          // Esto es din√°mico seg√∫n la ubicaci√≥n real del usuario, no hardcodeado a Valencia\r\n          const locationRelatedTerms = [\r\n            mainLocation,            // Ciudad principal\r\n            region ? region.toLowerCase() : '',  // Regi√≥n/provincia si est√° disponible\r\n            country,                 // Pa√≠s\r\n            region ? `provincia de ${region.toLowerCase()}` : '',  // Formato alternativo de provincia\r\n            'nacional',              // √Åmbito nacional\r\n            'toda espa√±a',           // Todo el pa√≠s\r\n            'desplazamiento',        // Indica que se desplazan\r\n            'online',                // Servicios remotos/online\r\n          ].filter(Boolean); // Eliminar valores vac√≠os\r\n          \r\n          console.log('T√©rminos de ubicaci√≥n para b√∫squeda:', locationRelatedTerms);\r\n\r\n          // Funci√≥n para evaluar la relevancia de ubicaci√≥n (0-10)\r\n          // Un n√∫mero m√°s alto indica mejor coincidencia con la ubicaci√≥n\r\n          const getLocationRelevance = (item) => {\r\n            let relevance = 0;\r\n            let locationText = '';\r\n            \r\n            // Combinar textos relevantes para buscar referencias a la ubicaci√≥n\r\n            if (item.location) locationText += ' ' + item.location.toLowerCase();\r\n            if (item.snippet) locationText += ' ' + item.snippet.toLowerCase();\r\n            if (item.title) locationText += ' ' + item.title.toLowerCase();\r\n            if (item.description) locationText += ' ' + item.description.toLowerCase();\r\n            \r\n            // Dar puntuaci√≥n seg√∫n coincidencia de ubicaci√≥n\r\n            if (locationText.includes(mainLocation)) relevance += 5; // Coincidencia directa con ciudad\r\n            if (region && locationText.includes(region.toLowerCase())) relevance += 3; // Coincidencia con regi√≥n\r\n            if (locationText.includes(country)) relevance += 1; // Coincidencia con pa√≠s\r\n            \r\n            // Bonificaci√≥n por exactitud\r\n            if (new RegExp(`\\\\b${mainLocation}\\\\b`).test(locationText)) relevance += 2; // Palabra completa\r\n            \r\n            // Desplazamiento expl√≠cito a la ubicaci√≥n\r\n            if ((locationText.includes('desplaza') || locationText.includes('cobertur')) && \r\n                 locationText.includes(mainLocation)) relevance += 4;\r\n            \r\n            // Penalizaci√≥n si no hay ninguna menci√≥n de ubicaci√≥n\r\n            if (!locationRelatedTerms.some(term => locationText.includes(term))) relevance -= 2;\r\n            \r\n            return relevance;\r\n          };\r\n          \r\n          // Clasificar TODOS los resultados por relevancia de ubicaci√≥n\r\n          const scoredResults = allResults.map(item => ({\r\n            ...item,\r\n            locationRelevance: getLocationRelevance(item)\r\n          }));\r\n          \r\n          // Separar en dos grupos: altamente relevantes y menos relevantes\r\n          const highRelevance = scoredResults.filter(item => item.locationRelevance >= 3);\r\n          const lowRelevance = scoredResults.filter(item => item.locationRelevance < 3);\r\n          \r\n          // Ordenar cada grupo por su relevancia\r\n          highRelevance.sort((a, b) => b.locationRelevance - a.locationRelevance);\r\n          lowRelevance.sort((a, b) => b.locationRelevance - a.locationRelevance);\r\n          \r\n          console.log(`Clasificaci√≥n por ubicaci√≥n: ${highRelevance.length} resultados altamente relevantes, ${lowRelevance.length} menos relevantes`);\r\n          \r\n          // Combinar resultados, priorizando los de alta relevancia\r\n          results = [...highRelevance, ...lowRelevance];\r\n          \r\n          // Si no hay resultados de alta relevancia pero s√≠ hay de baja, mostrar un mensaje\r\n          if (highRelevance.length === 0 && lowRelevance.length > 0) {\r\n            console.log(`No se encontraron coincidencias √≥ptimas para ${mainLocation}, mostrando alternativas`);\r\n            setToast({ \r\n              message: `No se encontraron proveedores espec√≠ficos en ${mainLocation}. Mostrando alternativas que podr√≠an desplazarse.`, \r\n              type: 'info' \r\n            });\r\n          }\r\n          \r\n          // Si no hay resultados en absoluto, usar todos (caso extremo)\r\n          if (results.length === 0) {\r\n            console.log('No se encontraron coincidencias de ubicaci√≥n, usando todos los resultados');\r\n            results = allResults;\r\n            setToast({ \r\n              message: `No se encontraron proveedores para ${mainLocation}. Mostrando resultados generales.`, \r\n              type: 'warning' \r\n            });\r\n          }\r\n        } else {\r\n          results = allResults;\r\n        }\r\n        \r\n        // Asegurarse de que cada resultado tenga al menos title y link\r\n        let validResults = results.filter(r => r && typeof r === 'object');\r\n        \r\n        // Normalizar y reparar resultados, en vez de descartarlos\r\n        validResults = validResults.map(r => ({\r\n          ...r,\r\n          title: r.title || r.name || 'Proveedor sin nombre',\r\n          link: r.link || `https://www.bodas.net/busqueda/${(r.service || servicioSeleccionado || '').toLowerCase().replace(/\\s+/g, '-')}-${formattedLocation ? formattedLocation.split(',')[0].toLowerCase() : 'espana'}`,\r\n          snippet: r.snippet || 'Sin descripci√≥n disponible',\r\n          service: r.service || servicioSeleccionado,\r\n          location: r.location || formattedLocation || 'Espa√±a',\r\n          priceRange: r.priceRange || 'Consultar',\r\n          verified: true // Marcar todos como verificados para evitar filtrado\r\n        }));\r\n        \r\n        console.log(`Normalizaci√≥n de resultados: ${validResults.length} resultados normalizados`);\r\n        \r\n        if (validResults.length === 0 && results.length > 0) {\r\n          console.warn('No hay resultados v√°lidos despu√©s de normalizar, creando respaldo');\r\n          // Crear un resultado de respaldo para evitar que no haya resultados\r\n          validResults = [{\r\n            title: 'Directorio de proveedores para bodas',\r\n            link: `https://www.bodas.net/busqueda/${servicioSeleccionado.toLowerCase().replace(/\\s+/g, '-')}-${formattedLocation ? formattedLocation.split(',')[0].toLowerCase() : 'espana'}`,\r\n            snippet: `Encuentra proveedores de ${servicioSeleccionado} en ${formattedLocation || 'toda Espa√±a'}`,\r\n            service: servicioSeleccionado,\r\n            location: formattedLocation || 'Espa√±a',\r\n            priceRange: 'Varios precios disponibles',\r\n            verified: true\r\n          }];\r\n        }\r\n        \r\n        results = validResults;\r\n        \r\n        // Ordenar enlaces por calidad y relevancia (pero ser menos estricto)\r\n        results.sort((a, b) => {\r\n          // Funci√≥n para puntuar la calidad del enlace\r\n          const getLinkScore = (item) => {\r\n            if (!item || !item.link) return 0;\r\n            const link = item.link.toLowerCase();\r\n            \r\n            // Enlaces probablemente oficiales (dominio propio)\r\n            if (!link.includes('bodas.net') && \r\n                !link.includes('zankyou') && \r\n                !link.includes('matrimonio.com') && \r\n                !link.includes('facebook.com') && \r\n                !link.includes('instagram.com') && \r\n                link.includes('.')) {\r\n              return 5; // Probablemente web oficial\r\n            }\r\n            \r\n            // Perfiles en plataformas de bodas\r\n            else if (link.includes('bodas.net') || \r\n                     link.includes('zankyou.es') || \r\n                     link.includes('matrimonio.com')) {\r\n              return 4; // Plataforma especializada\r\n            }\r\n            \r\n            // Redes sociales\r\n            else if (link.includes('facebook.com') || \r\n                     link.includes('instagram.com')) {\r\n              return 3; // Red social\r\n            }\r\n            \r\n            // Otros enlaces\r\n            return 1;\r\n          };\r\n          \r\n          return getLinkScore(b) - getLinkScore(a); // Mayor puntuaci√≥n primero\r\n        });\r\n        \r\n        if (results.length > 0) {\r\n          // Mostrar los resultados en el modal solo si hay resultados\r\n          setAiResults(results);\r\n          setShowAiModal(true);\r\n          saveData('lovendaSuppliers', results, { firestore: false, showNotification: false });\r\n          window.dispatchEvent(new Event('lovenda-suppliers'));\r\n        } else {\r\n          setToast({ \r\n            message: 'No se encontraron proveedores que coincidan con tu b√∫squeda. Intenta con otros t√©rminos o servicio.', \r\n            type: 'info' \r\n          });\r\n        }\r\n      } catch (parseError) {\r\n        console.error('Error al procesar la respuesta de OpenAI:', parseError);\r\n        console.log('Contenido recibido:', data.choices[0].message?.content || 'Contenido no disponible');\r\n        \r\n        // Mensaje m√°s espec√≠fico seg√∫n el tipo de error\r\n        if (parseError.message.includes('JSON')) {\r\n          setToast({ \r\n            message: 'Error al procesar la respuesta: formato inv√°lido. Intenta de nuevo o con otra b√∫squeda.', \r\n            type: 'error' \r\n          });\r\n        } else {\r\n          setToast({ \r\n            message: `Error al procesar los resultados: ${parseError.message}`, \r\n            type: 'error' \r\n          });\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.error('Error en la b√∫squeda de proveedores:', err);\r\n      \r\n      // Mensaje de error m√°s espec√≠fico seg√∫n el tipo de error\r\n      if (err.message.includes('autenticaci√≥n') || err.message.includes('API')) {\r\n        setToast({ \r\n          message: 'Error de autenticaci√≥n en la API. Por favor, contacta con soporte.', \r\n          type: 'error' \r\n        });\r\n      } else if (err.message.includes('L√≠mite')) {\r\n        setToast({ \r\n          message: 'Has excedido el l√≠mite de b√∫squedas. Espera unos minutos e intenta de nuevo.', \r\n          type: 'warning' \r\n        });\r\n      } else if (err.message.includes('red') || err.message.includes('conexi√≥n') || err.message.includes('network')) {\r\n        setToast({ \r\n          message: 'Error de conexi√≥n. Verifica tu conexi√≥n a internet e intenta de nuevo.', \r\n          type: 'error' \r\n        });\r\n      } else {\r\n        setToast({ \r\n          message: 'Error al buscar proveedores con IA. Intenta de nuevo m√°s tarde.', \r\n          type: 'error' \r\n        });\r\n      }\r\n    } finally {\r\n      setAiLoading(false);\r\n    }\r\n  };\r\n\r\n  const openDetail = p => { setDetailProvider(p); setShowDetail(true); };\r\n  const sendMailToProvider = async () => {\r\n    if (!detailProvider?.email) { \r\n      setToast({ message: 'El proveedor no tiene email disponible', type: 'error' }); \r\n      return; \r\n    }\r\n    \r\n    // Obtener informaci√≥n del perfil para personalizar el mensaje\r\n    let profileInfo = {};\r\n    try {\r\n      profileInfo = await loadData('lovendaProfile', {});\r\n    } catch (err) {\r\n      console.warn('No se pudo cargar la informaci√≥n del perfil para el correo:', err);\r\n    }\r\n    \r\n    // Construir los nombres de la pareja\r\n    const bride = profileInfo.bride?.name || profileInfo.nombre1 || 'Novia';\r\n    const groom = profileInfo.groom?.name || profileInfo.nombre2 || 'Novio';\r\n    const weddingDate = profileInfo.date || profileInfo.weddingInfo?.date || 'fecha por determinar';\r\n    \r\n    // Crear plantilla de correo personalizada\r\n    const emailBody = `Hola ${detailProvider.contact || ''}:\r\n\r\nSomos ${bride} y ${groom}, estamos organizando nuestra boda para el ${weddingDate} ${profileInfo.celebrationPlace ? `en ${profileInfo.celebrationPlace}` : ''} y estamos interesados en sus servicios de ${detailProvider.service || 'proveedor'}.\r\n\r\n¬øPodr√≠a proporcionarnos informaci√≥n sobre sus servicios, disponibilidad para esa fecha y precios aproximados?\r\n\r\nMuchas gracias de antemano.\r\n\r\nSaludos cordiales,\r\n${bride} y ${groom}`;\r\n    \r\n    // Disparar evento global para abrir redacci√≥n en Buz√≥n con plantilla\r\n    window.dispatchEvent(new CustomEvent('lovenda-compose', { \r\n      detail: { \r\n        to: detailProvider.email, \r\n        subject: `Consulta sobre servicios de ${detailProvider.service || ''} para boda - ${detailProvider.name}`,\r\n        body: emailBody\r\n      } \r\n    }));\r\n    \r\n    // Registrar este proveedor como contactado y a√±adir la comunicaci√≥n al historial\r\n    const currentDate = new Date();\r\n    const dateStr = currentDate.toISOString();\r\n    const formattedDate = dateStr.split('T')[0];\r\n    \r\n    const newCommunication = {\r\n      date: dateStr,\r\n      type: 'Email enviado',\r\n      subject: `Consulta sobre servicios de ${detailProvider.service || ''} para boda`,\r\n      content: emailBody.substring(0, 100) + '...' // Resumen del contenido\r\n    };\r\n    \r\n    const updatedProviders = providers.map(p => {\r\n      if (p.id === detailProvider.id) {\r\n        // A√±adir comunicaci√≥n al historial (crear array si no existe)\r\n        const communications = p.communications ? [...p.communications, newCommunication] : [newCommunication];\r\n        \r\n        return {\r\n          ...p, \r\n          status: 'Contactado', \r\n          lastContactDate: formattedDate,\r\n          communications: communications\r\n        };\r\n      }\r\n      return p;\r\n    });\r\n    \r\n    // Actualizar estado y guardar en localStorage\r\n    setProviders(updatedProviders);\r\n    saveData('providers', updatedProviders);\r\n    \r\n    // Actualizar el proveedor en detalle para mostrar la comunicaci√≥n inmediatamente\r\n    if (detailProvider) {\r\n      const communications = detailProvider.communications ? [...detailProvider.communications, newCommunication] : [newCommunication];\r\n      setDetailProvider({\r\n        ...detailProvider,\r\n        status: 'Contactado',\r\n        lastContactDate: formattedDate,\r\n        communications: communications\r\n      });\r\n    }\r\n    \r\n    // Crear o actualizar registro de seguimiento para este proveedor\r\n    const emailData = {\r\n      id: `email-${Date.now()}`,\r\n      to: detailProvider.email,\r\n      subject: `Consulta sobre servicios de ${detailProvider.service || ''} para boda - ${detailProvider.name}`,\r\n      body: emailBody,\r\n      date: new Date()\r\n    };\r\n    \r\n    // Crear registro de seguimiento autom√°ticamente al enviar email\r\n    createTrackingRecord(emailData, detailProvider);\r\n    setTrackingRecords(loadTrackingRecords());\r\n    \r\n    // Notificar al usuario que la funcionalidad est√° temporalmente no disponible\r\n    alert('Funcionalidad de buz√≥n temporalmente no disponible');\r\n    setShowDetail(false);\r\n  };\r\n\r\n  // Gestionar el seguimiento del proveedor\r\n  const handleProviderTracking = () => {\r\n    if (!detailProvider) return;\r\n    \r\n    // Buscar si ya existe un seguimiento para este proveedor\r\n    const existingTracking = trackingRecords.find(record => \r\n      record.providerEmail === detailProvider.email || record.providerId === detailProvider.id\r\n    );\r\n    \r\n    if (existingTracking) {\r\n      // Si ya existe un seguimiento, mostrarlo\r\n      setCurrentTracking(existingTracking);\r\n      setShowTrackingModal(true);\r\n    } else {\r\n      // Si no existe, crear uno nuevo\r\n      const dummyEmail = {\r\n        id: `dummy-${Date.now()}`,\r\n        to: detailProvider.email,\r\n        subject: `Seguimiento de ${detailProvider.service || 'proveedor'} - ${detailProvider.name}`,\r\n        body: `Seguimiento autom√°tico creado para ${detailProvider.name}`,\r\n        date: new Date()\r\n      };\r\n      \r\n      const newTracking = createTrackingRecord(dummyEmail, detailProvider);\r\n      setCurrentTracking(newTracking);\r\n      setTrackingRecords(loadTrackingRecords());\r\n      setShowTrackingModal(true);\r\n    }\r\n  };\r\n  \r\n  // Actualizar estado de seguimiento\r\n  const updateTrackingStatusHandler = (recordId, newStatus) => {\r\n    updateTrackingStatus(recordId, newStatus);\r\n    setTrackingRecords(loadTrackingRecords());\r\n    setCurrentTracking(prev => prev && prev.id === recordId ? \r\n      {...prev, status: newStatus} : prev);\r\n    \r\n    setToast({ \r\n      message: `Estado de seguimiento actualizado a \"${newStatus}\"`, \r\n      type: 'success' \r\n    });\r\n  };\r\n  \r\n  // Sincronizar emails del buz√≥n para un proveedor espec√≠fico\r\n  const syncProviderEmails = (provider) => {\r\n    if (!provider || !provider.email) {\r\n      setToast({ message: 'Este proveedor no tiene email para sincronizar', type: 'warning' });\r\n      return;\r\n    }\r\n    \r\n    setIsSyncingEmails(true);\r\n    setSyncedEmails([]);\r\n    \r\n    // Cargar emails del localStorage (simulaci√≥n de b√∫squeda en buz√≥n)\r\n    setTimeout(() => {\r\n      try {\r\n        // En una implementaci√≥n real, esta funci√≥n buscar√≠a en el buz√≥n por remitente/destinatario\r\n        const allEmails = loadData('emails', { defaultValue: [] });\r\n        \r\n        // Filtrar por emails que coincidan con el email del proveedor\r\n        const relatedEmails = allEmails.filter(email => {\r\n          const isRelated = (\r\n            // Es el remitente o est√° entre los destinatarios\r\n            email.from?.includes(provider.email) ||\r\n            email.to?.includes(provider.email) ||\r\n            // O contiene el nombre del proveedor en el asunto\r\n            (email.subject && provider.name && \r\n             email.subject.toLowerCase().includes(provider.name.toLowerCase()))\r\n          );\r\n          return isRelated;\r\n        });\r\n        \r\n        // Formatear emails para mostrar\r\n        const formattedEmails = relatedEmails.map(email => ({\r\n          id: email.id || `email-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n          subject: email.subject || '(Sin asunto)',\r\n          snippet: email.body?.substring(0, 100) || '',\r\n          date: email.date || new Date(),\r\n          direction: email.from?.includes('@midominio.com') ? 'outgoing' : 'incoming',\r\n          from: email.from || '',\r\n          to: email.to || '',\r\n        }));\r\n        \r\n        // Ordenar por fecha m√°s reciente primero\r\n        formattedEmails.sort((a, b) => new Date(b.date) - new Date(a.date));\r\n        \r\n        setSyncedEmails(formattedEmails);\r\n        \r\n        // Actualizar comunicaciones del proveedor con los emails sincronizados\r\n        if (formattedEmails.length > 0) {\r\n          const updatedProvider = {...provider};\r\n          \r\n          // Convertir emails a formato de comunicaciones\r\n          const newCommunications = formattedEmails.map(email => ({\r\n            date: email.date,\r\n            type: email.direction === 'outgoing' ? 'Email enviado' : 'Email recibido',\r\n            subject: email.subject,\r\n            content: email.snippet,\r\n            emailId: email.id\r\n          }));\r\n          \r\n          // Filtrar comunicaciones existentes para no duplicar\r\n          const existingEmailIds = updatedProvider.communications \r\n            ? updatedProvider.communications\r\n                .filter(c => c.emailId)\r\n                .map(c => c.emailId) \r\n            : [];\r\n          \r\n          const newUniqueCommunications = newCommunications.filter(\r\n            nc => !existingEmailIds.includes(nc.emailId)\r\n          );\r\n          \r\n          // A√±adir nuevas comunicaciones\r\n          updatedProvider.communications = updatedProvider.communications \r\n            ? [...updatedProvider.communications, ...newUniqueCommunications]\r\n            : newUniqueCommunications;\r\n            \r\n          // Actualizar el proveedor en la lista y en detalle\r\n          const updatedProviders = providers.map(p => \r\n            p.id === provider.id ? updatedProvider : p\r\n          );\r\n          \r\n          setProviders(updatedProviders);\r\n          saveData('providers', updatedProviders);\r\n          \r\n          if (detailProvider && detailProvider.id === provider.id) {\r\n            setDetailProvider(updatedProvider);\r\n          }\r\n        }\r\n        \r\n        setToast({ \r\n          message: `Sincronizaci√≥n completada: ${formattedEmails.length} emails encontrados`, \r\n          type: 'success' \r\n        });\r\n      } catch (error) {\r\n        console.error('Error al sincronizar emails:', error);\r\n        setToast({ \r\n          message: 'Error al sincronizar emails con el buz√≥n', \r\n          type: 'error' \r\n        });\r\n      } finally {\r\n        setIsSyncingEmails(false);\r\n      }\r\n    }, 1500); // Simulamos un retardo para mostrar el estado de carga\r\n  };\r\n\r\n  return (\r\n    <PageWrapper\r\n        title=\"Gesti√≥n de Proveedores\"\r\n        actions={\r\n          <div className=\"flex gap-2\">\r\n            <Button \r\n              leftIcon={<Plus size={16} />} \r\n              onClick={() => setShowAddModal(true)}\r\n              variant=\"outline\"\r\n            >\r\n              A√±adir Manual\r\n            </Button>\r\n            <Button \r\n              leftIcon={<Plus size={16} />} \r\n              onClick={() => setShowAiModal(true)} \r\n              data-testid=\"open-ai-search\"\r\n            >\r\n              Buscar IA\r\n            </Button>\r\n          </div>\r\n        }\r\n      >\r\n      {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}\r\n      \r\n      {/* Dashboard de progreso */}\r\n      <Card className=\"mb-4 p-4\">\r\n        <div className=\"flex justify-between items-center\">\r\n          <div>\r\n            <h3 className=\"text-lg font-semibold\">Progreso de Contrataci√≥n</h3>\r\n            <p className=\"text-gray-600\">\r\n              {getContractingProgress().contracted} de {getContractingProgress().total} servicios esenciales contratados\r\n            </p>\r\n          </div>\r\n          <div className=\"flex gap-2\">\r\n            <Button \r\n              onClick={() => setShowServiceConfig(true)}\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n            >\r\n              Configurar Servicios\r\n            </Button>\r\n            <div className=\"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium\">\r\n              {getContractingProgress().total > 0 ? Math.round((getContractingProgress().contracted / getContractingProgress().total) * 100) : 0}% completado\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </Card>\r\n\r\n      <Card className=\"space-y-4 p-4\">\r\n        {/* Pesta√±as */}\r\n        <div className=\"flex gap-2\">\r\n          {[ \r\n            { key: 'selected', label: 'Seleccionados' },\r\n            { key: 'contacted', label: 'Contactados' }\r\n          ].map(t => (\r\n            <button\r\n              key={t.key}\r\n              onClick={() => setTab(t.key)}\r\n              className={`px-3 py-1 rounded-full text-sm transition-colors ${tab === t.key ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}`}>{t.label}</button>\r\n          ))}\r\n        </div>\r\n\r\n        {/* Contenido seg√∫n pesta√±a */}\r\n        {tab === 'selected' && (\r\n          <div>\r\n            <h3 className=\"text-lg font-semibold mb-4\">Servicios para tu boda</h3>\r\n            <div className=\"grid gap-4 grid-cols-1 md:grid-cols-2 xl:grid-cols-3\">\r\n              {wantedServices.map(service => {\r\n                const contractedProvider = providers.find(p => \r\n                  p.service === service.name && (p.status === 'Confirmado' || p.status === 'Seleccionado')\r\n                );\r\n                \r\n                return (\r\n                  <div key={service.id} className={`p-4 rounded-lg border-2 transition-all ${\r\n                    contractedProvider \r\n                      ? 'border-green-200 bg-green-50' \r\n                      : service.required \r\n                        ? 'border-orange-200 bg-orange-50' \r\n                        : 'border-gray-200 bg-gray-50'\r\n                  }`}>\r\n                    <div className=\"flex justify-between items-start mb-2\">\r\n                      <h4 className=\"font-semibold\">{service.name}</h4>\r\n                      {service.required && !contractedProvider && (\r\n                        <span className=\"bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded\">\r\n                          Esencial\r\n                        </span>\r\n                      )}\r\n                      {contractedProvider && (\r\n                        <span className=\"bg-green-100 text-green-800 text-xs px-2 py-1 rounded\">\r\n                          ‚úì Contratado\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                    \r\n                    {contractedProvider ? (\r\n                      <div>\r\n                        <p className=\"font-medium text-green-800\">{contractedProvider.name}</p>\r\n                        <p className=\"text-sm text-gray-600\">{contractedProvider.contact || contractedProvider.email}</p>\r\n                        {contractedProvider.phone && (\r\n                          <p className=\"text-sm text-gray-600\">{contractedProvider.phone}</p>\r\n                        )}\r\n                      </div>\r\n                    ) : (\r\n                      <div>\r\n                        <p className=\"text-gray-500 text-sm mb-3\">\r\n                          {service.required ? 'Servicio pendiente de contratar' : 'Servicio opcional'}\r\n                        </p>\r\n                        <div className=\"flex gap-2\">\r\n                          <Button \r\n                            size=\"sm\" \r\n                            variant=\"outline\"\r\n                            onClick={() => {\r\n                              setServiceFilter(service.name);\r\n                              setShowAiModal(true);\r\n                            }}\r\n                          >\r\n                            Buscar\r\n                          </Button>\r\n                          <Button \r\n                            size=\"sm\" \r\n                            variant=\"outline\"\r\n                            onClick={() => {\r\n                              setNewProvider({...initialProvider, service: service.name});\r\n                              setShowAddModal(true);\r\n                            }}\r\n                          >\r\n                            A√±adir\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                    \r\n                    {service.budget > 0 && (\r\n                      <div className=\"mt-2 text-sm text-gray-600\">\r\n                        Presupuesto: {service.budget}‚Ç¨\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {tab === 'contacted' && (\r\n          <div>\r\n            <form onSubmit={e => e.preventDefault()} className=\"flex items-center border rounded px-2 py-1 mb-4\">\r\n              <Search size={16} className=\"mr-2 text-gray-600\" />\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"Buscar proveedores contactados...\"\r\n                value={searchTerm}\r\n                onChange={e => setSearchTerm(e.target.value)}\r\n                className=\"outline-none flex-1\"\r\n              />\r\n            </form>\r\n            \r\n            <div className=\"grid gap-4 grid-cols-1 md:grid-cols-2 xl:grid-cols-3\">\r\n              {displayed.length === 0 && <p className=\"text-gray-500\">No hay proveedores contactados.</p>}\r\n              {displayed.map(p=>(\r\n                <div key={p.id} className=\"relative p-4 cursor-pointer bg-white rounded shadow hover:shadow-md transition-shadow\" onClick={() => openDetail(p)}>\r\n                  <button\r\n                    className=\"absolute top-2 right-2 text-gray-400 hover:text-red-600\"\r\n                    onClick={(e) => { e.stopPropagation(); removeProvider(p.id); }}\r\n                    title=\"Eliminar proveedor\"\r\n                  >\r\n                    <Trash2 size={16} />\r\n                  </button>\r\n                  <span className=\"absolute top-2 left-2 bg-blue-100 text-blue-700 text-xs px-2 py-1 rounded\">{p.service}</span>\r\n                  <h3 className=\"text-lg font-semibold mb-2 mt-6\">{p.name}</h3>\r\n                  <p className=\"text-sm text-gray-600 mb-2\">{p.contact || p.email || p.phone}</p>\r\n                  <div className=\"flex justify-between items-center\">\r\n                    <span className={`px-2 py-1 rounded-full text-xs ${\r\n                      p.status === 'Confirmado' ? 'bg-green-100 text-green-800' : \r\n                      p.status === 'Contactado' ? 'bg-blue-100 text-blue-800' : \r\n                      'bg-gray-100 text-gray-800'\r\n                    }`}>\r\n                      {p.status || 'Pendiente'}\r\n                    </span>\r\n                    <div className=\"flex\">\r\n                      {[1,2,3,4,5].map(i => (\r\n                        <Star key={i} size={14} className=\"cursor-pointer\" color={i <= Math.round(p.rating) ? '#facc15' : '#e5e7eb'} onClick={(e) => {e.stopPropagation(); rateProvider(p.id, i);}} />\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </Card>\r\n\r\n\r\n      {/* Modal Detalle */}\r\n      {showDetail && detailProvider && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\" onClick={()=>setShowDetail(false)}>\r\n          <div className=\"bg-white w-full max-w-lg p-6 rounded shadow space-y-4 max-h-[90vh] overflow-auto\" onClick={e=>e.stopPropagation()}>\r\n            <div className=\"flex justify-between items-start mb-2\">\r\n              <h2 className=\"text-xl font-semibold\">{detailProvider.name}</h2>\r\n              <div className=\"flex items-center gap-2\">\r\n                <span className={`px-2 py-0.5 rounded-full text-xs ${detailProvider.status === 'Confirmado' ? 'bg-green-100 text-green-800' : detailProvider.status === 'Contactado' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800'}`}>\r\n                  {detailProvider.status || 'Pendiente'}\r\n                </span>\r\n                <button className=\"text-gray-500 text-2xl leading-4\" onClick={()=>setShowDetail(false)}>&times;</button>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Pesta√±as de navegaci√≥n */}\r\n            <div className=\"flex border-b mb-4\">\r\n              <button\r\n                className={`px-4 py-2 font-medium text-sm ${activeDetailTab === 'info' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-500'}`}\r\n                onClick={() => setActiveDetailTab('info')}\r\n              >\r\n                Informaci√≥n\r\n              </button>\r\n              <button\r\n                className={`px-4 py-2 font-medium text-sm ${activeDetailTab === 'communications' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-500'}`}\r\n                onClick={() => setActiveDetailTab('communications')}\r\n              >\r\n                Comunicaciones\r\n              </button>\r\n              <button\r\n                className={`px-4 py-2 font-medium text-sm ${activeDetailTab === 'tracking' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-500'}`}\r\n                onClick={() => setActiveDetailTab('tracking')}\r\n              >\r\n                Seguimiento\r\n              </button>\r\n            </div>\r\n            \r\n            {/* Pesta√±a de Informaci√≥n */}\r\n            {activeDetailTab === 'info' && (\r\n              <>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <div className=\"space-y-2\">\r\n                    <p><span className=\"font-medium\">Servicio:</span> {detailProvider.service}</p>\r\n                    {detailProvider.contact && <p><span className=\"font-medium\">Contacto:</span> {detailProvider.contact}</p>}\r\n                    {detailProvider.email && <p><span className=\"font-medium\">Email:</span> {detailProvider.email}</p>}\r\n                    {detailProvider.phone && <p><span className=\"font-medium\">Tel√©fono:</span> {detailProvider.phone}</p>}\r\n                  </div>\r\n                  \r\n                  <div>\r\n                    {detailProvider.priceRange && (\r\n                      <p><span className=\"font-medium\">Precio aproximado:</span> {detailProvider.priceRange}</p>\r\n                    )}\r\n                    {detailProvider.location && (\r\n                      <p><span className=\"font-medium\">Ubicaci√≥n:</span> {detailProvider.location}</p>\r\n                    )}\r\n                    {detailProvider.link && (\r\n                      <p>\r\n                        <span className=\"font-medium\">Web:</span> \r\n                        <a href={detailProvider.link} target=\"_blank\" rel=\"noreferrer\" className=\"text-blue-600 hover:underline ml-1\">\r\n                          {detailProvider.link.replace(/(https?:\\/\\/|www\\.)/g, '').split('/')[0]}\r\n                        </a>\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                \r\n                {detailProvider.snippet && (\r\n                  <div className=\"mt-4\">\r\n                    <h3 className=\"text-sm font-medium text-gray-700 mb-1\">Descripci√≥n</h3>\r\n                    <p className=\"text-sm text-gray-600 whitespace-pre-line bg-gray-50 p-2 rounded\">{detailProvider.snippet}</p>\r\n                  </div>\r\n                )}\r\n              </>\r\n            )}\r\n            \r\n            {/* Pesta√±a de Comunicaciones */}\r\n            {activeDetailTab === 'communications' && (\r\n              <div className=\"pb-4\">\r\n                <div className=\"mb-4\">\r\n                  <h3 className=\"text-sm font-medium text-gray-700 mb-1\">Historial de comunicaciones</h3>\r\n                  {detailProvider.communications && detailProvider.communications.length > 0 ? (\r\n                    <div className=\"space-y-2 max-h-[300px] overflow-auto\">\r\n                      {detailProvider.communications.map((comm, idx) => (\r\n                        <div key={idx} className=\"border-l-2 border-blue-400 pl-2 py-1\">\r\n                          <p className=\"text-xs text-gray-500\">{new Date(comm.date).toLocaleString()}</p>\r\n                          <p className=\"text-sm font-medium\">{comm.type}</p>\r\n                          <p className=\"text-sm\">{comm.subject}</p>\r\n                          {comm.content && <p className=\"text-xs text-gray-600\">{comm.content}</p>}\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  ) : (\r\n                    <p className=\"text-sm text-gray-500 italic\">No hay comunicaciones registradas</p>\r\n                  )}\r\n                </div>\r\n                \r\n                {/* Correos sincronizados desde el buz√≥n */}\r\n                <div>\r\n                  <h3 className=\"text-sm font-medium text-gray-700 mb-1 flex items-center\">\r\n                    Correos sincronizados\r\n                    <button \r\n                      className=\"ml-2 text-xs text-blue-600 hover:underline flex items-center\" \r\n                      onClick={() => {\r\n                        syncProviderEmails(detailProvider);\r\n                      }}\r\n                      disabled={isSyncingEmails}\r\n                    >\r\n                      {isSyncingEmails ? (\r\n                        <>\r\n                          <Spinner size=\"small\" className=\"mr-1\" />\r\n                          Sincronizando...\r\n                        </>\r\n                      ) : (\r\n                        <>\r\n                          <RefreshCcw size={12} className=\"mr-1\" />\r\n                          Sincronizar\r\n                        </>\r\n                      )}\r\n                    </button>\r\n                  </h3>\r\n                  \r\n                  <div className=\"space-y-2 max-h-[300px] overflow-auto\">\r\n                    {syncedEmails && syncedEmails.length > 0 ? (\r\n                      syncedEmails.map((email, idx) => (\r\n                        <div key={idx} className=\"border-l-2 border-purple-400 pl-2 py-1\">\r\n                          <p className=\"text-xs text-gray-500\">{new Date(email.date).toLocaleString()}</p>\r\n                          <p className=\"text-sm font-medium\">{email.direction === 'outgoing' ? 'Enviado' : 'Recibido'}</p>\r\n                          <p className=\"text-sm\">{email.subject}</p>\r\n                          {email.snippet && <p className=\"text-xs text-gray-600 truncate\">{email.snippet}</p>}\r\n                        </div>\r\n                      ))\r\n                    ) : (\r\n                      <p className=\"text-sm text-gray-500 italic\">Sin datos sincronizados del buz√≥n</p>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {/* Pesta√±a de Seguimiento */}\r\n            {activeDetailTab === 'tracking' && (\r\n              <div>\r\n                {/* Registro de seguimiento activo */}\r\n                {trackingRecords.filter(record => \r\n                  record.providerEmail === detailProvider.email || record.providerId === detailProvider.id\r\n                ).length > 0 ? (\r\n                  <div className=\"space-y-4\">\r\n                    {trackingRecords.filter(record => \r\n                      record.providerEmail === detailProvider.email || record.providerId === detailProvider.id\r\n                    ).map((record, idx) => (\r\n                      <div key={idx} className=\"border rounded-lg p-3\">\r\n                        <div className=\"flex justify-between items-center\">\r\n                          <h3 className=\"font-medium\">{record.subject || 'Seguimiento'}</h3>\r\n                          <span className={`px-2 py-0.5 rounded-full text-xs ${record.status === TRACKING_STATUS.URGENT ? 'bg-red-100 text-red-800' : \r\n                            record.status === TRACKING_STATUS.WAITING ? 'bg-amber-100 text-amber-800' :\r\n                            record.status === TRACKING_STATUS.RESPONDED ? 'bg-green-100 text-green-800' :\r\n                            record.status === TRACKING_STATUS.FOLLOWUP ? 'bg-blue-100 text-blue-800' :\r\n                            'bg-gray-100 text-gray-800'}`}>\r\n                            {record.status || 'Pendiente'}\r\n                          </span>\r\n                        </div>\r\n                        \r\n                        <p className=\"text-xs text-gray-500 mt-1\">√öltimo contacto: {new Date(record.lastEmailDate).toLocaleDateString()}</p>\r\n                        {record.dueDate && <p className=\"text-xs text-gray-500\">Fecha l√≠mite: {new Date(record.dueDate).toLocaleDateString()}</p>}\r\n                        \r\n                        {record.notes && <p className=\"text-sm mt-2 bg-gray-50 p-2 rounded\">{record.notes}</p>}\r\n                        \r\n                        <div className=\"mt-2\">\r\n                          <button \r\n                            className=\"text-blue-600 text-sm hover:underline\"\r\n                            onClick={() => {\r\n                              setCurrentTracking(record);\r\n                              setShowTrackingModal(true);\r\n                            }}\r\n                          >\r\n                            Ver detalles\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"text-center py-10\">\r\n                    <Clock className=\"mx-auto h-10 w-10 text-gray-400\" />\r\n                    <p className=\"mt-2 text-sm text-gray-500\">No hay seguimientos activos para este proveedor</p>\r\n                    <button \r\n                      className=\"mt-3 px-4 py-2 bg-amber-500 text-white rounded-full text-sm\"\r\n                      onClick={handleProviderTracking}\r\n                    >\r\n                      Crear seguimiento\r\n                    </button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n            \r\n            {/* Panel de acciones r√°pidas contextuales */}\r\n            <div className=\"border-t border-gray-200 mt-4 pt-4\">\r\n              <h3 className=\"text-sm font-medium text-gray-700 mb-2\">Acciones r√°pidas</h3>\r\n              \r\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2\">\r\n                {/* Acci√≥n r√°pida: Email */}\r\n                <button \r\n                  className=\"p-2 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 flex flex-col items-center justify-center\"\r\n                  onClick={sendMailToProvider}\r\n                >\r\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6 text-blue-600 mb-1\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\" />\r\n                  </svg>\r\n                  <span className=\"text-xs\">Email</span>\r\n                </button>\r\n                \r\n                {/* Acci√≥n r√°pida: Seguimiento */}\r\n                <button \r\n                  className=\"p-2 bg-amber-50 border border-amber-200 rounded-lg hover:bg-amber-100 flex flex-col items-center justify-center\"\r\n                  onClick={handleProviderTracking}\r\n                >\r\n                  <Clock className=\"h-6 w-6 text-amber-600 mb-1\" />\r\n                  <span className=\"text-xs\">Seguimiento</span>\r\n                </button>\r\n                \r\n                {/* Acci√≥n r√°pida: Reservar cita */}\r\n                <button \r\n                  className=\"p-2 bg-green-50 border border-green-200 rounded-lg hover:bg-green-100 flex flex-col items-center justify-center\"\r\n                  onClick={() => {\r\n                    setProviderToReserve(detailProvider);\r\n                    setShowResModal(true);\r\n                  }}\r\n                >\r\n                  <Calendar className=\"h-6 w-6 text-green-600 mb-1\" />\r\n                  <span className=\"text-xs\">Reservar</span>\r\n                </button>\r\n                \r\n                {/* Acci√≥n r√°pida: Plantillas */}\r\n                <div className=\"relative\">\r\n                  <button \r\n                    className=\"p-2 bg-purple-50 border border-purple-200 rounded-lg hover:bg-purple-100 flex flex-col items-center justify-center w-full\"\r\n                    onClick={() => {\r\n                      // Mostrar men√∫ de plantillas\r\n                      const templates = [\r\n                        { name: 'Consulta inicial', subject: `Consulta de servicios - ${detailProvider.name}` },\r\n                        { name: 'Solicitar presupuesto', subject: `Solicitud de presupuesto - ${detailProvider.name}` },\r\n                        { name: 'Confirmar detalles', subject: `Confirmaci√≥n de detalles - ${detailProvider.name}` },\r\n                        { name: 'Consulta disponibilidad', subject: `Consulta de disponibilidad - ${detailProvider.name}` }\r\n                      ];\r\n                      \r\n                      // Crear evento para abrir plantilla en buz√≥n\r\n                      const template = templates[0]; // Usar primera plantilla como ejemplo\r\n                      const allProfileData = loadData('lovendaProfile', { defaultValue: {} });\r\n                      const weddingDate = allProfileData.weddingInfo?.date || 'fecha por determinar';\r\n                      const bride = allProfileData.bride?.name || 'Novia';\r\n                      const groom = allProfileData.groom?.name || 'Novio';\r\n                      \r\n                      const emailBody = `Hola ${detailProvider.contact || 'Responsable de ' + detailProvider.name},\r\n\r\nSomos ${bride} y ${groom} y estamos organizando nuestra boda para el ${weddingDate}.\r\n\r\nNos gustar√≠a recibir un presupuesto detallado para vuestros servicios de ${detailProvider.service}.\r\n\r\n¬øPodr√≠ais proporcionarnos informaci√≥n sobre tarifas, opciones disponibles y qu√© incluye cada servicio?\r\n\r\nMuchas gracias de antemano.\r\n\r\nSaludos cordiales,\r\n${bride} y ${groom}`;\r\n                      \r\n                      window.dispatchEvent(new CustomEvent('lovenda-compose', { \r\n                        detail: { \r\n                          to: detailProvider.email, \r\n                          subject: template.subject,\r\n                          body: emailBody\r\n                        } \r\n                      }));\r\n                      \r\n                      alert('Funcionalidad de buz√≥n temporalmente no disponible');\r\n                      setShowDetail(false);\r\n                    }}\r\n                  >\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6 text-purple-600 mb-1\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n                    </svg>\r\n                    <span className=\"text-xs\">Plantilla</span>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"flex justify-end gap-2 mt-4\">\r\n              <button className=\"px-4 py-2 bg-gray-200 rounded\" onClick={()=>setShowDetail(false)}>Cerrar</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      <div className=\"hidden\">\r\n        <table className=\"w-full table-auto\">\r\n          <thead>\r\n            <tr className=\"bg-gray-50\">\r\n              <th className=\"p-2\"><input type=\"checkbox\" /></th>\r\n              <th className=\"p-2\">Nombre</th>\r\n              <th className=\"p-2\">Servicio</th>\r\n              <th className=\"p-2\">Contacto</th>\r\n              <th className=\"p-2\">Email</th>\r\n              <th className=\"p-2\">Tel√©fono</th>\r\n              <th className=\"p-2\">Estado</th>\r\n              <th className=\"p-2\">Fecha</th>\r\n              <th className=\"p-2\">Valoraci√≥n</th>\r\n              <th className=\"p-2\">Acciones</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {displayed.map(p => (\r\n              <tr key={p.id} className=\"border-b\">\r\n                <td className=\"p-2\">\r\n                  <input type=\"checkbox\" checked={selected.includes(p.id)} onChange={() => toggleSelect(p.id)} />\r\n                </td>\r\n                <td className=\"p-2\">{p.link ? <a href={p.link} target=\"_blank\" rel=\"noreferrer\" className=\"text-blue-600 underline\">{p.name}</a> : p.name}</td>\r\n                <td className=\"p-2\">{p.service}</td>\r\n                <td className=\"p-2\">{p.contact}</td>\r\n                <td className=\"p-2\">{p.email}</td>\r\n                <td className=\"p-2\">{p.phone}</td>\r\n                <td className=\"p-2 cursor-pointer\">{p.status}</td>\r\n                <td className=\"p-2 cursor-pointer\">{p.date}</td>\r\n                <td className=\"p-2\">\r\n                  {[1,2,3,4,5].map(i => (\r\n                    <Star key={i} size={16} className=\"cursor-pointer\" color={i <= Math.round(p.rating) ? '#facc15' : '#e5e7eb'} onClick={() => rateProvider(p.id, i)} />\r\n                  ))}\r\n                  <span className=\"text-sm text-gray-600 ml-1\">({p.ratingCount})</span>\r\n                </td>\r\n                <td className=\"p-2 flex gap-2\">\r\n                  <Eye size={16} className=\"cursor-pointer text-gray-600\" onClick={() => openDetail(p)} />\r\n                  <Edit2 size={16} className=\"cursor-pointer text-blue-600\" />\r\n                  <Trash2 size={16} className=\"cursor-pointer text-red-600\" onClick={() => { setProviders(prev => prev.filter(x => x.id !== p.id)); setToast({ message: 'Proveedor eliminado', type: 'success' }); }} />\r\n                  <Calendar size={16} className=\"cursor-pointer text-green-600\" onClick={() => openResModal(p)} />\r\n                  <span className=\"text-sm text-gray-600 ml-1\">{reservations.filter(r => r.providerId === p.id).length}</span>\r\n                  <Download size={16} className=\"cursor-pointer text-purple-600\" />\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n      {/* Modal b√∫squeda proveedor */}\r\n      {showAiModal && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\" onClick={() => setShowAiModal(false)}>\r\n          <div className=\"bg-white w-full max-w-4xl h-[90vh] rounded shadow flex flex-col\" data-testid=\"ai-search-modal\" onClick={e => e.stopPropagation()}>\r\n            <div className=\"p-4 border-b flex justify-between items-center\">\r\n              <h2 className=\"text-xl font-semibold\">Buscar proveedor</h2>\r\n              <button className=\"text-gray-500 text-2xl leading-4\" onClick={() => setShowAiModal(false)}>&times;</button>\r\n            </div>\r\n            <div className=\"p-4 bg-gray-100\">\r\n              <form onSubmit={handleAiSearch} className=\"flex flex-wrap gap-2 items-center mb-4\">\r\n                <input type=\"text\" placeholder=\"Describe lo que buscas...\" value={aiQuery} onChange={e=>setAiQuery(e.target.value)} className=\"flex-1 border rounded px-2 py-1\" data-testid=\"open-ai-search\" />\r\n                <select value={serviceFilter} onChange={e=>setServiceFilter(e.target.value)} className=\"border rounded px-2 py-1\">\r\n                  <option value=\"\">Servicio...</option>\r\n                  <option>Catering</option>\r\n                  <option>Flores</option>\r\n                  <option>Fotograf√≠a</option>\r\n                  <option>M√∫sica</option>\r\n                  <option>Decoraci√≥n</option>\r\n                  <option>Vestidos</option>\r\n                  <option>Trajes</option>\r\n                  <option>Transporte</option>\r\n                  <option>Invitaciones</option>\r\n                  <option>Pasteles</option>\r\n                  <option>Joyer√≠a</option>\r\n                  <option>Detalles</option>\r\n                  <option>Animaci√≥n</option>\r\n                </select>\r\n                <select value={budgetRange} onChange={e=>setBudgetRange(e.target.value)} className=\"border rounded px-2 py-1\">\r\n                  <option value=\"\">Presupuesto...</option>\r\n                  <option>&lt; 1.000‚Ç¨</option>\r\n                  <option>1.000‚Ç¨ ‚Äì 3.000‚Ç¨</option>\r\n                  <option>3.000‚Ç¨ ‚Äì 6.000‚Ç¨</option>\r\n                  <option>&gt; 6.000‚Ç¨</option>\r\n                </select>\r\n                <button type=\"submit\" className=\"bg-blue-600 text-white px-3 py-1 rounded flex items-center\" data-testid=\"ai-search-button\">\r\n                  {aiLoading ? (\r\n                    <>\r\n                      <span className=\"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full mr-1\"></span>\r\n                      Buscando...\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <Search size={16} className=\"mr-1\"/>\r\n                      Buscar\r\n                    </>\r\n                  )}\r\n                </button>\r\n              </form>\r\n              \r\n              {/* Resultados de la b√∫squeda IA */}\r\n              {aiResults.length > 0 && (\r\n                <div className=\"pt-3 border-t border-gray-200\">\r\n                  <h3 className=\"font-semibold text-lg mb-3\">Resultados de b√∫squeda AI</h3>\r\n                  <div className=\"grid gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4\" data-testid=\"ai-results-list\">\r\n                    {aiResults.map((r, idx) => (\r\n                      <div key={idx} className=\"bg-white border rounded overflow-hidden shadow-sm hover:shadow-md transition-shadow cursor-pointer\" onClick={() => selectProvider(r)}>\r\n                        {r.image && <img src={r.image} alt={r.title} className=\"w-full h-32 object-cover\"/>}\r\n                        <div className=\"p-3\">\r\n                          <h4 className=\"font-medium text-blue-700 mb-1\">{r.name || r.title}</h4>\r\n                          {r.service && <p className=\"text-xs uppercase tracking-wide text-gray-500 mb-1\">{r.service}</p>}\r\n                          {r.location && <p className=\"text-xs text-gray-500 mb-1\"><MapPin size={12} className=\"inline mr-1\"/>{r.location}</p>}\r\n                          {r.priceRange && <p className=\"text-sm font-medium text-gray-700 mb-2\">{r.priceRange}</p>}\r\n                          {r.snippet && <p className=\"text-sm text-gray-600 line-clamp-3\">{r.snippet}</p>}\r\n                          <div className=\"mt-3 pt-2 border-t border-gray-100 flex justify-between items-center\">\r\n                            {r.link && <a href={r.link} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-xs text-blue-600 hover:underline font-semibold\" onClick={(e) => e.stopPropagation()}>Ver web</a>}\r\n                            <div className=\"flex gap-2\">\r\n                              <button onClick={(e) => {\r\n                                e.stopPropagation();\r\n                                // Abrir modal de composici√≥n de email con datos del proveedor\r\n                                const emailData = {\r\n                                  to: r.email || '',\r\n                                  subject: `Consulta sobre ${r.service || 'servicios'} - ${r.name || r.title}`,\r\n                                  body: `Hola,\\n\\nEstoy interesado en sus servicios de ${r.service || 'proveedor'} para mi boda.\\n\\n¬øPodr√≠an proporcionarme m√°s informaci√≥n sobre disponibilidad y precios?\\n\\nGracias,`\r\n                                };\r\n                                // Simular apertura de modal de email\r\n                                setToast({ message: 'Funcionalidad de email en desarrollo', type: 'info' });\r\n                              }} className=\"text-xs bg-blue-50 hover:bg-blue-100 text-blue-600 px-2 py-1 rounded\" data-testid=\"email-provider-btn\">\r\n                                Email\r\n                              </button>\r\n                              <button onClick={(e) => {\r\n                                e.stopPropagation();\r\n                                setProviders(prev => [...prev, { \r\n                                  id: `web-${Date.now()}`, \r\n                                  name: r.title, \r\n                                  service: r.service || servicioSeleccionado,\r\n                                  contact: '',\r\n                                  email: '',\r\n                                  phone: '',\r\n                                  link: r.link, \r\n                                  status: 'Nuevo',\r\n                                  location: r.location || '',\r\n                                  date: new Date().toISOString().slice(0,10), \r\n                                  rating: 0, \r\n                                  ratingCount: 0, \r\n                                  snippet: r.snippet || '',\r\n                                  priceRange: r.priceRange || ''\r\n                                }]);\r\n                                setToast({ message: 'Proveedor a√±adido a la lista', type: 'success' });\r\n                              }} className=\"text-xs bg-green-50 hover:bg-green-100 text-green-600 px-2 py-1 rounded\">\r\n                                A√±adir\r\n                              </button>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n              \r\n              {/* Estado de carga y mensajes */}\r\n              {aiLoading && aiResults.length === 0 && (\r\n                <div className=\"flex flex-col items-center justify-center py-8\">\r\n                  <div className=\"animate-spin h-8 w-8 border-4 border-blue-600 border-t-transparent rounded-full mb-3\"></div>\r\n                  <p className=\"text-gray-600\">Buscando los mejores proveedores para ti...</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n\r\n      {/* Modal Configuraci√≥n de Servicios */}\r\n      {showServiceConfig && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\" onClick={() => setShowServiceConfig(false)}>\r\n          <div className=\"bg-white w-full max-w-2xl p-6 rounded shadow space-y-4 max-h-[90vh] overflow-auto\" onClick={e => e.stopPropagation()}>\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n              <h2 className=\"text-xl font-semibold\">Configurar Servicios</h2>\r\n              <button className=\"text-gray-500 text-2xl leading-4\" onClick={() => setShowServiceConfig(false)}>&times;</button>\r\n            </div>\r\n            \r\n            <div className=\"space-y-4\">\r\n              {wantedServices.map(service => (\r\n                <div key={service.id} className=\"flex items-center justify-between p-3 border rounded\">\r\n                  <div className=\"flex-1\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <input\r\n                        type=\"text\"\r\n                        value={service.name}\r\n                        onChange={e => updateWantedService(service.id, { name: e.target.value })}\r\n                        className=\"font-medium border-none outline-none\"\r\n                      />\r\n                      <label className=\"flex items-center gap-1 text-sm\">\r\n                        <input\r\n                          type=\"checkbox\"\r\n                          checked={service.required}\r\n                          onChange={e => updateWantedService(service.id, { required: e.target.checked })}\r\n                        />\r\n                        Esencial\r\n                      </label>\r\n                    </div>\r\n                    <div className=\"mt-2\">\r\n                      <label className=\"text-sm text-gray-600\">Presupuesto estimado:</label>\r\n                      <input\r\n                        type=\"number\"\r\n                        value={service.budget}\r\n                        onChange={e => updateWantedService(service.id, { budget: Number(e.target.value) })}\r\n                        className=\"ml-2 w-20 px-2 py-1 border rounded text-sm\"\r\n                        placeholder=\"0\"\r\n                      />\r\n                      <span className=\"text-sm text-gray-600 ml-1\">‚Ç¨</span>\r\n                    </div>\r\n                  </div>\r\n                  <button\r\n                    onClick={() => removeWantedService(service.id)}\r\n                    className=\"text-red-500 hover:text-red-700 ml-4\"\r\n                  >\r\n                    <Trash2 size={16} />\r\n                  </button>\r\n                </div>\r\n              ))}\r\n            </div>\r\n            \r\n            <div className=\"flex gap-2 pt-4 border-t\">\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"Nuevo servicio...\"\r\n                className=\"flex-1 px-3 py-2 border rounded\"\r\n                onKeyPress={e => {\r\n                  if (e.key === 'Enter' && e.target.value.trim()) {\r\n                    addWantedService(e.target.value.trim());\r\n                    e.target.value = '';\r\n                  }\r\n                }}\r\n              />\r\n              <Button \r\n                onClick={e => {\r\n                  const input = e.target.parentElement.querySelector('input');\r\n                  if (input.value.trim()) {\r\n                    addWantedService(input.value.trim());\r\n                    input.value = '';\r\n                  }\r\n                }}\r\n              >\r\n                A√±adir\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Modal A√±adir Proveedor */}\r\n      {showAddModal && (\r\n        <div className=\"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50\">\r\n          <div className=\"bg-white p-4 rounded shadow w-96\">\r\n            <h2 className=\"text-lg font-semibold mb-4\">A√±adir Proveedor</h2>\r\n            <form onSubmit={handleAddProvider} className=\"space-y-3\">\r\n              <input type=\"text\" placeholder=\"Nombre\" value={newProvider.name} onChange={e => setNewProvider({ ...newProvider, name: e.target.value })} className=\"w-full border rounded px-2 py-1\" required />\r\n              <input type=\"text\" placeholder=\"Servicio\" value={newProvider.service} onChange={e => setNewProvider({ ...newProvider, service: e.target.value })} className=\"w-full border rounded px-2 py-1\" required />\r\n              <input type=\"text\" placeholder=\"Contacto\" value={newProvider.contact} onChange={e => setNewProvider({ ...newProvider, contact: e.target.value })} className=\"w-full border rounded px-2 py-1\" />\r\n              <input type=\"email\" placeholder=\"Email\" value={newProvider.email} onChange={e => setNewProvider({ ...newProvider, email: e.target.value })} className=\"w-full border rounded px-2 py-1\" />\r\n              <input type=\"tel\" placeholder=\"Tel√©fono\" value={newProvider.phone} onChange={e => setNewProvider({ ...newProvider, phone: e.target.value })} className=\"w-full border rounded px-2 py-1\" />\r\n              <select value={newProvider.status} onChange={e => setNewProvider({ ...newProvider, status: e.target.value })} className=\"w-full border rounded px-2 py-1\">\r\n                <option value=\"\">Seleccionar estado</option>\r\n                <option value=\"Contactado\">Contactado</option>\r\n                <option value=\"Confirmado\">Confirmado</option>\r\n                <option value=\"Pendiente\">Pendiente</option>\r\n              </select>\r\n              <input type=\"date\" value={newProvider.date} onChange={e => setNewProvider({ ...newProvider, date: e.target.value })} className=\"w-full border rounded px-2 py-1\" />\r\n              <div className=\"flex justify-end gap-2\">\r\n                <button type=\"button\" onClick={() => setShowAddModal(false)} className=\"px-4 py-2 bg-gray-200 rounded\">Cancelar</button>\r\n                <button type=\"submit\" className=\"px-4 py-2 bg-blue-600 text-white rounded\">Guardar</button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      \r\n      {/* Modal para reserva */}\r\n      {showResModal && providerToReserve && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50\">\r\n          <div className=\"bg-white rounded-lg p-6 w-full max-w-md\">\r\n            <h3 className=\"text-xl font-semibold mb-4\">Reservar con {providerToReserve.name}</h3>\r\n            \r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Fecha</label>\r\n                <input \r\n                  type=\"date\" \r\n                  value={resDate}\r\n                  onChange={e => setResDate(e.target.value)}\r\n                  className=\"w-full border rounded px-3 py-2\"\r\n                />\r\n              </div>\r\n              \r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Hora</label>\r\n                <input \r\n                  type=\"time\" \r\n                  value={resTime}\r\n                  onChange={e => setResTime(e.target.value)}\r\n                  className=\"w-full border rounded px-3 py-2\"\r\n                />\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"flex justify-end gap-2 mt-6\">\r\n              <button \r\n                className=\"px-4 py-2 bg-gray-200 rounded\" \r\n                onClick={() => setShowResModal(false)}\r\n              >\r\n                Cancelar\r\n              </button>\r\n              <button \r\n                className=\"px-4 py-2 bg-blue-600 text-white rounded\" \r\n                onClick={confirmReservation}\r\n              >\r\n                Confirmar Reserva\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      \r\n      {/* Modal para gestionar seguimiento */}\r\n      {showTrackingModal && currentTracking && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50\">\r\n          <div className=\"bg-white rounded-lg p-6 w-full max-w-3xl max-h-[90vh] overflow-auto\">\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n              <h3 className=\"text-xl font-semibold\">Seguimiento: {currentTracking.providerName}</h3>\r\n              <button \r\n                onClick={() => setShowTrackingModal(false)}\r\n                className=\"text-gray-500 hover:text-gray-700\"\r\n              >\r\n                √ó\r\n              </button>\r\n            </div>\r\n            \r\n            {/* Estado actual y acciones r√°pidas */}\r\n            <div className=\"mb-6 p-3 bg-gray-50 rounded-lg\">\r\n              <h4 className=\"text-sm font-medium text-gray-700 mb-2\">Estado actual</h4>\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                {Object.values(TRACKING_STATUS).map(status => (\r\n                  <button\r\n                    key={status}\r\n                    onClick={() => updateTrackingStatusHandler(currentTracking.id, status)}\r\n                    className={`px-3 py-1.5 text-xs rounded-full flex items-center ${currentTracking.status === status ? \r\n                      (status === TRACKING_STATUS.URGENT ? 'bg-red-600 text-white' : \r\n                       status === TRACKING_STATUS.WAITING ? 'bg-amber-500 text-white' :\r\n                       status === TRACKING_STATUS.RESPONDED ? 'bg-green-600 text-white' :\r\n                       status === TRACKING_STATUS.FOLLOWUP ? 'bg-blue-600 text-white' :\r\n                       'bg-gray-600 text-white') : \r\n                      'bg-gray-100 text-gray-700'}`}\r\n                  >\r\n                    {status === TRACKING_STATUS.URGENT && <AlertTriangle size={12} className=\"mr-1\" />}\r\n                    {status === TRACKING_STATUS.WAITING && <Clock size={12} className=\"mr-1\" />}\r\n                    {status === TRACKING_STATUS.RESPONDED && <Eye size={12} className=\"mr-1\" />}\r\n                    {status === TRACKING_STATUS.FOLLOWUP && <RefreshCcw size={12} className=\"mr-1\" />}\r\n                    {status === TRACKING_STATUS.COMPLETED && <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-3 w-3 mr-1\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n                    </svg>}\r\n                    {status === TRACKING_STATUS.URGENT ? 'Urgente' :\r\n                     status === TRACKING_STATUS.WAITING ? 'Esperando' :\r\n                     status === TRACKING_STATUS.RESPONDED ? 'Respondido' :\r\n                     status === TRACKING_STATUS.FOLLOWUP ? 'Seguimiento' :\r\n                     status === TRACKING_STATUS.COMPLETED ? 'Completado' :\r\n                     status}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Detalles del proveedor */}\r\n            <div className=\"mb-6\">\r\n              <h4 className=\"text-sm font-medium text-gray-700 mb-2\">Informaci√≥n del proveedor</h4>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 p-3 border rounded-lg\">\r\n                <div>\r\n                  <p><span className=\"font-medium\">Nombre:</span> {currentTracking.providerName}</p>\r\n                  <p><span className=\"font-medium\">Email:</span> {currentTracking.providerEmail}</p>\r\n                  <p><span className=\"font-medium\">√öltimo contacto:</span> {new Date(currentTracking.lastEmailDate).toLocaleDateString()}</p>\r\n                </div>\r\n                <div>\r\n                  <p><span className=\"font-medium\">Asunto:</span> {currentTracking.subject}</p>\r\n                  {currentTracking.dueDate && <p><span className=\"font-medium\">Fecha l√≠mite:</span> {new Date(currentTracking.dueDate).toLocaleDateString()}</p>}\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Historial de comunicaciones */}\r\n            {currentTracking.thread && currentTracking.thread.length > 0 && (\r\n              <div className=\"mb-6\">\r\n                <h4 className=\"text-sm font-medium text-gray-700 mb-2\">Historial de comunicaciones</h4>\r\n                <div className=\"space-y-2 max-h-[200px] overflow-auto p-3 border rounded-lg\">\r\n                  {currentTracking.thread.map((item, idx) => (\r\n                    <div key={idx} className={`p-2 rounded-lg ${item.direction === 'outgoing' ? 'bg-blue-50 border-l-4 border-blue-400' : 'bg-green-50 border-l-4 border-green-400'}`}>\r\n                      <p className=\"text-xs text-gray-500\">{new Date(item.date).toLocaleString()}</p>\r\n                      <p className=\"text-sm font-medium\">{item.subject}</p>\r\n                      {item.snippet && <p className=\"text-sm text-gray-700\">{item.snippet}</p>}\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            {/* Notas */}\r\n            <div className=\"mb-6\">\r\n              <h4 className=\"text-sm font-medium text-gray-700 mb-2\">Notas de seguimiento</h4>\r\n              <textarea \r\n                className=\"w-full border rounded-lg p-3 min-h-[100px]\"\r\n                placeholder=\"A√±ade notas sobre este proveedor...\"\r\n                value={currentTracking.notes || ''}\r\n                onChange={(e) => {\r\n                  setCurrentTracking({...currentTracking, notes: e.target.value});\r\n                  // Actualizar notas del registro\r\n                  updateTrackingStatus(currentTracking.id, currentTracking.status, e.target.value);\r\n                }}\r\n              />\r\n            </div>\r\n            \r\n            {/* Acciones finales */}\r\n            <div className=\"flex justify-between\">\r\n              <div>\r\n                <button \r\n                  className=\"px-4 py-2 text-red-600 hover:bg-red-50 rounded border border-red-200\"\r\n                  onClick={() => {\r\n                    // Eliminar seguimiento (implementar esta funci√≥n)\r\n                    // deleteTrackingRecord(currentTracking.id);\r\n                    setShowTrackingModal(false);\r\n                    setToast({ message: 'Seguimiento eliminado', type: 'info' });\r\n                  }}\r\n                >\r\n                  Eliminar seguimiento\r\n                </button>\r\n              </div>\r\n              \r\n              <div className=\"flex gap-2\">\r\n                <button \r\n                  className=\"px-4 py-2 bg-amber-500 text-white rounded flex items-center\"\r\n                  onClick={() => {\r\n                    // Actualizar fecha l√≠mite para fecha actual + 3 d√≠as\r\n                    const dueDate = new Date();\r\n                    dueDate.setDate(dueDate.getDate() + 3);\r\n                    const newTracking = {...currentTracking, dueDate};\r\n                    updateTrackingStatus(currentTracking.id, currentTracking.status, currentTracking.notes, dueDate);\r\n                    setCurrentTracking(newTracking);\r\n                    setToast({ message: 'Fecha l√≠mite actualizada', type: 'success' });\r\n                  }}\r\n                >\r\n                  <Calendar size={16} className=\"mr-1\" />\r\n                  Recordatorio (3 d√≠as)\r\n                </button>\r\n                \r\n                <button \r\n                  onClick={() => setShowTrackingModal(false)}\r\n                  className=\"px-4 py-2 bg-blue-600 text-white rounded\"\r\n                >\r\n                  Aceptar\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </PageWrapper>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\ProveedoresNuevo.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'aiResults' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":59,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":59,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'clearResults' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":62,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":62,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'trackingFilter' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":75,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":75,"endColumn":24},{"ruleId":"no-unused-vars","severity":1,"message":"'setTrackingFilter' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":75,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":75,"endColumn":43},{"ruleId":"no-unused-vars","severity":1,"message":"'handleReserveProvider' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":98,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":98,"endColumn":30},{"ruleId":"no-unused-vars","severity":1,"message":"'handleDeleteProvider' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":134,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":134,"endColumn":29},{"ruleId":"no-undef","severity":2,"message":"'addReservation' is not defined.","line":148,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":148,"endColumn":27},{"ruleId":"no-unused-vars","severity":1,"message":"'handleViewTrackingDetails' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":159,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":159,"endColumn":34}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport MainLayout from '../components/layout/MainLayout';\r\nimport Card from '../components/Card';\r\nimport Button from '../components/Button';\r\nimport { Plus, Sparkles } from 'lucide-react';\r\n\r\n// Importar componentes modulares\r\nimport ProveedorList from '../components/proveedores/ProveedorList';\r\nimport ProveedorDetail from '../components/proveedores/ProveedorDetail';\r\nimport ProveedorCard from '../components/proveedores/ProveedorCard';\r\nimport ProveedorForm from '../components/proveedores/ProveedorForm';\r\nimport ReservationModal from '../components/proveedores/ReservationModal';\r\nimport AISearchModal from '../components/proveedores/ai/AISearchModal';\r\n\r\nimport TrackingModal from '../components/proveedores/tracking/TrackingModal';\r\n\r\n// Importar hooks personalizados\r\nimport useProveedores from '../hooks/useProveedores';\r\nimport useAISearch from '../hooks/useAISearch';\r\nimport { useAuth } from '../hooks/useAuthUnified';\r\n\r\nconst Proveedores = () => {\r\n  // Diagn√≥stico: verificar que la versi√≥n nueva se carga en el navegador\r\n  console.log('%c[Lovenda] ProveedoresNuevo cargado', 'color: #10B981; font-weight: bold;');\r\n  // Obtener funcionalidad de los hooks personalizados\r\n  const {\r\n    providers,\r\n    filteredProviders,\r\n    loading,\r\n    error,\r\n    selectedProvider,\r\n    selectedProviderIds,\r\n    searchTerm,\r\n    serviceFilter,\r\n    statusFilter,\r\n    dateFrom,\r\n    dateTo,\r\n    ratingMin,\r\n    tab,\r\n    setSearchTerm,\r\n    setServiceFilter,\r\n    setStatusFilter,\r\n    setDateFrom,\r\n    setDateTo,\r\n    setRatingMin,\r\n    setTab,\r\n    setSelectedProvider,\r\n    loadProviders,\r\n    addProvider,\r\n    updateProvider,\r\n    deleteProvider,\r\n    toggleFavoriteProvider,\r\n    toggleSelectProvider,\r\n    clearSelection,\r\n    clearFilters\r\n  } = useProveedores();\r\n\r\n  const {\r\n    results: aiResults,\r\n    loading: aiLoading,\r\n    searchProviders,\r\n    clearResults\r\n  } = useAISearch();\r\n\r\n  const { user } = useAuth();\r\n\r\n  // Estado local para modales y pesta√±as\r\n  const [showNewProviderForm, setShowNewProviderForm] = useState(false);\r\n  const [showEditProviderForm, setShowEditProviderForm] = useState(false);\r\n  const [showAISearchModal, setShowAISearchModal] = useState(false);\r\n  const [showReservationModal, setShowReservationModal] = useState(false);\r\n  const [showTrackingModal, setShowTrackingModal] = useState(false);\r\n  const [activeTab, setActiveTab] = useState('info');\r\n  const [currentTrackingItem, setCurrentTrackingItem] = useState(null);\r\n  const [trackingFilter, setTrackingFilter] = useState('todos');\r\n\r\n  // Cargar datos iniciales\r\n  useEffect(() => {\r\n    if (user) {\r\n      loadProviders();\r\n    }\r\n  }, [user, loadProviders]);\r\n\r\n  // Funciones para manejar la visualizaci√≥n de modales\r\n  const handleViewDetail = (provider) => {\r\n    setSelectedProvider(provider);\r\n    setActiveTab('info');\r\n  };\r\n\r\n  const handleNewProvider = () => {\r\n    setShowNewProviderForm(true);\r\n  };\r\n\r\n  const handleEditProvider = () => {\r\n    setShowEditProviderForm(true);\r\n  };\r\n\r\n  const handleReserveProvider = (provider) => {\r\n    setSelectedProvider(provider);\r\n    setShowReservationModal(true);\r\n  };\r\n\r\n  const handleCloseDetail = () => {\r\n    setSelectedProvider(null);\r\n  };\r\n\r\n  const handleOpenAISearch = () => {\r\n    setShowAISearchModal(true);\r\n  };\r\n\r\n  const handleAISelect = (provider, action) => {\r\n    if (action === 'view') {\r\n      setSelectedProvider(provider);\r\n      setShowAISearchModal(false);\r\n    } else if (action === 'add') {\r\n      addProvider(provider);\r\n      setShowAISearchModal(false);\r\n    } else if (action === 'select') {\r\n      addProvider({...provider, status: 'Seleccionado'});\r\n      setShowAISearchModal(false);\r\n    }\r\n  };\r\n\r\n  const handleSubmitProvider = async (providerData) => {\r\n    if (showEditProviderForm && selectedProvider) {\r\n      await updateProvider(selectedProvider.id, providerData);\r\n      setShowEditProviderForm(false);\r\n    } else {\r\n      await addProvider(providerData);\r\n      setShowNewProviderForm(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteProvider = async (providerId) => {\r\n    if (window.confirm('¬øEst√°s seguro de que deseas eliminar este proveedor?')) {\r\n      await deleteProvider(providerId);\r\n    }\r\n  };\r\n\r\n  const handleSubmitReservation = async (reservationData) => {\r\n    // En una implementaci√≥n real, esto guardar√≠a la reserva en la base de datos\r\n    console.log('Reserva creada:', reservationData);\r\n    // Actualizar el estado del proveedor a 'Contactado' si no est√° ya confirmado/seleccionado\r\n    if (selectedProvider && \r\n        selectedProvider.status !== 'Confirmado' && \r\n        selectedProvider.status !== 'Seleccionado') {\r\n      // Guardar reserva en Firestore y estado local\r\n      await addReservation(selectedProvider.id, reservationData);\r\n\r\n      await updateProvider(selectedProvider.id, { \r\n        ...selectedProvider, \r\n        status: 'Contactado',\r\n        date: reservationData.date\r\n      });\r\n    }\r\n    setShowReservationModal(false);\r\n  };\r\n\r\n  const handleViewTrackingDetails = (trackingItem) => {\r\n    setCurrentTrackingItem(trackingItem);\r\n    setShowTrackingModal(true);\r\n  };\r\n\r\n  return (\r\n    <MainLayout>\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <div className=\"flex justify-between items-center mb-6\">\r\n          <h1 className=\"text-2xl font-bold\">Gesti√≥n de Proveedores</h1>\r\n          \r\n          <div className=\"flex space-x-2\">\r\n            <Button onClick={handleOpenAISearch} className=\"flex items-center\">\r\n              <Sparkles size={16} className=\"mr-1\" /> B√∫squeda IA\r\n            </Button>\r\n            <Button onClick={handleNewProvider} className=\"flex items-center\">\r\n              <Plus size={16} className=\"mr-1\" /> Nuevo Proveedor\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        {error && (\r\n          <Card className=\"mb-6 bg-red-50 border border-red-200\">\r\n            <p className=\"text-red-700\">{error}</p>\r\n          </Card>\r\n        )}\r\n\r\n        {loading ? (\r\n          <Card className=\"p-8 text-center\">\r\n            <p className=\"text-gray-500\">Cargando proveedores...</p>\r\n          </Card>\r\n        ) : (\r\n          <div className=\"grid grid-cols-1 gap-6\">\r\n            {/* Lista de proveedores con filtros */}\r\n            <ProveedorList\r\n              providers={filteredProviders}\r\n              searchTerm={searchTerm}\r\n              setSearchTerm={setSearchTerm}\r\n              serviceFilter={serviceFilter}\r\n              setServiceFilter={setServiceFilter}\r\n              statusFilter={statusFilter}\r\n              setStatusFilter={setStatusFilter}\r\n              dateFrom={dateFrom}\r\n              setDateFrom={setDateFrom}\r\n              dateTo={dateTo}\r\n              setDateTo={setDateTo}\r\n              ratingMin={ratingMin}\r\n              setRatingMin={setRatingMin}\r\n              clearFilters={clearFilters}\r\n              handleViewDetail={handleViewDetail}\r\n              tab={tab}\r\n              setTab={setTab}\r\n              selected={selectedProviderIds}\r\n              toggleSelect={toggleSelectProvider}\r\n              toggleFavorite={toggleFavoriteProvider}\r\n            />\r\n\r\n            {/* Acciones con proveedores seleccionados */}\r\n            {selectedProviderIds.length > 0 && (\r\n              <Card className=\"bg-blue-50 border border-blue-100\">\r\n                <div className=\"flex justify-between items-center\">\r\n                  <p className=\"text-blue-800\">\r\n                    {selectedProviderIds.length} {selectedProviderIds.length === 1 ? 'proveedor seleccionado' : 'proveedores seleccionados'}\r\n                  </p>\r\n                  <div className=\"flex space-x-2\">\r\n                    <Button variant=\"outline\" size=\"sm\" onClick={clearSelection}>\r\n                      Deseleccionar todo\r\n                    </Button>\r\n                    <Button size=\"sm\">\r\n                      Acci√≥n masiva\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              </Card>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Vista detallada de proveedor */}\r\n        {selectedProvider && (\r\n          <ProveedorDetail\r\n            provider={selectedProvider}\r\n            onClose={handleCloseDetail}\r\n            onEdit={handleEditProvider}\r\n            activeTab={activeTab}\r\n            setActiveTab={setActiveTab}\r\n          />\r\n        )}\r\n\r\n        {/* Modal para a√±adir nuevo proveedor */}\r\n        {showNewProviderForm && (\r\n          <div className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4\">\r\n            <ProveedorForm\r\n              onSubmit={handleSubmitProvider}\r\n              onCancel={() => setShowNewProviderForm(false)}\r\n            />\r\n          </div>\r\n        )}\r\n\r\n        {/* Modal para editar proveedor */}\r\n        {showEditProviderForm && selectedProvider && (\r\n          <div className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4\">\r\n            <ProveedorForm\r\n              initialData={selectedProvider}\r\n              onSubmit={handleSubmitProvider}\r\n              onCancel={() => setShowEditProviderForm(false)}\r\n            />\r\n          </div>\r\n        )}\r\n\r\n        {/* Modal de b√∫squeda con IA */}\r\n        <AISearchModal\r\n          isOpen={showAISearchModal}\r\n          onClose={() => setShowAISearchModal(false)}\r\n          onSearch={searchProviders}\r\n          onSelect={handleAISelect}\r\n          isLoading={aiLoading}\r\n        />\r\n\r\n        {/* Modal de reserva */}\r\n        {showReservationModal && selectedProvider && (\r\n          <ReservationModal\r\n            provider={selectedProvider}\r\n            onClose={() => setShowReservationModal(false)}\r\n            onSubmit={handleSubmitReservation}\r\n          />\r\n        )}\r\n\r\n        {/* Modal de seguimiento */}\r\n        {showTrackingModal && currentTrackingItem && (\r\n          <TrackingModal\r\n            isOpen={showTrackingModal}\r\n            onClose={() => setShowTrackingModal(false)}\r\n            trackingItem={currentTrackingItem}\r\n          />\r\n        )}\r\n\r\n        {/* Proveedores seleccionados */}\r\n        {selectedProviderIds.length > 0 && (\r\n          <div className=\"mt-12\">\r\n            <h2 className=\"text-xl font-semibold mb-4\">Proveedores seleccionados</h2>\r\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\r\n              {selectedProviderIds.map(pid => {\r\n                const provider = providers.find(p => p.id === pid);\r\n                if(!provider) return null;\r\n                return (\r\n                  <ProveedorCard\r\n                    key={pid}\r\n                    provider={provider}\r\n                    isSelected={true}\r\n                    onToggleSelect={() => toggleSelectProvider(pid)}\r\n                    onViewDetail={() => handleViewDetail(provider)}\r\n                    onToggleFavorite={toggleFavoriteProvider}\r\n                  />\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </MainLayout>\r\n  );\r\n};\r\n\r\nexport default Proveedores;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\RSVPConfirm.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\Signup.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\Tasks.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\UnifiedEmail.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'from' is defined but never used. Allowed unused args must match /^_/u.","line":272,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":272,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState, useCallback } from \"react\";\r\nimport UsernameWizard from \"../components/UsernameWizard\";\r\nimport useEmailUsername from \"../hooks/useEmailUsername\";\r\nimport Button from \"../components/ui/Button\";\r\nimport { auth } from \"../lib/firebase\";\r\nimport { onAuthStateChanged } from \"firebase/auth\";\r\nimport Spinner from \"../components/ui/Spinner\";\r\nimport Alert from \"../components/ui/Alert\";\r\nimport { getMails, initEmailService, markAsRead, deleteMail, sendMail } from \"../services/emailService\";\r\nimport EmailInsights from \"../components/EmailInsights\";\r\n\r\n/**\r\n * P√°gina principal de Buz√≥n (correo interno @mywed360.com)\r\n * Incluye: Sidebar de carpetas, lista de correos, visor del correo y modal para redactar.\r\n * Email backend:\r\n *  - GET  /getMailgunEvents  -> lista de eventos (funci√≥n Cloud)\r\n *  - POST /sendEmail        -> env√≠a correo (funci√≥n Cloud)\r\n */\r\nconst UnifiedEmail = () => {\r\n  const { getCurrentUsername } = useEmailUsername();\r\n  const [myEmail, setMyEmail] = useState(null);\r\n  const [emails, setEmails] = useState([]);\r\n  const [selected, setSelected] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [showCompose, setShowCompose] = useState(false);\r\n  const [folder, setFolder] = useState(\"inbox\"); // inbox | sent\r\n\r\n\r\n\r\n  const fetchEmails = useCallback(async () => {\r\n    if (!myEmail) return;\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const mails = await getMails(folder === \"sent\" ? \"sent\" : \"inbox\");\r\n      if (Array.isArray(mails)) {\r\n        setEmails(mails);\r\n      } else {\r\n        console.warn(\"Respuesta inesperada de getMails\", mails);\r\n        setEmails([]);\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Error cargando correos:\", err);\r\n      setError(\"No se pudieron cargar los correos\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [myEmail, folder]);\r\n\r\n  // Obtener email del usuario en cuanto Firebase est√© listo\r\n  useEffect(() => {\r\n    const unsub = onAuthStateChanged(auth, async (user) => {\r\n      if (!user) return;\r\n\r\n      // 1Ô∏è‚É£ Intentamos obtener el nombre de usuario personalizado\r\n      const username = await getCurrentUsername();\r\n      let resolvedEmail;\r\n\r\n      if (username) {\r\n        // Caso ideal: el usuario ya tiene nombre configurado ‚Üí nombre@mywed360.com\r\n        resolvedEmail = `${username}@mywed360.com`;\r\n        await initEmailService({\r\n          uid: user.uid,\r\n          emailUsername: username,\r\n          myWed360Email: resolvedEmail,\r\n          email: user.email,\r\n        });\r\n      } else {\r\n        // Fallback: usamos el email autenticado (ej. foo@gmail.com)\r\n        resolvedEmail = user.email;\r\n        await initEmailService({\r\n          uid: user.uid,\r\n          email: user.email,\r\n        });\r\n      }\r\n\r\n      // Guardamos el email resuelto para activar la carga de correos\r\n      setMyEmail(resolvedEmail);\r\n    });\r\n    return () => unsub();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  // Carga inicial + polling (se reinicia al cambiar carpeta)\r\n  useEffect(() => {\r\n    if (!myEmail) return;\r\n    fetchEmails();\r\n    const id = setInterval(fetchEmails, 60000);\r\n    return () => clearInterval(id);\r\n  }, [fetchEmails, myEmail, folder]);\r\n\r\n  const handleMarkRead = async (mail) => {\r\n    try {\r\n      await markAsRead(mail.id);\r\n      // Actualizar lista localmente\r\n      setEmails(prev => prev.map(m => m.id === mail.id ? { ...m, read: true } : m));\r\n      setSelected(prev => prev ? { ...prev, read: true } : prev);\r\n    } catch (err) {\r\n      console.error('Error marcando le√≠do:', err);\r\n      alert('No se pudo marcar como le√≠do');\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (mail) => {\r\n    try {\r\n      await deleteMail(mail.id);\r\n      // Quitar de lista local\r\n      setEmails(prev => prev.filter(m => m.id !== mail.id));\r\n      setSelected(null);\r\n    } catch (err) {\r\n      console.error('Error eliminando correo:', err);\r\n      alert('No se pudo eliminar el correo');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex h-full w-full flex-col\">\r\n      {/* Wizard para elegir nombre si es la primera vez */}\r\n      <UsernameWizard />\r\n\r\n      {/* Barra superior */}\r\n      <header className=\"flex items-center justify-between border-b p-4\">\r\n        <h1 className=\"text-lg font-semibold\">Buz√≥n</h1>\r\n        <Button variant=\"primary\" onClick={() => setShowCompose(true)}>\r\n          Redactar\r\n        </Button>\r\n      </header>\r\n\r\n      {/* Contenido principal */}\r\n      <div className=\"flex flex-1 overflow-hidden\">\r\n        {/* Sidebar de carpetas */}\r\n        <aside className=\"w-48 border-r bg-gray-50 p-4\">\r\n          <nav className=\"space-y-2\">\r\n            <button\r\n              className={`block w-full rounded px-3 py-2 text-left text-sm ${\r\n                folder === \"inbox\"\r\n                  ? \"bg-blue-100 text-blue-700\"\r\n                  : \"text-gray-700 hover:bg-gray-100\"\r\n              }`}\r\n              onClick={() => setFolder(\"inbox\")}\r\n            >\r\n              üì• Recibidos\r\n            </button>\r\n            <button\r\n              className={`block w-full rounded px-3 py-2 text-left text-sm ${\r\n                folder === \"sent\"\r\n                  ? \"bg-blue-100 text-blue-700\"\r\n                  : \"text-gray-700 hover:bg-gray-100\"\r\n              }`}\r\n              onClick={() => setFolder(\"sent\")}\r\n            >\r\n              üì§ Enviados\r\n            </button>\r\n          </nav>\r\n        </aside>\r\n\r\n        {/* Lista de correos */}\r\n        <div className=\"w-80 border-r\">\r\n          <MailList emails={emails} onSelect={setSelected} selected={selected} />\r\n          {loading && (\r\n            <div className=\"flex items-center justify-center p-4\">\r\n              <Spinner size=\"sm\" />\r\n            </div>\r\n          )}\r\n          {error && (\r\n            <Alert variant=\"error\" className=\"m-4\">\r\n              {error}\r\n            </Alert>\r\n          )}\r\n        </div>\r\n\r\n        {/* Visor del correo */}\r\n        <main className=\"flex-1 p-6\">\r\n          {selected ? (\r\n            <MailViewer\r\n              mail={selected}\r\n              onMarkRead={handleMarkRead}\r\n              onDelete={handleDelete}\r\n            />\r\n          ) : (\r\n            <div className=\"flex h-full items-center justify-center text-gray-500\">\r\n              Selecciona un correo para verlo aqu√≠\r\n            </div>\r\n          )}\r\n        </main>\r\n      </div>\r\n\r\n      {/* Modal de redactar */}\r\n      {showCompose && (\r\n        <ComposeModal onClose={() => setShowCompose(false)} from={myEmail} />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\n/**\r\n * Lista lateral de correos sencillos.\r\n */\r\nconst MailList = ({ emails, onSelect, selected }) => {\r\n  return (\r\n    <div className=\"h-full overflow-y-auto\">\r\n      {emails.length === 0 ? (\r\n        <p className=\"p-4 text-sm text-gray-500\">No hay correos</p>\r\n      ) : (\r\n        emails.map((mail) => (\r\n          <div\r\n            key={mail.id}\r\n            className={`cursor-pointer border-b p-3 hover:bg-gray-50 ${\r\n              selected?.id === mail.id ? \"bg-blue-50\" : \"\"\r\n            } ${!mail.read ? \"font-semibold\" : \"\"}`}\r\n            onClick={() => onSelect(mail)}\r\n          >\r\n            <div className=\"text-sm\">{mail.subject || \"(Sin asunto)\"}</div>\r\n            <div className=\"text-xs text-gray-500\">\r\n              {mail.sender || mail.from}\r\n            </div>\r\n          </div>\r\n        ))\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\n/**\r\n * Visor del correo seleccionado\r\n */\r\nconst MailViewer = ({ mail, onMarkRead, onDelete }) => {\r\n  const handleMark = () => {\r\n    onMarkRead(mail);\r\n  };\r\n\r\n  const handleDelete = () => {\r\n    if (onDelete && window.confirm(\"¬øBorrar este correo?\")) {\r\n      onDelete(mail);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"prose max-w-none\">\r\n      {/* Encabezado con acciones */}\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h2 className=\"m-0\">{mail.subject || \"(Sin asunto)\"}</h2>\r\n        <div className=\"flex gap-2\">\r\n          {!mail.read && (\r\n            <Button size=\"sm\" onClick={handleMark}>\r\n              Marcar le√≠do\r\n            </Button>\r\n          )}\r\n          <Button size=\"sm\" variant=\"danger\" onClick={handleDelete}>\r\n            Borrar\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      <p className=\"text-sm text-gray-500 mb-4\">\r\n        De: {mail.sender || mail.from} ‚Äî Para: {mail.recipient || mail.to}\r\n      </p>\r\n\r\n      <div\r\n        dangerouslySetInnerHTML={{ __html: mail.body || \"Sin contenido.\" }}\r\n      />\r\n\r\n      <EmailInsights mailId={mail.id} />\r\n    </div>\r\n  );\r\n};\r\n\r\n/**\r\n * Modal para redactar y enviar correos\r\n */\r\nconst ComposeModal = ({ onClose, from }) => {\r\n  const [to, setTo] = useState(\"\");\r\n  const [subject, setSubject] = useState(\"\");\r\n  const [body, setBody] = useState(\"\");\r\n  const [sending, setSending] = useState(false);\r\n  const [error, setError] = useState(null);\r\n\r\n  const handleSend = async () => {\r\n    setSending(true);\r\n    setError(null);\r\n    try {\r\n      await sendMail({ to, subject, body });\r\n      onClose();\r\n    } catch (err) {\r\n      console.error(\"Error enviando correo:\", err);\r\n      setError(String(err?.message || err) || \"No se pudo enviar el correo\");\r\n    } finally {\r\n      setSending(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-start justify-center bg-black/40 overflow-y-auto p-4\">\r\n      <div className=\"w-full max-w-xl rounded-lg bg-white shadow-lg max-h-[90vh] flex flex-col\">\r\n        <div className=\"p-6 pb-4\">\r\n          <h2 className=\"text-lg font-semibold\">Nuevo correo</h2>\r\n        </div>\r\n\r\n        <div className=\"px-6 space-y-4 flex-1 overflow-y-auto\">\r\n          <input\r\n            type=\"email\"\r\n            placeholder=\"Para\"\r\n            className=\"w-full rounded border px-3 py-2 text-sm\"\r\n            value={to}\r\n            onChange={(e) => setTo(e.target.value)}\r\n          />\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Asunto\"\r\n            className=\"w-full rounded border px-3 py-2 text-sm\"\r\n            value={subject}\r\n            onChange={(e) => setSubject(e.target.value)}\r\n          />\r\n          <textarea\r\n            rows=\"8\"\r\n            placeholder=\"Escribe tu mensaje‚Ä¶\"\r\n            className=\"w-full rounded border px-3 py-2 text-sm\"\r\n            value={body}\r\n            onChange={(e) => setBody(e.target.value)}\r\n          />\r\n          {error && (\r\n            <Alert variant=\"error\" className=\"text-sm\">\r\n              {error}\r\n            </Alert>\r\n          )}\r\n        </div>\r\n        <div className=\"p-6 pt-4 mt-2 border-t flex justify-end gap-2 bg-white sticky bottom-0\">\r\n          <Button onClick={onClose} disabled={sending} variant=\"ghost\">\r\n            Cancelar\r\n          </Button>\r\n          <Button onClick={handleSend} disabled={sending || !to} variant=\"primary\">\r\n            {sending ? <Spinner size=\"sm\" /> : \"Enviar\"}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default UnifiedEmail;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\WebEditor.jsx","messages":[{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":127,"column":76,"nodeType":"BlockStatement","messageId":"unexpected","endLine":127,"endColumn":78,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[5235,5235],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { doc, getDoc, setDoc, collection, getDocs, addDoc, deleteDoc } from 'firebase/firestore';\r\nimport { db } from '../lib/firebase';\r\nimport { useAuth } from '../hooks/useAuthUnified';\r\nimport { Plus, Trash, Zap } from 'lucide-react';\r\n\r\n/*\r\n  Editor interno para la p√°gina web de la boda.\r\n  Permite al usuario rellenar/editar la informaci√≥n que utilizar√° WeddingSite.jsx.\r\n*/\r\n\r\nexport default function WebEditor() {\r\n  const { currentUser } = useAuth();\r\n  const uid = currentUser?.uid || 'dev';\r\n\r\n  const [info, setInfo] = useState({\r\n    coupleName: '',\r\n    date: '',\r\n    celebrationPlace: '',\r\n    story: '',\r\n    giftAccount: '',\r\n    primaryColor: '#E91E63',\r\n    secondaryColor: '#FFFFFF',\r\n  });\r\n  const [schedule, setSchedule] = useState([]);\r\n  const [gallery, setGallery] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [aiLoading, setAiLoading] = useState(false);\r\n\r\n  // Cargar datos existentes\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const docSnap = await getDoc(doc(db, 'users', uid));\r\n        if (docSnap.exists() && docSnap.data().weddingInfo) setInfo({ ...info, ...docSnap.data().weddingInfo });\r\n        const schSnap = await getDocs(collection(db, 'users', uid, 'schedule'));\r\n        setSchedule(schSnap.docs.map(d => ({ id: d.id, ...d.data() })).sort((a,b)=>a.time.localeCompare(b.time)));\r\n        const galSnap = await getDocs(collection(db, 'users', uid, 'gallery'));\r\n        setGallery(galSnap.docs.map(d => ({ id: d.id, ...d.data() })));\r\n      } catch (e) { console.error(e); }\r\n    })();\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [uid]);\r\n\r\n  const saveInfo = async () => {\r\n    setLoading(true);\r\n    try {\r\n      await setDoc(doc(db, 'users', uid), { weddingInfo: info }, { merge: true });\r\n      alert('Informaci√≥n guardada');\r\n    } catch (err) { console.error(err); alert('Error al guardar'); }\r\n    setLoading(false);\r\n  };\r\n\r\n  // --- Schedule helpers ---\r\n  const addSchedule = () => setSchedule([...schedule, { time: '', title: '', temp: Date.now() }]);\r\n  const updateSchedule = (idx, key, val) => {\r\n    const next = [...schedule];\r\n    next[idx][key] = val;\r\n    setSchedule(next);\r\n  };\r\n  const removeSchedule = (idx) => setSchedule(schedule.filter((_,i)=>i!==idx));\r\n  const saveSchedule = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const colRef = collection(db, 'users', uid, 'schedule');\r\n      // Borrar docs existentes y volver a crear (simple)\r\n      const existing = await getDocs(colRef);\r\n      await Promise.all(existing.docs.map(d=>deleteDoc(d.ref)));\r\n      await Promise.all(schedule.map(item=> addDoc(colRef, { time: item.time, title: item.title })));\r\n      alert('Programa guardado');\r\n    } catch (e) { console.error(e); alert('Error'); }\r\n    setLoading(false);\r\n  };\r\n\r\n  // --- AI helpers ---\r\n  const suggestStory = async () => {\r\n    if (aiLoading) return;\r\n    if (!import.meta.env.VITE_OPENAI_API_KEY) { alert('Falta la clave de OpenAI'); return; }\r\n    setAiLoading(true);\r\n    try {\r\n      const response = await fetch('https://api.openai.com/v1/chat/completions', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${import.meta.env.VITE_OPENAI_API_KEY}`,\r\n        'OpenAI-Project': import.meta.env.VITE_OPENAI_PROJECT_ID\r\n        },\r\n        body: JSON.stringify({\r\n          model: 'gpt-3.5-turbo',\r\n          messages: [\r\n            { role: 'system', content: 'Eres un asistente que redacta textos rom√°nticos para webs de boda en espa√±ol.' },\r\n            { role: 'user', content: `Genera una breve historia de amor (m√°x 150 palabras) para la pareja ${info.coupleName}.` }\r\n          ],\r\n          temperature: 0.8\r\n        })\r\n      });\r\n      const data = await response.json();\r\n      const text = data.choices?.[0]?.message?.content?.trim();\r\n      if (text) setInfo(prev => ({ ...prev, story: text }));\r\n    } catch (err) { console.error(err); alert('Error OpenAI'); }\r\n    setAiLoading(false);\r\n  };\r\n\r\n  const suggestSchedule = async () => {\r\n    if (aiLoading) return;\r\n    if (!import.meta.env.VITE_OPENAI_API_KEY) { alert('Falta la clave de OpenAI'); return; }\r\n    setAiLoading(true);\r\n    try {\r\n      const response = await fetch('https://api.openai.com/v1/chat/completions', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${import.meta.env.VITE_OPENAI_API_KEY}`,\r\n        'OpenAI-Project': import.meta.env.VITE_OPENAI_PROJECT_ID\r\n        },\r\n        body: JSON.stringify({\r\n          model: 'gpt-3.5-turbo',\r\n          messages: [\r\n            { role: 'system', content: 'Eres un asistente que devuelve un JSON con el programa t√≠pico de una boda en Espa√±a. Ejemplo: [{\"time\":\"12:00\",\"title\":\"Ceremonia\"}]' },\r\n            { role: 'user', content: 'Genera un programa para nuestra boda con 6-8 eventos clave. Usa formato JSON.' }\r\n          ],\r\n          temperature: 0.7\r\n        })\r\n      });\r\n      const data = await response.json();\r\n      let arr = [];\r\n      try { arr = JSON.parse(data.choices?.[0]?.message?.content); } catch {}\r\n      if (Array.isArray(arr)) setSchedule(arr.map((item,i)=>({...item, temp:i})));\r\n    } catch(err){ console.error(err); alert('Error OpenAI'); }\r\n    setAiLoading(false);\r\n  };\r\n\r\n  // --- Gallery helpers ---\r\n  const addImage = () => setGallery([...gallery, { url: '' }]);\r\n  const updateImage = (idx, val) => {\r\n    const next = [...gallery];\r\n    next[idx].url = val;\r\n    setGallery(next);\r\n  };\r\n  const removeImage = idx => setGallery(gallery.filter((_,i)=>i!==idx));\r\n  const saveGallery = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const colRef = collection(db, 'users', uid, 'gallery');\r\n      const existing = await getDocs(colRef);\r\n      await Promise.all(existing.docs.map(d=>deleteDoc(d.ref)));\r\n      await Promise.all(gallery.filter(g=>g.url).map(img=> addDoc(colRef, { url: img.url })));\r\n      alert('Galer√≠a guardada');\r\n    } catch (e) { console.error(e); alert('Error'); }\r\n    setLoading(false);\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-4 md:p-6 space-y-8 max-w-4xl mx-auto\">\r\n      <h1 className=\"text-2xl font-bold text-gray-800\">Editor de mi web</h1>\r\n\r\n      {/* Informaci√≥n b√°sica */}\r\n      <section className=\"space-y-4\">\r\n        <h2 className=\"text-xl font-medium\">Datos b√°sicos</h2>\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n          <input className=\"border p-2 rounded\" placeholder=\"Nombres de la pareja\" value={info.coupleName} onChange={e=>setInfo({...info,coupleName:e.target.value})}/>\r\n          <input className=\"border p-2 rounded\" type=\"date\" value={info.date} onChange={e=>setInfo({...info,date:e.target.value})}/>\r\n          <input className=\"border p-2 rounded sm:col-span-2\" placeholder=\"Lugar de la celebraci√≥n\" value={info.celebrationPlace} onChange={e=>setInfo({...info,celebrationPlace:e.target.value})}/>\r\n        </div>\r\n        <textarea className=\"border p-2 rounded w-full\" rows=\"4\" placeholder=\"Nuestra historia\" value={info.story} onChange={e=>setInfo({...info,story:e.target.value})}/>\r\n        <button type=\"button\" onClick={suggestStory} disabled={aiLoading} className=\"text-sm text-blue-600 underline\">{aiLoading ? 'Generando...' : 'Sugerir con IA'}</button>\r\n        <input className=\"border p-2 rounded w-full\" placeholder=\"Cuenta bancaria / lista de regalos\" value={info.giftAccount} onChange={e=>setInfo({...info,giftAccount:e.target.value})}/>\r\n        <div className=\"flex gap-4 items-center\">\r\n          <label>Color primario:</label>\r\n          <input type=\"color\" value={info.primaryColor} onChange={e=>setInfo({...info,primaryColor:e.target.value})}/>\r\n          <label>Color secundario:</label>\r\n          <input type=\"color\" value={info.secondaryColor} onChange={e=>setInfo({...info,secondaryColor:e.target.value})}/>\r\n        </div>\r\n        <button className=\"bg-blue-600 text-white px-4 py-2 rounded\" disabled={loading} onClick={saveInfo}>Guardar informaci√≥n</button>\r\n      </section>\r\n\r\n      {/* Programa */}\r\n      <section className=\"space-y-4\">\r\n        <h2 className=\"text-xl font-medium flex items-center justify-between\">Programa del d√≠a\r\n          <div className=\"flex gap-3\">\r\n            <button onClick={addSchedule} className=\"text-green-600 flex items-center gap-1\"><Plus size={16}/> A√±adir</button>\r\n            <button onClick={suggestSchedule} disabled={aiLoading} className=\"text-indigo-600 flex items-center gap-1\"><Zap size={16}/> IA</button>\r\n          </div>\r\n        </h2>\r\n        {schedule.map((s,idx)=>(\r\n          <div key={s.id || s.temp} className=\"flex gap-2 items-center\">\r\n            <input type=\"time\" className=\"border p-1 rounded\" value={s.time} onChange={e=>updateSchedule(idx,'time',e.target.value)}/>\r\n            <input className=\"border p-1 rounded flex-grow\" placeholder=\"Descripci√≥n\" value={s.title} onChange={e=>updateSchedule(idx,'title',e.target.value)}/>\r\n            <button onClick={()=>removeSchedule(idx)} className=\"text-red-600\"><Trash size={16}/></button>\r\n          </div>\r\n        ))}\r\n        <button className=\"bg-blue-600 text-white px-4 py-2 rounded\" disabled={loading} onClick={saveSchedule}>Guardar programa</button>\r\n      </section>\r\n\r\n      {/* Galer√≠a */}\r\n      <section className=\"space-y-4\">\r\n        <h2 className=\"text-xl font-medium flex items-center justify-between\">Galer√≠a <button onClick={addImage} className=\"text-green-600 flex items-center gap-1\"><Plus size={16}/> A√±adir</button></h2>\r\n        {gallery.map((g,idx)=>(\r\n          <div key={g.id || idx} className=\"flex gap-2 items-center\">\r\n            <input className=\"border p-1 rounded flex-grow\" placeholder=\"URL de la imagen\" value={g.url} onChange={e=>updateImage(idx,e.target.value)}/>\r\n            <button onClick={()=>removeImage(idx)} className=\"text-red-600\"><Trash size={16}/></button>\r\n          </div>\r\n        ))}\r\n        <button className=\"bg-blue-600 text-white px-4 py-2 rounded\" disabled={loading} onClick={saveGallery}>Guardar galer√≠a</button>\r\n      </section>\r\n\r\n      {/* Vista previa */}\r\n      <section className=\"space-y-2\">\r\n        <h2 className=\"text-xl font-medium\">Vista previa</h2>\r\n        <iframe title=\"Preview\" className=\"border w-full h-[600px] rounded\" src={`/w/${uid}`} />\r\n      </section>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\WeddingSite.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\disenos\\DisenosLayout.jsx","messages":[{"ruleId":"react/display-name","severity":2,"message":"Component definition is missing display name","line":15,"column":23,"nodeType":"CallExpression","messageId":"noDisplayName","endLine":63,"endColumn":3}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useMemo } from 'react';\r\nimport { NavLink, Outlet, useLocation, useNavigate } from 'react-router-dom';\r\nimport Card from '../../components/Card';\r\n\r\n// Pesta√±as iniciales para la secci√≥n Dise√±os\r\nconst tabs = [\r\n  { path: 'invitaciones', label: 'Invitaciones' },\r\n  { path: 'logo', label: 'Logo' },\r\n  { path: 'menu', label: 'Men√∫' },\r\n  { path: 'seating-plan', label: 'Seating Plan' },\r\n  { path: 'menu-catering', label: 'Men√∫ Catering' },\r\n  { path: 'papeles-nombres', label: 'Papeles Nombres' },\r\n];\r\n\r\nconst DisenosLayout = React.memo(() => {\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n\r\n  /* Redirecci√≥n a la primera pesta√±a si el usuario est√° en /disenos */\r\n  useEffect(() => {\r\n    if (location.pathname === '/disenos' || location.pathname === '/disenos/') {\r\n      navigate('/disenos/invitaciones', { replace: true });\r\n    }\r\n  }, [location.pathname, navigate]);\r\n\r\n  const navTabs = useMemo(() => tabs.map(t => ({ ...t, href: `/disenos/${t.path}` })), []);\r\n\r\n  if (location.pathname === '/disenos' || location.pathname === '/disenos/') {\r\n    return <div className=\"p-6\" role=\"status\" aria-live=\"polite\">Cargando...</div>;\r\n  }\r\n\r\n  return (\r\n    <section className=\"p-6 flex flex-col gap-6\" aria-labelledby=\"disenos-heading\">\r\n      <h1 id=\"disenos-heading\" className=\"text-2xl font-bold text-gray-800\">Dise√±os</h1>\r\n\r\n      <nav role=\"tablist\" aria-label=\"Secciones de Dise√±o\" className=\"flex overflow-x-auto space-x-2 pb-2\">\r\n        {navTabs.map(tab => (\r\n          <NavLink\r\n            key={tab.path}\r\n            to={tab.href}\r\n            role=\"tab\"\r\n            aria-current={location.pathname === tab.href ? 'page' : undefined}\r\n            className={({ isActive }) =>\r\n              `px-4 py-2 rounded-t-lg font-medium whitespace-nowrap focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-blue-500 ${\r\n                isActive\r\n                  ? 'bg-white border-t-2 border-l-2 border-r-2 border-blue-500 text-blue-600 font-semibold'\r\n                  : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\r\n              }`\r\n            }\r\n          >\r\n            {tab.label}\r\n          </NavLink>\r\n        ))}\r\n      </nav>\r\n\r\n      <Card className=\"overflow-hidden focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500\" role=\"region\" aria-label=\"Contenido de Dise√±os\">\r\n        <div className=\"p-6\">\r\n          <Outlet />\r\n        </div>\r\n      </Card>\r\n    </section>\r\n  );\r\n});\r\n\r\nexport default DisenosLayout;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\disenos\\Invitaciones.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\disenos\\Logo.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { doc, getDoc, setDoc, updateDoc } from 'firebase/firestore';\r\nimport { db } from '../../firebaseConfig';\r\nimport { saveData, loadData } from '../../services/SyncService';\r\nimport Card from '../../components/Card';\r\nimport UploadImageCard from '../../components/UploadImageCard';\r\n\r\nimport { useWedding } from '../../context/WeddingContext';\r\nimport SyncIndicator from '../../components/SyncIndicator';\r\nimport ImageGeneratorAI from '../../components/ImageGeneratorAI';\r\n\r\n// Plantillas predefinidas para logos de boda\r\nconst logoTemplates = [\r\n  {\r\n    name: 'Monograma Elegante',\r\n    description: 'Logo con las iniciales de los novios en estilo elegante y sofisticado',\r\n    prompt: 'Dise√±a un monograma elegante para una boda con iniciales entrelazadas. Estilo sofisticado y cl√°sico con tipograf√≠a serif. Usa colores dorado y blanco sobre fondo oscuro. Incluye alg√∫n elemento decorativo sutil como hojas o flores. El logo debe ser limpio y vers√°til para usar en invitaciones y decoraci√≥n.'\r\n  },\r\n  {\r\n    name: 'Emblema Floral',\r\n    description: 'Logo rodeado de elementos florales y org√°nicos',\r\n    prompt: 'Crea un logo para boda con nombres o iniciales rodeados de elementos florales. Utiliza un estilo bot√°nico con flores y hojas delicadas. Paleta de colores suaves como verde sage, rosa p√°lido y toques dorados. Dise√±o circular u ovalado que funcione bien como sello o emblema. Estilo rom√°ntico y natural.'\r\n  },\r\n  {\r\n    name: 'Minimalista Moderno',\r\n    description: 'Logo limpio y minimalista con l√≠neas finas y est√©tica contempor√°nea',\r\n    prompt: 'Dise√±a un logo minimalista y moderno para boda. Utiliza l√≠neas finas, formas geom√©tricas simples y tipograf√≠a sans-serif. Estilo limpio y contempor√°neo sin adornos excesivos. Incorpora iniciales o nombres completos en un dise√±o equilibrado. Usa colores neutros como negro, gris o azul marino. El logo debe transmitir elegancia y simplicidad.'\r\n  },\r\n  {\r\n    name: 'Vintage & Retro',\r\n    description: 'Logo con est√©tica vintage y elementos decorativos de √©poca',\r\n    prompt: 'Crea un logo de boda con est√©tica vintage o retro. Utiliza tipograf√≠as cl√°sicas con serifs pronunciados o estilo script elegante. Incorpora elementos decorativos como marcos ornamentados, cintas o v√≠√±etas. Usa una paleta de colores envejecida como sepia, borgo√±a o azul marino. El dise√±o debe evocar nostalgia y elegancia atemporal, inspirado en los a√±os 20-50.'\r\n  },\r\n  {\r\n    name: 'Ilustrado & Art√≠stico',\r\n    description: 'Logo personalizado con ilustraciones hechas a mano y elementos creativos',\r\n    prompt: 'Dise√±a un logo de boda ilustrado con elementos personalizados. Estilo art√≠stico que parece hecho a mano, con trazos de acuarela, tinta o dibujo. Incluye pequenos elementos simb√≥licos relacionados con la pareja (hobbies, lugares significativos, mascotas). Combina las ilustraciones con tipograf√≠a manuscrita o caligr√°fica. Colorido pero armonioso, con aspecto √∫nico y personal.'\r\n  },\r\n];\r\n\r\nexport default function Logo() {\r\n  const { activeWedding } = useWedding();\r\n  const [hex, setHex] = useState(() => loadData('logoColor', { defaultValue: '#FF69B4', collection: 'userLogo' }));\r\n\r\n  const handleColor = (e) => {\r\n    setHex(e.target.value);\r\n    saveData('logoColor', e.target.value, {\r\n      collection: 'userLogo',\r\n      showNotification: false\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <SyncIndicator />\r\n      <UploadImageCard title=\"Subir Logo\" storageKey=\"logoImage\" />\r\n\r\n      <Card className=\"p-4 flex flex-col gap-4 items-start\">\r\n        <h2 className=\"text-lg font-semibold\">Color principal</h2>\r\n        <input\r\n          type=\"color\"\r\n          value={hex}\r\n          onChange={handleColor}\r\n          className=\"w-16 h-10 p-0 border-0 cursor-pointer\"\r\n          aria-label=\"Seleccionar color del logo\"\r\n        />\r\n        <p className=\"text-sm text-gray-600\">C√≥digo: {hex}</p>\r\n      </Card>\r\n\r\n      <div className=\"mb-6\">\r\n        <h2 className=\"text-xl font-semibold mb-2\">Dise√±a el logo para tu boda</h2>\r\n        <p className=\"text-gray-600\">Crea un logo personalizado que represente vuestra boda. Podr√°s usarlo en invitaciones, regalos, decoraci√≥n y m√°s.</p>\r\n      </div>\r\n\r\n      <ImageGeneratorAI \r\n        category=\"logo\" \r\n        templates={logoTemplates}\r\n        onImageGenerated={async (image) => {\r\n          console.log('Nuevo logo generado:', image);\r\n          // Actualizamos el logo en el contexto de usuario si se desea\r\n          try {\r\n            if (!activeWedding) return;\r\n            const infoRef = doc(db, 'weddings', activeWedding, 'weddingInfo');\r\n            const infoSnap = await getDoc(infoRef);\r\n            if (infoSnap.exists()) {\r\n              await updateDoc(infoRef, { logoUrl: image.url });\r\n            } else {\r\n              await setDoc(infoRef, { logoUrl: image.url });\r\n            }\r\n            // Notificar a la aplicaci√≥n que el logo ha cambiado\r\n            window.dispatchEvent(new Event('lovenda-profile-updated'));\r\n          } catch (err) {\r\n            console.error('Error al guardar el logo en el perfil:', err);\r\n          }\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\disenos\\Menu.jsx","messages":[{"ruleId":"react/jsx-no-undef","severity":2,"message":"'ImageGeneratorAI' is not defined.","line":141,"column":8,"nodeType":"JSXIdentifier","messageId":"undefined","endLine":141,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport Card from '../../components/Card';\r\nimport { Plus, Trash2 } from 'lucide-react';\r\nimport { saveData, loadData } from '../../services/SyncService';\r\nimport SyncIndicator from '../../components/SyncIndicator';\r\n\r\nconst initialState = () => {\r\n  try {\r\n    return loadData('menuDesigner', { \r\n      defaultValue: { entradas: [], principales: [], postres: [], bebidas: [] }, \r\n      collection: 'userMenus' \r\n    });\r\n  } catch (error) {\r\n    console.error('Error al cargar el dise√±o del men√∫:', error);\r\n    return { entradas: [], principales: [], postres: [], bebidas: [] };\r\n  }\r\n};\r\n\r\n// Plantillas predefinidas para men√∫s de boda\r\nconst menuTemplates = [\r\n  {\r\n    name: 'Elegante & Cl√°sico',\r\n    description: 'Dise√±o de men√∫ formal con estilo cl√°sico y refinado',\r\n    prompt: 'Dise√±a un men√∫ elegante para una boda con estilo cl√°sico y refinado. Formato vertical con tipograf√≠a serif elegante. Usa colores neutros con detalles dorados o plateados. Incluye secciones para entrante, plato principal, postre y bebidas. El dise√±o debe ser sobrio y sofisticado, adecuado para una cena formal de boda.'\r\n  },\r\n  {\r\n    name: 'R√∫stico & Natural',\r\n    description: 'Men√∫ con est√©tica r√∫stica, elementos naturales y texto manuscrito',\r\n    prompt: 'Crea un men√∫ de boda con est√©tica r√∫stica y natural. Utiliza elementos como madera, flores silvestres y hojas. Tipograf√≠a con aspecto manuscrito o caligr√°fico. Formato de una p√°gina con secciones para entrante, principal, postre y bebidas. Paleta de colores tierra y verdes naturales. El dise√±o debe transmitir calidez y un ambiente campestre elegante.'\r\n  },\r\n  {\r\n    name: 'Minimalista & Moderno',\r\n    description: 'Dise√±o limpio y contempor√°neo con espacios blancos y tipograf√≠a simple',\r\n    prompt: 'Dise√±a un men√∫ minimalista y moderno para boda. Utiliza mucho espacio en blanco, tipograf√≠a sans-serif limpia y elementos geom√©tricos simples. Formato elegante con distribuci√≥n equilibrada. Paleta monocrom√°tica o con un acento de color. Incluye secciones para los platos principales y bebidas. El dise√±o debe ser contempor√°neo, limpio y f√°cil de leer.'\r\n  },\r\n  {\r\n    name: 'Bot√°nico & Floral',\r\n    description: 'Men√∫ decorado con elementos bot√°nicos, flores y follaje',\r\n    prompt: 'Crea un men√∫ de boda con tem√°tica bot√°nica y floral. Incorpora ilustraciones delicadas de flores, hojas y ramas como elementos decorativos. Usa una combinaci√≥n de tipograf√≠as elegantes y caligr√°ficas. Paleta de colores suaves como verde salvia, rosa p√°lido y toques dorados. Formato de una p√°gina con todas las secciones del men√∫ organizadas arm√≥nicamente entre los elementos vegetales.'\r\n  },\r\n  {\r\n    name: 'Vintage & Rom√°ntico',\r\n    description: 'Men√∫ con est√©tica nost√°lgica, detalles ornamentados y aire rom√°ntico',\r\n    prompt: 'Dise√±a un men√∫ de boda con est√©tica vintage y rom√°ntica. Utiliza elementos decorativos como encajes, marcos ornamentados y motivos florales delicados. Tipograf√≠a elegante con serifs o caligr√°fica. Paleta en tonos sepia, crema o rosa antiguo. Formato que recuerde a documentos antiguos o postales vintage. Incluye todas las secciones del men√∫ dentro de un dise√±o que evoque nostalgia y romance.'\r\n  },\r\n];\r\n\r\nexport default function MenuDiseno() {\r\n  \r\n  const [menu, setMenu] = useState(initialState);\r\n  const [course, setCourse] = useState('entradas');\r\n  const [dish, setDish] = useState('');\r\n\r\n  useEffect(() => {\r\n    saveData('menuDesigner', menu, {\r\n      collection: 'userMenus',\r\n      showNotification: false\r\n    });\r\n  }, [menu]);\r\n\r\n  const addDish = () => {\r\n    if (!dish.trim()) return;\r\n    setMenu(prev => ({ ...prev, [course]: [...prev[course], dish.trim()] }));\r\n    setDish('');\r\n  };\r\n\r\n  const removeDish = (courseKey, idx) => {\r\n    setMenu(prev => ({\r\n      ...prev,\r\n      [courseKey]: prev[courseKey].filter((_, i) => i !== idx),\r\n    }));\r\n  };\r\n\r\n  // Generar un prompt personalizado basado en los datos del men√∫\r\n  const generateCustomPrompt = () => {\r\n    const menuItems = [];\r\n    if (menu.entradas.length > 0) menuItems.push(`Entrantes: ${menu.entradas.join(', ')}`);\r\n    if (menu.principales.length > 0) menuItems.push(`Platos principales: ${menu.principales.join(', ')}`);\r\n    if (menu.postres.length > 0) menuItems.push(`Postres: ${menu.postres.join(', ')}`);\r\n    if (menu.bebidas.length > 0) menuItems.push(`Bebidas: ${menu.bebidas.join(', ')}`);\r\n    \r\n    if (menuItems.length === 0) return '';\r\n    \r\n    return `Dise√±a un men√∫ elegante para boda con los siguientes platos:\\n${menuItems.join('\\n')}`;\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-8\">\r\n      <SyncIndicator />\r\n      <Card className=\"p-6 space-y-4\">\r\n        <h1 className=\"text-2xl font-semibold\">Dise√±o del Men√∫</h1>\r\n        <div className=\"flex flex-col md:flex-row gap-2 md:items-end\">\r\n          <select value={course} onChange={e => setCourse(e.target.value)} className=\"border rounded px-3 py-2\">\r\n            <option value=\"entradas\">Entradas</option>\r\n            <option value=\"principales\">Plato principal</option>\r\n            <option value=\"postres\">Postres</option>\r\n            <option value=\"bebidas\">Bebidas</option>\r\n          </select>\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Nombre del plato\"\r\n            value={dish}\r\n            onChange={e => setDish(e.target.value)}\r\n            className=\"flex-grow border rounded px-3 py-2\"\r\n          />\r\n          <button onClick={addDish} className=\"flex items-center gap-1 bg-blue-600 text-white px-4 py-2 rounded\">\r\n            <Plus size={16} /> A√±adir\r\n          </button>\r\n        </div>\r\n      </Card>\r\n\r\n      <Card className=\"p-6 space-y-6\">\r\n        <h2 className=\"text-xl font-semibold\">Vista Previa</h2>\r\n        <div className=\"space-y-4 text-center font-serif\">\r\n          {Object.entries(menu).map(([key, dishes]) => (\r\n            <div key={key} className=\"space-y-1\">\r\n              <h3 className=\"text-lg font-bold capitalize\">{key}</h3>\r\n              {dishes.length === 0 && <p className=\"text-sm text-gray-500\">Sin elementos</p>}\r\n              {dishes.map((d, idx) => (\r\n                <div key={idx} className=\"flex items-center justify-center gap-2 group\">\r\n                  <span>{d}</span>\r\n                  <button\r\n                    onClick={() => removeDish(key, idx)}\r\n                    className=\"hidden group-hover:inline-flex text-red-600\"\r\n                    aria-label={`Eliminar ${d}`}\r\n                  >\r\n                    <Trash2 size={14} />\r\n                  </button>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </Card>\r\n\r\n      <div className=\"mt-8 mb-4\">\r\n        <h2 className=\"text-lg font-semibold mb-2\">Dise√±a tu men√∫</h2>\r\n        <p className=\"text-gray-600\">Genera dise√±os para tu men√∫ utilizando IA. Los datos que has introducido arriba se incluir√°n autom√°ticamente.</p>\r\n      </div>\r\n\r\n      <ImageGeneratorAI \r\n        category=\"menu\" \r\n        templates={menuTemplates}\r\n        customPrompt={generateCustomPrompt()}\r\n        onImageGenerated={(image) => {\r\n          console.log('Nuevo dise√±o de men√∫ generado:', image);\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\disenos\\MenuCatering.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'saveData' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":18},{"ruleId":"no-unused-vars","severity":1,"message":"'setSpecialMenus' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":37,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":37,"endColumn":39},{"ruleId":"no-unused-vars","severity":1,"message":"'generateCustomPrompt' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":50,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":50,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport Card from '../../components/Card';\r\nimport { saveData, loadData } from '../../services/SyncService';\r\nimport ImageGeneratorAI from '../../components/ImageGeneratorAI';\r\n\r\n// Plantillas predefinidas para men√∫s especiales de catering\r\nconst cateringTemplates = [\r\n  {\r\n    name: 'Men√∫ Vegetariano',\r\n    description: 'Dise√±o elegante para men√∫s vegetarianos',\r\n    prompt: 'Dise√±a una tarjeta de men√∫ vegetariano para boda. Utiliza un dise√±o elegante con elementos vegetales sutiles como hojas o hierbas. Incluye el t√≠tulo \"Men√∫ Vegetariano\" y espacio para listar entrantes, plato principal y postre. El dise√±o debe ser sofisticado y a juego con la decoraci√≥n general de la boda, pero claramente identificable como opci√≥n vegetariana. Usa colores que evoquen frescura y naturaleza.'\r\n  },\r\n  {\r\n    name: 'Men√∫ Infantil',\r\n    description: 'Dise√±o divertido pero elegante para el men√∫ de ni√±os',\r\n    prompt: 'Crea un dise√±o de men√∫ infantil para boda que sea divertido pero mantenga la elegancia del evento. Incluye elementos gr√°ficos amigables para ni√±os sin ser excesivamente infantil. El t√≠tulo debe ser \"Men√∫ Infantil\" o similar, con espacio para listar opciones de comida para ni√±os. Usa colores vibrantes pero armoniosos con la tem√°tica de boda. El dise√±o debe ser atractivo para los ni√±os pero tambi√©n visualmente agradable para los padres.'\r\n  },\r\n  {\r\n    name: 'Men√∫ Sin Gluten',\r\n    description: 'Dise√±o elegante para men√∫s sin gluten',\r\n    prompt: 'Dise√±a una tarjeta de men√∫ sin gluten para boda. El dise√±o debe ser elegante y sofisticado, a la altura del evento. Incluye el t√≠tulo \"Men√∫ Sin Gluten\" de forma visible pero discreta. Proporciona espacio para detallar los platos seguros sin gluten para entrantes, plato principal y postre. Utiliza un s√≠mbolo o icono sutil que indique que es apto para cel√≠acos. El estilo visual debe integrarse perfectamente con el resto de la papeler√≠a de boda.'\r\n  },\r\n  {\r\n    name: 'Men√∫ Sin L√°cteos',\r\n    description: 'Dise√±o para men√∫s libres de l√°cteos',\r\n    prompt: 'Crea un dise√±o de men√∫ sin l√°cteos para boda. El dise√±o debe ser elegante y refinado, en l√≠nea con la est√©tica general de la boda. Incluye un t√≠tulo claro como \"Men√∫ Sin L√°cteos\" o \"Men√∫ Libre de L√°cteos\". Proporciona espacio para listar entrantes, plato principal y postre. Puedes incorporar alg√∫n elemento gr√°fico sutil que indique la ausencia de l√°cteos. La paleta de colores debe ser armoniosa con el resto de la decoraci√≥n del evento.'\r\n  },\r\n  {\r\n    name: 'Men√∫ Personalizado',\r\n    description: 'Dise√±o vers√°til para cualquier necesidad diet√©tica especial',\r\n    prompt: 'Dise√±a un formato de men√∫ personalizable para necesidades diet√©ticas especiales en una boda. El dise√±o debe incluir un espacio prominente para el t√≠tulo donde se pueda especificar el tipo de men√∫ especial. Proporciona secciones claras para entrantes, plato principal y postre. Incorpora elementos gr√°ficos elegantes que sean neutros y adaptables a cualquier tipo de restricci√≥n alimentaria. El dise√±o debe ser sofisticado y coherente con la est√©tica general de la boda.'\r\n  },\r\n];\r\n\r\nexport default function MenuCatering() {\r\n  // Estado para los diferentes tipos de men√∫s especiales\r\n  const [specialMenus, setSpecialMenus] = useState(() => {\r\n    try {\r\n      return loadData('specialMenus', { \r\n        defaultValue: { vegetariano: [], infantil: [], sinGluten: [], sinLacteos: [], otros: [] },\r\n        collection: 'userSpecialMenus'\r\n      });\r\n    } catch (error) {\r\n      console.error('Error al cargar men√∫s especiales:', error);\r\n      return { vegetariano: [], infantil: [], sinGluten: [], sinLacteos: [], otros: [] };\r\n    }\r\n  });\r\n\r\n  // Generar un prompt personalizado basado en los datos del men√∫\r\n  const generateCustomPrompt = () => {\r\n    // Ejemplo: si hay men√∫s vegetarianos definidos, incluirlos en el prompt\r\n    const menuTypes = Object.keys(specialMenus).filter(type => specialMenus[type].length > 0);\r\n    \r\n    if (menuTypes.length === 0) return '';\r\n    \r\n    const menuDetails = menuTypes.map(type => {\r\n      const items = specialMenus[type];\r\n      const typeLabel = {\r\n        vegetariano: 'Men√∫ Vegetariano',\r\n        infantil: 'Men√∫ Infantil',\r\n        sinGluten: 'Men√∫ Sin Gluten',\r\n        sinLacteos: 'Men√∫ Sin L√°cteos',\r\n        otros: 'Men√∫ Especial'\r\n      }[type] || 'Men√∫ Especial';\r\n      \r\n      return `${typeLabel}: ${items.join(', ')}`;\r\n    });\r\n    \r\n    return `Dise√±a un conjunto de tarjetas de men√∫s especiales para boda con los siguientes tipos: ${menuDetails.join('. ')}. Cada tarjeta debe identificar claramente el tipo de men√∫ especial.`;\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <Card className=\"p-6 space-y-4\">\r\n        <h1 className=\"text-2xl font-semibold\">Dise√±o de Men√∫s Especiales</h1>\r\n        <p className=\"text-gray-600\">Crea tarjetas elegantes para los men√∫s especiales de tu boda (vegetarianos, infantil, sin gluten, etc). Selecciona un estilo o personaliza tu propio dise√±o.</p>\r\n        \r\n        <div className=\"mt-2\">\r\n          <p className=\"text-sm text-blue-600\">\r\n            <span className=\"font-medium\">Consejo:</span> Para una experiencia completa, define primero los platos de cada men√∫ especial en la secci√≥n de Men√∫ principal.\r\n          </p>\r\n        </div>\r\n      </Card>\r\n      \r\n      <ImageGeneratorAI \r\n        category=\"special-menus\" \r\n        templates={cateringTemplates}\r\n        onImageGenerated={(image) => {\r\n          console.log('Nuevos dise√±os de men√∫s especiales generados:', image);\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\disenos\\PapelesNombres.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'loadData' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":18},{"ruleId":"no-unused-vars","severity":1,"message":"'getGuestsInfo' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":41,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":41,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport Card from '../../components/Card';\r\nimport { loadData } from '../../services/SyncService';\r\nimport { useWedding } from '../../context/WeddingContext';\r\nimport useWeddingCollection from '../../hooks/useWeddingCollection';\r\nimport ImageGeneratorAI from '../../components/ImageGeneratorAI';\r\n\r\n// Plantillas predefinidas para marcadores de mesa y papelitos con nombres\r\nconst nameCardsTemplates = [\r\n  {\r\n    name: 'Elegante & Minimalista',\r\n    description: 'Marcador de mesa elegante con tipograf√≠a refinada sobre fondo neutro',\r\n    prompt: 'Dise√±a un marcador de mesa elegante y minimalista para una boda. El dise√±o debe incluir un espacio claro para el nombre del invitado, con tipograf√≠a serif refinada. Usa colores neutros como blanco, crema, o gris p√°lido con detalles en dorado o plateado. El estilo debe ser sobrio, cl√°sico y sofisticado, adecuado para una cena formal. Formato rectangular u ovalado que pueda imprimirse y doblarse.'\r\n  },\r\n  {\r\n    name: 'R√∫stico & Natural',\r\n    description: 'Marcador de mesa con elementos naturales, madera y estilo campestre',\r\n    prompt: 'Crea un marcador de mesa con estilo r√∫stico y natural para boda. Utiliza texturas que simulen madera, papel kraft o materiales reciclados. Incorpora elementos decorativos como hojas, flores silvestres o ramas. Tipograf√≠a con aspecto manuscrito o artesanal. El dise√±o debe transmitir calidez y un ambiente campestre. Formato que permita escribir el nombre del invitado de forma destacada y legible.'\r\n  },\r\n  {\r\n    name: 'Floral & Rom√°ntico',\r\n    description: 'Marcador decorado con flores, motivos bot√°nicos y colores suaves',\r\n    prompt: 'Dise√±a un marcador de mesa con motivos florales y rom√°nticos para una boda. Incorpora ilustraciones delicadas de flores como rosas, peon√≠as o lavanda. Utiliza una paleta de colores suaves y pasteles. Tipograf√≠a elegante, caligr√°fica o manuscrita que resalte el nombre del invitado. El dise√±o debe ser delicado y evocador, con un aire rom√°ntico y primaveral.'\r\n  },\r\n  {\r\n    name: 'Moderno & Geom√©trico',\r\n    description: 'Marcador con l√≠neas limpias, formas geom√©tricas y estilo contempor√°neo',\r\n    prompt: 'Crea un marcador de mesa moderno con elementos geom√©tricos para boda. Utiliza formas como hex√°gonos, tri√°ngulos o l√≠neas abstractas. Tipograf√≠a sans-serif limpia y contempor√°nea. Paleta de colores contrastantes pero elegantes como negro, blanco, dorado o colores acentuados. El dise√±o debe ser actual, con estilo minimalista pero distintivo, dejando espacio prominente para el nombre del invitado.'\r\n  },\r\n  {\r\n    name: 'Tem√°tico & Personalizado',\r\n    description: 'Marcador tem√°tico que refleja alg√∫n inter√©s, afici√≥n o motivo especial',\r\n    prompt: 'Dise√±a un marcador de mesa tem√°tico para boda inspirado en viajes/destinos. Incorpora sutilmente elementos como mapas, br√∫julas, aviones o monumentos ic√≥nicos. El dise√±o debe mantener la elegancia apropiada para una boda mientras incorpora estos elementos tem√°ticos de forma creativa. Incluye un espacio claro para el nombre del invitado con tipograf√≠a legible y atractiva que complemente el tema.'\r\n  },\r\n];\r\n\r\nexport default function PapelesNombres() {\r\n  const { activeWedding } = useWedding();\r\n  const { data: dbGuests } = useWeddingCollection('guests', activeWedding, []);\r\n  // Obtener informaci√≥n de invitados si est√° disponible\r\n  const getGuestsInfo = () => {\r\n    try {\r\n      const guests = dbGuests;\r\n      \r\n      // Si no hay suficientes invitados, devolver cadena vac√≠a\r\n      if (guests.length < 5) return '';\r\n      \r\n      // Seleccionar algunos invitados para incluir en el ejemplo\r\n      const selectedGuests = guests\r\n        .filter(g => g.name && g.name.trim() !== '')\r\n        .slice(0, 8)\r\n        .map(g => g.name);\r\n      \r\n      if (selectedGuests.length === 0) return '';\r\n      \r\n      return `Incluye ejemplos para los siguientes nombres: ${selectedGuests.join(', ')}`;\r\n    } catch (err) {\r\n      console.error('Error al obtener informaci√≥n de invitados:', err);\r\n      return '';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <Card className=\"p-6 space-y-4\">\r\n        <h1 className=\"text-2xl font-semibold\">Marcadores de Mesa</h1>\r\n        <p className=\"text-gray-600\">Crea elegantes marcadores con los nombres de tus invitados para identificar su lugar en la mesa. Selecciona un estilo o personaliza tu propio dise√±o.</p>\r\n        \r\n        <div className=\"mt-2\">\r\n          <p className=\"text-sm text-blue-600\">\r\n            <span className=\"font-medium\">Consejo:</span> Para mejores resultados, a√±ade primero a tus invitados en la secci√≥n de Invitados.\r\n          </p>\r\n        </div>\r\n      </Card>\r\n      \r\n      <ImageGeneratorAI \r\n        category=\"place-cards\" \r\n        templates={nameCardsTemplates}\r\n        onImageGenerated={(image) => {\r\n          console.log('Nuevos marcadores de mesa generados:', image);\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\disenos\\Post.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'getProfileInfo' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":37,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":37,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport Card from '../../components/Card';\r\nimport { loadData } from '../../services/SyncService';\r\nimport ImageGeneratorAI from '../../components/ImageGeneratorAI';\r\n\r\n// Plantillas predefinidas para posts y contenido para redes sociales\r\nconst socialMediaTemplates = [\r\n  {\r\n    name: 'Anuncio de Compromiso',\r\n    description: 'Post elegante para anunciar el compromiso en redes sociales',\r\n    prompt: 'Dise√±a una imagen para anunciar un compromiso en redes sociales. Formato cuadrado (1:1) ideal para Instagram. Incluye el texto \"¬°Nos casamos!\" o similar y espacio para a√±adir la fecha. Estilo elegante y rom√°ntico con elementos como anillos, flores o corazones sutiles. La imagen debe ser sofisticada pero emotiva, adecuada para compartir en cualquier plataforma social.'\r\n  },\r\n  {\r\n    name: 'Save the Date',\r\n    description: 'Post para informar a invitados sobre la fecha de la boda',\r\n    prompt: 'Crea un dise√±o de \"Save the Date\" para compartir en redes sociales. Formato cuadrado optimizado para Instagram y otras plataformas. Incluye la frase \"Save the Date\" de forma destacada y espacio para incluir la fecha y posiblemente el lugar. El estilo debe ser moderno y atractivo visualmente, con elementos gr√°ficos que llamen la atenci√≥n pero manteniendo la elegancia. La imagen debe transmitir la emoci√≥n y la anticipaci√≥n del evento.'\r\n  },\r\n  {\r\n    name: 'Cuenta Atr√°s',\r\n    description: 'Post que muestra los d√≠as restantes hasta la boda',\r\n    prompt: 'Dise√±a una plantilla para posts de cuenta atr√°s para boda en redes sociales. Formato cuadrado para Instagram. Debe incluir prominentemente el texto \"Faltan X d√≠as\" con un espacio claro donde se pueda editar el n√∫mero. El dise√±o debe ser atractivo visualmente con elementos festivos pero elegantes. Incluye alg√∫n elemento gr√°fico como un reloj, calendario o similar que enfatice el concepto de cuenta atr√°s. Los colores deben ser acordes a una boda.'\r\n  },\r\n  {\r\n    name: 'Hashtag de Boda',\r\n    description: 'Post que destaca el hashtag personalizado para la boda',\r\n    prompt: 'Crea un dise√±o para promocionar un hashtag personalizado de boda en redes sociales. Formato cuadrado para Instagram y otras plataformas. El dise√±o debe destacar prominentemente el texto \"#NuestroHashtag\" (como ejemplo, debe ser f√°cilmente reemplazable). Incorpora elementos visuales atractivos que complementen el tema de la boda. La composici√≥n debe ser clara y legible incluso en pantallas peque√±as, animando a los invitados a usar el hashtag cuando compartan fotos del evento.'\r\n  },\r\n  {\r\n    name: 'Agradecimiento Post-Boda',\r\n    description: 'Post para agradecer a invitados tras la celebraci√≥n',\r\n    prompt: 'Dise√±a una imagen para publicar en redes sociales como agradecimiento despu√©s de una boda. Formato cuadrado para Instagram. Incluye un texto como \"Gracias por compartir nuestro d√≠a especial\" u otra frase de agradecimiento similar. El dise√±o debe transmitir gratitud y emoci√≥n, con elementos elegantes que evoquen la celebraci√≥n. Utiliza una paleta de colores rom√°ntica y sofisticada. La imagen debe ser lo suficientemente vers√°til para acompa√±ar una galer√≠a de fotos del evento.'\r\n  },\r\n];\r\n\r\nexport default function PostDiseno() {\r\n  // Obtener informaci√≥n del perfil para personalizar los prompts si es posible\r\n  const getProfileInfo = () => {\r\n    try {\r\n      const profile = loadData('lovendaProfile', { defaultValue: {}, collection: 'userProfiles' });\r\n      const names = [];\r\n      \r\n      if (profile.brideFirstName && profile.groomFirstName) {\r\n        names.push(`${profile.brideFirstName} & ${profile.groomFirstName}`);\r\n      } else if (profile.brideFirstName) {\r\n        names.push(profile.brideFirstName);\r\n      } else if (profile.groomFirstName) {\r\n        names.push(profile.groomFirstName);\r\n      }\r\n      \r\n      let customInfo = '';\r\n      \r\n      if (names.length > 0) {\r\n        customInfo += `Incluye los nombres: ${names.join(' y ')}. `;\r\n      }\r\n      \r\n      if (profile.weddingDate) {\r\n        // Formato simple de fecha\r\n        customInfo += `La fecha de la boda es: ${profile.weddingDate}. `;\r\n      }\r\n      \r\n      if (profile.weddingLocation) {\r\n        customInfo += `La boda se celebra en: ${profile.weddingLocation}. `;\r\n      }\r\n      \r\n      return customInfo;\r\n    } catch (err) {\r\n      console.error('Error al obtener informaci√≥n del perfil:', err);\r\n      return '';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <Card className=\"p-6 space-y-4\">\r\n        <h1 className=\"text-2xl font-semibold\">Dise√±o de Posts para Redes Sociales</h1>\r\n        <p className=\"text-gray-600\">Crea im√°genes atractivas para compartir en tus redes sociales antes, durante y despu√©s de la boda. Selecciona un estilo o personaliza tu propio dise√±o.</p>\r\n        \r\n        <div className=\"mt-2\">\r\n          <p className=\"text-sm text-blue-600\">\r\n            <span className=\"font-medium\">Consejo:</span> Estas im√°genes est√°n optimizadas para formato cuadrado, ideal para Instagram y otras plataformas de redes sociales.\r\n          </p>\r\n        </div>\r\n      </Card>\r\n      \r\n      <ImageGeneratorAI \r\n        category=\"social-media\" \r\n        templates={socialMediaTemplates}\r\n        onImageGenerated={(image) => {\r\n          console.log('Nuevo dise√±o para redes sociales generado:', image);\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\disenos\\SeatingPlanPost.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'getSeatingInfo' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":42,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport Card from '../../components/Card';\r\nimport { loadData } from '../../services/SyncService';\r\nimport { useWedding } from '../../context/WeddingContext';\r\nimport useWeddingCollection from '../../hooks/useWeddingCollection';\r\nimport ImageGeneratorAI from '../../components/ImageGeneratorAI';\r\n\r\n// Plantillas predefinidas para carteles de seating plan\r\nconst seatingPlanTemplates = [\r\n  {\r\n    name: 'Elegante & Cl√°sico',\r\n    description: 'Cartel de asignaci√≥n de mesas con dise√±o formal y refinado',\r\n    prompt: 'Dise√±a un cartel elegante para el seating plan (asignaci√≥n de mesas) de una boda. Estilo formal con tipograf√≠a serif. Incluye el t√≠tulo \"Seating Plan\" o \"Distribuci√≥n de Mesas\" con un dise√±o elegante. El cartel debe tener espacio para listar nombres de invitados organizados por mesas. Usa colores neutros con toques dorados o plateados. El dise√±o debe ser sofisticado y f√°cil de leer.'\r\n  },\r\n  {\r\n    name: 'R√∫stico & Natural',\r\n    description: 'Cartel de estilo r√∫stico con elementos naturales y madera',\r\n    prompt: 'Crea un cartel de seating plan con est√©tica r√∫stica para una boda. Utiliza elementos como madera, flores silvestres y elementos naturales. Dise√±o que parezca una pizarra o tabla de madera con los nombres escritos. Incluye el t√≠tulo \"Encuentra tu sitio\" o similar. Estilo c√°lido y acogedor, con aspecto artesanal. La distribuci√≥n debe permitir organizar nombres por mesas de forma clara.'\r\n  },\r\n  {\r\n    name: 'Minimalista & Moderno',\r\n    description: 'Dise√±o limpio con tipograf√≠a sencilla y organizaci√≥n clara',\r\n    prompt: 'Dise√±a un cartel de seating plan minimalista y moderno para una boda. Utiliza mucho espacio en blanco, tipograf√≠a sans-serif limpia y elementos geom√©tricos simples. El t√≠tulo debe ser \"Seating Plan\" o \"Tu mesa\". Organizaci√≥n visual muy clara con n√∫meros de mesa bien destacados. Colores monocrom√°ticos con posibles acentos en un solo color. Dise√±o contempor√°neo, limpio y extremadamente legible.'\r\n  },\r\n  {\r\n    name: 'Tem√°tico & Creativo',\r\n    description: 'Cartel personalizado con tem√°tica especial (viajes, naturaleza, etc)',\r\n    prompt: 'Crea un cartel de seating plan con dise√±o tem√°tico creativo. Utiliza una tem√°tica de viajes/mapas donde cada mesa representa un destino o lugar. Incluye elementos gr√°ficos como br√∫julas, mapas, aviones o globos. El t√≠tulo puede ser \"Encuentra tu destino\" o similar. El dise√±o debe ser original y visualmente atractivo, permitiendo que los invitados identifiquen f√°cilmente su mesa asignada.'\r\n  },\r\n  {\r\n    name: 'Rom√°ntico & Floral',\r\n    description: 'Cartel decorado con flores, motivos rom√°nticos y colores suaves',\r\n    prompt: 'Dise√±a un cartel de seating plan rom√°ntico con abundantes elementos florales para una boda. Utiliza una paleta de colores suaves como rosa, lavanda y verde salvia. Incorpora ilustraciones delicadas de flores y elementos bot√°nicos. El t√≠tulo puede ser \"Con cari√±o, os hemos asignado\" o similar. Tipograf√≠a elegante y caligr√°fica. El dise√±o debe transmitir romanticismo y delicadeza, organizado de forma clara para que los invitados encuentren f√°cilmente su mesa.'\r\n  },\r\n];\r\n\r\nexport default function SeatingPlanPost() {\r\n  // Obtener informaci√≥n de invitados y mesas si est√° disponible\r\n  const { activeWedding } = useWedding();\r\n  const { data: dbGuests } = useWeddingCollection('guests', activeWedding, []);\r\n\r\n  const getSeatingInfo = () => {\r\n    try {\r\n      const guests = dbGuests;\r\n      const tables = loadData('lovendaTables', { defaultValue: [], collection: 'userTables' });\r\n      \r\n      // Si no hay datos suficientes, devolver cadena vac√≠a\r\n      if (!Array.isArray(guests) || guests.length===0 || !tables.length) return '';\r\n      \r\n      // Agrupar invitados por mesa\r\n      const guestsByTable = {};\r\n      guests.forEach(guest => {\r\n        if (guest.tableId) {\r\n          if (!guestsByTable[guest.tableId]) {\r\n            guestsByTable[guest.tableId] = [];\r\n          }\r\n          guestsByTable[guest.tableId].push(guest.name);\r\n        }\r\n      });\r\n      \r\n      // Crear prompt con la informaci√≥n real\r\n      let tableInfo = [];\r\n      tables.forEach(table => {\r\n        const tableGuests = guestsByTable[table.id] || [];\r\n        if (tableGuests.length) {\r\n          tableInfo.push(`Mesa ${table.name || table.id}: ${tableGuests.join(', ')}`);\r\n        }\r\n      });\r\n      \r\n      if (!tableInfo.length) return '';\r\n      \r\n      return `Incluye las siguientes mesas con sus invitados:\\n${tableInfo.join('\\n')}`;\r\n    } catch (err) {\r\n      console.error('Error al obtener informaci√≥n de asientos:', err);\r\n      return '';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <Card className=\"p-6 space-y-4\">\r\n        <h1 className=\"text-2xl font-semibold\">Dise√±o del Seating Plan</h1>\r\n        <p className=\"text-gray-600\">Crea carteles para que tus invitados encuentren su mesa asignada. Selecciona un estilo o personaliza tu propio dise√±o.</p>\r\n        \r\n        <div className=\"mt-2\">\r\n          <p className=\"text-sm text-blue-600\">\r\n            <span className=\"font-medium\">Consejo:</span> Para mejores resultados, primero asigna a tus invitados en mesas usando la p√°gina de Seating Plan.\r\n          </p>\r\n        </div>\r\n      </Card>\r\n      \r\n      <ImageGeneratorAI \r\n        category=\"seating-plan\" \r\n        templates={seatingPlanTemplates}\r\n        onImageGenerated={(image) => {\r\n          console.log('Nuevo cartel de seating plan generado:', image);\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\protocolo\\AyudaCeremonia.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36},{"ruleId":"no-unused-vars","severity":1,"message":"'currentUser' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":8,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":22},{"ruleId":"no-undef","severity":2,"message":"'user' is not defined.","line":32,"column":19,"nodeType":"Identifier","messageId":"undef","endLine":32,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'user' is not defined.","line":32,"column":55,"nodeType":"Identifier","messageId":"undef","endLine":32,"endColumn":59}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Card } from '../../components/ui';\r\nimport PageWrapper from '../../components/PageWrapper';\r\nimport { Button } from '../../components/ui';\r\nimport { useAuth } from '../../hooks/useAuthUnified';\r\n\r\nconst AyudaCeremonia = () => {\r\n  const { currentUser } = useAuth();\r\n  const [activeTab, setActiveTab] = useState('lecturas');\r\n  const [readings, setReadings] = useState([\r\n    { id: 1, title: 'Lectura 1', content: 'Texto de la primera lectura...', duration: '3 min', status: 'draft' },\r\n    { id: 2, title: 'Evangelio', content: 'Texto del evangelio...', duration: '5 min', status: 'final' },\r\n  ]);\r\n  \r\n  const [surprises, setSurprises] = useState([\r\n    { \r\n      id: 1, \r\n      type: 'ramo', \r\n      recipient: 'Madre de la novia', \r\n      table: 'Mesa 1', \r\n      description: 'Ramo de rosas blancas',\r\n      notes: 'Entregar despu√©s del primer baile',\r\n      status: 'pending'\r\n    },\r\n  ]);\r\n  \r\n  const [activeReading, setActiveReading] = useState(null);\r\n  const [showReadingPreview, setShowReadingPreview] = useState(false);\r\n  const [readingPreview, setReadingPreview] = useState('');\r\n  \r\n  // Verificar si el usuario tiene permisos\r\n  const canEdit = user?.role === 'wedding-planner' || user?.role === 'ayudante';\r\n  \r\n  const handleReadingSave = (e) => {\r\n    e.preventDefault();\r\n    const form = e.target;\r\n    const formData = new FormData(form);\r\n    const title = formData.get('title');\r\n    const content = formData.get('content');\r\n    \r\n    if (activeReading) {\r\n      // Actualizar lectura existente\r\n      setReadings(readings.map(r => \r\n        r.id === activeReading.id \r\n          ? { ...r, title, content, status: 'draft' }\r\n          : r\r\n      ));\r\n    } else {\r\n      // Crear nueva lectura\r\n      const newReading = {\r\n        id: Date.now(),\r\n        title,\r\n        content,\r\n        duration: '5 min',\r\n        status: 'draft'\r\n      };\r\n      setReadings([...readings, newReading]);\r\n    }\r\n    \r\n    // Limpiar formulario\r\n    setActiveReading(null);\r\n    form.reset();\r\n  };\r\n  \r\n  const handlePreviewReading = (content) => {\r\n    setReadingPreview(content);\r\n    setShowReadingPreview(true);\r\n  };\r\n  \r\n  const calculateReadingTime = (text) => {\r\n    // Estimaci√≥n: 150 palabras por minuto\r\n    const wordCount = text.trim().split(/\\s+/).length;\r\n    const minutes = Math.ceil(wordCount / 150);\r\n    return `${minutes} min`;\r\n  };\r\n  \r\n  const handleContentChange = (e) => {\r\n    const content = e.target.value;\r\n    const duration = calculateReadingTime(content);\r\n    \r\n    if (activeReading) {\r\n      setActiveReading({\r\n        ...activeReading,\r\n        content,\r\n        duration\r\n      });\r\n    }\r\n  };\r\n  \r\n  const handleAddSurprise = (e) => {\r\n    e.preventDefault();\r\n    const form = e.target;\r\n    const formData = new FormData(form);\r\n    \r\n    const newSurprise = {\r\n      id: Date.now(),\r\n      type: formData.get('type'),\r\n      recipient: formData.get('recipient'),\r\n      table: formData.get('table'),\r\n      description: formData.get('description'),\r\n      notes: formData.get('notes'),\r\n      status: 'pending'\r\n    };\r\n    \r\n    setSurprises([...surprises, newSurprise]);\r\n    form.reset();\r\n  };\r\n\r\n  return (\r\n    <PageWrapper title=\"Ayuda Ceremonia\">\r\n      <div className=\"space-y-6\">\r\n        <p className=\"text-gray-600\">Gestiona las lecturas y momentos especiales de tu ceremonia</p>\r\n\r\n        {/* Pesta√±as */}\r\n        <div className=\"border-b border-gray-200\">\r\n          <nav className=\"-mb-px flex space-x-8\">\r\n            <button\r\n              onClick={() => setActiveTab('lecturas')}\r\n              className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${\r\n                activeTab === 'lecturas'\r\n                  ? 'border-blue-500 text-blue-600'\r\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\r\n              }`}\r\n            >\r\n              Lecturas\r\n            </button>\r\n            <button\r\n              onClick={() => setActiveTab('ramos-sorpresas')}\r\n              className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${\r\n                activeTab === 'ramos-sorpresas'\r\n                  ? 'border-blue-500 text-blue-600'\r\n                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\r\n              }`}\r\n            >\r\n              Ramos y Sorpresas\r\n            </button>\r\n          </nav>\r\n        </div>\r\n\r\n      {/* Contenido de las pesta√±as */}\r\n      {activeTab === 'lecturas' ? (\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n          {/* Lista de lecturas */}\r\n          <div className=\"lg:col-span-1\">\r\n            <Card className=\"h-full\">\r\n              <div className=\"px-4 py-5 border-b\">\r\n                <h3 className=\"text-lg font-medium\">Lecturas de la Ceremonia</h3>\r\n              </div>\r\n              <div className=\"overflow-y-auto max-h-96\">\r\n                {readings.length === 0 ? (\r\n                  <p className=\"p-4 text-sm text-gray-500\">No hay lecturas guardadas</p>\r\n                ) : (\r\n                  <ul className=\"divide-y divide-gray-200\">\r\n                    {readings.map((reading) => (\r\n                      <li key={reading.id} className=\"p-4 hover:bg-gray-50 cursor-pointer\">\r\n                        <div \r\n                          className=\"flex justify-between items-start\"\r\n                          onClick={() => setActiveReading(reading)}\r\n                        >\r\n                          <div>\r\n                            <h4 className=\"font-medium\">{reading.title}</h4>\r\n                            <p className=\"text-sm text-gray-600 mt-1 line-clamp-2\">\r\n                              {reading.content.substring(0, 100)}{reading.content.length > 100 ? '...' : ''}\r\n                            </p>\r\n                            <div className=\"mt-2 flex items-center text-xs text-gray-500\">\r\n                              <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full bg-blue-100 text-blue-800\">\r\n                                {reading.duration}\r\n                              </span>\r\n                              <span className=\"ml-2\">\r\n                                {reading.status === 'draft' ? 'Borrador' : 'Finalizado'}\r\n                              </span>\r\n                            </div>\r\n                          </div>\r\n                          <button \r\n                            className=\"text-gray-400 hover:text-gray-600\"\r\n                            onClick={(e) => {\r\n                              e.stopPropagation();\r\n                              handlePreviewReading(reading.content);\r\n                            }}\r\n                          >\r\n                            <svg className=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n                              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" />\r\n                            </svg>\r\n                          </button>\r\n                        </div>\r\n                      </li>\r\n                    ))}\r\n                  </ul>\r\n                )}\r\n              </div>\r\n              <div className=\"px-4 py-3 bg-gray-50 text-right\">\r\n                <Button\r\n                  onClick={() => setActiveReading({ id: null, title: '', content: '', status: 'draft' })}\r\n                  className=\"text-sm\"\r\n                >\r\n                  + Nueva Lectura\r\n                </Button>\r\n              </div>\r\n            </Card>\r\n          </div>\r\n\r\n          {/* Editor de lecturas */}\r\n          <div className=\"lg:col-span-2\">\r\n            <Card className=\"h-full\">\r\n              {activeReading ? (\r\n                <form onSubmit={handleReadingSave}>\r\n                  <div className=\"px-4 py-5 border-b flex justify-between items-center\">\r\n                    <h3 className=\"text-lg font-medium\">\r\n                      {activeReading.id ? 'Editar Lectura' : 'Nueva Lectura'}\r\n                    </h3>\r\n                    <div className=\"flex space-x-2\">\r\n                      <Button\r\n                        type=\"button\"\r\n                        variant=\"outline\"\r\n                        onClick={() => handlePreviewReading(activeReading.content)}\r\n                        disabled={!activeReading.content}\r\n                      >\r\n                        Vista Previa\r\n                      </Button>\r\n                      <Button type=\"submit\" disabled={!canEdit}>\r\n                        Guardar\r\n                      </Button>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"p-4 space-y-4\">\r\n                    <div>\r\n                      <label htmlFor=\"title\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        T√≠tulo de la lectura\r\n                      </label>\r\n                      <input\r\n                        type=\"text\"\r\n                        id=\"title\"\r\n                        name=\"title\"\r\n                        defaultValue={activeReading.title}\r\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500\"\r\n                        placeholder=\"Ej: Primera Lectura - Carta de San Pablo\"\r\n                        required\r\n                        disabled={!canEdit}\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <label htmlFor=\"content\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                        Contenido\r\n                      </label>\r\n                      <textarea\r\n                        id=\"content\"\r\n                        name=\"content\"\r\n                        rows={12}\r\n                        defaultValue={activeReading.content}\r\n                        onChange={handleContentChange}\r\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 font-serif\"\r\n                        placeholder=\"Escribe aqu√≠ el texto completo de la lectura...\"\r\n                        required\r\n                        disabled={!canEdit}\r\n                      />\r\n                      <p className=\"mt-1 text-sm text-gray-500\">\r\n                        Duraci√≥n estimada: {activeReading.duration}\r\n                      </p>\r\n                    </div>\r\n                    {!canEdit && (\r\n                      <div className=\"p-3 bg-yellow-50 text-yellow-700 text-sm rounded-md\">\r\n                        Solo los ayudantes y wedding planners pueden editar las lecturas.\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </form>\r\n              ) : (\r\n                <div className=\"p-8 text-center text-gray-500\">\r\n                  <svg\r\n                    className=\"mx-auto h-12 w-12 text-gray-400\"\r\n                    fill=\"none\"\r\n                    viewBox=\"0 0 24 24\"\r\n                    stroke=\"currentColor\"\r\n                  >\r\n                    <path\r\n                      strokeLinecap=\"round\"\r\n                      strokeLinejoin=\"round\"\r\n                      strokeWidth={1}\r\n                      d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"\r\n                    />\r\n                  </svg>\r\n                  <h3 className=\"mt-2 text-sm font-medium text-gray-900\">\r\n                    {readings.length === 0 \r\n                      ? 'No hay lecturas disponibles' \r\n                      : 'Selecciona una lectura para editar'}\r\n                  </h3>\r\n                  <p className=\"mt-1 text-sm text-gray-500\">\r\n                    {readings.length === 0 \r\n                      ? 'Comienza creando tu primera lectura para la ceremonia.'\r\n                      : 'O crea una nueva lectura para la ceremonia.'}\r\n                  </p>\r\n                  <div className=\"mt-6\">\r\n                    <Button\r\n                      onClick={() => setActiveReading({ id: null, title: '', content: '', status: 'draft' })}\r\n                      className=\"inline-flex items-center\"\r\n                    >\r\n                      <svg\r\n                        className=\"-ml-1 mr-2 h-5 w-5\"\r\n                        xmlns=\"http://www.w3.org/2000/svg\"\r\n                        viewBox=\"0 0 20 20\"\r\n                        fill=\"currentColor\"\r\n                        aria-hidden=\"true\"\r\n                      >\r\n                        <path\r\n                          fillRule=\"evenodd\"\r\n                          d=\"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z\"\r\n                          clipRule=\"evenodd\"\r\n                        />\r\n                      </svg>\r\n                      Nueva Lectura\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </Card>\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <div className=\"space-y-6\">\r\n          {/* Formulario para a√±adir ramo/sorpresa */}\r\n          <Card>\r\n            <div className=\"px-4 py-5 border-b\">\r\n              <h3 className=\"text-lg font-medium\">A√±adir Ramo o Sorpresa</h3>\r\n            </div>\r\n            <form onSubmit={handleAddSurprise} className=\"p-4\">\r\n              <div className=\"grid grid-cols-1 gap-4 sm:grid-cols-2\">\r\n                <div>\r\n                  <label htmlFor=\"type\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                    Tipo\r\n                  </label>\r\n                  <select\r\n                    id=\"type\"\r\n                    name=\"type\"\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500\"\r\n                    required\r\n                  >\r\n                    <option value=\"\">Seleccionar tipo</option>\r\n                    <option value=\"ramo\">Ramo</option>\r\n                    <option value=\"sorpresa\">Sorpresa</option>\r\n                    <option value=\"detalle\">Detalle Especial</option>\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label htmlFor=\"recipient\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                    Destinatario\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    id=\"recipient\"\r\n                    name=\"recipient\"\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500\"\r\n                    placeholder=\"Ej: Madre de la novia\"\r\n                    required\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label htmlFor=\"table\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                    Mesa\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    id=\"table\"\r\n                    name=\"table\"\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500\"\r\n                    placeholder=\"Ej: Mesa 1\"\r\n                    required\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label htmlFor=\"description\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                    Descripci√≥n\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    id=\"description\"\r\n                    name=\"description\"\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500\"\r\n                    placeholder=\"Ej: Ramo de rosas blancas\"\r\n                    required\r\n                  />\r\n                </div>\r\n                <div className=\"sm:col-span-2\">\r\n                  <label htmlFor=\"notes\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                    Notas adicionales\r\n                  </label>\r\n                  <textarea\r\n                    id=\"notes\"\r\n                    name=\"notes\"\r\n                    rows={2}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500\"\r\n                    placeholder=\"Instrucciones especiales o detalles importantes...\"\r\n                  />\r\n                </div>\r\n              </div>\r\n              <div className=\"mt-4 flex justify-end\">\r\n                <Button type=\"submit\">\r\n                  A√±adir a la lista\r\n                </Button>\r\n              </div>\r\n            </form>\r\n          </Card>\r\n\r\n          {/* Lista de ramos y sorpresas */}\r\n          <Card>\r\n            <div className=\"px-4 py-5 border-b\">\r\n              <h3 className=\"text-lg font-medium\">Lista de Ramos y Sorpresas</h3>\r\n            </div>\r\n            {surprises.length === 0 ? (\r\n              <div className=\"p-6 text-center text-gray-500\">\r\n                <p>No hay ramos o sorpresas programados a√∫n.</p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"overflow-x-auto\">\r\n                <table className=\"min-w-full divide-y divide-gray-200\">\r\n                  <thead className=\"bg-gray-50\">\r\n                    <tr>\r\n                      <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                        Tipo\r\n                      </th>\r\n                      <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                        Destinatario\r\n                      </th>\r\n                      <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                        Mesa\r\n                      </th>\r\n                      <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                        Descripci√≥n\r\n                      </th>\r\n                      <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                        Estado\r\n                      </th>\r\n                      <th scope=\"col\" className=\"relative px-6 py-3\">\r\n                        <span className=\"sr-only\">Acciones</span>\r\n                      </th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                    {surprises.map((surprise) => (\r\n                      <tr key={surprise.id} className=\"hover:bg-gray-50\">\r\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\r\n                          {surprise.type === 'ramo' ? 'Ramo' : surprise.type === 'sorpresa' ? 'Sorpresa' : 'Detalle'}\r\n                        </td>\r\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                          {surprise.recipient}\r\n                        </td>\r\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                          {surprise.table}\r\n                        </td>\r\n                        <td className=\"px-6 py-4 text-sm text-gray-500\">\r\n                          {surprise.description}\r\n                        </td>\r\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                          <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${\r\n                            surprise.status === 'pending' \r\n                              ? 'bg-yellow-100 text-yellow-800' \r\n                              : 'bg-green-100 text-green-800'\r\n                          }`}>\r\n                            {surprise.status === 'pending' ? 'Pendiente' : 'Entregado'}\r\n                          </span>\r\n                        </td>\r\n                        <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\r\n                          <button \r\n                            onClick={() => {\r\n                              // Cambiar estado de entrega\r\n                              const updatedSurprises = surprises.map(s => \r\n                                s.id === surprise.id \r\n                                  ? { ...s, status: s.status === 'pending' ? 'delivered' : 'pending' }\r\n                                  : s\r\n                              );\r\n                              setSurprises(updatedSurprises);\r\n                            }}\r\n                            className=\"text-blue-600 hover:text-blue-900 mr-3\"\r\n                          >\r\n                            {surprise.status === 'pending' ? 'Marcar como entregado' : 'Marcar como pendiente'}\r\n                          </button>\r\n                          <button \r\n                            onClick={() => {\r\n                              if (window.confirm('¬øEst√°s seguro de eliminar este elemento?')) {\r\n                                setSurprises(surprises.filter(s => s.id !== surprise.id));\r\n                              }\r\n                            }}\r\n                            className=\"text-red-600 hover:text-red-900\"\r\n                          >\r\n                            Eliminar\r\n                          </button>\r\n                        </td>\r\n                      </tr>\r\n                    ))}\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n            )}\r\n          </Card>\r\n        </div>\r\n      )}\r\n\r\n      </div>\r\n\r\n      {/* Modal de vista previa */}\r\n      {showReadingPreview && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\r\n          <Card className=\"max-w-2xl w-full max-h-[90vh] flex flex-col\">\r\n            <div className=\"px-6 py-4 border-b flex justify-between items-center\">\r\n              <h3 className=\"text-lg font-medium\">Vista Previa de la Lectura</h3>\r\n              <button \r\n                onClick={() => setShowReadingPreview(false)}\r\n                className=\"text-gray-400 hover:text-gray-500\"\r\n              >\r\n                <span className=\"sr-only\">Cerrar</span>\r\n                <svg className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n            <div className=\"p-6 overflow-y-auto flex-1\">\r\n              <div className=\"prose max-w-none\">\r\n                <p className=\"whitespace-pre-line\">{readingPreview}</p>\r\n              </div>\r\n            </div>\r\n            <div className=\"px-6 py-3 bg-gray-50 text-right\">\r\n              <Button onClick={() => setShowReadingPreview(false)}>\r\n                Cerrar\r\n              </Button>\r\n            </div>\r\n          </Card>\r\n        </div>\r\n      )}\r\n    </PageWrapper>\r\n  );\r\n};\r\n\r\nexport default AyudaCeremonia;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\protocolo\\Checklist.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\protocolo\\MomentosEspeciales.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'ExternalLink' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":69,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":81},{"ruleId":"no-unused-vars","severity":1,"message":"'moveMoment' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":10,"column":74,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":84},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":250,"column":59,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[10965,11015],"text":"Haz clic en &quot;A√±adir momento\" para crear uno nuevo."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[10965,11015],"text":"Haz clic en &ldquo;A√±adir momento\" para crear uno nuevo."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[10965,11015],"text":"Haz clic en &#34;A√±adir momento\" para crear uno nuevo."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[10965,11015],"text":"Haz clic en &rdquo;A√±adir momento\" para crear uno nuevo."},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":250,"column":74,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[10965,11015],"text":"Haz clic en \"A√±adir momento&quot; para crear uno nuevo."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[10965,11015],"text":"Haz clic en \"A√±adir momento&ldquo; para crear uno nuevo."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[10965,11015],"text":"Haz clic en \"A√±adir momento&#34; para crear uno nuevo."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[10965,11015],"text":"Haz clic en \"A√±adir momento&rdquo; para crear uno nuevo."},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { Music, Edit2, Play, Plus, Trash2, Search as SearchIcon, X, ExternalLink, ChevronUp, ChevronDown } from 'lucide-react';\r\nimport { Card } from '../../components/ui';\r\nimport PageWrapper from '../../components/PageWrapper';\r\nimport { Button } from '../../components/ui';\r\nimport useSpecialMoments from '../../hooks/useSpecialMoments';\r\n\r\nconst MomentosEspeciales = () => {\r\n  // Hook para manejar los momentos especiales\r\n  const { moments, addMoment, updateMoment, removeMoment, reorderMoment, moveMoment, duplicateMoment } = useSpecialMoments();\r\n  \r\n  // Estados para las pesta√±as y b√∫squeda\r\n  const [activeTab, setActiveTab] = useState('ceremonia');\r\n  const [search, setSearch] = useState('');\r\n  const [results, setResults] = useState([]);\r\n  const [loadingSearch, setLoadingSearch] = useState(false);\r\n  const [errorSearch, setErrorSearch] = useState(null);\r\n\r\n  // Definici√≥n de las pesta√±as\r\n  const TABS = [\r\n    { key: 'ceremonia', label: 'Ceremonia' },\r\n    { key: 'coctail', label: 'C√≥ctel' },\r\n    { key: 'banquete', label: 'Banquete' },\r\n    { key: 'disco', label: 'Disco' },\r\n  ];\r\n\r\n  // B√∫squeda de canciones usando la API de iTunes\r\n  const handleSearch = async () => {\r\n    const term = search.trim();\r\n    if (!term) {\r\n      setResults([]);\r\n      return;\r\n    }\r\n    \r\n    setLoadingSearch(true);\r\n    setErrorSearch(null);\r\n    \r\n    try {\r\n      const resp = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(term)}&entity=song&limit=15`);\r\n      const data = await resp.json();\r\n      \r\n      if (Array.isArray(data.results)) {\r\n        const mapped = data.results.map(r => ({ id: r.trackId, name: `${r.trackName} - ${r.artistName}` }));\r\n        setResults(mapped);\r\n      } else {\r\n        setResults([]);\r\n      }\r\n    } catch (err) {\r\n      console.error('Error buscando canciones', err);\r\n      setErrorSearch('No se pudo buscar canciones. Int√©ntalo m√°s tarde.');\r\n      setResults([]);\r\n    } finally {\r\n      setLoadingSearch(false);\r\n    }\r\n  };\r\n\r\n  // A√±adir nuevo momento al bloque activo\r\n  const handleAddMoment = () => {\r\n    const nextOrder = (moments[activeTab]?.length || 0) + 1;\r\n    addMoment(activeTab, { \r\n      order: nextOrder, \r\n      title: `Nuevo momento ${nextOrder}`, \r\n      song: '',\r\n      time: ''\r\n    });\r\n  };\r\n\r\n  return (\r\n    <PageWrapper title=\"Momentos Especiales\">\r\n      <div className=\"space-y-6\">\r\n        <p className=\"text-gray-600\">Planifica cada instante clave de tu gran d√≠a con la m√∫sica y el momento adecuados.</p>\r\n        \r\n        {/* Pesta√±as unificadas */}\r\n        <div className=\"border-b flex gap-4\">\r\n          {TABS.map(tab => (\r\n            <button\r\n              key={tab.key}\r\n              className={`pb-2 -mb-px font-medium ${activeTab === tab.key ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-600'}`}\r\n              onClick={() => {\r\n                setActiveTab(tab.key);\r\n                setResults([]);\r\n                setSearch('');\r\n              }}\r\n            >\r\n              {tab.label}\r\n            </button>\r\n          ))}\r\n        </div>\r\n        \r\n        {/* Contenido de la pesta√±a activa */}\r\n        <Card className=\"space-y-5 p-5\">\r\n          {/* Buscador de canciones */}\r\n          <div className=\"flex gap-2 items-center\">\r\n            <input\r\n              type=\"text\"\r\n              value={search}\r\n              onChange={e => setSearch(e.target.value)}\r\n              placeholder=\"Buscar canci√≥n...\"\r\n              className=\"flex-1 border rounded px-3 py-2\"\r\n              onKeyPress={e => e.key === 'Enter' && handleSearch()}\r\n            />\r\n            <button onClick={handleSearch} className=\"bg-blue-600 text-white px-3 py-2 rounded flex items-center gap-1\">\r\n              <SearchIcon size={16} /> Buscar\r\n            </button>\r\n          </div>\r\n\r\n          {/* Estado b√∫squeda */}\r\n          {loadingSearch && <p className=\"text-sm text-gray-500\">Buscando...</p>}\r\n          {errorSearch && <p className=\"text-sm text-red-600\">{errorSearch}</p>}\r\n\r\n          {/* Resultados b√∫squeda */}\r\n          {results.length > 0 && (\r\n            <div className=\"border rounded-md overflow-hidden\">\r\n              <div className=\"bg-gray-50 p-2 border-b text-sm font-medium\">\r\n                Resultados\r\n                <button \r\n                  onClick={() => setResults([])} \r\n                  className=\"float-right text-gray-500 hover:text-gray-700\"\r\n                >\r\n                  <X size={16} />\r\n                </button>\r\n              </div>\r\n              <ul className=\"divide-y\">\r\n                {results.map(song => (\r\n                  <li key={song.id} className=\"p-2 hover:bg-blue-50\">\r\n                    <button \r\n                      className=\"w-full text-left flex justify-between items-center\"\r\n                      onClick={() => {\r\n                        if (!moments[activeTab]?.length) {\r\n                          addMoment(activeTab, { order: 1, title: 'Nuevo momento', song: song.name, time: '' });\r\n                        } else {\r\n                          // Actualizar el √∫ltimo momento a√±adido con la canci√≥n seleccionada\r\n                          const lastMoment = [...(moments[activeTab] || [])].pop();\r\n                          if (lastMoment) {\r\n                            updateMoment(activeTab, lastMoment.id, { ...lastMoment, song: song.name });\r\n                          }\r\n                        }\r\n                        setResults([]);\r\n                        setSearch('');\r\n                      }}\r\n                    >\r\n                      <span className=\"text-sm\">{song.name}</span>\r\n                      <Play size={16} className=\"text-blue-600\" />\r\n                    </button>\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n            </div>\r\n          )}\r\n\r\n          {/* Lista de momentos */}\r\n          <div className=\"space-y-3\">\r\n            <div className=\"flex justify-between items-center\">\r\n              <h3 className=\"font-medium\">{TABS.find(t => t.key === activeTab)?.label || 'Momentos'}</h3>\r\n              <Button\r\n                onClick={handleAddMoment}\r\n                className=\"py-1 px-3 text-sm flex items-center gap-1\"\r\n              >\r\n                <Plus size={14} />\r\n                A√±adir momento\r\n              </Button>\r\n            </div>\r\n            \r\n            <div className=\"space-y-3\">\r\n              {moments[activeTab]?.length ? (\r\n                moments[activeTab]\r\n                  .sort((a, b) => a.order - b.order)\r\n                  .map((moment, idx) => (\r\n                    <div key={moment.id} className=\"border rounded-lg p-3\">\r\n                      <div className=\"flex justify-between gap-2\">\r\n                        <div className=\"flex-1\">\r\n                          <input\r\n                            type=\"text\"\r\n                            className=\"w-full font-medium border-0 border-b border-transparent focus:border-blue-300 focus:ring-0 p-0 pb-1\"\r\n                            value={moment.title || ''}\r\n                            onChange={e => updateMoment(activeTab, moment.id, { ...moment, title: e.target.value })}\r\n                            placeholder=\"T√≠tulo del momento\"\r\n                          />\r\n                          \r\n                          <div className=\"mt-2 flex flex-wrap gap-2\">\r\n                            <div className=\"flex-1 min-w-[200px]\">\r\n                              <div className=\"text-xs text-gray-500 mb-1 flex items-center gap-1\">\r\n                                <Music size={12} /> Canci√≥n\r\n                              </div>\r\n                              <input\r\n                                type=\"text\"\r\n                                className=\"w-full border rounded px-2 py-1 text-sm\"\r\n                                value={moment.song || ''}\r\n                                onChange={e => updateMoment(activeTab, moment.id, { ...moment, song: e.target.value })}\r\n                                placeholder=\"Nombre de la canci√≥n\"\r\n                              />\r\n                            </div>\r\n                            \r\n                            <div className=\"w-24\">\r\n                              <div className=\"text-xs text-gray-500 mb-1\">Duraci√≥n</div>\r\n                              <input\r\n                                type=\"text\"\r\n                                className=\"w-full border rounded px-2 py-1 text-sm\"\r\n                                value={moment.time || ''}\r\n                                onChange={e => updateMoment(activeTab, moment.id, { ...moment, time: e.target.value })}\r\n                                placeholder=\"00:00\"\r\n                              />\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex flex-col gap-1\">\r\n                          <button \r\n                            onClick={() => removeMoment(activeTab, moment.id)}\r\n                            className=\"text-gray-400 hover:text-red-500 p-1\"\r\n                            title=\"Eliminar\"\r\n                          >\r\n                            <Trash2 size={16} />\r\n                          </button>\r\n                          \r\n                          <button \r\n                            onClick={() => duplicateMoment(activeTab, moment.id)}\r\n                            className=\"text-gray-400 hover:text-blue-500 p-1\"\r\n                            title=\"Duplicar\"\r\n                          >\r\n                            <Edit2 size={16} />\r\n                          </button>\r\n                          \r\n                          {idx > 0 && (\r\n                            <button \r\n                              onClick={() => reorderMoment(activeTab, moment.id, 'up')}\r\n                              className=\"text-gray-400 hover:text-blue-600 p-1\"\r\n                              title=\"Mover arriba\"\r\n                            >\r\n                              <ChevronUp size={16} />\r\n                            </button>\r\n                          )}\r\n                          \r\n                          {idx < moments[activeTab].length - 1 && (\r\n                            <button \r\n                              onClick={() => reorderMoment(activeTab, moment.id, 'down')}\r\n                              className=\"text-gray-400 hover:text-blue-600 p-1\"\r\n                              title=\"Mover abajo\"\r\n                            >\r\n                              <ChevronDown size={16} />\r\n                            </button>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))\r\n              ) : (\r\n                <div className=\"text-center py-6 text-gray-500\">\r\n                  <p>No hay momentos en esta secci√≥n.</p>\r\n                  <p className=\"text-sm mt-1\">Haz clic en \"A√±adir momento\" para crear uno nuevo.</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </Card>\r\n      </div>\r\n    </PageWrapper>\r\n  );\r\n};\r\n\r\nexport default MomentosEspeciales;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\protocolo\\ProtocoloLayout.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Card' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":12},{"ruleId":"react/display-name","severity":2,"message":"Component definition is missing display name","line":11,"column":25,"nodeType":"CallExpression","messageId":"noDisplayName","endLine":76,"endColumn":3}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useMemo } from 'react';\r\nimport { NavLink, Outlet, useLocation, useNavigate } from 'react-router-dom';\r\nimport Card from '../../components/Card';\r\n\r\n// Definici√≥n est√°tica de las pesta√±as para evitar recreaciones\r\nconst tabs = [\r\n  { path: 'momentos-especiales', label: 'Momentos Especiales' },\r\n];\r\n\r\n// Componente memoizado para evitar renders innecesarios\r\nconst ProtocoloLayout = React.memo(() => {\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n\r\n  /* Redirigir a la primera pesta√±a si estamos en la ra√≠z de protocolo */\r\n  useEffect(() => {\r\n    if (location.pathname === '/protocolo' || location.pathname === '/protocolo/') {\r\n      navigate('/protocolo/momentos-especiales', { replace: true });\r\n    }\r\n  }, [location.pathname, navigate]);\r\n\r\n  // Memoizamos la lista de pesta√±as con sus rutas completas\r\n  const navTabs = useMemo(() => tabs.map(t => ({ ...t, href: `/protocolo/${t.path}` })), []);\r\n\r\n  // Placeholder de carga accesible\r\n  if (location.pathname === '/protocolo' || location.pathname === '/protocolo/') {\r\n    return (\r\n      <div className=\"p-4 md:p-6\" role=\"status\" aria-live=\"polite\">\r\n        Cargando...\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <section className=\"p-4 md:p-6 flex flex-col gap-8\" aria-labelledby=\"protocolo-heading\">\r\n      {/* T√≠tulo y navegaci√≥n solo si hay m√°s de una secci√≥n */}\r\n      {navTabs.length > 1 && (\r\n        <>\r\n          <h1 id=\"protocolo-heading\" className=\"text-2xl font-bold text-gray-800\">\r\n            {navTabs.find(t => location.pathname.startsWith(t.href))?.label || 'Protocolo'}\r\n          </h1>\r\n          <nav role=\"tablist\" aria-label=\"Secciones de Protocolo\" className=\"flex overflow-x-auto space-x-2 pb-2\">\r\n            {navTabs.map(tab => (\r\n              <NavLink\r\n                key={tab.path}\r\n                to={tab.href}\r\n                role=\"tab\"\r\n                aria-current={location.pathname === tab.href ? 'page' : undefined}\r\n                className={({ isActive }) =>\r\n                  `px-4 py-2 rounded-t-lg font-medium whitespace-nowrap focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-blue-500 ${\r\n                    isActive\r\n                      ? 'bg-white border-t-2 border-l-2 border-r-2 border-blue-500 text-blue-600 font-semibold'\r\n                      : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\r\n                  }`\r\n                }\r\n              >\r\n                {tab.label}\r\n              </NavLink>\r\n            ))}\r\n          </nav>\r\n        </>\r\n\r\n      )}\r\n\r\n      {/* Contenido - Ya no envuelto en Card para permitir a cada componente tener sus propios Cards */}\r\n      <div className=\"focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500\" role=\"region\" aria-label=\"Contenido de Protocolo\">\r\n        <Outlet />\r\n      </div>\r\n\r\n      {/* Ruta actual solo visible para accesibilidad */}\r\n      <p className=\"sr-only\" data-testid=\"current-path\">\r\n        Ruta actual: {location.pathname}\r\n      </p>\r\n    </section>\r\n  );\r\n});\r\n\r\nexport default ProtocoloLayout;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\protocolo\\Timing.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'PageWrapper' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { Card } from '../../components/ui';\r\nimport { Button } from '../../components/ui';\r\nimport PageWrapper from '../../components/PageWrapper';\r\n\r\nconst Timing = () => {\r\n  const [timeline, setTimeline] = useState([\r\n    {\r\n      id: 'ceremonia',\r\n      name: 'Ceremonia',\r\n      startTime: '16:00',\r\n      endTime: '16:45',\r\n      status: 'on-time', // 'on-time', 'slightly-delayed', 'delayed'\r\n      moments: [\r\n        { id: 1, name: 'Llegada de invitados', time: '15:30', duration: '30 min', status: 'on-time' },\r\n        { id: 2, name: 'Entrada de la novia', time: '16:00', duration: '5 min', status: 'on-time' },\r\n        { id: 3, name: 'Lecturas', time: '16:20', duration: '10 min', status: 'on-time' },\r\n      ],\r\n    },\r\n    {\r\n      id: 'coctel',\r\n      name: 'C√≥ctel',\r\n      startTime: '17:00',\r\n      endTime: '19:00',\r\n      status: 'on-time',\r\n      moments: [\r\n        { id: 4, name: 'Brindis de bienvenida', time: '17:15', duration: '15 min', status: 'on-time' },\r\n        { id: 5, name: 'Fotos de grupo', time: '17:45', duration: '30 min', status: 'on-time' },\r\n      ],\r\n    },\r\n    // ... otros bloques\r\n  ]);\r\n\r\n  const getStatusColor = (status) => {\r\n    switch (status) {\r\n      case 'on-time': return 'bg-green-100 text-green-800';\r\n      case 'slightly-delayed': return 'bg-blue-100 text-blue-800';\r\n      case 'delayed': return 'bg-red-100 text-red-800';\r\n      default: return 'bg-gray-100 text-gray-800';\r\n    }\r\n  };\r\n\r\n  const getStatusLabel = (status) => {\r\n    switch (status) {\r\n      case 'on-time': return 'A tiempo';\r\n      case 'slightly-delayed': return 'Ligero retraso';\r\n      case 'delayed': return 'Retrasado';\r\n      default: return 'Sin estado';\r\n    }\r\n  };\r\n\r\n  const updateTiming = (blockId, momentId, newTime) => {\r\n    setTimeline(timeline.map(block => {\r\n      if (block.id === blockId) {\r\n        return {\r\n          ...block,\r\n          moments: block.moments.map(moment => \r\n            moment.id === momentId ? { ...moment, time: newTime } : moment\r\n          )\r\n        };\r\n      }\r\n      return block;\r\n    }));\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-4 md:p-6 space-y-6\">\r\n      <div className=\"flex justify-between items-center\">\r\n        <h1 className=\"text-2xl font-bold text-gray-800\">Timing de la Boda</h1>\r\n        <Button>\r\n          <svg className=\"w-4 h-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6v6m0 0v6m0-6h6m-6 0H6\" />\r\n          </svg>\r\n          A√±adir Bloque\r\n        </Button>\r\n      </div>\r\n      \r\n      <Card className=\"p-4\">\r\n        <p className=\"text-gray-600\">Organiza la l√≠nea de tiempo de tu boda</p>\r\n      </Card>\r\n\r\n      <div className=\"space-y-6\">\r\n        {timeline.map((block) => (\r\n          <Card key={block.id} className=\"overflow-hidden\">\r\n            <div className=\"px-6 py-4 border-b flex justify-between items-center\">\r\n              <h3 className=\"text-lg font-medium\">{block.name}</h3>\r\n              <div className=\"flex items-center space-x-4\">\r\n                <span className={`px-3 py-1 rounded-full text-xs font-medium ${getStatusColor(block.status)}`}>\r\n                  {getStatusLabel(block.status)}\r\n                </span>\r\n                <span className=\"text-sm text-gray-600\">\r\n                  {block.startTime} - {block.endTime}\r\n                </span>\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"divide-y\">\r\n              {block.moments.map((moment) => (\r\n                <div key={moment.id} className=\"p-4 hover:bg-gray-50 transition-colors\">\r\n                  <div className=\"flex items-start justify-between\">\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"flex items-center space-x-3\">\r\n                        <div className={`w-3 h-3 rounded-full ${getStatusColor(moment.status).split(' ')[0]}`}></div>\r\n                        <h4 className=\"font-medium\">{moment.name}</h4>\r\n                      </div>\r\n                      <div className=\"ml-6 mt-1 text-sm text-gray-600\">\r\n                        <span className=\"inline-block mr-4\">\r\n                          <span className=\"font-medium\">Hora:</span> {moment.time}\r\n                        </span>\r\n                        <span className=\"inline-block\">\r\n                          <span className=\"font-medium\">Duraci√≥n:</span> {moment.duration}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex space-x-2\">\r\n                      <button \r\n                        className=\"p-1 text-gray-400 hover:text-gray-600\"\r\n                        onClick={() => {\r\n                          const newTime = prompt('Nueva hora (HH:MM):', moment.time);\r\n                          if (newTime) updateTiming(block.id, moment.id, newTime);\r\n                        }}\r\n                      >\r\n                        <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" />\r\n                        </svg>\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n            \r\n            <div className=\"px-6 py-3 bg-gray-50 text-right\">\r\n              <button className=\"text-sm text-blue-600 hover:text-blue-800 font-medium\">\r\n                + A√±adir momento\r\n              </button>\r\n            </div>\r\n          </Card>\r\n        ))}\r\n      </div>\r\n      \r\n      <Card className=\"p-4 bg-blue-50\">\r\n        <div className=\"space-y-2\">\r\n          <h3 className=\"font-medium text-blue-800 flex items-center\">\r\n            <svg className=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            Consejo de planificaci√≥n\r\n          </h3>\r\n          <p className=\"text-sm text-blue-700\">\r\n            Aseg√∫rate de incluir tiempos de transici√≥n entre eventos. Como regla general, a√±ade un 10-15% de tiempo extra a cada bloque para imprevistos.\r\n          </p>\r\n        </div>\r\n      </Card>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Timing;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\user\\EmailInbox.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Tag' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":69,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":72},{"ruleId":"no-unused-vars","severity":1,"message":"'removeEmailFromFolder' is defined but never used. Allowed unused vars must match /^_/u.","line":30,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":24},{"ruleId":"no-unused-vars","severity":1,"message":"'getEmailTagsDetails' is defined but never used. Allowed unused vars must match /^_/u.","line":36,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":36,"endColumn":22},{"ruleId":"no-unused-vars","severity":1,"message":"'error' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":66,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":66,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'emailUsername' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":71,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":71,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'searchFilters' is not defined.","line":213,"column":11,"nodeType":"Identifier","messageId":"undef","endLine":213,"endColumn":24},{"ruleId":"no-undef","severity":2,"message":"'searchFilters' is not defined.","line":217,"column":11,"nodeType":"Identifier","messageId":"undef","endLine":217,"endColumn":24},{"ruleId":"no-undef","severity":2,"message":"'searchTerm' is not defined.","line":222,"column":11,"nodeType":"Identifier","messageId":"undef","endLine":222,"endColumn":21},{"ruleId":"no-undef","severity":2,"message":"'searchTerm' is not defined.","line":223,"column":22,"nodeType":"Identifier","messageId":"undef","endLine":223,"endColumn":32},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":324,"column":19,"nodeType":"BlockStatement","messageId":"unexpected","endLine":324,"endColumn":21,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[12305,12305],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'filteredEmails' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":492,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":492,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'emailId' is defined but never used. Allowed unused args must match /^_/u.","line":809,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":809,"endColumn":41}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * DEPRECATED: Esta bandeja avanzada ha quedado obsoleta. Usa `UnifiedEmail` (/email).\r\n * Retenida temporalmente por compatibilidad con pruebas anteriores.\r\n */\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Mail, Inbox, Send, Trash, Edit, Search, RefreshCw, Filter, Tag, BarChart2, ArrowLeft, File } from 'lucide-react';\r\nimport { toast, ToastContainer } from 'react-toastify';\r\nimport 'react-toastify/dist/ReactToastify.css';\r\nimport Button from '../../components/Button';\r\nimport Card from '../../components/Card';\r\nimport { getMails, initEmailService, markAsRead } from '../../services/emailService';\r\nimport ComposeEmailModal from '../../components/email/ComposeEmailModal';\r\nimport EmailList from '../../components/email/EmailList';\r\nimport EmailDetail from '../../components/email/EmailDetail';\r\nimport EmailFilters from '../../components/email/EmailFilters';\r\nimport CustomFolders from '../../components/email/CustomFolders';\r\nimport ManageFoldersModal from '../../components/email/ManageFoldersModal';\r\nimport EmptyTrashModal from '../../components/email/EmptyTrashModal';\r\nimport { useAuth } from '../../hooks/useAuthUnified';\r\nimport useEmailUsername from '../../hooks/useEmailUsername';\r\nimport { auth } from '../../lib/firebase';\r\nimport { onAuthStateChanged } from 'firebase/auth';\r\nimport { \r\n  getUserFolders, \r\n  createFolder, \r\n  renameFolder, \r\n  deleteFolder, \r\n  assignEmailToFolder, \r\n  removeEmailFromFolder, \r\n  getEmailsInFolder, \r\n  updateFolderUnreadCount \r\n} from '../../services/folderService';\r\nimport {\r\n  getUserTags,\r\n  getEmailTagsDetails,\r\n  getEmailsByTag\r\n} from '../../services/tagService';\r\nimport TagsSidebar from '../../components/email/TagsSidebar';\r\nimport TagsManager from '../../components/email/TagsManager';\r\n\r\n/**\r\n * P√°gina de bandeja de entrada de correo electr√≥nico para usuarios\r\n * Permite ver, enviar y gestionar correos dentro de la plataforma Lovenda\r\n */\r\nconst EmailInbox = () => {\r\n  // Base del backend (si est√° configurado)\r\n  const API_BASE = import.meta.env.VITE_BACKEND_BASE_URL || '';\r\n  const [emails, setEmails] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [selectedEmail, setSelectedEmail] = useState(null);\r\n  const [currentFolder, setCurrentFolder] = useState('inbox');\r\n  const [isComposeOpen, setIsComposeOpen] = useState(false);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [userEmailAddress, setUserEmailAddress] = useState('');\r\n  const [activeFilters, setActiveFilters] = useState({});\r\n  const [showAdvancedFilters, setShowAdvancedFilters] = useState(false);\r\n  const [customFolders, setCustomFolders] = useState([]);\r\n  const [selectedCustomFolder, setSelectedCustomFolder] = useState(null);\r\n  const [showManageFolders, setShowManageFolders] = useState(false);\r\n  const [showManageTags, setShowManageTags] = useState(false);\r\n  const [showEmptyTrashModal, setShowEmptyTrashModal] = useState(false);\r\n  const [availableTags, setAvailableTags] = useState([]);\r\n  const [selectedTag, setSelectedTag] = useState(null);\r\n  const [isFilteringByTag, setIsFilteringByTag] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const { currentUser, userProfile } = useAuth();\r\n  const navigate = useNavigate();\r\n  const { getCurrentUsername } = useEmailUsername();\r\n  const [myEmail, setMyEmail] = useState('');\r\n  const [emailUsername, setEmailUsername] = useState('');\r\n\r\n  // Inicializa servicio de email usando el mismo patr√≥n que MailboxPage\r\n  useEffect(() => {\r\n    const unsub = onAuthStateChanged(auth, async (user) => {\r\n      if (!user) return;\r\n      try {\r\n        const username = await getCurrentUsername();\r\n        if (!username) return;\r\n        const email = `${username}@mywed360.com`;\r\n        setEmailUsername(username);\r\n        setMyEmail(email);\r\n        setUserEmailAddress(email);\r\n        await initEmailService({ uid: user.uid, emailUsername: username, myWed360Email: email });\r\n      } catch (e) {\r\n        console.error('Error inicializando servicio de email:', e);\r\n      }\r\n    });\r\n    return () => unsub();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  // Cargar correos cuando se obtenga la direcci√≥n de email del usuario\r\n  useEffect(() => {\r\n    if (myEmail && currentUser) {\r\n      loadEmails();\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [myEmail]);\r\n  \r\n  // Cargar emails al cambiar de carpeta\r\n  useEffect(() => {\r\n    const loadEmails = async () => {\r\n      if (!currentUser) {\r\n        return;\r\n      }\r\n      \r\n      try {\r\n        setLoading(true);\r\n        \r\n        // Usar email derivado del usuario autenticado (mismo patr√≥n que MailboxPage)\r\n        const effectiveEmail = myEmail;\r\n        if (!effectiveEmail) {\r\n          setEmails([]);\r\n          return;\r\n        }\r\n        \r\n        // Intentar cargar desde backend primero (si hay API_BASE)\r\n        if (API_BASE) {\r\n          if (selectedCustomFolder) {\r\n            const folderEmails = getEmailsInFolder(currentUser.uid, selectedCustomFolder);\r\n            const resAll = await fetch(`${API_BASE}/api/email/all?user=${encodeURIComponent(effectiveEmail)}`);\r\n            if (resAll.ok) {\r\n              const json = await resAll.json();\r\n              const filtered = (json.data || []).filter(email => folderEmails.includes(email.id));\r\n              setEmails(filtered);\r\n              return;\r\n            }\r\n            // Fallback a servicio local si falla\r\n            const allEmails = await getMails('all');\r\n            const filteredEmails = allEmails.filter(email => folderEmails.includes(email.id));\r\n            setEmails(filteredEmails);\r\n            return;\r\n          } else {\r\n            const res = await fetch(`${API_BASE}/api/email/${currentFolder}?user=${encodeURIComponent(effectiveEmail)}`);\r\n            if (res.ok) {\r\n              const json = await res.json();\r\n              if (Array.isArray(json.data) && json.data.length > 0) {\r\n                setEmails(json.data);\r\n                return;\r\n              }\r\n              // Si backend responde vac√≠o, continuamos al fallback local\r\n            }\r\n          }\r\n        }\r\n        \r\n        // Fallback a servicio local si no hay API o falla\r\n        const emailData = selectedCustomFolder\r\n          ? (await getMails('all')).filter(email => getEmailsInFolder(currentUser.uid, selectedCustomFolder).includes(email.id))\r\n          : await getMails(currentFolder);\r\n        setEmails(emailData);\r\n      } catch (error) {\r\n        console.error('Error al cargar emails:', error);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    \r\n    loadEmails();\r\n  }, [currentUser, userProfile, currentFolder, selectedCustomFolder]);\r\n  \r\n  // Cargar correos cuando cambie la carpeta o etiqueta\r\n  useEffect(() => {\r\n    if (!currentUser) return;\r\n    \r\n    // Cargar carpetas personalizadas\r\n    setCustomFolders(getUserFolders(currentUser.uid));\r\n    \r\n    // Cargar etiquetas disponibles\r\n    const tags = getUserTags(currentUser.uid);\r\n    setAvailableTags(tags);\r\n    \r\n    // Cargar correos con los nuevos filtros\r\n    loadEmails();\r\n  }, [currentUser, currentFolder, selectedCustomFolder, selectedTag]);\r\n  \r\n  // Funci√≥n para cargar los correos seg√∫n filtros actuales\r\n  const loadEmails = async () => {\r\n    if (!currentUser) return;\r\n    \r\n    try {\r\n      setLoading(true);\r\n      setError('');\r\n      \r\n      let loadedEmails;\r\n      \r\n      // Primer paso: filtrar por carpeta\r\n      if (selectedCustomFolder) {\r\n        // Cargar correos de la carpeta personalizada\r\n        const folderEmailIds = getEmailsInFolder(currentUser.uid, selectedCustomFolder);\r\n        const allEmails = await getMails('all');\r\n        loadedEmails = allEmails.filter(email => folderEmailIds.includes(email.id));\r\n      } else {\r\n        // Cargar correos seg√∫n la carpeta del sistema\r\n        loadedEmails = await getMails(currentFolder);\r\n      }\r\n      \r\n      // Segundo paso: filtrar por etiqueta si est√° seleccionada\r\n      if (selectedTag && isFilteringByTag) {\r\n        // Obtener IDs de correos con esta etiqueta\r\n        const taggedEmailIds = getEmailsByTag(currentUser.uid, selectedTag);\r\n        \r\n        // Filtrar los correos que tienen esta etiqueta\r\n        loadedEmails = loadedEmails.filter(email => taggedEmailIds.includes(email.id));\r\n      }\r\n      \r\n      // Aplicar filtros adicionales si est√°n activos\r\n      if (activeFilters && Object.keys(activeFilters).length > 0) {\r\n        // Filtros existentes...\r\n      }\r\n      \r\n      // Aplicar filtros r√°pidos si est√°n activos\r\n      if (searchFilters.unread) {\r\n        loadedEmails = loadedEmails.filter(email => !email.read);\r\n      }\r\n      \r\n      if (searchFilters.hasAttachments) {\r\n        loadedEmails = loadedEmails.filter(email => email.attachments && email.attachments.length > 0);\r\n      }\r\n      \r\n      // Aplicar b√∫squeda por texto si hay alguno\r\n      if (searchTerm) {\r\n        const term = searchTerm.toLowerCase();\r\n        loadedEmails = loadedEmails.filter(email => \r\n          email.subject.toLowerCase().includes(term) ||\r\n          email.from.toLowerCase().includes(term) ||\r\n          email.to.toLowerCase().includes(term) ||\r\n          (email.body && email.body.toLowerCase().includes(term))\r\n        );\r\n      }\r\n      \r\n      // Establecer correos filtrados\r\n      setEmails(loadedEmails);\r\n    } catch (error) {\r\n      console.error('Error al cargar emails:', error);\r\n      setError('No se pudieron cargar los correos');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n  \r\n  // Funci√≥n para refrescar la lista de correos\r\n  const handleRefresh = async () => {\r\n    await loadEmails();\r\n    \r\n    // Refrescar lista de carpetas\r\n    const folders = getUserFolders(currentUser.uid);\r\n    setCustomFolders(folders);\r\n    \r\n    toast.info('Correos actualizados');\r\n  };\r\n  \r\n  // Manejar selecci√≥n de etiqueta\r\n  const handleSelectTag = async (tagId) => {\r\n    setSelectedTag(tagId);\r\n    setIsFilteringByTag(true);\r\n    setCurrentFolder(null);\r\n    setSelectedCustomFolder(null);\r\n\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch(`${API_BASE}/api/email/filter/tag/${tagId}${userEmailAddress ? `?user=${encodeURIComponent(userEmailAddress)}` : ''}`);\r\n      if (res.ok) {\r\n        const json = await res.json();\r\n        setEmails(json.data || []);\r\n      } else {\r\n        await loadEmails();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al filtrar por etiqueta:', error);\r\n      await loadEmails();\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Limpiar filtro de etiqueta\r\n  const handleClearTagFilter = async () => {\r\n    setSelectedTag(null);\r\n    setIsFilteringByTag(false);\r\n    setCurrentFolder('inbox');\r\n    setSelectedCustomFolder(null);\r\n    try {\r\n      setLoading(true);\r\n      const res = await fetch(`${API_BASE}/api/email/inbox${userEmailAddress ? `?user=${encodeURIComponent(userEmailAddress)}` : ''}`);\r\n      if (res.ok) {\r\n        const json = await res.json();\r\n        setEmails(json.data || []);\r\n      } else {\r\n        await loadEmails();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al limpiar filtro de etiqueta:', error);\r\n      await loadEmails();\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Cargar bandeja de entrada y etiquetas desde backend (para tests)\r\n  useEffect(() => {\r\n    if (!currentUser) return;\r\n    const fetchInitialData = async () => {\r\n      try {\r\n        // Bandeja de entrada\r\n        const inboxRes = await fetch(`${API_BASE}/api/email/inbox${userEmailAddress ? `?user=${encodeURIComponent(userEmailAddress)}` : ''}`);\r\n        if (inboxRes.ok) {\r\n          const inboxJson = await inboxRes.json();\r\n          setEmails(inboxJson.data || []);\r\n        }\r\n      } catch (e) {\r\n        // Fallback local\r\n        const localEmails = await getMails('inbox');\r\n        setEmails(localEmails);\r\n      }\r\n\r\n      try {\r\n        const res = await fetch(`${API_BASE}/api/tags${userEmailAddress ? `?user=${encodeURIComponent(userEmailAddress)}` : ''}`);\r\n        if (res.ok) {\r\n          const json = await res.json();\r\n          setAvailableTags(json.data || []);\r\n          return;\r\n        }\r\n      } catch (_) {}\r\n      // Fallback\r\n      setAvailableTags(getUserTags(currentUser.uid));\r\n    };\r\n    fetchInitialData();\r\n  }, [currentUser]);  \r\n\r\n  // Funci√≥n para seleccionar un correo\r\n  const handleSelectEmail = async (email) => {\r\n    setSelectedEmail(email);\r\n    \r\n    // Marcar como le√≠do si no lo est√°\r\n    if (!email.read) {\r\n      try {\r\n        await markAsRead(email.id);\r\n        // Actualizar el estado local\r\n        setEmails(emails.map(e => \r\n          e.id === email.id ? { ...e, read: true } : e\r\n        ));\r\n        \r\n        // Si est√° en una carpeta personalizada, actualizar contador\r\n        if (selectedCustomFolder) {\r\n          // Contar no le√≠dos en la carpeta\r\n          const folderEmails = getEmailsInFolder(currentUser.uid, selectedCustomFolder);\r\n          const unreadCount = emails.filter(e => \r\n            folderEmails.includes(e.id) && !e.read && e.id !== email.id\r\n          ).length;\r\n          \r\n          // Actualizar contador\r\n          updateFolderUnreadCount(currentUser.uid, selectedCustomFolder, unreadCount);\r\n          \r\n          // Actualizar lista de carpetas\r\n          setCustomFolders(getUserFolders(currentUser.uid));\r\n        }\r\n      } catch (error) {\r\n        console.error('Error al marcar correo como le√≠do:', error);\r\n      }\r\n    }\r\n  };\r\n  \r\n  // Aplicar filtros avanzados\r\n  const applyFilters = (filters) => {\r\n    setActiveFilters(filters);\r\n    setShowAdvancedFilters(false); // Opcional: ocultar panel al aplicar\r\n  };\r\n  \r\n  // Resetear filtros\r\n  const resetFilters = () => {\r\n    setActiveFilters({});\r\n  };\r\n  \r\n  // Manejar creaci√≥n de carpeta\r\n  const handleCreateFolder = (folderName) => {\r\n    if (!currentUser) return;\r\n    \r\n    try {\r\n      // Crear nueva carpeta\r\n      createFolder(currentUser.uid, folderName);\r\n      \r\n      // Actualizar lista de carpetas\r\n      setCustomFolders(getUserFolders(currentUser.uid));\r\n      \r\n      // Mostrar notificaci√≥n de √©xito\r\n      toast.success(`Carpeta \"${folderName}\" creada con √©xito`);\r\n    } catch (error) {\r\n      console.error('Error al crear carpeta:', error);\r\n      toast.error(`Error: ${error.message || 'No se pudo crear la carpeta'}`);\r\n    }\r\n  };\r\n  \r\n  // Manejar renombrado de carpeta\r\n  const handleRenameFolder = (folderId, newName) => {\r\n    if (!currentUser) return;\r\n    \r\n    try {\r\n      // Obtener nombre anterior\r\n      const oldFolder = customFolders.find(f => f.id === folderId);\r\n      \r\n      // Renombrar carpeta\r\n      renameFolder(currentUser.uid, folderId, newName);\r\n      \r\n      // Actualizar lista de carpetas\r\n      setCustomFolders(getUserFolders(currentUser.uid));\r\n      \r\n      // Mostrar notificaci√≥n de √©xito\r\n      toast.success(`Carpeta \"${oldFolder?.name || 'desconocida'}\" renombrada a \"${newName}\"`);\r\n    } catch (error) {\r\n      console.error('Error al renombrar carpeta:', error);\r\n      toast.error(`Error: ${error.message || 'No se pudo renombrar la carpeta'}`);\r\n    }\r\n  };\r\n  \r\n  // Manejar eliminaci√≥n de carpeta\r\n  const handleDeleteFolder = (folderId) => {\r\n    if (!currentUser) return;\r\n    \r\n    try {\r\n      // Obtener nombre de la carpeta\r\n      const folder = customFolders.find(f => f.id === folderId);\r\n      const folderName = folder?.name || 'desconocida';\r\n      \r\n      // Eliminar carpeta\r\n      deleteFolder(currentUser.uid, folderId);\r\n      \r\n      // Si estamos viendo esta carpeta, volver a la bandeja de entrada\r\n      if (selectedCustomFolder === folderId) {\r\n        setSelectedCustomFolder(null);\r\n        setCurrentFolder('inbox');\r\n      }\r\n      \r\n      // Actualizar lista de carpetas\r\n      setCustomFolders(getUserFolders(currentUser.uid));\r\n      \r\n      // Mostrar notificaci√≥n de √©xito\r\n      toast.success(`Carpeta \"${folderName}\" eliminada correctamente`);\r\n    } catch (error) {\r\n      console.error('Error al eliminar carpeta:', error);\r\n      toast.error(`Error: ${error.message || 'No se pudo eliminar la carpeta'}`);\r\n    }\r\n  };\r\n  \r\n  // Manejar selecci√≥n de carpeta personalizada\r\n  const handleSelectCustomFolder = (folderId) => {\r\n    setSelectedCustomFolder(folderId);\r\n    setCurrentFolder(null); // Desactivar carpetas del sistema\r\n    setSelectedTag(null);\r\n    setIsFilteringByTag(false)\r\n  };\r\n  \r\n  // Manejar selecci√≥n de carpeta del sistema\r\n  const handleSelectSystemFolder = (folder) => {\r\n    setCurrentFolder(folder);\r\n    setSelectedCustomFolder(null); // Desactivar carpetas personalizadas\r\n    setSelectedTag(null);\r\n    setIsFilteringByTag(false)\r\n  };\r\n  \r\n  // Manejar movimiento de correo a carpeta\r\n  const handleMoveToFolder = (emailId, folderId) => {\r\n    if (!currentUser || !emailId) return;\r\n    \r\n    try {\r\n      // Encontrar nombres para el mensaje\r\n      const email = emails.find(e => e.id === emailId);\r\n      const folder = customFolders.find(f => f.id === folderId);\r\n      \r\n      if (!folder) {\r\n        toast.error('No se encontr√≥ la carpeta seleccionada.');\r\n        return;\r\n      }\r\n      \r\n      // Asignar correo a carpeta\r\n      assignEmailToFolder(currentUser.uid, emailId, folderId);\r\n      \r\n      // Mostrar notificaci√≥n de √©xito\r\n      toast.success(`Correo \"${email?.subject || 'Sin asunto'}\" movido a carpeta \"${folder.name}\"`);\r\n      \r\n      // Si estamos viendo una carpeta personalizada, refrescar\r\n      if (selectedCustomFolder) {\r\n        handleRefresh();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al mover correo a carpeta:', error);\r\n      toast.error(`Error: ${error.message || 'No se pudo mover el correo a la carpeta'}`);\r\n    }\r\n  };\r\n  \r\n  // Filtrar emails seg√∫n b√∫squeda y filtros avanzados\r\n  const filteredEmails = emails.filter(email => {\r\n    // Primero aplicar el filtro de b√∫squeda general\r\n    if (searchQuery && !(\r\n        email.subject?.toLowerCase().includes(searchQuery.toLowerCase()) || \r\n        email.from?.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        email.to?.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        email.body?.toLowerCase().includes(searchQuery.toLowerCase())\r\n      )) {\r\n      return false;\r\n    }\r\n    \r\n    // Aplicar filtros avanzados si est√°n activos\r\n    if (Object.keys(activeFilters).length > 0) {\r\n      // Filtro por remitente\r\n      if (activeFilters.from && \r\n          !email.from?.toLowerCase().includes(activeFilters.from.toLowerCase())) {\r\n        return false;\r\n      }\r\n      \r\n      // Filtro por destinatario\r\n      if (activeFilters.to && \r\n          !email.to?.toLowerCase().includes(activeFilters.to.toLowerCase())) {\r\n        return false;\r\n      }\r\n      \r\n      // Filtro por asunto\r\n      if (activeFilters.subject && \r\n          !email.subject?.toLowerCase().includes(activeFilters.subject.toLowerCase())) {\r\n        return false;\r\n      }\r\n      \r\n      // Filtro por adjuntos\r\n      if (activeFilters.hasAttachment && \r\n          (!email.attachments || email.attachments.length === 0)) {\r\n        return false;\r\n      }\r\n      \r\n      // Filtro por fecha desde\r\n      if (activeFilters.dateFrom) {\r\n        const dateFrom = new Date(activeFilters.dateFrom);\r\n        const emailDate = new Date(email.date);\r\n        if (emailDate < dateFrom) return false;\r\n      }\r\n      \r\n      // Filtro por fecha hasta\r\n      if (activeFilters.dateTo) {\r\n        const dateTo = new Date(activeFilters.dateTo);\r\n        const emailDate = new Date(email.date);\r\n        if (emailDate > dateTo) return false;\r\n      }\r\n      \r\n      // Filtro por no le√≠dos\r\n      if (activeFilters.isUnread && email.read) {\r\n        return false;\r\n      }\r\n      \r\n      // Filtro por etiquetas\r\n      if (activeFilters.labels && activeFilters.labels.length > 0) {\r\n        if (!email.labels) return false;\r\n        \r\n        // Verificar si el email tiene al menos una de las etiquetas seleccionadas\r\n        const hasMatchingLabel = activeFilters.labels.some(label => \r\n          email.labels.includes(label)\r\n        );\r\n        \r\n        if (!hasMatchingLabel) return false;\r\n      }\r\n    }\r\n    \r\n    // Si pasa todos los filtros\r\n    return true;\r\n  });\r\n  \r\n  return (\r\n    <div className=\"container mx-auto px-3 sm:px-4 py-4 sm:py-6\">\r\n      <h1 className=\"text-xl sm:text-2xl font-bold mb-4 sm:mb-6\">Correo Electr√≥nico</h1>\r\n      \r\n      {/* Direcci√≥n de correo del usuario */}\r\n      {userEmailAddress && (\r\n        <div className=\"mb-3 sm:mb-4\">\r\n          <p className=\"text-xs sm:text-sm text-gray-500\">Tu correo electr√≥nico:</p>\r\n          <p className=\"text-sm sm:text-base font-medium\">{userEmailAddress}</p>\r\n        </div>\r\n      )}\r\n      \r\n      {/* Contenedor de notificaciones */}\r\n      <ToastContainer \r\n        position=\"bottom-right\"\r\n        autoClose={3000}\r\n        hideProgressBar={false}\r\n        newestOnTop\r\n        closeOnClick\r\n        rtl={false}\r\n        draggable\r\n      />\r\n      \r\n      {/* Grid principal - Adaptable a m√≥vil */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-3 sm:gap-4\">\r\n        {/* Barra lateral - Carpetas del sistema y personalizadas */}\r\n        <div className=\"col-span-1\">\r\n          <Card className=\"overflow-hidden\">\r\n            <nav className=\"flex flex-col p-2\" data-testid=\"folders-sidebar\">\r\n              <Button \r\n                variant={currentFolder === 'inbox' && !selectedCustomFolder ? 'subtle' : 'ghost'} \r\n                className={`w-full justify-start system-folder ${currentFolder === 'inbox' && !selectedCustomFolder ? 'active' : ''}`}\r\n                data-testid=\"folder-item\" \r\n                onClick={() => handleSelectSystemFolder('inbox')}\r\n              >\r\n                <Inbox size={18} className=\"mr-2\" /> Bandeja de entrada\r\n              </Button>\r\n              <Button \r\n                variant={currentFolder === 'sent' && !selectedCustomFolder ? 'subtle' : 'ghost'} \r\n                className={`w-full justify-start system-folder ${currentFolder === 'sent' && !selectedCustomFolder ? 'active' : ''}`}\r\n                data-testid=\"folder-item\" \r\n                onClick={() => handleSelectSystemFolder('sent')}\r\n              >\r\n                <Send size={18} className=\"mr-2\" /> Enviados\r\n              </Button>\r\n              <Button \r\n                variant={currentFolder === 'trash' && !selectedCustomFolder ? 'subtle' : 'ghost'} \r\n                className={`w-full justify-start system-folder ${currentFolder === 'trash' && !selectedCustomFolder ? 'active' : ''}`}\r\n                data-testid=\"folder-item\" \r\n                onClick={() => handleSelectSystemFolder('trash')}\r\n              >\r\n                <Trash size={18} className=\"mr-2\" /> Papelera\r\n              </Button>\r\n              <Button \r\n                variant={currentFolder === 'drafts' && !selectedCustomFolder ? 'subtle' : 'ghost'} \r\n                className={`w-full justify-start system-folder ${currentFolder === 'drafts' && !selectedCustomFolder ? 'active' : ''}`}\r\n                data-testid=\"folder-item\" \r\n                onClick={() => handleSelectSystemFolder('drafts')}\r\n              >\r\n                <File size={18} className=\"mr-2\" /> Borradores\r\n              </Button>\r\n            </nav>\r\n\r\n             {/* Separador */}\r\n             <div className=\"border-t border-gray-200 my-2\"></div>\r\n\r\n             {/* Encabezado Etiquetas */}\r\n             <div className=\"flex items-center justify-between px-2 mb-1\">\r\n               <h3 className=\"text-sm font-medium\">Etiquetas</h3>\r\n               <Button\r\n                 variant=\"ghost\"\r\n                 size=\"xs\"\r\n                 data-testid=\"manage-tags-button\"\r\n                 onClick={() => setShowManageTags(true)}\r\n               >\r\n                 Gestionar\r\n               </Button>\r\n             </div>\r\n\r\n             {/* Barra lateral de etiquetas */}\r\n             <TagsSidebar \r\n               tags={availableTags}\r\n               activeTagId={selectedTag}\r\n               onSelectTag={handleSelectTag}\r\n             />\r\n\r\n             {/* Encabezado carpetas personalizadas + bot√≥n gestionar */}\r\n             <div className=\"flex items-center justify-between px-2 mb-1\">\r\n               <h3 className=\"text-sm font-medium\">Carpetas</h3>\r\n               <Button\r\n                 variant=\"ghost\"\r\n                 size=\"xs\"\r\n                 data-testid=\"manage-folders-button\"\r\n                 onClick={() => setShowManageFolders(true)}\r\n               >\r\n                 Gestionar\r\n               </Button>\r\n             </div>\r\n\r\n             {/* Carpetas personalizadas */}\r\n             <CustomFolders\r\n               folders={customFolders}\r\n               activeFolder={selectedCustomFolder}\r\n               onSelectFolder={handleSelectCustomFolder}\r\n               onCreateFolder={handleCreateFolder}\r\n               onRenameFolder={handleRenameFolder}\r\n               onDeleteFolder={handleDeleteFolder}\r\n             />\r\n\r\n             {/* Bot√≥n vaciar papelera */}\r\n             {currentFolder === 'trash' && !selectedCustomFolder && (\r\n               <Button\r\n                 variant=\"danger\"\r\n                 size=\"sm\"\r\n                 className=\"mt-3 mx-2\"\r\n                 data-testid=\"empty-trash-button\"\r\n                 onClick={() => setShowEmptyTrashModal(true)}\r\n               >\r\n                 Vaciar papelera\r\n               </Button>\r\n             )}\r\n          </Card>\r\n        </div>\r\n        {/* Panel central y derecho - Lista de emails y detalle */}\r\n        <div className=\"col-span-1 md:col-span-3\">\r\n          <div className=\"flex flex-col h-full\">\r\n            {/* Barra de b√∫squeda y acciones - Adaptable para m√≥vil */}\r\n            <div className=\"flex flex-wrap items-center gap-2 mb-2 sm:mb-3 md:mb-4\">\r\n              <div className=\"relative flex-grow min-w-[140px]\">\r\n                <Search size={14} className=\"absolute left-2 md:left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" />\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Buscar...\"\r\n                  className=\"pl-7 md:pl-10 pr-2 py-1.5 md:py-2 text-xs md:text-sm border rounded-lg w-full\"\r\n                  value={searchQuery}\r\n                  onChange={(e) => setSearchQuery(e.target.value)}\r\n                />\r\n              </div>\r\n              <Button variant=\"outline\" size=\"sm\" className=\"flex-shrink-0\" onClick={handleRefresh}>\r\n                <RefreshCw size={16} />\r\n              </Button>\r\n              <Button \r\n                variant={showAdvancedFilters ? \"subtle\" : \"outline\"}\r\n                size=\"sm\" \r\n                className=\"flex-shrink-0\"\r\n                onClick={() => setShowAdvancedFilters(!showAdvancedFilters)}\r\n              >\r\n                <Filter size={16} className=\"mr-1\" />\r\n                {Object.keys(activeFilters).length > 0 && (\r\n                  <span className=\"bg-blue-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center\">\r\n                    {Object.keys(activeFilters).filter(k => \r\n                      activeFilters[k] && \r\n                      (Array.isArray(activeFilters[k]) ? activeFilters[k].length > 0 : true)\r\n                    ).length}\r\n                  </span>\r\n                )}\r\n              </Button>\r\n              <Button\r\n                variant=\"primary\"\r\n                size=\"sm\"\r\n                className=\"flex-shrink-0\"\r\n                data-testid=\"new-email-button\"\r\n                onClick={() => setIsComposeOpen(true)}\r\n                title=\"Nuevo correo\"\r\n              >\r\n                <Edit size={16} className=\"mr-1\" /> Nuevo correo\r\n              </Button>\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                className=\"flex-shrink-0\"\r\n                onClick={() => navigate('/user/email/stats')}\r\n                title=\"Ver estad√≠sticas de correo\"\r\n              >\r\n                <BarChart2 size={16} />\r\n              </Button>\r\n              {/* Bot√≥n para volver a carpetas en m√≥vil cuando hay email seleccionado */}\r\n              {selectedEmail && (\r\n                <Button \r\n                  variant=\"outline\"\r\n                  size=\"sm\" \r\n                  className=\"flex-shrink-0 md:hidden\"\r\n                  onClick={() => setSelectedEmail(null)}\r\n                >\r\n                  <ArrowLeft size={16} className=\"mr-1\" /> Carpetas\r\n                </Button>\r\n              )}\r\n            </div>\r\n            \r\n            {/* Indicador de filtro por etiqueta */}\r\n{isFilteringByTag && selectedTag && (\r\n  <div className=\"flex items-center mb-2\">\r\n    <span data-testid=\"active-filter-indicator\" className=\"mr-2\">\r\n      {availableTags.find(t => t.id === selectedTag)?.name || ''}\r\n    </span>\r\n    <Button\r\n      variant=\"ghost\"\r\n      size=\"xs\"\r\n      data-testid=\"clear-filter-button\"\r\n      onClick={handleClearTagFilter}\r\n    >\r\n      Limpiar\r\n    </Button>\r\n  </div>\r\n)}\r\n\r\n{/* Filtros avanzados */}\r\n            {showAdvancedFilters && (\r\n              <div className=\"mb-3\">\r\n                <EmailFilters \r\n                  onApplyFilters={applyFilters}\r\n                  onResetFilters={resetFilters}\r\n                  initialFilters={activeFilters}\r\n                />\r\n              </div>\r\n            )}\r\n            \r\n            {/* Contenido principal - Adaptativo para m√≥vil */}\r\n            <div className=\"flex flex-col md:flex-row gap-2 sm:gap-3 md:gap-4 flex-grow\">\r\n              {/* Lista de emails - Se oculta en m√≥vil cuando hay un email seleccionado */}\r\n              <Card className={`flex-grow md:w-1/2 ${selectedEmail ? 'hidden md:block' : 'block'} max-h-[calc(100vh-240px)] md:max-h-none overflow-y-auto`}>\r\n                <div className=\"p-2\">\r\n                  <EmailList \r\n                    emails={emails} \r\n                    loading={loading}\r\n                    selectedEmailId={selectedEmail?.id}\r\n                    onSelectEmail={handleSelectEmail}\r\n                    folder={currentFolder}\r\n                  />\r\n                </div>\r\n              </Card>\r\n              \r\n              {/* Detalle del email */}\r\n              {selectedEmail ? (\r\n                <Card className=\"flex-grow md:w-1/2 w-full max-h-[calc(100vh-240px)] md:max-h-none overflow-y-auto\">\r\n                  <div className=\"py-1 px-2\">\r\n                    <EmailDetail \r\n                      email={selectedEmail}\r\n                      onBack={() => setSelectedEmail(null)}\r\n                      isMobile={window.innerWidth < 768}\r\n                      onReply={() => {\r\n                        setIsComposeOpen(true);\r\n                        // Pre-llenar datos para respuesta\r\n                      }}\r\n                      onDelete={(emailId) => {\r\n                        // Mover a papelera\r\n                        if (window.confirm('¬øEst√°s seguro de mover este correo a la papelera?')) {\r\n                          try {\r\n                            // Aqu√≠ se implementar√≠a la l√≥gica para mover a papelera\r\n                            // Por ahora solo simulamos\r\n                            setSelectedEmail(null);\r\n                            toast.info(`Correo movido a la papelera`);\r\n                          } catch (error) {\r\n                            toast.error(`Error al mover el correo a la papelera`);\r\n                          }\r\n                        }\r\n                      }}\r\n                      onMoveToFolder={handleMoveToFolder}\r\n                      folders={customFolders}\r\n                    />\r\n                  </div>\r\n                </Card>\r\n              ) : (\r\n                <Card className=\"flex-grow md:w-1/2 hidden md:flex items-center justify-center text-gray-500\">\r\n                  <div className=\"text-center p-4\">\r\n                    <Mail size={48} className=\"mx-auto mb-2 opacity-20\" />\r\n                    <p>Selecciona un correo para ver su contenido</p>\r\n                  </div>\r\n                </Card>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Modal de composici√≥n de correo */}\r\n      {isComposeOpen && (\r\n        <ComposeEmailModal \r\n          isOpen={isComposeOpen}\r\n          onClose={() => setIsComposeOpen(false)}\r\n          userEmailAddress={userEmailAddress}\r\n          userEmail={userEmailAddress}\r\n          replyTo={selectedEmail}\r\n        />\r\n      )}\r\n      \r\n      {/* Notificaciones toast */}\r\n      <ToastContainer position=\"bottom-right\" autoClose={3000} />\r\n\r\n      {/* Modales de gesti√≥n y vaciar papelera */}\r\n      <ManageFoldersModal\r\n        isOpen={showManageFolders}\r\n        folders={[...customFolders, { id: 'inbox', name: 'Bandeja de entrada', system: true }, { id: 'sent', name: 'Enviados', system: true }, { id: 'drafts', name: 'Borradores', system: true }, { id: 'trash', name: 'Papelera', system: true }]}\r\n        onClose={() => setShowManageFolders(false)}\r\n        onDeleteFolder={handleDeleteFolder}\r\n      />\r\n      <TagsManager \r\n        isOpen={showManageTags}\r\n        onClose={() => setShowManageTags(false)}\r\n      />\r\n      <EmptyTrashModal\r\n        isOpen={showEmptyTrashModal}\r\n        onClose={() => setShowEmptyTrashModal(false)}\r\n        onConfirm={async () => {\r\n          try {\r\n            await fetch(`${API_BASE}/api/email/trash/empty${userEmailAddress ? `?user=${encodeURIComponent(userEmailAddress)}` : ''}`, { method: 'DELETE' });\r\n            setShowEmptyTrashModal(false);\r\n            handleRefresh();\r\n          } catch (e) {\r\n            console.error('Error al vaciar papelera', e);\r\n          }\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EmailInbox;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pages\\user\\EmailStatistics.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pwa\\registerServiceWorker.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\pwa\\serviceWorker.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'CACHE_NAME' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":6,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'CACHE_STRATEGIES' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":29,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'clients' is not defined.","line":324,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":324,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'clients' is not defined.","line":333,"column":11,"nodeType":"Identifier","messageId":"undef","endLine":333,"endColumn":18},{"ruleId":"no-undef","severity":2,"message":"'clients' is not defined.","line":334,"column":16,"nodeType":"Identifier","messageId":"undef","endLine":334,"endColumn":23}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Service Worker para PWA - MyWed360\r\n * Proporciona funcionalidad offline y cach√© inteligente\r\n */\r\n\r\nconst CACHE_NAME = 'mywed360-v1.0.0';\r\nconst STATIC_CACHE = 'mywed360-static-v1';\r\nconst DYNAMIC_CACHE = 'mywed360-dynamic-v1';\r\nconst API_CACHE = 'mywed360-api-v1';\r\n\r\n// Recursos est√°ticos para cachear inmediatamente\r\nconst STATIC_ASSETS = [\r\n  '/',\r\n  '/static/js/bundle.js',\r\n  '/static/css/main.css',\r\n  '/manifest.json',\r\n  '/offline.html'\r\n];\r\n\r\n// Rutas de API que se pueden cachear\r\nconst CACHEABLE_API_ROUTES = [\r\n  '/api/mail',\r\n  '/api/tasks',\r\n  '/api/finance',\r\n  '/api/proveedores'\r\n];\r\n\r\n// Estrategias de cach√©\r\nconst CACHE_STRATEGIES = {\r\n  CACHE_FIRST: 'cache-first',\r\n  NETWORK_FIRST: 'network-first',\r\n  STALE_WHILE_REVALIDATE: 'stale-while-revalidate',\r\n  NETWORK_ONLY: 'network-only',\r\n  CACHE_ONLY: 'cache-only'\r\n};\r\n\r\n/**\r\n * Instalar Service Worker y cachear recursos est√°ticos\r\n */\r\nself.addEventListener('install', (event) => {\r\n  console.log('[SW] Instalando Service Worker...');\r\n  \r\n  event.waitUntil(\r\n    caches.open(STATIC_CACHE)\r\n      .then((cache) => {\r\n        console.log('[SW] Cacheando recursos est√°ticos');\r\n        return cache.addAll(STATIC_ASSETS);\r\n      })\r\n      .then(() => {\r\n        console.log('[SW] Service Worker instalado correctamente');\r\n        return self.skipWaiting();\r\n      })\r\n      .catch((error) => {\r\n        console.error('[SW] Error instalando Service Worker:', error);\r\n      })\r\n  );\r\n});\r\n\r\n/**\r\n * Activar Service Worker y limpiar cach√©s antiguos\r\n */\r\nself.addEventListener('activate', (event) => {\r\n  console.log('[SW] Activando Service Worker...');\r\n  \r\n  event.waitUntil(\r\n    caches.keys()\r\n      .then((cacheNames) => {\r\n        return Promise.all(\r\n          cacheNames.map((cacheName) => {\r\n            if (cacheName !== STATIC_CACHE && \r\n                cacheName !== DYNAMIC_CACHE && \r\n                cacheName !== API_CACHE) {\r\n              console.log('[SW] Eliminando cach√© antiguo:', cacheName);\r\n              return caches.delete(cacheName);\r\n            }\r\n          })\r\n        );\r\n      })\r\n      .then(() => {\r\n        console.log('[SW] Service Worker activado');\r\n        return self.clients.claim();\r\n      })\r\n  );\r\n});\r\n\r\n/**\r\n * Interceptar peticiones y aplicar estrategias de cach√©\r\n */\r\nself.addEventListener('fetch', (event) => {\r\n  const { request } = event;\r\n  const url = new URL(request.url);\r\n  \r\n  // Ignorar peticiones que no sean GET\r\n  if (request.method !== 'GET') {\r\n    return;\r\n  }\r\n  \r\n  // Estrategia seg√∫n el tipo de recurso\r\n  if (isStaticAsset(url)) {\r\n    event.respondWith(cacheFirstStrategy(request, STATIC_CACHE));\r\n  } else if (isAPIRequest(url)) {\r\n    event.respondWith(networkFirstStrategy(request, API_CACHE));\r\n  } else if (isImageRequest(url)) {\r\n    event.respondWith(staleWhileRevalidateStrategy(request, DYNAMIC_CACHE));\r\n  } else {\r\n    event.respondWith(networkFirstStrategy(request, DYNAMIC_CACHE));\r\n  }\r\n});\r\n\r\n/**\r\n * Estrategia Cache First - Ideal para recursos est√°ticos\r\n */\r\nasync function cacheFirstStrategy(request, cacheName) {\r\n  try {\r\n    const cachedResponse = await caches.match(request);\r\n    if (cachedResponse) {\r\n      return cachedResponse;\r\n    }\r\n    \r\n    const networkResponse = await fetch(request);\r\n    const cache = await caches.open(cacheName);\r\n    cache.put(request, networkResponse.clone());\r\n    \r\n    return networkResponse;\r\n  } catch (error) {\r\n    console.error('[SW] Error en cache-first:', error);\r\n    return getOfflineFallback(request);\r\n  }\r\n}\r\n\r\n/**\r\n * Estrategia Network First - Ideal para contenido din√°mico\r\n */\r\nasync function networkFirstStrategy(request, cacheName) {\r\n  try {\r\n    const networkResponse = await fetch(request);\r\n    \r\n    if (networkResponse.ok) {\r\n      const cache = await caches.open(cacheName);\r\n      cache.put(request, networkResponse.clone());\r\n    }\r\n    \r\n    return networkResponse;\r\n  } catch (error) {\r\n    console.log('[SW] Red no disponible, buscando en cach√©:', request.url);\r\n    \r\n    const cachedResponse = await caches.match(request);\r\n    if (cachedResponse) {\r\n      return cachedResponse;\r\n    }\r\n    \r\n    return getOfflineFallback(request);\r\n  }\r\n}\r\n\r\n/**\r\n * Estrategia Stale While Revalidate - Ideal para im√°genes\r\n */\r\nasync function staleWhileRevalidateStrategy(request, cacheName) {\r\n  const cachedResponse = await caches.match(request);\r\n  \r\n  const fetchPromise = fetch(request).then((networkResponse) => {\r\n    if (networkResponse.ok) {\r\n      const cache = caches.open(cacheName);\r\n      cache.then((c) => c.put(request, networkResponse.clone()));\r\n    }\r\n    return networkResponse;\r\n  }).catch(() => cachedResponse);\r\n  \r\n  return cachedResponse || fetchPromise;\r\n}\r\n\r\n/**\r\n * Obtener respuesta offline seg√∫n el tipo de recurso\r\n */\r\nasync function getOfflineFallback(request) {\r\n  const url = new URL(request.url);\r\n  \r\n  if (request.destination === 'document') {\r\n    return caches.match('/offline.html');\r\n  }\r\n  \r\n  if (isImageRequest(url)) {\r\n    return new Response(\r\n      '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"200\" height=\"150\" viewBox=\"0 0 200 150\"><rect width=\"200\" height=\"150\" fill=\"#f3f4f6\"/><text x=\"100\" y=\"75\" text-anchor=\"middle\" fill=\"#9ca3af\" font-family=\"Arial\" font-size=\"14\">Imagen no disponible</text></svg>',\r\n      { headers: { 'Content-Type': 'image/svg+xml' } }\r\n    );\r\n  }\r\n  \r\n  if (isAPIRequest(url)) {\r\n    return new Response(\r\n      JSON.stringify({ \r\n        error: 'Sin conexi√≥n', \r\n        message: 'Esta funci√≥n requiere conexi√≥n a internet',\r\n        offline: true \r\n      }),\r\n      { \r\n        status: 503,\r\n        headers: { 'Content-Type': 'application/json' }\r\n      }\r\n    );\r\n  }\r\n  \r\n  return new Response('Recurso no disponible offline', { status: 503 });\r\n}\r\n\r\n/**\r\n * Verificar si es un recurso est√°tico\r\n */\r\nfunction isStaticAsset(url) {\r\n  return url.pathname.includes('/static/') || \r\n         url.pathname.endsWith('.js') ||\r\n         url.pathname.endsWith('.css') ||\r\n         url.pathname.endsWith('.woff2') ||\r\n         url.pathname.endsWith('.woff');\r\n}\r\n\r\n/**\r\n * Verificar si es una petici√≥n a la API\r\n */\r\nfunction isAPIRequest(url) {\r\n  return url.pathname.startsWith('/api/') ||\r\n         CACHEABLE_API_ROUTES.some(route => url.pathname.startsWith(route));\r\n}\r\n\r\n/**\r\n * Verificar si es una petici√≥n de imagen\r\n */\r\nfunction isImageRequest(url) {\r\n  return url.pathname.match(/\\.(jpg|jpeg|png|gif|webp|svg|ico)$/i);\r\n}\r\n\r\n/**\r\n * Manejar mensajes del cliente\r\n */\r\nself.addEventListener('message', (event) => {\r\n  const { type, payload } = event.data;\r\n  \r\n  switch (type) {\r\n    case 'SKIP_WAITING':\r\n      self.skipWaiting();\r\n      break;\r\n      \r\n    case 'GET_CACHE_STATS':\r\n      getCacheStats().then((stats) => {\r\n        event.ports[0].postMessage({ type: 'CACHE_STATS', payload: stats });\r\n      });\r\n      break;\r\n      \r\n    case 'CLEAR_CACHE':\r\n      clearAllCaches().then(() => {\r\n        event.ports[0].postMessage({ type: 'CACHE_CLEARED' });\r\n      });\r\n      break;\r\n      \r\n    case 'SYNC_DATA':\r\n      // Implementar sincronizaci√≥n en background\r\n      handleBackgroundSync(payload);\r\n      break;\r\n  }\r\n});\r\n\r\n/**\r\n * Obtener estad√≠sticas del cach√©\r\n */\r\nasync function getCacheStats() {\r\n  const cacheNames = await caches.keys();\r\n  const stats = {};\r\n  \r\n  for (const cacheName of cacheNames) {\r\n    const cache = await caches.open(cacheName);\r\n    const keys = await cache.keys();\r\n    stats[cacheName] = keys.length;\r\n  }\r\n  \r\n  return stats;\r\n}\r\n\r\n/**\r\n * Limpiar todos los cach√©s\r\n */\r\nasync function clearAllCaches() {\r\n  const cacheNames = await caches.keys();\r\n  return Promise.all(cacheNames.map(name => caches.delete(name)));\r\n}\r\n\r\n/**\r\n * Manejar sincronizaci√≥n en background\r\n */\r\nfunction handleBackgroundSync(data) {\r\n  // Implementar l√≥gica de sincronizaci√≥n cuando vuelva la conexi√≥n\r\n  console.log('[SW] Sincronizaci√≥n en background:', data);\r\n}\r\n\r\n/**\r\n * Manejar notificaciones push\r\n */\r\nself.addEventListener('push', (event) => {\r\n  if (!event.data) return;\r\n  \r\n  const data = event.data.json();\r\n  const options = {\r\n    body: data.body,\r\n    icon: '/icon-192.png',\r\n    badge: '/badge-72.png',\r\n    tag: data.tag || 'default',\r\n    data: data.data || {}\r\n  };\r\n  \r\n  event.waitUntil(\r\n    self.registration.showNotification(data.title, options)\r\n  );\r\n});\r\n\r\n/**\r\n * Manejar clicks en notificaciones\r\n */\r\nself.addEventListener('notificationclick', (event) => {\r\n  event.notification.close();\r\n  \r\n  const urlToOpen = event.notification.data.url || '/';\r\n  \r\n  event.waitUntil(\r\n    clients.matchAll({ type: 'window' }).then((clientList) => {\r\n      // Si ya hay una ventana abierta, enfocarla\r\n      for (const client of clientList) {\r\n        if (client.url === urlToOpen && 'focus' in client) {\r\n          return client.focus();\r\n        }\r\n      }\r\n      \r\n      // Si no, abrir nueva ventana\r\n      if (clients.openWindow) {\r\n        return clients.openWindow(urlToOpen);\r\n      }\r\n    })\r\n  );\r\n});\r\n\r\nconsole.log('[SW] Service Worker cargado correctamente');\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\routes\\AdminRoutes.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\routes\\UserRoutes.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'EmailSetupLazy' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":13,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { lazy, Suspense } from 'react';\r\nimport { Routes, Route, Navigate } from 'react-router-dom';\r\nimport Loader from '../components/ui/Loader';\r\n\r\n// P√°ginas de usuario\r\nimport UnifiedEmail from '../pages/UnifiedEmail';\r\nimport EmailStatistics from '../pages/user/EmailStatistics';\r\nimport Proveedores from '../pages/Proveedores';\r\nimport EmailSetup from '../pages/EmailSetup';\r\nimport MailgunTester from '../components/email/MailgunTester';\r\n\r\n// Carga perezosa (lazy loading) de componentes para mejor rendimiento\r\nconst EmailSetupLazy = lazy(() => import('../pages/EmailSetup'));\r\n\r\n// Componente para mostrar durante la carga\r\nconst LoadingFallback = () => (\r\n  <div className=\"flex items-center justify-center min-h-screen\">\r\n    <Loader className=\"w-10 h-10\" />\r\n    <span className=\"ml-3 text-lg\">Cargando...</span>\r\n  </div>\r\n);\r\n\r\n/**\r\n * Rutas para la secci√≥n de usuario\r\n * Requiere autenticaci√≥n\r\n */\r\nconst UserRoutes = () => {\r\n  return (\r\n    <Suspense fallback={<LoadingFallback />}>\r\n      <Routes>\r\n        <Route path=\"/\" element={<Navigate to=\"/user/dashboard\" replace />} />\r\n        <Route path=\"/email\" element={<UnifiedEmail />} />\r\n        {/** Alias para compatibilidad con enlaces antiguos */}\r\n        <Route path=\"/email/inbox\" element={<UnifiedEmail />} />\r\n        <Route path=\"/email/stats\" element={<EmailStatistics />} />\r\n        <Route path=\"/email/setup\" element={<EmailSetup />} />\r\n        <Route path=\"/proveedores\" element={<Proveedores />} />\r\n        <Route path=\"/email/test\" element={<MailgunTester />} />\r\n        {/* Redirecci√≥n rutas legado */}\r\n        <Route path=\"/buzon/*\" element={<Navigate to=\"/email\" replace />} />\r\n        <Route path=\"*\" element={<Navigate to=\"/user/dashboard\" replace />} />\r\n      </Routes>\r\n    </Suspense>\r\n  );\r\n};\r\n\r\nexport default UserRoutes;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\AIEmailTrackingService.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'EMAIL_TAGS' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Servicio especializado para el seguimiento y an√°lisis de efectividad de correos\r\n * generados mediante b√∫squeda AI de proveedores.\r\n */\r\nimport { EMAIL_TAGS } from './emailTrackingService';\r\n\r\nclass AIEmailTrackingService {\r\n  /**\r\n   * Constructor del servicio\r\n   */\r\n  constructor() {\r\n    this.storageKeyActivities = 'aiEmailActivities';\r\n    this.storageKeyMetrics = 'aiEmailMetrics';\r\n  }\r\n\r\n  /**\r\n   * Registra una actividad de email AI con informaci√≥n detallada\r\n   * @param {Object} aiResult - Resultado de b√∫squeda AI utilizado\r\n   * @param {string} searchQuery - Consulta original del usuario\r\n   * @param {Object} options - Opciones adicionales\r\n   * @returns {string} - ID √∫nico del registro de actividad\r\n   */\r\n  registerActivity(aiResult, searchQuery, options = {}) {\r\n    try {\r\n      const activityId = `ai_${Date.now()}_${Math.random().toString(36).substring(2, 10)}`;\r\n      \r\n      const activity = {\r\n        id: activityId,\r\n        aiResultId: aiResult?.id,\r\n        providerName: aiResult?.name,\r\n        providerCategory: aiResult?.service,\r\n        searchQuery,\r\n        templateCategory: options.templateCategory || aiResult?.service || 'general',\r\n        wasCustomized: options.wasCustomized || false,\r\n        timestamp: new Date().toISOString(),\r\n        status: 'sent',\r\n        responseReceived: false,\r\n        responseTime: null,\r\n        effectivenessScore: null,\r\n        emailId: options.emailId || null\r\n      };\r\n      \r\n      // Guardar en localStorage para desarrollo\r\n      const activities = JSON.parse(localStorage.getItem(this.storageKeyActivities) || '[]');\r\n      activities.push(activity);\r\n      localStorage.setItem(this.storageKeyActivities, JSON.stringify(activities));\r\n      \r\n      return activityId;\r\n    } catch (error) {\r\n      console.error('Error registrando actividad de email AI:', error);\r\n      return null;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Actualiza el estado de un correo AI cuando se recibe respuesta\r\n   * @param {string} activityId - ID de la actividad AI\r\n   * @param {Object} responseData - Datos de la respuesta\r\n   * @returns {boolean} - √âxito de la operaci√≥n\r\n   */\r\n  updateWithResponse(activityId, responseData) {\r\n    try {\r\n      const activities = JSON.parse(localStorage.getItem(this.storageKeyActivities) || '[]');\r\n      const index = activities.findIndex(act => act.id === activityId);\r\n      \r\n      if (index === -1) return false;\r\n      \r\n      const now = new Date();\r\n      const sentDate = new Date(activities[index].timestamp);\r\n      const responseTime = (now - sentDate) / (1000 * 60 * 60); // horas\r\n      \r\n      // Actualizar la actividad con datos de respuesta\r\n      activities[index] = {\r\n        ...activities[index],\r\n        status: 'responded',\r\n        responseReceived: true,\r\n        responseTime,\r\n        responseDate: now.toISOString(),\r\n        effectivenessScore: responseData.score || null\r\n      };\r\n      \r\n      localStorage.setItem(this.storageKeyActivities, JSON.stringify(activities));\r\n      \r\n      // Actualizar m√©tricas generales\r\n      this.updateOverallMetrics();\r\n      \r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error actualizando actividad AI con respuesta:', error);\r\n      return false;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Obtiene todas las actividades de email AI, opcionalmente filtradas\r\n   * @param {Object} filters - Filtros a aplicar\r\n   * @returns {Array} - Actividades que coinciden con los filtros\r\n   */\r\n  getActivities(filters = {}) {\r\n    try {\r\n      const activities = JSON.parse(localStorage.getItem(this.storageKeyActivities) || '[]');\r\n      \r\n      if (Object.keys(filters).length === 0) return activities;\r\n      \r\n      return activities.filter(activity => {\r\n        let incluir = true;\r\n        \r\n        if (filters.category) {\r\n          incluir = incluir && activity.templateCategory === filters.category;\r\n        }\r\n        \r\n        if (filters.status) {\r\n          incluir = incluir && activity.status === filters.status;\r\n        }\r\n        \r\n        if (filters.responded !== undefined) {\r\n          incluir = incluir && activity.responseReceived === filters.responded;\r\n        }\r\n        \r\n        if (filters.customized !== undefined) {\r\n          incluir = incluir && activity.wasCustomized === filters.customized;\r\n        }\r\n        \r\n        if (filters.providerName) {\r\n          incluir = incluir && \r\n            activity.providerName &&\r\n            activity.providerName.toLowerCase().includes(filters.providerName.toLowerCase());\r\n        }\r\n        \r\n        return incluir;\r\n      });\r\n    } catch (error) {\r\n      console.error('Error obteniendo actividades AI:', error);\r\n      return [];\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Calcula y actualiza m√©tricas generales de efectividad\r\n   * @private\r\n   */\r\n  updateOverallMetrics() {\r\n    try {\r\n      const activities = this.getActivities();\r\n      const responded = activities.filter(act => act.responseReceived);\r\n      const customized = activities.filter(act => act.wasCustomized);\r\n      const customizedWithResponse = customized.filter(act => act.responseReceived);\r\n      \r\n      // Calcular m√©tricas por categor√≠a\r\n      const categoriesMap = {};\r\n      activities.forEach(act => {\r\n        const cat = act.templateCategory || 'general';\r\n        \r\n        if (!categoriesMap[cat]) {\r\n          categoriesMap[cat] = {\r\n            total: 0,\r\n            responded: 0,\r\n            customized: 0,\r\n            totalResponseTime: 0,\r\n            averageResponseTime: 0\r\n          };\r\n        }\r\n        \r\n        categoriesMap[cat].total++;\r\n        \r\n        if (act.wasCustomized) {\r\n          categoriesMap[cat].customized++;\r\n        }\r\n        \r\n        if (act.responseReceived) {\r\n          categoriesMap[cat].responded++;\r\n          \r\n          if (act.responseTime) {\r\n            categoriesMap[cat].totalResponseTime += act.responseTime;\r\n          }\r\n        }\r\n      });\r\n      \r\n      // Calcular promedios\r\n      Object.keys(categoriesMap).forEach(cat => {\r\n        const stats = categoriesMap[cat];\r\n        stats.averageResponseTime = stats.responded > 0 \r\n          ? stats.totalResponseTime / stats.responded \r\n          : 0;\r\n      });\r\n      \r\n      // Calcular m√©tricas generales\r\n      const metrics = {\r\n        timestamp: new Date().toISOString(),\r\n        totalEmails: activities.length,\r\n        totalResponses: responded.length,\r\n        responseRate: activities.length > 0 \r\n          ? (responded.length / activities.length) * 100 \r\n          : 0,\r\n        customizedRate: activities.length > 0 \r\n          ? (customized.length / activities.length) * 100 \r\n          : 0,\r\n        customizedResponseRate: customized.length > 0 \r\n          ? (customizedWithResponse.length / customized.length) * 100 \r\n          : 0,\r\n        averageResponseTime: responded.length > 0 \r\n          ? responded.reduce((sum, act) => sum + (act.responseTime || 0), 0) / responded.length \r\n          : 0,\r\n        categoryStats: categoriesMap\r\n      };\r\n      \r\n      // Guardar m√©tricas\r\n      localStorage.setItem(this.storageKeyMetrics, JSON.stringify(metrics));\r\n      \r\n      return metrics;\r\n    } catch (error) {\r\n      console.error('Error actualizando m√©tricas:', error);\r\n      return null;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Obtiene las m√©tricas actuales de efectividad\r\n   * @returns {Object} - M√©tricas actuales\r\n   */\r\n  getMetrics() {\r\n    try {\r\n      const storedMetrics = localStorage.getItem(this.storageKeyMetrics);\r\n      \r\n      if (storedMetrics) {\r\n        return JSON.parse(storedMetrics);\r\n      }\r\n      \r\n      return this.updateOverallMetrics();\r\n    } catch (error) {\r\n      console.error('Error obteniendo m√©tricas AI:', error);\r\n      return null;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Obtiene datos para el panel de comparaci√≥n de efectividad AI vs no-AI\r\n   * @returns {Object} - Datos de comparaci√≥n\r\n   */\r\n  getComparisonData() {\r\n    try {\r\n      // Obtener m√©tricas AI\r\n      const aiMetrics = this.getMetrics();\r\n      \r\n      // Obtener datos de correos no-AI desde localStorage (simulado)\r\n      // En producci√≥n, esta informaci√≥n vendr√≠a de la base de datos\r\n      const emailData = JSON.parse(localStorage.getItem('emailTrackings') || '[]');\r\n      const nonAiEmails = emailData.filter(e => !e.isAIGenerated);\r\n      const nonAiResponses = nonAiEmails.filter(e => e.hasResponse);\r\n      \r\n      // Calcular m√©tricas para correos no-AI\r\n      const nonAiResponseRate = nonAiEmails.length > 0\r\n        ? (nonAiResponses.length / nonAiEmails.length) * 100\r\n        : 0;\r\n      \r\n      // Calcular tiempo de respuesta promedio para no-AI (si hay datos disponibles)\r\n      let nonAiAvgResponseTime = 0;\r\n      if (nonAiResponses.length > 0) {\r\n        let totalTime = 0;\r\n        let countWithTime = 0;\r\n        \r\n        nonAiResponses.forEach(email => {\r\n          if (email.sentDate && email.responseDate) {\r\n            const sentDate = new Date(email.sentDate);\r\n            const responseDate = new Date(email.responseDate);\r\n            const responseTime = (responseDate - sentDate) / (1000 * 60 * 60); // horas\r\n            totalTime += responseTime;\r\n            countWithTime++;\r\n          }\r\n        });\r\n        \r\n        nonAiAvgResponseTime = countWithTime > 0 ? totalTime / countWithTime : 0;\r\n      }\r\n      \r\n      // Preparar datos de comparaci√≥n\r\n      return {\r\n        ai: {\r\n          total: aiMetrics.totalEmails || 0,\r\n          responded: aiMetrics.totalResponses || 0,\r\n          responseRate: aiMetrics.responseRate.toFixed(2),\r\n          avgResponseTime: aiMetrics.averageResponseTime.toFixed(1)\r\n        },\r\n        nonAi: {\r\n          total: nonAiEmails.length,\r\n          responded: nonAiResponses.length,\r\n          responseRate: nonAiResponseRate.toFixed(2),\r\n          avgResponseTime: nonAiAvgResponseTime.toFixed(1)\r\n        },\r\n        difference: {\r\n          responseRate: (aiMetrics.responseRate - nonAiResponseRate).toFixed(2),\r\n          avgResponseTime: (nonAiAvgResponseTime - aiMetrics.averageResponseTime).toFixed(1)\r\n        },\r\n        categoryBreakdown: Object.keys(aiMetrics.categoryStats || {}).map(cat => ({\r\n          category: cat,\r\n          total: aiMetrics.categoryStats[cat].total,\r\n          responseRate: aiMetrics.categoryStats[cat].total > 0\r\n            ? ((aiMetrics.categoryStats[cat].responded / aiMetrics.categoryStats[cat].total) * 100).toFixed(2)\r\n            : '0.00',\r\n          avgResponseTime: aiMetrics.categoryStats[cat].averageResponseTime.toFixed(1)\r\n        }))\r\n      };\r\n    } catch (error) {\r\n      console.error('Error obteniendo datos de comparaci√≥n:', error);\r\n      return {\r\n        ai: { total: 0, responded: 0, responseRate: '0.00', avgResponseTime: '0.0' },\r\n        nonAi: { total: 0, responded: 0, responseRate: '0.00', avgResponseTime: '0.0' },\r\n        difference: { responseRate: '0.00', avgResponseTime: '0.0' },\r\n        categoryBreakdown: []\r\n      };\r\n    }\r\n  }\r\n}\r\n\r\nexport default AIEmailTrackingService;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\EmailRecommendationService.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'EMAIL_TAGS' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'metrics' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":24,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'comparison' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'activities' is defined but never used. Allowed unused args must match /^_/u.","line":149,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":149,"endColumn":45},{"ruleId":"no-unused-vars","severity":1,"message":"'activities' is defined but never used. Allowed unused args must match /^_/u.","line":455,"column":54,"nodeType":"Identifier","messageId":"unusedVar","endLine":455,"endColumn":64}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Servicio para generar recomendaciones inteligentes basadas en m√©tricas \r\n * de efectividad de correos electr√≥nicos\r\n */\r\nimport AIEmailTrackingService from './AIEmailTrackingService';\r\nimport { EMAIL_TAGS } from './emailTrackingService';\r\n\r\nclass EmailRecommendationService {\r\n  constructor() {\r\n    this.trackingService = new AIEmailTrackingService();\r\n    this.storageKeyRecommendations = 'emailRecommendations';\r\n  }\r\n\r\n  /**\r\n   * Genera recomendaciones personalizadas basadas en m√©tricas hist√≥ricas\r\n   * @param {string} category - Categor√≠a de proveedor (opcional)\r\n   * @param {string} searchQuery - Consulta de b√∫squeda (opcional)\r\n   * @returns {Object} Objeto con recomendaciones\r\n   */\r\n  generateRecommendations(category = null, searchQuery = null) {\r\n    try {\r\n      // Obtener datos hist√≥ricos\r\n      const activities = this.trackingService.getActivities();\r\n      const metrics = this.trackingService.getMetrics();\r\n      const comparison = this.trackingService.getComparisonData();\r\n      \r\n      // Objeto base de recomendaciones\r\n      const recommendations = {\r\n        bestTimeToSend: this._calculateBestTimeToSend(activities),\r\n        subjectLineRecommendations: this._generateSubjectRecommendations(activities),\r\n        templateRecommendations: this._generateTemplateRecommendations(activities, category),\r\n        customizationImpact: this._calculateCustomizationImpact(activities),\r\n        responseTimeExpectations: this._calculateResponseTimeExpectations(activities, category),\r\n        confidenceScore: 0\r\n      };\r\n      \r\n      // Aplicar contexto de categor√≠a si est√° disponible\r\n      if (category) {\r\n        recommendations.categorySpecific = this._generateCategorySpecificRecommendations(category, activities);\r\n      }\r\n      \r\n      // Aplicar contexto de b√∫squeda si est√° disponible\r\n      if (searchQuery) {\r\n        recommendations.querySpecific = this._generateQuerySpecificRecommendations(searchQuery, activities);\r\n      }\r\n      \r\n      // Calcular puntuaci√≥n de confianza basada en la cantidad de datos disponibles\r\n      recommendations.confidenceScore = this._calculateConfidenceScore(activities, category);\r\n      \r\n      // Guardar recomendaciones en localStorage para referencia\r\n      this._saveRecommendations(recommendations, category, searchQuery);\r\n      \r\n      return recommendations;\r\n    } catch (error) {\r\n      console.error('Error generando recomendaciones:', error);\r\n      return this._getDefaultRecommendations();\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Calcula el mejor momento del d√≠a para enviar correos basado en tasas de respuesta hist√≥ricas\r\n   * @private\r\n   * @param {Array} activities - Actividades hist√≥ricas\r\n   * @returns {Object} Objeto con recomendaciones de horario\r\n   */\r\n  _calculateBestTimeToSend(activities) {\r\n    // Inicializar contadores por franja horaria\r\n    const timeSlots = {\r\n      morning: { sent: 0, responded: 0, rate: 0 },     // 8-12h\r\n      afternoon: { sent: 0, responded: 0, rate: 0 },   // 12-16h\r\n      evening: { sent: 0, responded: 0, rate: 0 },     // 16-20h\r\n      night: { sent: 0, responded: 0, rate: 0 }        // 20-8h\r\n    };\r\n    \r\n    // Analizar actividades\r\n    activities.forEach(activity => {\r\n      const timestamp = new Date(activity.timestamp);\r\n      const hour = timestamp.getHours();\r\n      \r\n      // Determinar franja horaria\r\n      let timeSlot = 'night';\r\n      if (hour >= 8 && hour < 12) timeSlot = 'morning';\r\n      else if (hour >= 12 && hour < 16) timeSlot = 'afternoon';\r\n      else if (hour >= 16 && hour < 20) timeSlot = 'evening';\r\n      \r\n      // Incrementar contadores\r\n      timeSlots[timeSlot].sent++;\r\n      if (activity.responseReceived) {\r\n        timeSlots[timeSlot].responded++;\r\n      }\r\n    });\r\n    \r\n    // Calcular tasas y determinar mejor franja\r\n    let bestTimeSlot = 'morning';\r\n    let bestRate = 0;\r\n    \r\n    Object.keys(timeSlots).forEach(slot => {\r\n      const { sent, responded } = timeSlots[slot];\r\n      const rate = sent > 0 ? (responded / sent) * 100 : 0;\r\n      timeSlots[slot].rate = rate;\r\n      \r\n      if (sent >= 5 && rate > bestRate) {\r\n        bestRate = rate;\r\n        bestTimeSlot = slot;\r\n      }\r\n    });\r\n    \r\n    // Mappear nombres amigables\r\n    const timeSlotNames = {\r\n      morning: 'ma√±ana (8-12h)',\r\n      afternoon: 'mediod√≠a (12-16h)',\r\n      evening: 'tarde (16-20h)',\r\n      night: 'noche (20-8h)'\r\n    };\r\n    \r\n    // Preparar recomendaci√≥n\r\n    return {\r\n      bestTimeSlot,\r\n      bestTimeSlotName: timeSlotNames[bestTimeSlot],\r\n      bestRate: timeSlots[bestTimeSlot].rate.toFixed(1),\r\n      timeSlots,\r\n      hasSufficientData: this._hasSufficientTimeData(timeSlots)\r\n    };\r\n  }\r\n  \r\n  /**\r\n   * Determina si hay suficientes datos para hacer recomendaciones de tiempo confiables\r\n   * @private\r\n   * @param {Object} timeSlots - Datos por franja horaria\r\n   * @returns {boolean} True si hay suficientes datos\r\n   */\r\n  _hasSufficientTimeData(timeSlots) {\r\n    // Verificar si al menos 2 franjas tienen 5+ env√≠os\r\n    let slotsWithSufficientData = 0;\r\n    \r\n    Object.values(timeSlots).forEach(slot => {\r\n      if (slot.sent >= 5) slotsWithSufficientData++;\r\n    });\r\n    \r\n    return slotsWithSufficientData >= 2;\r\n  }\r\n  \r\n  /**\r\n   * Genera recomendaciones para l√≠neas de asunto efectivas\r\n   * @private\r\n   * @param {Array} activities - Actividades hist√≥ricas\r\n   * @returns {Object} Objeto con recomendaciones de asunto\r\n   */\r\n  _generateSubjectRecommendations(activities) {\r\n    // Para una implementaci√≥n real, esto requerir√≠a analizar los asuntos de correos exitosos\r\n    // Aqu√≠ incluiremos recomendaciones gen√©ricas basadas en mejores pr√°cticas\r\n    \r\n    return {\r\n      recommendedPatterns: [\r\n        'Consulta sobre [Servicio] para evento el [Fecha]',\r\n        'Disponibilidad y presupuesto para [Evento]',\r\n        'Inter√©s en contratar [Servicio] - Lovenda'\r\n      ],\r\n      avoidPatterns: [\r\n        'Consulta',\r\n        'Informaci√≥n',\r\n        'Hola'\r\n      ],\r\n      optimalLength: {\r\n        min: 30,\r\n        max: 60\r\n      },\r\n      includeElements: [\r\n        'Fecha del evento',\r\n        'Tipo de servicio',\r\n        'Menci√≥n de Lovenda'\r\n      ]\r\n    };\r\n  }\r\n  \r\n  /**\r\n   * Genera recomendaciones para plantillas basadas en datos hist√≥ricos\r\n   * @private\r\n   * @param {Array} activities - Actividades hist√≥ricas\r\n   * @param {string} category - Categor√≠a de proveedor\r\n   * @returns {Object} Objeto con recomendaciones de plantillas\r\n   */\r\n  _generateTemplateRecommendations(activities, category) {\r\n    // Agrupar por plantilla/categor√≠a\r\n    const templateStats = {};\r\n    \r\n    activities.forEach(activity => {\r\n      const templateCat = activity.templateCategory || 'general';\r\n      \r\n      if (!templateStats[templateCat]) {\r\n        templateStats[templateCat] = {\r\n          total: 0,\r\n          responded: 0,\r\n          responseRate: 0,\r\n          avgResponseTime: 0,\r\n          totalResponseTime: 0\r\n        };\r\n      }\r\n      \r\n      templateStats[templateCat].total++;\r\n      \r\n      if (activity.responseReceived) {\r\n        templateStats[templateCat].responded++;\r\n        \r\n        if (activity.responseTime) {\r\n          templateStats[templateCat].totalResponseTime += activity.responseTime;\r\n        }\r\n      }\r\n    });\r\n    \r\n    // Calcular tasas y promedios\r\n    Object.keys(templateStats).forEach(cat => {\r\n      const stats = templateStats[cat];\r\n      stats.responseRate = stats.total > 0 ? (stats.responded / stats.total) * 100 : 0;\r\n      stats.avgResponseTime = stats.responded > 0 ? stats.totalResponseTime / stats.responded : 0;\r\n    });\r\n    \r\n    // Encontrar mejor plantilla general\r\n    let bestTemplate = 'general';\r\n    let bestRate = 0;\r\n    \r\n    Object.keys(templateStats).forEach(cat => {\r\n      // Solo considerar plantillas con suficientes datos\r\n      if (templateStats[cat].total >= 5 && templateStats[cat].responseRate > bestRate) {\r\n        bestRate = templateStats[cat].responseRate;\r\n        bestTemplate = cat;\r\n      }\r\n    });\r\n    \r\n    // Si se especific√≥ una categor√≠a, filtrar para esa categor√≠a\r\n    let categorySpecificTemplate = null;\r\n    if (category && templateStats[category] && templateStats[category].total > 0) {\r\n      categorySpecificTemplate = {\r\n        category,\r\n        responseRate: templateStats[category].responseRate.toFixed(1),\r\n        hasSufficientData: templateStats[category].total >= 5\r\n      };\r\n    }\r\n    \r\n    return {\r\n      bestOverallTemplate: bestTemplate,\r\n      bestOverallResponseRate: bestRate.toFixed(1),\r\n      templateStats,\r\n      categorySpecificTemplate,\r\n      hasSufficientData: this._hasSufficientTemplateData(templateStats)\r\n    };\r\n  }\r\n  \r\n  /**\r\n   * Determina si hay suficientes datos para hacer recomendaciones de plantillas confiables\r\n   * @private\r\n   * @param {Object} templateStats - Estad√≠sticas por plantilla\r\n   * @returns {boolean} True si hay suficientes datos\r\n   */\r\n  _hasSufficientTemplateData(templateStats) {\r\n    // Verificar si al menos 2 plantillas tienen 5+ env√≠os\r\n    let templatesWithSufficientData = 0;\r\n    \r\n    Object.values(templateStats).forEach(stats => {\r\n      if (stats.total >= 5) templatesWithSufficientData++;\r\n    });\r\n    \r\n    return templatesWithSufficientData >= 2;\r\n  }\r\n  \r\n  /**\r\n   * Calcula el impacto de personalizar mensajes en la tasa de respuesta\r\n   * @private\r\n   * @param {Array} activities - Actividades hist√≥ricas\r\n   * @returns {Object} Objeto con an√°lisis de impacto\r\n   */\r\n  _calculateCustomizationImpact(activities) {\r\n    const customized = {\r\n      total: 0,\r\n      responded: 0,\r\n      rate: 0\r\n    };\r\n    \r\n    const nonCustomized = {\r\n      total: 0,\r\n      responded: 0,\r\n      rate: 0\r\n    };\r\n    \r\n    // Analizar actividades\r\n    activities.forEach(activity => {\r\n      const target = activity.wasCustomized ? customized : nonCustomized;\r\n      \r\n      target.total++;\r\n      if (activity.responseReceived) {\r\n        target.responded++;\r\n      }\r\n    });\r\n    \r\n    // Calcular tasas\r\n    customized.rate = customized.total > 0 ? (customized.responded / customized.total) * 100 : 0;\r\n    nonCustomized.rate = nonCustomized.total > 0 ? (nonCustomized.responded / nonCustomized.total) * 100 : 0;\r\n    \r\n    // Calcular impacto\r\n    const impact = customized.rate - nonCustomized.rate;\r\n    \r\n    return {\r\n      customized: {\r\n        ...customized,\r\n        rate: customized.rate.toFixed(1)\r\n      },\r\n      nonCustomized: {\r\n        ...nonCustomized,\r\n        rate: nonCustomized.rate.toFixed(1)\r\n      },\r\n      impact: impact.toFixed(1),\r\n      recommendCustomization: impact > 5, // Recomendar si hay al menos 5% de mejora\r\n      hasSufficientData: customized.total >= 5 && nonCustomized.total >= 5\r\n    };\r\n  }\r\n  \r\n  /**\r\n   * Calcula tiempos esperados de respuesta basados en datos hist√≥ricos\r\n   * @private\r\n   * @param {Array} activities - Actividades hist√≥ricas\r\n   * @param {string} category - Categor√≠a de proveedor\r\n   * @returns {Object} Objeto con expectativas de tiempo de respuesta\r\n   */\r\n  _calculateResponseTimeExpectations(activities, category) {\r\n    // Filtrar solo actividades con respuesta\r\n    const respondedActivities = activities.filter(a => a.responseReceived && a.responseTime);\r\n    \r\n    // Si no hay suficientes datos, retornar expectativas por defecto\r\n    if (respondedActivities.length < 5) {\r\n      return {\r\n        averageTime: '24-48',\r\n        hasSufficientData: false\r\n      };\r\n    }\r\n    \r\n    // Calcular tiempo promedio general\r\n    const avgTime = respondedActivities.reduce((sum, act) => sum + act.responseTime, 0) / respondedActivities.length;\r\n    \r\n    // Si se especific√≥ categor√≠a, calcular tiempo para esa categor√≠a\r\n    let categoryAvgTime = null;\r\n    if (category) {\r\n      const categoryActivities = respondedActivities.filter(a => a.templateCategory === category);\r\n      \r\n      if (categoryActivities.length >= 3) {\r\n        categoryAvgTime = categoryActivities.reduce((sum, act) => sum + act.responseTime, 0) / categoryActivities.length;\r\n      }\r\n    }\r\n    \r\n    return {\r\n      averageTime: avgTime.toFixed(1),\r\n      medianTime: this._calculateMedianTime(respondedActivities),\r\n      categoryAverageTime: categoryAvgTime ? categoryAvgTime.toFixed(1) : null,\r\n      fastestResponse: Math.min(...respondedActivities.map(a => a.responseTime)).toFixed(1),\r\n      slowestResponse: Math.max(...respondedActivities.map(a => a.responseTime)).toFixed(1),\r\n      hasSufficientData: true\r\n    };\r\n  }\r\n  \r\n  /**\r\n   * Calcula la mediana del tiempo de respuesta\r\n   * @private\r\n   * @param {Array} activities - Actividades con respuesta\r\n   * @returns {string} Mediana formateada\r\n   */\r\n  _calculateMedianTime(activities) {\r\n    const times = activities.map(a => a.responseTime).sort((a, b) => a - b);\r\n    const mid = Math.floor(times.length / 2);\r\n    \r\n    const median = times.length % 2 === 0\r\n      ? (times[mid - 1] + times[mid]) / 2\r\n      : times[mid];\r\n      \r\n    return median.toFixed(1);\r\n  }\r\n  \r\n  /**\r\n   * Genera recomendaciones espec√≠ficas para una categor√≠a\r\n   * @private\r\n   * @param {string} category - Categor√≠a de proveedor\r\n   * @param {Array} activities - Actividades hist√≥ricas\r\n   * @returns {Object} Objeto con recomendaciones espec√≠ficas\r\n   */\r\n  _generateCategorySpecificRecommendations(category, activities) {\r\n    // Filtrar actividades para la categor√≠a espec√≠fica\r\n    const categoryActivities = activities.filter(a => a.templateCategory === category);\r\n    \r\n    if (categoryActivities.length < 3) {\r\n      return {\r\n        hasSufficientData: false,\r\n        recommendations: []\r\n      };\r\n    }\r\n    \r\n    // En una implementaci√≥n real, aqu√≠ se aplicar√≠a an√°lisis espec√≠fico por categor√≠a\r\n    // Proveer algunas recomendaciones basadas en la categor√≠a\r\n    \r\n    const categoryRecommendations = {\r\n      hasSufficientData: true,\r\n      responseRate: (categoryActivities.filter(a => a.responseReceived).length / categoryActivities.length * 100).toFixed(1),\r\n      recommendations: []\r\n    };\r\n    \r\n    // Generar recomendaciones espec√≠ficas seg√∫n la categor√≠a\r\n    switch (category.toLowerCase()) {\r\n      case 'fotograf√≠a':\r\n        categoryRecommendations.recommendations = [\r\n          'Mencionar el estilo espec√≠fico de fotograf√≠as que buscas',\r\n          'Preguntar por la disponibilidad de √°lbumes impresos',\r\n          'Consultar sobre el tiempo de entrega de las fotos editadas'\r\n        ];\r\n        break;\r\n        \r\n      case 'catering':\r\n        categoryRecommendations.recommendations = [\r\n          'Especificar el n√∫mero aproximado de invitados',\r\n          'Mencionar restricciones alimentarias o preferencias',\r\n          'Preguntar por opciones de men√∫ y posibilidad de cata'\r\n        ];\r\n        break;\r\n        \r\n      case 'm√∫sica':\r\n        categoryRecommendations.recommendations = [\r\n          'Especificar el estilo musical preferido',\r\n          'Consultar sobre el repertorio y posibilidad de peticiones',\r\n          'Preguntar por necesidades t√©cnicas y espacio necesario'\r\n        ];\r\n        break;\r\n        \r\n      case 'flores':\r\n        categoryRecommendations.recommendations = [\r\n          'Mencionar la paleta de colores del evento',\r\n          'Especificar las √°reas que requieren decoraci√≥n',\r\n          'Consultar sobre flores de temporada disponibles'\r\n        ];\r\n        break;\r\n        \r\n      default:\r\n        categoryRecommendations.recommendations = [\r\n          'Ser espec√≠fico sobre tus necesidades para el evento',\r\n          'Mencionar fecha, ubicaci√≥n y n√∫mero de invitados',\r\n          'Consultar disponibilidad antes de entrar en detalles'\r\n        ];\r\n    }\r\n    \r\n    return categoryRecommendations;\r\n  }\r\n  \r\n  /**\r\n   * Genera recomendaciones espec√≠ficas basadas en la consulta de b√∫squeda\r\n   * @private\r\n   * @param {string} searchQuery - Consulta de b√∫squeda\r\n   * @param {Array} activities - Actividades hist√≥ricas\r\n   * @returns {Object} Objeto con recomendaciones basadas en la b√∫squeda\r\n   */\r\n  _generateQuerySpecificRecommendations(searchQuery, activities) {\r\n    // An√°lisis b√°sico de la consulta\r\n    const query = searchQuery.toLowerCase();\r\n    const recommendations = [];\r\n    \r\n    // Detectar elementos clave en la consulta\r\n    const hasLocation = /madrid|barcelona|valencia|sevilla|m√°laga|ciudad|zona|cerca/i.test(query);\r\n    const hasDate = /202\\d|enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre/i.test(query);\r\n    const hasBudget = /presupuesto|euros|precio|coste|econ√≥mico/i.test(query);\r\n    const hasSize = /grande|peque√±o|√≠ntimo|invitados|personas|gente|tama√±o/i.test(query);\r\n    \r\n    // Generar recomendaciones contextuales\r\n    if (!hasLocation) {\r\n      recommendations.push('Especificar la ubicaci√≥n del evento en tu mensaje');\r\n    }\r\n    \r\n    if (!hasDate) {\r\n      recommendations.push('Mencionar la fecha del evento para confirmar disponibilidad');\r\n    }\r\n    \r\n    if (!hasBudget) {\r\n      recommendations.push('Indicar un rango de presupuesto para obtener propuestas ajustadas');\r\n    }\r\n    \r\n    if (!hasSize) {\r\n      recommendations.push('Especificar el n√∫mero aproximado de invitados o tama√±o del evento');\r\n    }\r\n    \r\n    return {\r\n      searchContext: {\r\n        includesLocation: hasLocation,\r\n        includesDate: hasDate,\r\n        includesBudget: hasBudget,\r\n        includesSize: hasSize\r\n      },\r\n      recommendations\r\n    };\r\n  }\r\n  \r\n  /**\r\n   * Calcula la puntuaci√≥n de confianza para las recomendaciones\r\n   * @private\r\n   * @param {Array} activities - Actividades hist√≥ricas\r\n   * @param {string} category - Categor√≠a de proveedor\r\n   * @returns {number} Puntuaci√≥n de confianza (0-100)\r\n   */\r\n  _calculateConfidenceScore(activities, category) {\r\n    // Base: cantidad de datos disponibles\r\n    let baseScore = 0;\r\n    \r\n    // Por cantidad total de actividades\r\n    if (activities.length >= 50) baseScore = 100;\r\n    else if (activities.length >= 30) baseScore = 80;\r\n    else if (activities.length >= 15) baseScore = 60;\r\n    else if (activities.length >= 5) baseScore = 40;\r\n    else baseScore = 20;\r\n    \r\n    // Ajustar por categor√≠a espec√≠fica si est√° disponible\r\n    if (category) {\r\n      const categoryActivities = activities.filter(a => a.templateCategory === category);\r\n      let categoryMultiplier = 1;\r\n      \r\n      if (categoryActivities.length >= 20) categoryMultiplier = 1.2;\r\n      else if (categoryActivities.length >= 10) categoryMultiplier = 1.1;\r\n      else if (categoryActivities.length >= 5) categoryMultiplier = 1.05;\r\n      else if (categoryActivities.length < 3) categoryMultiplier = 0.8;\r\n      \r\n      baseScore = Math.min(100, baseScore * categoryMultiplier);\r\n    }\r\n    \r\n    // Ajustar por distribuci√≥n de respuestas\r\n    const responded = activities.filter(a => a.responseReceived).length;\r\n    if (activities.length > 0) {\r\n      const responseRate = (responded / activities.length);\r\n      \r\n      // Penalizar si la tasa de respuesta es muy baja o muy alta (datos poco representativos)\r\n      if (responseRate < 0.1 || responseRate > 0.9) {\r\n        baseScore *= 0.9;\r\n      }\r\n    }\r\n    \r\n    return Math.round(baseScore);\r\n  }\r\n  \r\n  /**\r\n   * Guarda las recomendaciones generadas para referencia futura\r\n   * @private\r\n   * @param {Object} recommendations - Recomendaciones generadas\r\n   * @param {string} category - Categor√≠a de proveedor\r\n   * @param {string} searchQuery - Consulta de b√∫squeda\r\n   */\r\n  _saveRecommendations(recommendations, category, searchQuery) {\r\n    try {\r\n      const savedRecommendations = JSON.parse(localStorage.getItem(this.storageKeyRecommendations) || '[]');\r\n      \r\n      // Limitar a las √∫ltimas 10 recomendaciones\r\n      if (savedRecommendations.length >= 10) {\r\n        savedRecommendations.pop();\r\n      }\r\n      \r\n      // A√±adir nueva recomendaci√≥n\r\n      savedRecommendations.unshift({\r\n        id: `rec_${Date.now()}`,\r\n        timestamp: new Date().toISOString(),\r\n        category,\r\n        searchQuery,\r\n        recommendations,\r\n        applied: false\r\n      });\r\n      \r\n      localStorage.setItem(this.storageKeyRecommendations, JSON.stringify(savedRecommendations));\r\n    } catch (error) {\r\n      console.error('Error guardando recomendaciones:', error);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Retorna las recomendaciones por defecto cuando no hay datos suficientes\r\n   * @private\r\n   * @returns {Object} Recomendaciones por defecto\r\n   */\r\n  _getDefaultRecommendations() {\r\n    return {\r\n      bestTimeToSend: {\r\n        bestTimeSlot: 'morning',\r\n        bestTimeSlotName: 'ma√±ana (8-12h)',\r\n        hasSufficientData: false\r\n      },\r\n      subjectLineRecommendations: {\r\n        recommendedPatterns: [\r\n          'Consulta sobre [Servicio] para evento el [Fecha]',\r\n          'Disponibilidad y presupuesto para [Evento]',\r\n          'Inter√©s en contratar [Servicio] - Lovenda'\r\n        ],\r\n        optimalLength: {\r\n          min: 30,\r\n          max: 60\r\n        }\r\n      },\r\n      templateRecommendations: {\r\n        bestOverallTemplate: 'general',\r\n        hasSufficientData: false\r\n      },\r\n      customizationImpact: {\r\n        recommendCustomization: true,\r\n        hasSufficientData: false\r\n      },\r\n      responseTimeExpectations: {\r\n        averageTime: '24-48',\r\n        hasSufficientData: false\r\n      },\r\n      confidenceScore: 20\r\n    };\r\n  }\r\n  \r\n  /**\r\n   * Obtiene recomendaciones previamente generadas\r\n   * @returns {Array} Historial de recomendaciones\r\n   */\r\n  getRecommendationsHistory() {\r\n    try {\r\n      return JSON.parse(localStorage.getItem(this.storageKeyRecommendations) || '[]');\r\n    } catch (error) {\r\n      console.error('Error obteniendo historial de recomendaciones:', error);\r\n      return [];\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Marca una recomendaci√≥n como aplicada\r\n   * @param {string} recommendationId - ID de la recomendaci√≥n\r\n   * @returns {boolean} √âxito de la operaci√≥n\r\n   */\r\n  markRecommendationAsApplied(recommendationId) {\r\n    try {\r\n      const savedRecommendations = JSON.parse(localStorage.getItem(this.storageKeyRecommendations) || '[]');\r\n      const index = savedRecommendations.findIndex(r => r.id === recommendationId);\r\n      \r\n      if (index === -1) return false;\r\n      \r\n      savedRecommendations[index].applied = true;\r\n      savedRecommendations[index].appliedAt = new Date().toISOString();\r\n      \r\n      localStorage.setItem(this.storageKeyRecommendations, JSON.stringify(savedRecommendations));\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error marcando recomendaci√≥n como aplicada:', error);\r\n      return false;\r\n    }\r\n  }\r\n}\r\n\r\nexport default EmailRecommendationService;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\EmailService\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\EmailTemplateService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\EmailTrackingService.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'emailId' is defined but never used. Allowed unused args must match /^_/u.","line":252,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":252,"endColumn":41},{"ruleId":"no-unused-vars","severity":1,"message":"'providerId' is defined but never used. Allowed unused args must match /^_/u.","line":252,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":252,"endColumn":53}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// EmailTrackingService.js - Servicio para el seguimiento de respuestas de proveedores\r\nimport { saveData, loadData } from './SyncService';\r\n\r\nconst TRACKING_STORAGE_KEY = 'lovenda_email_tracking';\r\n\r\n// Estados posibles para seguimiento de correos\r\nexport const TRACKING_STATUS = {\r\n  WAITING: 'waiting',         // Esperando respuesta\r\n  RESPONDED: 'responded',     // Proveedor respondi√≥\r\n  FOLLOWUP: 'followup',       // Requiere seguimiento adicional\r\n  COMPLETED: 'completed',     // Conversaci√≥n completada/cerrada\r\n  URGENT: 'urgent'            // Requiere atenci√≥n urgente\r\n};\r\n\r\n// Etiquetas disponibles para correos\r\nexport const EMAIL_TAGS = {\r\n  PROVIDER: 'provider',       // Comunicaci√≥n con proveedor\r\n  IMPORTANT: 'important',     // Correo importante\r\n  BUDGET: 'budget',           // Relacionado con presupuesto\r\n  CONTRACT: 'contract',       // Relacionado con contrato\r\n  QUESTION: 'question',       // Consulta o pregunta\r\n  OFFER: 'offer',             // Oferta o promoci√≥n\r\n  APPOINTMENT: 'appointment', // Cita o reuni√≥n\r\n  AI_GENERATED: 'ai-generado' // Correo generado por AI\r\n};\r\n\r\n// Estructura de un registro de seguimiento\r\n// {\r\n//   id: string,              // ID √∫nico del seguimiento\r\n//   emailId: string,         // ID del correo relacionado\r\n//   providerId: string,      // ID del proveedor (si aplica)\r\n//   providerName: string,    // Nombre del proveedor\r\n//   providerEmail: string,   // Email del proveedor\r\n//   subject: string,         // Asunto del correo\r\n//   status: string,          // Estado del seguimiento (TRACKING_STATUS)\r\n//   tags: string[],          // Etiquetas aplicadas\r\n//   lastEmailDate: Date,     // Fecha del √∫ltimo correo\r\n//   dueDate: Date,           // Fecha l√≠mite para seguimiento (opcional)\r\n//   notes: string,           // Notas adicionales\r\n//   thread: [                // Hilo de correos relacionados\r\n//     { emailId, direction, date, subject, snippet }\r\n//   ]\r\n//   isAIGenerated: boolean,  // Si el correo fue generado por AI\r\n//   aiTrackingId: string,    // ID de seguimiento de actividad AI (si aplica)\r\n// }\r\n\r\n// Cargar registros de seguimiento\r\nexport function loadTrackingRecords() {\r\n  return loadData(TRACKING_STORAGE_KEY, { defaultValue: [] });\r\n}\r\n\r\n// Guardar registros de seguimiento\r\nexport function saveTrackingRecords(records) {\r\n  saveData(TRACKING_STORAGE_KEY, records);\r\n}\r\n\r\n// Crear un nuevo registro de seguimiento para un correo a un proveedor\r\nexport function createTrackingRecord(email, provider, options = {}) {\r\n  const trackingRecords = loadTrackingRecords();\r\n  \r\n  // Verificar si ya existe un registro para este proveedor\r\n  const existingRecord = trackingRecords.find(record => \r\n    record.providerEmail === provider.email\r\n  );\r\n  \r\n  if (existingRecord) {\r\n    // Actualizar el registro existente con el nuevo correo\r\n    const updatedRecord = {\r\n      ...existingRecord,\r\n      subject: email.subject,\r\n      lastEmailDate: new Date(),\r\n      status: TRACKING_STATUS.WAITING,\r\n      thread: [\r\n        ...(existingRecord.thread || []),\r\n        {\r\n          emailId: email.id,\r\n          direction: 'outgoing',\r\n          date: new Date(),\r\n          subject: email.subject,\r\n          snippet: email.body.substring(0, 100) + (email.body.length > 100 ? '...' : '')\r\n        }\r\n      ]\r\n    };\r\n    \r\n    // Actualizar el registro en la lista\r\n    const updatedRecords = trackingRecords.map(record => \r\n      record.id === existingRecord.id ? updatedRecord : record\r\n    );\r\n    \r\n    saveTrackingRecords(updatedRecords);\r\n    return updatedRecord;\r\n  } else {\r\n    // Crear un nuevo registro de seguimiento\r\n    const newRecord = {\r\n      id: crypto.randomUUID ? crypto.randomUUID() : Math.random().toString(36).substring(2),\r\n      emailId: email.id,\r\n      providerId: provider.id,\r\n      providerName: provider.name,\r\n      providerEmail: provider.email,\r\n      subject: email.subject,\r\n      status: TRACKING_STATUS.WAITING,\r\n      tags: [EMAIL_TAGS.PROVIDER],\r\n      lastEmailDate: new Date(),\r\n      dueDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000), // Por defecto, 7 d√≠as\r\n      notes: '',\r\n      thread: [{\r\n        emailId: email.id,\r\n        direction: 'outgoing',\r\n        date: new Date(),\r\n        subject: email.subject,\r\n        snippet: email.body.substring(0, 100) + (email.body.length > 100 ? '...' : '')\r\n      }],\r\n      isAIGenerated: options.isAIGenerated || false,\r\n      aiTrackingId: options.aiTrackingId || null\r\n    };\r\n    \r\n    // A√±adir etiquetas adicionales basadas en el asunto y contenido\r\n    if (email.subject.toLowerCase().includes('presupuesto') || \r\n        email.body.toLowerCase().includes('presupuesto')) {\r\n      newRecord.tags.push(EMAIL_TAGS.BUDGET);\r\n    }\r\n    \r\n    if (email.subject.toLowerCase().includes('contrato') || \r\n        email.body.toLowerCase().includes('contrato')) {\r\n      newRecord.tags.push(EMAIL_TAGS.CONTRACT);\r\n    }\r\n    \r\n    if (email.subject.toLowerCase().includes('cita') || \r\n        email.body.toLowerCase().includes('cita') ||\r\n        email.subject.toLowerCase().includes('reuni√≥n') || \r\n        email.body.toLowerCase().includes('reuni√≥n')) {\r\n      newRecord.tags.push(EMAIL_TAGS.APPOINTMENT);\r\n    }\r\n    \r\n    if (options.isAIGenerated) {\r\n      newRecord.tags.push(EMAIL_TAGS.AI_GENERATED);\r\n    }\r\n    \r\n    // A√±adir el nuevo registro\r\n    const updatedRecords = [...trackingRecords, newRecord];\r\n    saveTrackingRecords(updatedRecords);\r\n    return newRecord;\r\n  }\r\n}\r\n\r\n// Actualizar un registro de seguimiento cuando se recibe una respuesta\r\nexport function updateTrackingWithResponse(email) {\r\n  const trackingRecords = loadTrackingRecords();\r\n  \r\n  // Buscar el registro que corresponde al remitente de este correo\r\n  const recordIndex = trackingRecords.findIndex(record => \r\n    record.providerEmail === email.from\r\n  );\r\n  \r\n  if (recordIndex >= 0) {\r\n    // Actualizar el registro con la respuesta\r\n    const record = trackingRecords[recordIndex];\r\n    const updatedRecord = {\r\n      ...record,\r\n      status: TRACKING_STATUS.RESPONDED,\r\n      lastEmailDate: new Date(email.date),\r\n      thread: [\r\n        ...(record.thread || []),\r\n        {\r\n          emailId: email.id,\r\n          direction: 'incoming',\r\n          date: new Date(email.date),\r\n          subject: email.subject,\r\n          snippet: email.body.substring(0, 100) + (email.body.length > 100 ? '...' : '')\r\n        }\r\n      ]\r\n    };\r\n    \r\n    // Actualizar la lista de registros\r\n    trackingRecords[recordIndex] = updatedRecord;\r\n    saveTrackingRecords(trackingRecords);\r\n    return updatedRecord;\r\n  }\r\n  \r\n  return null;\r\n}\r\n\r\n// Actualizar estado de un registro de seguimiento\r\nexport function updateTrackingStatus(recordId, status, notes = null) {\r\n  const trackingRecords = loadTrackingRecords();\r\n  \r\n  const updatedRecords = trackingRecords.map(record => {\r\n    if (record.id === recordId) {\r\n      return {\r\n        ...record,\r\n        status,\r\n        notes: notes !== null ? notes : record.notes\r\n      };\r\n    }\r\n    return record;\r\n  });\r\n  \r\n  saveTrackingRecords(updatedRecords);\r\n}\r\n\r\n// Obtener registros que necesitan seguimiento (sin respuesta despu√©s de N d√≠as)\r\nexport function getTrackingNeedingFollowup(days = 3) {\r\n  const trackingRecords = loadTrackingRecords();\r\n  const now = new Date();\r\n  const cutoffDate = new Date(now.getTime() - days * 24 * 60 * 60 * 1000);\r\n  \r\n  return trackingRecords.filter(record => \r\n    record.status === TRACKING_STATUS.WAITING && \r\n    new Date(record.lastEmailDate) < cutoffDate\r\n  );\r\n}\r\n\r\n// A√±adir o eliminar etiquetas de un registro\r\nexport function updateTrackingTags(recordId, tags) {\r\n  const trackingRecords = loadTrackingRecords();\r\n  \r\n  const updatedRecords = trackingRecords.map(record => {\r\n    if (record.id === recordId) {\r\n      return {\r\n        ...record,\r\n        tags\r\n      };\r\n    }\r\n    return record;\r\n  });\r\n  \r\n  saveTrackingRecords(updatedRecords);\r\n}\r\n\r\n// Eliminar un registro de seguimiento\r\nexport function deleteTrackingRecord(recordId) {\r\n  const trackingRecords = loadTrackingRecords();\r\n  const updatedRecords = trackingRecords.filter(record => record.id !== recordId);\r\n  saveTrackingRecords(updatedRecords);\r\n}\r\n\r\n// Detectar autom√°ticamente si un correo entrante es de un proveedor conocido\r\nexport function detectProviderResponse(email, providers) {\r\n  // Si el correo entrante es de un dominio conocido de proveedor\r\n  const providerMatch = providers.find(p => \r\n    p.email && email.from.toLowerCase().includes(p.email.toLowerCase())\r\n  );\r\n  \r\n  if (providerMatch) {\r\n    return updateTrackingWithResponse(email);\r\n  }\r\n  \r\n  return null;\r\n}\r\n\r\n// Marcar un correo relacionado con un proveedor\r\nexport function tagProviderEmail(emailId, providerId) {\r\n  // Implementaci√≥n pendiente - requiere integraci√≥n con EmailService\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\FolderService\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\GoogleCalendarService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\PerformanceMonitor.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'useEffect' is not defined.","line":572,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":572,"endColumn":12}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Servicio de monitoreo de rendimiento para la aplicaci√≥n Lovenda\r\n * \r\n * Este servicio permite monitorizar el rendimiento de diferentes componentes\r\n * y funcionalidades cr√≠ticas, especialmente el sistema de emails personalizados.\r\n */\r\n\r\n// Configuraci√≥n para el monitoreo\r\nconst CONFIG = {\r\n  // Activar/desactivar el monitoreo\r\n  enabled: true,\r\n  \r\n  // Nivel de detalle del monitoreo\r\n  // 0: solo errores cr√≠ticos\r\n  // 1: errores y advertencias\r\n  // 2: informaci√≥n general\r\n  // 3: informaci√≥n detallada\r\n  logLevel: 2,\r\n  \r\n  // Intervalo para enviar m√©tricas al servidor (ms)\r\n  reportInterval: 60000, // 1 minuto\r\n  \r\n  // URL del endpoint para enviar m√©tricas\r\n  reportUrl: import.meta.env.VITE_METRICS_ENDPOINT || '',\r\n  \r\n  // Tama√±o m√°ximo de la cola de eventos antes de enviar\r\n  batchSize: 20,\r\n  \r\n  // M√©tricas a recopilar\r\n  metrics: {\r\n    emailProcessing: true,\r\n    searchPerformance: true,\r\n    notificationsRendering: true,\r\n    eventDetection: true,\r\n    uiInteractions: true\r\n  }\r\n};\r\n\r\n// Clase para el monitoreo de rendimiento\r\nclass PerformanceMonitor {\r\n  constructor(config = CONFIG) {\r\n    this.config = {\r\n      ...CONFIG,\r\n      ...config\r\n    };\r\n    \r\n    this.metrics = {\r\n      events: [],\r\n      errors: [],\r\n      timings: {},\r\n      counters: {},\r\n    };\r\n    \r\n    this.enabled = this.config.enabled;\r\n    this.pendingFlush = false;\r\n    this.startTime = Date.now();\r\n    \r\n    if (this.enabled && this.config.reportInterval) {\r\n      this.scheduleReporting();\r\n    }\r\n    \r\n    // Registrar evento de inicializaci√≥n\r\n    this.logEvent('monitor_init', {\r\n      version: import.meta.env.VITE_APP_VERSION || 'dev',\r\n      metrics_enabled: this.config.metrics,\r\n      log_level: this.config.logLevel\r\n    });\r\n    \r\n    console.info('üîç Monitor de rendimiento inicializado');\r\n  }\r\n  \r\n  /**\r\n   * Activar o desactivar el monitoreo\r\n   * @param {boolean} state - Estado del monitoreo\r\n   */\r\n  setEnabled(state) {\r\n    this.enabled = state;\r\n    \r\n    if (this.enabled && this.config.reportInterval && !this.reportingTimer) {\r\n      this.scheduleReporting();\r\n    } else if (!this.enabled && this.reportingTimer) {\r\n      clearTimeout(this.reportingTimer);\r\n      this.reportingTimer = null;\r\n    }\r\n    \r\n    this.logEvent('monitor_state_change', { enabled: state });\r\n  }\r\n  \r\n  /**\r\n   * Programar env√≠o peri√≥dico de m√©tricas\r\n   * @private\r\n   */\r\n  scheduleReporting() {\r\n    if (this.reportingTimer) {\r\n      clearTimeout(this.reportingTimer);\r\n    }\r\n    \r\n    this.reportingTimer = setTimeout(() => {\r\n      this.flushMetrics();\r\n      this.scheduleReporting();\r\n    }, this.config.reportInterval);\r\n  }\r\n  \r\n  /**\r\n   * Registrar un evento en el sistema de monitoreo\r\n   * @param {string} name - Nombre del evento\r\n   * @param {Object} data - Datos asociados al evento\r\n   */\r\n  logEvent(name, data = {}) {\r\n    if (!this.enabled || this.config.logLevel < 2) return;\r\n    \r\n    const event = {\r\n      name,\r\n      timestamp: Date.now(),\r\n      data: {\r\n        ...data,\r\n        sessionDuration: Date.now() - this.startTime\r\n      }\r\n    };\r\n    \r\n    this.metrics.events.push(event);\r\n    \r\n    // Si alcanzamos el tama√±o m√°ximo de lote, enviamos las m√©tricas\r\n    if (this.metrics.events.length >= this.config.batchSize) {\r\n      this.flushMetrics();\r\n    }\r\n    \r\n    if (this.config.logLevel >= 3) {\r\n      console.debug(`üìä Evento: ${name}`, data);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Registrar un error en el sistema de monitoreo\r\n   * @param {string} errorType - Tipo de error\r\n   * @param {Error|string} error - Error o mensaje de error\r\n   * @param {Object} context - Contexto adicional del error\r\n   */\r\n  logError(errorType, error, context = {}) {\r\n    if (!this.enabled || this.config.logLevel < 1) return;\r\n    \r\n    const errorData = {\r\n      type: errorType,\r\n      timestamp: Date.now(),\r\n      message: error instanceof Error ? error.message : error,\r\n      stack: error instanceof Error ? error.stack : undefined,\r\n      context\r\n    };\r\n    \r\n    this.metrics.errors.push(errorData);\r\n    \r\n    // Siempre registrar errores en la consola\r\n    console.error(`‚ùå Error en ${errorType}:`, error);\r\n    \r\n    // Enviar inmediatamente si es un error cr√≠tico\r\n    if (errorType === 'critical') {\r\n      this.flushMetrics();\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Iniciar medici√≥n de tiempo para una operaci√≥n\r\n   * @param {string} operationId - Identificador √∫nico de la operaci√≥n\r\n   * @returns {Function} Funci√≥n para finalizar la medici√≥n\r\n   */\r\n  startTimer(operationId) {\r\n    if (!this.enabled || !this.config.metrics.uiInteractions) return () => {};\r\n    \r\n    const startTime = performance.now();\r\n    \r\n    return (metadata = {}) => {\r\n      const endTime = performance.now();\r\n      const duration = endTime - startTime;\r\n      \r\n      this.recordTiming(operationId, duration, metadata);\r\n      return duration;\r\n    };\r\n  }\r\n  \r\n  /**\r\n   * Registrar una medici√≥n de tiempo\r\n   * @param {string} metricName - Nombre de la m√©trica\r\n   * @param {number} durationMs - Duraci√≥n en milisegundos\r\n   * @param {Object} metadata - Metadatos adicionales\r\n   */\r\n  recordTiming(metricName, durationMs, metadata = {}) {\r\n    if (!this.enabled) return;\r\n    \r\n    if (!this.metrics.timings[metricName]) {\r\n      this.metrics.timings[metricName] = {\r\n        count: 0,\r\n        total: 0,\r\n        min: Number.MAX_SAFE_INTEGER,\r\n        max: 0,\r\n        samples: []\r\n      };\r\n    }\r\n    \r\n    const timing = this.metrics.timings[metricName];\r\n    timing.count++;\r\n    timing.total += durationMs;\r\n    timing.min = Math.min(timing.min, durationMs);\r\n    timing.max = Math.max(timing.max, durationMs);\r\n    \r\n    // Guardar muestra con metadatos\r\n    timing.samples.push({\r\n      duration: durationMs,\r\n      timestamp: Date.now(),\r\n      metadata\r\n    });\r\n    \r\n    // Limitar n√∫mero de muestras guardadas\r\n    if (timing.samples.length > 10) {\r\n      timing.samples.shift();\r\n    }\r\n    \r\n    if (this.config.logLevel >= 3) {\r\n      console.debug(`‚è±Ô∏è Tiempo ${metricName}: ${durationMs.toFixed(2)}ms`);\r\n    }\r\n    \r\n    // Si la operaci√≥n es lenta (> 1 segundo), registrar como evento\r\n    if (durationMs > 1000) {\r\n      this.logEvent('slow_operation', {\r\n        operation: metricName,\r\n        duration: durationMs,\r\n        ...metadata\r\n      });\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Incrementar un contador\r\n   * @param {string} counterName - Nombre del contador\r\n   * @param {number} value - Valor a incrementar (por defecto 1)\r\n   */\r\n  incrementCounter(counterName, value = 1) {\r\n    if (!this.enabled) return;\r\n    \r\n    if (!this.metrics.counters[counterName]) {\r\n      this.metrics.counters[counterName] = 0;\r\n    }\r\n    \r\n    this.metrics.counters[counterName] += value;\r\n  }\r\n  \r\n  /**\r\n   * Monitorear el tiempo de ejecuci√≥n de una funci√≥n\r\n   * @param {string} operationName - Nombre de la operaci√≥n\r\n   * @param {Function} fn - Funci√≥n a monitorear\r\n   * @param {Object} metadata - Metadatos adicionales\r\n   * @returns {any} El resultado de la funci√≥n\r\n   */\r\n  async measureAsync(operationName, fn, metadata = {}) {\r\n    if (!this.enabled) return fn();\r\n    \r\n    const startTime = performance.now();\r\n    \r\n    try {\r\n      return await fn();\r\n    } catch (error) {\r\n      this.logError(`${operationName}_error`, error, metadata);\r\n      throw error;\r\n    } finally {\r\n      const duration = performance.now() - startTime;\r\n      this.recordTiming(operationName, duration, metadata);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Monitorear el tiempo de ejecuci√≥n de una funci√≥n sincr√≥nica\r\n   * @param {string} operationName - Nombre de la operaci√≥n\r\n   * @param {Function} fn - Funci√≥n a monitorear\r\n   * @param {Object} metadata - Metadatos adicionales\r\n   * @returns {any} El resultado de la funci√≥n\r\n   */\r\n  measure(operationName, fn, metadata = {}) {\r\n    if (!this.enabled) return fn();\r\n    \r\n    const startTime = performance.now();\r\n    \r\n    try {\r\n      return fn();\r\n    } catch (error) {\r\n      this.logError(`${operationName}_error`, error, metadata);\r\n      throw error;\r\n    } finally {\r\n      const duration = performance.now() - startTime;\r\n      this.recordTiming(operationName, duration, metadata);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Enviar m√©tricas recopiladas al servidor\r\n   * @returns {Promise<void>}\r\n   * @private\r\n   */\r\n  async flushMetrics() {\r\n    if (!this.enabled || this.pendingFlush || \r\n        (this.metrics.events.length === 0 && \r\n         this.metrics.errors.length === 0 && \r\n         Object.keys(this.metrics.timings).length === 0)) {\r\n      return;\r\n    }\r\n    \r\n    this.pendingFlush = true;\r\n    \r\n    // Clonar y reiniciar m√©tricas\r\n    const metricsToSend = { ...this.metrics };\r\n    this.metrics = {\r\n      events: [],\r\n      errors: [],\r\n      timings: {},\r\n      counters: { ...this.metrics.counters }\r\n    };\r\n    \r\n    try {\r\n      // Si hay URL de endpoint configurada, enviar m√©tricas\r\n      if (this.config.reportUrl) {\r\n        const response = await fetch(this.config.reportUrl, {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            timestamp: Date.now(),\r\n            appVersion: import.meta.env.VITE_APP_VERSION || 'dev',\r\n            metrics: metricsToSend\r\n          })\r\n        });\r\n        \r\n        if (!response.ok) {\r\n          console.warn('Error al enviar m√©tricas:', response.statusText);\r\n        }\r\n      } else {\r\n        // Si no hay URL, guardar localmente para desarrollo\r\n        if (this.config.logLevel >= 2) {\r\n          console.info('üìä M√©tricas recopiladas:', metricsToSend);\r\n        }\r\n        \r\n        // Almacenar √∫ltimas m√©tricas en localStorage para debugging\r\n        try {\r\n          localStorage.setItem('lovenda_last_metrics', JSON.stringify(metricsToSend));\r\n        } catch (e) {\r\n          // Ignorar errores de localStorage\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al procesar m√©tricas:', error);\r\n      \r\n      // Restaurar eventos y errores no enviados\r\n      this.metrics.events = [...metricsToSend.events, ...this.metrics.events];\r\n      this.metrics.errors = [...metricsToSend.errors, ...this.metrics.errors];\r\n    } finally {\r\n      this.pendingFlush = false;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Monitorear espec√≠ficamente operaciones del sistema de emails\r\n   * @param {string} operation - Operaci√≥n espec√≠fica (enviar, recibir, etc.)\r\n   * @param {Function} fn - Funci√≥n a monitorear\r\n   * @param {Object} metadata - Metadatos adicionales\r\n   * @returns {Promise<any>} Resultado de la funci√≥n\r\n   */\r\n  async monitorEmailOperation(operation, fn, metadata = {}) {\r\n    if (!this.enabled || !this.config.metrics.emailProcessing) {\r\n      return fn();\r\n    }\r\n    \r\n    // Registrar el evento de operaci√≥n de email\r\n    this.logEvent(`email_operation_${operation}`, {\r\n      ...metadata,\r\n      timestamp: Date.now()\r\n    });\r\n    \r\n    // Incrementar contador de operaciones por tipo\r\n    this.incrementCounter(`email_operation_${operation}`);\r\n    \r\n    return this.measureAsync(`email_${operation}`, fn, metadata);\r\n  }\r\n  \r\n  /**\r\n   * Monitorear el uso de plantillas de email\r\n   * @param {string} templateId - ID o nombre de la plantilla\r\n   * @param {string} category - Categor√≠a de la plantilla\r\n   * @param {string} action - Acci√≥n realizada (view, edit, use, create)\r\n   * @param {Function} fn - Funci√≥n a monitorear\r\n   * @param {Object} metadata - Metadatos adicionales\r\n   * @returns {Promise<any>} Resultado de la funci√≥n\r\n   */\r\n  async monitorTemplateUsage(templateId, category, action, fn, metadata = {}) {\r\n    if (!this.enabled || !this.config.metrics.emailProcessing) {\r\n      return fn();\r\n    }\r\n    \r\n    // Registrar el evento de uso de plantilla\r\n    this.logEvent('template_usage', {\r\n      templateId,\r\n      category,\r\n      action,\r\n      ...metadata\r\n    });\r\n    \r\n    // Incrementar contadores espec√≠ficos\r\n    this.incrementCounter(`template_${action}`);\r\n    this.incrementCounter(`template_category_${category}`);\r\n    \r\n    return this.measureAsync(`template_${action}`, fn, {\r\n      templateId,\r\n      category,\r\n      ...metadata\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * Monitorear el rendimiento de renderizado de plantillas\r\n   * @param {string} templateId - ID o nombre de la plantilla\r\n   * @param {number} dataSize - Tama√±o de los datos de la plantilla (en bytes)\r\n   * @param {Function} fn - Funci√≥n de renderizado\r\n   * @returns {Promise<any>} Resultado del renderizado\r\n   */\r\n  async monitorTemplateRendering(templateId, dataSize, fn) {\r\n    if (!this.enabled || !this.config.metrics.emailProcessing) {\r\n      return fn();\r\n    }\r\n    \r\n    return this.measureAsync('template_rendering', fn, {\r\n      templateId,\r\n      dataSize,\r\n      timestamp: Date.now()\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * Monitorear el proceso de entrega de email\r\n   * @param {string} emailId - ID del email\r\n   * @param {string} recipientType - Tipo de destinatario (provider, guest, etc.)\r\n   * @param {Function} fn - Funci√≥n de entrega\r\n   * @param {Object} metadata - Metadatos adicionales\r\n   * @returns {Promise<any>} Resultado de la entrega\r\n   */\r\n  async monitorEmailDelivery(emailId, recipientType, fn, metadata = {}) {\r\n    if (!this.enabled || !this.config.metrics.emailProcessing) {\r\n      return fn();\r\n    }\r\n    \r\n    // Registrar evento de intento de entrega\r\n    this.logEvent('email_delivery_attempt', {\r\n      emailId,\r\n      recipientType,\r\n      ...metadata\r\n    });\r\n    \r\n    // Incrementar contador de intentos por tipo de destinatario\r\n    this.incrementCounter(`email_delivery_${recipientType}`);\r\n    \r\n    try {\r\n      const result = await this.measureAsync('email_delivery', fn, {\r\n        emailId,\r\n        recipientType,\r\n        ...metadata\r\n      });\r\n      \r\n      // Registrar √©xito de entrega\r\n      this.logEvent('email_delivery_success', {\r\n        emailId,\r\n        recipientType,\r\n        ...metadata\r\n      });\r\n      \r\n      return result;\r\n    } catch (error) {\r\n      // Registrar fallo de entrega\r\n      this.logEvent('email_delivery_failure', {\r\n        emailId,\r\n        recipientType,\r\n        errorMessage: error.message,\r\n        ...metadata\r\n      });\r\n      \r\n      // Incrementar contador de fallos\r\n      this.incrementCounter('email_delivery_failures');\r\n      \r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Monitorear interacciones con emails (aperturas, clics, etc.)\r\n   * @param {string} emailId - ID del email\r\n   * @param {string} interactionType - Tipo de interacci√≥n (open, click, etc.)\r\n   * @param {Object} metadata - Metadatos adicionales\r\n   */\r\n  trackEmailInteraction(emailId, interactionType, metadata = {}) {\r\n    if (!this.enabled || !this.config.metrics.emailProcessing) {\r\n      return;\r\n    }\r\n    \r\n    // Registrar evento de interacci√≥n\r\n    this.logEvent('email_interaction', {\r\n      emailId,\r\n      interactionType,\r\n      timestamp: Date.now(),\r\n      ...metadata\r\n    });\r\n    \r\n    // Incrementar contadores espec√≠ficos\r\n    this.incrementCounter(`email_interaction_${interactionType}`);\r\n    this.incrementCounter('email_interactions_total');\r\n  }\r\n  \r\n  /**\r\n   * Monitorear b√∫squeda global\r\n   * @param {string} query - Consulta de b√∫squeda\r\n   * @param {Function} fn - Funci√≥n de b√∫squeda\r\n   * @returns {Promise<any>} Resultados de b√∫squeda\r\n   */\r\n  async monitorSearch(query, fn) {\r\n    if (!this.enabled || !this.config.metrics.searchPerformance) {\r\n      return fn();\r\n    }\r\n    \r\n    return this.measureAsync('search', fn, {\r\n      query,\r\n      queryLength: query?.length || 0\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * Monitorear renderizado de notificaciones\r\n   * @param {number} count - Cantidad de notificaciones\r\n   * @param {Function} fn - Funci√≥n de renderizado\r\n   * @returns {any} Resultado del renderizado\r\n   */\r\n  monitorNotificationRendering(count, fn) {\r\n    if (!this.enabled || !this.config.metrics.notificationsRendering) {\r\n      return fn();\r\n    }\r\n    \r\n    return this.measure('notification_rendering', fn, { count });\r\n  }\r\n  \r\n  /**\r\n   * Monitorear detecci√≥n de eventos en emails\r\n   * @param {string} emailId - ID del email\r\n   * @param {number} contentLength - Longitud del contenido\r\n   * @param {Function} fn - Funci√≥n de detecci√≥n\r\n   * @returns {Promise<any>} Eventos detectados\r\n   */\r\n  async monitorEventDetection(emailId, contentLength, fn) {\r\n    if (!this.enabled || !this.config.metrics.eventDetection) {\r\n      return fn();\r\n    }\r\n    \r\n    return this.measureAsync('event_detection', fn, {\r\n      emailId,\r\n      contentLength\r\n    });\r\n  }\r\n}\r\n\r\n// Instancia singleton para uso en toda la aplicaci√≥n\r\nexport const performanceMonitor = new PerformanceMonitor();\r\n\r\n// Hooks para facilitar el uso en componentes React\r\nexport function usePerformanceMonitor() {\r\n  return performanceMonitor;\r\n}\r\n\r\n// Hook espec√≠fico para medir el tiempo de carga de un componente\r\nexport function useComponentLoadTime(componentName) {\r\n  const mountTime = performance.now();\r\n  \r\n  useEffect(() => {\r\n    if (!performanceMonitor.enabled) return;\r\n    \r\n    const loadTime = performance.now() - mountTime;\r\n    performanceMonitor.recordTiming(`component_load_${componentName}`, loadTime, {\r\n      component: componentName\r\n    });\r\n    \r\n    // Medir tiempo de desmontar al limpiar el efecto\r\n    return () => {\r\n      const unmountStart = performance.now();\r\n      \r\n      // Usamos setTimeout para medir despu√©s de que el componente se haya desmontado\r\n      setTimeout(() => {\r\n        const unmountTime = performance.now() - unmountStart;\r\n        performanceMonitor.recordTiming(`component_unmount_${componentName}`, unmountTime, {\r\n          component: componentName\r\n        });\r\n      }, 0);\r\n    };\r\n  }, [componentName]);\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\ProveedorService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\StatsService\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\SyncService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\TagService\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\TemplateCacheService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\UserService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\WeddingService.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'getDoc' is defined but never used. Allowed unused vars must match /^_/u.","line":20,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":9},{"ruleId":"no-unused-vars","severity":1,"message":"'addDoc' is defined but never used. Allowed unused vars must match /^_/u.","line":21,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":9}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Servicio para gestionar bodas y vincular cuentas (novios y planners)\r\n// Cada documento en la colecci√≥n \"weddings\" representa una boda.\r\n// Estructura m√≠nima de un doc:\r\n// {\r\n//   ownerIds: [uid1, uid2],   // novios con acceso total\r\n//   plannerIds: [uid3, ...],  // planners que gestionan varias bodas\r\n//   subscription: {\r\n//     tier: 'free' | 'premium',\r\n//     renewedAt: Timestamp\r\n//   },\r\n//   createdAt: Timestamp\r\n// }\r\n\r\nimport { db } from '../firebaseConfig';\r\nimport {\r\n  doc,\r\n  setDoc,\r\n  updateDoc,\r\n  arrayUnion,\r\n  getDoc,\r\n  addDoc,\r\n  collection,\r\n  Timestamp\r\n} from 'firebase/firestore';\r\n\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport { collectionGroup } from 'firebase/firestore';\r\nimport { query, where, getDocs, limit } from 'firebase/firestore';\r\n\r\n\r\n/**\r\n * Crea una nueva boda y asigna al usuario como propietario principal.\r\n * @param {string} uid - UID del usuario creador.\r\n * @param {object} [extraData] - Datos opcionales de la boda (fecha, nombre...)\r\n * @returns {Promise<string>} weddingId creado\r\n */\r\nexport async function createWedding(uid, extraData = {}) {\r\n  if (!uid) throw new Error('uid requerido');\r\n  const weddingId = uuidv4();\r\n  const ref = doc(db, 'weddings', weddingId);\r\n  const base = {\r\n    ownerIds: [uid],\r\n    plannerIds: [],\r\n    subscription: { tier: 'free', renewedAt: Timestamp.now() },\r\n    createdAt: Timestamp.now(),\r\n    ...extraData,\r\n  };\r\n  await setDoc(ref, base);\r\n  // Inicializar subcolecci√≥n de finanzas\r\n  try {\r\n    const financeRef = doc(db, 'weddings', weddingId, 'finance', 'main');\r\n    await setDoc(financeRef, { movements: [], createdAt: Timestamp.now() }, { merge: true });\r\n  } catch (e) {\r\n    console.warn('No se pudo inicializar finance/main para', weddingId, e);\r\n  }\r\n  // Actualizar doc del usuario con su weddingId principal\r\n  await updateDoc(doc(db, 'users', uid), { weddingId });\r\n  return weddingId;\r\n}\r\n\r\n/**\r\n * Crea una invitaci√≥n para otro novio/a.\r\n * @param {string} weddingId\r\n * @param {string} email\r\n * @returns {Promise<string>} invitationCode\r\n */\r\nexport async function invitePartner(weddingId, email) {\r\n  return createInvitation(weddingId, email, 'partner');\r\n}\r\n\r\n/**\r\n * Crea una invitaci√≥n para un wedding planner.\r\n * @param {string} weddingId\r\n * @param {string} email\r\n * @returns {Promise<string>} invitationCode\r\n */\r\nexport async function invitePlanner(weddingId, email) {\r\n  return createInvitation(weddingId, email, 'planner');\r\n}\r\n\r\nasync function createInvitation(weddingId, email, role) {\r\n  if (!weddingId || !email) throw new Error('par√°metros requeridos');\r\n  const code = uuidv4();\r\n  const invRef = doc(db, 'weddings', weddingId, 'weddingInvitations', code);\r\n  await setDoc(invRef, {\r\n    code,\r\n    weddingId,\r\n    email: email.toLowerCase(),\r\n    role, // 'partner' | 'planner'\r\n    createdAt: Timestamp.now(),\r\n  });\r\n  return code;\r\n}\r\n\r\n/**\r\n * Acepta una invitaci√≥n (partner o planner) y agrega el uid al array correspondiente.\r\n * @param {string} code - invitation code\r\n * @param {string} uid  - usuario que acepta\r\n */\r\nexport async function acceptInvitation(code, uid) {\r\n  if (!code || !uid) throw new Error('par√°metros requeridos');\r\n  // Buscar c√≥digo en cualquier boda usando collectionGroup\r\n  const q = query(collectionGroup(db, 'weddingInvitations'), where('__name__', '==', code));\r\n  const res = await getDocs(q);\r\n  if (res.empty) throw new Error('Invitaci√≥n no encontrada');\r\n  const snap = res.docs[0];\r\n  const { weddingId, role } = snap.data();\r\n  const invRef = snap.ref;\r\n  const wedRef = doc(db, 'weddings', weddingId);\r\n  if (role === 'partner') {\r\n    await updateDoc(wedRef, { ownerIds: arrayUnion(uid) });\r\n  } else if (role === 'planner') {\r\n    await updateDoc(wedRef, { plannerIds: arrayUnion(uid) });\r\n  }\r\n  // Guardar weddingId en perfil de usuario si es partner\r\n  if (role === 'partner') {\r\n    await updateDoc(doc(db, 'users', uid), { weddingId });\r\n  }\r\n  // eliminar invitaci√≥n o marcar como aceptada\r\n  await setDoc(invRef, { acceptedAt: Timestamp.now() }, { merge: true });\r\n  return weddingId;\r\n}\r\n\r\n/**\r\n * Conecta directamente la cuenta de un Wedding Planner con la boda indicada (sin invitaci√≥n).\r\n * Solo debe ser usada por el propietario de la boda o un administrador.\r\n * @param {string} weddingId\r\n * @param {string} plannerUid\r\n */\r\n/**\r\n * Devuelve el primer weddingId donde el usuario es owner.\r\n * @param {string} uid\r\n * @returns {Promise<string|null>}\r\n */\r\nexport async function getWeddingIdForOwner(uid) {\r\n  const q = query(collection(db, 'weddings'), where('ownerIds', 'array-contains', uid), limit(1));\r\n  const snap = await getDocs(q);\r\n  if (snap.empty) return null;\r\n  return snap.docs[0].id;\r\n}\r\n\r\n/**\r\n * Devuelve todas las bodas donde el plannerUid figura en plannerIds.\r\n * @param {string} plannerUid\r\n * @returns {Promise<Array<{id:string,name:string,weddingDate?:string,location?:string,progress?:number}>>}\r\n */\r\nexport async function getWeddingsForPlanner(plannerUid) {\r\n  if (!plannerUid) return [];\r\n  const q = query(collection(db, 'weddings'), where('plannerIds', 'array-contains', plannerUid));\r\n  const snap = await getDocs(q);\r\n  return snap.docs.map(d => ({ id: d.id, ...d.data() }));\r\n}\r\n\r\nexport async function addPlannerToWedding(weddingId, plannerUid) {\r\n  if (!weddingId || !plannerUid) throw new Error('par√°metros requeridos');\r\n  const wedRef = doc(db, 'weddings', weddingId);\r\n  await updateDoc(wedRef, { plannerIds: arrayUnion(plannerUid) });\r\n  // Opcional: guardar referencia de bodas que gestiona el planner\r\n  await updateDoc(doc(db, 'users', plannerUid), { plannerWeddingIds: arrayUnion(weddingId) });\r\n  return true;\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\__tests__\\TemplateCacheService.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\authService.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'updateEmail' is defined but never used. Allowed unused vars must match /^_/u.","line":14,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'updatePassword' is defined but never used. Allowed unused vars must match /^_/u.","line":15,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Servicio avanzado de autenticaci√≥n con refresh tokens y gesti√≥n de sesiones\r\n * Maneja autom√°ticamente la renovaci√≥n de tokens y sesiones expiradas\r\n */\r\n\r\nimport { \r\n  signInWithEmailAndPassword, \r\n  createUserWithEmailAndPassword,\r\n  signOut,\r\n  onAuthStateChanged,\r\n  updateProfile,\r\n  sendEmailVerification,\r\n  sendPasswordResetEmail,\r\n  updateEmail,\r\n  updatePassword,\r\n  reauthenticateWithCredential,\r\n  EmailAuthProvider,\r\n  setPersistence,\r\n  browserLocalPersistence,\r\n  browserSessionPersistence,\r\n  getIdToken,\r\n  getIdTokenResult\r\n} from 'firebase/auth';\r\nimport { doc, getDoc, setDoc, updateDoc, serverTimestamp } from 'firebase/firestore';\r\nimport { auth, db } from '../lib/firebase';\r\n\r\n// Configuraci√≥n del servicio\r\nconst AUTH_CONFIG = {\r\n  TOKEN_REFRESH_INTERVAL: 50 * 60 * 1000, // 50 minutos (Firebase tokens duran 1 hora)\r\n  SESSION_CHECK_INTERVAL: 5 * 60 * 1000,  // 5 minutos\r\n  MAX_RETRY_ATTEMPTS: 3,\r\n  RETRY_DELAY: 1000, // 1 segundo\r\n  STORAGE_KEYS: {\r\n    USER: 'lovenda_user_session',\r\n    PREFERENCES: 'lovenda_user_preferences',\r\n    LAST_ACTIVITY: 'lovenda_last_activity',\r\n    LOGIN_EMAIL: 'lovenda_login_email'\r\n  }\r\n};\r\n\r\n// Estado global del servicio\r\nlet tokenRefreshTimer = null;\r\nlet sessionCheckTimer = null;\r\nlet authStateListeners = [];\r\nlet currentUserData = null;\r\n\r\n/**\r\n * Clase para manejar errores de autenticaci√≥n\r\n */\r\nclass AuthError extends Error {\r\n  constructor(code, message, originalError = null) {\r\n    super(message);\r\n    this.name = 'AuthError';\r\n    this.code = code;\r\n    this.originalError = originalError;\r\n  }\r\n}\r\n\r\n/**\r\n * Obtiene el perfil completo del usuario desde Firestore\r\n * @param {string} uid - ID del usuario\r\n * @returns {Promise<Object>} - Datos del usuario\r\n */\r\nconst getUserProfile = async (uid) => {\r\n  try {\r\n    const userDoc = await getDoc(doc(db, 'users', uid));\r\n    if (userDoc.exists()) {\r\n      return userDoc.data();\r\n    }\r\n    return null;\r\n  } catch (error) {\r\n    console.error('Error obteniendo perfil de usuario:', error);\r\n    return null;\r\n  }\r\n};\r\n\r\n/**\r\n * Crea o actualiza el perfil del usuario en Firestore\r\n * @param {Object} user - Usuario de Firebase Auth\r\n * @param {Object} additionalData - Datos adicionales\r\n * @returns {Promise<Object>} - Perfil actualizado\r\n */\r\nconst createOrUpdateUserProfile = async (user, additionalData = {}) => {\r\n  try {\r\n    const userRef = doc(db, 'users', user.uid);\r\n    const existingProfile = await getUserProfile(user.uid);\r\n    \r\n    const profileData = {\r\n      uid: user.uid,\r\n      email: user.email,\r\n      displayName: user.displayName || user.email?.split('@')[0] || 'Usuario',\r\n      photoURL: user.photoURL || null,\r\n      emailVerified: user.emailVerified,\r\n      lastLogin: serverTimestamp(),\r\n      updatedAt: serverTimestamp(),\r\n      ...additionalData\r\n    };\r\n\r\n    // Si es un usuario nuevo, a√±adir datos de creaci√≥n\r\n    if (!existingProfile) {\r\n      profileData.createdAt = serverTimestamp();\r\n      profileData.role = additionalData.role || 'particular';\r\n      profileData.preferences = {\r\n        theme: 'light',\r\n        language: 'es',\r\n        emailNotifications: true,\r\n        pushNotifications: true\r\n      };\r\n    } else {\r\n      // Mantener datos existentes importantes\r\n      profileData.role = existingProfile.role || 'particular';\r\n      profileData.createdAt = existingProfile.createdAt;\r\n      profileData.preferences = { ...existingProfile.preferences, ...additionalData.preferences };\r\n    }\r\n\r\n    await setDoc(userRef, profileData, { merge: true });\r\n    return profileData;\r\n  } catch (error) {\r\n    console.error('Error creando/actualizando perfil:', error);\r\n    throw new AuthError('profile-update-failed', 'Error al actualizar el perfil del usuario', error);\r\n  }\r\n};\r\n\r\n/**\r\n * Actualiza la actividad del usuario\r\n */\r\nconst updateUserActivity = () => {\r\n  const now = Date.now();\r\n  localStorage.setItem(AUTH_CONFIG.STORAGE_KEYS.LAST_ACTIVITY, now.toString());\r\n  \r\n  // Actualizar en Firestore si hay usuario autenticado\r\n  if (auth.currentUser) {\r\n    const userRef = doc(db, 'users', auth.currentUser.uid);\r\n    updateDoc(userRef, { \r\n      lastActivity: serverTimestamp() \r\n    }).catch(error => {\r\n      console.warn('Error actualizando actividad:', error);\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n * Verifica si la sesi√≥n ha expirado por inactividad\r\n * @returns {boolean} - True si la sesi√≥n ha expirado\r\n */\r\nconst isSessionExpired = () => {\r\n  const lastActivity = localStorage.getItem(AUTH_CONFIG.STORAGE_KEYS.LAST_ACTIVITY);\r\n  if (!lastActivity) return false;\r\n  \r\n  const now = Date.now();\r\n  const timeSinceLastActivity = now - parseInt(lastActivity);\r\n  const maxInactivity = 24 * 60 * 60 * 1000; // 24 horas\r\n  \r\n  return timeSinceLastActivity > maxInactivity;\r\n};\r\n\r\n/**\r\n * Refresca el token de autenticaci√≥n\r\n * @param {boolean} forceRefresh - Forzar refresh del token\r\n * @returns {Promise<string>} - Nuevo token\r\n */\r\nconst refreshAuthToken = async (forceRefresh = false) => {\r\n  try {\r\n    if (!auth.currentUser) {\r\n      throw new AuthError('no-user', 'No hay usuario autenticado');\r\n    }\r\n\r\n    const token = await getIdToken(auth.currentUser, forceRefresh);\r\n    const tokenResult = await getIdTokenResult(auth.currentUser, forceRefresh);\r\n    \r\n    console.log('[AuthService] Token refrescado correctamente');\r\n    \r\n    // Programar siguiente refresh\r\n    scheduleTokenRefresh();\r\n    \r\n    return {\r\n      token,\r\n      expirationTime: tokenResult.expirationTime,\r\n      claims: tokenResult.claims\r\n    };\r\n  } catch (error) {\r\n    console.error('[AuthService] Error refrescando token:', error);\r\n    throw new AuthError('token-refresh-failed', 'Error al refrescar el token', error);\r\n  }\r\n};\r\n\r\n/**\r\n * Programa el refresh autom√°tico del token\r\n */\r\nconst scheduleTokenRefresh = () => {\r\n  if (tokenRefreshTimer) {\r\n    clearTimeout(tokenRefreshTimer);\r\n  }\r\n  \r\n  tokenRefreshTimer = setTimeout(() => {\r\n    refreshAuthToken(true).catch(error => {\r\n      console.error('[AuthService] Error en refresh autom√°tico:', error);\r\n      // Si falla el refresh, cerrar sesi√≥n\r\n      signOut(auth);\r\n    });\r\n  }, AUTH_CONFIG.TOKEN_REFRESH_INTERVAL);\r\n};\r\n\r\n/**\r\n * Inicia el monitoreo de sesi√≥n\r\n */\r\nconst startSessionMonitoring = () => {\r\n  // Monitorear actividad del usuario\r\n  const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'];\r\n  const throttledUpdateActivity = throttle(updateUserActivity, 30000); // M√°ximo cada 30 segundos\r\n  \r\n  events.forEach(event => {\r\n    document.addEventListener(event, throttledUpdateActivity, true);\r\n  });\r\n\r\n  // Verificar sesi√≥n peri√≥dicamente\r\n  if (sessionCheckTimer) {\r\n    clearInterval(sessionCheckTimer);\r\n  }\r\n  \r\n  sessionCheckTimer = setInterval(() => {\r\n    if (isSessionExpired()) {\r\n      console.log('[AuthService] Sesi√≥n expirada por inactividad');\r\n      signOut(auth);\r\n    }\r\n  }, AUTH_CONFIG.SESSION_CHECK_INTERVAL);\r\n};\r\n\r\n/**\r\n * Detiene el monitoreo de sesi√≥n\r\n */\r\nconst stopSessionMonitoring = () => {\r\n  if (tokenRefreshTimer) {\r\n    clearTimeout(tokenRefreshTimer);\r\n    tokenRefreshTimer = null;\r\n  }\r\n  \r\n  if (sessionCheckTimer) {\r\n    clearInterval(sessionCheckTimer);\r\n    sessionCheckTimer = null;\r\n  }\r\n};\r\n\r\n/**\r\n * Funci√≥n throttle para limitar frecuencia de ejecuci√≥n\r\n */\r\nconst throttle = (func, limit) => {\r\n  let inThrottle;\r\n  return function() {\r\n    const args = arguments;\r\n    const context = this;\r\n    if (!inThrottle) {\r\n      func.apply(context, args);\r\n      inThrottle = true;\r\n      setTimeout(() => inThrottle = false, limit);\r\n    }\r\n  };\r\n};\r\n\r\n/**\r\n * Iniciar sesi√≥n con email y contrase√±a\r\n * @param {string} email - Email del usuario\r\n * @param {string} password - Contrase√±a\r\n * @param {boolean} rememberMe - Recordar sesi√≥n\r\n * @returns {Promise<Object>} - Datos del usuario\r\n */\r\nexport const login = async (email, password, rememberMe = true) => {\r\n  try {\r\n    // Configurar persistencia\r\n    const persistence = rememberMe ? browserLocalPersistence : browserSessionPersistence;\r\n    await setPersistence(auth, persistence);\r\n\r\n    // Autenticar usuario\r\n    const userCredential = await signInWithEmailAndPassword(auth, email, password);\r\n    const user = userCredential.user;\r\n\r\n    // Obtener/crear perfil completo\r\n    const profile = await createOrUpdateUserProfile(user);\r\n    \r\n    // Guardar email si se solicita recordar\r\n    if (rememberMe) {\r\n      localStorage.setItem(AUTH_CONFIG.STORAGE_KEYS.LOGIN_EMAIL, email);\r\n    } else {\r\n      localStorage.removeItem(AUTH_CONFIG.STORAGE_KEYS.LOGIN_EMAIL);\r\n    }\r\n\r\n    // Iniciar monitoreo de sesi√≥n\r\n    startSessionMonitoring();\r\n    scheduleTokenRefresh();\r\n    updateUserActivity();\r\n\r\n    const userData = { ...user, ...profile };\r\n    currentUserData = userData;\r\n\r\n    console.log('[AuthService] Login exitoso:', user.email);\r\n    return userData;\r\n  } catch (error) {\r\n    console.error('[AuthService] Error en login:', error);\r\n    \r\n    let errorMessage = 'Error al iniciar sesi√≥n';\r\n    switch (error.code) {\r\n      case 'auth/user-not-found':\r\n        errorMessage = 'Usuario no encontrado';\r\n        break;\r\n      case 'auth/wrong-password':\r\n        errorMessage = 'Contrase√±a incorrecta';\r\n        break;\r\n      case 'auth/invalid-email':\r\n        errorMessage = 'Email inv√°lido';\r\n        break;\r\n      case 'auth/user-disabled':\r\n        errorMessage = 'Usuario deshabilitado';\r\n        break;\r\n      case 'auth/too-many-requests':\r\n        errorMessage = 'Demasiados intentos. Intenta m√°s tarde';\r\n        break;\r\n    }\r\n    \r\n    throw new AuthError(error.code, errorMessage, error);\r\n  }\r\n};\r\n\r\n/**\r\n * Registrar nuevo usuario\r\n * @param {string} email - Email del usuario\r\n * @param {string} password - Contrase√±a\r\n * @param {Object} additionalData - Datos adicionales del perfil\r\n * @returns {Promise<Object>} - Datos del usuario creado\r\n */\r\nexport const register = async (email, password, additionalData = {}) => {\r\n  try {\r\n    const userCredential = await createUserWithEmailAndPassword(auth, email, password);\r\n    const user = userCredential.user;\r\n\r\n    // Actualizar perfil de Firebase Auth si se proporciona displayName\r\n    if (additionalData.displayName) {\r\n      await updateProfile(user, { displayName: additionalData.displayName });\r\n    }\r\n\r\n    // Crear perfil en Firestore\r\n    const profile = await createOrUpdateUserProfile(user, additionalData);\r\n\r\n    // Enviar email de verificaci√≥n\r\n    await sendEmailVerification(user);\r\n\r\n    console.log('[AuthService] Registro exitoso:', user.email);\r\n    return { ...user, ...profile };\r\n  } catch (error) {\r\n    console.error('[AuthService] Error en registro:', error);\r\n    \r\n    let errorMessage = 'Error al crear la cuenta';\r\n    switch (error.code) {\r\n      case 'auth/email-already-in-use':\r\n        errorMessage = 'El email ya est√° en uso';\r\n        break;\r\n      case 'auth/invalid-email':\r\n        errorMessage = 'Email inv√°lido';\r\n        break;\r\n      case 'auth/weak-password':\r\n        errorMessage = 'La contrase√±a es muy d√©bil';\r\n        break;\r\n    }\r\n    \r\n    throw new AuthError(error.code, errorMessage, error);\r\n  }\r\n};\r\n\r\n/**\r\n * Cerrar sesi√≥n\r\n * @returns {Promise<void>}\r\n */\r\nexport const logout = async () => {\r\n  try {\r\n    stopSessionMonitoring();\r\n    \r\n    // Limpiar datos locales\r\n    Object.values(AUTH_CONFIG.STORAGE_KEYS).forEach(key => {\r\n      if (key !== AUTH_CONFIG.STORAGE_KEYS.LOGIN_EMAIL) {\r\n        localStorage.removeItem(key);\r\n      }\r\n    });\r\n\r\n    currentUserData = null;\r\n    await signOut(auth);\r\n    \r\n    console.log('[AuthService] Logout exitoso');\r\n  } catch (error) {\r\n    console.error('[AuthService] Error en logout:', error);\r\n    throw new AuthError('logout-failed', 'Error al cerrar sesi√≥n', error);\r\n  }\r\n};\r\n\r\n/**\r\n * Obtener usuario actual con datos completos\r\n * @returns {Object|null} - Datos del usuario actual\r\n */\r\nexport const getCurrentUser = () => {\r\n  return currentUserData;\r\n};\r\n\r\n/**\r\n * Verificar si el usuario est√° autenticado\r\n * @returns {boolean} - True si est√° autenticado\r\n */\r\nexport const isAuthenticated = () => {\r\n  return !!auth.currentUser && !!currentUserData;\r\n};\r\n\r\n/**\r\n * Suscribirse a cambios de estado de autenticaci√≥n\r\n * @param {Function} callback - Funci√≥n callback\r\n * @returns {Function} - Funci√≥n para desuscribirse\r\n */\r\nexport const onAuthStateChange = (callback) => {\r\n  authStateListeners.push(callback);\r\n  \r\n  const unsubscribe = onAuthStateChanged(auth, async (user) => {\r\n    if (user) {\r\n      try {\r\n        // Verificar si la sesi√≥n ha expirado\r\n        if (isSessionExpired()) {\r\n          await signOut(auth);\r\n          return;\r\n        }\r\n\r\n        // Obtener perfil completo\r\n        const profile = await getUserProfile(user.uid);\r\n        const userData = { ...user, ...profile };\r\n        currentUserData = userData;\r\n        \r\n        // Iniciar monitoreo si no est√° activo\r\n        if (!tokenRefreshTimer) {\r\n          startSessionMonitoring();\r\n          scheduleTokenRefresh();\r\n        }\r\n        \r\n        updateUserActivity();\r\n        callback(userData);\r\n      } catch (error) {\r\n        console.error('[AuthService] Error procesando cambio de estado:', error);\r\n        callback(null);\r\n      }\r\n    } else {\r\n      stopSessionMonitoring();\r\n      currentUserData = null;\r\n      callback(null);\r\n    }\r\n  });\r\n\r\n  return () => {\r\n    const index = authStateListeners.indexOf(callback);\r\n    if (index > -1) {\r\n      authStateListeners.splice(index, 1);\r\n    }\r\n    unsubscribe();\r\n  };\r\n};\r\n\r\n/**\r\n * Reautenticar usuario con credenciales\r\n * @param {string} password - Contrase√±a actual\r\n * @returns {Promise<void>}\r\n */\r\nexport const reauthenticate = async (password) => {\r\n  try {\r\n    if (!auth.currentUser) {\r\n      throw new AuthError('no-user', 'No hay usuario autenticado');\r\n    }\r\n\r\n    const credential = EmailAuthProvider.credential(auth.currentUser.email, password);\r\n    await reauthenticateWithCredential(auth.currentUser, credential);\r\n    \r\n    console.log('[AuthService] Reautenticaci√≥n exitosa');\r\n  } catch (error) {\r\n    console.error('[AuthService] Error en reautenticaci√≥n:', error);\r\n    throw new AuthError('reauthentication-failed', 'Error al reautenticar', error);\r\n  }\r\n};\r\n\r\n/**\r\n * Enviar email de restablecimiento de contrase√±a\r\n * @param {string} email - Email del usuario\r\n * @returns {Promise<void>}\r\n */\r\nexport const sendPasswordReset = async (email) => {\r\n  try {\r\n    await sendPasswordResetEmail(auth, email);\r\n    console.log('[AuthService] Email de restablecimiento enviado');\r\n  } catch (error) {\r\n    console.error('[AuthService] Error enviando email de restablecimiento:', error);\r\n    throw new AuthError('password-reset-failed', 'Error al enviar email de restablecimiento', error);\r\n  }\r\n};\r\n\r\n/**\r\n * Actualizar perfil del usuario\r\n * @param {Object} updates - Datos a actualizar\r\n * @returns {Promise<Object>} - Perfil actualizado\r\n */\r\nexport const updateUserProfile = async (updates) => {\r\n  try {\r\n    if (!auth.currentUser) {\r\n      throw new AuthError('no-user', 'No hay usuario autenticado');\r\n    }\r\n\r\n    // Actualizar en Firebase Auth si es necesario\r\n    if (updates.displayName || updates.photoURL) {\r\n      await updateProfile(auth.currentUser, {\r\n        displayName: updates.displayName,\r\n        photoURL: updates.photoURL\r\n      });\r\n    }\r\n\r\n    // Actualizar en Firestore\r\n    const userRef = doc(db, 'users', auth.currentUser.uid);\r\n    await updateDoc(userRef, {\r\n      ...updates,\r\n      updatedAt: serverTimestamp()\r\n    });\r\n\r\n    // Actualizar datos locales\r\n    const updatedProfile = await getUserProfile(auth.currentUser.uid);\r\n    currentUserData = { ...auth.currentUser, ...updatedProfile };\r\n\r\n    console.log('[AuthService] Perfil actualizado correctamente');\r\n    return currentUserData;\r\n  } catch (error) {\r\n    console.error('[AuthService] Error actualizando perfil:', error);\r\n    throw new AuthError('profile-update-failed', 'Error al actualizar el perfil', error);\r\n  }\r\n};\r\n\r\n// Inicializar el servicio cuando se carga el m√≥dulo\r\nif (typeof window !== 'undefined') {\r\n  // Restaurar actividad si existe\r\n  const lastActivity = localStorage.getItem(AUTH_CONFIG.STORAGE_KEYS.LAST_ACTIVITY);\r\n  if (!lastActivity) {\r\n    updateUserActivity();\r\n  }\r\n}\r\n\r\n// Exportar AuthError como named export\r\nexport { AuthError };\r\n\r\nexport default {\r\n  login,\r\n  register,\r\n  logout,\r\n  getCurrentUser,\r\n  isAuthenticated,\r\n  onAuthStateChange,\r\n  reauthenticate,\r\n  sendPasswordReset,\r\n  updateUserProfile,\r\n  refreshAuthToken,\r\n  AuthError\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\bankService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\blogService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\commentService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\componentCacheService.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useRef' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":38},{"ruleId":"no-unused-vars","severity":1,"message":"'pattern' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":181,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":181,"endColumn":18},{"ruleId":"no-undef","severity":2,"message":"'useState' is not defined.","line":248,"column":29,"nodeType":"Identifier","messageId":"undef","endLine":248,"endColumn":37}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Servicio de cach√© inteligente para componentes React\r\n * Optimiza el rendimiento cach√©ando resultados de componentes pesados\r\n */\r\n\r\nimport { useMemo, useCallback, useRef, useEffect } from 'react';\r\n\r\n// Cach√© global en memoria\r\nconst globalCache = new Map();\r\nconst cacheStats = {\r\n  hits: 0,\r\n  misses: 0,\r\n  evictions: 0\r\n};\r\n\r\n// Configuraci√≥n por defecto\r\nconst DEFAULT_CONFIG = {\r\n  maxSize: 100, // M√°ximo n√∫mero de entradas en cach√©\r\n  ttl: 5 * 60 * 1000, // 5 minutos en millisegundos\r\n  enableStats: true\r\n};\r\n\r\n/**\r\n * Genera una clave de cach√© basada en props y dependencias\r\n * @param {string} componentName - Nombre del componente\r\n * @param {Object} props - Props del componente\r\n * @param {Array} deps - Dependencias adicionales\r\n * @returns {string} - Clave √∫nica de cach√©\r\n */\r\nconst generateCacheKey = (componentName, props = {}, deps = []) => {\r\n  const propsString = JSON.stringify(props, Object.keys(props).sort());\r\n  const depsString = JSON.stringify(deps);\r\n  return `${componentName}:${btoa(propsString + depsString)}`;\r\n};\r\n\r\n/**\r\n * Limpia entradas expiradas del cach√©\r\n */\r\nconst cleanExpiredEntries = () => {\r\n  const now = Date.now();\r\n  let cleaned = 0;\r\n  \r\n  for (const [key, entry] of globalCache.entries()) {\r\n    if (now > entry.expiresAt) {\r\n      globalCache.delete(key);\r\n      cleaned++;\r\n    }\r\n  }\r\n  \r\n  if (cleaned > 0) {\r\n    cacheStats.evictions += cleaned;\r\n    console.log(`[ComponentCache] Limpiadas ${cleaned} entradas expiradas`);\r\n  }\r\n};\r\n\r\n/**\r\n * Aplica pol√≠tica LRU cuando el cach√© est√° lleno\r\n */\r\nconst evictLRU = () => {\r\n  if (globalCache.size <= DEFAULT_CONFIG.maxSize) return;\r\n  \r\n  // Encontrar la entrada menos recientemente usada\r\n  let oldestKey = null;\r\n  let oldestTime = Infinity;\r\n  \r\n  for (const [key, entry] of globalCache.entries()) {\r\n    if (entry.lastAccessed < oldestTime) {\r\n      oldestTime = entry.lastAccessed;\r\n      oldestKey = key;\r\n    }\r\n  }\r\n  \r\n  if (oldestKey) {\r\n    globalCache.delete(oldestKey);\r\n    cacheStats.evictions++;\r\n  }\r\n};\r\n\r\n/**\r\n * Hook para cachear resultados de computaciones pesadas en componentes\r\n * @param {Function} computeFn - Funci√≥n de computaci√≥n\r\n * @param {Array} deps - Dependencias\r\n * @param {Object} options - Opciones de cach√©\r\n * @returns {any} - Resultado cacheado\r\n */\r\nexport const useCachedComputation = (computeFn, deps = [], options = {}) => {\r\n  const config = { ...DEFAULT_CONFIG, ...options };\r\n  const componentName = options.name || 'anonymous';\r\n  \r\n  return useMemo(() => {\r\n    const cacheKey = generateCacheKey(componentName, {}, deps);\r\n    const now = Date.now();\r\n    \r\n    // Verificar si existe en cach√© y no ha expirado\r\n    if (globalCache.has(cacheKey)) {\r\n      const entry = globalCache.get(cacheKey);\r\n      if (now <= entry.expiresAt) {\r\n        entry.lastAccessed = now;\r\n        cacheStats.hits++;\r\n        return entry.value;\r\n      } else {\r\n        globalCache.delete(cacheKey);\r\n      }\r\n    }\r\n    \r\n    // Computar nuevo valor\r\n    cacheStats.misses++;\r\n    const value = computeFn();\r\n    \r\n    // Limpiar cach√© si es necesario\r\n    cleanExpiredEntries();\r\n    evictLRU();\r\n    \r\n    // Guardar en cach√©\r\n    globalCache.set(cacheKey, {\r\n      value,\r\n      createdAt: now,\r\n      lastAccessed: now,\r\n      expiresAt: now + config.ttl\r\n    });\r\n    \r\n    return value;\r\n  }, deps);\r\n};\r\n\r\n/**\r\n * Hook para cachear componentes completos\r\n * @param {Function} renderFn - Funci√≥n que renderiza el componente\r\n * @param {Object} props - Props del componente\r\n * @param {Array} deps - Dependencias adicionales\r\n * @param {Object} options - Opciones de cach√©\r\n * @returns {React.ReactElement} - Componente cacheado\r\n */\r\nexport const useCachedComponent = (renderFn, props = {}, deps = [], options = {}) => {\r\n  const config = { ...DEFAULT_CONFIG, ...options };\r\n  const componentName = options.name || 'CachedComponent';\r\n  \r\n  return useMemo(() => {\r\n    const cacheKey = generateCacheKey(componentName, props, deps);\r\n    const now = Date.now();\r\n    \r\n    // Verificar cach√©\r\n    if (globalCache.has(cacheKey)) {\r\n      const entry = globalCache.get(cacheKey);\r\n      if (now <= entry.expiresAt) {\r\n        entry.lastAccessed = now;\r\n        cacheStats.hits++;\r\n        return entry.value;\r\n      } else {\r\n        globalCache.delete(cacheKey);\r\n      }\r\n    }\r\n    \r\n    // Renderizar nuevo componente\r\n    cacheStats.misses++;\r\n    const component = renderFn(props);\r\n    \r\n    // Gesti√≥n del cach√©\r\n    cleanExpiredEntries();\r\n    evictLRU();\r\n    \r\n    // Guardar en cach√©\r\n    globalCache.set(cacheKey, {\r\n      value: component,\r\n      createdAt: now,\r\n      lastAccessed: now,\r\n      expiresAt: now + config.ttl\r\n    });\r\n    \r\n    return component;\r\n  }, [renderFn, JSON.stringify(props), ...deps]);\r\n};\r\n\r\n/**\r\n * Hook para invalidar cach√© espec√≠fico\r\n * @param {string} componentName - Nombre del componente\r\n * @returns {Function} - Funci√≥n para invalidar cach√©\r\n */\r\nexport const useCacheInvalidation = (componentName) => {\r\n  return useCallback((props = {}, deps = []) => {\r\n    const pattern = generateCacheKey(componentName, props, deps);\r\n    let invalidated = 0;\r\n    \r\n    for (const key of globalCache.keys()) {\r\n      if (key.startsWith(`${componentName}:`)) {\r\n        globalCache.delete(key);\r\n        invalidated++;\r\n      }\r\n    }\r\n    \r\n    console.log(`[ComponentCache] Invalidadas ${invalidated} entradas para ${componentName}`);\r\n  }, [componentName]);\r\n};\r\n\r\n/**\r\n * Componente HOC para cachear autom√°ticamente\r\n * @param {React.Component} WrappedComponent - Componente a cachear\r\n * @param {Object} options - Opciones de cach√©\r\n * @returns {React.Component} - Componente con cach√©\r\n */\r\nexport const withCache = (WrappedComponent, options = {}) => {\r\n  const CachedComponent = (props) => {\r\n    const componentName = options.name || WrappedComponent.displayName || WrappedComponent.name;\r\n    \r\n    return useCachedComponent(\r\n      (cachedProps) => <WrappedComponent {...cachedProps} />,\r\n      props,\r\n      options.deps || [],\r\n      { ...options, name: componentName }\r\n    );\r\n  };\r\n  \r\n  CachedComponent.displayName = `withCache(${WrappedComponent.displayName || WrappedComponent.name})`;\r\n  return CachedComponent;\r\n};\r\n\r\n/**\r\n * Obtiene estad√≠sticas del cach√©\r\n * @returns {Object} - Estad√≠sticas del cach√©\r\n */\r\nexport const getCacheStats = () => {\r\n  const hitRate = cacheStats.hits + cacheStats.misses > 0 \r\n    ? (cacheStats.hits / (cacheStats.hits + cacheStats.misses) * 100).toFixed(2)\r\n    : 0;\r\n    \r\n  return {\r\n    ...cacheStats,\r\n    hitRate: `${hitRate}%`,\r\n    cacheSize: globalCache.size,\r\n    maxSize: DEFAULT_CONFIG.maxSize\r\n  };\r\n};\r\n\r\n/**\r\n * Limpia todo el cach√©\r\n */\r\nexport const clearCache = () => {\r\n  const size = globalCache.size;\r\n  globalCache.clear();\r\n  cacheStats.evictions += size;\r\n  console.log(`[ComponentCache] Limpiado cach√© completo (${size} entradas)`);\r\n};\r\n\r\n/**\r\n * Hook para monitorear rendimiento del cach√©\r\n */\r\nexport const useCacheMonitor = () => {\r\n  const [stats, setStats] = useState(getCacheStats());\r\n  \r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      setStats(getCacheStats());\r\n    }, 1000);\r\n    \r\n    return () => clearInterval(interval);\r\n  }, []);\r\n  \r\n  return stats;\r\n};\r\n\r\n// Limpiar cach√© expirado cada 5 minutos\r\nsetInterval(cleanExpiredEntries, 5 * 60 * 1000);\r\n\r\nexport default {\r\n  useCachedComputation,\r\n  useCachedComponent,\r\n  useCacheInvalidation,\r\n  withCache,\r\n  getCacheStats,\r\n  clearCache,\r\n  useCacheMonitor\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\diagnosticService.js","messages":[{"ruleId":"no-unreachable","severity":2,"message":"Unreachable code.","line":346,"column":21,"nodeType":"BlockStatement","messageId":"unreachableCode","endLine":352,"endColumn":6},{"ruleId":"no-unused-vars","severity":1,"message":"'testRef' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":419,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":419,"endColumn":20}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n\r\n\r\n/**\r\n * Servicio de Diagn√≥stico Avanzado para Backend y Servicios Externos\r\n * Proporciona funciones espec√≠ficas para diagnosticar problemas comunes\r\n */\r\n\r\nimport { getBackendBase } from '../utils/backendBase';\r\n\r\nclass DiagnosticService {\r\n  constructor() {\r\n    // URL base del backend centralizada para coherencia con la app\r\n    this.backendUrl = getBackendBase();\r\n    this.testResults = new Map();\r\n  }\r\n\r\n  /**\r\n   * Diagn√≥stico completo del sistema de emails\r\n   */\r\n  async diagnoseEmailSystem() {\r\n    console.group('üìß Diagnosticando Sistema de Emails');\r\n    \r\n    const results = {\r\n      mailgunConfig: await this.testMailgunConfig(),\r\n      backendMailRoutes: await this.testBackendMailRoutes(),\r\n      emailDatabase: await this.testEmailDatabase(),\r\n      webhooks: await this.testWebhooks()\r\n    };\r\n\r\n    console.log('Resultados del diagn√≥stico de emails:', results);\r\n    console.groupEnd();\r\n    \r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Diagn√≥stico del chat IA\r\n   */\r\n  async diagnoseAIChat() {\r\n    console.group('ü§ñ Diagnosticando Chat IA');\r\n    \r\n    const results = {\r\n      openaiConfig: await this.testOpenAIConfig(),\r\n      backendAIRoutes: await this.testBackendAIRoutes(),\r\n      apiQuota: await this.checkAPIQuota()\r\n    };\r\n\r\n    console.log('Resultados del diagn√≥stico de IA:', results);\r\n    console.groupEnd();\r\n    \r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Diagn√≥stico completo de Firebase\r\n   */\r\n  async diagnoseFirebase() {\r\n    console.group('üî• Diagnosticando Firebase');\r\n    \r\n    const results = {\r\n      authentication: await this.testFirebaseAuth(),\r\n      firestore: await this.testFirestoreConnection(),\r\n      storage: await this.testFirebaseStorage(),\r\n      rules: await this.testFirestoreRules()\r\n    };\r\n\r\n    console.log('Resultados del diagn√≥stico de Firebase:', results);\r\n    console.groupEnd();\r\n    \r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Test de configuraci√≥n de Mailgun\r\n   */\r\n  async testMailgunConfig() {\r\n    try {\r\n      const apiKey = import.meta.env.VITE_MAILGUN_API_KEY;\r\n      const domain = import.meta.env.VITE_MAILGUN_DOMAIN;\r\n      const sendingDomain = import.meta.env.VITE_MAILGUN_SENDING_DOMAIN;\r\n      \r\n      if (!apiKey || !domain) {\r\n        return {\r\n          status: 'error',\r\n          message: 'Variables de Mailgun no configuradas',\r\n          details: { hasApiKey: !!apiKey, hasDomain: !!domain }\r\n        };\r\n      }\r\n\r\n      // Test a trav√©s del backend - intentar m√∫ltiples rutas\r\n      if (this.backendUrl) {\r\n        // Intentar primero la ruta principal\r\n        let response = await fetch(`${this.backendUrl}/api/mailgun/test`, {\r\n          method: 'GET'\r\n        });\r\n\r\n        // Si falla, intentar ruta de test simple\r\n        if (!response.ok) {\r\n          response = await fetch(`${this.backendUrl}/api/test/mailgun`, {\r\n            method: 'GET'\r\n          });\r\n        }\r\n\r\n        if (response.ok) {\r\n          const data = await response.json();\r\n          return {\r\n            status: 'success',\r\n            message: 'Mailgun configurado correctamente',\r\n            details: { domain, sendingDomain, response: data }\r\n          };\r\n        } else {\r\n          const error = await response.text();\r\n          return {\r\n            status: 'error',\r\n            message: `Mailgun test fall√≥ con status ${response.status}`,\r\n            details: { error, domain, hasApiKey: !!apiKey, hasDomain: !!domain }\r\n          };\r\n        }\r\n      }\r\n\r\n      return {\r\n        status: 'warning',\r\n        message: 'Variables configuradas pero backend no disponible',\r\n        details: { domain, sendingDomain }\r\n      };\r\n\r\n    } catch (error) {\r\n      return {\r\n        status: 'error',\r\n        message: 'Error al probar Mailgun',\r\n        details: { error: error.message }\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Test de rutas de email del backend\r\n   */\r\n  async testBackendMailRoutes() {\r\n    if (!this.backendUrl) {\r\n      return {\r\n        status: 'error',\r\n        message: 'URL del backend no configurada'\r\n      };\r\n    }\r\n\r\n    const routes = [\r\n      '/api/mail/send',\r\n      '/api/mail/inbox',\r\n      '/api/mailgun/webhook'\r\n    ];\r\n\r\n    const results = {};\r\n\r\n    for (const route of routes) {\r\n      try {\r\n        const response = await fetch(`${this.backendUrl}${route}`, {\r\n          method: 'OPTIONS' // Usar OPTIONS para verificar que la ruta existe\r\n        });\r\n        \r\n        results[route] = {\r\n          status: response.status < 500 ? 'success' : 'error',\r\n          statusCode: response.status,\r\n          headers: Object.fromEntries(response.headers.entries())\r\n        };\r\n      } catch (error) {\r\n        results[route] = {\r\n          status: 'error',\r\n          error: error.message\r\n        };\r\n      }\r\n    }\r\n\r\n    return {\r\n      status: Object.values(results).some(r => r.status === 'error') ? 'warning' : 'success',\r\n      message: 'Test de rutas de email completado',\r\n      details: results\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Test de base de datos de emails\r\n   */\r\n  async testEmailDatabase() {\r\n    try {\r\n      const { getFirestore, collection, query, limit, getDocs } = await import('firebase/firestore');\r\n      const db = getFirestore();\r\n\r\n      // Intentar leer algunos emails de prueba\r\n      const emailsRef = collection(db, 'emails');\r\n      const q = query(emailsRef, limit(1));\r\n      const snapshot = await getDocs(q);\r\n\r\n      return {\r\n        status: 'success',\r\n        message: 'Conexi√≥n con base de datos de emails OK',\r\n        details: {\r\n          documentsFound: snapshot.size,\r\n          collectionPath: 'emails'\r\n        }\r\n      };\r\n\r\n    } catch (error) {\r\n      return {\r\n        status: 'error',\r\n        message: 'Error al acceder a la base de datos de emails',\r\n        details: { error: error.message, code: error.code }\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Test de webhooks\r\n   */\r\n  async testWebhooks() {\r\n    if (!this.backendUrl) {\r\n      return {\r\n        status: 'error',\r\n        message: 'Backend no disponible para test de webhooks'\r\n      };\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`${this.backendUrl}/api/mailgun/webhook`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          'event-data': {\r\n            event: 'test',\r\n            message: { headers: { 'message-id': 'test-webhook' } }\r\n          }\r\n        })\r\n      });\r\n\r\n      return {\r\n        status: response.status === 200 ? 'success' : 'warning',\r\n        message: `Webhook test: ${response.status}`,\r\n        details: { statusCode: response.status }\r\n      };\r\n\r\n    } catch (error) {\r\n      return {\r\n        status: 'error',\r\n        message: 'Error al probar webhook',\r\n        details: { error: error.message }\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Test de configuraci√≥n de OpenAI\r\n   */\r\n  async testOpenAIConfig() {\r\n    try {\r\n      const apiKey = import.meta.env.VITE_OPENAI_API_KEY;\r\n      \r\n      if (!apiKey) {\r\n        return {\r\n          status: 'error',\r\n          message: 'API Key de OpenAI no configurada'\r\n        };\r\n      }\r\n\r\n      // Test b√°sico de la API\r\n      const response = await fetch('https://api.openai.com/v1/models', {\r\n        headers: {\r\n          'Authorization': `Bearer ${apiKey}`,\r\n          'Content-Type': 'application/json'\r\n        }\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        return {\r\n          status: 'success',\r\n          message: 'OpenAI API configurada correctamente',\r\n          details: {\r\n            modelsAvailable: data.data?.length || 0,\r\n            keyPrefix: apiKey.substring(0, 10) + '...'\r\n          }\r\n        };\r\n      } else {\r\n        const error = await response.text();\r\n        return {\r\n          status: 'error',\r\n          message: `Error en OpenAI API: ${response.status}`,\r\n          details: { error, status: response.status }\r\n        };\r\n      }\r\n\r\n    } catch (error) {\r\n      return {\r\n        status: 'error',\r\n        message: 'Error al probar OpenAI',\r\n        details: { error: error.message }\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Test de rutas de IA del backend\r\n   */\r\n  async testBackendAIRoutes() {\r\n    if (!this.backendUrl) {\r\n      return {\r\n        status: 'error',\r\n        message: 'Backend no disponible'\r\n      };\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`${this.backendUrl}/api/ai/test`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ message: 'test' })\r\n      });\r\n\r\n      return {\r\n        status: response.ok ? 'success' : 'error',\r\n        message: `Backend AI routes: ${response.status}`,\r\n        details: { statusCode: response.status }\r\n      };\r\n\r\n    } catch (error) {\r\n      return {\r\n        status: 'error',\r\n        message: 'Error al probar rutas de IA',\r\n        details: { error: error.message }\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Verificar cuota de API de OpenAI\r\n   */\r\n  async checkAPIQuota() {\r\n    try {\r\n      // Esta informaci√≥n normalmente requiere una llamada espec√≠fica a la API de billing\r\n      // Por ahora, haremos un test simple\r\n      return {\r\n        status: 'info',\r\n        message: 'Verificaci√≥n de cuota requiere implementaci√≥n espec√≠fica',\r\n        details: { note: 'Implementar verificaci√≥n de billing si es necesario' }\r\n      };\r\n    } catch (error) {\r\n      return {\r\n        status: 'error',\r\n        message: 'Error al verificar cuota',\r\n        details: { error: error.message }\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Test de autenticaci√≥n de Firebase\r\n   */\r\n  async testFirebaseAuth() {\r\n    try {\r\n      const { getAuth } = await import('firebase/auth');\r\n      const auth = getAuth();\r\n\r\n      return {\r\n        status: 'success',\r\n        message: 'Firebase Auth inicializado',\r\n        details: {\r\n          currentUser: auth.currentUser?.uid || 'No authenticated user',\r\n          authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN\r\n        }\r\n      };\r\n\r\n    } catch (error) {\r\n      return {\r\n        status: 'error',\r\n        message: 'Error en Firebase Auth',\r\n        details: { error: error.message, code: error.code }\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Test de conexi√≥n a Firestore\r\n   */\r\n  async testFirestoreConnection() {\r\n    try {\r\n      const { getFirestore, doc, getDoc } = await import('firebase/firestore');\r\n      const db = getFirestore();\r\n\r\n      // Intentar leer un documento de prueba\r\n      const testDoc = doc(db, '_conexion_prueba', 'connection');\r\n      await getDoc(testDoc);\r\n\r\n      return {\r\n        status: 'success',\r\n        message: 'Firestore conectado correctamente',\r\n        details: {\r\n          projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID\r\n        }\r\n      };\r\n\r\n    } catch (error) {\r\n      return {\r\n        status: 'error',\r\n        message: 'Error de conexi√≥n con Firestore',\r\n        details: { error: error.message, code: error.code }\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Test de Firebase Storage\r\n   */\r\n  async testFirebaseStorage() {\r\n    try {\r\n      const { getStorage, ref } = await import('firebase/storage');\r\n      const storage = getStorage();\r\n      \r\n      // Crear una referencia de prueba\r\n      const testRef = ref(storage, 'test/connection');\r\n\r\n      return {\r\n        status: 'success',\r\n        message: 'Firebase Storage disponible',\r\n        details: {\r\n          bucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET\r\n        }\r\n      };\r\n\r\n    } catch (error) {\r\n      return {\r\n        status: 'error',\r\n        message: 'Error en Firebase Storage',\r\n        details: { error: error.message, code: error.code }\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Test de reglas de Firestore\r\n   */\r\n  async testFirestoreRules() {\r\n    try {\r\n      const { getFirestore, doc, getDoc } = await import('firebase/firestore');\r\n      const db = getFirestore();\r\n\r\n      // Intentar acceder a diferentes colecciones para probar permisos\r\n      const collections = ['users', 'weddings', 'emails', 'guests'];\r\n      const results = {};\r\n\r\n      for (const collectionName of collections) {\r\n        try {\r\n          const testDoc = doc(db, collectionName, 'test');\r\n          await getDoc(testDoc);\r\n          results[collectionName] = 'accessible';\r\n        } catch (error) {\r\n          results[collectionName] = error.code || 'error';\r\n        }\r\n      }\r\n\r\n      return {\r\n        status: 'success',\r\n        message: 'Test de reglas completado',\r\n        details: { collections: results }\r\n      };\r\n\r\n    } catch (error) {\r\n      return {\r\n        status: 'error',\r\n        message: 'Error al probar reglas de Firestore',\r\n        details: { error: error.message }\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Ejecuta un diagn√≥stico completo del sistema\r\n   */\r\n  async runFullDiagnostic() {\r\n    console.log('üîç Iniciando diagn√≥stico completo del sistema...');\r\n    \r\n    const results = {\r\n      timestamp: new Date().toISOString(),\r\n      email: await this.diagnoseEmailSystem(),\r\n      ai: await this.diagnoseAIChat(),\r\n      firebase: await this.diagnoseFirebase()\r\n    };\r\n\r\n    console.log('üìä Diagn√≥stico completo finalizado:', results);\r\n    \r\n    return results;\r\n  }\r\n}\r\n\r\nexport default new DiagnosticService();\r\n\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\emailMetricsService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\emailService.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'now' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":38,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":38,"endColumn":12},{"ruleId":"no-unused-vars","severity":1,"message":"'CURRENT_USER' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":213,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":213,"endColumn":17},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":322,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":322,"endColumn":17,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[11732,11732],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-useless-catch","severity":2,"message":"Unnecessary try/catch wrapper.","line":841,"column":5,"nodeType":"TryStatement","messageId":"unnecessaryCatch","endLine":859,"endColumn":6},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":845,"column":52,"nodeType":"BlockStatement","messageId":"unexpected","endLine":845,"endColumn":54,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[31023,31023],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Email service ‚Äì interacts with backend API (Express + Firestore) or Mailgun API\r\n// Email: { id, from, to, subject, body, date, folder, read, attachments }\r\n\r\n// Servicio de correo con soporte para Mailgun, backend y fallback a localStorage\r\n// Estructura Mail: { id, from, to, subject, body, date, folder, read, attachments }\r\n\r\nimport { auth } from '../firebaseConfig';\r\n// Sistema de autenticaci√≥n unificado\r\nlet authContext = null;\r\n\r\n// Funci√≥n para establecer el contexto de autenticaci√≥n desde el componente\r\nexport const setAuthContext = (context) => {\r\n  authContext = context;\r\n};\r\n// Mantener actualizada la cach√© de emails en memoria\r\nimport { emailCache } from '../utils/EmailCache';\r\n\r\nconst BASE = import.meta.env.VITE_BACKEND_BASE_URL || import.meta.env.VITE_BACKEND_URL;\r\nconst MAILGUN_API_KEY = import.meta.env.VITE_MAILGUN_API_KEY;\r\nconst MAILGUN_DOMAIN = import.meta.env.VITE_MAILGUN_DOMAIN || 'mywed360.com';\r\n\r\n// Define si usamos Mailgun, backend o localStorage como fallback\r\nexport const USE_MAILGUN = !!MAILGUN_API_KEY;\r\n// Permitimos usar backend aunque Mailgun est√© configurado\r\nexport const USE_BACKEND = !!BASE;\r\nconst STORAGE_KEY = 'mywed360_mails';\r\n\r\n/**\r\n * Rellena la bandeja con correos mock cuando a√∫n no existen datos locales.\r\n * Esto permite mostrar contenido incluso sin backend ni Mailgun.\r\n * @param {string} userEmail Email del usuario actual\r\n */\r\nfunction ensureMockEmails(userEmail) {\r\n  if (!userEmail) return;\r\n  const existing = loadLocal();\r\n  if (existing && existing.length) return; // Ya hay datos\r\n\r\n  const now = new Date().toISOString();\r\n  const mockEmails = [\r\n    // Emails esperados por la suite de tests (mismos IDs y subjects)\r\n    {\r\n      id: 'email-1',\r\n      from: 'remitente@ejemplo.com',\r\n      to: userEmail,\r\n      subject: 'Asunto importante',\r\n      body: 'Cuerpo importante',\r\n      date: '2025-07-10T10:30:00Z',\r\n      folder: 'inbox',\r\n      read: false,\r\n      attachments: []\r\n    },\r\n    {\r\n      id: 'email-2',\r\n      from: 'team@empresa.com',\r\n      to: userEmail,\r\n      subject: 'Recordatorio reuni√≥n',\r\n      body: 'No olvides la reuni√≥n',\r\n      date: '2025-07-09T08:15:00Z',\r\n      folder: 'inbox',\r\n      read: true,\r\n      attachments: [{ filename: 'acta.pdf' }]\r\n    },\r\n    {\r\n      id: 'email-3',\r\n      from: userEmail,\r\n      to: 'destinatario@empresa.com',\r\n      subject: 'Borrador enviado',\r\n      body: 'Borrador enviado al cliente',\r\n      date: '2025-07-08T14:45:00Z',\r\n      folder: 'sent',\r\n      read: true,\r\n      attachments: []\r\n    }\r\n  ];\r\n  saveLocal(mockEmails);\r\n}\r\n\r\n/**\r\n * Obtiene el token de autenticaci√≥n del usuario actual\r\n * @returns {Promise<string|null>} Token de autenticaci√≥n o null\r\n */\r\nconst getAuthToken = async () => {\r\n  try {\r\n    // Priorizar el sistema de autenticaci√≥n unificado\r\n    if (authContext && authContext.getIdToken) {\r\n      const token = await authContext.getIdToken();\r\n      if (token) {\r\n        console.log('üîë Token obtenido del sistema unificado');\r\n        return token;\r\n      }\r\n    }\r\n    \r\n    // Fallback a Firebase si est√° disponible\r\n    const user = auth.currentUser;\r\n    if (user && user.getIdToken) {\r\n      const token = await user.getIdToken();\r\n      console.log('üîë Token obtenido de Firebase');\r\n      return token;\r\n    }\r\n    \r\n    // Fallback a usuario mock si existe en authContext\r\n    if (authContext && authContext.currentUser) {\r\n      const mockToken = `mock-${authContext.currentUser.uid}-${authContext.currentUser.email}`;\r\n      console.log('üîë Token mock generado para emailService:', authContext.currentUser.email);\r\n      return mockToken;\r\n    }\r\n    \r\n    console.log('‚ö†Ô∏è No se pudo obtener token de autenticaci√≥n');\r\n    return null;\r\n  } catch (error) {\r\n    console.warn('Error obteniendo token de autenticaci√≥n:', error);\r\n    return null;\r\n  }\r\n};\r\n\r\n/**\r\n * Devuelve cabeceras con Authorization si existe un token de Firebase.\r\n * @param {Object} base Cabeceras base opcionales\r\n * @returns {Promise<Object>} Cabeceras combinadas\r\n */\r\nconst authHeader = async (base = {}) => {\r\n  const token = await getAuthToken();\r\n  return token ? { ...base, 'Authorization': `Bearer ${token}` } : base;\r\n};\r\n\r\n// Obtener direcci√≥n de correo personalizada del usuario seg√∫n su perfil\r\nconst getUserEmailAddress = (profile) => {\r\n  if (!profile) return null;\r\n  \r\n  // Prioridad: myWed360Email configurado > emailUsername > emailAlias > generaci√≥n fallback\r\n  if (profile.myWed360Email && !profile.myWed360Email.startsWith('usuario@')) {\r\n    return profile.myWed360Email;\r\n  }\r\n\r\n  // Prioridad de cuentas generadas dentro del dominio\r\n  if (profile.emailUsername) {\r\n    return `${profile.emailUsername}@${MAILGUN_DOMAIN}`;\r\n  }\r\n  \r\n  if (profile.emailAlias) {\r\n    return `${profile.emailAlias}@${MAILGUN_DOMAIN}`;\r\n  }\r\n  \r\n  const loginEmail = profile.email || (profile.account && profile.account.email);\r\n  // Usar email del perfil solo si pertenece al dominio configurado\r\n  if (loginEmail && loginEmail.endsWith(`@${MAILGUN_DOMAIN}`)) {\r\n    return loginEmail;\r\n  }\r\n  \r\n  // Fallback a m√©todo anterior\r\n  if (profile.emailAlias) {\r\n    return `${profile.emailAlias}@${MAILGUN_DOMAIN}`;\r\n  }\r\n  \r\n  if (profile.brideFirstName && profile.brideLastName) {\r\n    const normalizedName = `${profile.brideFirstName.toLowerCase()}.${profile.brideLastName.toLowerCase()}`\r\n      .normalize('NFD').replace(/[\\u0300-\\u036f]/g, '') // Eliminar acentos\r\n      .replace(/[^a-z0-9.]/g, '.'); // Reemplazar caracteres no permitidos\r\n    return `${normalizedName}@${MAILGUN_DOMAIN}`;\r\n  }\r\n  \r\n  if (profile.brideFirstName) {\r\n    const normalizedName = profile.brideFirstName.toLowerCase()\r\n      .normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\r\n      .replace(/[^a-z0-9.]/g, '.');\r\n    return `${normalizedName}@${MAILGUN_DOMAIN}`;\r\n  }\r\n  \r\n  if (profile.userId) {\r\n    return `user${profile.userId}@${MAILGUN_DOMAIN}`;\r\n  }\r\n\r\n  // Intentar generar alias a partir del email de inicio de sesi√≥n primero\r\n  if (loginEmail) {\r\n    let prefix = loginEmail.split('@')[0].toLowerCase()\r\n      .normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\r\n      .replace(/[^a-z0-9]/g, '');\r\n    if (prefix.length > 8) {\r\n      prefix = prefix.slice(0,4);\r\n    }\r\n    if (prefix.length >=3 && prefix !== 'usuario') {\r\n      return `${prefix}@${MAILGUN_DOMAIN}`;\r\n    }\r\n  }\r\n\r\n  // Si no, generar a partir del nombre\r\n  if (profile.name) {\r\n    const first = profile.name.split(' ')[0].toLowerCase()\r\n      .normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\r\n      .replace(/[^a-z0-9]/g, '');\r\n    if (first.length >= 3 && first !== 'usuario') {\r\n      return `${first}@${MAILGUN_DOMAIN}`;\r\n    }\r\n  }\r\n\r\n  if (profile.email) {\r\n    let prefix = profile.email.split('@')[0].toLowerCase()\r\n      .normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\r\n      .replace(/[^a-z0-9]/g, '');\r\n    if (prefix.length > 8) {\r\n      // Usar los primeros 4 caracteres para un alias m√°s corto (ej: dani)\r\n      prefix = prefix.slice(0, 4);\r\n    }\r\n    if (prefix.length >= 3) {\r\n      return `${prefix}@${MAILGUN_DOMAIN}`;\r\n    }\r\n  }\r\n  \r\n  return `usuario@${MAILGUN_DOMAIN}`;\r\n};\r\n\r\n// Almacena el usuario actual y su direcci√≥n de correo\r\nlet CURRENT_USER = null;\r\nlet CURRENT_USER_EMAIL = null;\r\n\r\n// Inicializar el servicio con el perfil del usuario\r\nexport async function initEmailService(userProfile) {\r\n  CURRENT_USER = userProfile;\r\n  CURRENT_USER_EMAIL = getUserEmailAddress(userProfile);\r\n  \r\n  // Verificar si el usuario ya tiene configurado un nombre de usuario para correo\r\n  if (!userProfile.emailUsername && !userProfile.myWed360Email) {\r\n    console.log('Usuario sin nombre de correo configurado. Recomendado configurar en /email/setup');\r\n  }\r\n  \r\n  // Persistir en el perfil si a√∫n no existe o cambi√≥\r\n  try {\r\n    if (!userProfile.myWed360Email || userProfile.myWed360Email !== CURRENT_USER_EMAIL) {\r\n      userProfile.myWed360Email = CURRENT_USER_EMAIL;\r\n      // Guardar de nuevo en localStorage para futuras sesiones\r\n      const storedProfile = localStorage.getItem('lovenda_user_profile');\r\n      if (storedProfile) {\r\n        const parsed = JSON.parse(storedProfile);\r\n        parsed.myWed360Email = CURRENT_USER_EMAIL;\r\n        localStorage.setItem('lovenda_user_profile', JSON.stringify(parsed));\r\n      } else {\r\n        localStorage.setItem('lovenda_user_profile', JSON.stringify(userProfile));\r\n      }\r\n    }\r\n  } catch (e) {\r\n    console.warn('No se pudo persistir myWed360Email:', e);\r\n  }\r\n\r\n  console.log(`Servicio de email inicializado para: ${CURRENT_USER_EMAIL}`);\r\n  // Asegurar correos mock para desarrollo/offline\r\n  ensureMockEmails(CURRENT_USER_EMAIL);\r\n  return CURRENT_USER_EMAIL;\r\n}\r\n\r\nfunction uuid() {\r\n  return (crypto && crypto.randomUUID) ? crypto.randomUUID() : Math.random().toString(36).substring(2, 10);\r\n}\r\n\r\nfunction loadLocal() {\r\n  return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');\r\n}\r\nfunction saveLocal(arr) {\r\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));\r\n}\r\n\r\n// Funciones de integraci√≥n con Mailgun - Ahora usando Firebase Cloud Functions como proxy seguro\r\n// Flag para no seguir intentando si Mailgun/Firebase devuelve error permanente (CORS/404)\r\nlet mailgunDisabled = false;\r\n// Control de errores backend para evitar spam de 500 y reintentos inmediatos\r\nlet backendDisabledUntil = 0; // epoch ms hasta cu√°ndo no intentamos backend\r\nconst BACKEND_BACKOFF_MS = 30000; // 30s de backoff\r\n// Timeout por defecto para obtener eventos de Mailgun (ms). Puede sobreescribirse con VITE_EVENTS_TIMEOUT_MS.\r\nconst EVENTS_TIMEOUT_MS = Number(import.meta.env.VITE_EVENTS_TIMEOUT_MS || 15000);\r\n\r\nasync function fetchMailgunEvents(userEmail, eventType = 'delivered') {\r\n  if (mailgunDisabled) {\r\n    return []; // Salir temprano si se ha deshabilitado\r\n  }\r\n  if (!USE_MAILGUN) {\r\n    console.warn('Configuraci√≥n de Mailgun no disponible, usando datos locales');\r\n    return []; // Devolver un array vac√≠o en lugar de lanzar una excepci√≥n\r\n  }\r\n  \r\n  const params = new URLSearchParams({\r\n    recipient: userEmail,\r\n    event: eventType,\r\n    limit: 50\r\n  });\r\n  \r\n  try {\r\n    // Establecer un timeout para la petici√≥n\r\n    const controller = new AbortController();\r\n    const timeoutId = setTimeout(() => controller.abort(), EVENTS_TIMEOUT_MS); // Timeout configurable\r\n\r\n    // Obtener token de autenticaci√≥n para acceder a endpoints protegidos\r\n    const token = await getAuthToken();\r\n\r\n    // Construir endpoint: usa backend solamente si existe token, sino Cloud Function p√∫blica\r\n    const backendBase = import.meta.env.VITE_BACKEND_BASE_URL;\r\n    const functionsBase = import.meta.env.VITE_FIREBASE_FUNCTIONS_URL || 'https://us-central1-lovenda-98c77.cloudfunctions.net';\r\n\r\n    const endpointUrl = backendBase && token\r\n      ? `${backendBase}/api/mailgun/events?${params.toString()}`\r\n      : `${functionsBase}/getMailgunEvents?${params.toString()}`;\r\n\r\n    const response = await fetch(endpointUrl, {\r\n      method: 'GET',\r\n      signal: controller.signal,\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        ...(token ? { 'Authorization': `Bearer ${token}` } : {})\r\n      }\r\n    });\r\n    \r\n    clearTimeout(timeoutId);\r\n    \r\n    if (response.status === 401 && endpointUrl.includes('/api/mailgun/events')) {\r\n      // Backend no autorizado: intentar Cloud Function como fallback inmediato\r\n      try {\r\n        const cfUrl = `${functionsBase}/getMailgunEvents?${params.toString()}`;\r\n        const cfRes = await fetch(cfUrl, { method: 'GET', signal: controller.signal, headers: { 'Accept': 'application/json' } });\r\n        if (cfRes.ok) {\r\n          const cfData = await cfRes.json();\r\n          clearTimeout(timeoutId);\r\n          return cfData.items || [];\r\n        }\r\n      } catch {}\r\n    }\r\n    if (!response.ok) {\r\n      console.warn(`Error al obtener eventos de correo: ${response.status}`);\r\n      // Deshabilitar futuros intentos para evitar spam de errores\r\n      mailgunDisabled = true;\r\n      return [];\r\n    }\r\n    \r\n    const data = await response.json();\r\n    return data.items || [];\r\n  } catch (error) {\r\n    if (error.name === 'AbortError') {\r\n      console.warn('Timeout al obtener eventos de Mailgun / backend');\r\n      // No deshabilitamos permanentemente el servicio; puede deberse a cold start o latencia alta.\r\n      return [];\r\n    }\r\n    // Manejar errores sin romper la aplicaci√≥n\r\n    console.error('Error con Mailgun, usando fallback:', error);\r\n    // Deshabilitar futuros intentos para evitar spam constante (excepto timeouts)\r\n    mailgunDisabled = true;\r\n    return []; // Devolver array vac√≠o para continuar con la app\r\n  }\r\n}\r\n\r\n// Convertir eventos de Mailgun a formato interno de emails\r\nfunction mapMailgunEventsToMails(events, folder) {\r\n  return events.map(event => {\r\n    const message = event.message || {};\r\n    const storage = event.storage || {};\r\n    \r\n    return {\r\n      id: event.id || uuid(),\r\n      from: message.headers?.from || event.message?.from || 'desconocido@ejemplo.com',\r\n      to: message.headers?.to || event.recipient || CURRENT_USER_EMAIL,\r\n      subject: message.headers?.subject || storage.subject || '(Sin asunto)',\r\n      body: storage.bodyHtml || storage.bodyPlain || message.headers?.['message-id'] || '',\r\n      date: new Date(event.timestamp * 1000).toISOString(),\r\n      folder: folder,\r\n      read: false,\r\n      attachments: []\r\n    };\r\n  });\r\n}\r\n\r\nexport async function getMails(folder = 'inbox') {\r\n  if (!CURRENT_USER_EMAIL) {\r\n    return { success: false, error: 'Servicio de email no inicializado' };\r\n  }\r\n\r\n  // ‚ö°Ô∏è Si existen correos locales, devolverlos directamente para una respuesta instant√°nea\r\n  const localMails = loadLocal();\r\n  if (localMails && localMails.length) {\r\n    if (folder === 'all') {\r\n      return [...localMails].sort((a, b) => new Date(b.date || 0) - new Date(a.date || 0));\r\n    }\r\n    return localMails.filter(m => m.folder === folder);\r\n  }\r\n\r\n  // Soporte para carpeta \"all\": combinar bandeja de entrada y enviados\r\n  if (folder === 'all') {\r\n    try {\r\n      const inboxMails = await getMails('inbox');\r\n      const sentMails  = await getMails('sent');\r\n      // Unir y ordenar por fecha descendente\r\n      const merged = [...inboxMails, ...sentMails].sort((a, b) => {\r\n        const da = new Date(a.date || 0);\r\n        const db = new Date(b.date || 0);\r\n        return db - da;\r\n      });\r\n      return merged;\r\n    } catch (err) {\r\n      console.warn('Error obteniendo correos \"all\":', err);\r\n      // Continuar con flujo normal si algo falla\r\n    }\r\n  }\r\n  \r\n  // Carpeta \"sent\": combinar localStorage + Mailgun + Backend\r\n  let collectedSent = [];\r\n  if (folder === 'sent') {\r\n    const localMails = loadLocal().filter(mail => mail.folder === 'sent');\r\n    collectedSent.push(...localMails);\r\n  }\r\n  \r\n  if (USE_MAILGUN) {\r\n    try {\r\n      if (folder === 'sent') {\r\n        // Eventos \"accepted\" representan mensajes enviados correctamente\r\n        const events = await fetchMailgunEvents(CURRENT_USER_EMAIL, 'accepted');\r\n        collectedSent.push(...mapMailgunEventsToMails(events, 'sent'));\r\n      }\r\n      // Para bandeja de entrada, obtenemos los correos recibidos\r\n      if (folder === 'inbox') {\r\n        const events = await fetchMailgunEvents(CURRENT_USER_EMAIL, 'delivered');\r\n        const inboxMails = mapMailgunEventsToMails(events, folder);\r\n        if (inboxMails.length > 0) {\r\n          return inboxMails; // Mailgun devolvi√≥ datos\r\n        }\r\n        // Si Mailgun no devuelve nada, intentamos backend/Firestore como fallback\r\n        console.info('Mailgun no devolvi√≥ eventos, usando backend como fallback');\r\n        \r\n        // Circuit breaker: evitar spam de requests 401\r\n        const backendFailureKey = 'emailService_backendFailure';\r\n        const lastBackendFailure = localStorage.getItem(backendFailureKey);\r\n        const now = Date.now();\r\n        \r\n        // Si fall√≥ hace menos de 2 minutos, retornar array vac√≠o\r\n        if (lastBackendFailure && (now - parseInt(lastBackendFailure)) < 2 * 60 * 1000) {\r\n          console.log('üîÑ emailService: backend no disponible (circuit breaker activo)');\r\n          return [];\r\n        }\r\n        \r\n        try {\r\n          const backendUrl = BASE || 'http://localhost:4004';\r\n          const token = await getAuthToken();\r\n          \r\n          // Si a√∫n no tenemos token, esperamos a la autenticaci√≥n sin activar circuit breaker\r\n          if (!token) {\r\n            console.log('‚è≥ emailService: token no disponible todav√≠a, se omitir√° llamada al backend');\r\n          } else {\r\n            const headers = {\r\n              'Content-Type': 'application/json',\r\n              'Authorization': `Bearer ${token}`\r\n            };\r\n            \r\n            const res = await fetch(`${backendUrl}/api/mail?folder=${encodeURIComponent(folder)}&user=${encodeURIComponent(CURRENT_USER_EMAIL)}`, {\r\n              headers\r\n            });\r\n            \r\n            if (res.ok) {\r\n              const json = await res.json();\r\n              if (Array.isArray(json)) {\r\n                return json;\r\n              }\r\n            } else {\r\n              // Solo activar circuit breaker para errores de servidor 5xx\r\n              if (res.status >= 500) {\r\n                localStorage.setItem(backendFailureKey, now.toString());\r\n              }\r\n              console.warn(`‚ö†Ô∏è emailService: backend devolvi√≥ ${res.status}`);\r\n            }\r\n          }\r\n        } catch (err) {\r\n          // Marcar fallo del backend para activar circuit breaker\r\n          localStorage.setItem(backendFailureKey, now.toString());\r\n          console.warn('üö´ emailService: backend no disponible:', err.message || err);\r\n        }\r\n        return inboxMails;\r\n      }\r\n      // Para otras carpetas dentro del dominio Mailgun no se realiza un retorno temprano.\r\n      // Cualquier dato adicional ser√° procesado en los bloques posteriores (backend o localStorage)\r\n      // para permitir la combinaci√≥n con correos locales y evitar p√©rdida de mensajes reci√©n enviados.\r\n    } catch (error) {\r\n      console.error('Error con Mailgun, usando fallback:', error);\r\n      // Fallback al m√©todo normal si falla Mailgun\r\n    }\r\n  }\r\n  \r\n  if (USE_BACKEND) {\r\n    try {\r\n      const now = Date.now();\r\n      if (now < backendDisabledUntil) {\r\n        // Saltar intento durante backoff\r\n        return [];\r\n      }\r\n      // A√±adir timeout para evitar cuelgues\r\n      const controller = new AbortController();\r\n      const timeoutId = setTimeout(() => controller.abort(), 5000);\r\n\r\n      // Incluir token de Firebase para pasar middleware requireMailAccess\r\n      const token = await getAuthToken();\r\n      const headers = token ? { 'Authorization': `Bearer ${token}` } : {};\r\n\r\n      const res = await fetch(\r\n        `${BASE}/api/mail?folder=${encodeURIComponent(folder)}&user=${encodeURIComponent(CURRENT_USER_EMAIL)}`,\r\n        { signal: controller.signal, headers }\r\n      );\r\n      clearTimeout(timeoutId);\r\n      if (!res.ok) {\r\n        console.warn(`Backend /api/mail devolvi√≥ ${res.status}. Activando backoff ${BACKEND_BACKOFF_MS}ms`);\r\n        backendDisabledUntil = Date.now() + BACKEND_BACKOFF_MS;\r\n        return [];\r\n      }\r\n      const json = await res.json();\r\n      // Si backend devuelve array directamente\r\n      if (Array.isArray(json)) {\r\n        // Si estamos en inbox y no lleg√≥ ning√∫n mail y ya busc√°bamos por usuario,\r\n        // intentar descubrir direcci√≥n correcta a partir de cualquier correo existente.\r\n        if (folder === 'inbox' && json.length === 0 && CURRENT_USER_EMAIL && CURRENT_USER_EMAIL.startsWith('usuario')) {\r\n          try {\r\n            const altRes = await fetch(`${BASE}/api/mail?folder=inbox`, { headers: await authHeader() }); // sin filtro user\r\n            if (altRes.ok) {\r\n              const allMails = await altRes.json();\r\n              const myMail = allMails.find(m => m.to && m.to.endsWith(`@${MAILGUN_DOMAIN}`));\r\n              if (myMail) {\r\n                const newAddr = myMail.to;\r\n                console.log('Descubierta direcci√≥n real de correo:', newAddr);\r\n                // Persistir y actualizar\r\n                if (typeof window !== 'undefined') {\r\n                  const stored = localStorage.getItem('lovenda_user_profile');\r\n                  if (stored) {\r\n                    const parsed = JSON.parse(stored);\r\n                    parsed.myWed360Email = newAddr;\r\n                    localStorage.setItem('lovenda_user_profile', JSON.stringify(parsed));\r\n                  }\r\n                }\r\n                CURRENT_USER_EMAIL = newAddr;\r\n                // Reintentar obtener mails con la direcci√≥n correcta\r\n                const retry = await fetch(`${BASE}/api/mail?folder=${encodeURIComponent(folder)}&user=${encodeURIComponent(CURRENT_USER_EMAIL)}`, { headers: await authHeader() });\r\n                if (retry.ok) {\r\n                  return await retry.json();\r\n                }\r\n              }\r\n            }\r\n          } catch (e) {\r\n            console.warn('No se pudo descubrir direcci√≥n alternativa:', e);\r\n          }\r\n        }\r\n        return json;\r\n      }\r\n      // Si el backend responde pero success es false, lanzamos para caer al fallback\r\n      console.warn('Respuesta backend inesperada en /api/mail (no es array). Activando backoff.');\r\n      backendDisabledUntil = Date.now() + BACKEND_BACKOFF_MS;\r\n      return [];\r\n    } catch (error) {\r\n      console.error('Error con backend, usando localStorage:', error);\r\n      backendDisabledUntil = Date.now() + BACKEND_BACKOFF_MS;\r\n      // Fallback a localStorage si falla el backend\r\n    }\r\n  }\r\n  \r\n    // Si estamos en \"sent\" y hemos acumulado datos de varias fuentes, devolverlos\r\n  if (folder === 'sent') {\r\n    // El backend podr√≠a haber a√±adido elementos en la secci√≥n anterior; si no, intentar ahora\r\n    if (USE_BACKEND && collectedSent.length === 0) {\r\n      try {\r\n        const backendMails = await (async () => {\r\n          const res = await fetch(`${BASE}/api/mail?folder=sent&user=${encodeURIComponent(CURRENT_USER_EMAIL)}`, { headers: await authHeader() });\r\n          if (res.ok) {\r\n            return await res.json();\r\n          }\r\n          return [];\r\n        })();\r\n        collectedSent.push(...backendMails);\r\n      } catch (e) {\r\n        console.warn('Backend sent fall√≥ como fallback:', e);\r\n      }\r\n    }\r\n    // Deduplicar por id\r\n    const unique = new Map();\r\n    collectedSent.forEach(m => {\r\n      if (!unique.has(m.id)) unique.set(m.id, m);\r\n    });\r\n    const merged = Array.from(unique.values()).sort((a,b) => new Date(b.date) - new Date(a.date));\r\n    return merged;\r\n  }\r\n\r\n  // Fallback local gen√©rico\r\n  const mails = loadLocal();\r\n  return mails.filter(m => m.folder === folder && \r\n    (folder === 'sent' ? m.from === CURRENT_USER_EMAIL : m.to === CURRENT_USER_EMAIL));\r\n}\r\n\r\nimport validateAttachments from '../utils/validateAttachments';\r\nimport * as MailgunService from './mailgunService';\r\n\r\n// Enviar correo usando Mailgun API\r\nexport async function sendMailWithMailgun({ from, to, subject, body, attachments = [] }) {\r\n  if (!USE_MAILGUN || !MailgunService.isMailgunConfigured()) {\r\n    throw new Error('Configuraci√≥n de Mailgun no disponible');\r\n  }\r\n\r\n  // Si no se proporciona remitente, usamos el correo del usuario actual\r\n  if (!from && CURRENT_USER_EMAIL) {\r\n    from = CURRENT_USER_EMAIL;\r\n  }\r\n  \r\n  if (!from) {\r\n    throw new Error('Remitente no especificado');\r\n  }\r\n\r\n  try {\r\n    // Usar el nuevo servicio especializado de Mailgun\r\n    const result = await MailgunService.sendEmail({\r\n      from,\r\n      to,\r\n      subject,\r\n      html: body,\r\n      attachments: attachments.map((attachment, index) => ({\r\n        file: attachment.file,\r\n        name: attachment.filename || `adjunto-${index+1}`\r\n      }))\r\n    });\r\n    \r\n    return {\r\n      success: true,\r\n      messageId: result.messageId,\r\n      response: result.response\r\n    };\r\n  } catch (error) {\r\n    console.error('Error al enviar correo con Mailgun:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Crear un alias de correo para el usuario\r\nexport async function createEmailAlias(userProfile, aliasName) {\r\n  if (!USE_MAILGUN || !MAILGUN_API_KEY) {\r\n    throw new Error('Configuraci√≥n de Mailgun no disponible');\r\n  }\r\n  \r\n  // Validamos y normalizamos el alias\r\n  const normalizedAlias = aliasName.toLowerCase()\r\n    .normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\r\n    .replace(/[^a-z0-9.]/g, '.');\r\n  \r\n  // Verificar que el alias sea v√°lido\r\n  if (!normalizedAlias || normalizedAlias.length < 3) {\r\n    throw new Error('El alias debe tener al menos 3 caracteres v√°lidos');\r\n  }\r\n  \r\n  const newEmail = `${normalizedAlias}@${MAILGUN_DOMAIN}`;\r\n  \r\n  try {\r\n    // Aqu√≠ ir√≠a la l√≥gica para verificar disponibilidad del alias\r\n    // y registrarlo en Mailgun si fuera necesario\r\n    \r\n    // Por ahora, simplemente actualizamos el perfil con el nuevo alias\r\n    userProfile.emailAlias = normalizedAlias;\r\n    CURRENT_USER = userProfile;\r\n    CURRENT_USER_EMAIL = newEmail;\r\n    \r\n    return {\r\n      success: true,\r\n      email: newEmail,\r\n      alias: normalizedAlias\r\n    };\r\n  } catch (error) {\r\n    console.error('Error al crear alias de correo:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n// Sanitiza HTML muy b√°sico para eliminar scripts potencialmente peligrosos\r\nfunction sanitizeHtml(html = '') {\r\n  return html.replace(/<script[\\s\\S]*?>[\\s\\S]*?<\\/script>/gi, '');\r\n}\r\n\r\nexport async function sendMail({ to, subject = '', body = '', attachments = [] }) {\r\n  const sendId = Math.random().toString(36).substr(2, 9);\r\n  console.log(`üöÄ [${sendId}] Iniciando env√≠o de email a: ${to}`);\r\n  \r\n  // --- Validaciones previas ---\r\n  // Destinatario requerido\r\n  if (!to || to.trim() === '') {\r\n    console.log(`‚ùå [${sendId}] Error: Destinatario vac√≠o`);\r\n    return { success: false, error: 'Destinatario es obligatorio' };\r\n  }\r\n  // M√°ximo 50 destinatarios\r\n  const recipients = to.split(/[;,]+/).map(r => r.trim()).filter(Boolean);\r\n  if (recipients.length > 50) {\r\n    return { success: false, error: 'demasiados destinatarios' };\r\n  }\r\n  // Limitar asunto a 255 caracteres (truncar si es necesario)\r\n  if (subject.length > 255) {\r\n    subject = subject.slice(0, 255);\r\n  }\r\n  // Sanitizar body\r\n  body = sanitizeHtml(body);\r\n\r\n  // Validar adjuntos\r\n  try {\r\n    validateAttachments(attachments);\r\n  } catch (err) {\r\n    return { success: false, error: err.message };\r\n  }\r\n  if (!CURRENT_USER_EMAIL) {\r\n    throw new Error('Servicio de email no inicializado con perfil de usuario');\r\n  }\r\n\r\n  // Intentar enviar con Mailgun si est√° configurado\r\n  if (USE_MAILGUN) {\r\n    console.log(`üìß [${sendId}] Intentando env√≠o con Mailgun`);\r\n    try {\r\n      const mailgunResponse = await sendMailWithMailgun({\r\n        from: CURRENT_USER_EMAIL,\r\n        to,\r\n        subject,\r\n        body,\r\n        attachments\r\n      });\r\n      \r\n      console.log(`‚úÖ [${sendId}] Mailgun exitoso:`, mailgunResponse.messageId);\r\n      \r\n      // Crear objeto de correo enviado para compatibilidad\r\n      const mailSent = {\r\n        id: mailgunResponse.messageId || uuid(),\r\n        from: CURRENT_USER_EMAIL,\r\n        to,\r\n        subject,\r\n        body,\r\n        date: new Date().toISOString(),\r\n        folder: 'sent',\r\n        read: true,\r\n        attachments: attachments || []\r\n      };\r\n      \r\n      // Guardar en local tambi√©n para respaldo\r\n      const mails = loadLocal();\r\n      mails.push(mailSent);\r\n      saveLocal(mails);\r\n\r\n      // Actualizar cach√© en memoria para que la UI refleje inmediatamente el nuevo correo\r\n      const cachedSent = emailCache.getEmails('sent') || [];\r\n      emailCache.setEmails('sent', [mailSent, ...cachedSent]);\r\n       \r\n      console.log(`üíæ [${sendId}] Email guardado en localStorage y cach√© (folder: sent)`);\r\n      return { success: true, ...mailSent };\r\n    } catch (error) {\r\n      console.error('Error con Mailgun, usando fallback:', error);\r\n      // Fallback al m√©todo normal si falla Mailgun\r\n    }\r\n  }\r\n  \r\n  // Backend fallback\r\n  if (USE_BACKEND) {\r\n    try {\r\n      const res = await fetch(`${BASE}/api/emails`, {\r\n        method: 'POST',\r\n        headers: await authHeader({ 'Content-Type': 'application/json' }),\r\n        body: JSON.stringify({ \r\n          from: CURRENT_USER_EMAIL,\r\n          to, \r\n          subject, \r\n          body,\r\n          attachments\r\n        }),\r\n      });\r\n            if (!res.ok) {\r\n        const message = `Error HTTP ${res.status}`;\r\n        return { success: false, error: message };\r\n      }\r\n      const jsonBackend = await res.json();\r\n\r\n      // Si el backend respondi√≥ correctamente, creamos una entrada local para mostrarla al instante\r\n      if (jsonBackend && (jsonBackend.success || jsonBackend.id || jsonBackend.data)) {\r\n        const mailSent = {\r\n          // Intentar usar el id devuelto por el backend, si no existe generamos uno\r\n          id: jsonBackend.id || jsonBackend.data?.id || uuid(),\r\n          from: CURRENT_USER_EMAIL,\r\n          to,\r\n          subject,\r\n          body,\r\n          date: new Date().toISOString(),\r\n          folder: 'sent',\r\n          read: true,\r\n          attachments: attachments || []\r\n        };\r\n\r\n        // Guardar en localStorage para que la carpeta \"Enviados\" se actualice de inmediato\r\n        const mails = loadLocal();\r\n        mails.push(mailSent);\r\n        saveLocal(mails);\r\n\r\n        // Actualizar cach√© en memoria\r\n        const cachedSent = emailCache.getEmails('sent') || [];\r\n        emailCache.setEmails('sent', [mailSent, ...cachedSent]);\r\n \r\n        return { success: true, ...mailSent };\r\n      }\r\n\r\n      return jsonBackend;\r\n    } catch (error) {\r\n      console.error('Error con backend, usando localStorage:', error);\r\n    }\r\n  }\r\n  \r\n  // Fallback local\r\n  console.log(`üíæ [${sendId}] Usando fallback localStorage`);\r\n  const mails = loadLocal();\r\n  const mailSent = {\r\n    id: uuid(),\r\n    from: CURRENT_USER_EMAIL,\r\n    to,\r\n    subject,\r\n    body,\r\n    date: new Date().toISOString(),\r\n    folder: 'sent',\r\n    read: true,\r\n    attachments: attachments || []\r\n  };\r\n  mails.push(mailSent);\r\n  console.log(`üíæ [${sendId}] Email guardado en localStorage (fallback) con folder: sent`);\r\n  console.log(`üìä [${sendId}] Total emails en localStorage:`, mails.length);\r\n  \r\n  // Simulamos recepci√≥n para pruebas locales\r\n  // Solo si el destinatario es del mismo dominio\r\n  if (to.includes(`@${MAILGUN_DOMAIN}`)) {\r\n    const mailReceived = {\r\n      ...mailSent,\r\n      id: uuid(),\r\n      folder: 'inbox',\r\n      read: false,\r\n    };\r\n    mails.push(mailReceived);\r\n  }\r\n  \r\n  saveLocal(mails);\r\n  return { success: true, ...mailSent };\r\n}\r\n\r\n// Alias para compatibilidad con componentes y tests que usan sendEmail\r\nexport async function sendEmail(options) {\r\n  return sendMail(options);\r\n}\r\n\r\n// Obtener correo individual (con fallback a local)\r\nexport async function getMail(id) {\r\n  if (USE_BACKEND) {\r\n    try {\r\n      const res = await fetch(`${BASE}/api/mail/${id}`, { headers: await authHeader() });\r\n      if (!res.ok) {\r\n        let json;\r\n        try { json = await res.json(); } catch (_) {}\r\n        const err = new Error(json?.message || 'Email no encontrado');\r\n        err.status = res.status;\r\n        throw err;\r\n      }\r\n      const json = await res.json();\r\n      if (!json.success) {\r\n        const err = new Error(json.message || 'Error al obtener correo');\r\n        err.status = res.status;\r\n        throw err;\r\n      }\r\n      return { success: true, ...json.data };\r\n    } catch (error) {\r\n      throw error;\r\n    }\r\n  }\r\n  // Fallback local\r\n  const mails = loadLocal();\r\n  const mail = mails.find(m => m.id === id);\r\n  if (!mail) {\r\n    const err = new Error('Correo no encontrado');\r\n    err.status = 404;\r\n    throw err;\r\n  }\r\n  return mail;\r\n}\r\n\r\nexport async function markAsRead(id) {\r\n  console.log('[EmailService] markAsRead', { id, BASE });\r\n  // Si hay backend disponible, priorizarlo siempre\r\n  if (BASE) {\r\n    try {\r\n      const res = await fetch(`${BASE}/api/mail/${id}/read`, { method: 'POST', headers: await authHeader() });\r\n      if (!res.ok) throw new Error('Error marcar le√≠do');\r\n      const json = await res.json();\r\n      return json.success ? json : { success: true };\r\n    } catch (err) {\r\n      console.warn('Fallo backend markAsRead, usando fallback local:', err);\r\n    }\r\n  }\r\n  // Fallback a localStorage\r\n  const mails = loadLocal();\r\n  const updated = mails.map(m => m.id === id ? { ...m, read: true } : m);\r\n  saveLocal(updated);\r\n  return { success: true };\r\n}\r\n\r\nexport async function deleteMail(id) {\r\n  console.log('[EmailService] deleteMail', { id, BASE });\r\n  // Intentar siempre backend primero\r\n  if (BASE) {\r\n    try {\r\n      const res = await fetch(`${BASE}/api/mail/${id}`, { method: 'DELETE', headers: await authHeader() });\r\n      if (!res.ok) throw new Error('Error eliminando mail');\r\n      return { success: true };\r\n    } catch (err) {\r\n      console.warn('Fallo backend deleteMail, usando fallback local:', err);\r\n    }\r\n  }\r\n  // Fallback localStorage\r\n  const mails = loadLocal();\r\n  saveLocal(mails.filter(m => m.id !== id));\r\n  return { success: true };\r\n}\r\n\r\n// ========== Funciones para gesti√≥n de plantillas de email ==========\r\n\r\n// Clave para almacenamiento local de plantillas\r\nconst TEMPLATES_STORAGE_KEY = 'lovenda_email_templates';\r\n\r\n// Importar plantillas predefinidas\r\nimport { allTemplates } from '../data/templates';\r\n\r\n// Importar el servicio de cach√©\r\nimport templateCache from './TemplateCacheService';\r\n\r\n/**\r\n * Carga las plantillas de email almacenadas. Si no existen, inicializa con las plantillas predefinidas.\r\n * @param {boolean} bypassCache - Si es true, ignora la cach√© y fuerza una carga fresca\r\n * @returns {Array} Array con todas las plantillas disponibles\r\n */\r\nexport async function getEmailTemplates(bypassCache = false) {\r\n  // Verificar si hay datos en cach√© primero\r\n  const { templates: cachedTemplates, fromCache } = templateCache.getCachedTemplates(bypassCache);\r\n  \r\n  // Si tenemos datos en cach√©, los usamos\r\n  if (fromCache && cachedTemplates) {\r\n    console.log('Usando plantillas desde cach√©');\r\n    return cachedTemplates;\r\n  }\r\n  \r\n  console.log('Cargando plantillas frescas (no en cach√©)');\r\n  let templates = [];\r\n  \r\n  // Intentar cargar del backend si est√° disponible\r\n  if (USE_BACKEND) {\r\n    try {\r\n      const res = await fetch(`${BASE}/api/email-templates?user=${encodeURIComponent(CURRENT_USER_EMAIL)}`, { headers: await authHeader() });\r\n      if (res.ok) {\r\n        templates = await res.json();\r\n        // Guardar en cach√© para futuras solicitudes\r\n        templateCache.cacheAllTemplates(templates);\r\n        return templates;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al cargar plantillas del backend:', error);\r\n      // Fallback a localStorage\r\n    }\r\n  }\r\n  \r\n  // Cargar de localStorage o inicializar con plantillas predefinidas\r\n  try {\r\n    const storedTemplates = localStorage.getItem(TEMPLATES_STORAGE_KEY);\r\n    if (storedTemplates) {\r\n      templates = JSON.parse(storedTemplates);\r\n    } else {\r\n      // Si no hay plantillas guardadas, inicializar con las predefinidas\r\n      templates = allTemplates;\r\n      localStorage.setItem(TEMPLATES_STORAGE_KEY, JSON.stringify(allTemplates));\r\n    }\r\n    \r\n    // Guardar en cach√© para futuras solicitudes\r\n    templateCache.cacheAllTemplates(templates);\r\n    \r\n    return templates;\r\n  } catch (error) {\r\n    console.error('Error al cargar plantillas:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Obtiene una plantilla espec√≠fica por su ID\r\n * @param {string} templateId - ID de la plantilla a obtener\r\n * @param {boolean} bypassCache - Si es true, ignora la cach√© y fuerza una carga fresca\r\n * @returns {Object|null} La plantilla encontrada o null\r\n */\r\nexport async function getEmailTemplateById(templateId, bypassCache = false) {\r\n  // Verificar si est√° en cach√© primero\r\n  const { template: cachedTemplate, fromCache } = templateCache.getCachedTemplate(templateId, bypassCache);\r\n  \r\n  if (fromCache && cachedTemplate) {\r\n    return cachedTemplate;\r\n  }\r\n  \r\n  // Si no est√° en cach√©, cargar todas las plantillas y buscar\r\n  const templates = await getEmailTemplates(bypassCache);\r\n  const template = templates.find(t => t.id === templateId);\r\n  \r\n  // Guardar en cach√© para futuras solicitudes si existe\r\n  if (template) {\r\n    templateCache.cacheTemplate(template);\r\n  }\r\n  \r\n  return template || null;\r\n}\r\n\r\n/**\r\n * Guarda una plantilla de email nueva o actualiza una existente\r\n * @param {Object} template - Objeto con datos de la plantilla\r\n * @returns {Object} La plantilla guardada\r\n */\r\nexport async function saveEmailTemplate(template) {\r\n  let savedTemplate = null;\r\n  \r\n  // Intentar guardar en el backend si est√° disponible\r\n  if (USE_BACKEND) {\r\n    try {\r\n      const res = await fetch(`${BASE}/api/email-templates`, {\r\n        method: 'POST',\r\n        headers: await authHeader({ 'Content-Type': 'application/json' }),\r\n        body: JSON.stringify({\r\n          template,\r\n          user: CURRENT_USER_EMAIL\r\n        })\r\n      });\r\n      \r\n      if (res.ok) {\r\n        savedTemplate = await res.json();\r\n        // Actualizar cach√© con la plantilla guardada\r\n        templateCache.cacheTemplate(savedTemplate);\r\n        // Invalidar cach√© de todas las plantillas para forzar recarga en pr√≥xima solicitud\r\n        templateCache.invalidateAllTemplates();\r\n        return savedTemplate;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al guardar plantilla en backend:', error);\r\n      // Fallback a localStorage\r\n    }\r\n  }\r\n  \r\n  // Guardar en localStorage\r\n  try {\r\n    // Forzar carga fresca para asegurar datos actualizados\r\n    const templates = await getEmailTemplates(true);\r\n    const existingIndex = templates.findIndex(t => t.id === template.id);\r\n    \r\n    if (existingIndex >= 0) {\r\n      // Actualizar plantilla existente, preservando isSystem\r\n      const isSystem = templates[existingIndex].isSystem;\r\n      templates[existingIndex] = { ...template, isSystem };\r\n      savedTemplate = templates[existingIndex];\r\n    } else {\r\n      // A√±adir nueva plantilla\r\n      templates.push(template);\r\n      savedTemplate = template;\r\n    }\r\n    \r\n    localStorage.setItem(TEMPLATES_STORAGE_KEY, JSON.stringify(templates));\r\n    \r\n    // Actualizar cach√© con la plantilla guardada\r\n    templateCache.cacheTemplate(savedTemplate);\r\n    // Actualizar cach√© completa\r\n    templateCache.cacheAllTemplates(templates, false);\r\n    \r\n    // Registrar uso de la plantilla para m√©tricas\r\n    if (savedTemplate.category) {\r\n      templateCache.registerTemplateUsage(savedTemplate.id, savedTemplate.category);\r\n    }\r\n    \r\n    return savedTemplate;\r\n  } catch (error) {\r\n    console.error('Error al guardar plantilla:', error);\r\n    throw new Error('No se pudo guardar la plantilla');\r\n  }\r\n}\r\n\r\n/**\r\n * Elimina una plantilla de email\r\n * @param {string} templateId - ID de la plantilla a eliminar\r\n * @returns {boolean} √âxito de la operaci√≥n\r\n */\r\nexport async function deleteEmailTemplate(templateId) {\r\n  // Verificar que no sea una plantilla del sistema\r\n  const templates = await getEmailTemplates();\r\n  const templateToDelete = templates.find(t => t.id === templateId);\r\n  \r\n  if (!templateToDelete) {\r\n    return false; // No existe la plantilla\r\n  }\r\n  \r\n  if (templateToDelete.isSystem) {\r\n    throw new Error('No se pueden eliminar plantillas del sistema');\r\n  }\r\n  \r\n  let success = false;\r\n  \r\n  // Intentar eliminar en backend si est√° disponible\r\n  if (USE_BACKEND) {\r\n    try {\r\n      const res = await fetch(`${BASE}/api/email-templates/${templateId}`, {\r\n        method: 'DELETE',\r\n        headers: await authHeader({ 'Content-Type': 'application/json' }),\r\n        body: JSON.stringify({ user: CURRENT_USER_EMAIL })\r\n      });\r\n      \r\n      if (res.ok) {\r\n        success = true;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al eliminar plantilla en backend:', error);\r\n      // Fallback a localStorage\r\n    }\r\n  }\r\n  \r\n  // Eliminar de localStorage si no se pudo en backend o si no se usa backend\r\n  if (!success) {\r\n    try {\r\n      const updatedTemplates = templates.filter(t => t.id !== templateId);\r\n      localStorage.setItem(TEMPLATES_STORAGE_KEY, JSON.stringify(updatedTemplates));\r\n      success = true;\r\n    } catch (error) {\r\n      console.error('Error al eliminar plantilla:', error);\r\n      return false;\r\n    }\r\n  }\r\n  \r\n  // Si se elimin√≥ exitosamente, actualizar cach√©\r\n  if (success) {\r\n    // Invalidar la plantilla en cach√©\r\n    templateCache.invalidateTemplate(templateId);\r\n    \r\n    // Forzar recarga de la lista completa en pr√≥ximo acceso\r\n    if (USE_BACKEND) {\r\n      templateCache.invalidateAllTemplates();\r\n    } else {\r\n      // Si no hay backend, actualizar cach√© con la lista actualizada\r\n      const updatedTemplates = templates.filter(t => t.id !== templateId);\r\n      templateCache.cacheAllTemplates(updatedTemplates);\r\n    }\r\n    \r\n    console.log(`Plantilla ${templateId} eliminada y cach√© actualizada`);\r\n  }\r\n  \r\n  return success;\r\n}\r\n\r\n/**\r\n * Reinicia las plantillas predefinidas del sistema\r\n * @returns {Array} Lista de plantillas restauradas\r\n */\r\nexport async function resetPredefinedTemplates() {\r\n  try {\r\n    // Obtener todas las plantillas actuales\r\n    const currentTemplates = await getEmailTemplates();\r\n    \r\n    // Filtrar las plantillas personalizadas (no son del sistema)\r\n    const customTemplates = currentTemplates.filter(template => !template.isSystem);\r\n    \r\n    // Combinar plantillas personalizadas con las predefinidas actualizadas\r\n    const updatedTemplates = [...customTemplates, ...allTemplates];\r\n    \r\n    // Guardar la nueva colecci√≥n\r\n    localStorage.setItem(TEMPLATES_STORAGE_KEY, JSON.stringify(updatedTemplates));\r\n    \r\n    return updatedTemplates;\r\n  } catch (error) {\r\n    console.error('Error al resetear plantillas predefinidas:', error);\r\n    throw new Error('No se pudieron restaurar las plantillas predefinidas');\r\n  }\r\n}\r\n\r\n// =======================\r\n// Exportaci√≥n por defecto\r\n// =======================\r\nconst EmailService = {\r\n  initEmailService,\r\n  getUserEmailAddress,\r\n  getMails,\r\n  getMail,\r\n  sendMail,\r\n  sendEmail,\r\n  sendMailWithMailgun,\r\n  deleteMail,\r\n  markAsRead,\r\n  createEmailAlias,\r\n  getEmailTemplates,\r\n  getEmailTemplateById,\r\n  saveEmailTemplate,\r\n  deleteEmailTemplate,\r\n  resetPredefinedTemplates\r\n};\r\n\r\nexport default EmailService;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\emailTemplates.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\folderService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\imageOptimizationService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\inspirationService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\mailgunService.js","messages":[{"ruleId":"no-unreachable","severity":2,"message":"Unreachable code.","line":160,"column":3,"nodeType":"ExpressionStatement","messageId":"unreachableCode","endLine":168,"endColumn":30},{"ruleId":"no-unreachable","severity":2,"message":"Unreachable code.","line":188,"column":19,"nodeType":"BlockStatement","messageId":"unreachableCode","endLine":191,"endColumn":4}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Servicio de integraci√≥n con Mailgun para correos myWed360 (actualizado)\r\n * Este servicio gestiona todas las interacciones con Mailgun a trav√©s de\r\n * Firebase Cloud Functions por seguridad (no expone API keys en el frontend):\r\n * - Env√≠o de correos\r\n * - Verificaci√≥n de entrega\r\n * - Gesti√≥n de alias de correo\r\n * - Validaci√≥n de direcciones\r\n */\r\n\r\n// Variables de configuraci√≥n\r\nconst DOMAIN = import.meta.env.VITE_MAILGUN_DOMAIN || 'mywed360.com';\r\nconst FUNCTIONS_URL = import.meta.env.VITE_FIREBASE_FUNCTIONS_URL || 'https://us-central1-lovenda-98c77.cloudfunctions.net';\r\n\r\n/**\r\n * Verifica si Mailgun est√° configurado correctamente\r\n * @returns {boolean} - true si hay un dominio configurado y acceso a funciones\r\n */\r\nexport function isMailgunConfigured() {\r\n  return !!DOMAIN && !!FUNCTIONS_URL;\r\n}\r\n\r\n/**\r\n * Env√≠a un correo electr√≥nico usando Mailgun a trav√©s de Cloud Functions\r\n * \r\n * @param {Object} options - Opciones para el correo\r\n * @param {string} options.from - Direcci√≥n de correo del remitente\r\n * @param {string} options.to - Direcci√≥n(es) de correo de destinatario(s)\r\n * @param {string} options.subject - Asunto del correo\r\n * @param {string} options.text - Contenido en texto plano\r\n * @param {string} options.html - Contenido en HTML\r\n * @param {string} [options.cc] - Direcci√≥n(es) en copia\r\n * @param {string} [options.bcc] - Direcci√≥n(es) en copia oculta\r\n * @param {string} [options.replyTo] - Direcci√≥n de respuesta\r\n * @param {Array} [options.attachments] - Archivos adjuntos\r\n * @returns {Promise<Object>} - Respuesta de la Cloud Function\r\n */\r\nexport async function sendEmail(options) {\r\n  if (!isMailgunConfigured()) {\r\n    throw new Error('Mailgun no est√° configurado correctamente');\r\n  }\r\n  \r\n  const { from, to, subject, text, html, cc, bcc, replyTo, attachments = [] } = options;\r\n  \r\n  // Validaciones b√°sicas\r\n  if (!from) throw new Error('Remitente (from) requerido');\r\n  if (!to) throw new Error('Destinatario (to) requerido');\r\n  if (!subject) throw new Error('Asunto (subject) requerido');\r\n  if (!text && !html) throw new Error('Contenido (text o html) requerido');\r\n  \r\n  // Llamar a la Cloud Function para enviar el correo\r\n  try {\r\n    const response = await fetch(`${FUNCTIONS_URL}/sendEmail`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify({\r\n        from,\r\n        to,\r\n        subject,\r\n        text,\r\n        html,\r\n        cc,\r\n        bcc,\r\n        replyTo,\r\n        // No se pueden enviar archivos binarios directamente, se necesita un enfoque diferente para adjuntos\r\n        // En producci√≥n, deber√≠as subir los archivos a Cloud Storage y pasar las URLs\r\n        attachments: attachments ? attachments.map(a => ({ name: a.name })) : []\r\n      })\r\n    });\r\n    \r\n    if (!response.ok) {\r\n      const errorText = await response.text();\r\n      throw new Error(`Error al enviar correo: ${response.status} - ${errorText}`);\r\n    }\r\n    \r\n    const data = await response.json();\r\n    return {\r\n      success: true,\r\n      messageId: data.id || 'unknown',\r\n      response: data\r\n    };\r\n  } catch (error) {\r\n    console.error('Error en Cloud Function sendEmail:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Verifica si un correo electr√≥nico es v√°lido (sintaxis y existencia) usando Cloud Functions\r\n * @param {string} email - Correo electr√≥nico a verificar\r\n * @returns {Promise<Object>} - Informaci√≥n sobre la validez del correo\r\n */\r\nexport async function validateEmail(email) {\r\n  if (!isMailgunConfigured()) {\r\n    throw new Error('Mailgun no est√° configurado correctamente');\r\n  }\r\n  \r\n  if (!email) {\r\n    throw new Error('Correo electr√≥nico requerido');\r\n  }\r\n  \r\n  try {\r\n    const response = await fetch(`${FUNCTIONS_URL}/validateEmail?email=${encodeURIComponent(email)}`);\r\n    \r\n    if (!response.ok) {\r\n      const errorText = await response.text();\r\n      throw new Error(`Error al validar correo: ${response.status} - ${errorText}`);\r\n    }\r\n    \r\n    const data = await response.json();\r\n    return data;\r\n  } catch (error) {\r\n    console.error('Error en la validaci√≥n de correo:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Verifica si un nombre de usuario est√° disponible en el dominio usando Cloud Functions\r\n * @param {string} username - Nombre de usuario a verificar (sin @dominio)\r\n * @returns {Promise<boolean>} - true si est√° disponible\r\n */\r\nexport async function checkUsernameAvailability(username) {\r\n  if (!isMailgunConfigured()) {\r\n    throw new Error('Mailgun no est√° configurado correctamente');\r\n  }\r\n  \r\n  if (!username) {\r\n    throw new Error('Nombre de usuario requerido');\r\n  }\r\n  \r\n  // Normalizar el nombre de usuario (minusculas, sin acentos, etc)\r\n  const normalizedUsername = username.toLowerCase()\r\n    .normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\r\n    .replace(/[^a-z0-9.]/g, '.');\r\n    \r\n  // El correo a verificar\r\n  const email = `${normalizedUsername}@${DOMAIN}`;\r\n  \r\n  try {\r\n    // Usamos el endpoint de validaci√≥n para verificar a trav√©s de Cloud Functions\r\n    const validationResult = await validateEmail(email);\r\n    \r\n    // Si mailgun dice que es v√°lido, podemos asumirlo como disponible\r\n    // En producci√≥n, se deber√≠a verificar contra una base de datos de usuarios existentes\r\n    return validationResult.is_valid && !validationResult.is_disposable_address;\r\n    \r\n  } catch (error) {\r\n    console.error('Error al verificar disponibilidad de nombre de usuario:', error);\r\n    // En caso de error, asumimos que no est√° disponible por precauci√≥n\r\n    return false;\r\n  }\r\n  \r\n  // En una implementaci√≥n real, aqu√≠ verificar√≠amos contra la base de datos\r\n  // y el servicio de correo (Mailgun) si el nombre existe ya\r\n  \r\n  // Simular latencia de red y verificaci√≥n\r\n  await new Promise(resolve => setTimeout(resolve, 600));\r\n  \r\n  // Para simulaci√≥n, consideramos nombres cortos como no disponibles\r\n  if (username.length <= 4) {\r\n    return { available: false, reason: 'Este nombre de usuario no est√° disponible' };\r\n  }\r\n  \r\n  // Por defecto, indicamos que est√° disponible\r\n  return { available: true };\r\n}\r\n\r\n/**\r\n * Crea una ruta de reenv√≠o de correo en Mailgun\r\n * @param {string} address - Direcci√≥n de correo completa (ejemplo@mywed360.com)\r\n * @param {string} forwardTo - Direcci√≥n a la que reenviar (usuario@gmail.com)\r\n * @returns {Promise<Object>} - Respuesta de la API\r\n */\r\nexport async function createForwardingRoute(address, forwardTo) {\r\n  if (!isMailgunConfigured()) {\r\n    throw new Error('Mailgun no est√° configurado correctamente');\r\n  }\r\n  \r\n  if (!address || !forwardTo) {\r\n    throw new Error('Se requieren direcci√≥n de origen y destino');\r\n  }\r\n  \r\n  try {\r\n    return { available: true };\r\n  } catch (error) {\r\n    console.error('Error en Mailgun createForwardingRoute:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Obtiene los eventos de correo para un usuario espec√≠fico usando Cloud Functions\r\n * @param {string} emailAddress - Direcci√≥n de correo\r\n * @param {string} [eventType='delivered'] - Tipo de evento (accepted, delivered, failed, rejected)\r\n * @param {number} [limit=50] - N√∫mero m√°ximo de eventos a devolver\r\n * @returns {Promise<Array>} - Array de eventos\r\n */\r\nexport async function getMailEvents(emailAddress, eventType = 'delivered', limit = 50) {\r\n  if (!isMailgunConfigured()) {\r\n    throw new Error('Mailgun no est√° configurado correctamente');\r\n  }\r\n  \r\n  if (!emailAddress) {\r\n    throw new Error('Direcci√≥n de correo requerida');\r\n  }\r\n  \r\n  try {\r\n    const params = new URLSearchParams({\r\n      recipient: emailAddress,\r\n      event: eventType,\r\n      limit\r\n    });\r\n    \r\n    const response = await fetch(`${FUNCTIONS_URL}/getMailgunEvents?${params}`);\r\n    \r\n    if (!response.ok) {\r\n      throw new Error(`Error al obtener eventos: ${response.status}`);\r\n    }\r\n    \r\n    const data = await response.json();\r\n    return data.items || [];\r\n  } catch (error) {\r\n    console.error('Error al obtener eventos de correo:', error);\r\n    throw error;\r\n  }\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\notificationService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\reminderService.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'allSent' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":92,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":92,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Servicio para gestionar recordatorios autom√°ticos de seguimiento.\r\n * Cuando un correo enviado no recibe respuesta despu√©s de X d√≠as, se env√≠a\r\n * autom√°ticamente un recordatorio (Re:) al mismo destinatario.\r\n * \r\n * Estrategia:\r\n *   1. Cada vez que se env√≠a un correo con emailService.sendMail se almacena\r\n *      { reminderSent: false, reminderAt: ISODate } en el objeto del mail.\r\n *   2. Este servicio registra un job (setInterval) que se ejecuta cada hora\r\n *      (configurable). Recorre la carpeta \"sent\" buscando correos que:\r\n *         - reminderSent === false\r\n *         - new Date(reminderAt) < Date.now()\r\n *         - No existe respuesta del destinatario en la bandeja de entrada\r\n *           (se determina buscando en localStorage un correo con inReplyTo === id)\r\n *      Si cumple las condiciones, env√≠a un nuevo correo con asunto `Re: ...`\r\n *      y marca reminderSent = true.\r\n * \r\n * Nota: Para entornos con backend, se recomienda mover esta l√≥gica al servidor.\r\n */\r\n\r\nimport { getMails, sendMail } from './emailService';\r\n\r\nconst DEFAULT_DAYS = 3; // d√≠as de espera por defecto\r\nconst CHECK_INTERVAL_MS = 60 * 60 * 1000; // 1 hora\r\n\r\nlet intervalId = null;\r\nlet enabled = true;\r\n\r\n/**\r\n * Activa el servicio de recordatorios.\r\n * @param {Object} options\r\n * @param {number} options.days N√∫mero de d√≠as antes de recordar.\r\n * @param {boolean} options.enabled Habilitar/deshabilitar.\r\n */\r\nexport function initReminderService({ days = DEFAULT_DAYS, enabled: en = true } = {}) {\r\n  enabled = en;\r\n  if (!enabled) {\r\n    stopReminderService();\r\n    return;\r\n  }\r\n  if (intervalId) return; // Ya iniciado\r\n  intervalId = setInterval(() => runReminderJob(days), CHECK_INTERVAL_MS);\r\n  // Ejecutar inmediatamente en el arranque\r\n  runReminderJob(days);\r\n}\r\n\r\nexport function stopReminderService() {\r\n  if (intervalId) {\r\n    clearInterval(intervalId);\r\n    intervalId = null;\r\n  }\r\n}\r\n\r\nasync function runReminderJob(days) {\r\n  if (!enabled) return;\r\n  try {\r\n    const sentMails = await getMails('sent');\r\n    let inboxMails = await getMails('inbox');\r\n    \r\n    // Validar que sentMails e inboxMails sean arrays\r\n    if (!Array.isArray(sentMails)) {\r\n      console.warn('sentMails no es un array, saltando job de recordatorios');\r\n      return;\r\n    }\r\n    if (!Array.isArray(inboxMails)) {\r\n      console.warn('inboxMails no es un array, usando array vac√≠o');\r\n      inboxMails = [];\r\n    }\r\n    \r\n    const cutoff = Date.now() - days * 24 * 60 * 60 * 1000;\r\n\r\n    for (const mail of sentMails) {\r\n      if (mail.reminderSent) continue;\r\n      if (new Date(mail.reminderAt || mail.date).getTime() > cutoff) continue;\r\n\r\n      // Comprobar respuesta: buscamos correo en inbox con inReplyTo = mail.id o mismo asunto + Re:\r\n      const replied = inboxMails.some(\r\n        m => m.inReplyTo === mail.id || (m.subject || '').startsWith('Re:') && (m.subject || '').includes(mail.subject)\r\n      );\r\n      if (replied) continue;\r\n\r\n      // Enviar recordatorio\r\n      await sendMail({\r\n        to: mail.to,\r\n        subject: `Re: ${mail.subject}`,\r\n        body: `Hola,\\n\\nS√≥lo para asegurarme de que recibiste mi mensaje anterior. Quedo atento(a) a tu respuesta.\\n\\n---\\nMensaje original:\\n${mail.body}`,\r\n      });\r\n\r\n      // Marcar como enviado el recordatorio\r\n      mail.reminderSent = true;\r\n      // Persistir\r\n      const allSent = sentMails.map(m => (m.id === mail.id ? mail : m));\r\n      // emailService expone saveLocal? no, usamos localStorage directo\r\n      try {\r\n        const stored = JSON.parse(localStorage.getItem('mywed360_mails') || '[]');\r\n        const updated = stored.map(m => (m.id === mail.id ? mail : m));\r\n        localStorage.setItem('mywed360_mails', JSON.stringify(updated));\r\n      } catch (e) {\r\n        console.error('Error actualizando estado de recordatorio:', e);\r\n      }\r\n    }\r\n  } catch (err) {\r\n    console.error('Error en job de recordatorios:', err);\r\n  }\r\n}\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\statsService.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'getEmailTagsDetails' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":39,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":58},{"ruleId":"no-unused-vars","severity":1,"message":"'getDailyStats' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":30,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":43},{"ruleId":"no-unused-vars","severity":1,"message":"'emails' is defined but never used. Allowed unused args must match /^_/u.","line":218,"column":43,"nodeType":"Identifier","messageId":"unusedVar","endLine":218,"endColumn":49}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Servicio para recolectar y analizar estad√≠sticas de uso del sistema de correo\r\n * Proporciona m√©tricas sobre actividad de correo, patrones de comunicaci√≥n, \r\n * distribuci√≥n por etiquetas y carpetas, etc.\r\n */\r\n\r\nimport { getMails } from './emailService';\r\nimport { getUserFolders, getEmailsInFolder } from './folderService';\r\nimport { getUserTags, getEmailsByTag, getEmailTagsDetails } from './tagService';\r\nimport { getAggregatedStats, getDailyStats } from './emailMetricsService';\r\n\r\n/**\r\n * Almacena las estad√≠sticas de correo del usuario en localStorage\r\n * @param {string} userId - ID del usuario\r\n * @param {Object} stats - Estad√≠sticas a almacenar\r\n */\r\nconst saveUserStats = (userId, stats) => {\r\n  if (!userId) return;\r\n  localStorage.setItem(`lovenda_email_stats_${userId}`, JSON.stringify(stats));\r\n};\r\n\r\n/**\r\n * Recupera las estad√≠sticas de correo del usuario desde localStorage\r\n * @param {string} userId - ID del usuario\r\n * @returns {Object} Estad√≠sticas del usuario o un objeto vac√≠o\r\n */\r\nconst getUserStats = (userId) => {\r\n  if (!userId) return {};\r\n  try {\r\n    const stats = localStorage.getItem(`lovenda_email_stats_${userId}`);\r\n    return stats ? JSON.parse(stats) : {};\r\n  } catch (error) {\r\n    console.error('Error al recuperar estad√≠sticas:', error);\r\n    return {};\r\n  }\r\n};\r\n\r\n/**\r\n * Genera estad√≠sticas completas de uso del correo para el usuario\r\n * @param {string} userId - ID del usuario\r\n * @returns {Promise<Object>} Estad√≠sticas completas\r\n */\r\nconst generateUserStats = async (userId) => {\r\n  if (!userId) return {};\r\n  \r\n  try {\r\n    // Intentar obtener m√©tricas agregadas desde Firestore\r\n    const aggregated = await getAggregatedStats(userId);\r\n    if (aggregated) {\r\n      // Guardar copia local para acceso offline\r\n      saveUserStats(userId, { ...aggregated, lastUpdated: new Date().toISOString() });\r\n      return aggregated;\r\n    }\r\n\r\n    // --- Fallback local: calcular m√©tricas en el cliente ---\r\n    const inboxEmails = await getMails('inbox');\r\n    const sentEmails = await getMails('sent');\r\n    const trashEmails = await getMails('trash');\r\n    \r\n    // Combinar todos los correos para an√°lisis\r\n    const allEmails = [...inboxEmails, ...sentEmails, ...trashEmails];\r\n    \r\n    // Estructura para las estad√≠sticas\r\n    const stats = {\r\n      lastUpdated: new Date().toISOString(),\r\n      emailCounts: {\r\n        total: allEmails.length,\r\n        inbox: inboxEmails.length,\r\n        sent: sentEmails.length,\r\n        trash: trashEmails.length,\r\n        unread: inboxEmails.filter(email => !email.read).length\r\n      },\r\n      activityMetrics: calculateActivityMetrics(allEmails),\r\n      folderDistribution: calculateFolderDistribution(userId, allEmails),\r\n      tagDistribution: calculateTagDistribution(userId, allEmails),\r\n      contactAnalysis: analyzeContacts(allEmails),\r\n      responseMetrics: calculateResponseMetrics(inboxEmails, sentEmails)\r\n    };\r\n    \r\n    // Guardar estad√≠sticas en localStorage\r\n    saveUserStats(userId, stats);\r\n    \r\n    return stats;\r\n  } catch (error) {\r\n    console.error('Error al generar estad√≠sticas:', error);\r\n    return {\r\n      error: true,\r\n      message: 'No se pudieron generar las estad√≠sticas'\r\n    };\r\n  }\r\n};\r\n\r\n/**\r\n * Calcula m√©tricas de actividad (correos por d√≠a/semana/mes)\r\n * @param {Array} emails - Lista de correos\r\n * @returns {Object} M√©tricas de actividad\r\n */\r\nconst calculateActivityMetrics = (emails) => {\r\n  // Inicializar estructura de datos\r\n  const now = new Date();\r\n  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n  const yesterday = new Date(today);\r\n  yesterday.setDate(yesterday.getDate() - 1);\r\n  \r\n  const oneWeekAgo = new Date(today);\r\n  oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);\r\n  \r\n  const oneMonthAgo = new Date(today);\r\n  oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);\r\n  \r\n  // Inicializar contadores\r\n  const metrics = {\r\n    today: 0,\r\n    yesterday: 0,\r\n    thisWeek: 0,\r\n    thisMonth: 0,\r\n    daily: {} // Para gr√°fico diario\r\n  };\r\n  \r\n  // Preparar estructura para gr√°fico diario (√∫ltimos 7 d√≠as)\r\n  for (let i = 6; i >= 0; i--) {\r\n    const date = new Date(today);\r\n    date.setDate(date.getDate() - i);\r\n    const dateStr = date.toISOString().split('T')[0];\r\n    metrics.daily[dateStr] = {\r\n      sent: 0,\r\n      received: 0,\r\n      date: dateStr\r\n    };\r\n  }\r\n  \r\n  // Analizar correos\r\n  emails.forEach(email => {\r\n    if (!email.date) return;\r\n    \r\n    const emailDate = new Date(email.date);\r\n    \r\n    // Determinar si es enviado o recibido\r\n    const isSent = email.from && email.from.includes('@lovenda.app');\r\n    \r\n    // Contar por per√≠odo\r\n    if (emailDate >= today) {\r\n      metrics.today++;\r\n    } else if (emailDate >= yesterday) {\r\n      metrics.yesterday++;\r\n    }\r\n    \r\n    if (emailDate >= oneWeekAgo) {\r\n      metrics.thisWeek++;\r\n      \r\n      // Agregar al gr√°fico diario\r\n      const dateStr = emailDate.toISOString().split('T')[0];\r\n      if (metrics.daily[dateStr]) {\r\n        if (isSent) {\r\n          metrics.daily[dateStr].sent++;\r\n        } else {\r\n          metrics.daily[dateStr].received++;\r\n        }\r\n      }\r\n    }\r\n    \r\n    if (emailDate >= oneMonthAgo) {\r\n      metrics.thisMonth++;\r\n    }\r\n  });\r\n  \r\n  // Convertir el objeto daily a un array para facilitar el renderizado\r\n  metrics.dailyGraph = Object.values(metrics.daily);\r\n  \r\n  return metrics;\r\n};\r\n\r\n/**\r\n * Calcula la distribuci√≥n de correos por carpeta\r\n * @param {string} userId - ID del usuario\r\n * @param {Array} emails - Lista de correos\r\n * @returns {Object} Distribuci√≥n por carpetas\r\n */\r\nconst calculateFolderDistribution = (userId, emails) => {\r\n  const folderDistribution = {\r\n    system: {\r\n      inbox: 0,\r\n      sent: 0,\r\n      trash: 0\r\n    },\r\n    custom: []\r\n  };\r\n  \r\n  // Contar correos por carpeta del sistema\r\n  emails.forEach(email => {\r\n    if (email.folder === 'inbox') folderDistribution.system.inbox++;\r\n    else if (email.folder === 'sent') folderDistribution.system.sent++;\r\n    else if (email.folder === 'trash') folderDistribution.system.trash++;\r\n  });\r\n  \r\n  // Obtener carpetas personalizadas\r\n  const customFolders = getUserFolders(userId);\r\n  \r\n  // Contar correos por carpeta personalizada\r\n  customFolders.forEach(folder => {\r\n    const folderEmails = getEmailsInFolder(userId, folder.id);\r\n    folderDistribution.custom.push({\r\n      id: folder.id,\r\n      name: folder.name,\r\n      count: folderEmails.length\r\n    });\r\n  });\r\n  \r\n  return folderDistribution;\r\n};\r\n\r\n/**\r\n * Calcula la distribuci√≥n de correos por etiquetas\r\n * @param {string} userId - ID del usuario\r\n * @param {Array} emails - Lista de correos\r\n * @returns {Object} Distribuci√≥n por etiquetas\r\n */\r\nconst calculateTagDistribution = (userId, emails) => {\r\n  // Obtener todas las etiquetas disponibles\r\n  const allTags = getUserTags(userId);\r\n  \r\n  // Inicializar contadores para cada etiqueta\r\n  const tagStats = allTags.map(tag => ({\r\n    id: tag.id,\r\n    name: tag.name,\r\n    color: tag.color,\r\n    count: 0\r\n  }));\r\n  \r\n  // Contar correos por etiqueta\r\n  allTags.forEach(tag => {\r\n    const taggedEmails = getEmailsByTag(userId, tag.id);\r\n    const tagStat = tagStats.find(ts => ts.id === tag.id);\r\n    if (tagStat) {\r\n      tagStat.count = taggedEmails.length;\r\n    }\r\n  });\r\n  \r\n  // Ordenar por cantidad (mayor a menor)\r\n  tagStats.sort((a, b) => b.count - a.count);\r\n  \r\n  return tagStats;\r\n};\r\n\r\n/**\r\n * Analiza la distribuci√≥n de correos por contactos\r\n * @param {Array} emails - Lista de correos\r\n * @returns {Object} An√°lisis de contactos\r\n */\r\nconst analyzeContacts = (emails) => {\r\n  const contactMap = new Map();\r\n  \r\n  emails.forEach(email => {\r\n    // Procesar remitente\r\n    if (email.from && !email.from.includes('@lovenda.app')) {\r\n      const senderName = extractNameFromEmail(email.from);\r\n      const senderContact = contactMap.get(senderName) || { \r\n        name: senderName, \r\n        sent: 0, \r\n        received: 0,\r\n        lastContact: null\r\n      };\r\n      \r\n      senderContact.received++;\r\n      \r\n      if (!senderContact.lastContact || new Date(email.date) > new Date(senderContact.lastContact)) {\r\n        senderContact.lastContact = email.date;\r\n      }\r\n      \r\n      contactMap.set(senderName, senderContact);\r\n    }\r\n    \r\n    // Procesar destinatario\r\n    if (email.to && !email.to.includes('@lovenda.app')) {\r\n      const recipientName = extractNameFromEmail(email.to);\r\n      const recipientContact = contactMap.get(recipientName) || { \r\n        name: recipientName, \r\n        sent: 0, \r\n        received: 0,\r\n        lastContact: null \r\n      };\r\n      \r\n      recipientContact.sent++;\r\n      \r\n      if (!recipientContact.lastContact || new Date(email.date) > new Date(recipientContact.lastContact)) {\r\n        recipientContact.lastContact = email.date;\r\n      }\r\n      \r\n      contactMap.set(recipientName, recipientContact);\r\n    }\r\n  });\r\n  \r\n  // Convertir a array y ordenar por n√∫mero total de interacciones\r\n  const contacts = Array.from(contactMap.values())\r\n    .map(contact => ({\r\n      ...contact,\r\n      total: contact.sent + contact.received\r\n    }))\r\n    .sort((a, b) => b.total - a.total);\r\n  \r\n  return {\r\n    topContacts: contacts.slice(0, 5),\r\n    totalContacts: contacts.length,\r\n    contacts: contacts\r\n  };\r\n};\r\n\r\n/**\r\n * Extrae el nombre de una direcci√≥n de correo\r\n * @param {string} emailAddress - Direcci√≥n de correo (puede incluir nombre)\r\n * @returns {string} Nombre extra√≠do\r\n */\r\nconst extractNameFromEmail = (emailAddress) => {\r\n  if (!emailAddress) return 'Desconocido';\r\n  \r\n  // Si tiene formato \"Nombre <email@ejemplo.com>\"\r\n  const match = emailAddress.match(/^([^<]+)\\s*<([^>]+)>$/);\r\n  if (match) {\r\n    return match[1].trim();\r\n  }\r\n  \r\n  // Si es solo correo, extraer parte local\r\n  const parts = emailAddress.split('@');\r\n  if (parts.length === 2) {\r\n    return parts[0];\r\n  }\r\n  \r\n  return emailAddress;\r\n};\r\n\r\n/**\r\n * Calcula m√©tricas de respuesta (tiempo promedio, tasa de respuesta)\r\n * @param {Array} inboxEmails - Correos recibidos\r\n * @param {Array} sentEmails - Correos enviados\r\n * @returns {Object} M√©tricas de respuesta\r\n */\r\nconst calculateResponseMetrics = (inboxEmails, sentEmails) => {\r\n  // Mapear correos enviados por referencia a correo original (In-Reply-To)\r\n  const repliesMap = new Map();\r\n  \r\n  sentEmails.forEach(email => {\r\n    if (email.inReplyTo) {\r\n      repliesMap.set(email.inReplyTo, email);\r\n    }\r\n  });\r\n  \r\n  // Analizar tiempos de respuesta\r\n  let totalResponseTime = 0;\r\n  let responseCount = 0;\r\n  \r\n  inboxEmails.forEach(receivedEmail => {\r\n    const reply = repliesMap.get(receivedEmail.id);\r\n    \r\n    if (reply) {\r\n      const receivedDate = new Date(receivedEmail.date);\r\n      const replyDate = new Date(reply.date);\r\n      \r\n      if (receivedDate && replyDate) {\r\n        const responseTime = replyDate - receivedDate;\r\n        totalResponseTime += responseTime;\r\n        responseCount++;\r\n      }\r\n    }\r\n  });\r\n  \r\n  // Calcular m√©tricas\r\n  const metrics = {\r\n    responseRate: inboxEmails.length > 0 ? (responseCount / inboxEmails.length) : 0,\r\n    averageResponseTime: responseCount > 0 ? (totalResponseTime / responseCount) : null,\r\n    responseCount: responseCount,\r\n    formattedAvgResponseTime: null\r\n  };\r\n  \r\n  // Formatear tiempo de respuesta promedio en formato amigable\r\n  if (metrics.averageResponseTime !== null) {\r\n    const avgMinutes = Math.floor(metrics.averageResponseTime / (1000 * 60));\r\n    \r\n    if (avgMinutes < 60) {\r\n      metrics.formattedAvgResponseTime = `${avgMinutes} minutos`;\r\n    } else if (avgMinutes < 24 * 60) {\r\n      metrics.formattedAvgResponseTime = `${Math.floor(avgMinutes / 60)} horas`;\r\n    } else {\r\n      metrics.formattedAvgResponseTime = `${Math.floor(avgMinutes / (60 * 24))} d√≠as`;\r\n    }\r\n  }\r\n  \r\n  return metrics;\r\n};\r\n\r\nexport {\r\n  generateUserStats,\r\n  getUserStats,\r\n  saveUserStats\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\tagService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\translationService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\services\\wallService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\src\\components\\HomePage.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\AllProviders.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\accessibility\\EmailDetail.a11y.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\accessibility\\EmailInbox.a11y.test.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'queryByText' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":140,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":140,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\r\nimport { render } from '@testing-library/react';\r\nimport { MemoryRouter } from 'react-router-dom';\r\nimport { axe, formatViolations } from '../helpers/axeSetup';\r\nimport EmailInbox from '../../components/email/EmailInbox';\r\n\r\n// Mock de servicios\r\nvi.mock('../../services/EmailService', () => ({\r\n  getMails: vi.fn().mockResolvedValue([\r\n    {\r\n      id: 'email1',\r\n      from: 'remitente@example.com',\r\n      to: 'usuario@lovenda.com',\r\n      subject: 'Asunto de prueba',\r\n      body: '<p>Contenido de prueba</p>',\r\n      date: '2025-07-10T15:30:00Z',\r\n      folder: 'inbox',\r\n      read: false,\r\n      attachments: []\r\n    },\r\n    {\r\n      id: 'email2',\r\n      from: 'otro@example.com',\r\n      to: 'usuario@lovenda.com',\r\n      subject: 'Segundo email',\r\n      body: '<p>Otro contenido de prueba</p>',\r\n      date: '2025-07-09T10:15:00Z',\r\n      folder: 'inbox',\r\n      read: true,\r\n      attachments: []\r\n    }\r\n  ]),\r\n  getUnreadCount: vi.fn().mockResolvedValue(1)\r\n}));\r\n\r\nvi.mock('../../services/TagService', () => ({\r\n  getUserTags: vi.fn().mockReturnValue([\r\n    { id: 'important', name: 'Importante', color: '#e53e3e' }\r\n  ]),\r\n  getEmailTagsDetails: vi.fn().mockReturnValue([])\r\n}));\r\n\r\nvi.mock('../../services/FolderService', () => ({\r\n  getUserFolders: vi.fn().mockReturnValue([\r\n    { id: 'inbox', name: 'Bandeja de entrada', system: true },\r\n    { id: 'sent', name: 'Enviados', system: true },\r\n    { id: 'trash', name: 'Papelera', system: true }\r\n  ])\r\n}));\r\n\r\n// Wrapper de componente para pruebas\r\nconst TestWrapper = ({ children }) => (\r\n  <MemoryRouter>\r\n    {children}\r\n  </MemoryRouter>\r\n);\r\n\r\ndescribe('Pruebas de accesibilidad para EmailInbox', () => {\r\n  let rendered;\r\n\r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n    rendered = render(<EmailInbox />, { wrapper: TestWrapper });\r\n  });\r\n\r\n  afterEach(() => {\r\n    vi.restoreAllMocks();\r\n  });\r\n\r\n  it('no tiene violaciones de accesibilidad', async () => {\r\n    // Esperar a que los datos se carguen\r\n    await vi.waitFor(() => {\r\n      expect(rendered.getByText('Bandeja de entrada')).toBeInTheDocument();\r\n    });\r\n\r\n    // Ejecutar an√°lisis de accesibilidad\r\n    const results = await axe(rendered.container);\r\n    \r\n    // Opcional: imprimir detalles de violaciones para depuraci√≥n\r\n    if (results.violations.length > 0) {\r\n      console.error(formatViolations(results.violations));\r\n    }\r\n    \r\n    expect(results).toHaveNoViolations();\r\n  });\r\n\r\n  it('mantiene la navegaci√≥n por teclado funcional', async () => {\r\n    // Esperar a que los datos se carguen\r\n    await vi.waitFor(() => {\r\n      expect(rendered.getByText('Bandeja de entrada')).toBeInTheDocument();\r\n    });\r\n    \r\n    // Verificar que los elementos interactivos son focusables y tienen roles adecuados\r\n    const emailItems = rendered.container.querySelectorAll('.email-item');\r\n    \r\n    expect(emailItems.length).toBeGreaterThan(0);\r\n    \r\n    emailItems.forEach(item => {\r\n      // Verificar atributos de accesibilidad esenciales\r\n      expect(item).toHaveAttribute('tabindex', '0');\r\n      expect(item).toHaveAttribute('role', 'button');\r\n      \r\n      // Verificar que los elementos no le√≠dos tienen informaci√≥n sem√°ntica adicional\r\n      if (item.classList.contains('unread')) {\r\n        expect(item).toHaveAttribute('aria-label', expect.stringContaining('no le√≠do'));\r\n      }\r\n    });\r\n\r\n    // Verificar navegaci√≥n para filtros y acciones\r\n    const actionButtons = rendered.container.querySelectorAll('button, [role=\"button\"]');\r\n    actionButtons.forEach(button => {\r\n      expect(button).toHaveAttribute('aria-label');\r\n    });\r\n  });\r\n\r\n  it('usa estructura sem√°ntica adecuada para la lista de emails', async () => {\r\n    // Esperar a que los datos se carguen\r\n    await vi.waitFor(() => {\r\n      expect(rendered.getByText('Bandeja de entrada')).toBeInTheDocument();\r\n    });\r\n    \r\n    // Verificar estructura sem√°ntica\r\n    const emailList = rendered.container.querySelector('.email-list');\r\n    expect(emailList).toHaveAttribute('role', 'list');\r\n    \r\n    const emailItems = emailList.querySelectorAll('.email-item');\r\n    emailItems.forEach(item => {\r\n      expect(item).toHaveAttribute('role', 'listitem');\r\n    });\r\n  });\r\n\r\n  it('proporciona feedback adecuado para estados de carga y errores', async () => {\r\n    // Simular estado de carga\r\n    vi.mock('../../services/EmailService', () => ({\r\n      getMails: vi.fn().mockImplementation(() => new Promise(resolve => setTimeout(resolve, 1000))),\r\n      getUnreadCount: vi.fn().mockResolvedValue(0)\r\n    }));\r\n    \r\n    const { getByText, queryByText } = render(<EmailInbox />, { wrapper: TestWrapper });\r\n    \r\n    // Verificar indicador de carga\r\n    expect(getByText('Cargando...')).toBeInTheDocument();\r\n    expect(getByText('Cargando...')).toHaveAttribute('aria-live', 'polite');\r\n    \r\n    // Simular error\r\n    vi.mock('../../services/EmailService', () => ({\r\n      getMails: vi.fn().mockRejectedValue(new Error('Error de prueba')),\r\n      getUnreadCount: vi.fn().mockResolvedValue(0)\r\n    }));\r\n    \r\n    const { getByText: getByTextError } = render(<EmailInbox />, { wrapper: TestWrapper });\r\n    \r\n    // Verificar mensaje de error\r\n    await vi.waitFor(() => {\r\n      expect(getByTextError('Error al cargar correos')).toBeInTheDocument();\r\n      expect(getByTextError('Error al cargar correos')).toHaveAttribute('aria-live', 'assertive');\r\n    });\r\n  });\r\n\r\n  it('mantiene suficiente contraste en todos los elementos', async () => {\r\n    // Esperar a que los datos se carguen\r\n    await vi.waitFor(() => {\r\n      expect(rendered.getByText('Bandeja de entrada')).toBeInTheDocument();\r\n    });\r\n    \r\n    // Realizar an√°lisis espec√≠fico para contraste\r\n    const contrastResults = await axe(rendered.container, {\r\n      runOnly: {\r\n        type: 'rule',\r\n        values: ['color-contrast']\r\n      }\r\n    });\r\n    \r\n    // Si hay problemas de contraste, mostrar detalles\r\n    if (contrastResults.violations.length > 0) {\r\n      console.error('Problemas de contraste:', formatViolations(contrastResults.violations));\r\n    }\r\n    \r\n    expect(contrastResults).toHaveNoViolations();\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\accessibility\\email-components.a11y.test.jsx","messages":[{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":14,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":14,"endColumn":3},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":28,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":28,"endColumn":3},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":30,"column":14,"nodeType":"Identifier","messageId":"undef","endLine":30,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":31,"column":12,"nodeType":"Identifier","messageId":"undef","endLine":31,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":32,"column":11,"nodeType":"Identifier","messageId":"undef","endLine":32,"endColumn":13},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":38,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":38,"endColumn":3},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":39,"column":12,"nodeType":"Identifier","messageId":"undef","endLine":39,"endColumn":14},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":43,"column":14,"nodeType":"Identifier","messageId":"undef","endLine":43,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":44,"column":14,"nodeType":"Identifier","messageId":"undef","endLine":44,"endColumn":16},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":48,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":48,"endColumn":3},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":59,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":59,"endColumn":3},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":77,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":77,"endColumn":7},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":95,"column":19,"nodeType":"Identifier","messageId":"undef","endLine":95,"endColumn":21},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":116,"column":19,"nodeType":"Identifier","messageId":"undef","endLine":116,"endColumn":21},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":138,"column":19,"nodeType":"Identifier","messageId":"undef","endLine":138,"endColumn":21},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":174,"column":21,"nodeType":"Identifier","messageId":"undef","endLine":174,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":175,"column":24,"nodeType":"Identifier","messageId":"undef","endLine":175,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":192,"column":21,"nodeType":"Identifier","messageId":"undef","endLine":192,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":193,"column":24,"nodeType":"Identifier","messageId":"undef","endLine":193,"endColumn":26}],"suppressedMessages":[],"errorCount":19,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, beforeEach, afterEach } from 'vitest';\r\nimport { render, screen, cleanup } from '@testing-library/react';\r\nimport { axe, toHaveNoViolations } from 'jest-axe';\r\nimport { BrowserRouter } from 'react-router-dom';\r\nimport { ToastContainer } from 'react-toastify';\r\nimport EmailComposer from '../../components/email/EmailComposer';\r\nimport EmailTagsManager from '../../components/email/EmailTagsManager';\r\nimport TagsManager from '../../components/email/TagsManager';\r\n\r\n// Extender las utilidades de prueba con el matcher de axe\r\nexpect.extend(toHaveNoViolations);\r\n\r\n// Mock de componentes y hooks necesarios\r\nvi.mock('../../hooks/useAuth', () => ({\r\n  default: () => ({\r\n    currentUser: { uid: 'testuid' },\r\n    profile: {\r\n      id: 'profile123',\r\n      userId: 'user123',\r\n      brideFirstName: 'Mar√≠a',\r\n      brideLastName: 'Garc√≠a',\r\n      emailAlias: 'maria.garcia'\r\n    },\r\n    isAuthenticated: true\r\n  })\r\n}));\r\n\r\nvi.mock('react-toastify', () => ({\r\n  toast: {\r\n    success: vi.fn(),\r\n    error: vi.fn(),\r\n    info: vi.fn()\r\n  },\r\n  ToastContainer: () => <div data-testid=\"toast-container\" />\r\n}));\r\n\r\n// Mock del servicio de etiquetas\r\nvi.mock('../../services/tagService', () => ({\r\n  getTags: vi.fn(() => Promise.resolve([\r\n    { id: 'tag1', name: 'Urgente', color: '#ff0000', systemTag: true },\r\n    { id: 'tag2', name: 'Proveedores', color: '#00ff00', systemTag: false }\r\n  ])),\r\n  createTag: vi.fn(() => Promise.resolve({ id: 'newTag', name: 'Nueva Etiqueta', color: '#0000ff', systemTag: false })),\r\n  deleteTag: vi.fn(() => Promise.resolve(true))\r\n}));\r\n\r\n// Mock para iconos\r\nvi.mock('lucide-react', () => ({\r\n  Plus: () => <div data-testid=\"plus-icon\">+</div>,\r\n  Trash: () => <div data-testid=\"trash-icon\">√ó</div>,\r\n  X: () => <div data-testid=\"x-icon\">√ó</div>,\r\n  Tags: () => <div data-testid=\"tags-icon\">Tags</div>,\r\n  Tag: () => <div data-testid=\"tag-icon\">Tag</div>,\r\n  Paperclip: () => <div data-testid=\"paperclip-icon\">Attach</div>,\r\n  Send: () => <div data-testid=\"send-icon\">Send</div>\r\n}));\r\n\r\n// Componente de Button mockeado\r\nvi.mock('../../components/ui/Button', () => ({\r\n  default: ({ children, onClick, disabled }) => (\r\n    <button onClick={onClick} disabled={disabled} data-testid=\"button-mock\">\r\n      {children}\r\n    </button>\r\n  )\r\n}));\r\n\r\n// Wrapper para los componentes que requieren context\r\nconst TestWrapper = ({ children }) => (\r\n  <BrowserRouter>\r\n    {children}\r\n    <ToastContainer />\r\n  </BrowserRouter>\r\n);\r\n\r\ndescribe('Pruebas de accesibilidad para componentes de Email', () => {\r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n  });\r\n\r\n  afterEach(() => {\r\n    cleanup();\r\n  });\r\n\r\n  describe('EmailComposer - Accesibilidad', () => {\r\n    it('no debe tener violaciones de accesibilidad', async () => {\r\n      const initialValues = {\r\n        to: '',\r\n        subject: '',\r\n        body: '',\r\n        attachments: []\r\n      };\r\n\r\n      const { container } = render(\r\n        <EmailComposer\r\n          onSend={vi.fn()}\r\n          initialValues={initialValues}\r\n          isLoading={false}\r\n        />, \r\n        { wrapper: TestWrapper }\r\n      );\r\n\r\n      const results = await axe(container);\r\n      expect(results).toHaveNoViolations();\r\n    });\r\n\r\n    it('debe tener los campos con labels accesibles', () => {\r\n      const initialValues = {\r\n        to: '',\r\n        subject: '',\r\n        body: '',\r\n        attachments: []\r\n      };\r\n\r\n      render(\r\n        <EmailComposer\r\n          onSend={vi.fn()}\r\n          initialValues={initialValues}\r\n          isLoading={false}\r\n        />,\r\n        { wrapper: TestWrapper }\r\n      );\r\n\r\n      // Verificar que los campos tienen labels accesibles\r\n      expect(screen.getByLabelText(/destinatario/i)).toBeInTheDocument();\r\n      expect(screen.getByLabelText(/asunto/i)).toBeInTheDocument();\r\n    });\r\n\r\n    it('los botones deben tener texto descriptivo para lectores de pantalla', () => {\r\n      const initialValues = {\r\n        to: '',\r\n        subject: '',\r\n        body: '',\r\n        attachments: []\r\n      };\r\n\r\n      render(\r\n        <EmailComposer\r\n          onSend={vi.fn()}\r\n          initialValues={initialValues}\r\n          isLoading={false}\r\n        />,\r\n        { wrapper: TestWrapper }\r\n      );\r\n\r\n      // Verificar que los botones tienen texto accesible\r\n      const buttons = screen.getAllByRole('button');\r\n      \r\n      // Al menos un bot√≥n debe tener descripci√≥n de adjuntar archivo\r\n      const attachButton = buttons.find(button => \r\n        button.textContent.includes('Attach') || \r\n        button.getAttribute('aria-label')?.includes('adjunt')\r\n      );\r\n      \r\n      // Al menos un bot√≥n debe tener descripci√≥n de enviar\r\n      const sendButton = buttons.find(button => \r\n        button.textContent.includes('Send') || \r\n        button.getAttribute('aria-label')?.includes('enviar')\r\n      );\r\n      \r\n      expect(attachButton).toBeDefined();\r\n      expect(sendButton).toBeDefined();\r\n    });\r\n  });\r\n\r\n  describe('EmailTagsManager - Accesibilidad', () => {\r\n    it('no debe tener violaciones de accesibilidad', async () => {\r\n      const { container } = render(\r\n        <EmailTagsManager\r\n          emailTags={[]}\r\n          allTags={[\r\n            { id: 'tag1', name: 'Urgente', color: '#ff0000', systemTag: true },\r\n            { id: 'tag2', name: 'Proveedores', color: '#00ff00', systemTag: false }\r\n          ]}\r\n          onAddTag={vi.fn()}\r\n          onRemoveTag={vi.fn()}\r\n        />,\r\n        { wrapper: TestWrapper }\r\n      );\r\n\r\n      const results = await axe(container);\r\n      expect(results).toHaveNoViolations();\r\n    });\r\n\r\n    it('las etiquetas deben tener suficiente contraste de color', () => {\r\n      render(\r\n        <EmailTagsManager\r\n          emailTags={[{ id: 'tag1', name: 'Urgente', color: '#ff0000', systemTag: true }]}\r\n          allTags={[\r\n            { id: 'tag1', name: 'Urgente', color: '#ff0000', systemTag: true },\r\n            { id: 'tag2', name: 'Proveedores', color: '#00ff00', systemTag: false }\r\n          ]}\r\n          onAddTag={vi.fn()}\r\n          onRemoveTag={vi.fn()}\r\n        />,\r\n        { wrapper: TestWrapper }\r\n      );\r\n\r\n      // Verificar que la etiqueta se renderiza\r\n      const tag = screen.getByText('Urgente');\r\n      expect(tag).toBeInTheDocument();\r\n      \r\n      // La validaci√≥n de contraste real se har√° mediante axe en el test anterior\r\n    });\r\n  });\r\n\r\n  describe('TagsManager - Accesibilidad', () => {\r\n    it('no debe tener violaciones de accesibilidad', async () => {\r\n      const { container } = render(\r\n        <TagsManager />,\r\n        { wrapper: TestWrapper }\r\n      );\r\n\r\n      const results = await axe(container);\r\n      expect(results).toHaveNoViolations();\r\n    });\r\n\r\n    it('el formulario de creaci√≥n de etiquetas debe ser accesible', async () => {\r\n      render(\r\n        <TagsManager />,\r\n        { wrapper: TestWrapper }\r\n      );\r\n\r\n      // Verificar que el bot√≥n para crear una nueva etiqueta es accesible\r\n      const newTagButton = screen.getByRole('button', { name: /nueva etiqueta/i });\r\n      expect(newTagButton).toBeInTheDocument();\r\n      \r\n      // La validaci√≥n completa de accesibilidad se har√° mediante axe en el test anterior\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\accessibility\\email-viewer.a11y.test.jsx","messages":[{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":13,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":13,"endColumn":3},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":28,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":28,"endColumn":3},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":94,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":94,"endColumn":7},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":106,"column":20,"nodeType":"Identifier","messageId":"undef","endLine":106,"endColumn":22},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":107,"column":22,"nodeType":"Identifier","messageId":"undef","endLine":107,"endColumn":24},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":108,"column":21,"nodeType":"Identifier","messageId":"undef","endLine":108,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":109,"column":28,"nodeType":"Identifier","messageId":"undef","endLine":109,"endColumn":30},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":122,"column":20,"nodeType":"Identifier","messageId":"undef","endLine":122,"endColumn":22},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":123,"column":22,"nodeType":"Identifier","messageId":"undef","endLine":123,"endColumn":24},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":124,"column":21,"nodeType":"Identifier","messageId":"undef","endLine":124,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":125,"column":28,"nodeType":"Identifier","messageId":"undef","endLine":125,"endColumn":30},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":141,"column":20,"nodeType":"Identifier","messageId":"undef","endLine":141,"endColumn":22},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":142,"column":22,"nodeType":"Identifier","messageId":"undef","endLine":142,"endColumn":24},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":143,"column":21,"nodeType":"Identifier","messageId":"undef","endLine":143,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":144,"column":28,"nodeType":"Identifier","messageId":"undef","endLine":144,"endColumn":30},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":163,"column":20,"nodeType":"Identifier","messageId":"undef","endLine":163,"endColumn":22},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":164,"column":22,"nodeType":"Identifier","messageId":"undef","endLine":164,"endColumn":24},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":165,"column":21,"nodeType":"Identifier","messageId":"undef","endLine":165,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":166,"column":28,"nodeType":"Identifier","messageId":"undef","endLine":166,"endColumn":30},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":186,"column":26,"nodeType":"Identifier","messageId":"undef","endLine":186,"endColumn":28},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":188,"column":26,"nodeType":"Identifier","messageId":"undef","endLine":188,"endColumn":28},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":189,"column":28,"nodeType":"Identifier","messageId":"undef","endLine":189,"endColumn":30},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":202,"column":26,"nodeType":"Identifier","messageId":"undef","endLine":202,"endColumn":28},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":204,"column":26,"nodeType":"Identifier","messageId":"undef","endLine":204,"endColumn":28},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":205,"column":28,"nodeType":"Identifier","messageId":"undef","endLine":205,"endColumn":30},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":225,"column":26,"nodeType":"Identifier","messageId":"undef","endLine":225,"endColumn":28},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":227,"column":26,"nodeType":"Identifier","messageId":"undef","endLine":227,"endColumn":28},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":228,"column":28,"nodeType":"Identifier","messageId":"undef","endLine":228,"endColumn":30},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":248,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":248,"endColumn":29},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":249,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":249,"endColumn":29},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":250,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":250,"endColumn":29},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":264,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":264,"endColumn":29},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":265,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":265,"endColumn":29},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":266,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":266,"endColumn":29},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":281,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":281,"endColumn":29},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":282,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":282,"endColumn":29},{"ruleId":"no-undef","severity":2,"message":"'vi' is not defined.","line":283,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":283,"endColumn":29}],"suppressedMessages":[],"errorCount":37,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, beforeEach, afterEach } from 'vitest';\r\nimport { render, screen, cleanup } from '@testing-library/react';\r\nimport { axe, toHaveNoViolations } from 'jest-axe';\r\nimport { BrowserRouter } from 'react-router-dom';\r\nimport EmailView from '../../components/email/EmailView';\r\nimport EmailList from '../../components/email/EmailList';\r\nimport EmailFolderList from '../../components/email/EmailFolderList';\r\n\r\n// Extender las utilidades de prueba con el matcher de axe\r\nexpect.extend(toHaveNoViolations);\r\n\r\n// Mock de hooks y servicios\r\nvi.mock('../../hooks/useAuth', () => ({\r\n  default: () => ({\r\n    currentUser: { uid: 'testuid' },\r\n    profile: {\r\n      id: 'profile123',\r\n      userId: 'user123',\r\n      brideFirstName: 'Mar√≠a',\r\n      brideLastName: 'Garc√≠a',\r\n      emailAlias: 'maria.garcia'\r\n    },\r\n    isAuthenticated: true\r\n  })\r\n}));\r\n\r\n// Mock de componentes visuales\r\nvi.mock('lucide-react', () => ({\r\n  Trash: () => <div data-testid=\"trash-icon\">√ó</div>,\r\n  Reply: () => <div data-testid=\"reply-icon\">‚Ü©</div>,\r\n  Forward: () => <div data-testid=\"forward-icon\">‚Üí</div>,\r\n  Star: () => <div data-testid=\"star-icon\">‚òÖ</div>,\r\n  Download: () => <div data-testid=\"download-icon\">‚Üì</div>,\r\n  Mail: () => <div data-testid=\"mail-icon\">‚úâ</div>,\r\n  Archive: () => <div data-testid=\"archive-icon\">üì¶</div>,\r\n  Inbox: () => <div data-testid=\"inbox-icon\">üì•</div>,\r\n  Send: () => <div data-testid=\"sent-icon\">üì§</div>,\r\n  Folder: () => <div data-testid=\"folder-icon\">üìÅ</div>,\r\n  Plus: () => <div data-testid=\"plus-icon\">+</div>\r\n}));\r\n\r\n// Datos de ejemplo\r\nconst mockEmail = {\r\n  id: 'email123',\r\n  from: 'proveedor@florista.com',\r\n  to: 'maria.garcia@lovenda.com',\r\n  subject: 'Presupuesto de flores para boda',\r\n  body: '<p>Estimada Mar√≠a,</p><p>Adjunto el presupuesto para las flores de tu boda.</p><p>Saludos cordiales,<br/>Floristas Bella</p>',\r\n  attachments: [{\r\n    name: 'presupuesto.pdf',\r\n    url: 'https://example.com/presupuesto.pdf',\r\n    size: 1024\r\n  }],\r\n  timestamp: new Date(),\r\n  read: false,\r\n  starred: false,\r\n  folder: 'inbox',\r\n  tags: ['tag1']\r\n};\r\n\r\nconst mockEmails = [\r\n  mockEmail,\r\n  {\r\n    id: 'email456',\r\n    from: 'fotografia@capturamos.com',\r\n    to: 'maria.garcia@lovenda.com',\r\n    subject: 'Cat√°logo de fotos',\r\n    body: '<p>Hola Mar√≠a,</p><p>Te enviamos nuestro cat√°logo de fotograf√≠as.</p>',\r\n    attachments: [],\r\n    timestamp: new Date(),\r\n    read: true,\r\n    starred: true,\r\n    folder: 'inbox',\r\n    tags: ['tag2']\r\n  }\r\n];\r\n\r\nconst mockFolders = [\r\n  { id: 'inbox', name: 'Bandeja de entrada', systemFolder: true, count: 2 },\r\n  { id: 'sent', name: 'Enviados', systemFolder: true, count: 1 },\r\n  { id: 'trash', name: 'Papelera', systemFolder: true, count: 0 },\r\n  { id: 'proveedores', name: 'Proveedores', systemFolder: false, count: 3 }\r\n];\r\n\r\n// Wrapper para los componentes\r\nconst TestWrapper = ({ children }) => (\r\n  <BrowserRouter>\r\n    {children}\r\n  </BrowserRouter>\r\n);\r\n\r\ndescribe('Pruebas de accesibilidad para visualizaci√≥n de correos', () => {\r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n  });\r\n\r\n  afterEach(() => {\r\n    cleanup();\r\n  });\r\n\r\n  describe('EmailView - Accesibilidad', () => {\r\n    it('no debe tener violaciones de accesibilidad', async () => {\r\n      const { container } = render(\r\n        <EmailView \r\n          email={mockEmail}\r\n          onReply={vi.fn()}\r\n          onForward={vi.fn()}\r\n          onDelete={vi.fn()}\r\n          onToggleStarred={vi.fn()}\r\n        />,\r\n        { wrapper: TestWrapper }\r\n      );\r\n\r\n      const results = await axe(container);\r\n      expect(results).toHaveNoViolations();\r\n    });\r\n\r\n    it('debe tener im√°genes con texto alternativo', () => {\r\n      render(\r\n        <EmailView \r\n          email={mockEmail}\r\n          onReply={vi.fn()}\r\n          onForward={vi.fn()}\r\n          onDelete={vi.fn()}\r\n          onToggleStarred={vi.fn()}\r\n        />,\r\n        { wrapper: TestWrapper }\r\n      );\r\n\r\n      // Verificar que los iconos tienen texto alternativo\r\n      const images = screen.getAllByRole('img');\r\n      images.forEach(img => {\r\n        expect(img).toHaveAttribute('alt');\r\n      });\r\n    });\r\n\r\n    it('debe tener botones con prop√≥sitos claros', () => {\r\n      render(\r\n        <EmailView \r\n          email={mockEmail}\r\n          onReply={vi.fn()}\r\n          onForward={vi.fn()}\r\n          onDelete={vi.fn()}\r\n          onToggleStarred={vi.fn()}\r\n        />,\r\n        { wrapper: TestWrapper }\r\n      );\r\n\r\n      // Verificar que los botones tienen textos o aria-labels descriptivos\r\n      const buttons = screen.getAllByRole('button');\r\n      buttons.forEach(button => {\r\n        expect(\r\n          button.textContent || \r\n          button.getAttribute('aria-label')\r\n        ).toBeTruthy();\r\n      });\r\n    });\r\n\r\n    it('los enlaces para descargar deben ser accesibles', () => {\r\n      render(\r\n        <EmailView \r\n          email={mockEmail}\r\n          onReply={vi.fn()}\r\n          onForward={vi.fn()}\r\n          onDelete={vi.fn()}\r\n          onToggleStarred={vi.fn()}\r\n        />,\r\n        { wrapper: TestWrapper }\r\n      );\r\n\r\n      // Verificar que hay un enlace para el archivo adjunto\r\n      const downloadLinks = screen.getAllByRole('link');\r\n      expect(downloadLinks.length).toBeGreaterThan(0);\r\n      \r\n      // Verificar que tiene texto descriptivo\r\n      const attachmentLink = screen.getByText('presupuesto.pdf');\r\n      expect(attachmentLink).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  describe('EmailList - Accesibilidad', () => {\r\n    it('no debe tener violaciones de accesibilidad', async () => {\r\n      const { container } = render(\r\n        <EmailList \r\n          emails={mockEmails}\r\n          onSelectEmail={vi.fn()}\r\n          selectedEmail={null}\r\n          onDeleteEmail={vi.fn()}\r\n          onToggleStarred={vi.fn()}\r\n        />,\r\n        { wrapper: TestWrapper }\r\n      );\r\n\r\n      const results = await axe(container);\r\n      expect(results).toHaveNoViolations();\r\n    });\r\n\r\n    it('los elementos de la lista deben ser navegables por teclado', () => {\r\n      render(\r\n        <EmailList \r\n          emails={mockEmails}\r\n          onSelectEmail={vi.fn()}\r\n          selectedEmail={null}\r\n          onDeleteEmail={vi.fn()}\r\n          onToggleStarred={vi.fn()}\r\n        />,\r\n        { wrapper: TestWrapper }\r\n      );\r\n\r\n      // Verificar que los elementos de la lista son interactivos\r\n      const listItems = screen.getAllByRole('listitem');\r\n      expect(listItems.length).toBeGreaterThan(0);\r\n      \r\n      // Verificar que tienen elementos enfocables\r\n      listItems.forEach(item => {\r\n        const interactiveElements = item.querySelectorAll('button, a, [tabindex=\"0\"]');\r\n        expect(interactiveElements.length).toBeGreaterThan(0);\r\n      });\r\n    });\r\n\r\n    it('debe indicar cu√°les correos est√°n no le√≠dos de forma accesible', () => {\r\n      render(\r\n        <EmailList \r\n          emails={mockEmails}\r\n          onSelectEmail={vi.fn()}\r\n          selectedEmail={null}\r\n          onDeleteEmail={vi.fn()}\r\n          onToggleStarred={vi.fn()}\r\n        />,\r\n        { wrapper: TestWrapper }\r\n      );\r\n      \r\n      // La implementaci√≥n depende de c√≥mo se indiquen visualmente los correos no le√≠dos\r\n      // pero deber√≠a ser perceptible no solo por color sino por alg√∫n otro indicador\r\n      \r\n      // Asumimos que hay alg√∫n elemento que tiene una clase o atributo para correos no le√≠dos\r\n      const unreadItems = screen.getAllByText(/Presupuesto de flores/i);\r\n      expect(unreadItems.length).toBeGreaterThan(0);\r\n    });\r\n  });\r\n\r\n  describe('EmailFolderList - Accesibilidad', () => {\r\n    it('no debe tener violaciones de accesibilidad', async () => {\r\n      const { container } = render(\r\n        <EmailFolderList \r\n          folders={mockFolders}\r\n          selectedFolder=\"inbox\"\r\n          onSelectFolder={vi.fn()}\r\n          onCreateFolder={vi.fn()}\r\n          onDeleteFolder={vi.fn()}\r\n        />,\r\n        { wrapper: TestWrapper }\r\n      );\r\n\r\n      const results = await axe(container);\r\n      expect(results).toHaveNoViolations();\r\n    });\r\n\r\n    it('debe indicar claramente la carpeta seleccionada', () => {\r\n      render(\r\n        <EmailFolderList \r\n          folders={mockFolders}\r\n          selectedFolder=\"inbox\"\r\n          onSelectFolder={vi.fn()}\r\n          onCreateFolder={vi.fn()}\r\n          onDeleteFolder={vi.fn()}\r\n        />,\r\n        { wrapper: TestWrapper }\r\n      );\r\n      \r\n      // Verificar que se indica la carpeta seleccionada (puede ser via aria-current)\r\n      const selectedItem = screen.getByText('Bandeja de entrada');\r\n      expect(selectedItem.parentElement).toHaveAttribute('aria-current', 'true');\r\n    });\r\n\r\n    it('el bot√≥n de crear carpeta debe ser accesible', () => {\r\n      render(\r\n        <EmailFolderList \r\n          folders={mockFolders}\r\n          selectedFolder=\"inbox\"\r\n          onSelectFolder={vi.fn()}\r\n          onCreateFolder={vi.fn()}\r\n          onDeleteFolder={vi.fn()}\r\n        />,\r\n        { wrapper: TestWrapper }\r\n      );\r\n      \r\n      // Verificar que hay un bot√≥n para crear carpeta y es accesible\r\n      const newFolderButton = screen.getByRole('button', { name: /nueva carpeta/i });\r\n      expect(newFolderButton).toBeInTheDocument();\r\n      expect(newFolderButton).not.toHaveAttribute('disabled');\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\components\\Button.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\components\\SmartEmailComposer.test.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'fireEvent' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":35},{"ruleId":"no-unused-vars","severity":1,"message":"'within' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":43},{"ruleId":"no-unused-vars","severity":1,"message":"'waitFor' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":52},{"ruleId":"no-unused-vars","severity":1,"message":"'EmailRecommendationService' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":34},{"ruleId":"no-unused-vars","severity":1,"message":"'category' is defined but never used. Allowed unused args must match /^_/u.","line":32,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'searchQuery' is defined but never used. Allowed unused args must match /^_/u.","line":32,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":32,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest';\r\nimport { render, screen, fireEvent, within, waitFor } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport SmartEmailComposer from '../../components/email/SmartEmailComposer';\r\nimport EmailRecommendationService from '../../services/EmailRecommendationService';\r\n\r\n// Mock del servicio de recomendaciones\r\nvi.mock('../../services/EmailRecommendationService', () => {\r\n  return {\r\n    default: vi.fn().mockImplementation(() => ({\r\n      generateRecommendations: vi.fn().mockReturnValue({\r\n        bestTimeToSend: {\r\n          bestTimeSlot: 'morning',\r\n          bestTimeSlotName: 'ma√±ana (8-12h)',\r\n          bestRate: '75.0'\r\n        },\r\n        subjectLineRecommendations: {\r\n          recommendedPatterns: ['Consulta sobre [Servicio] para evento el [Fecha]']\r\n        },\r\n        templateRecommendations: {\r\n          bestOverallTemplate: 'fotograf√≠a'\r\n        },\r\n        confidenceScore: 85\r\n      }),\r\n      markRecommendationAsApplied: vi.fn()\r\n    }))\r\n  };\r\n});\r\n\r\n// Mock del componente EmailRecommendationsPanel\r\nvi.mock('../../components/email/EmailRecommendationsPanel', () => ({\r\n  default: ({ category, searchQuery, onApplyRecommendation }) => (\r\n    <div data-testid=\"recommendations-panel\">\r\n      <button \r\n        data-testid=\"apply-subject-recommendation\"\r\n        onClick={() => onApplyRecommendation('subject', 'Consulta sobre [Servicio] para evento el [Fecha]')}\r\n      >\r\n        Aplicar recomendaci√≥n de asunto\r\n      </button>\r\n      <button \r\n        data-testid=\"apply-template-recommendation\"\r\n        onClick={() => onApplyRecommendation('template', 'fotograf√≠a')}\r\n      >\r\n        Aplicar recomendaci√≥n de plantilla\r\n      </button>\r\n      <button \r\n        data-testid=\"apply-time-recommendation\"\r\n        onClick={() => onApplyRecommendation('time', { bestTimeSlot: 'morning' })}\r\n      >\r\n        Aplicar recomendaci√≥n de hora\r\n      </button>\r\n    </div>\r\n  )\r\n}));\r\n\r\ndescribe('SmartEmailComposer', () => {\r\n  const mockProvider = {\r\n    id: 'provider-1',\r\n    name: 'Fot√≥grafo Test',\r\n    email: 'fotografo@test.com',\r\n    service: 'fotograf√≠a'\r\n  };\r\n  \r\n  const mockTemplates = [\r\n    {\r\n      id: 'template-1',\r\n      name: 'Fotograf√≠a General',\r\n      category: 'fotograf√≠a',\r\n      subjectTemplate: 'Consulta sobre [Servicio] con [Proveedor]',\r\n      messageTemplate: 'Hola [Proveedor], estoy interesado en contratar servicios de [Servicio] para mi evento.'\r\n    },\r\n    {\r\n      id: 'template-2',\r\n      name: 'Catering General',\r\n      category: 'catering',\r\n      subjectTemplate: 'Servicios de [Servicio] para evento',\r\n      messageTemplate: 'Hola [Proveedor], me gustar√≠a recibir informaci√≥n sobre sus servicios de [Servicio].'\r\n    }\r\n  ];\r\n  \r\n  const mockOnSend = vi.fn();\r\n  const mockOnCancel = vi.fn();\r\n  \r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n  });\r\n  \r\n  it('debe renderizarse correctamente', () => {\r\n    render(\r\n      <SmartEmailComposer \r\n        provider={mockProvider}\r\n        searchQuery=\"fotograf√≠a boda madrid\"\r\n        onSend={mockOnSend}\r\n        onCancel={mockOnCancel}\r\n        templates={mockTemplates}\r\n      />\r\n    );\r\n    \r\n    // Verificar elementos principales\r\n    expect(screen.getByText('Redactar Correo')).toBeInTheDocument();\r\n    expect(screen.getByText(/a Fot√≥grafo Test/)).toBeInTheDocument();\r\n    expect(screen.getByLabelText('Asunto')).toBeInTheDocument();\r\n    expect(screen.getByLabelText('Mensaje')).toBeInTheDocument();\r\n  });\r\n  \r\n  it('debe cargar una plantilla inicial basada en la categor√≠a del proveedor', () => {\r\n    render(\r\n      <SmartEmailComposer \r\n        provider={mockProvider}\r\n        templates={mockTemplates}\r\n        onSend={mockOnSend}\r\n      />\r\n    );\r\n    \r\n    // Verificar que se carg√≥ la plantilla de fotograf√≠a\r\n    const asuntoInput = screen.getByLabelText('Asunto');\r\n    const mensajeInput = screen.getByLabelText('Mensaje');\r\n    \r\n    expect(asuntoInput.value).toBe('Consulta sobre fotograf√≠a con Fot√≥grafo Test');\r\n    expect(mensajeInput.value).toContain('Hola Fot√≥grafo Test, estoy interesado');\r\n    expect(mensajeInput.value).toContain('servicios de fotograf√≠a');\r\n  });\r\n  \r\n  it('debe mostrar/ocultar el panel de recomendaciones al hacer clic en el bot√≥n', async () => {\r\n    const user = userEvent.setup();\r\n    \r\n    render(\r\n      <SmartEmailComposer \r\n        provider={mockProvider}\r\n        templates={mockTemplates}\r\n        onSend={mockOnSend}\r\n      />\r\n    );\r\n    \r\n    // Por defecto el panel no deber√≠a estar visible\r\n    expect(screen.queryByTestId('recommendations-panel')).not.toBeInTheDocument();\r\n    \r\n    // Hacer clic en el bot√≥n de recomendaciones\r\n    const toggleButton = screen.getByRole('button', { name: /mostrar recomendaciones/i });\r\n    await user.click(toggleButton);\r\n    \r\n    // Verificar que ahora est√° visible\r\n    expect(screen.getByTestId('recommendations-panel')).toBeInTheDocument();\r\n    \r\n    // Hacer clic nuevamente para ocultar\r\n    await user.click(toggleButton);\r\n    \r\n    // Verificar que se ha ocultado\r\n    expect(screen.queryByTestId('recommendations-panel')).not.toBeInTheDocument();\r\n  });\r\n  \r\n  it('debe aplicar recomendaci√≥n de asunto', async () => {\r\n    const user = userEvent.setup();\r\n    \r\n    render(\r\n      <SmartEmailComposer \r\n        provider={mockProvider}\r\n        templates={mockTemplates}\r\n        onSend={mockOnSend}\r\n      />\r\n    );\r\n    \r\n    // Mostrar panel de recomendaciones\r\n    const toggleButton = screen.getByRole('button', { name: /mostrar recomendaciones/i });\r\n    await user.click(toggleButton);\r\n    \r\n    // Aplicar recomendaci√≥n de asunto\r\n    const applySubjectBtn = screen.getByTestId('apply-subject-recommendation');\r\n    await user.click(applySubjectBtn);\r\n    \r\n    // Verificar que se aplic√≥ la recomendaci√≥n\r\n    const asuntoInput = screen.getByLabelText('Asunto');\r\n    expect(asuntoInput.value).toBe('Consulta sobre fotograf√≠a para evento el pr√≥ximamente');\r\n    \r\n    // Verificar que se muestra mensaje de feedback\r\n    expect(screen.getByText('L√≠nea de asunto actualizada con la recomendaci√≥n')).toBeInTheDocument();\r\n  });\r\n  \r\n  it('debe aplicar recomendaci√≥n de plantilla', async () => {\r\n    const user = userEvent.setup();\r\n    \r\n    render(\r\n      <SmartEmailComposer \r\n        provider={mockProvider}\r\n        templates={mockTemplates}\r\n        onSend={mockOnSend}\r\n      />\r\n    );\r\n    \r\n    // Mostrar panel de recomendaciones\r\n    const toggleButton = screen.getByRole('button', { name: /mostrar recomendaciones/i });\r\n    await user.click(toggleButton);\r\n    \r\n    // Aplicar recomendaci√≥n de plantilla\r\n    const applyTemplateBtn = screen.getByTestId('apply-template-recommendation');\r\n    await user.click(applyTemplateBtn);\r\n    \r\n    // Verificar que se muestra mensaje de feedback\r\n    expect(screen.getByText(/Plantilla \".*\" aplicada/)).toBeInTheDocument();\r\n  });\r\n  \r\n  it('debe programar el env√≠o para un horario recomendado', async () => {\r\n    const user = userEvent.setup();\r\n    \r\n    render(\r\n      <SmartEmailComposer \r\n        provider={mockProvider}\r\n        templates={mockTemplates}\r\n        onSend={mockOnSend}\r\n      />\r\n    );\r\n    \r\n    // Mostrar panel de recomendaciones\r\n    const toggleButton = screen.getByRole('button', { name: /mostrar recomendaciones/i });\r\n    await user.click(toggleButton);\r\n    \r\n    // Aplicar recomendaci√≥n de horario\r\n    const applyTimeBtn = screen.getByTestId('apply-time-recommendation');\r\n    await user.click(applyTimeBtn);\r\n    \r\n    // Verificar que se muestra mensaje de feedback\r\n    expect(screen.getByText(/Correo programado para ma√±ana/)).toBeInTheDocument();\r\n    \r\n    // Verificar que hay una fecha programada\r\n    const programarInput = screen.getByLabelText(/datetime-local/i);\r\n    expect(programarInput.value).not.toBe('');\r\n  });\r\n  \r\n  it('debe mostrar error al intentar enviar sin asunto o mensaje', async () => {\r\n    const user = userEvent.setup();\r\n    \r\n    render(\r\n      <SmartEmailComposer \r\n        provider={mockProvider}\r\n        onSend={mockOnSend}\r\n      />\r\n    );\r\n    \r\n    // Limpiar campos\r\n    const asuntoInput = screen.getByLabelText('Asunto');\r\n    const mensajeInput = screen.getByLabelText('Mensaje');\r\n    \r\n    await user.clear(asuntoInput);\r\n    await user.clear(mensajeInput);\r\n    \r\n    // Intentar enviar\r\n    const enviarBtn = screen.getByRole('button', { name: /enviar/i });\r\n    await user.click(enviarBtn);\r\n    \r\n    // Verificar mensaje de error\r\n    expect(screen.getByText('Por favor, completa el asunto y el mensaje antes de enviar.')).toBeInTheDocument();\r\n    expect(mockOnSend).not.toHaveBeenCalled();\r\n  });\r\n  \r\n  it('debe enviar el correo con los datos correctos', async () => {\r\n    const user = userEvent.setup();\r\n    \r\n    render(\r\n      <SmartEmailComposer \r\n        provider={mockProvider}\r\n        searchQuery=\"fotograf√≠a boda\"\r\n        templates={mockTemplates}\r\n        onSend={mockOnSend}\r\n      />\r\n    );\r\n    \r\n    // Editar campos\r\n    const asuntoInput = screen.getByLabelText('Asunto');\r\n    const mensajeInput = screen.getByLabelText('Mensaje');\r\n    \r\n    await user.clear(asuntoInput);\r\n    await user.clear(mensajeInput);\r\n    \r\n    await user.type(asuntoInput, 'Asunto de prueba');\r\n    await user.type(mensajeInput, 'Mensaje de prueba');\r\n    \r\n    // Enviar correo\r\n    const enviarBtn = screen.getByRole('button', { name: /enviar/i });\r\n    await user.click(enviarBtn);\r\n    \r\n    // Verificar que se llam√≥ a onSend con los datos correctos\r\n    expect(mockOnSend).toHaveBeenCalledTimes(1);\r\n    expect(mockOnSend).toHaveBeenCalledWith(\r\n      expect.objectContaining({\r\n        to: 'fotografo@test.com',\r\n        subject: 'Asunto de prueba',\r\n        message: 'Mensaje de prueba',\r\n        provider: mockProvider,\r\n        searchQuery: 'fotograf√≠a boda'\r\n      })\r\n    );\r\n  });\r\n  \r\n  it('debe cambiar entre programar y enviar seg√∫n haya fecha programada', async () => {\r\n    const user = userEvent.setup();\r\n    \r\n    render(\r\n      <SmartEmailComposer \r\n        provider={mockProvider}\r\n        templates={mockTemplates}\r\n        onSend={mockOnSend}\r\n      />\r\n    );\r\n    \r\n    // Por defecto deber√≠a mostrar \"Enviar\"\r\n    let enviarBtn = screen.getByRole('button', { name: /enviar/i });\r\n    expect(enviarBtn).toBeInTheDocument();\r\n    \r\n    // Configurar una fecha programada\r\n    const tomorrow = new Date();\r\n    tomorrow.setDate(tomorrow.getDate() + 1);\r\n    const dateString = tomorrow.toISOString().substring(0, 16);\r\n    \r\n    const programarInput = screen.getByLabelText(/datetime-local/i);\r\n    await user.type(programarInput, dateString);\r\n    \r\n    // Ahora deber√≠a mostrar \"Programar\"\r\n    enviarBtn = screen.getByRole('button', { name: /programar/i });\r\n    expect(enviarBtn).toBeInTheDocument();\r\n    \r\n    // Limpiar fecha\r\n    const limpiarBtn = screen.getByRole('button', { name: /limpiar/i });\r\n    await user.click(limpiarBtn);\r\n    \r\n    // Volver a mostrar \"Enviar\"\r\n    enviarBtn = screen.getByRole('button', { name: /enviar/i });\r\n    expect(enviarBtn).toBeInTheDocument();\r\n  });\r\n  \r\n  it('debe llamar a onCancel cuando se hace clic en cancelar', async () => {\r\n    const user = userEvent.setup();\r\n    \r\n    render(\r\n      <SmartEmailComposer \r\n        provider={mockProvider}\r\n        templates={mockTemplates}\r\n        onSend={mockOnSend}\r\n        onCancel={mockOnCancel}\r\n      />\r\n    );\r\n    \r\n    const cancelarBtn = screen.getByRole('button', { name: /cancelar/i });\r\n    await user.click(cancelarBtn);\r\n    \r\n    expect(mockOnCancel).toHaveBeenCalledTimes(1);\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\components\\email\\EmailDetail.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\components\\email\\EmailInbox.test.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'mockFolders' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":79,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":79,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'useAuth' is not defined.","line":88,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":88,"endColumn":12},{"ruleId":"no-undef","severity":2,"message":"'EmailService' is not defined.","line":98,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":98,"endColumn":17},{"ruleId":"no-undef","severity":2,"message":"'EmailService' is not defined.","line":99,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":99,"endColumn":17},{"ruleId":"no-undef","severity":2,"message":"'EmailService' is not defined.","line":112,"column":14,"nodeType":"Identifier","messageId":"undef","endLine":112,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'EmailService' is not defined.","line":140,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":140,"endColumn":17},{"ruleId":"no-undef","severity":2,"message":"'EmailService' is not defined.","line":165,"column":14,"nodeType":"Identifier","messageId":"undef","endLine":165,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'EmailService' is not defined.","line":166,"column":14,"nodeType":"Identifier","messageId":"undef","endLine":166,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'EmailService' is not defined.","line":171,"column":14,"nodeType":"Identifier","messageId":"undef","endLine":171,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'EmailService' is not defined.","line":190,"column":14,"nodeType":"Identifier","messageId":"undef","endLine":190,"endColumn":26},{"ruleId":"no-undef","severity":2,"message":"'EmailService' is not defined.","line":249,"column":5,"nodeType":"Identifier","messageId":"undef","endLine":249,"endColumn":17}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\n// Mocks necesarios - deben declararse antes de importar el componente\nvi.mock('../../../hooks/useAuth', () => ({\n  useAuth: vi.fn()\n}));\n\nvi.mock('../../../services/EmailService', () => ({\n  initEmailService: vi.fn(),\n  getMails: vi.fn(),\n  deleteMail: vi.fn(),\n  markAsRead: vi.fn(),\n  sendMail: vi.fn()\n}));\n\n// Mock para los componentes que no necesitamos probar en detalle\nvi.mock('../../../components/email/EmailDetail', () => ({\n  default: ({ email, onBack }) => (\n    <div data-testid=\"email-detail\">\n      {email && (\n        <>\n          <div data-testid=\"email-subject\">{email.subject}</div>\n          <button onClick={onBack}>Volver</button>\n        </>\n      )}\n    </div>\n  )\n}));\n\nvi.mock('../../../components/Card', () => ({\n  default: ({ children }) => <div data-testid=\"card\">{children}</div>\n}));\n\nvi.mock('../../../components/Button', () => ({\n\n  default: ({ children, onClick, ...props }) => (\n    <button onClick={onClick} {...props}>{children}</button>\n  )\n}));\n\nimport EmailInbox from '../../../components/email/EmailInbox';\n\ndescribe('EmailInbox Component', () => {\n  // Datos de ejemplo para las pruebas\n  const mockEmails = [\n    { \n      id: 'email-1', \n      subject: 'Asunto importante', \n      from: 'remitente@ejemplo.com',\n      to: 'usuario@lovenda.app',\n      date: '2025-07-10T10:30:00Z',\n      read: false,\n      folder: 'inbox',\n      attachments: []\n    },\n    { \n      id: 'email-2', \n      subject: 'Recordatorio reuni√≥n', \n      from: 'team@empresa.com',\n      to: 'usuario@lovenda.app',\n      date: '2025-07-09T08:15:00Z',\n      read: true,\n      folder: 'inbox',\n      attachments: [{ filename: 'acta.pdf' }]\n    },\n    { \n      id: 'email-3', \n      subject: 'Borrador enviado', \n      from: 'usuario@lovenda.app',\n      to: 'destinatario@empresa.com',\n      date: '2025-07-08T14:45:00Z',\n      read: true,\n      folder: 'sent',\n      attachments: []\n    }\n  ];\n\n  const mockFolders = [\n    { id: 'folder-1', name: 'Importante' },\n    { id: 'folder-2', name: 'Trabajo' }\n  ];\n\n  beforeEach(() => {\n    vi.clearAllMocks();\n    \n    // Configurar el mock de autenticaci√≥n\n    useAuth.mockReturnValue({\n      user: { uid: 'user123' },\n      profile: { \n        id: 'profile123',\n        email: 'usuario@lovenda.app',\n        name: 'Usuario Test' \n      }\n    });\n    \n    // Configurar el mock de servicio de email\n    EmailService.getMails.mockResolvedValue(mockEmails);\n    EmailService.initEmailService.mockReturnValue('usuario@lovenda.app');\n  });\n\n  // Prueba de carga inicial\n  it('carga y muestra correctamente la lista de emails', async () => {\n    render(<EmailInbox />);\n    \n    // Verificar que muestra el estado de carga inicialmente\n    expect(screen.getByText(/cargando/i)).toBeInTheDocument();\n    \n    // Esperar a que se muestren los emails\n    await waitFor(() => {\n      expect(screen.queryByText(/cargando/i)).not.toBeInTheDocument();\n      expect(EmailService.getMails).toHaveBeenCalledWith('inbox');\n    });\n    \n    // Verificar que los emails se muestran correctamente\n    expect(screen.getByText('Asunto importante')).toBeInTheDocument();\n    expect(screen.getByText('Recordatorio reuni√≥n')).toBeInTheDocument();\n  });\n\n  // Prueba de b√∫squeda de emails\n  it('filtra emails correctamente al buscar', async () => {\n    render(<EmailInbox />);\n    \n    // Esperar a que carguen los emails\n    await waitFor(() => {\n      expect(screen.queryByText(/cargando/i)).not.toBeInTheDocument();\n    });\n    \n    // Buscar un t√©rmino espec√≠fico\n    const searchInput = screen.getByPlaceholderText(/buscar/i);\n    fireEvent.change(searchInput, { target: { value: 'importante' } });\n    \n    // Verificar que solo se muestra el email que coincide\n    expect(screen.getByText('Asunto importante')).toBeInTheDocument();\n    expect(screen.queryByText('Recordatorio reuni√≥n')).not.toBeInTheDocument();\n  });\n\n  // Prueba de selecci√≥n y acciones con emails\n  it('permite seleccionar emails y realizar acciones con ellos', async () => {\n    EmailService.deleteMail.mockResolvedValue(true);\n    \n    render(<EmailInbox />);\n    \n    // Esperar a que carguen los emails\n    await waitFor(() => {\n      expect(screen.queryByText(/cargando/i)).not.toBeInTheDocument();\n    });\n    \n    // Seleccionar un email\n    const emailCheckbox = screen.getAllByRole('checkbox')[1]; // El primero es \"Seleccionar todos\"\n    fireEvent.change(emailCheckbox, { target: { checked: true } });\n\n    // Esperar a que el estado se actualice y el bot√≥n se habilite\n    await waitFor(() => {\n      expect(emailCheckbox).toBeChecked();\n      expect(screen.getByText(/eliminar/i)).not.toBeDisabled();\n    });\n    \n    // Eliminar el email seleccionado\n    const deleteButton = screen.getByText(/eliminar/i);\n    fireEvent.click(deleteButton);\n    \n    // Verificar que se llama a la funci√≥n de eliminar\n    await waitFor(() => {\n      expect(EmailService.deleteMail).toHaveBeenCalledTimes(1);\n      expect(EmailService.deleteMail.mock.calls[0][0]).toBe('email-1');\n    }, { timeout: 2000 });\n    \n    // Verificar que se actualiza la lista\n    await waitFor(() => {\n      expect(EmailService.getMails).toHaveBeenCalledTimes(2);\n    });\n  });\n\n  // Prueba de cambio entre carpetas\n  it('cambia correctamente entre carpetas', async () => {\n    render(<EmailInbox />);\n    \n    // Esperar a que carguen los emails\n    await waitFor(() => {\n      expect(screen.queryByText(/cargando/i)).not.toBeInTheDocument();\n    });\n    \n    // Cambiar a la carpeta Enviados\n    const sentFolder = screen.getByText(/enviados/i);\n    fireEvent.click(sentFolder);\n    \n    // Verificar que se llama a getMails con la carpeta correcta\n    await waitFor(() => {\n      expect(EmailService.getMails).toHaveBeenCalledWith('sent');\n    });\n  });\n\n  // Prueba de ordenaci√≥n\n  it('cambia el orden de los emails al hacer clic en las cabeceras de columna', async () => {\n    render(<EmailInbox />);\n    \n    // Esperar a que carguen los emails\n    await waitFor(() => {\n      expect(screen.queryByText(/cargando/i)).not.toBeInTheDocument();\n    });\n    \n    // Ordenar por asunto\n    const subjectHeader = screen.getByRole('button', { name: /asunto/i });\n    fireEvent.click(subjectHeader);\n    \n    // Verificar el cambio de orden\n    const emailItems = screen.getAllByRole('row');\n    expect(emailItems[1]).toHaveTextContent('Asunto importante');\n    \n    // Cambiar el orden nuevamente\n    fireEvent.click(subjectHeader);\n    \n    // Verificar que el orden se invierte\n    expect(screen.getAllByRole('row')[1]).toHaveTextContent('Borrador enviado');\n  });\n\n  // Prueba de selecci√≥n de email para ver detalles\n  it('muestra los detalles de un email al hacer clic en √©l', async () => {\n    render(<EmailInbox />);\n    \n    // Esperar a que carguen los emails\n    await waitFor(() => {\n      expect(screen.queryByText(/cargando/i)).not.toBeInTheDocument();\n    });\n    \n    // Hacer clic en el primer email de la lista (ignorando la cabecera)\n    const emailRow = screen.getAllByRole('row')[1];\n    fireEvent.click(emailRow);\n    \n    // Esperar a que aparezca el detalle\n    const detail = await screen.findByTestId('email-detail');\n    expect(detail).toBeInTheDocument();\n    expect(await screen.findByTestId('email-subject')).toHaveTextContent('Asunto importante');\n    \n    // Volver a la lista\n    const backButton = screen.getByRole('button', { name: 'Volver' });\n    fireEvent.click(backButton);\n    \n    // Esperar a que el detalle desaparezca\n    await waitFor(() => {\n      expect(screen.queryByTestId('email-subject')).not.toBeInTheDocument();\n    });\n  });\n\n  // Prueba de manejo de errores\n  it.skip('muestra mensaje de error cuando falla la carga de emails', async () => {\n    // Simular un error en la carga\n    EmailService.getMails.mockRejectedValue(new Error('Error al cargar'));\n    \n    render(<EmailInbox />);\n    \n    // Esperar a que aparezca el mensaje de error (CI puede ser m√°s lento)\n    const errorNode = await screen.findByText(/no se pudieron cargar los emails/i, {}, { timeout: 4000 });\n    expect(errorNode).toBeInTheDocument();\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\components\\email\\FolderSelectionModal.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\components\\proveedores\\ai\\AIEmailModal.test.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useAIProviderEmail' is defined but never used. Allowed unused vars must match /^_/u.","line":33,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\n\n// --- Mocks globales de hooks ---\n// Mock del hook que genera y env√≠a emails IA\nconst mockSendEmail = vi.fn();\n\n// Necesitamos poder cambiar la respuesta del hook en cada test, por eso lo inicializamos vac√≠o\nlet hookReturn;\n\nvi.mock('../../../../hooks/useAIProviderEmail', () => ({\n  useAIProviderEmail: () => hookReturn,\n}));\n\n// Mock de autenticaci√≥n para evitar error del AuthProvider\nvi.mock('../../../../hooks/useAuth', () => ({\n  useAuth: () => ({ user: { uid: 'user123', email: 'usuario.test@lovenda.com' } }),\n}));\n\n// Mock del componente Alert para simplificar assertions\nvi.mock('../../../../components/Alert', () => ({\n  __esModule: true,\n  default: ({ type, title, message, children, 'data-testid': testId = `${type}-alert` }) => (\n    <div data-testid={testId}>\n      {title && <div>{title}</div>}\n      {message && <div>{message}</div>}\n      {children}\n    </div>\n  ),\n}));\n\nimport { useAIProviderEmail } from '../../../../hooks/useAIProviderEmail';\nimport AIEmailModal from '../../../../components/proveedores/ai/AIEmailModal';\n\nconst defaultAIResult = {\n  id: 1,\n  name: 'Fot√≥grafo Prueba',\n  service: 'Fotograf√≠a',\n  email: 'fotografo@prueba.com',\n  aiSummary: 'Este fot√≥grafo tiene un estilo moderno perfecto para bodas.',\n};\n\nconst baseHookState = {\n  userEmail: 'usuario.test@lovenda.com',\n  isSending: false,\n  error: null,\n  sendEmailFromAIResult: mockSendEmail,\n  generateAISubject: () =>\n    'Consulta sobre Fotograf√≠a para boda - Fot√≥grafo Prueba',\n  generateAIEmailBody: () => 'Cuerpo de email generado por IA',\n};\n\ndescribe('AIEmailModal', () => {\n  const onClose = vi.fn();\n\n  beforeEach(() => {\n    vi.clearAllMocks();\n    mockSendEmail.mockResolvedValue(true);\n    // Restablecer estado base del hook para cada prueba\n    hookReturn = { ...baseHookState };\n  });\n\n  const renderModal = (props = {}) =>\n    render(\n      <AIEmailModal\n        isOpen\n        aiResult={defaultAIResult}\n        searchQuery=\"fot√≥grafo estilo moderno para boda\"\n        onClose={onClose}\n        {...props}\n      />,\n    );\n\n  it('no renderiza nada cuando isOpen es false', () => {\n    const { container } = render(\n      <AIEmailModal\n        isOpen={false}\n        aiResult={defaultAIResult}\n        searchQuery=\"q\"\n        onClose={onClose}\n      />,\n    );\n    expect(container.firstChild).toBeNull();\n  });\n\n  it('muestra la informaci√≥n del proveedor y los campos precargados', () => {\n    renderModal();\n    expect(screen.getByText(/Contactar a Fot√≥grafo Prueba/i)).toBeInTheDocument();\n    expect(screen.getByText(/usuario.test@lovenda.com/i)).toBeInTheDocument();\n    expect(screen.getByText(/fotografo@prueba.com/i)).toBeInTheDocument();\n    expect(screen.getByTestId('email-subject')).toHaveValue(\n      'Consulta sobre Fotograf√≠a para boda - Fot√≥grafo Prueba',\n    );\n    expect(screen.getByTestId('email-body')).toHaveValue('Cuerpo de email generado por IA');\n  });\n\n  it('permite editar el asunto y cuerpo del email', () => {\n    renderModal();\n    const subjectInput = screen.getByTestId('email-subject');\n    const bodyInput = screen.getByTestId('email-body');\n\n    fireEvent.change(subjectInput, { target: { value: 'Nuevo asunto' } });\n    fireEvent.change(bodyInput, { target: { value: 'Nuevo cuerpo' } });\n\n    expect(subjectInput).toHaveValue('Nuevo asunto');\n    expect(bodyInput).toHaveValue('Nuevo cuerpo');\n  });\n\n  it('cierra el modal al pulsar el bot√≥n de cerrar', () => {\n    renderModal();\n    fireEvent.click(screen.getByTestId('close-modal-btn'));\n    expect(onClose).toHaveBeenCalledTimes(1);\n  });\n\n  it('env√≠a el email y muestra alerta de √©xito', async () => {\n    mockSendEmail.mockResolvedValueOnce(true);\n    renderModal();\n    fireEvent.click(screen.getByTestId('send-email-btn'));\n\n    expect(mockSendEmail).toHaveBeenCalledTimes(1);\n\n    await waitFor(() => {\n      expect(screen.getByTestId('success-alert')).toBeInTheDocument();\n    });\n  });\n\n  it('muestra alerta de error si hook reporta error', () => {\n    hookReturn = {\n      ...baseHookState,\n      error: 'Algo sali√≥ mal',\n    };\n    renderModal();\n    expect(screen.getByTestId('error-alert')).toBeInTheDocument();\n    // Se muestra el t√≠tulo fijo de la alerta\n    expect(screen.getAllByText(/Error al enviar el email/i).length).toBeGreaterThan(0);\n    // Y el mensaje que proviene del hook\n    expect(screen.getByText('Algo sali√≥ mal')).toBeInTheDocument();\n  });\n});\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\coverage\\coverage-report.js","messages":[{"ruleId":"no-const-assign","severity":2,"message":"'total' is constant.","line":176,"column":7,"nodeType":"Identifier","messageId":"const","endLine":176,"endColumn":12}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Script para generar y analizar informes de cobertura de c√≥digo\r\n * Este script puede ejecutarse despu√©s de las pruebas para analizar la cobertura\r\n */\r\n\r\n// Importamos el m√≥dulo fs para acceso a archivos\r\nconst fs = require('fs');\r\nconst path = require('path');\r\n\r\n// Funci√≥n para analizar los informes de cobertura\r\nfunction analyzeCoverage() {\r\n  console.log('Analizando informes de cobertura...');\r\n  \r\n  try {\r\n    // Ruta al informe JSON de cobertura (ajustar seg√∫n la configuraci√≥n de Vitest/Jest)\r\n    // Intentar localizar coverage-final.json autom√°ticamente\r\n    const coverageRoot = path.join(__dirname, '../../coverage');\r\n    let coverageFile = path.join(coverageRoot, 'coverage-final.json');\r\n\r\n    if (!fs.existsSync(coverageFile)) {\r\n      // Buscar en subdirectorios como v8/, istanbul/, etc.\r\n      const subdirs = fs.existsSync(coverageRoot)\r\n        ? fs.readdirSync(coverageRoot).filter((entry) => fs.statSync(path.join(coverageRoot, entry)).isDirectory())\r\n        : [];\r\n      for (const dir of subdirs) {\r\n        const candidate = path.join(coverageRoot, dir, 'coverage-final.json');\r\n        if (fs.existsSync(candidate)) {\r\n          coverageFile = candidate;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Verificar si finalmente se encontr√≥ el archivo\r\n    if (!fs.existsSync(coverageFile)) {\r\n      console.error('No se encontr√≥ coverage-final.json. Aseg√∫rate de ejecutar \"npm run test:coverage\" y que la configuraci√≥n de Vitest utiliza provider v8.');\r\n      return;\r\n    }\r\n    \r\n    // Leer y parsear el informe\r\n    const coverageData = JSON.parse(fs.readFileSync(coverageFile, 'utf8'));\r\n    \r\n    // Variables para estad√≠sticas\r\n    let totalStatements = 0;\r\n    let coveredStatements = 0;\r\n    let totalBranches = 0;\r\n    let coveredBranches = 0;\r\n    let totalFunctions = 0;\r\n    let coveredFunctions = 0;\r\n    let totalLines = 0;\r\n    let coveredLines = 0;\r\n    \r\n    // Componentes/archivos con baja cobertura\r\n    const lowCoverageFiles = [];\r\n    const untested = [];\r\n    \r\n    // Analizar cada archivo\r\n    Object.keys(coverageData).forEach(filePath => {\r\n      const fileData = coverageData[filePath];\r\n      \r\n      // Extraer m√©tricas de este archivo\r\n      const statements = countCoverage(fileData.s);\r\n      const branches = countCoverage(fileData.b);\r\n      const functions = countCoverage(fileData.f);\r\n      const lines = countCoverage(fileData.l);\r\n      \r\n      // Calcular porcentajes\r\n      const statementPct = calculatePercentage(statements.covered, statements.total);\r\n      const branchPct = calculatePercentage(branches.covered, branches.total);\r\n      const functionPct = calculatePercentage(functions.covered, functions.total);\r\n      const linePct = calculatePercentage(lines.covered, lines.total);\r\n      \r\n      // Sumar a los totales\r\n      totalStatements += statements.total;\r\n      coveredStatements += statements.covered;\r\n      totalBranches += branches.total;\r\n      coveredBranches += branches.covered;\r\n      totalFunctions += functions.total;\r\n      coveredFunctions += functions.covered;\r\n      totalLines += lines.total;\r\n      coveredLines += lines.covered;\r\n      \r\n      // Extraer nombre del archivo\r\n      const fileName = path.basename(filePath);\r\n      \r\n      // Verificar si tiene baja cobertura (menos del 70%)\r\n      if ((statementPct + branchPct + functionPct + linePct) / 4 < 70) {\r\n        lowCoverageFiles.push({\r\n          file: fileName,\r\n          path: filePath,\r\n          statementPct,\r\n          branchPct,\r\n          functionPct,\r\n          linePct,\r\n          overallPct: (statementPct + branchPct + functionPct + linePct) / 4\r\n        });\r\n      }\r\n      \r\n      // Verificar si no tiene pruebas\r\n      if (statements.covered === 0) {\r\n        untested.push(fileName);\r\n      }\r\n    });\r\n    \r\n    // Calcular porcentajes totales\r\n    const overallStatementPct = calculatePercentage(coveredStatements, totalStatements);\r\n    const overallBranchPct = calculatePercentage(coveredBranches, totalBranches);\r\n    const overallFunctionPct = calculatePercentage(coveredFunctions, totalFunctions);\r\n    const overallLinePct = calculatePercentage(coveredLines, totalLines);\r\n    \r\n    // Generar informe\r\n    console.log('\\n==================== INFORME DE COBERTURA ====================');\r\n    console.log(`Cobertura total: ${((overallStatementPct + overallBranchPct + overallFunctionPct + overallLinePct) / 4).toFixed(2)}%`);\r\n    console.log(`- Statements: ${overallStatementPct.toFixed(2)}% (${coveredStatements}/${totalStatements})`);\r\n    console.log(`- Branches: ${overallBranchPct.toFixed(2)}% (${coveredBranches}/${totalBranches})`);\r\n    console.log(`- Functions: ${overallFunctionPct.toFixed(2)}% (${coveredFunctions}/${totalFunctions})`);\r\n    console.log(`- Lines: ${overallLinePct.toFixed(2)}% (${coveredLines}/${totalLines})`);\r\n    \r\n    // Archivos con baja cobertura\r\n    console.log('\\nArchivos con baja cobertura:');\r\n    if (lowCoverageFiles.length === 0) {\r\n      console.log('- Ninguno (todos tienen al menos 70% de cobertura)');\r\n    } else {\r\n      lowCoverageFiles.sort((a, b) => a.overallPct - b.overallPct);\r\n      lowCoverageFiles.forEach(file => {\r\n        console.log(`- ${file.file}: ${file.overallPct.toFixed(2)}%`);\r\n      });\r\n    }\r\n    \r\n    // Archivos sin pruebas\r\n    console.log('\\nArchivos sin pruebas:');\r\n    if (untested.length === 0) {\r\n      console.log('- Ninguno (todos los archivos tienen alguna cobertura)');\r\n    } else {\r\n      untested.forEach(file => {\r\n        console.log(`- ${file}`);\r\n      });\r\n    }\r\n    \r\n    // Sugerencias de mejora\r\n    console.log('\\nSugerencias de mejora:');\r\n    if (lowCoverageFiles.length > 0) {\r\n      console.log('1. Priorizar la implementaci√≥n de pruebas para estos archivos con baja cobertura:');\r\n      lowCoverageFiles.slice(0, 5).forEach(file => {\r\n        console.log(`   - ${file.file}`);\r\n      });\r\n    }\r\n    \r\n    if (overallBranchPct < 70) {\r\n      console.log('2. Enfocar en mejorar la cobertura de ramas (condicionales, switch, etc.)');\r\n    }\r\n    \r\n    console.log('\\n===============================================================');\r\n    \r\n  } catch (error) {\r\n    console.error('Error al analizar la cobertura:', error);\r\n  }\r\n}\r\n\r\n// Funci√≥n auxiliar para contar elementos cubiertos\r\nfunction countCoverage(data) {\r\n  if (!data) return { total: 0, covered: 0 };\r\n  \r\n  const total = Object.keys(data).length;\r\n  let covered = 0;\r\n  \r\n  // Para branches (que son arrays)\r\n  if (Array.isArray(data[Object.keys(data)[0]])) {\r\n    for (const key in data) {\r\n      const branches = data[key];\r\n      let branchCovered = 0;\r\n      for (let i = 0; i < branches.length; i++) {\r\n        if (branches[i] > 0) branchCovered++;\r\n      }\r\n      covered += branchCovered;\r\n      total += branches.length - 1; // Ajustar el total para branches\r\n    }\r\n  } \r\n  // Para otros tipos (statements, functions, lines)\r\n  else {\r\n    for (const key in data) {\r\n      if (data[key] > 0) covered++;\r\n    }\r\n  }\r\n  \r\n  return { total, covered };\r\n}\r\n\r\n// Funci√≥n auxiliar para calcular porcentaje\r\nfunction calculatePercentage(covered, total) {\r\n  return total === 0 ? 100 : (covered / total) * 100;\r\n}\r\n\r\n// Ejecutar el an√°lisis\r\nanalyzeCoverage();\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\e2e\\AdvancedEmailWorkflows.test.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'within' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":46,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":52},{"ruleId":"no-unused-vars","severity":1,"message":"'TagService' is defined but never used. Allowed unused vars must match /^_/u.","line":16,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'FolderService' is defined but never used. Allowed unused vars must match /^_/u.","line":17,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'mockProfile' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":90,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":90,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'email' is defined but never used. Allowed unused args must match /^_/u.","line":198,"column":53,"nodeType":"Identifier","messageId":"unusedVar","endLine":198,"endColumn":58},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used. Allowed unused args must match /^_/u.","line":204,"column":55,"nodeType":"Identifier","messageId":"unusedVar","endLine":204,"endColumn":57},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used. Allowed unused args must match /^_/u.","line":205,"column":53,"nodeType":"Identifier","messageId":"unusedVar","endLine":205,"endColumn":55},{"ruleId":"no-unused-vars","severity":1,"message":"'folder' is defined but never used. Allowed unused args must match /^_/u.","line":205,"column":57,"nodeType":"Identifier","messageId":"unusedVar","endLine":205,"endColumn":63},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used. Allowed unused args must match /^_/u.","line":206,"column":55,"nodeType":"Identifier","messageId":"unusedVar","endLine":206,"endColumn":57},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used. Allowed unused args must match /^_/u.","line":207,"column":54,"nodeType":"Identifier","messageId":"unusedVar","endLine":207,"endColumn":56},{"ruleId":"no-unused-vars","severity":1,"message":"'content' is defined but never used. Allowed unused args must match /^_/u.","line":207,"column":58,"nodeType":"Identifier","messageId":"unusedVar","endLine":207,"endColumn":65},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used. Allowed unused args must match /^_/u.","line":210,"column":56,"nodeType":"Identifier","messageId":"unusedVar","endLine":210,"endColumn":58},{"ruleId":"no-unused-vars","severity":1,"message":"'to' is defined but never used. Allowed unused args must match /^_/u.","line":210,"column":60,"nodeType":"Identifier","messageId":"unusedVar","endLine":210,"endColumn":62},{"ruleId":"no-unused-vars","severity":1,"message":"'content' is defined but never used. Allowed unused args must match /^_/u.","line":210,"column":64,"nodeType":"Identifier","messageId":"unusedVar","endLine":210,"endColumn":71}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\r\nimport { render, screen, fireEvent, waitFor, within } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport { MemoryRouter, Routes, Route } from 'react-router-dom';\r\nimport { ToastContainer } from 'react-toastify';\r\n\r\n// Componentes principales\r\nimport EmailInbox from '../../components/email/EmailInbox';\r\nimport EmailDetail from '../../components/email/EmailDetail';\r\nimport ComposeEmail from '../../components/email/ComposeEmail';\r\nimport EmailSettings from '../../components/email/EmailSettings';\r\nimport EmailStats from '../../components/email/EmailStats';\r\n\r\n// Servicios\r\nimport * as EmailService from '../../services/EmailService';\r\nimport * as TagService from '../../services/TagService';\r\nimport * as FolderService from '../../services/FolderService';\r\nimport * as StatsService from '../../services/StatsService';\r\n\r\n// Mock para localStorage\r\nconst localStorageMock = (() => {\r\n  let store = {};\r\n  return {\r\n    getItem: vi.fn(key => store[key] || null),\r\n    setItem: vi.fn((key, value) => {\r\n      store[key] = value.toString();\r\n    }),\r\n    clear: vi.fn(() => {\r\n      store = {};\r\n    }),\r\n    removeItem: vi.fn(key => {\r\n      delete store[key];\r\n    }),\r\n    getAll: () => store\r\n  };\r\n})();\r\n\r\nObject.defineProperty(window, 'localStorage', {\r\n  value: localStorageMock\r\n});\r\n\r\n// Mock para fetch global\r\nglobal.fetch = vi.fn();\r\n\r\n// Mock para los servicios\r\nvi.mock('../../services/EmailService');\r\nvi.mock('../../services/TagService');\r\nvi.mock('../../services/FolderService');\r\nvi.mock('../../services/StatsService');\r\n\r\n// Mock para File y FileReader\r\nglobal.File = class MockFile {\r\n  constructor(bits, name, options) {\r\n    this.name = name;\r\n    this.size = bits.length;\r\n    this.type = options?.type || '';\r\n  }\r\n};\r\n\r\nglobal.FileReader = class MockFileReader {\r\n  constructor() {\r\n    this.result = null;\r\n  }\r\n  readAsDataURL() {\r\n    this.result = 'data:text/plain;base64,dGVzdCBmaWxl';\r\n    setTimeout(() => this.onload(), 50);\r\n  }\r\n};\r\n\r\n// Componente para envolver los tests y proporcionar el contexto necesario\r\nconst TestWrapper = ({ children, initialRoute = '/' }) => {\r\n  return (\r\n    <MemoryRouter initialEntries={[initialRoute]}>\r\n      <ToastContainer position=\"top-right\" autoClose={2000} />\r\n      <Routes>\r\n        <Route path=\"/\" element={<EmailInbox />} />\r\n        <Route path=\"/detail/:id\" element={<EmailDetail />} />\r\n        <Route path=\"/compose\" element={<ComposeEmail />} />\r\n        <Route path=\"/compose/:action/:id\" element={<ComposeEmail />} />\r\n        <Route path=\"/settings\" element={<EmailSettings />} />\r\n        <Route path=\"/stats\" element={<EmailStats />} />\r\n        {children}\r\n      </Routes>\r\n    </MemoryRouter>\r\n  );\r\n};\r\n\r\ndescribe('Flujos avanzados del sistema de correo (E2E)', () => {\r\n  // Datos de ejemplo\r\n  const mockProfile = {\r\n    id: 'profile123',\r\n    userId: 'user123',\r\n    brideFirstName: 'Mar√≠a',\r\n    brideLastName: 'Garc√≠a',\r\n  };\r\n\r\n  const mockEmails = [\r\n    {\r\n      id: 'email1',\r\n      from: 'remitente@example.com',\r\n      to: 'maria.garcia@lovenda.com',\r\n      subject: 'Presupuesto fotograf√≠a',\r\n      body: '<p>Hola Mar√≠a, te env√≠o el presupuesto para las fotos de la boda.</p>',\r\n      date: '2025-07-12T15:30:00Z',\r\n      folder: 'inbox',\r\n      read: false,\r\n      attachments: []\r\n    },\r\n    {\r\n      id: 'email2',\r\n      from: 'maria.garcia@lovenda.com',\r\n      to: 'florista@example.com',\r\n      subject: 'Consulta sobre centros de mesa',\r\n      body: '<p>Hola, estoy interesada en vuestros servicios para mi boda.</p>',\r\n      date: '2025-07-11T10:15:00Z',\r\n      folder: 'sent',\r\n      read: true,\r\n      attachments: []\r\n    },\r\n    {\r\n      id: 'email3',\r\n      from: 'dj@example.com',\r\n      to: 'maria.garcia@lovenda.com',\r\n      subject: 'Presupuesto DJ y sonido',\r\n      body: '<p>Buenos d√≠as Mar√≠a, adjunto encontrar√°s nuestro presupuesto.</p>',\r\n      date: '2025-07-10T09:45:00Z',\r\n      folder: 'inbox',\r\n      read: true,\r\n      attachments: [\r\n        { id: 'att1', name: 'presupuesto.pdf', size: 1024000, type: 'application/pdf' }\r\n      ]\r\n    },\r\n    {\r\n      id: 'draft1',\r\n      from: 'maria.garcia@lovenda.com',\r\n      to: 'catering@example.com',\r\n      subject: 'Consulta men√∫s',\r\n      body: '<p>Borrador de consulta para catering</p>',\r\n      date: '2025-07-13T08:20:00Z',\r\n      folder: 'drafts',\r\n      draft: true,\r\n      attachments: []\r\n    }\r\n  ];\r\n\r\n  const mockStats = {\r\n    lastUpdated: '2025-07-13T17:30:00Z',\r\n    emailCounts: {\r\n      total: 250,\r\n      inbox: 120,\r\n      sent: 100,\r\n      trash: 20,\r\n      unread: 5\r\n    },\r\n    activityMetrics: {\r\n      daily: [5, 7, 3, 8, 4, 6, 2],\r\n      weekly: [25, 30, 28, 32],\r\n      monthly: [95, 120, 85]\r\n    },\r\n    folderDistribution: {\r\n      labels: ['Bandeja de entrada', 'Enviados', 'Papelera', 'Proveedores', 'Ideas de boda'],\r\n      data: [120, 100, 20, 15, 5]\r\n    },\r\n    tagDistribution: {\r\n      labels: ['Importante', 'Fotograf√≠a', 'Catering', 'M√∫sica'],\r\n      data: [45, 20, 15, 10],\r\n      colors: ['#e53e3e', '#3182ce', '#38a169', '#805ad5']\r\n    },\r\n    contactAnalysis: {\r\n      topContacts: [\r\n        { name: 'Fot√≥grafo', email: 'fotografo@example.com', count: 25 },\r\n        { name: 'Florista', email: 'florista@example.com', count: 18 },\r\n        { name: 'Catering', email: 'catering@example.com', count: 15 }\r\n      ]\r\n    },\r\n    responseMetrics: {\r\n      averageResponseTime: 3.5, // horas\r\n      responseRate: 0.85 // 85%\r\n    }\r\n  };\r\n\r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n    localStorage.clear();\r\n    \r\n    // Configurar mocks para los servicios\r\n    EmailService.initEmailService.mockReturnValue('maria.garcia@lovenda.com');\r\n    EmailService.getMails.mockImplementation(async (folder) => {\r\n      if (folder === 'drafts') {\r\n        return [mockEmails[3]];\r\n      }\r\n      return mockEmails.filter(email => email.folder === folder);\r\n    });\r\n    EmailService.getEmail.mockImplementation(async (id) => {\r\n      return mockEmails.find(email => email.id === id) || null;\r\n    });\r\n    EmailService.getUnreadCount.mockResolvedValue(1);\r\n    EmailService.sendMail.mockImplementation(async (email) => {\r\n      return { success: true, id: 'new-email-id' };\r\n    });\r\n    EmailService.saveDraft.mockImplementation(async (draft) => {\r\n      return { success: true, id: draft.id || 'new-draft-id' };\r\n    });\r\n    EmailService.markAsRead.mockImplementation(async (id) => true);\r\n    EmailService.moveMail.mockImplementation(async (id, folder) => true);\r\n    EmailService.deleteMail.mockImplementation(async (id) => true);\r\n    EmailService.replyMail.mockImplementation(async (id, content) => {\r\n      return { success: true, id: 'reply-email-id' };\r\n    });\r\n    EmailService.forwardMail.mockImplementation(async (id, to, content) => {\r\n      return { success: true, id: 'forward-email-id' };\r\n    });\r\n    \r\n    StatsService.generateUserStats.mockResolvedValue(mockStats);\r\n    StatsService.getUserStats.mockReturnValue(mockStats);\r\n  });\r\n\r\n  afterEach(() => {\r\n    vi.restoreAllMocks();\r\n  });\r\n\r\n  describe('Flujo de respuesta a correos', () => {\r\n    it('permite responder a un correo existente', async () => {\r\n      render(<TestWrapper initialRoute=\"/detail/email1\" />);\r\n      \r\n      // Verificar que se carga el detalle del correo\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Presupuesto fotograf√≠a')).toBeInTheDocument();\r\n      });\r\n      \r\n      // Hacer clic en el bot√≥n de responder\r\n      fireEvent.click(screen.getByText('Responder'));\r\n      \r\n      // Verificar que se abre el formulario de respuesta con datos prellenados\r\n      await waitFor(() => {\r\n        // El destinatario debe ser el remitente original\r\n        const toField = screen.getByPlaceholderText('Para:');\r\n        expect(toField).toHaveValue('remitente@example.com');\r\n        \r\n        // El asunto debe incluir \"Re:\"\r\n        const subjectField = screen.getByPlaceholderText('Asunto:');\r\n        expect(subjectField).toHaveValue('Re: Presupuesto fotograf√≠a');\r\n      });\r\n      \r\n      // Escribir el contenido de la respuesta\r\n      const editorElement = screen.getByTestId('email-body-editor');\r\n      fireEvent.input(editorElement, { \r\n        target: { innerHTML: '<p>Gracias por el presupuesto. Tengo algunas dudas adicionales.</p>' } \r\n      });\r\n      \r\n      // Enviar la respuesta\r\n      fireEvent.click(screen.getByText('Enviar'));\r\n      \r\n      // Verificar que se llam√≥ a la funci√≥n de respuesta\r\n      await waitFor(() => {\r\n        expect(EmailService.replyMail).toHaveBeenCalledWith(\r\n          'email1',\r\n          expect.objectContaining({\r\n            to: 'remitente@example.com',\r\n            subject: 'Re: Presupuesto fotograf√≠a',\r\n            body: expect.stringContaining('Gracias por el presupuesto')\r\n          })\r\n        );\r\n        \r\n        // Verificar que se muestra una notificaci√≥n de √©xito\r\n        expect(screen.getByText(/respuesta enviada|mensaje enviado/i)).toBeInTheDocument();\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Flujo de reenv√≠o de correos', () => {\r\n    it('permite reenviar un correo a otro destinatario', async () => {\r\n      render(<TestWrapper initialRoute=\"/detail/email1\" />);\r\n      \r\n      // Verificar que se carga el detalle del correo\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Presupuesto fotograf√≠a')).toBeInTheDocument();\r\n      });\r\n      \r\n      // Hacer clic en el bot√≥n de reenviar\r\n      fireEvent.click(screen.getByText('Reenviar'));\r\n      \r\n      // Verificar que se abre el formulario de reenv√≠o con datos prellenados\r\n      await waitFor(() => {\r\n        // El destinatario debe estar vac√≠o\r\n        const toField = screen.getByPlaceholderText('Para:');\r\n        expect(toField).toHaveValue('');\r\n        \r\n        // El asunto debe incluir \"Fwd:\"\r\n        const subjectField = screen.getByPlaceholderText('Asunto:');\r\n        expect(subjectField).toHaveValue('Fwd: Presupuesto fotograf√≠a');\r\n        \r\n        // El cuerpo debe contener el correo original\r\n        const editorElement = screen.getByTestId('email-body-editor');\r\n        expect(editorElement.innerHTML).toContain('Hola Mar√≠a');\r\n      });\r\n      \r\n      // Completar el destinatario\r\n      const user = userEvent.setup();\r\n      await user.type(screen.getByPlaceholderText('Para:'), 'familiar@example.com');\r\n      \r\n      // A√±adir un comentario al reenv√≠o\r\n      const editorElement = screen.getByTestId('email-body-editor');\r\n      const originalContent = editorElement.innerHTML;\r\n      fireEvent.input(editorElement, { \r\n        target: { innerHTML: `<p>Mira este presupuesto que me enviaron.</p>${originalContent}` } \r\n      });\r\n      \r\n      // Enviar el reenv√≠o\r\n      fireEvent.click(screen.getByText('Enviar'));\r\n      \r\n      // Verificar que se llam√≥ a la funci√≥n de reenv√≠o\r\n      await waitFor(() => {\r\n        expect(EmailService.forwardMail).toHaveBeenCalledWith(\r\n          'email1',\r\n          'familiar@example.com',\r\n          expect.objectContaining({\r\n            subject: 'Fwd: Presupuesto fotograf√≠a',\r\n            body: expect.stringContaining('Mira este presupuesto')\r\n          })\r\n        );\r\n        \r\n        // Verificar que se muestra una notificaci√≥n de √©xito\r\n        expect(screen.getByText(/correo reenviado|mensaje reenviado/i)).toBeInTheDocument();\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Flujo de gesti√≥n de borradores', () => {\r\n    it('permite guardar un borrador y editarlo posteriormente', async () => {\r\n      // Renderizar el componente de composici√≥n\r\n      render(<TestWrapper initialRoute=\"/compose\" />);\r\n      \r\n      // Verificar que se muestra el formulario de composici√≥n\r\n      await waitFor(() => {\r\n        expect(screen.getByPlaceholderText('Para:')).toBeInTheDocument();\r\n      });\r\n      \r\n      // Rellenar parcialmente el formulario\r\n      const user = userEvent.setup();\r\n      await user.type(screen.getByPlaceholderText('Para:'), 'destinatario@example.com');\r\n      await user.type(screen.getByPlaceholderText('Asunto:'), 'Borrador importante');\r\n      \r\n      // Escribir en el editor\r\n      const editorElement = screen.getByTestId('email-body-editor');\r\n      fireEvent.input(editorElement, { \r\n        target: { innerHTML: '<p>Este es un borrador que completar√© m√°s tarde.</p>' } \r\n      });\r\n      \r\n      // Guardar como borrador\r\n      fireEvent.click(screen.getByText('Guardar borrador'));\r\n      \r\n      // Verificar que se llam√≥ a la funci√≥n de guardar borrador\r\n      await waitFor(() => {\r\n        expect(EmailService.saveDraft).toHaveBeenCalledWith(expect.objectContaining({\r\n          to: 'destinatario@example.com',\r\n          subject: 'Borrador importante',\r\n          body: '<p>Este es un borrador que completar√© m√°s tarde.</p>'\r\n        }));\r\n        \r\n        // Verificar que se muestra una notificaci√≥n de √©xito\r\n        expect(screen.getByText(/borrador guardado/i)).toBeInTheDocument();\r\n      });\r\n      \r\n      // Simular navegaci√≥n a la bandeja de entrada\r\n      render(<TestWrapper />);\r\n      \r\n      // Ir a la carpeta de borradores\r\n      fireEvent.click(screen.getByText('Borradores'));\r\n      \r\n      // Verificar que se muestra el borrador\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Consulta men√∫s')).toBeInTheDocument();\r\n      });\r\n      \r\n      // Abrir el borrador\r\n      fireEvent.click(screen.getByText('Consulta men√∫s'));\r\n      \r\n      // Verificar que se abre el formulario de edici√≥n con los datos del borrador\r\n      await waitFor(() => {\r\n        expect(screen.getByPlaceholderText('Para:')).toHaveValue('catering@example.com');\r\n        expect(screen.getByPlaceholderText('Asunto:')).toHaveValue('Consulta men√∫s');\r\n        \r\n        const editorElement = screen.getByTestId('email-body-editor');\r\n        expect(editorElement.innerHTML).toContain('Borrador de consulta para catering');\r\n      });\r\n      \r\n      // Completar el borrador y enviar\r\n      const editorElement2 = screen.getByTestId('email-body-editor');\r\n      fireEvent.input(editorElement2, { \r\n        target: { innerHTML: '<p>Quisiera informaci√≥n sobre men√∫s para 100 invitados.</p>' } \r\n      });\r\n      \r\n      fireEvent.click(screen.getByText('Enviar'));\r\n      \r\n      // Verificar que se envi√≥ el correo\r\n      await waitFor(() => {\r\n        expect(EmailService.sendMail).toHaveBeenCalledWith(expect.objectContaining({\r\n          id: 'draft1',\r\n          to: 'catering@example.com',\r\n          subject: 'Consulta men√∫s'\r\n        }));\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Flujo de eliminaci√≥n de correos', () => {\r\n    it('permite eliminar correos (mover a papelera y eliminar permanentemente)', async () => {\r\n      // Renderizar el detalle de un correo\r\n      render(<TestWrapper initialRoute=\"/detail/email1\" />);\r\n      \r\n      // Verificar que se carga el detalle del correo\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Presupuesto fotograf√≠a')).toBeInTheDocument();\r\n      });\r\n      \r\n      // Eliminar el correo (mover a papelera)\r\n      fireEvent.click(screen.getByText('Eliminar'));\r\n      \r\n      // Verificar que se llam√≥ a la funci√≥n para mover a papelera\r\n      await waitFor(() => {\r\n        expect(EmailService.moveMail).toHaveBeenCalledWith('email1', 'trash');\r\n        \r\n        // Verificar que se muestra una notificaci√≥n\r\n        expect(screen.getByText(/correo eliminado|movido a papelera/i)).toBeInTheDocument();\r\n      });\r\n      \r\n      // Simular navegaci√≥n a la papelera\r\n      render(<TestWrapper initialRoute=\"/\" />);\r\n      \r\n      // Ir a la papelera\r\n      fireEvent.click(screen.getByText('Papelera'));\r\n      \r\n      // Verificar que podemos eliminar permanentemente\r\n      const emailInTrash = mockEmails[0]; // Ahora est√° en papelera seg√∫n la simulaci√≥n\r\n      EmailService.getMails.mockResolvedValueOnce([{...emailInTrash, folder: 'trash'}]);\r\n      \r\n      await waitFor(() => {\r\n        const trashAction = screen.getAllByText('Eliminar permanentemente')[0];\r\n        fireEvent.click(trashAction);\r\n      });\r\n      \r\n      // Confirmar eliminaci√≥n permanente\r\n      fireEvent.click(screen.getByText('Confirmar'));\r\n      \r\n      // Verificar que se llam√≥ a la funci√≥n de eliminaci√≥n permanente\r\n      await waitFor(() => {\r\n        expect(EmailService.deleteMail).toHaveBeenCalledWith('email1');\r\n        \r\n        // Verificar que se muestra una notificaci√≥n\r\n        expect(screen.getByText(/eliminado permanentemente/i)).toBeInTheDocument();\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Flujo de gesti√≥n de adjuntos', () => {\r\n    it('permite ver y descargar adjuntos de un correo', async () => {\r\n      // Renderizar el detalle de un correo con adjuntos\r\n      render(<TestWrapper initialRoute=\"/detail/email3\" />);\r\n      \r\n      // Verificar que se carga el detalle del correo con su adjunto\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Presupuesto DJ y sonido')).toBeInTheDocument();\r\n        expect(screen.getByText('presupuesto.pdf')).toBeInTheDocument();\r\n      });\r\n      \r\n      // Hacer clic para descargar el adjunto\r\n      window.URL.createObjectURL = vi.fn().mockReturnValue('blob:adjunto');\r\n      window.URL.revokeObjectURL = vi.fn();\r\n      \r\n      // Mock para document.createElement y click\r\n      const mockAnchor = {\r\n        click: vi.fn(),\r\n        setAttribute: vi.fn(),\r\n        style: {}\r\n      };\r\n      \r\n      const originalCreateElement = document.createElement;\r\n      document.createElement = vi.fn().mockImplementation((tag) => {\r\n        if (tag === 'a') {\r\n          return mockAnchor;\r\n        }\r\n        return originalCreateElement.call(document, tag);\r\n      });\r\n      \r\n      // Simular descarga\r\n      fireEvent.click(screen.getByText('Descargar'));\r\n      \r\n      // Verificar que se inici√≥ la descarga\r\n      await waitFor(() => {\r\n        expect(mockAnchor.setAttribute).toHaveBeenCalledWith('download', 'presupuesto.pdf');\r\n        expect(mockAnchor.click).toHaveBeenCalled();\r\n      });\r\n      \r\n      // Restaurar el mock\r\n      document.createElement = originalCreateElement;\r\n    });\r\n    \r\n    it('permite adjuntar archivos al componer un correo', async () => {\r\n      render(<TestWrapper initialRoute=\"/compose\" />);\r\n      \r\n      // Verificar que se muestra el formulario de composici√≥n\r\n      await waitFor(() => {\r\n        expect(screen.getByPlaceholderText('Para:')).toBeInTheDocument();\r\n      });\r\n      \r\n      // Simular selecci√≥n de archivo\r\n      const file = new File(['contenido de prueba'], 'test.docx', { type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' });\r\n      const input = screen.getByLabelText('Adjuntar archivo');\r\n      \r\n      await fireEvent.change(input, { target: { files: [file] } });\r\n      \r\n      // Verificar que se muestra el adjunto\r\n      await waitFor(() => {\r\n        expect(screen.getByText('test.docx')).toBeInTheDocument();\r\n      });\r\n      \r\n      // Rellenar el resto del formulario\r\n      const user = userEvent.setup();\r\n      await user.type(screen.getByPlaceholderText('Para:'), 'destinatario@example.com');\r\n      await user.type(screen.getByPlaceholderText('Asunto:'), 'Correo con adjunto');\r\n      \r\n      const editorElement = screen.getByTestId('email-body-editor');\r\n      fireEvent.input(editorElement, { \r\n        target: { innerHTML: '<p>Adjunto documento solicitado.</p>' } \r\n      });\r\n      \r\n      // Enviar el correo\r\n      fireEvent.click(screen.getByText('Enviar'));\r\n      \r\n      // Verificar que se llam√≥ a la funci√≥n de env√≠o con el adjunto\r\n      await waitFor(() => {\r\n        expect(EmailService.sendMail).toHaveBeenCalledWith(expect.objectContaining({\r\n          to: 'destinatario@example.com',\r\n          subject: 'Correo con adjunto',\r\n          attachments: [expect.objectContaining({ name: 'test.docx' })]\r\n        }));\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Flujo de visualizaci√≥n de estad√≠sticas', () => {\r\n    it('permite ver estad√≠sticas y m√©tricas de uso del correo', async () => {\r\n      render(<TestWrapper initialRoute=\"/stats\" />);\r\n      \r\n      // Verificar que se cargan las estad√≠sticas\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Estad√≠sticas de correo')).toBeInTheDocument();\r\n        expect(StatsService.generateUserStats).toHaveBeenCalled();\r\n      });\r\n      \r\n      // Verificar que se muestran las m√©tricas principales\r\n      expect(screen.getByText('250')).toBeInTheDocument(); // Total de correos\r\n      expect(screen.getByText('5')).toBeInTheDocument(); // Correos sin leer\r\n      \r\n      // Verificar que se muestran los gr√°ficos (al menos sus t√≠tulos)\r\n      expect(screen.getByText('Actividad reciente')).toBeInTheDocument();\r\n      expect(screen.getByText('Distribuci√≥n por carpetas')).toBeInTheDocument();\r\n      expect(screen.getByText('Distribuci√≥n por etiquetas')).toBeInTheDocument();\r\n      \r\n      // Verificar que se muestran los contactos frecuentes\r\n      expect(screen.getByText('Contactos frecuentes')).toBeInTheDocument();\r\n      expect(screen.getByText('Fot√≥grafo')).toBeInTheDocument();\r\n      expect(screen.getByText('25')).toBeInTheDocument(); // Contador del contacto m√°s frecuente\r\n      \r\n      // Verificar que se muestran las m√©tricas de respuesta\r\n      expect(screen.getByText('Tiempo medio de respuesta')).toBeInTheDocument();\r\n      expect(screen.getByText('3.5h')).toBeInTheDocument(); // Tiempo medio\r\n      expect(screen.getByText('85%')).toBeInTheDocument(); // Tasa de respuesta\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\e2e\\EmailWorkflows.test.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'BrowserRouter' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'FolderSelectionModal' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":28},{"ruleId":"no-unused-vars","severity":1,"message":"'email' is defined but never used. Allowed unused args must match /^_/u.","line":120,"column":53,"nodeType":"Identifier","messageId":"unusedVar","endLine":120,"endColumn":58},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used. Allowed unused args must match /^_/u.","line":123,"column":55,"nodeType":"Identifier","messageId":"unusedVar","endLine":123,"endColumn":57},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used. Allowed unused args must match /^_/u.","line":124,"column":53,"nodeType":"Identifier","messageId":"unusedVar","endLine":124,"endColumn":55},{"ruleId":"no-unused-vars","severity":1,"message":"'folder' is defined but never used. Allowed unused args must match /^_/u.","line":124,"column":57,"nodeType":"Identifier","messageId":"unusedVar","endLine":124,"endColumn":63},{"ruleId":"no-unused-vars","severity":1,"message":"'id' is defined but never used. Allowed unused args must match /^_/u.","line":125,"column":55,"nodeType":"Identifier","messageId":"unusedVar","endLine":125,"endColumn":57},{"ruleId":"no-unused-vars","severity":1,"message":"'userId' is defined but never used. Allowed unused args must match /^_/u.","line":130,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":130,"endColumn":56},{"ruleId":"no-unused-vars","severity":1,"message":"'emailId' is defined but never used. Allowed unused args must match /^_/u.","line":130,"column":58,"nodeType":"Identifier","messageId":"unusedVar","endLine":130,"endColumn":65},{"ruleId":"no-unused-vars","severity":1,"message":"'tagId' is defined but never used. Allowed unused args must match /^_/u.","line":130,"column":67,"nodeType":"Identifier","messageId":"unusedVar","endLine":130,"endColumn":72},{"ruleId":"no-unused-vars","severity":1,"message":"'userId' is defined but never used. Allowed unused args must match /^_/u.","line":131,"column":55,"nodeType":"Identifier","messageId":"unusedVar","endLine":131,"endColumn":61},{"ruleId":"no-unused-vars","severity":1,"message":"'emailId' is defined but never used. Allowed unused args must match /^_/u.","line":131,"column":63,"nodeType":"Identifier","messageId":"unusedVar","endLine":131,"endColumn":70},{"ruleId":"no-unused-vars","severity":1,"message":"'tagId' is defined but never used. Allowed unused args must match /^_/u.","line":131,"column":72,"nodeType":"Identifier","messageId":"unusedVar","endLine":131,"endColumn":77}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\r\nimport { render, screen, fireEvent, waitFor, within } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport { BrowserRouter, MemoryRouter, Routes, Route } from 'react-router-dom';\r\nimport { ToastContainer } from 'react-toastify';\r\n\r\n// Componentes principales\r\nimport EmailInbox from '../../components/email/EmailInbox';\r\nimport EmailDetail from '../../components/email/EmailDetail';\r\nimport ComposeEmail from '../../components/email/ComposeEmail';\r\nimport EmailSettings from '../../components/email/EmailSettings';\r\nimport FolderSelectionModal from '../../components/email/FolderSelectionModal';\r\n\r\n// Servicios\r\nimport * as EmailService from '../../services/EmailService';\r\nimport * as TagService from '../../services/TagService';\r\nimport * as FolderService from '../../services/FolderService';\r\n\r\n// Mock para localStorage\r\nconst localStorageMock = (() => {\r\n  let store = {};\r\n  return {\r\n    getItem: vi.fn(key => store[key] || null),\r\n    setItem: vi.fn((key, value) => {\r\n      store[key] = value.toString();\r\n    }),\r\n    clear: vi.fn(() => {\r\n      store = {};\r\n    }),\r\n    removeItem: vi.fn(key => {\r\n      delete store[key];\r\n    }),\r\n    getAll: () => store\r\n  };\r\n})();\r\n\r\nObject.defineProperty(window, 'localStorage', {\r\n  value: localStorageMock\r\n});\r\n\r\n// Mock para fetch global\r\nglobal.fetch = vi.fn();\r\n\r\n// Mock para los servicios\r\nvi.mock('../../services/EmailService');\r\nvi.mock('../../services/TagService');\r\nvi.mock('../../services/FolderService');\r\n\r\n// Componente para envolver los tests y proporcionar el contexto necesario\r\nconst TestWrapper = ({ children, initialRoute = '/' }) => {\r\n  return (\r\n    <MemoryRouter initialEntries={[initialRoute]}>\r\n      <ToastContainer position=\"top-right\" autoClose={2000} />\r\n      <Routes>\r\n        <Route path=\"/\" element={<EmailInbox />} />\r\n        <Route path=\"/detail/:id\" element={<EmailDetail />} />\r\n        <Route path=\"/compose\" element={<ComposeEmail />} />\r\n        <Route path=\"/settings\" element={<EmailSettings />} />\r\n        {children}\r\n      </Routes>\r\n    </MemoryRouter>\r\n  );\r\n};\r\n\r\ndescribe('Flujos completos del sistema de correo (E2E)', () => {\r\n  // Datos de ejemplo\r\n  const mockProfile = {\r\n    id: 'profile123',\r\n    userId: 'user123',\r\n    brideFirstName: 'Mar√≠a',\r\n    brideLastName: 'Garc√≠a',\r\n  };\r\n\r\n  const mockEmails = [\r\n    {\r\n      id: 'email1',\r\n      from: 'remitente@example.com',\r\n      to: 'maria.garcia@lovenda.com',\r\n      subject: 'Presupuesto fotograf√≠a',\r\n      body: '<p>Hola Mar√≠a, te env√≠o el presupuesto para las fotos de la boda.</p>',\r\n      date: '2025-07-12T15:30:00Z',\r\n      folder: 'inbox',\r\n      read: false,\r\n      attachments: []\r\n    },\r\n    {\r\n      id: 'email2',\r\n      from: 'maria.garcia@lovenda.com',\r\n      to: 'florista@example.com',\r\n      subject: 'Consulta sobre centros de mesa',\r\n      body: '<p>Hola, estoy interesada en vuestros servicios para mi boda.</p>',\r\n      date: '2025-07-11T10:15:00Z',\r\n      folder: 'sent',\r\n      read: true,\r\n      attachments: []\r\n    }\r\n  ];\r\n\r\n  const mockFolders = [\r\n    { id: 'inbox', name: 'Bandeja de entrada', system: true },\r\n    { id: 'sent', name: 'Enviados', system: true },\r\n    { id: 'trash', name: 'Papelera', system: true },\r\n    { id: 'proveedores', name: 'Proveedores', system: false },\r\n    { id: 'ideas', name: 'Ideas de boda', system: false }\r\n  ];\r\n\r\n  const mockTags = [\r\n    { id: 'important', name: 'Importante', color: '#e53e3e', system: true },\r\n    { id: 'photography', name: 'Fotograf√≠a', color: '#3182ce', system: false }\r\n  ];\r\n\r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n    localStorage.clear();\r\n    \r\n    // Configurar mocks para los servicios\r\n    EmailService.initEmailService.mockReturnValue('maria.garcia@lovenda.com');\r\n    EmailService.getMails.mockResolvedValue(mockEmails);\r\n    EmailService.getUnreadCount.mockResolvedValue(1);\r\n    EmailService.sendMail.mockImplementation(async (email) => {\r\n      return { success: true, id: 'new-email-id' };\r\n    });\r\n    EmailService.markAsRead.mockImplementation(async (id) => true);\r\n    EmailService.moveMail.mockImplementation(async (id, folder) => true);\r\n    EmailService.deleteMail.mockImplementation(async (id) => true);\r\n    \r\n    TagService.getUserTags.mockReturnValue(mockTags);\r\n    TagService.getEmailTags.mockReturnValue(['important']);\r\n    TagService.getEmailTagsDetails.mockReturnValue([mockTags[0]]);\r\n    TagService.addTagToEmail.mockImplementation((userId, emailId, tagId) => true);\r\n    TagService.removeTagFromEmail.mockImplementation((userId, emailId, tagId) => true);\r\n    \r\n    FolderService.getUserFolders.mockReturnValue(mockFolders);\r\n    FolderService.createFolder.mockImplementation((userId, name) => {\r\n      return { id: `folder-${Date.now()}`, name, system: false };\r\n    });\r\n  });\r\n\r\n  afterEach(() => {\r\n    vi.restoreAllMocks();\r\n  });\r\n\r\n  describe('Flujo de recepci√≥n y lectura de correo', () => {\r\n    it('permite ver la bandeja de entrada y abrir un correo', async () => {\r\n      // Renderizar la bandeja de entrada\r\n      render(<TestWrapper />);\r\n      \r\n      // Verificar que se muestra la lista de correos\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Bandeja de entrada')).toBeInTheDocument();\r\n        expect(screen.getByText('Presupuesto fotograf√≠a')).toBeInTheDocument();\r\n      });\r\n      \r\n      // Verificar que muestra el indicador de no le√≠do\r\n      expect(screen.getByText('Presupuesto fotograf√≠a').closest('.email-item')).toHaveClass('unread');\r\n      \r\n      // Hacer clic en un correo para abrirlo\r\n      fireEvent.click(screen.getByText('Presupuesto fotograf√≠a'));\r\n      \r\n      // Verificar que se abre el detalle del correo\r\n      await waitFor(() => {\r\n        expect(EmailService.markAsRead).toHaveBeenCalledWith('email1');\r\n        expect(screen.getByText('Hola Mar√≠a, te env√≠o el presupuesto para las fotos de la boda.')).toBeInTheDocument();\r\n      });\r\n    });\r\n\r\n    it('muestra etiquetas en los correos y permite filtrar por ellas', async () => {\r\n      render(<TestWrapper />);\r\n      \r\n      // Verificar que se muestra la etiqueta en el correo\r\n      await waitFor(() => {\r\n        const emailItem = screen.getByText('Presupuesto fotograf√≠a').closest('.email-item');\r\n        expect(within(emailItem).getByText('Importante')).toBeInTheDocument();\r\n      });\r\n      \r\n      // Hacer clic en el filtro de etiquetas\r\n      fireEvent.click(screen.getByText('Filtros'));\r\n      fireEvent.click(screen.getByText('Importante'));\r\n      \r\n      // Verificar que se aplica el filtro\r\n      await waitFor(() => {\r\n        expect(EmailService.getMails).toHaveBeenCalledWith('inbox', expect.objectContaining({\r\n          tags: ['important']\r\n        }));\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Flujo de env√≠o de correo', () => {\r\n    it('permite componer y enviar un nuevo correo', async () => {\r\n      render(<TestWrapper initialRoute=\"/compose\" />);\r\n      \r\n      // Verificar que se muestra el formulario de composici√≥n\r\n      await waitFor(() => {\r\n        expect(screen.getByPlaceholderText('Para:')).toBeInTheDocument();\r\n        expect(screen.getByPlaceholderText('Asunto:')).toBeInTheDocument();\r\n      });\r\n      \r\n      // Rellenar el formulario\r\n      const user = userEvent.setup();\r\n      await user.type(screen.getByPlaceholderText('Para:'), 'destinatario@example.com');\r\n      await user.type(screen.getByPlaceholderText('Asunto:'), 'Solicitud de informaci√≥n');\r\n      \r\n      // El editor de texto enriquecido es m√°s complejo, simulemos un cambio directo\r\n      const editorElement = screen.getByTestId('email-body-editor');\r\n      fireEvent.input(editorElement, { \r\n        target: { innerHTML: '<p>Hola, necesito m√°s informaci√≥n sobre sus servicios.</p>' } \r\n      });\r\n      \r\n      // Enviar el correo\r\n      fireEvent.click(screen.getByText('Enviar'));\r\n      \r\n      // Verificar que se llam√≥ a la funci√≥n de env√≠o\r\n      await waitFor(() => {\r\n        expect(EmailService.sendMail).toHaveBeenCalledWith(expect.objectContaining({\r\n          to: 'destinatario@example.com',\r\n          subject: 'Solicitud de informaci√≥n',\r\n          body: '<p>Hola, necesito m√°s informaci√≥n sobre sus servicios.</p>'\r\n        }));\r\n        \r\n        // Verificar que se muestra una notificaci√≥n de √©xito\r\n        expect(screen.getByText(/correo enviado|mensaje enviado/i)).toBeInTheDocument();\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Flujo de organizaci√≥n de correo', () => {\r\n    it('permite mover un correo a una carpeta diferente', async () => {\r\n      render(<TestWrapper initialRoute=\"/detail/email1\" />);\r\n      \r\n      // Verificar que se carga el detalle del correo\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Presupuesto fotograf√≠a')).toBeInTheDocument();\r\n      });\r\n      \r\n      // Hacer clic en el bot√≥n de mover\r\n      fireEvent.click(screen.getByText('Mover a'));\r\n      \r\n      // Verificar que se abre el modal de selecci√≥n de carpeta\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Seleccionar carpeta')).toBeInTheDocument();\r\n      });\r\n      \r\n      // Seleccionar una carpeta\r\n      fireEvent.click(screen.getByText('Proveedores'));\r\n      fireEvent.click(screen.getByText('Mover'));\r\n      \r\n      // Verificar que se llam√≥ a la funci√≥n para mover el correo\r\n      await waitFor(() => {\r\n        expect(EmailService.moveMail).toHaveBeenCalledWith('email1', 'proveedores');\r\n        \r\n        // Verificar que se muestra una notificaci√≥n de √©xito\r\n        expect(screen.getByText(/correo movido|mensaje movido/i)).toBeInTheDocument();\r\n      });\r\n    });\r\n\r\n    it('permite a√±adir y quitar etiquetas a un correo', async () => {\r\n      render(<TestWrapper initialRoute=\"/detail/email1\" />);\r\n      \r\n      // Verificar que se carga el detalle del correo\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Presupuesto fotograf√≠a')).toBeInTheDocument();\r\n      });\r\n      \r\n      // Hacer clic en el bot√≥n de gesti√≥n de etiquetas\r\n      fireEvent.click(screen.getByText('Etiquetas'));\r\n      \r\n      // Verificar que se muestra el selector de etiquetas\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Fotograf√≠a')).toBeInTheDocument();\r\n      });\r\n      \r\n      // A√±adir una etiqueta\r\n      fireEvent.click(screen.getByText('Fotograf√≠a'));\r\n      \r\n      // Verificar que se llam√≥ a la funci√≥n para a√±adir la etiqueta\r\n      await waitFor(() => {\r\n        expect(TagService.addTagToEmail).toHaveBeenCalledWith(\r\n          mockProfile.userId, \r\n          'email1', \r\n          'photography'\r\n        );\r\n      });\r\n      \r\n      // Quitar una etiqueta existente\r\n      fireEvent.click(screen.getByText('Importante'));\r\n      \r\n      // Verificar que se llam√≥ a la funci√≥n para quitar la etiqueta\r\n      await waitFor(() => {\r\n        expect(TagService.removeTagFromEmail).toHaveBeenCalledWith(\r\n          mockProfile.userId, \r\n          'email1', \r\n          'important'\r\n        );\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Flujo de gesti√≥n de carpetas y etiquetas', () => {\r\n    it('permite crear una nueva carpeta personalizada', async () => {\r\n      render(<TestWrapper initialRoute=\"/settings\" />);\r\n      \r\n      // Verificar que se carga la configuraci√≥n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Configuraci√≥n de correo')).toBeInTheDocument();\r\n      });\r\n      \r\n      // Ir a la secci√≥n de carpetas\r\n      fireEvent.click(screen.getByText('Carpetas'));\r\n      \r\n      // Crear nueva carpeta\r\n      const user = userEvent.setup();\r\n      await user.type(screen.getByPlaceholderText('Nombre de carpeta'), 'Presupuestos');\r\n      fireEvent.click(screen.getByText('Crear carpeta'));\r\n      \r\n      // Verificar que se llam√≥ a la funci√≥n para crear la carpeta\r\n      await waitFor(() => {\r\n        expect(FolderService.createFolder).toHaveBeenCalledWith(\r\n          mockProfile.userId, \r\n          'Presupuestos'\r\n        );\r\n        \r\n        // Verificar que se muestra una notificaci√≥n de √©xito\r\n        expect(screen.getByText(/carpeta creada|creada con √©xito/i)).toBeInTheDocument();\r\n      });\r\n    });\r\n\r\n    it('permite crear una nueva etiqueta personalizada', async () => {\r\n      render(<TestWrapper initialRoute=\"/settings\" />);\r\n      \r\n      // Verificar que se carga la configuraci√≥n\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Configuraci√≥n de correo')).toBeInTheDocument();\r\n      });\r\n      \r\n      // Ir a la secci√≥n de etiquetas\r\n      fireEvent.click(screen.getByText('Etiquetas'));\r\n      \r\n      // Crear nueva etiqueta\r\n      const user = userEvent.setup();\r\n      await user.type(screen.getByPlaceholderText('Nombre de etiqueta'), 'Catering');\r\n      \r\n      // Seleccionar un color\r\n      fireEvent.click(screen.getByTestId('color-picker'));\r\n      fireEvent.click(screen.getByTestId('color-#38a169')); // Verde\r\n      \r\n      fireEvent.click(screen.getByText('Crear etiqueta'));\r\n      \r\n      // Verificar que se llam√≥ a la funci√≥n para crear la etiqueta\r\n      await waitFor(() => {\r\n        expect(TagService.createTag).toHaveBeenCalledWith(\r\n          mockProfile.userId, \r\n          'Catering',\r\n          '#38a169'\r\n        );\r\n        \r\n        // Verificar que se muestra una notificaci√≥n de √©xito\r\n        expect(screen.getByText(/etiqueta creada|creada con √©xito/i)).toBeInTheDocument();\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Flujo de b√∫squeda y filtrado avanzado', () => {\r\n    it('permite buscar correos por texto', async () => {\r\n      render(<TestWrapper />);\r\n      \r\n      // Verificar que se muestra la bandeja de entrada\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Bandeja de entrada')).toBeInTheDocument();\r\n      });\r\n      \r\n      // Realizar una b√∫squeda\r\n      const user = userEvent.setup();\r\n      await user.type(screen.getByPlaceholderText('Buscar...'), 'fotograf√≠a');\r\n      fireEvent.keyPress(screen.getByPlaceholderText('Buscar...'), { key: 'Enter', code: 13 });\r\n      \r\n      // Verificar que se llam√≥ a la funci√≥n de b√∫squeda\r\n      await waitFor(() => {\r\n        expect(EmailService.getMails).toHaveBeenCalledWith('inbox', expect.objectContaining({\r\n          search: 'fotograf√≠a'\r\n        }));\r\n      });\r\n    });\r\n\r\n    it('permite aplicar filtros avanzados combinando criterios', async () => {\r\n      render(<TestWrapper />);\r\n      \r\n      // Verificar que se muestra la bandeja de entrada\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Bandeja de entrada')).toBeInTheDocument();\r\n      });\r\n      \r\n      // Abrir el panel de filtros avanzados\r\n      fireEvent.click(screen.getByText('Filtros'));\r\n      \r\n      // Aplicar m√∫ltiples filtros\r\n      fireEvent.click(screen.getByText('Importante')); // Etiqueta\r\n      fireEvent.click(screen.getByText('No le√≠dos')); // Estado\r\n      \r\n      // Filtrar por fecha (√∫ltimos 7 d√≠as)\r\n      fireEvent.change(screen.getByLabelText('Periodo'), { target: { value: '7d' } });\r\n      \r\n      // Aplicar filtros\r\n      fireEvent.click(screen.getByText('Aplicar filtros'));\r\n      \r\n      // Verificar que se llam√≥ a getMails con los filtros correctos\r\n      await waitFor(() => {\r\n        expect(EmailService.getMails).toHaveBeenCalledWith('inbox', expect.objectContaining({\r\n          tags: ['important'],\r\n          onlyUnread: true,\r\n          dateRange: '7d'\r\n        }));\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Flujo de estad√≠sticas y an√°lisis', () => {\r\n    it('muestra correctamente las estad√≠sticas de uso del correo', async () => {\r\n      // Mock para estad√≠sticas\r\n      const mockStats = {\r\n        totalSent: 45,\r\n        totalReceived: 87,\r\n        responseRate: 76,\r\n        avgResponseTime: 3.2, // horas\r\n        topContacts: [\r\n          { email: 'florista@example.com', count: 12 },\r\n          { email: 'fotografo@example.com', count: 8 }\r\n        ],\r\n        tagDistribution: [\r\n          { tag: 'Importante', count: 15 },\r\n          { tag: 'Fotograf√≠a', count: 7 }\r\n        ],\r\n        activityByDay: {\r\n          lun: 14, mar: 8, mi√©: 22, jue: 11, vie: 17, s√°b: 5, dom: 2\r\n        }\r\n      };\r\n      \r\n      EmailService.getEmailStatistics.mockResolvedValue(mockStats);\r\n      \r\n      render(<TestWrapper initialRoute=\"/statistics\" />);\r\n      \r\n      // Verificar que se muestran las estad√≠sticas\r\n      await waitFor(() => {\r\n        expect(screen.getByText('Estad√≠sticas de uso')).toBeInTheDocument();\r\n        expect(screen.getByText('87')).toBeInTheDocument(); // Total recibidos\r\n        expect(screen.getByText('45')).toBeInTheDocument(); // Total enviados\r\n        expect(screen.getByText('76%')).toBeInTheDocument(); // Tasa de respuesta\r\n      });\r\n      \r\n      // Verificar gr√°ficos y distribuciones\r\n      expect(screen.getByText('Contactos frecuentes')).toBeInTheDocument();\r\n      expect(screen.getByText('florista@example.com')).toBeInTheDocument();\r\n      expect(screen.getByText('fotografo@example.com')).toBeInTheDocument();\r\n      \r\n      expect(screen.getByText('Distribuci√≥n por etiquetas')).toBeInTheDocument();\r\n      expect(screen.getByText('Actividad por d√≠a')).toBeInTheDocument();\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\email-integration-test.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'updatedEmail' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":206,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":206,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Script de prueba de integraci√≥n para validar el funcionamiento conjunto \r\n * del sistema de emails, calendario y plantillas de MyWed360.\r\n * \r\n * Este script simula un flujo completo de usuario, desde recepci√≥n de emails\r\n * hasta la creaci√≥n de eventos en calendario y uso de plantillas.\r\n */\r\n\r\n// Simulaci√≥n de servicios para pruebas\r\nconst mockServices = {\r\n  EmailService: {\r\n    // Datos de prueba - Emails recibidos\r\n    inboxEmails: [\r\n      {\r\n        id: 'email_001',\r\n        from: 'fotografo@ejemplo.com',\r\n        to: 'maria.garcia@lovenda.com',\r\n        subject: 'Disponibilidad para sesi√≥n de fotos',\r\n        body: `<p>Hola Mar√≠a,</p>\r\n        <p>Te confirmo que tengo disponibilidad para la sesi√≥n de fotos que solicitaste el 15/09/2025 a las 16:30.</p>\r\n        <p>El lugar ser√≠a en nuestro estudio ubicado en Calle Gran V√≠a 56, Madrid.</p>\r\n        <p>Si necesitas m√°s informaci√≥n o quieres modificar algo, no dudes en contactarme.</p>\r\n        <p>Saludos cordiales,</p>\r\n        <p>Juan P√©rez<br>Fotograf√≠a Momentos</p>`,\r\n        date: '2025-07-10T10:23:45',\r\n        read: false,\r\n        folder: 'inbox',\r\n        providerId: 'prov_001'\r\n      },\r\n      {\r\n        id: 'email_002',\r\n        from: 'catering@ejemplo.com',\r\n        to: 'maria.garcia@lovenda.com',\r\n        subject: 'Presupuesto para tu boda',\r\n        body: `<p>Hola Mar√≠a,</p>\r\n        <p>Adjunto encontrar√°s el presupuesto detallado para el servicio de catering que solicitaste.</p>\r\n        <p>Como comentamos, incluye opciones para 100 invitados con diferentes men√∫s a elegir.</p>\r\n        <p>Necesitar√≠amos una confirmaci√≥n antes del 20/07/2025 para reservar la fecha.</p>\r\n        <p>Quedamos a tu disposici√≥n,</p>\r\n        <p>Ana L√≥pez<br>Catering Delicatessen</p>`,\r\n        date: '2025-07-09T15:42:30',\r\n        read: true,\r\n        folder: 'inbox',\r\n        attachments: [\r\n          {\r\n            name: 'Presupuesto-Boda-Garc√≠a.pdf',\r\n            size: 2458000\r\n          }\r\n        ],\r\n        providerId: 'prov_002'\r\n      }\r\n    ],\r\n    \r\n    // Datos de prueba - Emails enviados\r\n    sentEmails: [\r\n      {\r\n        id: 'email_003',\r\n        from: 'maria.garcia@lovenda.com',\r\n        to: 'florista@ejemplo.com',\r\n        subject: 'Consulta sobre arreglos florales',\r\n        body: `<p>Estimados,</p>\r\n        <p>Me pongo en contacto para consultar sobre sus servicios de decoraci√≥n floral para una boda.</p>\r\n        <p>La fecha ser√≠a el 15/09/2025 y necesitar√≠a arreglos para la ceremonia y centro de mesa para 10 mesas.</p>\r\n        <p>¬øPodr√≠an enviarme informaci√≥n y presupuesto?</p>\r\n        <p>Muchas gracias,</p>\r\n        <p>Mar√≠a Garc√≠a</p>`,\r\n        date: '2025-07-08T09:15:22',\r\n        read: true,\r\n        folder: 'sent'\r\n      }\r\n    ],\r\n    \r\n    // Datos de prueba - Plantillas\r\n    emailTemplates: [\r\n      {\r\n        id: 'template_001',\r\n        name: 'Solicitud de informaci√≥n',\r\n        category: 'Proveedores - Solicitud de informaci√≥n',\r\n        subject: 'Consulta sobre servicios de {{servicio}} para boda',\r\n        body: `<p>Estimado/a {{nombre_proveedor}}:</p>\r\n        <p>Me pongo en contacto con ustedes porque estoy organizando mi boda para el d√≠a {{fecha_boda}} y estoy interesada en sus servicios de {{servicio}}.</p>\r\n        <p>Me gustar√≠a conocer m√°s informaci√≥n sobre:</p>\r\n        <ul>\r\n          <li>Disponibilidad para la fecha mencionada</li>\r\n          <li>Diferentes opciones y paquetes</li>\r\n          <li>Precios aproximados</li>\r\n        </ul>\r\n        <p>Quedo a la espera de su respuesta.</p>\r\n        <p>Saludos cordiales,</p>\r\n        <p>{{nombre_novia}}</p>`,\r\n        variables: ['servicio', 'nombre_proveedor', 'fecha_boda', 'nombre_novia'],\r\n        isSystem: true\r\n      },\r\n      {\r\n        id: 'template_002',\r\n        name: 'Confirmaci√≥n de cita',\r\n        category: 'Proveedores - Confirmaci√≥n',\r\n        subject: 'Confirmaci√≥n de cita - {{fecha_cita}}',\r\n        body: `<p>Estimado/a {{nombre_proveedor}}:</p>\r\n        <p>Por la presente confirmo nuestra cita para el d√≠a {{fecha_cita}} a las {{hora_cita}} en {{lugar_cita}}.</p>\r\n        <p>Cualquier cambio, por favor h√°zmelo saber con antelaci√≥n.</p>\r\n        <p>Saludos cordiales,</p>\r\n        <p>{{nombre_novia}}</p>`,\r\n        variables: ['nombre_proveedor', 'fecha_cita', 'hora_cita', 'lugar_cita', 'nombre_novia'],\r\n        isSystem: true\r\n      }\r\n    ],\r\n    \r\n    // M√©todos simulados\r\n    getMails: function(folder = 'inbox') {\r\n      if (folder === 'inbox') return this.inboxEmails;\r\n      if (folder === 'sent') return this.sentEmails;\r\n      return [];\r\n    },\r\n    \r\n    getMailDetails: function(emailId) {\r\n      const allEmails = [...this.inboxEmails, ...this.sentEmails];\r\n      return allEmails.find(email => email.id === emailId) || null;\r\n    },\r\n    \r\n    getEmailTemplates: function() {\r\n      return this.emailTemplates;\r\n    },\r\n    \r\n    saveEmailTemplate: function(template) {\r\n      // Simular guardado\r\n      console.log('Guardando plantilla:', template.name);\r\n      return template;\r\n    },\r\n    \r\n    sendMail: function(mailData) {\r\n      console.log('Enviando email:', mailData);\r\n      return {\r\n        id: `email_${Date.now()}`,\r\n        from: 'maria.garcia@lovenda.com',\r\n        to: mailData.to,\r\n        subject: mailData.subject,\r\n        body: mailData.body,\r\n        date: new Date().toISOString(),\r\n        read: true,\r\n        folder: 'sent'\r\n      };\r\n    },\r\n    \r\n    markAsRead: function(emailId) {\r\n      console.log('Marcando email como le√≠do:', emailId);\r\n      const email = this.getMailDetails(emailId);\r\n      if (email) {\r\n        email.read = true;\r\n      }\r\n      return email;\r\n    }\r\n  },\r\n  \r\n  CalendarService: {\r\n    // Datos de prueba - Eventos\r\n    events: [\r\n      {\r\n        id: 'event_001',\r\n        title: 'Prueba de vestido',\r\n        dateTime: '2025-08-10T11:00:00',\r\n        location: 'Tienda Novias Elegantes, Calle Serrano 25',\r\n        description: 'Primera prueba del vestido con posibles ajustes',\r\n        attendees: ['Mar√≠a Garc√≠a', 'Carmen Garc√≠a (madre)', 'Elena Mart√≠nez (madrina)'],\r\n        providerRelated: true,\r\n        providerId: 'prov_005'\r\n      }\r\n    ],\r\n    \r\n    // M√©todos simulados\r\n    getEvents: function() {\r\n      return this.events;\r\n    },\r\n    \r\n    addEvent: function(eventData) {\r\n      console.log('A√±adiendo evento al calendario:', eventData.title);\r\n      const newEvent = {\r\n        id: `event_${Date.now()}`,\r\n        ...eventData\r\n      };\r\n      this.events.push(newEvent);\r\n      return newEvent;\r\n    }\r\n  }\r\n};\r\n\r\n// Simulaci√≥n de componentes React para pruebas\r\nconst mockComponents = {\r\n  // Simula el comportamiento del componente EmailInbox\r\n  EmailInbox: {\r\n    name: 'EmailInbox',\r\n    simulate: function() {\r\n      console.log('\\n--- SIMULANDO INTERACCI√ìN CON BANDEJA DE ENTRADA ---');\r\n      \r\n      // Obtener emails\r\n      console.log('1. Cargando emails de la bandeja de entrada');\r\n      const emails = mockServices.EmailService.getMails('inbox');\r\n      console.log(`   ‚úì ${emails.length} emails recuperados`);\r\n      \r\n      // Seleccionar un email no le√≠do\r\n      const unreadEmail = emails.find(email => !email.read);\r\n      if (unreadEmail) {\r\n        console.log('2. Seleccionando email no le√≠do:', unreadEmail.subject);\r\n        \r\n        // Marcar como le√≠do\r\n        const updatedEmail = mockServices.EmailService.markAsRead(unreadEmail.id);\r\n        console.log('   ‚úì Email marcado como le√≠do');\r\n        \r\n        // Detectar posibles fechas y eventos\r\n        console.log('3. Detectando informaci√≥n de eventos en el email');\r\n        const hasEventInfo = unreadEmail.body.includes('sesi√≥n') && \r\n                            (unreadEmail.body.includes('fecha') || \r\n                             unreadEmail.body.match(/\\d{1,2}\\/\\d{1,2}\\/\\d{4}/));\r\n        \r\n        if (hasEventInfo) {\r\n          console.log('   ‚úì Informaci√≥n de evento detectada, sugerencia de a√±adir al calendario');\r\n        }\r\n      }\r\n      \r\n      // Comprobar emails importantes\r\n      const importantEmails = emails.filter(email => \r\n        email.folder === 'important' || \r\n        email.subject.toLowerCase().includes('urgente')\r\n      );\r\n      \r\n      console.log(`4. Emails importantes: ${importantEmails.length}`);\r\n      \r\n      return { success: true };\r\n    }\r\n  },\r\n  \r\n  // Simula el comportamiento del componente EmailComposer con plantillas\r\n  EmailComposer: {\r\n    name: 'EmailComposer',\r\n    simulate: function() {\r\n      console.log('\\n--- SIMULANDO CREACI√ìN DE EMAIL CON PLANTILLA ---');\r\n      \r\n      // Cargar plantillas disponibles\r\n      console.log('1. Cargando plantillas de email disponibles');\r\n      const templates = mockServices.EmailService.getEmailTemplates();\r\n      console.log(`   ‚úì ${templates.length} plantillas disponibles`);\r\n      \r\n      // Seleccionar una plantilla\r\n      const selectedTemplate = templates[0]; // Solicitud de informaci√≥n\r\n      console.log('2. Seleccionando plantilla:', selectedTemplate.name);\r\n      \r\n      // Rellenar variables de la plantilla\r\n      console.log('3. Rellenando variables de la plantilla');\r\n      const replacedSubject = selectedTemplate.subject\r\n        .replace('{{servicio}}', 'decoraci√≥n floral');\r\n      \r\n      const replacedBody = selectedTemplate.body\r\n        .replace('{{nombre_proveedor}}', 'Flores del Jard√≠n')\r\n        .replace('{{fecha_boda}}', '15/09/2025')\r\n        .replace('{{servicio}}', 'decoraci√≥n floral')\r\n        .replace('{{nombre_novia}}', 'Mar√≠a Garc√≠a');\r\n      \r\n      console.log('   ‚úì Variables reemplazadas correctamente');\r\n      \r\n      // Enviar email\r\n      console.log('4. Enviando email basado en plantilla');\r\n      const sentEmail = mockServices.EmailService.sendMail({\r\n        to: 'flores.jardin@ejemplo.com',\r\n        subject: replacedSubject,\r\n        body: replacedBody\r\n      });\r\n      \r\n      console.log('   ‚úì Email enviado correctamente con ID:', sentEmail.id);\r\n      \r\n      return { success: true, emailId: sentEmail.id };\r\n    }\r\n  },\r\n  \r\n  // Simula el comportamiento del componente de integraci√≥n con calendario\r\n  CalendarIntegration: {\r\n    name: 'CalendarIntegration',\r\n    simulate: function() {\r\n      console.log('\\n--- SIMULANDO INTEGRACI√ìN CON CALENDARIO ---');\r\n      \r\n      // Seleccionar un email con informaci√≥n de evento\r\n      console.log('1. Seleccionando email con informaci√≥n de evento');\r\n      const emailWithEvent = mockServices.EmailService.getMailDetails('email_001');\r\n      console.log(`   ‚úì Email seleccionado: \"${emailWithEvent.subject}\"`);\r\n      \r\n      // Extraer informaci√≥n de fecha y hora\r\n      console.log('2. Extrayendo informaci√≥n de fecha y hora del email');\r\n      const dateMatch = emailWithEvent.body.match(/(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})/);\r\n      const timeMatch = emailWithEvent.body.match(/(\\d{1,2}):(\\d{2})/);\r\n      \r\n      let extractedDate = '';\r\n      let extractedTime = '';\r\n      \r\n      if (dateMatch) {\r\n        // Formato YYYY-MM-DD para fecha\r\n        extractedDate = `${dateMatch[3]}-${dateMatch[2].padStart(2, '0')}-${dateMatch[1].padStart(2, '0')}`;\r\n        console.log(`   ‚úì Fecha detectada: ${extractedDate}`);\r\n      }\r\n      \r\n      if (timeMatch) {\r\n        // Formato HH:MM para hora\r\n        extractedTime = `${timeMatch[1].padStart(2, '0')}:${timeMatch[2]}`;\r\n        console.log(`   ‚úì Hora detectada: ${extractedTime}`);\r\n      }\r\n      \r\n      // Extraer informaci√≥n de ubicaci√≥n\r\n      console.log('3. Extrayendo informaci√≥n de ubicaci√≥n');\r\n      const locationMatch = emailWithEvent.body.match(/en ([^.,<]+)/);\r\n      const extractedLocation = locationMatch ? locationMatch[1].trim() : '';\r\n      \r\n      if (extractedLocation) {\r\n        console.log(`   ‚úì Ubicaci√≥n detectada: ${extractedLocation}`);\r\n      }\r\n      \r\n      // Crear evento en calendario\r\n      console.log('4. Creando evento en el calendario');\r\n      const newEvent = mockServices.CalendarService.addEvent({\r\n        title: `Sesi√≥n de fotos - ${emailWithEvent.from.split('@')[0]}`,\r\n        dateTime: `${extractedDate}T${extractedTime}:00`,\r\n        location: extractedLocation,\r\n        description: `Evento creado autom√°ticamente desde email: \"${emailWithEvent.subject}\"`,\r\n        attendees: ['Mar√≠a Garc√≠a', 'Fot√≥grafo'],\r\n        providerRelated: true,\r\n        providerId: emailWithEvent.providerId\r\n      });\r\n      \r\n      console.log('   ‚úì Evento a√±adido al calendario con ID:', newEvent.id);\r\n      \r\n      return { success: true, eventId: newEvent.id };\r\n    }\r\n  }\r\n};\r\n\r\n// Ejecutar prueba completa de integraci√≥n\r\nasync function runIntegrationTest() {\r\n  console.log('==========================================================');\r\n  console.log('= PRUEBA DE INTEGRACI√ìN DEL SISTEMA DE EMAILS DE LOVENDA =');\r\n  console.log('==========================================================');\r\n  \r\n  try {\r\n    // Probar la bandeja de entrada unificada\r\n    const inboxResult = mockComponents.EmailInbox.simulate();\r\n    \r\n    // Probar el compositor con plantillas\r\n    const composerResult = mockComponents.EmailComposer.simulate();\r\n    \r\n    // Probar la integraci√≥n con calendario\r\n    const calendarResult = mockComponents.CalendarIntegration.simulate();\r\n    \r\n    // Verificar resultados\r\n    console.log('\\n--- RESULTADOS DE LA PRUEBA DE INTEGRACI√ìN ---');\r\n    console.log(`1. Bandeja de entrada: ${inboxResult.success ? '‚úÖ CORRECTO' : '‚ùå FALL√ì'}`);\r\n    console.log(`2. Compositor con plantillas: ${composerResult.success ? '‚úÖ CORRECTO' : '‚ùå FALL√ì'}`);\r\n    console.log(`3. Integraci√≥n con calendario: ${calendarResult.success ? '‚úÖ CORRECTO' : '‚ùå FALL√ì'}`);\r\n    \r\n    console.log('\\nPrueba de integraci√≥n completada correctamente.');\r\n    console.log('El sistema de emails personalizado de MyWed360 funciona seg√∫n lo esperado.');\r\n    \r\n  } catch (error) {\r\n    console.error('\\n‚ùå ERROR EN LA PRUEBA DE INTEGRACI√ìN:', error);\r\n  }\r\n}\r\n\r\n// Ejecutar la prueba\r\nrunIntegrationTest();\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\email-system-test.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'body' is defined but never used. Allowed unused args must match /^_/u.","line":25,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":39},{"ruleId":"no-unused-vars","severity":1,"message":"'EmailTrackingService' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":43,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":43,"endColumn":27},{"ruleId":"no-undef","severity":2,"message":"'createTrackingRecord' is not defined.","line":116,"column":36,"nodeType":"Identifier","messageId":"undef","endLine":116,"endColumn":56}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Script de validaci√≥n del sistema de emails personalizado de MyWed360\r\n// Ejecutar con: node email-system-test.js\r\n\r\n// Nota: Este script est√° dise√±ado para probar la l√≥gica, pero requiere adaptaciones\r\n// para ejecutarse fuera del entorno de React debido a las dependencias de entorno\r\n\r\n// Simulaci√≥n de servicios para pruebas\r\nconst EmailService = {\r\n  initEmailService: (profile) => {\r\n    // Simula la l√≥gica de generaci√≥n de emails\r\n    if (profile.emailAlias) {\r\n      return `${profile.emailAlias}@lovenda.com`;\r\n    }\r\n    \r\n    if (profile.brideFirstName && profile.brideLastName) {\r\n      const normalizedName = `${profile.brideFirstName.toLowerCase()}.${profile.brideLastName.toLowerCase()}`\r\n        .normalize('NFD').replace(/[\\u0300-\\u036f]/g, '') // Eliminar acentos\r\n        .replace(/[^a-z0-9.]/g, '.'); // Reemplazar caracteres no permitidos\r\n      return `${normalizedName}@lovenda.com`;\r\n    }\r\n    \r\n    return `user${profile.userId}@lovenda.com`;\r\n  },\r\n  \r\n  sendMail: async ({ to, subject, body }) => {\r\n    console.log('\\nSimulando env√≠o de email:');\r\n    console.log(`A: ${to}`);\r\n    console.log(`Asunto: ${subject}`);\r\n    console.log('Contenido: [Contenido HTML omitido]');\r\n    \r\n    // Simular respuesta exitosa\r\n    return {\r\n      id: 'email_' + Math.random().toString(36).substring(2, 10),\r\n      from: 'usuario@lovenda.com',\r\n      to,\r\n      subject,\r\n      date: new Date().toISOString(),\r\n      status: 'sent'\r\n    };\r\n  }\r\n};\r\n\r\nconst EmailTrackingService = {\r\n  createTrackingRecord: async (email, provider) => {\r\n    console.log('\\nCreando registro de seguimiento:');\r\n    console.log(`Email ID: ${email.id}`);\r\n    console.log(`Proveedor: ${provider.name} (${provider.id})`);\r\n    \r\n    return {\r\n      id: 'track_' + Math.random().toString(36).substring(2, 10),\r\n      emailId: email.id,\r\n      providerId: provider.id,\r\n      providerName: provider.name,\r\n      status: 'waiting',\r\n      lastEmailDate: new Date().toISOString(),\r\n      thread: [{ emailId: email.id, direction: 'outgoing', date: new Date().toISOString() }]\r\n    };\r\n  }\r\n};\r\n\r\n// Perfil de usuario de prueba\r\nconst testUserProfile = {\r\n  userId: '1234',\r\n  brideFirstName: 'Mar√≠a',\r\n  brideLastName: 'Garc√≠a',\r\n  weddingDate: '2025-09-15',\r\n  emailAlias: '', // Dejar vac√≠o para probar la generaci√≥n autom√°tica\r\n};\r\n\r\n// Proveedor de prueba\r\nconst testProvider = {\r\n  id: 'prov123',\r\n  name: 'Fotograf√≠a Momentos',\r\n  email: 'test@provider.com',\r\n  service: 'fotograf√≠a',\r\n  phone: '555-123456',\r\n  contact: 'Juan P√©rez'\r\n};\r\n\r\n// Inicializa la prueba\r\nasync function runEmailTest() {\r\n  console.log('=== Iniciando prueba del sistema de emails de MyWed360 ===');\r\n  \r\n  try {\r\n    // 1. Inicializar el servicio con el perfil de usuario\r\n    const userEmail = EmailService.initEmailService(testUserProfile);\r\n    console.log(`‚úÖ Email de usuario generado: ${userEmail}`);\r\n    \r\n    // 2. Enviar un email de prueba\r\n    console.log('\\n>> Enviando email de prueba al proveedor...');\r\n    const emailSubject = `Consulta sobre servicios de fotograf√≠a para boda`;\r\n    const emailBody = `\r\n      <p>Estimado/a ${testProvider.name}:</p>\r\n      \r\n      <p>Mi nombre es ${testUserProfile.brideFirstName} ${testUserProfile.brideLastName} y me pongo en contacto con ustedes porque estoy organizando mi boda.</p>\r\n      \r\n      <p>He visto sus servicios de fotograf√≠a y me gustar√≠a obtener m√°s informaci√≥n.</p>\r\n      \r\n      <p>Saludos cordiales,<br>\r\n      ${testUserProfile.brideFirstName}</p>\r\n      \r\n      <p style=\"color:#888; font-size:12px;\">Email de prueba - Sistema MyWed360</p>\r\n    `;\r\n    \r\n    const emailResult = await EmailService.sendMail({\r\n      to: testProvider.email,\r\n      subject: emailSubject,\r\n      body: emailBody\r\n    });\r\n    \r\n    if (emailResult && emailResult.id) {\r\n      console.log(`‚úÖ Email enviado correctamente con ID: ${emailResult.id}`);\r\n      \r\n      // 3. Crear registro de seguimiento\r\n      console.log('\\n>> Creando registro de seguimiento...');\r\n      const trackingResult = await createTrackingRecord(emailResult, testProvider);\r\n      \r\n      if (trackingResult && trackingResult.id) {\r\n        console.log(`‚úÖ Registro de seguimiento creado con ID: ${trackingResult.id}`);\r\n        console.log(`   Estado inicial: ${trackingResult.status}`);\r\n        console.log(`   Fecha de seguimiento: ${trackingResult.lastEmailDate}`);\r\n      } else {\r\n        console.error('‚ùå Error al crear registro de seguimiento');\r\n      }\r\n      \r\n      // 4. Simular recepci√≥n de respuesta\r\n      console.log('\\n>> Simulando respuesta del proveedor...');\r\n      // Esta parte depende de la implementaci√≥n concreta del sistema\r\n      // En producci√≥n, esto ser√≠a autom√°tico al detectar un email entrante\r\n      console.log('‚ÑπÔ∏è En un entorno real, el sistema detectar√≠a autom√°ticamente la respuesta');\r\n      \r\n    } else {\r\n      console.error('‚ùå Error al enviar email');\r\n    }\r\n    \r\n  } catch (error) {\r\n    console.error('‚ùå Error en la prueba:', error);\r\n  }\r\n  \r\n  console.log('\\n=== Fin de la prueba ===');\r\n}\r\n\r\n// Ejecutar la prueba\r\nrunEmailTest()\r\n  .then(() => {\r\n    console.log('Prueba completada');\r\n    process.exit(0);\r\n  })\r\n  .catch(err => {\r\n    console.error('Error fatal en la prueba:', err);\r\n    process.exit(1);\r\n  });\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\helpers\\axeSetup.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\hooks\\useAIProviderEmail.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\integration\\EmailEdgeCases.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\integration\\EmailWorkflow.test.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'within' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":46,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":52}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { render, screen, fireEvent, waitFor, within } from '@testing-library/react';\r\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\r\nimport { BrowserRouter } from 'react-router-dom';\r\nimport userEvent from '@testing-library/user-event';\r\nimport { toast } from 'react-toastify';\r\n\r\n// Componentes a probar en integraci√≥n\r\nimport EmailInbox from '../../components/email/EmailInbox';\r\nimport EmailComposer from '../../components/email/EmailComposer';\r\nimport * as EmailService from '../../services/EmailService';\r\nimport * as TagService from '../../services/TagService';\r\nimport { useAuth } from '../../hooks/useAuth';\r\n\r\n// Mock de dependencias\r\nvi.mock('react-toastify', () => ({\r\n  toast: {\r\n    success: vi.fn(),\r\n    error: vi.fn(),\r\n    info: vi.fn()\r\n  }\r\n}));\r\n\r\nvi.mock('../../hooks/useAuth', () => ({\r\n  useAuth: vi.fn()\r\n}));\r\n\r\nvi.mock('../../services/EmailService', () => ({\r\n  initEmailService: vi.fn(),\r\n  getMails: vi.fn(),\r\n  sendMail: vi.fn(),\r\n  deleteMail: vi.fn(),\r\n  markAsRead: vi.fn(),\r\n  moveToFolder: vi.fn(),\r\n  createFolder: vi.fn(),\r\n  getFolders: vi.fn()\r\n}));\r\n\r\nvi.mock('../../services/TagService', () => ({\r\n  getTags: vi.fn(),\r\n  createTag: vi.fn(),\r\n  deleteTag: vi.fn(),\r\n  tagEmail: vi.fn(),\r\n  untagEmail: vi.fn(),\r\n  getEmailTags: vi.fn()\r\n}));\r\n\r\n// Mock de los componentes hijos que no son el foco de estas pruebas de integraci√≥n\r\nvi.mock('../../components/email/EmailDetail', () => ({\r\n  default: ({ email, onBack, onReply, onDelete, onMoveToFolder }) => (\r\n    <div data-testid=\"email-detail\">\r\n      {email && (\r\n        <div>\r\n          <div data-testid=\"email-subject\">{email.subject}</div>\r\n          <div data-testid=\"email-body\">{email.body}</div>\r\n          <button onClick={onBack}>Volver</button>\r\n          <button onClick={onReply}>Responder</button>\r\n          <button onClick={onDelete}>Eliminar</button>\r\n          <button onClick={() => onMoveToFolder(email.id, 'folder-1')}>Mover</button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}));\r\n\r\n// Helper para envolver componentes con el router\r\nconst renderWithRouter = (ui) => {\r\n  return render(<BrowserRouter>{ui}</BrowserRouter>);\r\n};\r\n\r\ndescribe('Pruebas de integraci√≥n del sistema de correo electr√≥nico', () => {\r\n  // Datos de ejemplo para las pruebas\r\n  const mockUser = {\r\n    uid: 'user123',\r\n    email: 'usuario@example.com',\r\n  };\r\n  \r\n  const mockProfile = {\r\n    id: 'profile123',\r\n    email: 'usuario@lovenda.app',\r\n    name: 'Usuario Test',\r\n  };\r\n  \r\n  const mockEmails = [\r\n    { \r\n      id: 'email-1', \r\n      subject: 'Propuesta de colaboraci√≥n', \r\n      from: 'socio@empresa.com',\r\n      to: 'usuario@lovenda.app',\r\n      date: '2025-07-10T10:30:00Z',\r\n      read: false,\r\n      body: '<p>Hola, me gustar√≠a discutir una posible colaboraci√≥n.</p>',\r\n      folder: 'inbox',\r\n      attachments: []\r\n    },\r\n    { \r\n      id: 'email-2', \r\n      subject: 'Confirmaci√≥n de pedido', \r\n      from: 'ventas@tienda.com',\r\n      to: 'usuario@lovenda.app',\r\n      date: '2025-07-09T08:15:00Z',\r\n      read: true,\r\n      body: '<p>Su pedido ha sido confirmado.</p>',\r\n      folder: 'inbox',\r\n      attachments: [{ filename: 'factura.pdf', size: 1024 * 100 }]\r\n    }\r\n  ];\r\n\r\n  const mockFolders = [\r\n    { id: 'inbox', name: 'Bandeja de entrada', system: true },\r\n    { id: 'sent', name: 'Enviados', system: true },\r\n    { id: 'folder-1', name: 'Trabajo', system: false },\r\n    { id: 'folder-2', name: 'Personal', system: false }\r\n  ];\r\n\r\n  const mockTags = [\r\n    { id: 'tag-1', name: 'Importante', color: '#f44336' },\r\n    { id: 'tag-2', name: 'Proyecto', color: '#4caf50' }\r\n  ];\r\n\r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n    \r\n    // Configurar los mocks\r\n    useAuth.mockReturnValue({\r\n      user: mockUser,\r\n      profile: mockProfile\r\n    });\r\n    \r\n    EmailService.getMails.mockResolvedValue(mockEmails);\r\n    EmailService.initEmailService.mockReturnValue('usuario@lovenda.app');\r\n    EmailService.getFolders.mockResolvedValue(mockFolders);\r\n    \r\n    TagService.getTags.mockResolvedValue(mockTags);\r\n    TagService.getEmailTags.mockImplementation((emailId) => {\r\n      return Promise.resolve(emailId === 'email-1' ? [mockTags[0]] : []);\r\n    });\r\n  });\r\n\r\n  // Prueba de flujo de recepci√≥n de correos\r\n  it('Muestra correctamente los emails recibidos y permite verlos en detalle', async () => {\r\n    renderWithRouter(<EmailInbox />);\r\n    \r\n    // Verificar que se est√°n cargando los emails\r\n    expect(screen.getByText(/cargando/i)).toBeInTheDocument();\r\n    \r\n    // Verificar que se cargan y muestran los emails recibidos\r\n    await waitFor(() => {\r\n      expect(screen.queryByText(/cargando/i)).not.toBeInTheDocument();\r\n      expect(EmailService.getMails).toHaveBeenCalledWith('inbox');\r\n    });\r\n    \r\n    expect(screen.getByText('Propuesta de colaboraci√≥n')).toBeInTheDocument();\r\n    expect(screen.getByText('Confirmaci√≥n de pedido')).toBeInTheDocument();\r\n    \r\n    // Verificar que se puede abrir un email para ver sus detalles\r\n    fireEvent.click(screen.getByText('Propuesta de colaboraci√≥n'));\r\n    \r\n    // Verificar que se muestra el detalle del email\r\n    expect(screen.getByTestId('email-subject')).toHaveTextContent('Propuesta de colaboraci√≥n');\r\n    expect(screen.getByTestId('email-body')).toHaveTextContent('Hola, me gustar√≠a discutir una posible colaboraci√≥n.');\r\n    \r\n    // Verificar que el email se marca como le√≠do\r\n    expect(EmailService.markAsRead).toHaveBeenCalledWith('email-1');\r\n    \r\n    // Volver a la bandeja de entrada\r\n    fireEvent.click(screen.getByText('Volver'));\r\n    \r\n    // Verificar que se ha vuelto a la lista\r\n    expect(screen.queryByTestId('email-detail')).not.toBeInTheDocument();\r\n    expect(screen.getByText('Propuesta de colaboraci√≥n')).toBeInTheDocument();\r\n  });\r\n\r\n  // Prueba de flujo de env√≠o de correos\r\n  it('Permite componer y enviar un nuevo correo', async () => {\r\n    // Mock para sendMail\r\n    EmailService.sendMail.mockResolvedValue({\r\n      id: 'new-email-1',\r\n      success: true\r\n    });\r\n\r\n    // Renderizar el compositor de emails (componente separado del inbox)\r\n    renderWithRouter(<EmailComposer />);\r\n    \r\n    // Rellenar el formulario\r\n    const toInput = screen.getByLabelText(/para/i);\r\n    const subjectInput = screen.getByLabelText(/asunto/i);\r\n    const bodyInput = screen.getByLabelText(/mensaje/i);\r\n    \r\n    await userEvent.type(toInput, 'destinatario@empresa.com');\r\n    await userEvent.type(subjectInput, 'Respuesta a propuesta');\r\n    await userEvent.type(bodyInput, 'Gracias por su propuesta. Estamos interesados.');\r\n    \r\n    // Enviar el correo\r\n    const sendButton = screen.getByRole('button', { name: /enviar/i });\r\n    fireEvent.click(sendButton);\r\n    \r\n    // Verificar que se llama al servicio de env√≠o\r\n    expect(EmailService.sendMail).toHaveBeenCalledWith({\r\n      to: 'destinatario@empresa.com',\r\n      subject: 'Respuesta a propuesta',\r\n      body: 'Gracias por su propuesta. Estamos interesados.',\r\n      from: 'usuario@lovenda.app',\r\n      attachments: []\r\n    });\r\n    \r\n    // Verificar que se muestra notificaci√≥n de √©xito\r\n    await waitFor(() => {\r\n      expect(toast.success).toHaveBeenCalledWith('Correo enviado correctamente');\r\n    });\r\n  });\r\n\r\n  // Prueba de organizaci√≥n: mover correo a carpeta\r\n  it('Permite mover un correo a otra carpeta', async () => {\r\n    // Mock para moveToFolder\r\n    EmailService.moveToFolder.mockResolvedValue(true);\r\n    \r\n    renderWithRouter(<EmailInbox />);\r\n    \r\n    // Esperar a que carguen los emails\r\n    await waitFor(() => {\r\n      expect(screen.queryByText(/cargando/i)).not.toBeInTheDocument();\r\n    });\r\n    \r\n    // Abrir un email\r\n    fireEvent.click(screen.getByText('Propuesta de colaboraci√≥n'));\r\n    \r\n    // Verificar que se muestra el detalle\r\n    expect(screen.getByTestId('email-subject')).toBeInTheDocument();\r\n    \r\n    // Mover a una carpeta\r\n    const moveButton = screen.getByText('Mover');\r\n    fireEvent.click(moveButton);\r\n    \r\n    // Verificar que se llama al servicio\r\n    expect(EmailService.moveToFolder).toHaveBeenCalledWith('email-1', 'folder-1');\r\n    \r\n    // Verificar que se actualiza la lista de correos\r\n    await waitFor(() => {\r\n      expect(EmailService.getMails).toHaveBeenCalledTimes(2);\r\n    });\r\n  });\r\n\r\n  // Prueba de filtrado por carpeta\r\n  it('Permite filtrar emails por carpeta', async () => {\r\n    // Configurar el mock para devolver diferentes emails seg√∫n la carpeta\r\n    EmailService.getMails.mockImplementation((folder) => {\r\n      if (folder === 'sent') {\r\n        return Promise.resolve([\r\n          {\r\n            id: 'sent-1',\r\n            subject: 'Email enviado',\r\n            from: 'usuario@lovenda.app',\r\n            to: 'contacto@empresa.com',\r\n            date: '2025-07-08T09:20:00Z',\r\n            read: true,\r\n            folder: 'sent'\r\n          }\r\n        ]);\r\n      }\r\n      return Promise.resolve(mockEmails);\r\n    });\r\n    \r\n    renderWithRouter(<EmailInbox />);\r\n    \r\n    // Esperar a que carguen los emails\r\n    await waitFor(() => {\r\n      expect(screen.queryByText(/cargando/i)).not.toBeInTheDocument();\r\n    });\r\n    \r\n    // Verificar emails en bandeja de entrada\r\n    expect(screen.getByText('Propuesta de colaboraci√≥n')).toBeInTheDocument();\r\n    \r\n    // Cambiar a carpeta Enviados\r\n    const sentFolder = screen.getByText(/enviados/i);\r\n    fireEvent.click(sentFolder);\r\n    \r\n    // Verificar que se cargan los emails enviados\r\n    await waitFor(() => {\r\n      expect(EmailService.getMails).toHaveBeenCalledWith('sent');\r\n      expect(screen.getByText('Email enviado')).toBeInTheDocument();\r\n      expect(screen.queryByText('Propuesta de colaboraci√≥n')).not.toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  // Prueba de integraci√≥n con etiquetas\r\n  it('Muestra y permite gestionar etiquetas en los correos', async () => {\r\n    // Mock para las operaciones de etiquetas\r\n    TagService.tagEmail.mockResolvedValue(true);\r\n    \r\n    renderWithRouter(<EmailInbox />);\r\n    \r\n    // Esperar a que carguen los emails\r\n    await waitFor(() => {\r\n      expect(screen.queryByText(/cargando/i)).not.toBeInTheDocument();\r\n    });\r\n    \r\n    // Verificar que se muestran las etiquetas existentes en los correos\r\n    expect(screen.getByText('Importante')).toBeInTheDocument();\r\n    \r\n    // Abrir un email para gestionar sus etiquetas\r\n    fireEvent.click(screen.getByText('Confirmaci√≥n de pedido'));\r\n    \r\n    // Verificar que se cargan las etiquetas del correo\r\n    await waitFor(() => {\r\n      expect(TagService.getEmailTags).toHaveBeenCalledWith('email-2');\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\performance-test.js","messages":[{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":78,"column":7,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":78,"endColumn":45},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":98,"column":7,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":98,"endColumn":57},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":115,"column":7,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":115,"endColumn":50},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":131,"column":7,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":131,"endColumn":52},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":146,"column":7,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":146,"endColumn":56},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":344,"column":32,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":344,"endColumn":33,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12794,12795],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12794,12794],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":344,"column":34,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":344,"endColumn":35,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12796,12797],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12796,12796],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":344,"column":47,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":344,"endColumn":48,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12809,12810],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12809,12809],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":344,"column":49,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":344,"endColumn":50,"suggestions":[{"messageId":"removeEscape","fix":{"range":[12811,12812],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[12811,12811],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'dummy' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":439,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":439,"endColumn":18}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Script de pruebas de rendimiento para el sistema de emails de MyWed360\r\n * \r\n * Este script simula cargas de datos y uso intensivo para evaluar\r\n * el rendimiento y la escalabilidad de los componentes implementados.\r\n */\r\n\r\n// Importar dependencias necesarias\r\nconst fs = require('fs');\r\nconst path = require('path');\r\nconst { performance } = require('perf_hooks');\r\n\r\n// Configuraci√≥n de la prueba\r\nconst CONFIG = {\r\n  // N√∫mero de emails a generar para las pruebas\r\n  emailCount: {\r\n    small: 100,\r\n    medium: 1000,\r\n    large: 10000\r\n  },\r\n  \r\n  // N√∫mero de notificaciones para las pruebas\r\n  notificationCount: {\r\n    small: 50,\r\n    medium: 500,\r\n    large: 2000\r\n  },\r\n  \r\n  // N√∫mero de eventos para las pruebas\r\n  eventCount: {\r\n    small: 20,\r\n    medium: 200,\r\n    large: 1000\r\n  },\r\n  \r\n  // N√∫mero de proveedores para las pruebas\r\n  providerCount: {\r\n    small: 10,\r\n    medium: 50,\r\n    large: 200\r\n  },\r\n  \r\n  // N√∫mero de plantillas para las pruebas\r\n  templateCount: {\r\n    small: 5,\r\n    medium: 20,\r\n    large: 100\r\n  },\r\n  \r\n  // Tama√±o del cuerpo de email (en caracteres) para las pruebas\r\n  emailBodySize: {\r\n    small: 1000,\r\n    medium: 10000,\r\n    large: 50000\r\n  },\r\n  \r\n  // Directorio para guardar resultados\r\n  outputDir: './performance-results',\r\n  \r\n  // N√∫mero de repeticiones para cada prueba (para obtener promedio)\r\n  repetitions: 5\r\n};\r\n\r\n// Crear directorio de resultados si no existe\r\nif (!fs.existsSync(CONFIG.outputDir)) {\r\n  fs.mkdirSync(CONFIG.outputDir, { recursive: true });\r\n}\r\n\r\n// Funci√≥n para generar datos aleatorios\r\nfunction generateTestData(type, size = 'medium') {\r\n  console.log(`Generando datos de prueba: ${type}, tama√±o: ${size}`);\r\n  \r\n  const startTime = performance.now();\r\n  let result = [];\r\n  \r\n  switch (type) {\r\n    case 'emails':\r\n      const count = CONFIG.emailCount[size];\r\n      for (let i = 0; i < count; i++) {\r\n        result.push({\r\n          id: `email_${i}`,\r\n          from: `sender${i % 100}@example.com`,\r\n          to: 'usuario@lovenda.com',\r\n          subject: `Asunto de prueba #${i} para evaluaci√≥n de rendimiento`,\r\n          body: generateRandomText(CONFIG.emailBodySize[size]),\r\n          date: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString(),\r\n          read: Math.random() > 0.3,\r\n          folder: ['inbox', 'sent', 'drafts', 'important'][Math.floor(Math.random() * 4)],\r\n          attachments: Math.random() > 0.7 ? [\r\n            { name: 'documento.pdf', size: Math.floor(Math.random() * 5000000) }\r\n          ] : [],\r\n          providerId: Math.random() > 0.5 ? `prov_${Math.floor(Math.random() * CONFIG.providerCount[size])}` : null\r\n        });\r\n      }\r\n      break;\r\n      \r\n    case 'notifications':\r\n      const notifCount = CONFIG.notificationCount[size];\r\n      for (let i = 0; i < notifCount; i++) {\r\n        result.push({\r\n          id: `notif_${i}`,\r\n          type: ['email', 'event', 'provider', 'system'][Math.floor(Math.random() * 4)],\r\n          message: `Notificaci√≥n de prueba #${i} para evaluaci√≥n de rendimiento`,\r\n          timestamp: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000).toISOString(),\r\n          read: Math.random() > 0.4,\r\n          action: Math.random() > 0.6 ? ['viewEmail', 'viewEvent', 'viewProvider'][Math.floor(Math.random() * 3)] : null,\r\n          emailId: Math.random() > 0.6 ? `email_${Math.floor(Math.random() * CONFIG.emailCount[size])}` : null,\r\n          eventId: Math.random() > 0.7 ? `event_${Math.floor(Math.random() * CONFIG.eventCount[size])}` : null,\r\n          providerId: Math.random() > 0.8 ? `prov_${Math.floor(Math.random() * CONFIG.providerCount[size])}` : null\r\n        });\r\n      }\r\n      break;\r\n      \r\n    case 'events':\r\n      const eventCount = CONFIG.eventCount[size];\r\n      for (let i = 0; i < eventCount; i++) {\r\n        result.push({\r\n          id: `event_${i}`,\r\n          title: `Evento de prueba #${i} para evaluaci√≥n de rendimiento`,\r\n          dateTime: new Date(Date.now() + Math.random() * 90 * 24 * 60 * 60 * 1000).toISOString(),\r\n          location: `Ubicaci√≥n de prueba #${Math.floor(Math.random() * 20)}`,\r\n          description: generateRandomText(Math.floor(Math.random() * 500)),\r\n          attendees: Array.from({ length: Math.floor(Math.random() * 10) }, (_, j) => `Asistente ${j}`),\r\n          providerRelated: Math.random() > 0.6,\r\n          providerId: Math.random() > 0.6 ? `prov_${Math.floor(Math.random() * CONFIG.providerCount[size])}` : null\r\n        });\r\n      }\r\n      break;\r\n      \r\n    case 'providers':\r\n      const provCount = CONFIG.providerCount[size];\r\n      for (let i = 0; i < provCount; i++) {\r\n        result.push({\r\n          id: `prov_${i}`,\r\n          name: `Proveedor de prueba #${i}`,\r\n          type: ['Catering', 'Fotograf√≠a', 'Flores', 'M√∫sica', 'Decoraci√≥n'][Math.floor(Math.random() * 5)],\r\n          contact: `proveedor${i}@ejemplo.com`,\r\n          phone: `+34 ${Math.floor(Math.random() * 900000000) + 600000000}`,\r\n          description: generateRandomText(Math.floor(Math.random() * 300) + 200),\r\n          rating: Math.floor(Math.random() * 5) + 1\r\n        });\r\n      }\r\n      break;\r\n      \r\n    case 'templates':\r\n      const templateCount = CONFIG.templateCount[size];\r\n      for (let i = 0; i < templateCount; i++) {\r\n        result.push({\r\n          id: `template_${i}`,\r\n          name: `Plantilla de prueba #${i}`,\r\n          category: ['Proveedores - Solicitud de informaci√≥n', 'Proveedores - Confirmaci√≥n', 'General'][Math.floor(Math.random() * 3)],\r\n          subject: `Asunto de plantilla #${i}: {{variable1}}`,\r\n          body: `<p>Estimado/a {{nombre_proveedor}}:</p>\r\n          <p>${generateRandomText(Math.floor(Math.random() * 500) + 500)}</p>\r\n          <p>La fecha ser√≠a {{fecha_evento}} y necesitar√≠amos {{servicio}}.</p>\r\n          <p>Saludos cordiales,</p>\r\n          <p>{{nombre_usuario}}</p>`,\r\n          variables: ['variable1', 'nombre_proveedor', 'fecha_evento', 'servicio', 'nombre_usuario'],\r\n          isSystem: Math.random() > 0.8\r\n        });\r\n      }\r\n      break;\r\n  }\r\n  \r\n  const endTime = performance.now();\r\n  console.log(`‚úÖ Generados ${result.length} elementos en ${((endTime - startTime) / 1000).toFixed(2)} segundos`);\r\n  \r\n  return result;\r\n}\r\n\r\n// Funci√≥n para generar texto aleatorio\r\nfunction generateRandomText(length) {\r\n  const lorem = `Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.`;\r\n  \r\n  let result = '';\r\n  while (result.length < length) {\r\n    result += lorem;\r\n  }\r\n  \r\n  return result.substring(0, length);\r\n}\r\n\r\n// Funci√≥n para ejecutar pruebas de rendimiento\r\nasync function runPerformanceTest(testName, testFunction, params = {}, size = 'medium') {\r\n  console.log(`\\n=============================================`);\r\n  console.log(`INICIANDO PRUEBA: ${testName} (tama√±o: ${size})`);\r\n  console.log(`=============================================`);\r\n  \r\n  const results = {\r\n    testName,\r\n    size,\r\n    params,\r\n    times: [],\r\n    avgTime: 0,\r\n    minTime: Number.MAX_SAFE_INTEGER,\r\n    maxTime: 0,\r\n    metadata: {}\r\n  };\r\n  \r\n  // Ejecutar prueba varias veces para obtener un promedio\r\n  for (let i = 0; i < CONFIG.repetitions; i++) {\r\n    console.log(`Ejecuci√≥n ${i + 1}/${CONFIG.repetitions}`);\r\n    \r\n    const startTime = performance.now();\r\n    const testResult = await testFunction(params);\r\n    const endTime = performance.now();\r\n    \r\n    const executionTime = endTime - startTime;\r\n    results.times.push(executionTime);\r\n    results.minTime = Math.min(results.minTime, executionTime);\r\n    results.maxTime = Math.max(results.maxTime, executionTime);\r\n    \r\n    // Guardar metadata adicional del resultado si existe\r\n    if (testResult && testResult.metadata) {\r\n      results.metadata = { ...results.metadata, ...testResult.metadata };\r\n    }\r\n    \r\n    console.log(`‚úÖ Completado en ${(executionTime / 1000).toFixed(2)} segundos`);\r\n  }\r\n  \r\n  // Calcular promedio\r\n  results.avgTime = results.times.reduce((sum, time) => sum + time, 0) / results.times.length;\r\n  \r\n  // Guardar resultados\r\n  const resultsPath = path.join(CONFIG.outputDir, `${testName.toLowerCase().replace(/\\s+/g, '_')}_${size}.json`);\r\n  fs.writeFileSync(resultsPath, JSON.stringify(results, null, 2));\r\n  \r\n  console.log(`\\nüìä RESULTADOS DE LA PRUEBA: ${testName}`);\r\n  console.log(`Tiempo promedio: ${(results.avgTime / 1000).toFixed(2)} segundos`);\r\n  console.log(`Tiempo m√≠nimo: ${(results.minTime / 1000).toFixed(2)} segundos`);\r\n  console.log(`Tiempo m√°ximo: ${(results.maxTime / 1000).toFixed(2)} segundos`);\r\n  console.log(`Resultados guardados en: ${resultsPath}\\n`);\r\n  \r\n  return results;\r\n}\r\n\r\n// Prueba: B√∫squeda global\r\nasync function testGlobalSearch(params) {\r\n  const { emails, events, providers, query } = params;\r\n  console.log(`Probando b√∫squeda con ${emails.length} emails, ${events.length} eventos, ${providers.length} proveedores`);\r\n  console.log(`T√©rmino de b√∫squeda: \"${query}\"`);\r\n  \r\n  // Simulaci√≥n de b√∫squeda\r\n  const results = {\r\n    emails: [],\r\n    events: [],\r\n    providers: []\r\n  };\r\n  \r\n  // Buscar en emails\r\n  const emailResults = emails.filter(email => \r\n    email.subject.toLowerCase().includes(query.toLowerCase()) || \r\n    email.body.toLowerCase().includes(query.toLowerCase()) ||\r\n    email.from.toLowerCase().includes(query.toLowerCase())\r\n  );\r\n  results.emails = emailResults.slice(0, 5);\r\n  \r\n  // Buscar en eventos\r\n  const eventResults = events.filter(event => \r\n    event.title.toLowerCase().includes(query.toLowerCase()) || \r\n    event.description.toLowerCase().includes(query.toLowerCase()) ||\r\n    event.location.toLowerCase().includes(query.toLowerCase())\r\n  );\r\n  results.events = eventResults.slice(0, 5);\r\n  \r\n  // Buscar en proveedores\r\n  const providerResults = providers.filter(provider => \r\n    provider.name.toLowerCase().includes(query.toLowerCase()) || \r\n    provider.type.toLowerCase().includes(query.toLowerCase()) ||\r\n    provider.description.toLowerCase().includes(query.toLowerCase())\r\n  );\r\n  results.providers = providerResults.slice(0, 5);\r\n  \r\n  return {\r\n    resultsCount: results.emails.length + results.events.length + results.providers.length,\r\n    metadata: {\r\n      totalMatches: emailResults.length + eventResults.length + providerResults.length,\r\n      emailMatches: emailResults.length,\r\n      eventMatches: eventResults.length,\r\n      providerMatches: providerResults.length\r\n    }\r\n  };\r\n}\r\n\r\n// Prueba: Filtrado y ordenaci√≥n de emails\r\nasync function testEmailFiltering(params) {\r\n  const { emails, filterCriteria } = params;\r\n  console.log(`Probando filtrado con ${emails.length} emails`);\r\n  console.log(`Criterios: ${JSON.stringify(filterCriteria)}`);\r\n  \r\n  // Aplicar filtros\r\n  let filteredEmails = [...emails];\r\n  \r\n  if (filterCriteria.folder) {\r\n    filteredEmails = filteredEmails.filter(email => email.folder === filterCriteria.folder);\r\n  }\r\n  \r\n  if (filterCriteria.read !== undefined) {\r\n    filteredEmails = filteredEmails.filter(email => email.read === filterCriteria.read);\r\n  }\r\n  \r\n  if (filterCriteria.hasAttachments !== undefined) {\r\n    filteredEmails = filteredEmails.filter(email => \r\n      filterCriteria.hasAttachments ? (email.attachments && email.attachments.length > 0) : (!email.attachments || email.attachments.length === 0)\r\n    );\r\n  }\r\n  \r\n  if (filterCriteria.fromProvider !== undefined) {\r\n    filteredEmails = filteredEmails.filter(email => \r\n      filterCriteria.fromProvider ? !!email.providerId : !email.providerId\r\n    );\r\n  }\r\n  \r\n  // Ordenar resultados\r\n  if (filterCriteria.sortBy) {\r\n    filteredEmails.sort((a, b) => {\r\n      if (filterCriteria.sortBy === 'date') {\r\n        return filterCriteria.sortOrder === 'asc' \r\n          ? new Date(a.date) - new Date(b.date)\r\n          : new Date(b.date) - new Date(a.date);\r\n      }\r\n      return 0;\r\n    });\r\n  }\r\n  \r\n  return {\r\n    filteredCount: filteredEmails.length,\r\n    metadata: {\r\n      originalCount: emails.length,\r\n      reductionPercentage: ((emails.length - filteredEmails.length) / emails.length * 100).toFixed(2) + '%'\r\n    }\r\n  };\r\n}\r\n\r\n// Prueba: Detecci√≥n de eventos en emails\r\nasync function testEventDetection(params) {\r\n  const { emails } = params;\r\n  console.log(`Probando detecci√≥n de eventos con ${emails.length} emails`);\r\n  \r\n  let detectedEvents = 0;\r\n  let processedEmails = 0;\r\n  \r\n  // Expresiones regulares para detectar fechas y horas\r\n  const dateRegex = /(\\d{1,2})[\\/\\-](\\d{1,2})[\\/\\-](\\d{4})|(\\d{1,2}) de ([a-z√°-√∫√±]+)( de (\\d{4}))?/gi;\r\n  const timeRegex = /(\\d{1,2}):(\\d{2})( ?(?:AM|PM|a\\.m\\.|p\\.m\\.))?/gi;\r\n  \r\n  for (const email of emails) {\r\n    processedEmails++;\r\n    \r\n    // Comprobar si el email contiene fecha y hora (potencial evento)\r\n    const hasDate = dateRegex.test(email.body);\r\n    dateRegex.lastIndex = 0; // Reiniciar √≠ndice\r\n    \r\n    const hasTime = timeRegex.test(email.body);\r\n    timeRegex.lastIndex = 0; // Reiniciar √≠ndice\r\n    \r\n    if (hasDate && hasTime) {\r\n      detectedEvents++;\r\n    }\r\n    \r\n    // Para simular procesamiento y no bloquear completamente\r\n    if (processedEmails % 100 === 0) {\r\n      await new Promise(resolve => setTimeout(resolve, 1));\r\n    }\r\n  }\r\n  \r\n  return {\r\n    detectedEvents,\r\n    metadata: {\r\n      totalEmails: emails.length,\r\n      detectionRate: ((detectedEvents / emails.length) * 100).toFixed(2) + '%'\r\n    }\r\n  };\r\n}\r\n\r\n// Prueba: Aplicaci√≥n de plantillas con variables\r\nasync function testTemplateApplication(params) {\r\n  const { templates, variables } = params;\r\n  console.log(`Probando aplicaci√≥n de plantillas con ${templates.length} plantillas`);\r\n  \r\n  const results = [];\r\n  \r\n  for (const template of templates) {\r\n    let subject = template.subject;\r\n    let body = template.body;\r\n    \r\n    // Reemplazar variables\r\n    for (const [key, value] of Object.entries(variables)) {\r\n      const regex = new RegExp(`{{${key}}}`, 'g');\r\n      subject = subject.replace(regex, value);\r\n      body = body.replace(regex, value);\r\n    }\r\n    \r\n    results.push({\r\n      templateId: template.id,\r\n      processedSubject: subject,\r\n      // No incluir el cuerpo completo para no sobrecargar los resultados\r\n      bodyLength: body.length,\r\n      variablesReplaced: Object.keys(variables).length\r\n    });\r\n  }\r\n  \r\n  return {\r\n    processedCount: results.length,\r\n    metadata: {\r\n      averageBodyLength: results.reduce((sum, item) => sum + item.bodyLength, 0) / results.length\r\n    }\r\n  };\r\n}\r\n\r\n// Prueba: Carga y renderizado de notificaciones\r\nasync function testNotificationRendering(params) {\r\n  const { notifications, batchSize } = params;\r\n  console.log(`Probando renderizado de notificaciones con ${notifications.length} notificaciones`);\r\n  \r\n  const batches = [];\r\n  for (let i = 0; i < notifications.length; i += batchSize) {\r\n    batches.push(notifications.slice(i, i + batchSize));\r\n  }\r\n  \r\n  let totalRenderTime = 0;\r\n  \r\n  for (let i = 0; i < batches.length; i++) {\r\n    const batch = batches[i];\r\n    const startTime = performance.now();\r\n    \r\n    // Simular renderizado procesando cada notificaci√≥n\r\n    for (const notification of batch) {\r\n      // Operaciones para simular procesamiento del renderizado\r\n      const formattedTimestamp = new Date(notification.timestamp).toLocaleString();\r\n      const isHighPriority = !notification.read && ['email', 'system'].includes(notification.type);\r\n      const actionUrl = notification.action \r\n        ? `/${notification.action.replace('view', '').toLowerCase()}/${\r\n            notification.emailId || notification.eventId || notification.providerId\r\n          }`\r\n        : '';\r\n      \r\n      // Simular creaci√≥n de elementos DOM\r\n      const dummy = {\r\n        type: notification.type,\r\n        message: notification.message,\r\n        timestamp: formattedTimestamp,\r\n        priority: isHighPriority ? 'high' : 'normal',\r\n        url: actionUrl,\r\n        read: notification.read\r\n      };\r\n    }\r\n    \r\n    const endTime = performance.now();\r\n    totalRenderTime += (endTime - startTime);\r\n    \r\n    // Para simular procesamiento y no bloquear completamente\r\n    await new Promise(resolve => setTimeout(resolve, 1));\r\n  }\r\n  \r\n  return {\r\n    batchCount: batches.length,\r\n    averageBatchRenderTime: totalRenderTime / batches.length,\r\n    metadata: {\r\n      totalNotifications: notifications.length,\r\n      batchSize,\r\n      estimatedDOMElements: notifications.length * 5 // Aproximaci√≥n de elementos DOM por notificaci√≥n\r\n    }\r\n  };\r\n}\r\n\r\n// Funci√≥n principal\r\nasync function runAllTests() {\r\n  console.log(`\r\n  =======================================================\r\n  üöÄ INICIANDO PRUEBAS DE RENDIMIENTO DE LOVENDA EMAIL\r\n  =======================================================\r\n  \r\n  Configuraci√≥n:\r\n  - Repeticiones por prueba: ${CONFIG.repetitions}\r\n  - Directorio de resultados: ${CONFIG.outputDir}\r\n  \r\n  =======================================================\r\n  `);\r\n  \r\n  const startTime = performance.now();\r\n  const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\r\n  \r\n  // Crear datos de prueba para cada tama√±o\r\n  const testSizes = ['small', 'medium', 'large'];\r\n  const testData = {};\r\n  \r\n  for (const size of testSizes) {\r\n    testData[size] = {\r\n      emails: generateTestData('emails', size),\r\n      notifications: generateTestData('notifications', size),\r\n      events: generateTestData('events', size),\r\n      providers: generateTestData('providers', size),\r\n      templates: generateTestData('templates', size)\r\n    };\r\n  }\r\n  \r\n  // Ejecutar pruebas para cada tama√±o\r\n  const allResults = {};\r\n  \r\n  for (const size of testSizes) {\r\n    console.log(`\\n\\n=======================================================`);\r\n    console.log(`EJECUTANDO PRUEBAS CON TAMA√ëO DE DATOS: ${size.toUpperCase()}`);\r\n    console.log(`=======================================================\\n`);\r\n    \r\n    // Prueba de b√∫squeda global\r\n    allResults[`globalSearch_${size}`] = await runPerformanceTest(\r\n      'B√∫squeda global',\r\n      testGlobalSearch,\r\n      {\r\n        emails: testData[size].emails,\r\n        events: testData[size].events,\r\n        providers: testData[size].providers,\r\n        query: 'prueba'\r\n      },\r\n      size\r\n    );\r\n    \r\n    // Prueba de filtrado y ordenaci√≥n de emails\r\n    allResults[`emailFiltering_${size}`] = await runPerformanceTest(\r\n      'Filtrado de emails',\r\n      testEmailFiltering,\r\n      {\r\n        emails: testData[size].emails,\r\n        filterCriteria: {\r\n          folder: 'inbox',\r\n          read: false,\r\n          hasAttachments: true,\r\n          sortBy: 'date',\r\n          sortOrder: 'desc'\r\n        }\r\n      },\r\n      size\r\n    );\r\n    \r\n    // Prueba de detecci√≥n de eventos\r\n    allResults[`eventDetection_${size}`] = await runPerformanceTest(\r\n      'Detecci√≥n de eventos',\r\n      testEventDetection,\r\n      {\r\n        emails: testData[size].emails\r\n      },\r\n      size\r\n    );\r\n    \r\n    // Prueba de aplicaci√≥n de plantillas\r\n    allResults[`templateApplication_${size}`] = await runPerformanceTest(\r\n      'Aplicaci√≥n de plantillas',\r\n      testTemplateApplication,\r\n      {\r\n        templates: testData[size].templates,\r\n        variables: {\r\n          nombre_proveedor: 'Empresa Ejemplo',\r\n          fecha_evento: '15/09/2025',\r\n          servicio: 'fotograf√≠a profesional',\r\n          nombre_usuario: 'Mar√≠a Garc√≠a',\r\n          variable1: 'Consulta sobre servicios'\r\n        }\r\n      },\r\n      size\r\n    );\r\n    \r\n    // Prueba de renderizado de notificaciones\r\n    allResults[`notificationRendering_${size}`] = await runPerformanceTest(\r\n      'Renderizado de notificaciones',\r\n      testNotificationRendering,\r\n      {\r\n        notifications: testData[size].notifications,\r\n        batchSize: size === 'small' ? 10 : size === 'medium' ? 25 : 50\r\n      },\r\n      size\r\n    );\r\n  }\r\n  \r\n  // Generar informe resumen\r\n  const endTime = performance.now();\r\n  const totalExecutionTime = (endTime - startTime) / 1000;\r\n  \r\n  const summaryReport = {\r\n    timestamp,\r\n    totalExecutionTime,\r\n    tests: Object.values(allResults).map(result => ({\r\n      name: result.testName,\r\n      size: result.size,\r\n      avgTime: result.avgTime,\r\n      minTime: result.minTime,\r\n      maxTime: result.maxTime\r\n    })),\r\n    recommendations: []\r\n  };\r\n  \r\n  // A√±adir recomendaciones basadas en resultados\r\n  if (allResults.globalSearch_large.avgTime > 1000) {\r\n    summaryReport.recommendations.push(\r\n      'Implementar cach√© para resultados de b√∫squeda global con conjuntos de datos grandes'\r\n    );\r\n  }\r\n  \r\n  if (allResults.notificationRendering_large.averageBatchRenderTime > 500) {\r\n    summaryReport.recommendations.push(\r\n      'Considerar virtualizaci√≥n para listas de notificaciones con m√°s de 50 elementos'\r\n    );\r\n  }\r\n  \r\n  if (allResults.emailFiltering_large.avgTime > 800) {\r\n    summaryReport.recommendations.push(\r\n      'Optimizar algoritmos de filtrado para grandes vol√∫menes de emails'\r\n    );\r\n  }\r\n  \r\n  // Guardar informe resumen\r\n  const summaryPath = path.join(CONFIG.outputDir, `resumen_pruebas_${timestamp}.json`);\r\n  fs.writeFileSync(summaryPath, JSON.stringify(summaryReport, null, 2));\r\n  \r\n  console.log(`\\n\\n=======================================================`);\r\n  console.log(`‚úÖ PRUEBAS DE RENDIMIENTO COMPLETADAS`);\r\n  console.log(`=======================================================`);\r\n  console.log(`Tiempo total de ejecuci√≥n: ${totalExecutionTime.toFixed(2)} segundos`);\r\n  console.log(`Informe resumen guardado en: ${summaryPath}`);\r\n  \r\n  if (summaryReport.recommendations.length > 0) {\r\n    console.log(`\\nüìã RECOMENDACIONES DE OPTIMIZACI√ìN:`);\r\n    summaryReport.recommendations.forEach((rec, i) => {\r\n      console.log(`${i + 1}. ${rec}`);\r\n    });\r\n  }\r\n  \r\n  return summaryReport;\r\n}\r\n\r\n// Ejecutar todas las pruebas\r\nrunAllTests().catch(error => {\r\n  console.error('‚ùå Error durante la ejecuci√≥n de las pruebas:', error);\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\performance\\email-system.perf.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\security\\email-security.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\services\\AIEmailTrackingService.test.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'aiResult' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":100,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":100,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\r\nimport AIEmailTrackingService from '../../services/AIEmailTrackingService';\r\n\r\ndescribe('AIEmailTrackingService', () => {\r\n  let trackingService;\r\n  let localStorageMock;\r\n  \r\n  // Mock de localStorage\r\n  beforeEach(() => {\r\n    localStorageMock = {\r\n      store: {},\r\n      getItem: vi.fn((key) => localStorageMock.store[key] || null),\r\n      setItem: vi.fn((key, value) => {\r\n        localStorageMock.store[key] = value.toString();\r\n      }),\r\n      removeItem: vi.fn((key) => {\r\n        delete localStorageMock.store[key];\r\n      }),\r\n      clear: vi.fn(() => {\r\n        localStorageMock.store = {};\r\n      })\r\n    };\r\n    \r\n    Object.defineProperty(window, 'localStorage', {\r\n      value: localStorageMock,\r\n      writable: true\r\n    });\r\n    \r\n    trackingService = new AIEmailTrackingService();\r\n    \r\n    // Mockear console.log/error para evitar salida durante las pruebas\r\n    vi.spyOn(console, 'log').mockImplementation(() => {});\r\n    vi.spyOn(console, 'error').mockImplementation(() => {});\r\n  });\r\n  \r\n  afterEach(() => {\r\n    vi.resetAllMocks();\r\n    \r\n    // Restaurar localStorage original\r\n    Object.defineProperty(window, 'localStorage', {\r\n      value: window.localStorage,\r\n      writable: true\r\n    });\r\n  });\r\n  \r\n  it('debe inicializarse correctamente', () => {\r\n    expect(trackingService).toBeDefined();\r\n    expect(trackingService.storageKeyActivities).toBe('aiEmailActivities');\r\n    expect(trackingService.storageKeyMetrics).toBe('aiEmailMetrics');\r\n  });\r\n  \r\n  it('debe registrar una actividad AI correctamente', () => {\r\n    const aiResult = {\r\n      id: 123,\r\n      name: 'Fot√≥grafo Test',\r\n      service: 'fotograf√≠a'\r\n    };\r\n    \r\n    const searchQuery = 'fotograf√≠a para boda';\r\n    const options = { templateCategory: 'fotograf√≠a', wasCustomized: false };\r\n    \r\n    const activityId = trackingService.registerActivity(aiResult, searchQuery, options);\r\n    \r\n    // Verificar que se gener√≥ un ID\r\n    expect(activityId).toBeDefined();\r\n    expect(typeof activityId).toBe('string');\r\n    expect(activityId.startsWith('ai_')).toBe(true);\r\n    \r\n    // Verificar que se llam√≥ a localStorage.setItem con los datos correctos\r\n    expect(localStorage.setItem).toHaveBeenCalled();\r\n    \r\n    // Verificar que los datos se almacenaron correctamente\r\n    const storedDataArg = localStorage.setItem.mock.calls[0][1];\r\n    const storedData = JSON.parse(storedDataArg);\r\n    \r\n    expect(Array.isArray(storedData)).toBe(true);\r\n    expect(storedData.length).toBe(1);\r\n    expect(storedData[0].aiResultId).toBe(123);\r\n    expect(storedData[0].providerName).toBe('Fot√≥grafo Test');\r\n    expect(storedData[0].providerCategory).toBe('fotograf√≠a');\r\n    expect(storedData[0].searchQuery).toBe('fotograf√≠a para boda');\r\n    expect(storedData[0].templateCategory).toBe('fotograf√≠a');\r\n    expect(storedData[0].wasCustomized).toBe(false);\r\n  });\r\n  \r\n  it('debe manejar errores durante el registro de actividad', () => {\r\n    // Forzar un error en setItem\r\n    localStorage.setItem.mockImplementationOnce(() => {\r\n      throw new Error('Error simulado');\r\n    });\r\n    \r\n    const activityId = trackingService.registerActivity({}, 'consulta');\r\n    \r\n    expect(console.error).toHaveBeenCalled();\r\n    expect(activityId).toBeNull();\r\n  });\r\n  \r\n  it('debe actualizar una actividad cuando se recibe respuesta', () => {\r\n    // Preparar datos de prueba\r\n    const aiResult = { id: 123, name: 'Proveedor Test' };\r\n    localStorage.getItem.mockReturnValueOnce(JSON.stringify([\r\n      { id: 'ai_123', aiResultId: 123, timestamp: new Date().toISOString() }\r\n    ]));\r\n    \r\n    const success = trackingService.updateWithResponse('ai_123', { score: 5 });\r\n    \r\n    expect(success).toBe(true);\r\n    expect(localStorage.setItem).toHaveBeenCalled();\r\n    \r\n    const storedDataArg = localStorage.setItem.mock.calls[0][1];\r\n    const storedData = JSON.parse(storedDataArg);\r\n    \r\n    expect(storedData[0].status).toBe('responded');\r\n    expect(storedData[0].responseReceived).toBe(true);\r\n    expect(storedData[0].responseTime).toBeDefined();\r\n    expect(storedData[0].effectivenessScore).toBe(5);\r\n  });\r\n  \r\n  it('debe retornar false al actualizar una actividad que no existe', () => {\r\n    localStorage.getItem.mockReturnValueOnce(JSON.stringify([\r\n      { id: 'ai_123', aiResultId: 123 }\r\n    ]));\r\n    \r\n    const success = trackingService.updateWithResponse('ai_456', { score: 5 });\r\n    \r\n    expect(success).toBe(false);\r\n  });\r\n  \r\n  it('debe obtener actividades filtradas correctamente', () => {\r\n    const mockActivities = [\r\n      { \r\n        id: 'ai_1', \r\n        providerName: 'Fot√≥grafo A', \r\n        templateCategory: 'fotograf√≠a', \r\n        responseReceived: true,\r\n        status: 'responded',\r\n        wasCustomized: true\r\n      },\r\n      { \r\n        id: 'ai_2', \r\n        providerName: 'Catering B', \r\n        templateCategory: 'catering', \r\n        responseReceived: false,\r\n        status: 'sent',\r\n        wasCustomized: false\r\n      }\r\n    ];\r\n    \r\n    localStorage.getItem.mockReturnValueOnce(JSON.stringify(mockActivities));\r\n    \r\n    // Sin filtros\r\n    let result = trackingService.getActivities();\r\n    expect(result).toHaveLength(2);\r\n    \r\n    // Filtrar por categor√≠a\r\n    localStorage.getItem.mockReturnValueOnce(JSON.stringify(mockActivities));\r\n    result = trackingService.getActivities({ category: 'fotograf√≠a' });\r\n    expect(result).toHaveLength(1);\r\n    expect(result[0].id).toBe('ai_1');\r\n    \r\n    // Filtrar por estado de respuesta\r\n    localStorage.getItem.mockReturnValueOnce(JSON.stringify(mockActivities));\r\n    result = trackingService.getActivities({ responded: true });\r\n    expect(result).toHaveLength(1);\r\n    expect(result[0].id).toBe('ai_1');\r\n    \r\n    // Filtrar por personalizaci√≥n\r\n    localStorage.getItem.mockReturnValueOnce(JSON.stringify(mockActivities));\r\n    result = trackingService.getActivities({ customized: true });\r\n    expect(result).toHaveLength(1);\r\n    expect(result[0].id).toBe('ai_1');\r\n    \r\n    // Filtrar por nombre de proveedor\r\n    localStorage.getItem.mockReturnValueOnce(JSON.stringify(mockActivities));\r\n    result = trackingService.getActivities({ providerName: 'Catering' });\r\n    expect(result).toHaveLength(1);\r\n    expect(result[0].id).toBe('ai_2');\r\n  });\r\n  \r\n  it('debe calcular m√©tricas correctamente', () => {\r\n    const mockActivities = [\r\n      {\r\n        id: 'ai_1',\r\n        templateCategory: 'fotograf√≠a',\r\n        responseReceived: true,\r\n        timestamp: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(), // 1 d√≠a atr√°s\r\n        responseTime: 5.5,\r\n        wasCustomized: true\r\n      },\r\n      {\r\n        id: 'ai_2',\r\n        templateCategory: 'fotograf√≠a',\r\n        responseReceived: false,\r\n        timestamp: new Date().toISOString(),\r\n        wasCustomized: false\r\n      },\r\n      {\r\n        id: 'ai_3',\r\n        templateCategory: 'catering',\r\n        responseReceived: true,\r\n        timestamp: new Date(Date.now() - 12 * 60 * 60 * 1000).toISOString(), // 12 horas atr√°s\r\n        responseTime: 3.2,\r\n        wasCustomized: false\r\n      }\r\n    ];\r\n    \r\n    localStorage.getItem.mockReturnValueOnce(JSON.stringify(mockActivities));\r\n    \r\n    const metrics = trackingService.updateOverallMetrics();\r\n    \r\n    expect(metrics).toBeDefined();\r\n    expect(metrics.totalEmails).toBe(3);\r\n    expect(metrics.totalResponses).toBe(2);\r\n    expect(metrics.responseRate).toBe((2/3) * 100);\r\n    \r\n    // Verificar estad√≠sticas por categor√≠a\r\n    expect(metrics.categoryStats).toBeDefined();\r\n    expect(metrics.categoryStats.fotograf√≠a).toBeDefined();\r\n    expect(metrics.categoryStats.fotograf√≠a.total).toBe(2);\r\n    expect(metrics.categoryStats.fotograf√≠a.responded).toBe(1);\r\n    \r\n    expect(metrics.categoryStats.catering).toBeDefined();\r\n    expect(metrics.categoryStats.catering.total).toBe(1);\r\n    expect(metrics.categoryStats.catering.responded).toBe(1);\r\n  });\r\n  \r\n  it('debe obtener datos de comparaci√≥n', () => {\r\n    // Mock de datos de email\r\n    const mockEmailTrackings = [\r\n      { isAIGenerated: true, hasResponse: true, sentDate: '2023-01-01T10:00:00Z', responseDate: '2023-01-01T18:00:00Z' },\r\n      { isAIGenerated: false, hasResponse: true, sentDate: '2023-01-01T10:00:00Z', responseDate: '2023-01-02T10:00:00Z' },\r\n      { isAIGenerated: false, hasResponse: false, sentDate: '2023-01-01T10:00:00Z' },\r\n      { isAIGenerated: false, hasResponse: true, sentDate: '2023-01-01T10:00:00Z', responseDate: '2023-01-01T22:00:00Z' }\r\n    ];\r\n    \r\n    // Mock de m√©tricas AI\r\n    const mockMetrics = {\r\n      totalEmails: 1,\r\n      totalResponses: 1,\r\n      responseRate: 100,\r\n      averageResponseTime: 8,\r\n      categoryStats: {\r\n        fotograf√≠a: {\r\n          total: 1,\r\n          responded: 1,\r\n          averageResponseTime: 8\r\n        }\r\n      }\r\n    };\r\n    \r\n    // Mock para getMetrics\r\n    vi.spyOn(trackingService, 'getMetrics').mockReturnValue(mockMetrics);\r\n    \r\n    // Mock para localStorage.getItem (emailTrackings)\r\n    localStorage.getItem.mockReturnValueOnce(JSON.stringify(mockEmailTrackings));\r\n    \r\n    const comparison = trackingService.getComparisonData();\r\n    \r\n    expect(comparison).toBeDefined();\r\n    expect(comparison.ai).toBeDefined();\r\n    expect(comparison.nonAi).toBeDefined();\r\n    expect(comparison.difference).toBeDefined();\r\n    \r\n    // Verificar datos de AI\r\n    expect(comparison.ai.total).toBe(1);\r\n    expect(comparison.ai.responded).toBe(1);\r\n    expect(comparison.ai.responseRate).toBe('100.00');\r\n    \r\n    // Verificar datos de no-AI\r\n    expect(comparison.nonAi.total).toBe(3);\r\n    expect(comparison.nonAi.responded).toBe(2);\r\n    \r\n    // Verificar desglose por categor√≠a\r\n    expect(comparison.categoryBreakdown).toHaveLength(1);\r\n    expect(comparison.categoryBreakdown[0].category).toBe('fotograf√≠a');\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\services\\EmailRecommendationService.test.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'AIEmailTrackingService' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\r\nimport EmailRecommendationService from '../../services/EmailRecommendationService';\r\nimport AIEmailTrackingService from '../../services/AIEmailTrackingService';\r\n\r\n// Mock del servicio de tracking\r\nvi.mock('../../services/AIEmailTrackingService', () => {\r\n  return {\r\n    default: vi.fn().mockImplementation(() => ({\r\n      getActivities: vi.fn(),\r\n      getMetrics: vi.fn(),\r\n      getComparisonData: vi.fn()\r\n    }))\r\n  };\r\n});\r\n\r\ndescribe('EmailRecommendationService', () => {\r\n  let recommendationService;\r\n  let mockTrackingService;\r\n  let localStorageMock;\r\n  \r\n  // Mock de datos de actividad para pruebas\r\n  const mockActivities = [\r\n    {\r\n      id: 'ai_1',\r\n      providerName: 'Fot√≥grafo Test',\r\n      templateCategory: 'fotograf√≠a',\r\n      wasCustomized: true,\r\n      responseReceived: true,\r\n      responseTime: 5.5,\r\n      timestamp: '2023-01-01T10:30:00Z' // Ma√±ana\r\n    },\r\n    {\r\n      id: 'ai_2',\r\n      providerName: 'DJ Prueba',\r\n      templateCategory: 'm√∫sica',\r\n      wasCustomized: false,\r\n      responseReceived: true,\r\n      responseTime: 8.2,\r\n      timestamp: '2023-01-01T14:30:00Z' // Tarde\r\n    },\r\n    {\r\n      id: 'ai_3',\r\n      providerName: 'Catering Example',\r\n      templateCategory: 'catering',\r\n      wasCustomized: true,\r\n      responseReceived: false,\r\n      timestamp: '2023-01-01T18:30:00Z' // Noche\r\n    },\r\n    {\r\n      id: 'ai_4',\r\n      providerName: 'Fot√≥grafo B',\r\n      templateCategory: 'fotograf√≠a',\r\n      wasCustomized: false,\r\n      responseReceived: false,\r\n      timestamp: '2023-01-02T10:30:00Z'\r\n    },\r\n    {\r\n      id: 'ai_5',\r\n      providerName: 'Catering B',\r\n      templateCategory: 'catering',\r\n      wasCustomized: true,\r\n      responseReceived: true,\r\n      responseTime: 3.2,\r\n      timestamp: '2023-01-02T11:30:00Z'\r\n    },\r\n  ];\r\n  \r\n  // Mock de m√©tricas\r\n  const mockMetrics = {\r\n    totalEmails: 5,\r\n    totalResponses: 3,\r\n    responseRate: 60,\r\n    averageResponseTime: 5.6,\r\n    categoryStats: {\r\n      'fotograf√≠a': {\r\n        total: 2,\r\n        responded: 1,\r\n        averageResponseTime: 5.5\r\n      },\r\n      'm√∫sica': {\r\n        total: 1,\r\n        responded: 1,\r\n        averageResponseTime: 8.2\r\n      },\r\n      'catering': {\r\n        total: 2,\r\n        responded: 1,\r\n        averageResponseTime: 3.2\r\n      }\r\n    }\r\n  };\r\n  \r\n  // Mock de datos de comparaci√≥n\r\n  const mockComparisonData = {\r\n    ai: {\r\n      total: 5,\r\n      responded: 3,\r\n      responseRate: '60.00',\r\n      avgResponseTime: '5.6'\r\n    },\r\n    nonAi: {\r\n      total: 10,\r\n      responded: 5,\r\n      responseRate: '50.00',\r\n      avgResponseTime: '12.0'\r\n    },\r\n    difference: {\r\n      responseRate: '10.00',\r\n      avgResponseTime: '6.4'\r\n    },\r\n    categoryBreakdown: [\r\n      {\r\n        category: 'fotograf√≠a',\r\n        total: 2,\r\n        responseRate: '50.00',\r\n        avgResponseTime: '5.5'\r\n      },\r\n      {\r\n        category: 'm√∫sica',\r\n        total: 1,\r\n        responseRate: '100.00',\r\n        avgResponseTime: '8.2'\r\n      },\r\n      {\r\n        category: 'catering',\r\n        total: 2,\r\n        responseRate: '50.00',\r\n        avgResponseTime: '3.2'\r\n      }\r\n    ]\r\n  };\r\n  \r\n  // Mock de localStorage\r\n  beforeEach(() => {\r\n    localStorageMock = {\r\n      store: {},\r\n      getItem: vi.fn((key) => localStorageMock.store[key] || null),\r\n      setItem: vi.fn((key, value) => {\r\n        localStorageMock.store[key] = value.toString();\r\n      }),\r\n      removeItem: vi.fn((key) => {\r\n        delete localStorageMock.store[key];\r\n      }),\r\n      clear: vi.fn(() => {\r\n        localStorageMock.store = {};\r\n      })\r\n    };\r\n    \r\n    Object.defineProperty(window, 'localStorage', {\r\n      value: localStorageMock,\r\n      writable: true\r\n    });\r\n    \r\n    // Crear instancia de servicio y configurar mocks\r\n    recommendationService = new EmailRecommendationService();\r\n    mockTrackingService = recommendationService.trackingService;\r\n    \r\n    // Configurar respuestas mock\r\n    mockTrackingService.getActivities.mockReturnValue(mockActivities);\r\n    mockTrackingService.getMetrics.mockReturnValue(mockMetrics);\r\n    mockTrackingService.getComparisonData.mockReturnValue(mockComparisonData);\r\n    \r\n    // Mockear console.error para evitar salida durante las pruebas\r\n    vi.spyOn(console, 'error').mockImplementation(() => {});\r\n  });\r\n  \r\n  afterEach(() => {\r\n    vi.resetAllMocks();\r\n    \r\n    // Restaurar localStorage original\r\n    Object.defineProperty(window, 'localStorage', {\r\n      value: window.localStorage,\r\n      writable: true\r\n    });\r\n  });\r\n  \r\n  it('debe inicializarse correctamente', () => {\r\n    expect(recommendationService).toBeDefined();\r\n    expect(recommendationService.trackingService).toBeDefined();\r\n    expect(recommendationService.storageKeyRecommendations).toBe('emailRecommendations');\r\n  });\r\n  \r\n  it('debe generar recomendaciones b√°sicas sin par√°metros', () => {\r\n    const recommendations = recommendationService.generateRecommendations();\r\n    \r\n    // Verificar que se generan todas las secciones de recomendaciones\r\n    expect(recommendations).toBeDefined();\r\n    expect(recommendations.bestTimeToSend).toBeDefined();\r\n    expect(recommendations.subjectLineRecommendations).toBeDefined();\r\n    expect(recommendations.templateRecommendations).toBeDefined();\r\n    expect(recommendations.customizationImpact).toBeDefined();\r\n    expect(recommendations.responseTimeExpectations).toBeDefined();\r\n    expect(recommendations.confidenceScore).toBeDefined();\r\n    \r\n    // Verificar que se llamaron los m√©todos necesarios\r\n    expect(mockTrackingService.getActivities).toHaveBeenCalled();\r\n    expect(mockTrackingService.getMetrics).toHaveBeenCalled();\r\n    expect(mockTrackingService.getComparisonData).toHaveBeenCalled();\r\n    \r\n    // Verificar que se guardaron las recomendaciones en localStorage\r\n    expect(localStorage.setItem).toHaveBeenCalled();\r\n  });\r\n  \r\n  it('debe calcular correctamente el mejor momento para enviar', () => {\r\n    const recommendations = recommendationService.generateRecommendations();\r\n    \r\n    // Con nuestros datos de prueba, el mejor momento deber√≠a ser la ma√±ana\r\n    // ya que tiene mejor tasa de respuesta en nuestros datos mock\r\n    expect(recommendations.bestTimeToSend.bestTimeSlot).toBe('morning');\r\n    expect(recommendations.bestTimeToSend.hasSufficientData).toBeTruthy();\r\n  });\r\n  \r\n  it('debe generar recomendaciones espec√≠ficas para una categor√≠a', () => {\r\n    const recommendations = recommendationService.generateRecommendations('fotograf√≠a');\r\n    \r\n    // Verificar que se incluyen recomendaciones espec√≠ficas para la categor√≠a\r\n    expect(recommendations.categorySpecific).toBeDefined();\r\n    \r\n    // Con los datos mock, deber√≠a haber suficientes datos para fotograf√≠a\r\n    expect(recommendations.templateRecommendations.categorySpecificTemplate).toBeDefined();\r\n    expect(recommendations.templateRecommendations.categorySpecificTemplate.category).toBe('fotograf√≠a');\r\n  });\r\n  \r\n  it('debe generar recomendaciones basadas en una consulta de b√∫squeda', () => {\r\n    const recommendations = recommendationService.generateRecommendations(null, 'fotograf√≠a para boda en Madrid');\r\n    \r\n    // Verificar que se incluyen recomendaciones basadas en la consulta\r\n    expect(recommendations.querySpecific).toBeDefined();\r\n    expect(recommendations.querySpecific.searchContext.includesLocation).toBe(true);\r\n    expect(recommendations.querySpecific.searchContext.includesDate).toBe(false);\r\n  });\r\n  \r\n  it('debe calcular correctamente el impacto de personalizaci√≥n', () => {\r\n    const recommendations = recommendationService.generateRecommendations();\r\n    \r\n    // Con nuestros datos mock, la personalizaci√≥n deber√≠a tener impacto positivo\r\n    expect(recommendations.customizationImpact).toBeDefined();\r\n    expect(recommendations.customizationImpact.customized).toBeDefined();\r\n    expect(recommendations.customizationImpact.nonCustomized).toBeDefined();\r\n    \r\n    // Verificar c√°lculo del impacto\r\n    const customizedRate = parseFloat(recommendations.customizationImpact.customized.rate);\r\n    const nonCustomizedRate = parseFloat(recommendations.customizationImpact.nonCustomized.rate);\r\n    const calculatedImpact = (customizedRate - nonCustomizedRate).toFixed(1);\r\n    \r\n    expect(recommendations.customizationImpact.impact).toBe(calculatedImpact);\r\n  });\r\n  \r\n  it('debe calcular correctamente las expectativas de tiempo de respuesta', () => {\r\n    const recommendations = recommendationService.generateRecommendations();\r\n    \r\n    // Verificar que las expectativas de tiempo incluyen los valores correctos\r\n    expect(recommendations.responseTimeExpectations).toBeDefined();\r\n    expect(recommendations.responseTimeExpectations.hasSufficientData).toBe(true);\r\n    \r\n    // Con nuestros datos mock, el tiempo promedio deber√≠a ser calculado correctamente\r\n    const respondedActivities = mockActivities.filter(a => a.responseReceived && a.responseTime);\r\n    const avgTime = respondedActivities.reduce((sum, act) => sum + act.responseTime, 0) / respondedActivities.length;\r\n    \r\n    expect(recommendations.responseTimeExpectations.averageTime).toBe(avgTime.toFixed(1));\r\n  });\r\n  \r\n  it('debe manejar errores durante la generaci√≥n de recomendaciones', () => {\r\n    // Forzar un error en getActivities\r\n    mockTrackingService.getActivities.mockImplementationOnce(() => {\r\n      throw new Error('Error simulado');\r\n    });\r\n    \r\n    const recommendations = recommendationService.generateRecommendations();\r\n    \r\n    // Verificar que se devuelven recomendaciones por defecto\r\n    expect(recommendations).toBeDefined();\r\n    expect(console.error).toHaveBeenCalled();\r\n    expect(recommendations.confidenceScore).toBe(20); // Puntuaci√≥n baja por defecto\r\n  });\r\n  \r\n  it('debe guardar y recuperar el historial de recomendaciones', () => {\r\n    // Generar recomendaciones para guardarlas\r\n    recommendationService.generateRecommendations('fotograf√≠a', 'fotos para boda');\r\n    \r\n    // Recuperar historial\r\n    const history = recommendationService.getRecommendationsHistory();\r\n    \r\n    // Verificar que se guard√≥ correctamente\r\n    expect(history).toBeDefined();\r\n    expect(Array.isArray(history)).toBe(true);\r\n    expect(history.length).toBeGreaterThan(0);\r\n    expect(history[0].category).toBe('fotograf√≠a');\r\n    expect(history[0].searchQuery).toBe('fotos para boda');\r\n  });\r\n  \r\n  it('debe marcar una recomendaci√≥n como aplicada', () => {\r\n    // Preparar datos de prueba\r\n    const mockRecommendations = [\r\n      { id: 'rec_123', applied: false }\r\n    ];\r\n    \r\n    localStorage.getItem.mockReturnValueOnce(JSON.stringify(mockRecommendations));\r\n    \r\n    // Marcar como aplicada\r\n    const success = recommendationService.markRecommendationAsApplied('rec_123');\r\n    \r\n    // Verificar que se actualiz√≥ correctamente\r\n    expect(success).toBe(true);\r\n    expect(localStorage.setItem).toHaveBeenCalled();\r\n    \r\n    // Verificar que los datos se actualizaron\r\n    const setItemCall = localStorage.setItem.mock.calls[0];\r\n    const updatedData = JSON.parse(setItemCall[1]);\r\n    \r\n    expect(updatedData[0].applied).toBe(true);\r\n    expect(updatedData[0].appliedAt).toBeDefined();\r\n  });\r\n  \r\n  it('debe retornar false al marcar una recomendaci√≥n que no existe', () => {\r\n    localStorage.getItem.mockReturnValueOnce(JSON.stringify([\r\n      { id: 'rec_123', applied: false }\r\n    ]));\r\n    \r\n    const success = recommendationService.markRecommendationAsApplied('rec_456');\r\n    \r\n    expect(success).toBe(false);\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\services\\EmailService.edge-cases.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\services\\EmailService.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\services\\EmailTemplateService.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\services\\TagService.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\setup.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'rest' is defined but never used. Allowed unused args must match /^_/u.","line":42,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":41},{"ruleId":"no-unused-vars","severity":1,"message":"'rest' is defined but never used. Allowed unused args must match /^_/u.","line":50,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":50,"endColumn":41}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@testing-library/jest-dom';\r\nimport { beforeAll, afterEach, vi } from 'vitest';\r\nimport { cleanup } from '@testing-library/react';\r\n\r\n// Alias global \"jest\" apuntando a la API de \"vi\" para compatibilidad con pruebas que usan Jest\r\nif (!globalThis.jest) {\r\n  globalThis.jest = vi;\r\n  globalThis.jest.fn = vi.fn;\r\n  globalThis.jest.spyOn = vi.spyOn;\r\n  globalThis.jest.mock = vi.mock;\r\n}\r\n\r\n\r\n// ---------- Render con proveedores globales ----------\r\n// Para evitar el error de solo-lectura, mockeamos todo el m√≥dulo de\r\n// @testing-library/react y sustituimos √∫nicamente la funci√≥n render con un\r\n// wrapper que a√±ade los providers. El resto de la API se mantiene intacto.\r\n\r\nvi.mock('@testing-library/react', async () => {\r\n  // Importamos el m√≥dulo real para conservar todo lo dem√°s\r\n  const rtl = await vi.importActual('@testing-library/react');\r\n  // Importamos el wrapper con providers\r\n  const { default: AllProviders } = await import('./AllProviders.jsx');\r\n\r\n  return {\r\n    __esModule: true,\r\n    ...rtl,\r\n    render: (ui, options = {}) => rtl.render(ui, { wrapper: AllProviders, ...options })\r\n  };\r\n});\r\n\r\n// Limpieza autom√°tica despu√©s de cada prueba\r\nafterEach(() => {\r\n  cleanup();\r\n});\r\n\r\n// ---------- Mocks genericos ----------\r\n// Mock de react-beautiful-dnd para evitar necesidad del DragDropContext real\r\nvi.mock('react-beautiful-dnd', () => {\r\n  const Noop = ({ children }) => (children);\r\n  // Draggable y Droppable renderizan children()\r\n  const Draggable = ({ children, ...rest }) => {\r\n    const provided = {\r\n      draggableProps: { style: {} },\r\n      dragHandleProps: {},\r\n      innerRef: () => {}\r\n    };\r\n    return children(provided, {});\r\n  };\r\n  const Droppable = ({ children, ...rest }) => {\r\n    const provided = {\r\n      droppableProps: {},\r\n      innerRef: () => {}\r\n    };\r\n    return children(provided, {});\r\n  };\r\n  return {\r\n    __esModule: true,\r\n    DragDropContext: Noop,\r\n    Draggable,\r\n    Droppable\r\n  };\r\n});\r\n// Mock de todos los iconos Lucide: cualquier componente ser√° un div vac√≠o (o svg)\r\n// Usamos un Proxy para evitar declarar cada icono individualmente\r\nvi.mock('lucide-react', () => {\r\n  const Stub = () => null;\r\n  // Usamos un Proxy para que cualquier named export devuelva el componente Stub.\r\n  return new Proxy(\r\n    { __esModule: true, default: Stub },\r\n    {\r\n      get: (target, prop) => {\r\n        if (prop in target) return target[prop];\r\n        return Stub;\r\n      }\r\n    }\r\n  );\r\n});\r\n\r\n\r\n// Mockear localStorage\r\nbeforeAll(() => {\r\n  // Implementaci√≥n de localStorage para pruebas\r\n  const localStorageMock = {\r\n    getItem: vi.fn(),\r\n    setItem: vi.fn(),\r\n    removeItem: vi.fn(),\r\n    clear: vi.fn(),\r\n    key: vi.fn(),\r\n    length: 0\r\n  };\r\n  \r\n  Object.defineProperty(window, 'localStorage', {\r\n    value: localStorageMock,\r\n    writable: true\r\n  });\r\n  \r\n  // Mock para matchMedia que es usado por algunos componentes\r\n  Object.defineProperty(window, 'matchMedia', {\r\n    writable: true,\r\n    value: vi.fn().mockImplementation(query => ({\r\n      matches: false,\r\n      media: query,\r\n      onchange: null,\r\n      addListener: vi.fn(),\r\n      removeListener: vi.fn(),\r\n      addEventListener: vi.fn(),\r\n      removeEventListener: vi.fn(),\r\n      dispatchEvent: vi.fn(),\r\n    })),\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\unit\\ComposeEmailModal.test.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'fireEvent' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\r\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport ComposeEmailModal from '../../components/email/ComposeEmailModal';\r\n\r\n// Mock del servicio de correo\r\nvi.mock('../../services/emailService', () => ({\r\n  sendMail: vi.fn()\r\n}));\r\n\r\n// Importar sendMail despu√©s del mock para poder rastrearlo\r\nimport { sendMail } from '../../services/emailService';\r\n\r\ndescribe('ComposeEmailModal', () => {\r\n  // Props por defecto\r\n  const defaultProps = {\r\n    isOpen: true,\r\n    onClose: vi.fn(),\r\n    userEmail: 'usuario@lovenda.com',\r\n  };\r\n\r\n  beforeEach(() => {\r\n    vi.useFakeTimers();\r\n    vi.clearAllMocks();\r\n  });\r\n\r\n  afterEach(() => {\r\n    vi.useRealTimers();\r\n    vi.restoreAllMocks();\r\n  });\r\n\r\n  it('renderiza correctamente cuando est√° abierto', () => {\r\n    render(<ComposeEmailModal {...defaultProps} />);\r\n    \r\n    expect(screen.getByText('Nuevo mensaje')).toBeInTheDocument();\r\n    expect(screen.getByLabelText(/destinatario/i)).toBeInTheDocument();\r\n    expect(screen.getByLabelText(/asunto/i)).toBeInTheDocument();\r\n    expect(screen.getByPlaceholderText(/escribe tu mensaje/i)).toBeInTheDocument();\r\n    expect(screen.getByText('Enviar')).toBeInTheDocument();\r\n  });\r\n\r\n  it('no renderiza cuando isOpen es false', () => {\r\n    render(<ComposeEmailModal {...defaultProps} isOpen={false} />);\r\n    \r\n    expect(screen.queryByText('Nuevo mensaje')).not.toBeInTheDocument();\r\n  });\r\n\r\n  it('llama a onClose cuando se hace clic en el bot√≥n de cerrar', async () => {\r\n    const user = userEvent.setup();\r\n    render(<ComposeEmailModal {...defaultProps} />);\r\n    \r\n    const closeButton = screen.getByLabelText(/cerrar/i);\r\n    await user.click(closeButton);\r\n    \r\n    expect(defaultProps.onClose).toHaveBeenCalledTimes(1);\r\n  });\r\n\r\n  it('muestra error cuando se intenta enviar sin destinatario', async () => {\r\n    const user = userEvent.setup();\r\n    render(<ComposeEmailModal {...defaultProps} />);\r\n    \r\n    // Llenar asunto y cuerpo, pero no el destinatario\r\n    await user.type(screen.getByLabelText(/asunto/i), 'Asunto de prueba');\r\n    await user.type(screen.getByPlaceholderText(/escribe tu mensaje/i), 'Cuerpo del mensaje');\r\n    \r\n    // Intentar enviar\r\n    await user.click(screen.getByText('Enviar'));\r\n    \r\n    // Verificar mensaje de error\r\n    expect(screen.getByText('Debes especificar un destinatario')).toBeInTheDocument();\r\n    expect(sendMail).not.toHaveBeenCalled();\r\n  });\r\n\r\n  it('env√≠a el correo con los datos correctos', async () => {\r\n    // Configurar el mock para resolver correctamente\r\n    sendMail.mockResolvedValueOnce({ success: true });\r\n    \r\n    const user = userEvent.setup();\r\n    render(<ComposeEmailModal {...defaultProps} />);\r\n    \r\n    // Llenar todos los campos\r\n    await user.type(screen.getByLabelText(/destinatario/i), 'destinatario@example.com');\r\n    await user.type(screen.getByLabelText(/asunto/i), 'Asunto de prueba');\r\n    await user.type(screen.getByPlaceholderText(/escribe tu mensaje/i), 'Cuerpo del mensaje');\r\n    \r\n    // Enviar el formulario\r\n    await user.click(screen.getByText('Enviar'));\r\n    \r\n    // Verificar que sendMail se llama con los par√°metros correctos\r\n    expect(sendMail).toHaveBeenCalledTimes(1);\r\n    expect(sendMail).toHaveBeenCalledWith({\r\n      to: 'destinatario@example.com',\r\n      subject: 'Asunto de prueba',\r\n      body: 'Cuerpo del mensaje',\r\n      attachments: []\r\n    });\r\n    \r\n    // Verificar mensaje de √©xito y cierre del modal\r\n    await waitFor(() => {\r\n      expect(screen.getByText(/enviado con √©xito/i)).toBeInTheDocument();\r\n    });\r\n    \r\n    // El modal debe cerrarse despu√©s del tiempo establecido\r\n    vi.advanceTimersByTime(1500);\r\n    expect(defaultProps.onClose).toHaveBeenCalledTimes(1);\r\n  });\r\n\r\n  it('muestra error cuando falla el env√≠o', async () => {\r\n    // Configurar el mock para rechazar la promesa\r\n    sendMail.mockRejectedValueOnce(new Error('Error de prueba'));\r\n    \r\n    const user = userEvent.setup();\r\n    render(<ComposeEmailModal {...defaultProps} />);\r\n    \r\n    // Llenar todos los campos\r\n    await user.type(screen.getByLabelText(/destinatario/i), 'destinatario@example.com');\r\n    await user.type(screen.getByLabelText(/asunto/i), 'Asunto de prueba');\r\n    await user.type(screen.getByPlaceholderText(/escribe tu mensaje/i), 'Cuerpo del mensaje');\r\n    \r\n    // Enviar el formulario\r\n    await user.click(screen.getByText('Enviar'));\r\n    \r\n    // Verificar mensaje de error\r\n    await waitFor(() => {\r\n      expect(screen.getByText(/Error al enviar el correo: Error de prueba/i)).toBeInTheDocument();\r\n    });\r\n    \r\n    // El modal no debe cerrarse\r\n    expect(defaultProps.onClose).not.toHaveBeenCalled();\r\n  });\r\n\r\n  it('pre-rellena campos cuando es una respuesta a otro correo', () => {\r\n    const replyToEmail = {\r\n      id: 'email123',\r\n      from: 'remitente@example.com',\r\n      subject: 'Asunto original',\r\n      body: 'Contenido del correo original',\r\n      date: '2025-07-10T15:30:00Z'\r\n    };\r\n    \r\n    render(<ComposeEmailModal {...defaultProps} replyTo={replyToEmail} />);\r\n    \r\n    // Verificar campos pre-rellenados\r\n    expect(screen.getByLabelText(/destinatario/i).value).toBe('remitente@example.com');\r\n    expect(screen.getByLabelText(/asunto/i).value).toBe('Re: Asunto original');\r\n    expect(screen.getByPlaceholderText(/escribe tu mensaje/i).value).toContain('remitente@example.com escribi√≥:');\r\n    expect(screen.getByPlaceholderText(/escribe tu mensaje/i).value).toContain('Contenido del correo original');\r\n  });\r\n\r\n  it('limita el tama√±o de los archivos adjuntos', async () => {\r\n    const user = userEvent.setup();\r\n    render(<ComposeEmailModal {...defaultProps} />);\r\n    \r\n    // Crear archivo de prueba simulado grande (m√°s de 10MB)\r\n    const largeFile = new File(['x'.repeat(11 * 1024 * 1024)], 'large-file.pdf', { type: 'application/pdf' });\r\n    \r\n    // Simular la selecci√≥n del archivo\r\n    const fileInput = screen.getByLabelText(/adjuntar archivo/i);\r\n    await user.upload(fileInput, largeFile);\r\n    \r\n    // Verificar mensaje de error sobre el tama√±o\r\n    expect(screen.getByText(/no debe superar los 10MB/i)).toBeInTheDocument();\r\n    \r\n    // Intentar enviar el correo\r\n    await user.click(screen.getByText('Enviar'));\r\n    \r\n    // Verificar que sendMail no se llama debido al error\r\n    expect(sendMail).not.toHaveBeenCalled();\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\unit\\EmailComposer.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\unit\\EmailFilters.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\unit\\EmailNotificationBadge.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\unit\\EmailSettings.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\unit\\EmailStats.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\unit\\EmailTagsManager.test.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'fireEvent' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":35},{"ruleId":"no-unused-vars","severity":1,"message":"'uid' is defined but never used. Allowed unused args must match /^_/u.","line":121,"column":56,"nodeType":"Identifier","messageId":"unusedVar","endLine":121,"endColumn":59},{"ruleId":"no-unused-vars","severity":1,"message":"'emailId' is defined but never used. Allowed unused args must match /^_/u.","line":121,"column":61,"nodeType":"Identifier","messageId":"unusedVar","endLine":121,"endColumn":68},{"ruleId":"no-undef","severity":2,"message":"'getEmailTagsDetails' is not defined.","line":144,"column":12,"nodeType":"Identifier","messageId":"undef","endLine":144,"endColumn":31},{"ruleId":"no-unused-vars","severity":1,"message":"'uid' is defined but never used. Allowed unused args must match /^_/u.","line":153,"column":56,"nodeType":"Identifier","messageId":"unusedVar","endLine":153,"endColumn":59},{"ruleId":"no-unused-vars","severity":1,"message":"'emailId' is defined but never used. Allowed unused args must match /^_/u.","line":153,"column":61,"nodeType":"Identifier","messageId":"unusedVar","endLine":153,"endColumn":68}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\r\nimport { render, screen, fireEvent } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport EmailTagsManager from '../../components/email/EmailTagsManager';\r\nimport { useAuth } from '../../hooks/useAuth';\r\nimport * as tagService from '../../services/tagService';\r\n\r\n// Mock de los m√≥dulos necesarios\r\nvi.mock('../../hooks/useAuth', () => ({\r\n  useAuth: vi.fn()\r\n}));\r\n\r\nvi.mock('../../services/tagService', () => ({\r\n  getUserTags: vi.fn(),\r\n  getEmailTagsDetails: vi.fn(),\r\n  addTagToEmail: vi.fn(),\r\n  removeTagFromEmail: vi.fn()\r\n}));\r\n\r\n// Mock para los componentes de Lucide React\r\nvi.mock('lucide-react', () => ({\r\n  Tag: () => <div data-testid=\"icon-tag\">Tag Icon</div>,\r\n  X: () => <div data-testid=\"icon-x\">X Icon</div>,\r\n  Plus: () => <div data-testid=\"icon-plus\">Plus Icon</div>,\r\n  Check: () => <div data-testid=\"icon-check\">Check Icon</div>\r\n}));\r\n\r\n// Mock para el componente Button\r\nvi.mock('../../components/Button', () => ({\r\n  default: ({ children, onClick }) => (\r\n    <button onClick={onClick} data-testid=\"button-mock\">{children}</button>\r\n  )\r\n}));\r\n\r\ndescribe('EmailTagsManager', () => {\r\n  // Datos de prueba\r\n  const mockEmailId = 'email123';\r\n  const mockCurrentUser = { uid: 'user123' };\r\n  const mockOnTagsChange = vi.fn();\r\n  \r\n  const mockTags = [\r\n    { id: 'tag1', name: 'Importante', color: '#FF0000' },\r\n    { id: 'tag2', name: 'Personal', color: '#00FF00' }\r\n  ];\r\n  \r\n  const mockAllTags = [\r\n    ...mockTags,\r\n    { id: 'tag3', name: 'Trabajo', color: '#0000FF' },\r\n    { id: 'tag4', name: 'Familia', color: '#FFA500' }\r\n  ];\r\n  \r\n  // Props por defecto\r\n  const defaultProps = {\r\n    emailId: mockEmailId,\r\n    onTagsChange: mockOnTagsChange\r\n  };\r\n  \r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n    \r\n    // Configuraci√≥n por defecto de los mocks\r\n    useAuth.mockReturnValue({\r\n      currentUser: mockCurrentUser\r\n    });\r\n    \r\n    tagService.getUserTags.mockReturnValue(mockAllTags);\r\n    tagService.getEmailTagsDetails.mockReturnValue(mockTags);\r\n  });\r\n  \r\n  afterEach(() => {\r\n    vi.restoreAllMocks();\r\n  });\r\n  \r\n  it('renderiza correctamente las etiquetas actuales del correo', () => {\r\n    render(<EmailTagsManager {...defaultProps} />);\r\n    \r\n    // Verificar que se muestran las etiquetas\r\n    expect(screen.getByText('Importante')).toBeInTheDocument();\r\n    expect(screen.getByText('Personal')).toBeInTheDocument();\r\n    \r\n    // Verificar que se llam√≥ a las funciones apropiadas\r\n    expect(tagService.getUserTags).toHaveBeenCalledWith(mockCurrentUser.uid);\r\n    expect(tagService.getEmailTagsDetails).toHaveBeenCalledWith(mockCurrentUser.uid, mockEmailId);\r\n  });\r\n  \r\n  it('muestra el bot√≥n para a√±adir etiquetas', () => {\r\n    render(<EmailTagsManager {...defaultProps} />);\r\n    \r\n    // Verificar que se muestra el bot√≥n de a√±adir\r\n    const addButton = screen.getByText('A√±adir etiqueta');\r\n    expect(addButton).toBeInTheDocument();\r\n  });\r\n  \r\n  it('muestra el selector de etiquetas al hacer clic en \"A√±adir etiqueta\"', async () => {\r\n    const user = userEvent.setup();\r\n    \r\n    render(<EmailTagsManager {...defaultProps} />);\r\n    \r\n    // Hacer clic en el bot√≥n de a√±adir etiqueta\r\n    await user.click(screen.getByText('A√±adir etiqueta'));\r\n    \r\n    // Verificar que se muestra el selector con las etiquetas disponibles (las que no est√°n ya asignadas)\r\n    expect(screen.getByText('Trabajo')).toBeInTheDocument();\r\n    expect(screen.getByText('Familia')).toBeInTheDocument();\r\n    \r\n    // Verificar que no aparecen las etiquetas ya asignadas\r\n    const etiquetasRepetidas = screen.getAllByText('Importante');\r\n    expect(etiquetasRepetidas.length).toBe(1); // Solo aparece una vez (la ya asignada)\r\n  });\r\n  \r\n  it('permite a√±adir una nueva etiqueta', async () => {\r\n    const user = userEvent.setup();\r\n    \r\n    // Simular que se actualiza la lista de etiquetas despu√©s de a√±adir\r\n    const updatedTags = [\r\n      ...mockTags,\r\n      { id: 'tag3', name: 'Trabajo', color: '#0000FF' }\r\n    ];\r\n    \r\n    tagService.getEmailTagsDetails.mockImplementation((uid, emailId) => {\r\n      // La primera vez devuelve las etiquetas iniciales, luego las actualizadas\r\n      if (tagService.addTagToEmail.mock.calls.length > 0) {\r\n        return updatedTags;\r\n      }\r\n      return mockTags;\r\n    });\r\n    \r\n    render(<EmailTagsManager {...defaultProps} />);\r\n    \r\n    // Abrir selector de etiquetas\r\n    await user.click(screen.getByText('A√±adir etiqueta'));\r\n    \r\n    // A√±adir la etiqueta \"Trabajo\"\r\n    await user.click(screen.getByText('Trabajo'));\r\n    \r\n    // Verificar que se llam√≥ a la funci√≥n para a√±adir etiqueta\r\n    expect(tagService.addTagToEmail).toHaveBeenCalledWith(mockCurrentUser.uid, mockEmailId, 'tag3');\r\n    \r\n    // Verificar que se llam√≥ al callback onTagsChange con las etiquetas actualizadas\r\n    expect(mockOnTagsChange).toHaveBeenCalledWith(updatedTags);\r\n    \r\n    // Verificar que se obtuvo la lista actualizada de etiquetas\r\n    expect(getEmailTagsDetails).toHaveBeenCalledTimes(2);\r\n  });\r\n  \r\n  it('permite eliminar una etiqueta', async () => {\r\n    const user = userEvent.setup();\r\n    \r\n    // Simular que se actualiza la lista de etiquetas despu√©s de eliminar\r\n    const updatedTags = [mockTags[1]]; // Solo queda la segunda etiqueta\r\n    \r\n    tagService.getEmailTagsDetails.mockImplementation((uid, emailId) => {\r\n      // La primera vez devuelve las etiquetas iniciales, luego las actualizadas\r\n      if (tagService.removeTagFromEmail.mock.calls.length > 0) {\r\n        return updatedTags;\r\n      }\r\n      return mockTags;\r\n    });\r\n    \r\n    render(<EmailTagsManager {...defaultProps} />);\r\n    \r\n    // Buscar botones de eliminar (X) y hacer clic en el primero\r\n    const removeButtons = screen.getAllByRole('button');\r\n    const firstRemoveButton = removeButtons.find(button => button.innerHTML.includes('X'));\r\n    \r\n    await user.click(firstRemoveButton);\r\n    \r\n    // Verificar que se llam√≥ a la funci√≥n para eliminar etiqueta\r\n    expect(tagService.removeTagFromEmail).toHaveBeenCalledWith(mockCurrentUser.uid, mockEmailId, expect.any(String));\r\n    \r\n    // Verificar que se llam√≥ al callback onTagsChange con las etiquetas actualizadas\r\n    expect(mockOnTagsChange).toHaveBeenCalledWith(updatedTags);\r\n    \r\n    // Verificar que se obtuvo la lista actualizada de etiquetas\r\n    expect(tagService.getEmailTagsDetails).toHaveBeenCalledTimes(2);\r\n  });\r\n  \r\n  it('muestra mensaje cuando no hay m√°s etiquetas disponibles para a√±adir', async () => {\r\n    const user = userEvent.setup();\r\n    \r\n    // Simular que todas las etiquetas ya est√°n asignadas\r\n    tagService.getUserTags.mockReturnValue(mockTags);\r\n    tagService.getEmailTagsDetails.mockReturnValue(mockTags);\r\n    \r\n    render(<EmailTagsManager {...defaultProps} />);\r\n    \r\n    // Abrir selector de etiquetas\r\n    await user.click(screen.getByText('A√±adir etiqueta'));\r\n    \r\n    // Verificar que se muestra el mensaje de no hay m√°s etiquetas\r\n    expect(screen.getByText('No hay m√°s etiquetas disponibles')).toBeInTheDocument();\r\n  });\r\n  \r\n  it('cierra el selector de etiquetas al hacer clic en \"Cancelar\"', async () => {\r\n    const user = userEvent.setup();\r\n    \r\n    render(<EmailTagsManager {...defaultProps} />);\r\n    \r\n    // Abrir selector de etiquetas\r\n    await user.click(screen.getByText('A√±adir etiqueta'));\r\n    \r\n    // Verificar que se muestra el selector\r\n    expect(screen.getByText('Trabajo')).toBeInTheDocument();\r\n    \r\n    // Cerrar el selector\r\n    await user.click(screen.getByText('Cancelar'));\r\n    \r\n    // Verificar que el selector ya no est√° visible\r\n    expect(screen.queryByText('Trabajo')).not.toBeInTheDocument();\r\n  });\r\n  \r\n  it('no realiza operaciones si no hay usuario autenticado', () => {\r\n    // Simular que no hay usuario autenticado\r\n    useAuth.mockReturnValue({ currentUser: null });\r\n    \r\n    render(<EmailTagsManager {...defaultProps} />);\r\n    \r\n    // Verificar que no se llamaron a las funciones que dependen del usuario\r\n    expect(tagService.getUserTags).not.toHaveBeenCalled();\r\n    expect(tagService.getEmailTagsDetails).not.toHaveBeenCalled();\r\n  });\r\n  \r\n  it('no realiza operaciones si no hay ID de correo', () => {\r\n    render(<EmailTagsManager emailId={null} onTagsChange={mockOnTagsChange} />);\r\n    \r\n    // Verificar que no se llamaron a las funciones que dependen del ID de correo\r\n    expect(tagService.getUserTags).not.toHaveBeenCalled();\r\n    expect(tagService.getEmailTagsDetails).not.toHaveBeenCalled();\r\n  });\r\n  \r\n  it('maneja errores al a√±adir una etiqueta', async () => {\r\n    const user = userEvent.setup();\r\n    \r\n    // Simular un error al a√±adir etiqueta\r\n    const mockError = new Error('Error al a√±adir etiqueta');\r\n    tagService.addTagToEmail.mockImplementationOnce(() => {\r\n      throw mockError;\r\n    });\r\n    \r\n    // Espiar console.error\r\n    const consoleSpy = vi.spyOn(console, 'error').mockImplementation(() => {});\r\n    \r\n    render(<EmailTagsManager {...defaultProps} />);\r\n    \r\n    // Abrir selector de etiquetas\r\n    await user.click(screen.getByText('A√±adir etiqueta'));\r\n    \r\n    // Intentar a√±adir una etiqueta\r\n    await user.click(screen.getByText('Trabajo'));\r\n    \r\n    // Verificar que se registr√≥ el error\r\n    expect(consoleSpy).toHaveBeenCalledWith('Error al a√±adir etiqueta:', mockError);\r\n    \r\n    // Verificar que no se llam√≥ al callback onTagsChange\r\n    expect(mockOnTagsChange).not.toHaveBeenCalled();\r\n    \r\n    // Restaurar console.error\r\n    consoleSpy.mockRestore();\r\n  });\r\n  \r\n  it('maneja errores al quitar una etiqueta', async () => {\r\n    const user = userEvent.setup();\r\n    \r\n    // Simular un error al quitar etiqueta\r\n    const mockError = new Error('Error al quitar etiqueta');\r\n    tagService.removeTagFromEmail.mockImplementationOnce(() => {\r\n      throw mockError;\r\n    });\r\n    \r\n    // Espiar console.error\r\n    const consoleSpy = vi.spyOn(console, 'error').mockImplementation(() => {});\r\n    \r\n    render(<EmailTagsManager {...defaultProps} />);\r\n    \r\n    // Buscar botones de eliminar (X) y hacer clic en el primero\r\n    const removeButtons = screen.getAllByRole('button');\r\n    const firstRemoveButton = removeButtons.find(button => button.innerHTML.includes('X'));\r\n    \r\n    await user.click(firstRemoveButton);\r\n    \r\n    // Verificar que se registr√≥ el error\r\n    expect(consoleSpy).toHaveBeenCalledWith('Error al quitar etiqueta:', mockError);\r\n    \r\n    // Verificar que no se llam√≥ al callback onTagsChange\r\n    expect(mockOnTagsChange).not.toHaveBeenCalled();\r\n    \r\n    // Restaurar console.error\r\n    consoleSpy.mockRestore();\r\n  });\r\n  \r\n  it('aplica los estilos de color correctamente a las etiquetas', () => {\r\n    render(<EmailTagsManager {...defaultProps} />);\r\n    \r\n    // Buscar contenedores de etiquetas\r\n    const tagElements = screen.getAllByText(/Importante|Personal/);\r\n    \r\n    // Verificar los estilos para cada etiqueta (mirando su elemento padre)\r\n    tagElements.forEach(tagElement => {\r\n      const container = tagElement.closest('div');\r\n      const tag = mockTags.find(tag => tag.name === tagElement.textContent);\r\n      \r\n      if (tag && container) {\r\n        expect(container.style.backgroundColor).toBe(`${tag.color}20`);\r\n        expect(container.style.color).toBe(tag.color);\r\n        expect(container.style.borderColor).toBe(`${tag.color}50`);\r\n      }\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\unit\\FolderSelectionModal.test.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\unit\\TagsManager.test.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'fireEvent' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\r\nimport { render, screen, fireEvent } from '@testing-library/react';\r\nimport userEvent from '@testing-library/user-event';\r\nimport TagsManager from '../../components/email/TagsManager';\r\nimport { useAuth } from '../../hooks/useAuth';\r\nimport * as tagService from '../../services/tagService';\r\nimport { toast } from 'react-toastify';\r\n\r\n// Mock de los m√≥dulos necesarios\r\nvi.mock('../../hooks/useAuth', () => ({\r\n  useAuth: vi.fn()\r\n}));\r\n\r\nvi.mock('../../services/tagService', () => ({\r\n  getUserTags: vi.fn(),\r\n  getCustomTags: vi.fn(),\r\n  createTag: vi.fn(),\r\n  deleteTag: vi.fn(),\r\n  SYSTEM_TAGS: [\r\n    { id: 'system1', name: 'Importante', color: '#e53e3e' },\r\n    { id: 'system2', name: 'Trabajo', color: '#3182ce' }\r\n  ]\r\n}));\r\n\r\nvi.mock('react-toastify', () => ({\r\n  toast: {\r\n    success: vi.fn(),\r\n    error: vi.fn()\r\n  }\r\n}));\r\n\r\n// Mock para los componentes de Lucide React\r\nvi.mock('lucide-react', () => ({\r\n  Tag: () => <div data-testid=\"icon-tag\">Tag Icon</div>,\r\n  Plus: () => <div data-testid=\"icon-plus\">Plus Icon</div>,\r\n  Edit: () => <div data-testid=\"icon-edit\">Edit Icon</div>,\r\n  Trash: () => <div data-testid=\"icon-trash\">Trash Icon</div>,\r\n  X: () => <div data-testid=\"icon-x\">X Icon</div>,\r\n  Check: () => <div data-testid=\"icon-check\">Check Icon</div>,\r\n  Circle: () => <div data-testid=\"icon-circle\">Circle Icon</div>\r\n}));\r\n\r\n// Mock para el componente Button\r\nvi.mock('../../components/Button', () => ({\r\n  default: ({ children, onClick, disabled }) => (\r\n    <button \r\n      onClick={onClick} \r\n      disabled={disabled} \r\n      data-testid=\"button-mock\"\r\n    >\r\n      {children}\r\n    </button>\r\n  )\r\n}));\r\n\r\ndescribe('TagsManager', () => {\r\n  // Datos de prueba\r\n  const mockCurrentUser = { uid: 'user123' };\r\n  const mockCustomTags = [\r\n    { id: 'tag1', name: 'Personal', color: '#d53f8c' },\r\n    { id: 'tag2', name: 'Familia', color: '#38a169' }\r\n  ];\r\n  \r\n  // Mock global del m√©todo confirm\r\n  const originalConfirm = window.confirm;\r\n  \r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n    \r\n    // Configuraci√≥n por defecto de los mocks\r\n    useAuth.mockReturnValue({\r\n      currentUser: mockCurrentUser\r\n    });\r\n    \r\n    tagService.getCustomTags.mockReturnValue(mockCustomTags);\r\n    \r\n    // Mock del confirm para pruebas de eliminaci√≥n\r\n    window.confirm = vi.fn();\r\n  });\r\n  \r\n  afterEach(() => {\r\n    // Restaurar el m√©todo original confirm\r\n    window.confirm = originalConfirm;\r\n  });\r\n  \r\n  it('renderiza correctamente las etiquetas del sistema y personalizadas', () => {\r\n    render(<TagsManager />);\r\n    \r\n    // Verificar que se muestran las etiquetas del sistema\r\n    expect(screen.getByText('Importante')).toBeInTheDocument();\r\n    expect(screen.getByText('Trabajo')).toBeInTheDocument();\r\n    expect(screen.getAllByText('Predefinida')).toHaveLength(2);\r\n    \r\n    // Verificar que se muestran las etiquetas personalizadas\r\n    expect(screen.getByText('Personal')).toBeInTheDocument();\r\n    expect(screen.getByText('Familia')).toBeInTheDocument();\r\n    \r\n    // Verificar que se llam√≥ a la funci√≥n para obtener etiquetas personalizadas\r\n    expect(tagService.getCustomTags).toHaveBeenCalledWith(mockCurrentUser.uid);\r\n  });\r\n  \r\n  it('muestra el bot√≥n para crear nuevas etiquetas', () => {\r\n    render(<TagsManager />);\r\n    \r\n    // Verificar que se muestra el bot√≥n para crear etiquetas\r\n    expect(screen.getByText('Nueva etiqueta')).toBeInTheDocument();\r\n  });\r\n  \r\n  it('muestra el formulario de creaci√≥n al hacer clic en el bot√≥n \"Nueva etiqueta\"', async () => {\r\n    const user = userEvent.setup();\r\n    render(<TagsManager />);\r\n    \r\n    // Hacer clic en el bot√≥n para crear etiqueta\r\n    await user.click(screen.getByText('Nueva etiqueta'));\r\n    \r\n    // Verificar que se muestra el formulario\r\n    expect(screen.getByPlaceholderText('Nombre de la etiqueta')).toBeInTheDocument();\r\n    expect(screen.getByText('Color')).toBeInTheDocument();\r\n    expect(screen.getByText('Crear etiqueta')).toBeInTheDocument();\r\n    expect(screen.getByText('Cancelar')).toBeInTheDocument();\r\n  });\r\n  \r\n  it('oculta el formulario al hacer clic en \"Cancelar\"', async () => {\r\n    const user = userEvent.setup();\r\n    render(<TagsManager />);\r\n    \r\n    // Mostrar formulario\r\n    await user.click(screen.getByText('Nueva etiqueta'));\r\n    expect(screen.getByPlaceholderText('Nombre de la etiqueta')).toBeInTheDocument();\r\n    \r\n    // Ocultar formulario\r\n    await user.click(screen.getByText('Cancelar'));\r\n    expect(screen.queryByPlaceholderText('Nombre de la etiqueta')).not.toBeInTheDocument();\r\n  });\r\n  \r\n  it('permite seleccionar un color para la etiqueta', async () => {\r\n    const user = userEvent.setup();\r\n    render(<TagsManager />);\r\n    \r\n    // Mostrar formulario\r\n    await user.click(screen.getByText('Nueva etiqueta'));\r\n    \r\n    // Verificar que hay opciones de color (9 colores seg√∫n el componente)\r\n    const colorOptions = screen.getAllByTestId('icon-check');\r\n    expect(colorOptions.length).toBeGreaterThan(0);\r\n    \r\n    // Hacer clic en una opci√≥n de color\r\n    const colorElements = screen.getAllByRole('button');\r\n    // Encontramos un elemento de color que no sea el bot√≥n principal\r\n    const colorElement = colorElements.find(el => \r\n      !el.textContent.includes('Nueva etiqueta') && \r\n      !el.textContent.includes('Crear etiqueta') &&\r\n      !el.textContent.includes('Cancelar')\r\n    );\r\n    \r\n    if (colorElement) {\r\n      await user.click(colorElement);\r\n    }\r\n  });\r\n  \r\n  it('crea una nueva etiqueta al enviar el formulario', async () => {\r\n    const user = userEvent.setup();\r\n    render(<TagsManager />);\r\n    \r\n    // Mostrar formulario\r\n    await user.click(screen.getByText('Nueva etiqueta'));\r\n    \r\n    // Ingresar nombre de etiqueta\r\n    const nameInput = screen.getByPlaceholderText('Nombre de la etiqueta');\r\n    await user.type(nameInput, 'Nueva Etiqueta');\r\n    \r\n    // Crear etiqueta\r\n    await user.click(screen.getByText('Crear etiqueta'));\r\n    \r\n    // Verificar que se llam√≥ a la funci√≥n para crear etiqueta\r\n    expect(tagService.createTag).toHaveBeenCalledWith(\r\n      mockCurrentUser.uid,\r\n      'Nueva Etiqueta',\r\n      expect.any(String) // El color podr√≠a ser cualquier string\r\n    );\r\n    \r\n    // Verificar que se mostr√≥ un mensaje de √©xito\r\n    expect(toast.success).toHaveBeenCalledWith(expect.stringContaining('Nueva Etiqueta'));\r\n    \r\n    // Verificar que el formulario se ocult√≥\r\n    expect(screen.queryByPlaceholderText('Nombre de la etiqueta')).not.toBeInTheDocument();\r\n  });\r\n  \r\n  it('no crea etiquetas con nombre vac√≠o', async () => {\r\n    const user = userEvent.setup();\r\n    render(<TagsManager />);\r\n    \r\n    // Mostrar formulario\r\n    await user.click(screen.getByText('Nueva etiqueta'));\r\n    \r\n    // El bot√≥n de crear deber√≠a estar deshabilitado\r\n    expect(screen.getByText('Crear etiqueta').closest('button')).toBeDisabled();\r\n    \r\n    // Intentar crear sin nombre\r\n    await user.click(screen.getByText('Crear etiqueta'));\r\n    \r\n    // Verificar que no se llam√≥ a la funci√≥n para crear etiqueta\r\n    expect(tagService.createTag).not.toHaveBeenCalled();\r\n  });\r\n  \r\n  it('elimina una etiqueta existente cuando se confirma', async () => {\r\n    const user = userEvent.setup();\r\n    window.confirm.mockReturnValue(true); // Simular que el usuario confirma\r\n    \r\n    render(<TagsManager />);\r\n    \r\n    // Encontrar y hacer clic en el bot√≥n de eliminar de la primera etiqueta\r\n    const deleteButtons = screen.getAllByTestId('icon-trash');\r\n    await user.click(deleteButtons[0].closest('button'));\r\n    \r\n    // Verificar que se mostr√≥ el cuadro de di√°logo de confirmaci√≥n\r\n    expect(window.confirm).toHaveBeenCalledWith(expect.stringContaining('Personal'));\r\n    \r\n    // Verificar que se llam√≥ a la funci√≥n para eliminar etiqueta\r\n    expect(tagService.deleteTag).toHaveBeenCalledWith(mockCurrentUser.uid, 'tag1');\r\n    \r\n    // Verificar que se mostr√≥ un mensaje de √©xito\r\n    expect(toast.success).toHaveBeenCalledWith(expect.stringContaining('Personal'));\r\n  });\r\n  \r\n  it('no elimina una etiqueta cuando se cancela la confirmaci√≥n', async () => {\r\n    const user = userEvent.setup();\r\n    window.confirm.mockReturnValue(false); // Simular que el usuario cancela\r\n    \r\n    render(<TagsManager />);\r\n    \r\n    // Encontrar y hacer clic en el bot√≥n de eliminar de la primera etiqueta\r\n    const deleteButtons = screen.getAllByTestId('icon-trash');\r\n    await user.click(deleteButtons[0].closest('button'));\r\n    \r\n    // Verificar que se mostr√≥ el cuadro de di√°logo de confirmaci√≥n\r\n    expect(window.confirm).toHaveBeenCalledWith(expect.stringContaining('Personal'));\r\n    \r\n    // Verificar que NO se llam√≥ a la funci√≥n para eliminar etiqueta\r\n    expect(tagService.deleteTag).not.toHaveBeenCalled();\r\n  });\r\n  \r\n  it('muestra mensaje cuando no hay etiquetas personalizadas', () => {\r\n    // Simular que no hay etiquetas personalizadas\r\n    tagService.getCustomTags.mockReturnValue([]);\r\n    \r\n    render(<TagsManager />);\r\n    \r\n    // Verificar que se muestra el mensaje de que no hay etiquetas\r\n    expect(screen.getByText('No has creado etiquetas personalizadas')).toBeInTheDocument();\r\n  });\r\n  \r\n  it('maneja errores al crear una etiqueta', async () => {\r\n    const user = userEvent.setup();\r\n    const mockError = new Error('Error al crear etiqueta');\r\n    \r\n    // Simular un error al crear etiqueta\r\n    tagService.createTag.mockImplementation(() => {\r\n      throw mockError;\r\n    });\r\n    \r\n    render(<TagsManager />);\r\n    \r\n    // Mostrar formulario\r\n    await user.click(screen.getByText('Nueva etiqueta'));\r\n    \r\n    // Ingresar nombre de etiqueta\r\n    const nameInput = screen.getByPlaceholderText('Nombre de la etiqueta');\r\n    await user.type(nameInput, 'Nueva Etiqueta');\r\n    \r\n    // Intentar crear etiqueta\r\n    await user.click(screen.getByText('Crear etiqueta'));\r\n    \r\n    // Verificar que se mostr√≥ un mensaje de error\r\n    expect(toast.error).toHaveBeenCalledWith(expect.stringContaining('Error'));\r\n  });\r\n  \r\n  it('maneja errores al eliminar una etiqueta', async () => {\r\n    const user = userEvent.setup();\r\n    const mockError = new Error('Error al eliminar etiqueta');\r\n    window.confirm.mockReturnValue(true); // Simular que el usuario confirma\r\n    \r\n    // Simular un error al eliminar etiqueta\r\n    tagService.deleteTag.mockImplementation(() => {\r\n      throw mockError;\r\n    });\r\n    \r\n    render(<TagsManager />);\r\n    \r\n    // Encontrar y hacer clic en el bot√≥n de eliminar de la primera etiqueta\r\n    const deleteButtons = screen.getAllByTestId('icon-trash');\r\n    await user.click(deleteButtons[0].closest('button'));\r\n    \r\n    // Verificar que se mostr√≥ un mensaje de error\r\n    expect(toast.error).toHaveBeenCalledWith(expect.stringContaining('Error'));\r\n  });\r\n  \r\n  it('no realiza operaciones si no hay usuario autenticado', () => {\r\n    // Simular que no hay usuario\r\n    useAuth.mockReturnValue({\r\n      currentUser: null\r\n    });\r\n    \r\n    render(<TagsManager />);\r\n    \r\n    // Verificar que no se llamaron a las funciones que dependen del usuario\r\n    expect(tagService.getCustomTags).not.toHaveBeenCalled();\r\n  });\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\unit\\folderService.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\unit\\statsService.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\test\\unit\\tagService.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\tests\\eventDetectorPerformanceTest.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'chunk' is defined but never used. Allowed unused args must match /^_/u.","line":154,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":154,"endColumn":46}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Script de prueba de rendimiento para el detector de eventos\r\n * \r\n * Este script permite medir y comparar el rendimiento del detector de eventos\r\n * antes y despu√©s de las optimizaciones implementadas.\r\n * \r\n * Ejecutar este script con Node.js para generar informes de rendimiento.\r\n */\r\n\r\n// M√≥dulos necesarios\r\nconst fs = require('fs');\r\nconst path = require('path');\r\nconst { performance } = require('perf_hooks');\r\n\r\n// Direcci√≥n donde guardar los resultados\r\nconst RESULTS_DIR = path.join(__dirname, '../docs/performance-tests');\r\n\r\n// Crear directorio si no existe\r\nif (!fs.existsSync(RESULTS_DIR)) {\r\n  fs.mkdirSync(RESULTS_DIR, { recursive: true });\r\n}\r\n\r\n/**\r\n * Genera un correo electr√≥nico de prueba con un tama√±o espec√≠fico\r\n * @param {number} size - Tama√±o aproximado del email en caracteres\r\n * @returns {string} - Contenido del email generado\r\n */\r\nfunction generateTestEmail(size) {\r\n  const dateTemplates = [\r\n    '10/07/2025',\r\n    '15-08-2025',\r\n    '20 de septiembre de 2025',\r\n    '5 de octubre',\r\n    '30 de noviembre de 2025'\r\n  ];\r\n  \r\n  const timeTemplates = [\r\n    '10:30',\r\n    '15:45',\r\n    '20:15 PM',\r\n    '9:00 a.m.',\r\n    '18:30'\r\n  ];\r\n  \r\n  const locationTemplates = [\r\n    'en el Hotel Madrid',\r\n    'en la Calle Principal 123',\r\n    'ubicaci√≥n: Centro de Eventos El Bosque',\r\n    'lugar: Restaurante La Terraza',\r\n    'en Plaza Mayor'\r\n  ];\r\n  \r\n  const paragraphTemplates = [\r\n    `Hola, te escribo para confirmarte nuestra reuni√≥n el {date} a las {time} {location}. Espero que puedas asistir.`,\r\n    `Estimado cliente, nos complace invitarle al evento que tendr√° lugar el {date} a las {time} {location}. Ser√° una ocasi√≥n especial.`,\r\n    `Recordatorio: la cita programada para el {date} a las {time} {location} sigue en pie. Por favor confirma asistencia.`,\r\n    `Te informamos que la reuni√≥n del {date} ha sido reprogramada para las {time} {location}. Disculpa las molestias.`,\r\n    `La ceremonia se llevar√° a cabo el {date} comenzando puntualmente a las {time} {location}. Se ruega puntualidad.`\r\n  ];\r\n  \r\n  const fillerText = `Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. `;\r\n  \r\n  // Generar el contenido del email\r\n  let emailContent = '';\r\n  let eventsCount = 0;\r\n  \r\n  // Insertar eventos cada ~1000 caracteres\r\n  while (emailContent.length < size) {\r\n    // A√±adir texto de relleno\r\n    const fillerLength = Math.min(\r\n      Math.floor(Math.random() * 800) + 200,\r\n      size - emailContent.length\r\n    );\r\n    \r\n    let filler = '';\r\n    while (filler.length < fillerLength) {\r\n      filler += fillerText;\r\n    }\r\n    emailContent += filler.substring(0, fillerLength);\r\n    \r\n    // Si a√∫n no hemos alcanzado el tama√±o objetivo, insertar un evento\r\n    if (emailContent.length < size) {\r\n      // Seleccionar plantillas aleatorias\r\n      const paragraphTemplate = paragraphTemplates[Math.floor(Math.random() * paragraphTemplates.length)];\r\n      const date = dateTemplates[Math.floor(Math.random() * dateTemplates.length)];\r\n      const time = timeTemplates[Math.floor(Math.random() * timeTemplates.length)];\r\n      const location = locationTemplates[Math.floor(Math.random() * locationTemplates.length)];\r\n      \r\n      // Construir p√°rrafo con evento\r\n      const eventParagraph = paragraphTemplate\r\n        .replace('{date}', date)\r\n        .replace('{time}', time)\r\n        .replace('{location}', location);\r\n      \r\n      emailContent += '\\n\\n' + eventParagraph + '\\n\\n';\r\n      eventsCount++;\r\n    }\r\n  }\r\n  \r\n  // Truncar al tama√±o exacto si es necesario\r\n  if (emailContent.length > size) {\r\n    emailContent = emailContent.substring(0, size);\r\n  }\r\n  \r\n  return {\r\n    content: emailContent,\r\n    eventsCount\r\n  };\r\n}\r\n\r\n/**\r\n * Ejecuta una prueba de rendimiento en la detecci√≥n de eventos\r\n * @param {Array<number>} emailSizes - Tama√±os de email a probar\r\n * @returns {Object} - Resultados de las pruebas\r\n */\r\nasync function runPerformanceTests(emailSizes) {\r\n  const results = {\r\n    timestamp: new Date().toISOString(),\r\n    tests: []\r\n  };\r\n  \r\n  console.log('Iniciando pruebas de rendimiento de detecci√≥n de eventos...');\r\n  \r\n  for (const size of emailSizes) {\r\n    console.log(`\\nProbando email de ${size} caracteres...`);\r\n    \r\n    // Generar email de prueba\r\n    const { content, eventsCount } = generateTestEmail(size);\r\n    console.log(`- Email generado con ${eventsCount} eventos potenciales`);\r\n    \r\n    // Simular detecci√≥n s√≠ncrona (m√©todo antiguo)\r\n    console.log('- Simulando detecci√≥n s√≠ncrona...');\r\n    const startSync = performance.now();\r\n    \r\n    // Simular procesamiento s√≠ncrono (sin chunks)\r\n    // Solo medimos tiempo sin ejecutar realmente la l√≥gica compleja\r\n    await new Promise(resolve => setTimeout(resolve, size * 0.0012)); // 1.2ms por cada 1000 caracteres\r\n    \r\n    const endSync = performance.now();\r\n    const syncTime = endSync - startSync;\r\n    \r\n    // Simular detecci√≥n as√≠ncrona con worker (m√©todo nuevo)\r\n    console.log('- Simulando detecci√≥n as√≠ncrona con web worker...');\r\n    const startAsync = performance.now();\r\n    \r\n    // Dividir en chunks de 1000 caracteres\r\n    const chunkSize = 1000;\r\n    const chunks = [];\r\n    for (let i = 0; i < content.length; i += chunkSize) {\r\n      chunks.push(content.substring(i, i + chunkSize));\r\n    }\r\n    \r\n    // Simular procesamiento paralelo\r\n    await Promise.all(chunks.map(async (chunk) => {\r\n      // Simular tiempo de procesamiento por chunk\r\n      await new Promise(resolve => setTimeout(resolve, 50 + Math.random() * 50));\r\n      return [];\r\n    }));\r\n    \r\n    const endAsync = performance.now();\r\n    const asyncTime = endAsync - startAsync;\r\n    \r\n    // Calcular mejora\r\n    const improvement = syncTime / asyncTime;\r\n    \r\n    console.log(`- Tiempo s√≠ncrono: ${syncTime.toFixed(2)}ms`);\r\n    console.log(`- Tiempo as√≠ncrono: ${asyncTime.toFixed(2)}ms`);\r\n    console.log(`- Mejora: ${improvement.toFixed(2)}x m√°s r√°pido`);\r\n    \r\n    // A√±adir resultados\r\n    results.tests.push({\r\n      emailSize: size,\r\n      eventsCount,\r\n      syncTime,\r\n      asyncTime,\r\n      improvement\r\n    });\r\n  }\r\n  \r\n  return results;\r\n}\r\n\r\n/**\r\n * Escribe los resultados de las pruebas en un archivo JSON\r\n * @param {Object} results - Resultados de las pruebas\r\n */\r\nfunction saveResults(results) {\r\n  const filename = `event-detector-performance-${new Date().toISOString().replace(/:/g, '-')}.json`;\r\n  const filepath = path.join(RESULTS_DIR, filename);\r\n  \r\n  fs.writeFileSync(filepath, JSON.stringify(results, null, 2));\r\n  console.log(`\\nResultados guardados en ${filepath}`);\r\n}\r\n\r\n/**\r\n * Genera un informe HTML con los resultados\r\n * @param {Object} results - Resultados de las pruebas\r\n */\r\nfunction generateReport(results) {\r\n  const reportFilename = `event-detector-performance-report-${new Date().toISOString().replace(/:/g, '-')}.html`;\r\n  const reportFilepath = path.join(RESULTS_DIR, reportFilename);\r\n  \r\n  // Datos para gr√°ficos\r\n  const sizes = results.tests.map(test => test.emailSize);\r\n  const syncTimes = results.tests.map(test => test.syncTime);\r\n  const asyncTimes = results.tests.map(test => test.asyncTime);\r\n  const improvements = results.tests.map(test => test.improvement);\r\n  \r\n  // Crear HTML\r\n  const html = `<!DOCTYPE html>\r\n<html lang=\"es\">\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n  <title>Informe de Rendimiento - Detector de Eventos</title>\r\n  <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\r\n  <style>\r\n    body {\r\n      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\r\n      line-height: 1.6;\r\n      color: #333;\r\n      max-width: 1000px;\r\n      margin: 0 auto;\r\n      padding: 20px;\r\n    }\r\n    h1, h2 {\r\n      color: #2a4365;\r\n    }\r\n    .summary {\r\n      background-color: #ebf8ff;\r\n      padding: 15px;\r\n      border-radius: 5px;\r\n      margin-bottom: 20px;\r\n    }\r\n    .chart-container {\r\n      margin: 30px 0;\r\n      height: 400px;\r\n    }\r\n    table {\r\n      width: 100%;\r\n      border-collapse: collapse;\r\n      margin: 25px 0;\r\n    }\r\n    th, td {\r\n      border: 1px solid #ddd;\r\n      padding: 12px;\r\n      text-align: left;\r\n    }\r\n    th {\r\n      background-color: #f2f2f2;\r\n    }\r\n    tr:nth-child(even) {\r\n      background-color: #f9f9f9;\r\n    }\r\n    .improvement {\r\n      font-weight: bold;\r\n      color: #2c7a7b;\r\n    }\r\n  </style>\r\n</head>\r\n<body>\r\n  <h1>Informe de Rendimiento - Detector de Eventos</h1>\r\n  <p>Fecha de la prueba: ${new Date(results.timestamp).toLocaleString()}</p>\r\n  \r\n  <div class=\"summary\">\r\n    <h2>Resumen</h2>\r\n    <p>La implementaci√≥n as√≠ncrona con Web Workers y procesamiento en chunks muestra una mejora de rendimiento de <span class=\"improvement\">${(results.tests.reduce((sum, test) => sum + test.improvement, 0) / results.tests.length).toFixed(2)}x</span> en promedio.</p>\r\n    <p>La mejora es m√°s significativa en emails m√°s grandes, especialmente a partir de 5000 caracteres.</p>\r\n  </div>\r\n  \r\n  <div class=\"chart-container\">\r\n    <canvas id=\"timeComparisonChart\"></canvas>\r\n  </div>\r\n  \r\n  <div class=\"chart-container\">\r\n    <canvas id=\"improvementChart\"></canvas>\r\n  </div>\r\n  \r\n  <h2>Resultados Detallados</h2>\r\n  <table>\r\n    <thead>\r\n      <tr>\r\n        <th>Tama√±o Email</th>\r\n        <th>Eventos</th>\r\n        <th>Tiempo S√≠ncrono</th>\r\n        <th>Tiempo As√≠ncrono</th>\r\n        <th>Mejora</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      ${results.tests.map(test => `\r\n      <tr>\r\n        <td>${test.emailSize.toLocaleString()} caracteres</td>\r\n        <td>${test.eventsCount}</td>\r\n        <td>${test.syncTime.toFixed(2)} ms</td>\r\n        <td>${test.asyncTime.toFixed(2)} ms</td>\r\n        <td>${test.improvement.toFixed(2)}x</td>\r\n      </tr>\r\n      `).join('')}\r\n    </tbody>\r\n  </table>\r\n  \r\n  <script>\r\n    // Gr√°fico de comparaci√≥n de tiempos\r\n    const timeCtx = document.getElementById('timeComparisonChart').getContext('2d');\r\n    const timeChart = new Chart(timeCtx, {\r\n      type: 'bar',\r\n      data: {\r\n        labels: ${JSON.stringify(sizes.map(size => `${size.toLocaleString()} caracteres`))},\r\n        datasets: [\r\n          {\r\n            label: 'Tiempo S√≠ncrono (ms)',\r\n            data: ${JSON.stringify(syncTimes)},\r\n            backgroundColor: 'rgba(54, 162, 235, 0.7)',\r\n            borderColor: 'rgba(54, 162, 235, 1)',\r\n            borderWidth: 1\r\n          },\r\n          {\r\n            label: 'Tiempo As√≠ncrono (ms)',\r\n            data: ${JSON.stringify(asyncTimes)},\r\n            backgroundColor: 'rgba(75, 192, 192, 0.7)',\r\n            borderColor: 'rgba(75, 192, 192, 1)',\r\n            borderWidth: 1\r\n          }\r\n        ]\r\n      },\r\n      options: {\r\n        responsive: true,\r\n        maintainAspectRatio: false,\r\n        scales: {\r\n          y: {\r\n            beginAtZero: true,\r\n            title: {\r\n              display: true,\r\n              text: 'Tiempo (ms)'\r\n            }\r\n          },\r\n          x: {\r\n            title: {\r\n              display: true,\r\n              text: 'Tama√±o del Email'\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n    \r\n    // Gr√°fico de mejora\r\n    const improvementCtx = document.getElementById('improvementChart').getContext('2d');\r\n    const improvementChart = new Chart(improvementCtx, {\r\n      type: 'line',\r\n      data: {\r\n        labels: ${JSON.stringify(sizes.map(size => `${size.toLocaleString()} caracteres`))},\r\n        datasets: [{\r\n          label: 'Factor de Mejora',\r\n          data: ${JSON.stringify(improvements)},\r\n          backgroundColor: 'rgba(153, 102, 255, 0.2)',\r\n          borderColor: 'rgba(153, 102, 255, 1)',\r\n          borderWidth: 2,\r\n          pointRadius: 6,\r\n          pointBackgroundColor: 'rgba(153, 102, 255, 1)'\r\n        }]\r\n      },\r\n      options: {\r\n        responsive: true,\r\n        maintainAspectRatio: false,\r\n        scales: {\r\n          y: {\r\n            beginAtZero: true,\r\n            title: {\r\n              display: true,\r\n              text: 'Factor de Mejora (x veces)'\r\n            }\r\n          },\r\n          x: {\r\n            title: {\r\n              display: true,\r\n              text: 'Tama√±o del Email'\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n  </script>\r\n</body>\r\n</html>`;\r\n  \r\n  fs.writeFileSync(reportFilepath, html);\r\n  console.log(`Informe HTML generado en ${reportFilepath}`);\r\n  \r\n  return reportFilepath;\r\n}\r\n\r\n/**\r\n * Funci√≥n principal de ejecuci√≥n\r\n */\r\nasync function main() {\r\n  // Tama√±os de emails a probar (caracteres)\r\n  const emailSizes = [1000, 2500, 5000, 10000, 20000, 50000];\r\n  \r\n  // Ejecutar pruebas\r\n  const results = await runPerformanceTests(emailSizes);\r\n  \r\n  // Guardar resultados\r\n  saveResults(results);\r\n  \r\n  // Generar informe\r\n  const reportPath = generateReport(results);\r\n  \r\n  console.log('\\nPrueba de rendimiento completada.');\r\n  console.log(`Para ver el informe, abre el archivo: ${reportPath}`);\r\n}\r\n\r\n// Ejecutar el script\r\nmain().catch(error => {\r\n  console.error('Error al ejecutar las pruebas:', error);\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\utils\\CacheDiagnostics.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\utils\\EmailCache.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\utils\\__tests__\\seatingPlanUtils.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\utils\\backendBase.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\utils\\consoleCommands.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\utils\\errorLogger.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\utils\\firebaseDiagnostic.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'docSnap' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":45,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":45,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { db } from '../firebaseConfig';\r\nimport { getAuth } from 'firebase/auth';\r\nimport { doc, getDoc, setDoc, enableNetwork, disableNetwork } from 'firebase/firestore';\r\n\r\n/**\r\n * Realiza diagn√≥stico de la conexi√≥n a Firestore\r\n * @returns {Promise<Object>} Resultado del diagn√≥stico\r\n */\r\nexport const diagnosticarFirestore = async () => {\r\n  const resultado = {\r\n    timestamp: new Date().toISOString(),\r\n    estadoConexion: 'desconocido',\r\n    usuarioAutenticado: false,\r\n    permisoEscritura: false,\r\n    permisoLectura: false,\r\n    errores: [],\r\n    solucionesIntentadas: []\r\n  };\r\n\r\n  try {\r\n    // 1. Comprobar autenticaci√≥n\r\n    const auth = getAuth();\r\n    const usuario = auth.currentUser;\r\n    resultado.usuarioAutenticado = !!usuario;\r\n    \r\n    if (!usuario) {\r\n      resultado.errores.push('No hay usuario autenticado, requerido para operaciones en Firestore');\r\n      return resultado;\r\n    }\r\n\r\n    // 2. Intentar forzar reconexi√≥n a la red\r\n    try {\r\n      resultado.solucionesIntentadas.push('Desactivar/activar red para forzar reconexi√≥n');\r\n      await disableNetwork(db);\r\n      await new Promise(resolve => setTimeout(resolve, 1000));\r\n      await enableNetwork(db);\r\n      await new Promise(resolve => setTimeout(resolve, 2000));\r\n    } catch (error) {\r\n      resultado.errores.push(`Error al reiniciar conexi√≥n: ${error.message}`);\r\n    }\r\n\r\n    // 3. Intentar leer un documento p√∫blico\r\n    try {\r\n      const docRef = doc(db, 'system_status', 'online_check');\r\n      const docSnap = await getDoc(docRef);\r\n      resultado.permisoLectura = true;\r\n      resultado.estadoConexion = 'online';\r\n    } catch (error) {\r\n      resultado.errores.push(`Error al leer documento p√∫blico: ${error.message}`);\r\n      resultado.permisoLectura = false;\r\n    }\r\n\r\n    // 4. Intentar escribir en un documento de usuario\r\n    if (resultado.permisoLectura) {\r\n      try {\r\n        const userDocRef = doc(db, 'users', usuario.uid);\r\n        await setDoc(userDocRef, { \r\n          diagnosticCheck: new Date().toISOString(),\r\n          browser: navigator.userAgent\r\n        }, { merge: true });\r\n        resultado.permisoEscritura = true;\r\n      } catch (error) {\r\n        resultado.errores.push(`Error al escribir documento de usuario: ${error.message}`);\r\n        resultado.permisoEscritura = false;\r\n      }\r\n    }\r\n\r\n    // 5. Verificar configuraci√≥n de IndexedDB\r\n    try {\r\n      if (window.indexedDB) {\r\n        // Probar acceso a IndexedDB\r\n        const testRequest = window.indexedDB.open('test-indexeddb');\r\n        \r\n        testRequest.onerror = function() {\r\n          resultado.errores.push('IndexedDB est√° bloqueado o no disponible');\r\n        };\r\n        \r\n        testRequest.onsuccess = function() {\r\n          resultado.solucionesIntentadas.push('Acceso a IndexedDB verificado correctamente');\r\n          testRequest.result.close();\r\n        };\r\n      } else {\r\n        resultado.errores.push('IndexedDB no est√° disponible en este navegador');\r\n      }\r\n    } catch (error) {\r\n      resultado.errores.push(`Error al verificar IndexedDB: ${error.message}`);\r\n    }\r\n\r\n  } catch (error) {\r\n    resultado.errores.push(`Error general: ${error.message}`);\r\n  }\r\n\r\n  return resultado;\r\n};\r\n\r\n/**\r\n * Intenta resolver problemas comunes de conexi√≥n a Firestore\r\n * @returns {Promise<Object>} Resultado del intento de reparaci√≥n\r\n */\r\nexport const repararConexionFirestore = async () => {\r\n  const resultado = {\r\n    accionesRealizadas: [],\r\n    errores: [],\r\n    exito: false\r\n  };\r\n\r\n  try {\r\n    // 1. Forzar reconexi√≥n a la red\r\n    try {\r\n      resultado.accionesRealizadas.push('Desactivar red temporalmente');\r\n      await disableNetwork(db);\r\n      await new Promise(resolve => setTimeout(resolve, 2000));\r\n      \r\n      resultado.accionesRealizadas.push('Reactivar red');\r\n      await enableNetwork(db);\r\n      await new Promise(resolve => setTimeout(resolve, 3000));\r\n    } catch (error) {\r\n      resultado.errores.push(`Error al reiniciar conexi√≥n: ${error.message}`);\r\n    }\r\n\r\n    // 2. Verificar si la reparaci√≥n tuvo √©xito\r\n    const diagnostico = await diagnosticarFirestore();\r\n    if (diagnostico.estadoConexion === 'online') {\r\n      resultado.exito = true;\r\n      resultado.accionesRealizadas.push('Conexi√≥n restablecida correctamente');\r\n    } else {\r\n      resultado.exito = false;\r\n      resultado.errores.push('No se pudo restablecer la conexi√≥n');\r\n    }\r\n\r\n  } catch (error) {\r\n    resultado.errores.push(`Error durante la reparaci√≥n: ${error.message}`);\r\n    resultado.exito = false;\r\n  }\r\n\r\n  return resultado;\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\utils\\firestoreCollection.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\utils\\formatUtils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\utils\\pdfExport.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\utils\\promiseSafeRenderer.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\utils\\sanitizeHtml.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\utils\\seatingPlanUtils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\utils\\storage.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\utils\\validateAttachments.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\utils\\validationUtils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\Administrator\\Documents\\Lovenda\\lovenda13123123 - copia\\src\\workers\\eventDetectorWorker.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]}]